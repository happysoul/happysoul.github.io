<!DOCTYPE html><!--
  Material Design Lite
  Copyright 2015 Google Inc. All rights reserved.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      https://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License
--><html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="A mirror of the go-to tutorial for starting with NES development.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <title>基于NESASM的FC游戏开发 Nerdy Nights Mirror</title>

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="images/android-desktop.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Material Design Lite">
    <link rel="apple-touch-icon-precomposed" href="images/ios-desktop.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#3372DF">

    <link rel="shortcut icon" href="images/favicon.ico">

    <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
    <!--
    <link rel="canonical" href="http://www.example.com/">
    -->
    <style type="text/css">
      /* Prevent flash of unstyled content from tabs that will be hidden when the material library finishes loading */
      .mdl-layout__tab-panel:not(.is-active) {
        display: none;
      }
    </style>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_purple-pink.min.css">
    <link rel="stylesheet" href="styles.css?1">
    <style>
    #view-source {
      position: fixed;
      display: block;
      right: 0;
      bottom: 0;
      margin-right: 40px;
      margin-bottom: 40px;
      z-index: 900;
    }
    </style>
  </head>
  <body class="mdl-demo mdl-color--grey-100 mdl-color-text--grey-700 mdl-base">
    <div id="top"></div>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header class="mdl-layout__header mdl-layout__header--scroll mdl-color--primary">
        <div class="mdl-layout--large-screen-only mdl-layout__header-row">
        </div>
        <div class="mdl-layout--large-screen-only mdl-layout__header-row">
          <h3>基于NESASM的FC游戏开发 Nerdy Nights Mirror</h3>
        </div>
        <div class="mdl-layout--large-screen-only mdl-layout__header-row">
        </div>
        <div class="mdl-layout__tab-bar mdl-js-ripple-effect mdl-color--primary-dark">
          <a href="#overview" class="mdl-layout__tab is-active">概览</a>
          <a href="#main_tutorial" class="mdl-layout__tab">基础教程</a>
          <a href="#advanced_tutorial" class="mdl-layout__tab">进阶教程</a>
          <a href="#audio_tutorial" class="mdl-layout__tab">音频教程</a>
          <a href="#misc" class="mdl-layout__tab">其他杂项</a>
        </div>
      </header>
      <main class="mdl-layout__content">
      
        <div class="mdl-layout__tab-panel" id="advanced_tutorial">
    <section class="section--center mdl-grid mdl-grid--no-spacing">
        <div class="mdl-cell mdl-cell--12-col">
            <h4>进阶教程</h4>

            <h5>目录</h5>
            <ul class="toc" id="advanced_tutorial-toc">

                                    <a href="#advanced_tutorial-0">1: CHR Bank 图形Bank切换</a>
                                    <a href="#advanced_tutorial-1">2: 基于 MMC1 的 CHR 和 PRG Bank 切换, 存档芯片，电池</a>
                                    <a href="#advanced_tutorial-2">3: 水平背景滚动</a>
                                    <a href="#advanced_tutorial-3">4: 0号精灵固定在状态栏</a>
                            </ul>

                            
                <div class="tutorialCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">1: CHR Bank 图形Bank切换</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<span class="Apple-style-span" style="font-weight: bold; "><div><span class="Apple-style-span" style="font-weight: normal; ">To do the advanced lessons you should have already finished Pong.</span></div><div><br></div>This Week:&#xA0;</span>As you complete a full game you may find the NROM memory limits to be too small.  To enable more ROM on carts many forms of &quot;bank switching&quot; were used.  This article deals with just one type of CHR switching, used on CNROM carts.  CNROM is easy to use and very cheap to manufacture.  The <a href="http://www.retrousb.com/product_info.php?ref=5&amp;products_id=42&amp;affiliate_banner_id=1" target="_blank" original-href="http://www.retrousb.com/product_info.php?ref=5&amp;products_id=42&amp;affiliate_banner_id=1">ReproPak</a>, <a href="http://www.retrousb.com/product_info.php?ref=5&amp;products_id=34&amp;affiliate_banner_id=1" target="_blank" original-href="http://www.retrousb.com/product_info.php?ref=5&amp;products_id=34&amp;affiliate_banner_id=1">PowerPak</a>, and <a href="http://www.retrousb.com/product_info.php?ref=5&amp;products_id=35&amp;affiliate_banner_id=1" target="_blank" original-href="http://www.retrousb.com/product_info.php?ref=5&amp;products_id=35&amp;affiliate_banner_id=1">PowerPak Lite</a> all support CNROM completely so it is easy to get your code running on real hardware.  If you are using donor carts you can look up games that use CNROM at <a href="http://bootgod.dyndns.org:7777/" target="_blank" original-href="http://bootgod.dyndns.org:7777/">BootGod&apos;s NES Cart Database</a>.<br>
<br>
<br><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: medium; ">
CHR Bank Switching</span> </span><br>
  Bank switching is exchanging one chunk of ROM for a different chunk, while keeping everything in same address range.  It is not making a copy, so it happens instantly.  You can switch between different banks whenever you want.  The size and memory range of the banks depends on the mapper.  For the CNROM mapper used in this article the bank size is 8KB of CHR ROM.  The whole 8KB range of PPU memory $0000-1FFF is switched at once.  This means the graphics for all background tiles and sprite tiles will be swapped.  In your game you may have some tiles duplicated in multiple banks so they do not appear to change on screen.  PRG is not bank switched, so it remains at the NROM limit of 32KB.<br>
<br>
<br><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: medium; ">
Set Mapper Number</span></span><br>
The first part of adding bank switching is changing the mapper number your .NES file uses.  At the top of your code has previously been:<br>
<br>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;.inesmap 0   ; mapper 0 = NROM, no bank swapping</span></p>
<br>
The new line is:<br>
<p></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;.inesmap 3   ; mapper 3 = CNROM, 8KB CHR ROM bank swapping</span></p>
<br>
This line in the header just tells the emulator to use CNROM to play your game.  A list of other iNES mapper numbers can be seen at the wiki at <a href="http://nesdevwiki.org/" target="_blank" original-href="http://nesdevwiki.org/">http://nesdevwiki.org/...</a>. <br>
<br>
<br><span class="Apple-style-span" style="font-size: medium; "><span class="Apple-style-span" style="font-weight: bold; ">
Set CHR Size</span></span><br>
The next part is to increase the size of your CHR ROM.  Change the .ineschr value from 1 to 2, showing that there are now two 8KB banks. CNROM can handle 32KB of CHR ROM or four 8KB banks but this example will only use two.<br>
<br>
<br><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: medium; ">
Add CHR Data</span></span><br>
The third part adds the data for the next bank into your game.  Just make a new .bank statement below your current one for CHR, giving it the next sequential number.  In your code when you set which bank to switch to this is the number used.  PRG bank numbers are ignored so your original CHR bank will be #0 and the new one will be #1.<br>
<br>
<br><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: medium; ">
Bank Switching Code</span></span><br>
The final part it to write your bank switching code.  This subroutine will take a bank number in the A register and switch the CHR bank to it immediately.  The actual switch is done by writing the desired bank number anywhere in the $8000-FFFF memory range.  The cart hardware sees this write and changes the CHR bank.<br><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span class="Apple-style-span" style="font-family: &apos;-webkit-sans-serif&apos;; font-size: 12px; "><br></span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">... your game code ...</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;LDA #$01        ;;put new bank to use into the A register</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;JSR Bankswitch  ;;jump to bank switching code</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">... your game code ...</span></p>
<br>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">Bankswitch:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;STA $8000       ;;new bank to use</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;RTS</span></p>
<br>
<br><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: medium; ">
Bus Conflicts</span></span><br>
When you start running your code on real hardware there is one catch to worry about.  For basic mappers, the PRG ROM does not care if it receives a read or a write command.  It will respond to both like a read by putting the data on the data bus.  This is a problem for bank switching, where the CPU is also trying to put data on the data bus at the same time.  They electrically fit in a &quot;bus conflict&quot;.  The CPU could win, giving you the right value.  Or the ROM could win, giving you the wrong value.  This is solved by having the ROM and CPU put the same value on the data bus, so there is no conflict.  First a table of bank numbers is made, and the value from that table is written to do the bank switch.<br>
<br>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">... code ...</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;LDA #$01        ;;put new bank to use into A</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;JSR Bankswitch  ;;jump to bank switching code</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">... code ...</span></p>
<br>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">Bankswitch:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;TAX                ;;copy A into X</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;STA Bankvalues, X  ;;new bank to use</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;RTS</span></p>
  <br>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">Bankvalues:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;.db $00, $01, $02, $03    ;;bank numbers </span></p>
 
<br>
The X register is used as an index into the Bankvalues table, so the value written by the CPU will match the value coming from the ROM.<br>
<br>
  <br><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: medium; "><br>
Putting It All Together</span></span><br>
Download and unzip the <a href="scraper/files/chrbanks.zip" target="_blank" original-href="http://www.nespowerpak.com/nesasm/chrbanks.zip">chrbanks.zip</a> sample files.  This set is based on the previous <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=7974" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=7974">Week 5</a> code.  Make sure that file, mario0.chr, mario1.chr, and chrbanks.bat is in the same folder as NESASM3, then double click on chrbanks.bat.  That will run NESASM3 and should produce chrbanks.nes.  Run that NES file in FCEUXD SP to see small Mario.<br>
<br>
Inside the LatchController subroutine a new section is added to read the Select and Start buttons from the controller.  The Select button switches to CHR bank 0, and the Start button switches to CHR bank 1.  Graphics of CHR bank 1 have been rearranged so Mario will change to a beetle. &#xA0;The tile numbers are not changed, but the graphics for those tiles are.
<div><br></div><div>Open the PPU Viewer from the Tools menu in FCEUXD SP and try hitting the buttons. &#xA0;You can see all the graphics changing at once when the active bank switches.</div>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#advanced_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;advanced_tutorial-0__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=17074" target="_blank">
                                来源网页
                            </a>
                        </div>

                    </div>
                </div>
                <div class="comments" style="display: none;" id="advanced_tutorial-0__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__1">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Mar 12, 2009 at 7:16:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					FINALLY!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__2">
                                                        <div class="mdl-card__title"><strong>Sivak</strong> posted on 
		
			
				
				Mar 12, 2009 at 7:58:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m using UOROM, so it&apos;s all PRG for me.  This is nothing new.
<br>
<br>I am curious, however...  Is there a different value to use if, say, you had both PRG and CHR ROM like with MMC1 or MMC3?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__3">
                                                        <div class="mdl-card__title"><strong>arch_8ngel</strong> posted on 
		
			
				
				Mar 12, 2009 at 9:13:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Awesome.  I was wondering if these were ever going to continue.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__4">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Mar 12, 2009 at 9:59:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This was a requested topic for a game in development  <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">  If anyone else is working on something and needs help I can cover other things like 16 bit math, more collisions, fading, etc.
<br>
<br>Mappers like MMC1 and MMC3 use more than a single write to do bank switching.  They also have more logic so the ROM doesn&apos;t respond to a write command, meaning no bus conflicts.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__5">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Mar 13, 2009 at 1:14:08 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br><span style="font-weight: bold;" class="Apple-style-span"><span style="font-size: medium;" class="Apple-style-span">
Bank Switching Code</span></span><br>
The final part it to write your bank switching code.  This subroutine will take a bank number in the x register and switch the CHR bank to it immediately.  The actual switch is done by writing the desired bank number anywhere in the $8000-FFFF memory range.  The cart hardware sees this write and changes the CHR bank.<br><p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="font-family: &apos;-webkit-sans-serif&apos;; font-size: 12px;" class="Apple-style-span"><br></span></p><p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">... your game code ...</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">  LDA #$01        ;;put new bank to use into X register</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">  JSR Bankswitch  ;;jump to bank switching code</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">... your game code ...</span></p>
<br>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">Bankswitch:</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">  STA $8000       ;;new bank to use</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">  RTS</span></p>
<br>
<br><span style="font-weight: bold;" class="Apple-style-span"><span style="font-size: medium;" class="Apple-style-span"></span></span></div><br><br>Nice to see Nerdy Nights back. <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"><br><br>I found a little typo in the above part.&#xA0; You talk about using the X register (both in the paragraph and in the code comments) but you do everything with A.&#xA0; I don&apos;t think anyone who has made it far enough to complete pong will get confused by that, but for completeness&apos; sake, you might want to fix it <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__6">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Mar 13, 2009 at 9:07:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Fixed!  Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__7">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Mar 13, 2009 at 1:11:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I saw it.  Just wanted to keep bunnyboy on his toes.
<br>
<br>Okay, I didn&apos;t see it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__8">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Mar 13, 2009 at 1:41:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Nobody should read comments anyways, they are for the weak minded.  Don&apos;t ban me.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__9">
                                                        <div class="mdl-card__title"><strong>Stan</strong> posted on 
		
			
				
				Mar 14, 2009 at 12:01:13 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Excellent, been looking for some good info on banking.  Great job man, very helpful.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__10">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				Apr 17, 2009 at 7:23:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank you! I&apos;ll be trying this out on my game tonight! <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__11">
                                                        <div class="mdl-card__title"><strong>Cthulhu32</strong> posted on 
		
			
				
				May 1, 2009 at 1:29:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i></div><div class="FTQUOTE"><i><b><span class="Apple-style-span" style="font-style: normal; font-weight: normal; "><br></span></b></i><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: medium; ">
Bus Conflicts</span></span><br>
When you start running your code on real hardware there is one catch to worry about.  For basic mappers, the PRG ROM does not care if it receives a read or a write command.  It will respond to both like a read by putting the data on the data bus.  This is a problem for bank switching, where the CPU is also trying to put data on the data bus at the same time.  They electrically fit in a &quot;bus conflict&quot;.  The CPU could win, giving you the right value.  Or the ROM could win, giving you the wrong value.  This is solved by having the ROM and CPU put the same value on the data bus, so there is no conflict.  First a table of bank numbers is made, and the value from that table is written to do the bank switch.<br>
<br>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">... code ...</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;LDA #$01        ;;put new bank to use into A</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;JSR Bankswitch  ;;jump to bank switching code</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">... code ...</span></p>
<br>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">Bankswitch:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;TAX                ;;copy A into X</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;STA Bankvalues, X  ;;new bank to use</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;RTS</span></p>
  <br>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">Bankvalues:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0;.db $00, $01, $02, $03    ;;bank numbers </span></p>
 
<br>
The X register is used as an index into the Bankvalues table, so the value written by the CPU will match the value coming from the ROM.<br>
<br><br></div><br><br><div>Quick clarification on this code: is the reason you do a TAX is because that will set the $0000 CPU to the same value that is being set at $8000? And you are storing A into BankValues because BankValues is a .db rom value, which means its at $8000?</div><div><br></div><div>Does this also mean you don&apos;t need the extra offset at all, you JUST need the TAX to force the same value thats going into $8000 to be in $0000?</div><div><br></div><div>For example:</div><div><br></div><div><div>Bankswitch:</div><div>&#xA0;&#xA0;TAX &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;;set the CPU to A ?</div><div>&#xA0;&#xA0;STA $8000 &#xA0; &#xA0; &#xA0; ;;set the ROM to A ?</div><div>&#xA0;&#xA0;RTS</div></div><div><br></div><div>The way I came to this conclusion is because if Bankvalues was the only .db in the file, Bankvalues would be $8000, which means a step along the assembler compilng,&#xA0;STA Bankvalues, X would become STA $8000, X.&#xA0;</div><div><br></div><div>And because the NES cpu doesn&apos;t care if you set $8000, $8001, $8002, or $8003 with the map, you could just simplify this to always setting $8000.</div><div><br></div><div>I am probably missing a step here in how you write the bankvalues, so any clarifications are greatly appreciated <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> Thanks for the awesome tutorials!</div><div><br></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__12">
                                                        <div class="mdl-card__title"><strong>frantik</strong> posted on 
		
			
				
				May 7, 2009 at 2:30:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					.db causes the bytes to be written at that point in the code. data doesn&apos;t automatically start at $8000 or anything.. even your program code won&apos;t start at $8000 unless you tell the assembler to do so with an org command.  (well the pointers won&apos;t start at $8000)
<br>
<br>you could do something like 
<br>
<br>LDA #$03
<br>STA Bankvalue + #$03
<br>
<br>if you knew you wanted to switch to bank 3.. but it&apos;s better to reuse the general bank switching function.. that way if you end up switching mappers you only ahve to change one area of code
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__13">
                                                        <div class="mdl-card__title"><strong>Cthulhu32</strong> posted on 
		
			
				
				May 7, 2009 at 12:05:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>frantik</b></i><br><br>.db causes the bytes to be written at that point in the code. data doesn&apos;t automatically start at $8000 or anything.. even your program code won&apos;t start at $8000 unless you tell the assembler to do so with an org command.  (well the pointers won&apos;t start at $8000)
<br>
<br>you could do something like 
<br>
<br>LDA #$03
<br>STA Bankvalue + #$03
<br>
<br>if you knew you wanted to switch to bank 3.. but it&apos;s better to reuse the general bank switching function.. that way if you end up switching mappers you only ahve to change one area of code</div><br>Ahh okay, so when you LDA #$03 you&apos;re putting 3 into the A register (CPU), and then storing it into the BankValue (ROM) which signals the bank switch? This way the CPU &amp; ROM match?
<div><br></div><div>I think I understand Bunnyboy&apos;s code now as well, the reason why he has bankvalues laid out as .db $00,$01,$02,$03 is because you&apos;re literally writing the same value on top of a ROM (which just triggers a bank switch)</div><div><br></div><div>So LDA #$01 sets the accumulator (CPU), TAX; STA Bankvalues, X; overwrites Bankvalues without modifying A, and because X = A, X is identical to the values inside of Bankvalues, you&apos;re not changing any data, you&apos;re just triggering a bankswitch.</div><div><br></div><div>Thanks for the clarification!</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__14">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 7, 2009 at 4:18:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Cthulhu32</b></i><br><br>Ahh okay, so when you LDA #$03 you&apos;re putting 3 into the A register (CPU), and then storing it into the BankValue (ROM) which signals the bank switch? <span class="Apple-style-span" style="font-weight: bold; ">This way the CPU &amp; ROM match?</span></div><br><br>That&apos;s the key, the values have to match or you will get the wrong result in the bankswitch. &#xA0;ROM is read only so you can&apos;t change the data there.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__15">
                                                        <div class="mdl-card__title"><strong>frantik</strong> posted on 
		
			
				
				May 7, 2009 at 8:24:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You only have to do that for mappers with &quot;bus conflicts&quot;.  You&apos;re writing to memory which is supposed to be Read Only (ROM).  Instead of writing, you actually cause the mapper to do things.  but mappers with bus conflicts get messed up if you don&apos;t write the same value which is contained in the ROM
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__16">
                                                        <div class="mdl-card__title"><strong>Stan</strong> posted on 
		
			
				
				Aug 9, 2009 at 6:17:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Great stuff buns, very helpful for where I am in SMS programming actually.  Glad you&apos;re keeping it going.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__17">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Aug 29, 2009 at 10:50:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Any chance you would consider writing one of these for MMC1?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__18">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				Mar 10, 2011 at 10:33:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey, totally random question on a blast-from-the-past thread... <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> This method works for me when I&apos;m using 2 or 4 CHR banks. However, games with 3 CHR banks do not pull from the proper tileset when running on the PowerPak/NES. (They work fine in Nintendulator, though.) A game that uses 3 CHR banks will only work for me if I set .ineschr to 4 and duplicate one of the banks. I&apos;m continuing to experiment, but I wonder if anyone has any thoughts as to why this might be happening. Just curious.
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__19">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Mar 10, 2011 at 10:49:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Because there&apos;s pretty much no games/hardware that uses a number of banks not to 2^bankselectnumberofpins, which is why you need to have 1,2,4,8,16,32,64,128,256 character banks.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__20">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Mar 10, 2011 at 10:50:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Memory chips come in powers of 2, so your total CHR and PRG sizes should also be powers of 2.  When you use 3 banks different emulators and systems will fill in the missing area in different ways.  Some will leave it empty, some will extend the first bank or last bank.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__21">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Mar 11, 2011 at 8:31:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					YEAH!  RACHEL!!!!!!!!!!!!!!!  Keep on codin&apos; girl.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__22">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				Mar 11, 2011 at 9:09:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, that&apos;s what I guessed, too. I was just surprised both in the results I got and that none of the documentation mentioned that point. Maybe &apos;cause it was obvious to everyone else, hehe <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">. And thanks, Kevin! You know what I&apos;m up to <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-wink.gif" show-src="images/blank.gif">.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__23">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Mar 25, 2014 at 8:17:11 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					FYI:
<br>
<br>Dead link. <a href="&lt;a href=" http: nesdevwiki.org " target="_blank" original-href="&lt;a href=">http://nesdevwiki.org/...</a>&quot; target=&quot;_blank&quot;&gt;http://nesdevwiki.org/... 
<br>
<br>Can you please update to a new site (maybe something better has come along?) or link to an archive on archive.org?
<br><a href="https://web.archive.org/web/" target="_blank" original-href="https://web.archive.org/web/">https://web.archive.org/web/...</a>*/http://nesdevwiki.org/
<br>
<br>Thanks.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__24">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 2, 2014 at 11:41:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I understand what is happening here, but can I get some examples on why this would be used? Is it just for getting an extra set of character tiles if you run out of room in the first?<br>
<br>
The hardest part of learning the code in NES 6502 is understanding why you must do something. Most of the time I can follow the code and understand what it does, I&apos;m just not far enough along to see how it will be useful.<br>
<br>
Thanks in advance. I know I keep on bringing up dead threads. My bad.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__25">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Apr 2, 2014 at 11:45:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Best reason is the screen has more pixels then chr-rom can bank in. So switching banks allows for more screen content, since it just adds more graphics available to display. That&apos;s basically the whole idea.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__26">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 4, 2014 at 9:50:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>
	You can do a lot of things with this. For example:</p>
<p>
	1. Bank 0 can be your start screen graphics where you have a giant ass picture. Bank 1 could contain main game stuff, 2 the cut screens, and 3 the end screen. Just where you have too many graphics to fit into one CHR bank.</p>
<p>
	2. You can animate the entire background and sprite set at once. A la <br clear="all"></p><div class="col-md-6"><div class="embed-responsive embed-responsive-16by9"><a href="https://www.youtube.com/O8P7_7YINos?list=UUKDlRHqgdPjOjQq2HFW7VhA">Youtube</a></div></div><br clear="all"><p></p>
<p>
	3. Or you can do somthing like this:&#xA0; <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=115064" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=115064">http://nintendoage.com/forum/messageview.cfm?catid=22&amp;th...</a> </p>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__27">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 4, 2014 at 10:00:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So a game like centipede would use bank switching to animate the centipede and the objects that you shoot? I assume that each bank is still limited to the same 16 color pallete.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__28">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 4, 2014 at 10:17:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Basically in the game MRN posted, it switches between the two banks to animate the background, instead of attempting to update every single background tile one by one.  The two banks have the two &quot;frames&quot; of animation, with the same tiles being used for the same enemy in both sets, so when the bank switches, all tile numbers stay the same but it animates.
<br>
<br>I&apos;ve personally used it for his first example: I generally try to make my title screens a little fancier, so I use an entire pattern table for it.  Then I have another pattern table for the gameplay.  That way I don&apos;t have to try to piece something together from the random tiles I have for the main part of the game.  Although I did this for Study Hall and it turned out pretty cool. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__29">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 4, 2014 at 10:29:10 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	So a game like centipede would use bank switching to animate the centipede and the objects that you shoot? I assume that each bank is still limited to the same 16 color pallete.</div>
<br>
I confused myself. I now see that the animation is the shifting of the enemy back and forth plus they change their form.<br>
<br>
I could see how it would be useful in the first example.<br>
<br>
Is bank switching how they built Mega Man? I know there was a trick they used in order to get his face a different color than the rest of his body to trick the 4 color limit.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__30">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 4, 2014 at 10:52:46 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Mega Man used sprites on top of sprites.  i.e. four to make up the body and a different colored fifth one pasted over the top.
<br>
<br>And BAN used 4 frame animation.  Though you can&apos;t tell unless you get real close.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__31">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 4, 2014 at 11:14:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I thought I counted 4 frames.
<br>
<br>Thanks for clarifying the Mega Man meta-sprite.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__32">
                                                        <div class="mdl-card__title"><strong>tree of might</strong> posted on 
		
			
				
				Jul 14, 2014 at 9:39:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry, guys, I just don&apos;t get this. At the end of the bankswitch subroutine the value in X gets stored in the bankvalues area, then what? What part of the code actually causes the bank switching to happen? Sorry if this is a dumb question.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__33">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 14, 2014 at 10:05:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>tree of might</b></i><br>
	<br>
	Sorry, guys, I just don&apos;t get this. At the end of the bankswitch subroutine the value in X gets stored in the bankvalues area, then what? What part of the code actually causes the bank switching to happen? Sorry if this is a dumb question.</div>
<br>
It&apos;s storing it into the $8000 address, right?<br>
<br>
;;code<br>
<span>STA $8000 ;;new bank to use</span><br>
RTS
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__34">
                                                        <div class="mdl-card__title"><strong>tree of might</strong> posted on 
		
			
				
				Jul 15, 2014 at 2:24:38 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>tree of might</b></i><br>
		<br>
		Sorry, guys, I just don&apos;t get this. At the end of the bankswitch subroutine the value in X gets stored in the bankvalues area, then what? What part of the code actually causes the bank switching to happen? Sorry if this is a dumb question.</div>
	<br>
	It&apos;s storing it into the $8000 address, right?<br>
	<br>
	;;code<br>
	<span>STA $8000 ;;new bank to use</span><br>
	RTS</div>
<br>
What section of the code does it write to $8000? I can&apos;t seem to find it.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-0__35">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Dec 4, 2015 at 2:48:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>tree of might</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>tree of might</b></i><br>
<br>
Sorry, guys, I just don&apos;t get this. At the end of the bankswitch subroutine the value in X gets stored in the bankvalues area, then what? What part of the code actually causes the bank switching to happen? Sorry if this is a dumb question.</div>
<br>
It&apos;s storing it into the $8000 address, right?<br>
<br>
;;code<br>
<span>STA $8000 ;;new bank to use</span><br>
RTS</div>
<br>
What section of the code does it write to $8000? I can&apos;t seem to find it.<br>
&#xA0;</div>
<strong>THIS IS KEY<br>
&quot;The actual switch is done by writing the desired bank number anywhere in the $8000-FFFF memory range.&quot;</strong><br>
<br>
<strong>Bus Conflicts</strong><br>
&quot;When you start running your code on real hardware there is one catch to worry about. For basic mappers, the PRG ROM does not care if it receives a read or a write command. It will respond to both like a read by putting the data on the data bus. This is a problem for bank switching, where the CPU is also trying to put data on the data bus at the same time. They electrically fit in a &quot;bus conflict&quot;. The CPU could win, giving you the right value. Or the ROM could win, giving you the wrong value. This is solved by having the ROM and CPU put the same value on the data bus, so there is no conflict. First a table of bank numbers is made, and the value from that table is written to do the bank switch.&quot;<br>
<br>
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br>
&#xA0; .bank 0&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;;Code is stored starting at $C000<br>
&#xA0; .org $C000<br>
&#xA0;<br>
&#xA0; ... code ...<br>
<br>
&#xA0; LDA #$01 &#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;;Load A with $01 (For bank 1)<br>
&#xA0; JSR Bankswitch &#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;;jump to bank switching code<br>
<br>
... code ...<br>
<br>
Bankswitch:<br>
&#xA0; TAX&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0; ;;copy $01 into X<br>
&#xA0; STA Bankvalues, X &#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;;Write $01 to Bankvalues,$01 (Which is stored somewhere between $C000-$DFFF). This is done to avoid the Bus Conflict in the paragraph above<br>
&#xA0; RTS<br>
<br>
Bankvalues:<br>
&#xA0; .db $00, $01, $02, $03 &#xA0;&#xA0; &#xA0;;;bank numbers<br>
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;&#xA0;<br>
&#xA0;<br>
&#xA0;<br>
Since you write to Bankvalues, that table is stored in $8000-FFFF memory range. You can write to ANY number in that range, so you write the value of X into Bankvalues.<br>
<br>
Hope that helps clarify. This is the way I understand it.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                            
                <div class="tutorialCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-1">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">2: 基于 MMC1 的 CHR 和 PRG Bank 切换, 存档芯片，电池</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b>This Week:</b>  The MMC1 is the first advanced mapper made by Nintendo.  It is used for many games including top titles like The Legend of Zelda.  The main benefits are mirroring control, up to 256KB of PRG ROM, 128KB of CHR RAM or ROM, and 8KB of WRAM.  The WRAM can be battery backed for saved games.  This tutorial will cover all features of the MMC1 and how to use them. You should be comfortable with the normal Nerdy Nights series before starting. &#xA0;Another more simple lesson for bankswitching is&#xA0;<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=17074" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=17074">Advanced Nerdy Nights #1</a>.&#xA0;&#xA0;If you only need one or two of the banking features then you may want to consider more simple and cheaper mappers instead such as UNROM or CNROM.<br>
<br>
Carts using the MMC1 will have the S*ROM board code, like SNROM and SGROM.  BootGod&apos;s <a href="http://bootgod.dyndns.org:7777/" target="_blank" original-href="http://bootgod.dyndns.org:7777/">NesCartDB</a> database can be searched for which games use which boards.  The <a href="http://www.retrousb.com/product_info.php?cPath=24&amp;products_id=43" target="_blank" original-href="http://www.retrousb.com/product_info.php?cPath=24&amp;products_id=43">ReproPak MMC1</a> board can also be used to build carts. 
<br>
<br><br><span class="Apple-style-span" style="font-size: medium; "><b>
Shift Registers</b></span><br>
The MMC1 uses a 5 bit shift register to temporarily store the banking bits.  Shift registers were covered in <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8747" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8747">Week 7</a>.  When writing to the register data comes in from data bit 0 only.  This is similar to the controller reading where data outputs to data bit 0.  Every time a write happens the current bits are shifted and D0 is inserted.  The first bit you write eventually becomes to lowest bank bit.  On the 5th write when the shift register is full the 5 bit value gets copied to the banking register.  At this point the bank switch happens immediately without any delays.  To load a bank register the LSR instruction is used for shifting:<br>
<pre>  LDA banknumber
  STA bankreg    ; load bank bit 0 to shift register from data bit 0
  LSR A          ; shift in next data bit to position 0
  STA bankreg    ; load bank bit 1 from data bit 0
  LSR A
  STA bankreg    ; bank bit 2
  LSR A
  STA bankreg    ; bank bit 3
  LSR A
  STA bankreg    ; bank bit 4, bank register loaded, bank switch happens here</pre><br>
Unlike other simple mappers like UNROM and CNROM, there are no bus conflicts.  The ROM is not enabled while you are writing so you do not have to make the data you are writing match.<br>
<br>
Data bit 7 is also connected to the MMC1.  When a write happens to any banking register with D7=1 the shift register is reset back to position 0.  It will then take another 5 writes to fully load the next value.  All other bits are ignored and D0 is not loaded into the shift register.  The PRG bits of the control register are also reset to their default values as shown in the next section.  Usually you will only reset the MMC1 at the very beginning of your program:
<br>
<pre>  LDA #%10000000
  STA $8000</pre>
 <br><span class="Apple-style-span" style="font-size: medium; "><b>
Config Register at $8000-9FFF</b></span><br>
To load the config register, do 5 writes to the $8000-9FFF range.  The config bits are:<br>
<br>
<pre>  43210
  -----
  CPRMM
  |||||
  |||++- Mirroring (0: one-screen, lower bank; 1: one-screen, upper bank;
  |||               2: vertical; 3: horizontal)
  ||+--- PRG swap range (0: switch 16 KB bank at $C000; 1: switch 16 KB bank at $8000;
  ||                            only used when PRG bank mode bit below is set to 1)
  |+---- PRG size (0: switch 32 KB at $8000, ignoring low bit of bank number;
  |                         1: switch 16 KB at address specified by location bit above)
  +----- CHR size (0: switch 8 KB at a time; 1: switch two separate 4 KB banks)</pre>
<br>
<b>Mirroring Config</b><br>
  Your program can change the mirroring at any point using these bits.  You do not need to wait for vblank to change them.  When using the MMC1 the .inesmir directive bit is ignored.  You must set it through your code.  Mirroring set to 0 and 1 are single screen mirroring modes.  Only 1KB is used for all nametables.  When scrolling the screen will wrap both vertically and horizontally.  Mirroring set to 2 is the typical vertical mirroring, and 3 is horizontal mirroring.<br>
<br>
<b>PRG Bank Size Config</b><br>
  The MMC1 swaps PRG ROM in either 16KB or 32KB chunks.  By default this bit is set to 1 for 16KB banks.  Clearing it to 0 enables 32KB banks.  Notice these are not the same size as the 8KB NESASM banks so the bank numbers will be different.  When using 16KB banks the MMC1 banks are twice as big, so you must divide your NESASM bank number by 2 when writing it to the bank register.  When using 32KB banks you must divide by 4.  16KB banks is most commonly used, with the bulk of the code in the fixed bank and data/graphics/music in the swappable banks.<br>
<br>
<b>PRG Swap Range Config</b><br>
  When using 16KB banks set above, the PRG address range that gets swapped can be configured.  If 32KB banks are used this bit is ignored and the entire $8000-FFFF range is swapped at once.<br>
<br>
By default this bit is set to 1, making the $8000-BFFF range swappable while the $C000-FFFF range is fixed to the last bank Of PRG.  This matches the PRG swapping of the UNROM mapper and is most commonly used.  Clearing this bit to 0 changes this so $8000-BFFF is fixed and $C000-FFFF is swappable.  <br>
<br>
Changing the range or bank size can be useful for swapping audio samples but you have to be careful to put IRQ/reset/NMI vectors in all banks that are loaded into the vector area at $FFFA-FFFF.<br>
<br>
<b>CHR Bank Size Config</b><br>
Like the PRG the CHR bank size can be configured to either 4KB or 8KB banks.  With 8KB banks the whole $0000-1FFF range is one bank.  With 4KB banks there are two banks at PPU $0000-0FFF and $1000-1FFF.  This can be used with background in one bank and sprites in another.  Then, for example, all sprites could be swapped and the background could stay.<br>
<br>
<br><span class="Apple-style-span" style="font-size: medium; "><b>
CHR Bank 0 Register at $A000-BFFF</b></span><br>
This is the register for CHR bank 0.  To set it do 5 writes to the $A000-BFFF range.  When in 4KB CHR mode it selects a bank for PPU $0000-0FFF. The full 5 bit value is used so there are 32 possible banks.  Each bank is 4KB making it 128KB CHR maximum.  When in 8KB CHR mode this register controls the full PPU $0000-1FFF.  The bottom bit is ignored so there are 16 possible banks.  Each bank is now 8KB which is still 128KB max.<br>
<br><div><table style="width: 75%; " align="center" border="1"><tbody><tr><td width="50%"><b>4KB mode</b></td><td width="50%"><b>8KB mode</b></td></tr><tr><td>controls $0000-0FFF</td><td>controls $0000-1FFF<br>bottom bit is ignored</td></tr></tbody></table><br>
<span class="Apple-style-span" style="font-size: medium; "><b><br></b></span></div><div><span class="Apple-style-span" style="font-size: medium; "><b>CHR Bank 1 Register at $C000-DFFF</b></span><br>
This is the register for CHR bank 1.  To set it do 5 writes to the $C000-DFFF range.  When in 4KB CHR mode it selects a bank for PPU $1000-1FFF.  When in 8KB CHR mode it is completely ignored.<br><br></div><div><table style="width: 75%; " align="center" border="1"><tbody><tr><td width="50%"><b>4KB mode</b></td><td width="50%"><b>8KB mode</b></td></tr><tr><td>controls $1000-1FFF</td><td>register ignored</td></tr></tbody></table><br><br><br><br>
<br><span class="Apple-style-span" style="font-size: medium; "><b>
PRG Bank Register at $E000-FFFF</b></span><br>
This is the register for PRG banking.  To set it do 5 writes to the $E000-FFFF range.  The bits are:<br>
<br><pre>  43210
  -----
  WPPPP
  |||||
  |++++- Select a PRG ROM bank (low bit ignored in 32 KB mode)
  +----- WRAM chip enable (0: enabled; 1: disabled)</pre>
<br>
In 16KB PRG mode it selects a 16KB PRG bank for the current swappable address range.  Only the 4 lower bits are used for 16 possible PRG banks.  That is 256KB maximum. In 32KB PRG mode it selects a 32KB bank for the $8000-FFFF range.  Only bits 3-1 are used for 8 possible banks.  Bit 0 is ignored.&#xA0;</div><div><br></div><div><table style="width: 75%; " align="center" border="1"><tbody><tr><td width="33%"><b>16KB mode</b><br>swap=0</td><td width="33%"><b>16KB mode</b><br>swap=1</td><td width="33%"><b>32KB mode</b></td></tr><tr><td>controls $C000-FFFF</td><td>controls $8000-BFFF (default setting)</td><td>controls $8000-FFFF<br>low bit ignored</td></tr></tbody></table><br>
<b><br></b></div><div><b>WRAM</b><br>
Bit 5 of the PRG Bank register also controls WRAM access.  Clear this bit to enable WRAM access.  Setting the bit to 1 disables the WRAM.  If the WRAM is used for saved games it is usually disabled when it is not being accessed to prevent unwanted writes from corrupting the saves when the console is reset.<br>
<br>
To use WRAM in your program nothing needs to be changed in the iNES header.  The emulator will assume there is WRAM based on the mapper number.  Next you need to enable the WRAM in the PRG Bank register.  With that bit at 0 you can now use the WRAM.  It is just plain RAM that you can read or write at the $6000-7FFF range.  Like the console RAM the contents are unknown when the console is powered on.  All RAM is cleared to unknown values when power is removed.  However the RAM is not cleared when just the reset button is pushed.  Power is still going to the cart so the RAM is still valid.  This can be useful for telling if the console was just turned on or was only reset.<br>
<br>
To add a battery to the WRAM, set the .inesmir directive to 2 in the iNES header.  Now read and write to the WRAM normally.  When power is removed the RAM contents will remain.  The emulator will create an 8KB .sav file for the WRAM, however some emulators will not do this unless you have done some WRAM access.<br>
<br>
<br>
<span class="Apple-style-span" style="font-size: medium; "><b>Banking Routines</b></span><br>
Keeping track of all the register addresses and bits can get confusing, so a few simple routines are used instead.  In general subroutines should be used for even simple bank switching so the mapper can be changed more easily later.  Only the most commonly used Config and PRG Bank register routines are shown here, it is your job to write the others.<br>
<br><pre>ConfigWrite:        ; make sure this is in a fixed PRG bank so the RTS doesn&apos;t get swapped away
  LDA #$80
  STA $8000         ; reset the shift register
  LDA #%00001110    ; 8KB CHR, 16KB PRG, $8000-BFFF swappable, vertical mirroring
  STA $8000         ; first data bit
  LSR A             ; shift to next bit
  STA $8000         ; second data bit
  LSR A             ; etc
  STA $8000
  LSR A
  STA $8000
  LSR A
  STA $8000         ; config bits written here, takes effect immediately
  RTS<br><br>PRGBankWrite:       ; make sure this is in a fixed bank so it doesnt get swapped away
  LDA bankNumber    ; get bank number into A
  STA $E000         ; first data bit
  LSR A             ; shift to next bit
  STA $E000
  LSR A
  STA $E000
  LSR A
  STA $E000
  LSR A
  STA $E000         ; bank switch happens immediately here
  RTS</pre>
<br><span class="Apple-style-span" style="font-size: medium; "><b>
Putting It All Together</b></span><br>
Download and unzip the <a href="scraper/files/cyoammc1.zip" target="_blank" original-href="http://www.nespowerpak.com/nesasm/cyoammc1.zip">cyoammc1.zip</a> sample files.  The CYOA code has been changed to the MMC1 mapper.  Running the cyoammc1.bat file will create cyoammc1.nes, which will run in an emulator.  This sample uses 8KB of CHR RAM so no CHR banking has been included.  The changes from UNROM PRG mapping are minimal.  Some of the variables have been moved to the WRAM area to show how to use it.  An example of using WRAM to detect reset is also included in resetCount.  Try changing the battery info in the iNES header to see how it makes resetCount change between power and resets.<br><br><br><br><br><br></div>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#advanced_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;advanced_tutorial-1__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33260" target="_blank">
                                来源网页
                            </a>
                        </div>

                    </div>
                </div>
                <div class="comments" style="display: none;" id="advanced_tutorial-1__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-1__1">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				May 15, 2010 at 3:08:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Our Nerdy Nights Master Returns!!!  Just wondering, is the scrolling tutorial mentioned in previous Nerdy Nights still in the works?  *edit* maybe it wasn&apos;t mentioned as I can&apos;t seem to find it, but there have been a few requests.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-1__2">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 16, 2010 at 12:03:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is pretty cool.  Thanks for the info.  For some reason, on my computer here, it looks like all of your paragraphs are in one line of text and you have to scroll way right off the screen to read the whole thing.  Is that a setting I have messed up?
<br>
<br>Any chance of expanding this to include SUROM?  I&apos;ve made it work, but it is not pretty.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-1__3">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 16, 2010 at 1:45:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br>This is pretty cool.  Thanks for the info.  For some reason, on my computer here, it looks like all of your paragraphs are in one line of text and you have to scroll way right off the screen to read the whole thing.  Is that a setting I have messed up?
<br>
<br>Any chance of expanding this to include SUROM?  I&apos;ve made it work, but it is not pretty.</div><br>Not sure about the formatting, blame Dain! &#xA0;Maybe it needs more P or DIV tags...
<div><br></div><div><span class="Apple-style-span" style="font-size: medium; "><b>PRG/WRAM Expansions</b></span></div><div>Ok, when I gave the max sizes above I lied! &#xA0;There are three boards that offer various expansion sizes. &#xA0;All of them use CHR RAM then steal CHR address bits to be used for PRG banks.</div><div><br></div><div><b><span class="Apple-style-span" style="font-size: small; ">SUROM</span></b></div><div>This board is used by DW3 and DW4. &#xA0;It uses 8KB of CHR RAM and the games set the CHR bank size to 8KB. &#xA0;That means neither CHR bank register is used for CHR, because there is only one bank. &#xA0;Instead the top bit of the CHR bank register (D4) becomes an additional top bit of the PRG Bank. &#xA0;That gives you 5 bank bits for 32 banks of 16KB, or 512KB of PRG ROM. &#xA0;Clearing the CHR bank D4 accesses the first 16 banks, and setting it accesses the second 16 banks.</div><div><br></div><div>In 8KB CHR mode the CHR bank 1 register is still ignored, so you only have to set CHR bank 0. &#xA0;However in 4KB CHR mode you have to set D4 in both registers the same or else the PRG will be swapping while the screen is being rendered without you controlling it. &#xA0;When the PPU switches between background and sprites your PRG would also switch.</div><div><br></div><div>Typically you will want to use 16KB PRG mode and keep all your bank switching code in the last bank. &#xA0;Doing the PRG switch happens in 2 steps (CHR bank register and PRG bank register) and you don&apos;t want the first step to switch away your code. &#xA0;The other method is to copy your bank switching code to RAM and execute it there.</div><div><br></div><div><b><span class="Apple-style-span" style="font-size: small; ">SOROM</span></b></div><div>This board is used by Genghis Khan, Nobunaga, and a few other games. &#xA0;The same idea of stealing unused CHR bits is used to expand the WRAM to 16KB. &#xA0;This time the fourth bit of the CHR Bank register (D3) becomes the WRAM bank select. &#xA0;Clear the bit to select the lower 8KB of WRAM for the $6000-7FFF range, and set the bit to select the upper 8KB. &#xA0;The board uses two physically separate chips and only one is battery backed, so only one of the 8KB banks is battery backed.</div><div><br></div><div>Like with SUROM when using 4KB mode you need to set D3 the same in both CHR registers.</div><div><br></div><div><b><span class="Apple-style-span" style="font-size: small; ">SXROM</span></b></div><div>This board is only used in a couple Japanese games like Final Fantasy 1+2. &#xA0;It is a combination of SUROM and SOROM to expand both PRG ROM and WRAM. &#xA0;Makes sense when they pack two games on one cart that each need half those specs! &#xA0;Unlike SOROM there is only one physical WRAM chip so all 16KB is battery backed.</div><div><br></div><div>D4 still picks upper or lower 256KB PRG, and D3 still picks upper or lower 8KB WRAM.</div><div><br></div><div>If someone wanted to wire up a custom board, D2 and D1 could be used in the same way for even more PRG.</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-1__4">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 17, 2010 at 7:45:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><div><br></div><div><b><span class="Apple-style-span" style="FONT-SIZE: small">SUROM</span></b></div><div>This board is used by DW3 and DW4. &#xA0;It uses 8KB of CHR RAM and the games set the CHR bank size to 8KB. &#xA0;That means neither CHR bank register is used for CHR, because there is only one bank. &#xA0;Instead the top bit of the CHR bank register (D4) becomes an additional top bit of the PRG Bank. &#xA0;That gives you 5 bank bits for 32 banks of 16KB, or 512KB of PRG ROM. &#xA0;Clearing the CHR bank D4 accesses the first 16 banks, and setting it accesses the second 16 banks.</div><div><br></div><div>In 8KB CHR mode the CHR bank 1 register is still ignored, so you only have to set CHR bank 0. &#xA0;However in 4KB CHR mode you have to set D4 in both registers the same or else the PRG will be swapping while the screen is being rendered without you controlling it. &#xA0;When the PPU switches between background and sprites your PRG would also switch.</div><div><br></div><div>Typically you will want to use 16KB PRG mode and keep all your bank switching code in the last bank. &#xA0;Doing the PRG switch happens in 2 steps (CHR bank register and PRG bank register) and you don&apos;t want the first step to switch away your code. &#xA0;The other method is to copy your bank switching code to RAM and execute it there.</div></div><p>So, here you&apos;re saying that your &quot;dominate&quot; bank would have to be exactly the same in each 16 bank set if you were to do it the first way you mentioned?&#xA0; This would keep your addresses all in line.&#xA0; Correct?</p><p>The second method sounds somewhat more efficent, right?&#xA0; I appoligize for being thick here, but I really can&apos;t wrap my head around how you would do that.&#xA0; <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-tongue.gif" show-src="images/blank.gif">&#xA0; And here wouldn&apos;t you have to have reset code in the second set of banks to at least switch to the first one as it could load any random bank during start up?&#xA0; Don&apos;t suppose you have a quick example of this?&#xA0; At least the bank switching via RAM part?</p><p>Thank you for the help.<br><br><br></p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-1__5">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jul 1, 2014 at 7:09:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Seems like &quot;advanced&quot; bankswitching is not that hard to pull off. This might be interesting for the Mystique multicart I&apos;d like to make at some point!<br>
However, MMC1 stuff is still kinda new to me, and before trying to program my own MMC1 program, I&apos;d like you to clarify a few things for me.<br>
<br>
What I understand about the shift register use is that only the first bit is used (Kind of like the controller). You have to do an LSR to get the previous bits to this particular bit<br>
(Ex: 0001001[1] C0 - Only the byte in the brackets is read, then as you LSR, the bytes you wanna read go to the right, like this - 0000100[1] C1)<br>
Also, if I wrote this to the config at $8000, it should be 1 - two 4KB CHR banks, 0 - 32 KB PRG switch at once, 0-Not used due to 32KB swap, 11-Horizontal Mirroring<br>
Is that how it works?<br>
<br>
However, I don&apos;t really understand why you have to write to the registers in $XXXX-$YYYY ranges... Aren&apos;t those ranges used for the PRG? Thanks for enlightening me on that <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-1__6">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jul 2, 2014 at 8:59:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	What I understand about the shift register use is that only the first bit is used (Kind of like the controller). You have to do an LSR to get the previous bits to this particular bit<br>
	(Ex: 0001001[1] C0 - Only the byte in the brackets is read, then as you LSR, the bytes you wanna read go to the right, like this - 0000100[1] C1)<br>
	Also, if I wrote this to the config at $8000, it should be 1 - two 4KB CHR banks, 0 - 32 KB PRG switch at once, 0-Not used due to 32KB swap, 11-Horizontal Mirroring<br>
	Is that how it works?</div>
That&apos;s correct.<br>
<br>
<div class="FTQUOTE" "width: 794.390625px;">
	<i>Originally posted by:&#xA0;<b>Vectrex280996</b></i><br>
	<br>
	However, I don&apos;t really understand why you have to write to the registers in $XXXX-$YYYY ranges... Aren&apos;t those ranges used for the PRG? Thanks for enlightening me on that</div>
The $8000-FFFF range is used for PRG yeah, but since it&apos;s ROM the writes to the same area can be reused by mappers for their own purposes. So &quot;why&quot; is not really the right question to ask here, it just is the way it is.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-1__7">
                                                        <div class="mdl-card__title"><strong>splitpane</strong> posted on 
		
			
				
				Nov 23, 2015 at 8:50:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					First of all, thanks a lot, BunnyBoy, for these tutorials.  I&apos;ve learned a lot and made it all the way through in a couple of weeks, and have managed to get a lot of key parts of my game working as proof of concept code already.  But now I&apos;ve been working through the example in this lesson and trying to figure out CHR RAM, but not having a lot of luck.  I&apos;m looking to use CHR RAM to draw custom tiles.  The example program here is all about loading a lot of text (and from the .ineschr 0 at the beginning I guess doesn&apos;t even use CHR RAM) but I&apos;m trying to figure out how to just draw some pixels.  I changed the first two lines, removed the text file loading, and started removing a lot of the text printing code, but I am having trouble seeing clearly what is the core of the CHR RAM code.  Let&apos;s say I want to do nothing but update a few tiles of background with some random pixels.  Can anybody point me toward a minimal sample?  Or suggest what the minimal steps would be?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-1__8">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 24, 2015 at 10:16:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>splitpane</b></i><br>
<br>
First of all, thanks a lot, BunnyBoy, for these tutorials. I&apos;ve learned a lot and made it all the way through in a couple of weeks, and have managed to get a lot of key parts of my game working as proof of concept code already. But now I&apos;ve been working through the example in this lesson and trying to figure out CHR RAM, but not having a lot of luck. I&apos;m looking to use CHR RAM to draw custom tiles. The example program here is all about loading a lot of text (and from the .ineschr 0 at the beginning I guess doesn&apos;t even use CHR RAM) but I&apos;m trying to figure out how to just draw some pixels. I changed the first two lines, removed the text file loading, and started removing a lot of the text printing code, but I am having trouble seeing clearly what is the core of the CHR RAM code. Let&apos;s say I want to do nothing but update a few tiles of background with some random pixels. Can anybody point me toward a minimal sample? Or suggest what the minimal steps would be?</div>
<br>
.ineschr 0 just means that you are not using CHR ROM. <strong>&quot;This sample uses 8KB of CHR RAM so no CHR banking has been included.&quot;</strong><br>
<br>
Here is the CHR RAM loading subroutine in the tutorial. Really, it&apos;s not much different than what we did before, you are just reading the .chr file (or in the tutorials case, the graphics.nes file) and loading it into the CHRRAM area on the PPU. I literally just went through this tutorial Sunday night so I could prep my game to flash to my my UNROM flash board. As for answering your question on how to load the screen with random pixels, about the only think I can think of is to use a Pointer Table with the tiles you want to use and a random number generator subroutine to select tiles from the table at random and then write them to the screen. Maybe I&apos;m wrong on this though.<br>
<br>
<strong>GRAPHICS TILES AND SPRITES STORED IN BANK 14</strong><br>
.bank 14<br>
&#xA0; .org $C000&#xA0;&#xA0; ;;8KB graphics in this fixed bank<br>
Graphics:<br>
&#xA0; .incbin &quot;graphics.nes&quot;<br>
&#xA0; .incbin &quot;graphics.nes&quot;<br>
<br>
<strong>CODE TO LOAD PPU WITH CHRRAM</strong><br>
LoadCHRRAM:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;;copies 8KB of graphics from PRG to CHR RAM<br>
&#xA0; lda $2002<br>
&#xA0; lda #$00<br>
&#xA0; sta $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;set PPU to the CHR RAM area $0000-1FFF<br>
&#xA0; sta $2006<br>
&#xA0; ldy #$00<br>
&#xA0; ldx #$20&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;32 x 256 bytes = 8 KB<br>
&#xA0; lda #LOW(Graphics)<br>
&#xA0; sta sourceLo<br>
&#xA0; lda #HIGH(Graphics)&#xA0; ;get the address of the graphics data ($C000)<br>
&#xA0; sta sourceHi&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;put into our source pointer<br>
LoadCHRRamLoop:<br>
&#xA0; lda [sourceLo], y&#xA0;&#xA0;&#xA0; ;copy from source pointer<br>
&#xA0; sta $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;to PPU CHR RAM area<br>
&#xA0; iny<br>
&#xA0; bne LoadCHRRamLoop&#xA0;&#xA0; ;;loop 256 times<br>
&#xA0; inc sourceHi&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;;then increment the high address byte<br>
&#xA0; dex&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;;do that 32 times<br>
&#xA0; bne LoadCHRRamLoop&#xA0;&#xA0; ;;32 x 256 = 8KB<br>
LoadCHRRamDone:<br>
&#xA0; rts<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-1__9">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				May 19 at 9:51:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Was looking back at this thread recently, as I&apos;m working on a new game with WRAM. Curious to know why the resetSignature is two bytes instead of one. Seems like it could even be a bit flag. Anyone want to hazard a guess?
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                            
                <div class="tutorialCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">3: 水平背景滚动</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b>This Week:&#xA0;</b>Time to learn how to do horizontal background scrolling, like Super Mario Bros.  Hopefully it is explained with the most easy to understand code.  There is no compression, no buffers, and no metatiles, so only the ideas of scrolling are presented.  Once you understand the scrolling part you should look into those other topics to save code/data space and increase performance if needed.
<br>  <br><br><br><span class="Apple-style-span" style="font-size: medium; "><b>Nametable Review</b></span><br>
Before starting the scrolling you must fully understand how nametables work.  One nametable is 32x30 background tiles, which covers exactly one visible screen.  Including the attribute table, each screen needs 1KB of PPU RAM.  The NES PPU has the address space for 4 nametables ($2000, $2400, $2800, $2C00) in a 2x2 grid:<br>
<pre>       +-----------+-----------+
       |           |           |
       |           |           |
       |   $2000   |   $2400   |
       |           |           |
       |           |           |
       +-----------+-----------+
       |           |           |
       |           |           |
       |   $2800   |   $2C00   |
       |           |           |
       |           |           |
       +-----------+-----------+</pre>
     
However the NES only has 2KB of PPU RAM inside the console, so there are only two actual nametables.  The other two nametables are copies of those actual ones.  Your mirroring settings determine the layout of the actual nametables and which ones are copies. <br>
  <br>
Vertical mirroring means the nametables stacked vertically are the same data.  0 ($2000) is a mirror of 2 ($2800), and 1 ($2400) is a mirror of 3 ($2C00).  0 and 1 are next to each other and have different data.  This is what we want for horizontal scrolling.  When you are looking at nametable 0 and scroll to the right, nametable 1 will be in view.  Typically your mirroring setting is the opposite of the scrolling direction.  To set the iNES header:<br>
<pre>  .inesmir 1  ;;VERT mirroring for HORIZ scrolling</pre>
 <br>
<span class="Apple-style-span" style="font-size: medium; "><b>Scroll registers</b></span><br>
Before scrolling we will fill both nametables 0 ($2000) and 1 ($2400).  The same data will be copied into both, except the attribute table will be different.  By setting the second nametable attributes to another color palette the two screens will have a very visible difference.<br>
<pre>FillNametables:
  LDA $2002             ; read PPU status to reset the high/low latch
  LDA #$20
  STA $2006             ; write the high byte of $2000 address (nametable 0)
  LDA #$00
  STA $2006             ; write the low byte of $2000 address
  LDY #$08
  LDX #$00              ; fill 256 x 8 bytes = 2KB, both nametables all full
  LDA #$7F
FillNametablesLoop:
  STA $2007
  DEX
  BNE FillNametablesLoop
  DEY
  BNE FillNametablesLoop</pre>
<pre>FillAttrib0:
  LDA $2002             ; read PPU status to reset the high/low latch
  LDA #$23
  STA $2006             ; write the high byte of $23C0 address (nametable 0 attributes)
  LDA #$C0
  STA $2006             ; write the low byte of $23C0 address
  LDX #$40              ; fill 64 bytes
  LDA #$00              ; palette group 0
FillAttrib0Loop:
  STA $2007
  DEX
  BNE FillAttrib0Loop</pre>
<pre>FillAttrib1:
  LDA $2002             ; read PPU status to reset the high/low latch
  LDA #$27
  STA $2006             ; write the high byte of $27C0 address (nametable 1 attributes)
  LDA #$C0
  STA $2006             ; write the low byte of $27C0 address
  LDX #$40              ; fill 64 bytes
  LDA #$FF              ; palette group 3
FillAttrib1Loop:
  STA $2007
  DEX
  BNE FillAttrib1Loop</pre>
The scroll registers are at $2005.  Like some other PPU registers you need to write to it twice.  The first write is the horizontal scroll count, the second write is the vertical scroll count.  The scroll sets which pixel of the nametable for the start of the left side of the screen.  Previously we have set the scroll to 0 so the left side of the screen is aligned with the left edge of the nametable.  The scroll registers are both 8 bit registers, making the scroll range 0 to 255.  The screen is 256 pixels wide so the horizontal scroll register covers one full screen wide.<br>
<br>
This sample code just increments the horizontal scroll register ($2005) by 1 on every frame.  You can see when the first nametable scrolls off the screen, the second one comes on screen.  The previously set colors make the split between nametables obvious.  As the scroll register wraps from 255 to 0 the first nametable becomes completely visible again.  You can also see the sprites are not affected by the scroll registers.  They have their own separate x and y position data.<br>
<pre>NMI:
  LDA #$00
  STA $2003       
  LDA #$02
  STA $4014       ; sprite DMA from $0200
  
  ; run other game graphics updating code here
  
  LDA #$00
  STA $2006        ; clean up PPU address registers
  STA $2006<br><br>  INC scroll       ; add one to our scroll variable each frame
  LDA scroll
  STA $2005        ; write the horizontal scroll count register<br><br>  LDA #$00         ; no vertical scrolling
  STA $2005
    
  ;;This is the PPU clean up section, so rendering the next frame starts properly.
  LDA #%10010000   ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1
  STA $2000
  LDA #%00011110   ; enable sprites, enable background, no clipping on left side
  STA $2001<br><br>  ; run normal game engine code here
  ; reading from controllers, etc
  
  RTI              ; return from interrupt</pre><br>
The full code and compiled .NES file is available from the download link at the bottom of this tutorial.  scrolling1.asm includes everything up to this point.
<br><br><br>
<span class="Apple-style-span" style="font-size: medium; "><b>Nametable Register</b></span><br>
The problem with just the scroll register is that it isn&apos;t big enough.  In the previous example the scroll wrapped from 255 to 0, so the second nametable is never shown on the left side.  Both nametables together is 512 pixels wide but the scroll can only count 256 pixels.  The solution is to switch which nametable is on the left side of the screen at the same time the scroll register wraps to 0.<br>
<br>
<img src original-src="http://www.nespowerpak.com/nesasm/ntA.png" show-src="scraper/images/ntA.png"><br>
Vertical mirroring means nametables are arranged horizontally<br>
<br>
<img src original-src="http://www.nespowerpak.com/nesasm/ntB.png" show-src="scraper/images/ntB.png"><br>
Scrolling shows nametable 0 and 1 (blue) on the screen (red)<br>
<br>
<img src original-src="http://www.nespowerpak.com/nesasm/ntC.png" show-src="scraper/images/ntC.png"><br>
When the scroll register wraps, nametable 0 is displayed again<br>
<br>
<img src original-src="http://www.nespowerpak.com/nesasm/ntD.png" show-src="scraper/images/ntD.png"><br>
Swap which nametable is on the left when the wrap happens to display nametable 1<br>
<br>
<br>
To set the starting nametable, change bit 0 of the PPU control register at $2000.  Clearing it to 0 will put nametables 0 and 2 on the left side of the screen with 1 and 3 to the right.  Setting it to 1 will put 1 and 3 on the left, and 0 and 2 on the right.<br>
<br>
This sample code has the same scroll incrementing, but swaps the nametables at the same time the scroll wraps from 255 to 0.  Instead of the background jumping it continuously scrolls from one nametable to the next.  When the scroll wraps again the nametables are swapped again and the scrolling keeps going.<br>
<pre>NMI:<br><br>  INC scroll       ; add one to our scroll variable each frame
NTSwapCheck:
  LDA scroll       ; check if the scroll just wrapped from 255 to 0
  BNE NTSwapCheckDone
  
NTSwap:
  LDA nametable    ; load current nametable number (0 or 1)
  EOR #$01         ; exclusive OR of bit 0 will flip that bit
  STA nametable    ; so if nametable was 0, now 1
                   ;    if nametable was 1, now 0
NTSwapCheckDone:<br><br>  LDA #$00
  STA $2003       
  LDA #$02
  STA $4014       ; sprite DMA from $0200
  
  ; run other game graphics updating code here<br><br>  LDA #$00
  STA $2006        ; clean up PPU address registers
  STA $2006
  
  LDA scroll
  STA $2005        ; write the horizontal scroll count register<br><br>  LDA #$00         ; no vertical scrolling
  STA $2005
    
  ;;This is the PPU clean up section, so rendering the next frame starts properly.
  LDA #%10010000   ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1
  ORA nametable    ; select correct nametable for bit 0
  STA $2000
  
  LDA #%00011110   ; enable sprites, enable background, no clipping on left side
  STA $2001
    
  ; run normal game engine code here
  ; reading from controllers, etc
  
  RTI              ; return from interrupt</pre>
<br>
The full code and compiled .NES file is available from the download link at the bottom of this tutorial.  scrolling2.asm includes everything up to this point.<br><br><br>
<span class="Apple-style-span" style="font-size: medium; "><b>Drawing New Columns</b></span><br>
For just two screens of graphics the code above is fine.  Games like Super Dodgeball use this method.  Both nametables are filled and scrolled between.  For games like SMB where the levels are wider than two screens some new background data will have to be inserted.  The solution is to draw a new vertical column of tiles somewhere off the visible screen, before it is scrolled into the visible area.  As long as the new column is drawn ahead of the visible area, calculated by the current scroll and nametable, it will appear continuous.  The tricky part is figuring out which column to draw, and where it is to be placed.  If we always use the opposite nametable and the same scroll point we will be drawing the column that is about to come on screen.<br>
<br>
<img src original-src="http://www.nespowerpak.com/nesasm/ntE.png" show-src="scraper/images/ntE.png"><br>
<br><br>
&gt;<b>When to Draw</b><br>
We will draw a new column anytime the scroll register becomes a multiple of 8, meaning the scroll is aligned to the tiles.  Some bit masking and testing can calculate when this happens.  First any part of the scroll not 0 to 7 is thrown away.  Then if the result equals 0 the scroll count is a multiple of 8.<br>
<pre>  LDA scroll
  AND #%00000111     ; throw away higher bits
  BEQ DrawNewColumn  ; see if lower bits = 0</pre>
<br>
<b>Where to Draw</b><br>
Now that we know when to draw, we need to calculate the starting PPU address of the new column.  The scroll register counts in pixels, but we want to count in tiles for which column to draw.  Each tile is 8 pixels wide, so we divide the scroll by 8 to get the tile number.  That number is the low bits of the address.<br><br><br><pre>  LDA scroll
  LSR A
  LSR A
  LSR A            ; shift right 3 times = divide by 8
  STA columnLow    ; $00 to $1F, screen is 32 tiles wide</pre>
The high bits of the address will come from the current nametable.  First the low bit is inverted, to get the off screen nametable number.  Then the number is shifted up and added to the base address.<br>
<pre>  LDA nametable
  EOR #$01          ; invert low bit, A = $00 or $01
  ASL A             ; shift up, A = $00 or $02
  ASL A             ; $00 or $04
  CLC
  ADC #$20          ; add high byte of nametable base address ($2000)
  STA columnHigh    ; now address = $20 or $24 for nametable 0 or 1</pre>
Now the scroll count and nametable have been used to make the full column address to start copying new background data.  It will be at the top of the nametable that is off screen.  As the scroll and nametable are changed, that calculation will still give the correct starting address.<br>
<br>
<b>How to Draw</b><br>
Previously when we have been copying data to the background the PPU is set to auto increment the address by 1.  That helps with the copying because a whole row of data can be copied while only writing the PPU address once.  Incrementing by 1 goes to the next horizontal tile.  In this case we want to go to the next vertical tile because we are copying a column instead of a row.  We want it to increment by 32 which will jump down instead of across.  There are 32 tiles per row, so adding 32 will always go down to the next row in the same column.  The PPU has an increment 32 mode, set using bit 2 in the PPU control register at $2000.  When bit 2 is set to 0 the increment mode is +1.  When bit 2 is set to 1 the increment mode is +32.  By setting the increment mode to +32 and copying 30 bytes of background tiles we can draw one column at a time. <br>
<pre>DrawColumn:
  LDA #%00000100        ; set to increment +32 mode, don&apos;t care about other bits
  STA $2000
  
  LDA $2002             ; read PPU status to reset the high/low latch
  LDA columnHigh
  STA $2006             ; write the high byte of column address
  LDA columnLow
  STA $2006             ; write the low byte of column address
  LDX #$1E              ; copy 30 bytes
  LDY #$00
DrawColumnLoop:
  LDA columnData, y
  STA $2007
  INY
  DEX
  BNE DrawColumnLoop</pre><br>
By using the when/where/how we can draw a new column of data off screen before it becomes visible.  The full code and compiled .NES file is available from the download link at the bottom of this tutorial.  scrolling3.asm includes everything up to this point.  It will be best to watch in an emulator where you can see everything that is off screen.  First open the scrolling3.nes file in the FCEUXDSP emulator.  Then choose &quot;Name Table Viewer...&quot; from the &quot;Tools&quot; menu.  Reset the emulator and watch the new columns being drawn off the visible screen area.  <br><br>
<br>
<b>Drawing Real Background Data</b><br>
The last example drew new columns, but it wasn&apos;t any real data.  This example adds another counter to keep track of how far along into the level a player is.  By incrementing this counter every time a new column is drawn the correct next column is easy to find.  The DrawNewColumn function has been updated to use the counter to load real background data.  It can also be used at the beginning of the game initialization to populate the starting nametable data instead of using the fill loops.<br>
<br>
The full code and compiled .NES file is available from the download link at the bottom of this tutorial.  scrolling4.asm includes 4 screens (128 columns) of real background ripped from SMB.
<br><br><br>
<span class="Apple-style-span" style="font-size: medium; "><b>Updating the Attributes</b></span><br>
The final piece of the scrolling puzzle is the attribute table.  Updating it is the same process as the background, where the attributes are updated while they are off screen.  Again the scroll and nametable registers will be used to calculate the correct attribute bytes to update.  Each attribute byte covers a 4x4 tile area.  4 tiles wide is 32 pixels, so the attributes must be updated anytime the scroll register is a multiple of 32.  The column numbers already calculated could be used instead of the scroll variables to do the calculations.<br>
<pre>  LDA scroll
  AND #%00011111     ; check for multiple of 32
  BEQ NewAttrib      ; if low 5 bits = 0, time to write new attribute bytes</pre>
Only 8 attribute bytes will need to be changed each time.  However they are not sequential, so the PPU increment +1 or +32 modes will not work.  The PPU address needs to be changed for every attribute byte updated.  The starting address is the base attribute table at $20C0.  Like the background address the nametable bit is shifted up and added in.  Then the scroll register is divided by 32 to get the attribute byte offset.  All that is calculated together to find the PPU address of the first attribute byte.  After that 8 is added to the address for each of the next bytes.<br>
<pre>  LDA nametable
  EOR #$01          ; invert low bit, A = $00 or $01
  ASL A             ; shift up, A = $00 or $02
  ASL A             ; $00 or $04
  CLC
  ADC #$20          ; add high byte of attribute base address ($20C0)
  STA columnHigh    ; now address = $20 or $24 for nametable 0 or 1
  
  LDA scroll
  LSR A
  LSR A
  LSR A
  LSR A
  LSR A
  CLC
  ADC #$C0
  STA columnLow     ; attribute base + scroll / 32</pre>
The full code and compiled .NES file is available from the download link at the bottom of this tutorial.  scrolling5.asm has the same incrementing scroll, but now draws the new column and attribute bytes.  Use the Name Table Viewer again to check out the attributes being updated.  You can see the attribute update change the color of the off screen clouds before that column of tiles is changed.  The same thing is why you see graphical glitches on the sides of SMB3 while it is scrolling.  To use this in your own game you will need to expand columnNumber to a bigger value.<br><br><br><span class="Apple-style-span" style="font-size: medium; "><badvanced></badvanced></span><br>
Once you have understood everything here, there are some more advanced concepts to check out:<br>
<br>
<b>Meta Tiles</b> - This idea is to store your backgrounds as bigger blocks instead of individual tiles.  Things like the question blocks would be stored as one byte in the ROM and then decoded into the 4 tiles when it is being drawn.  Mostly this saves huge amounts of data space and could make updating attributes easier.<br>
<br>
<b>Buffers</b> - A section of RAM can be reserved to act as a buffer for the data to draw to the PPU later.  Outside of vblank where the is more processing time the next graphics updates would be calculated and stored in a buffer.  Then during vblank those buffers can be dumped right to the PPU, saving time.  <br>
<br>
<b>Compression</b> - Packing the background data into simple compression formats like RLE can save even more data space.  Combine that with meta tiles and buffers to have a full scrolling engine.
<br>
<br>
<span class="Apple-style-span" style="font-size: medium; "><b>Putting It All Together</b></span><br>
Download and unzip the <a href="scraper/files/scrolling.zip" target="_blank" original-href="http://www.nespowerpak.com/nesasm/scrolling.zip">scrolling.zip</a> sample files.  Each of them adds a small step, so go through them one at a time.  Try expanding the background data to add more columns, making the scroll speed variable, or making the scrolling controlable.
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#advanced_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;advanced_tutorial-2__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36958" target="_blank">
                                来源网页
                            </a>
                        </div>

                    </div>
                </div>
                <div class="comments" style="display: none;" id="advanced_tutorial-2__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__1">
                                                        <div class="mdl-card__title"><strong>JKeefe56</strong> posted on 
		
			
				
				Dec 15, 2011 at 11:40:32 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank you so much for these tutorials.  I still haven&apos;t gotten very far yet, but honestly probably would have given up by now if it weren&apos;t for these.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__2">
                                                        <div class="mdl-card__title"><strong>Arkonviox</strong> posted on 
		
			
				
				Jul 5, 2012 at 2:41:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I hate to bump this topic but I followed your tutorial exactly as shown but I&apos;m noticing the mirror you use is actually a horizontal mirror, with $2400 as the mirror and $2800 as nametable 2, I can&apos;t see what I did wrong that would cause this but it&apos;s driving me nuts.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__3">
                                                        <div class="mdl-card__title"><strong>Arkonviox</strong> posted on 
		
			
				
				Jul 5, 2012 at 3:24:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Nevermind, I got the mapper and mirror data reversed, I&apos;m using the Ophis assembler, same as P65.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__4">
                                                        <div class="mdl-card__title"><strong>HocusPocus</strong> posted on 
		
			
				
				Aug 26, 2013 at 8:27:39 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Going through this topic in an effort to learn to scroll some stuff <span class="sprites_emoticons absmiddle" id="emo_smile"></span> In the tutorial for scrolling 4 bunny incbin&apos;s a file called SMBlevel.bin which includes the column data which is being written. Can someone point out to me how to edit SMBlevel.bin?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__5">
                                                        <div class="mdl-card__title"><strong>dra600n</strong> posted on 
		
			
				
				Aug 26, 2013 at 8:32:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Probably a hex editor. I use XVI32 (it&apos;s free and very lightweight). Give that a shot. I&apos;m willing to bet that it&apos;s tile numbers for the data and drawn based on the number.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__6">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Aug 26, 2013 at 9:37:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>dra600n</b></i><br>
	<br>
	Probably a hex editor. I use XVI32 (it&apos;s free and very lightweight).</div>
HxD (free as well) is better, I highly recommend it.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__7">
                                                        <div class="mdl-card__title"><strong>dra600n</strong> posted on 
		
			
				
				Aug 26, 2013 at 9:39:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>dra600n</b></i><br>
		<br>
		Probably a hex editor. I use XVI32 (it&apos;s free and very lightweight).</div>
	HxD (free as well) is better, I highly recommend it.</div>
<br>
Nice. I&apos;ll have to check that out. Thanks!<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__8">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Feb 15, 2015 at 12:43:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m working with the scrolling2 file and attempting to rework it for vertical scrolling. I have set the mirroring, changed the third nametable and attribute addresses (2800 and 2BC0 respectively), and have made the following changes to the code below
<br>
<br>NMI:
<br>
<br>  INC scroll       ; add one to our scroll variable each frame
<br>NTSwapCheck:
<br>  LDA scroll       ; check if the scroll just wrapped from 255 to 0
<br>;  CMP #$EF        ; *A compare seems to be needed here, see question below
<br>  BNE NTSwapCheckDone
<br>  
<br>NTSwap:
<br>  LDA nametable          ; load current nametable number (0 or 1)
<br>  EOR #%00000010         ; exclusive OR of bit 0 will flip that bit
<br>                   ;*bit 1 selects nametable 2 (instead of nametable 1)
<br>  STA nametable    ; so if nametable was 0, now 2
<br>                   ;    if nametable was 2, now 0
<br>NTSwapCheckDone:
<br>
<br>  LDA #$00
<br>  STA $2003       
<br>  LDA #$02
<br>  STA $4014       ; sprite DMA from $0200
<br>  
<br>  ; run other game graphics updating code here
<br>
<br>  LDA #$00
<br>  STA $2006        ; clean up PPU address registers
<br>  STA $2006
<br>  
<br>  LDA #$00
<br>  STA $2005        ; write the horizontal scroll count register
<br>
<br>  LDA scroll       ; vertical scrolling
<br>  STA $2005
<br>    
<br>  ;;This is the PPU clean up section, so rendering the next frame starts properly.
<br>  LDA #%10010000   ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1
<br>  ORA nametable    ; select correct nametable for bit 0
<br>  STA $2000
<br>  
<br>  LDA #%00011110   ; enable sprites, enable background, no clipping on left side
<br>  STA $2001
<br>
<br>Everything works and scrolls smoothly, except that the screen jumps (or reloads?) between nametables. I am guessing that the section below needs to be changed to some sort of actual compare (vertical = 240 vs horizontal = 256 screen dimensions), but have not been able to figure out what exactly. I would have thought that #$EF/240 or #$E7/239 would have worked, but neither does. Any thoughts? Or I am missing a step when it comes to switching this up?
<br>
<br>  INC scroll       ; add one to our scroll variable each frame
<br>NTSwapCheck:
<br>  LDA scroll       ; check if the scroll just wrapped from 255 to 0
<br>  CMP #$__         ; *check to see if the scroll wrapped from 240 to 0
<br>  BNE NTSwapCheckDone
<br>  
<br>Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__9">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Feb 15, 2015 at 2:34:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	Or I am missing a step when it comes to switching this up?</div>
You need to manually reset the &quot;scroll&quot; variable to 0 when it becomes 240 (for the horizontal case it&apos;s automatically reset as it wraps 255-&gt;0).<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__10">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Feb 16, 2015 at 8:21:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
		<br>
		Or I am missing a step when it comes to switching this up?</div>
	You need to manually reset the &quot;scroll&quot; variable to 0 when it becomes 240 (for the horizontal case it&apos;s automatically reset as it wraps 255-&gt;0).<br>
	<br>
	&#xA0;</div>
<br>
Seamless! Thanks Kalle!<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__11">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Sep 28, 2015 at 11:35:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br>
<br>
<b>This Week:&#xA0;</b>Time to learn how to do <strong><em>horizontal </em></strong>background scrolling</div>
Any chance you wrote something about <strong><em>vertical </em></strong>scrolling?<br>
Since the screen is high only 240px vertically (rather than 256px), it is a bit more messy to find a solution.<br>
<br>
Of course, I can manage a solution, however I was just wondering how you would face the issue.<br>
<br>
Thanks! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__12">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Sep 28, 2015 at 11:37:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					^___ never mind, silly me. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
---
<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
<br>
You need to manually reset the &quot;scroll&quot; variable to 0 when it becomes 240 (for the horizontal case it&apos;s automatically reset as it wraps 255-&gt;0).</div>
So my solution is the common way to do it. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<strong>Edit</strong>: word changed
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__13">
                                                        <div class="mdl-card__title"><strong>FarruOne</strong> posted on 
		
			
				
				Dec 21, 2015 at 3:09:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi! I am new to NES developement and I find these tutorials truly valuable.<br>
I am trying to scroll on moving to the right, so I moved the code in the NMI block to the Right button one. However, when I move right, the game screws up and I don&apos;t know what I&apos;m doing wrong.<br>
<br>
My ASM code:&#xA0;<a href="http://pastebin.com/Zmv0H25A" target="_blank" original-href="http://pastebin.com/Zmv0H25A">http://pastebin.com/Zmv0H25A</a><br>
<br>
Edit: this problem is solved if I move the controller block right before the PPU clean up section, but then the background goes by fits and starts.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__14">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 22, 2015 at 9:10:18 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>FarruOne</b></i><br>
<br>
Hi! I am new to NES developement and I find these tutorials truly valuable.<br>
I am trying to scroll on moving to the right, so I moved the code in the NMI block to the Right button one. However, when I move right, the game screws up and I don&apos;t know what I&apos;m doing wrong.<br>
<br>
My ASM code:&#xA0;<a href="http://pastebin.com/Zmv0H25A" target="_blank" original-href="http://pastebin.com/Zmv0H25A">http://pastebin.com/Zmv0H25A</a><br>
<br>
Edit: this problem is solved if I move the controller block right before the PPU clean up section, but then the background goes by fits and starts.</div>
<br>
Welcome. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
845 lines of code are pretty time consuming to check out: do you have an idea about what the problem could be and which snippet of code to look for?<br>
<br>
Also, the way you check for inputs from the joypad is excellent to begin learning and understand how reading from the controllers works on a NES, but in the following nerdy nights chapters better alternatives, using subroutines, are explained.<br>
<br>
Such as:<br>
&#xA0;
<pre style="margin: 0px; font: 10px Monaco;"><span style="font-family:courier new,courier,monospace;"><span style="letter-spacing: 0px;">ReadController:</span><br><br><span style="letter-spacing: 0px;">  LDA #$01</span><br><br><span style="letter-spacing: 0px;">  STA $4016</span><br><br><span style="letter-spacing: 0px;">  LDA #$00</span><br><br><span style="letter-spacing: 0px;">  STA $4016</span><br><br><span style="letter-spacing: 0px;">  LDX #$08</span><br><br><span style="letter-spacing: 0px;">ReadControllerLoop:</span><br><br><span style="letter-spacing: 0px;">  LDA $4016</span><br><br><span style="letter-spacing: 0px;">  LSR A           ; bit0 -&gt; Carry</span><br><br><span style="letter-spacing: 0px;">  ROL buttons     ; bit0 &lt;- Carry</span><br><br><span style="letter-spacing: 0px;">  DEX</span><br><br><span style="letter-spacing: 0px;">  BNE ReadControllerLoop</span><br><br><span style="letter-spacing: 0px;">  RTS</span></span></pre><br><br><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0;</p>
&#xA0;<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8747" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8747">http://nintendoage.com/forum/mess...</a><br>
<br>
Once you fully understand the concept, this would make your code shorter, and your life easier. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__15">
                                                        <div class="mdl-card__title"><strong>FarruOne</strong> posted on 
		
			
				
				Dec 22, 2015 at 10:45:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The problem lies in the NMI, the PPU or both.
<br>
<br>I have just tried a different appeoach and it works fine: I have kept the scrolling code in the NMI but it is branched by a variable flag enabled when the right button is pressed.
<br>
<br>Anyway, I should get more familiar with the NMI mechanism...
<br>Thank you!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__16">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 22, 2015 at 12:29:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>FarruOne</b></i><br>
<br>
The problem lies in the NMI, the PPU or both.<br>
<br>
I have just tried a different appeoach and it works fine: I have kept the scrolling code in the NMI but it is branched by a variable flag enabled when the right button is pressed.<br>
<br>
Anyway, I should get more familiar with the NMI mechanism...<br>
Thank you!</div>
<br>
In case you did not read these two articles yet, give a look:<br>
<br>
&#xA0;<a href="http://wiki.nesdev.com/w/index.php/PPU_scrolling" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_scrolling">http://wiki.nesdev.com/w/index.ph...</a><br>
<br>
&#xA0;<a href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs">http://wiki.nesdev.com/w/index.ph...</a><br>
<br>
they can probably help you out. Also, I know there is a buggy behaviour about writing values to $2005 in some scenarios, but I can&apos;t find where such behaviour is explained, and my English and tech language I fear it is not good enough to explain it myself. I&apos;m sure someone else will point out this issue if needed to have your code working correctly.<br>
<br>
<strong>Edit</strong>: correction.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-2__17">
                                                        <div class="mdl-card__title"><strong>FarruOne</strong> posted on 
		
			
				
				Dec 22, 2015 at 1:39:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
<br>
In case you did not read these two articles yet, give a look:<br>
<br>
&#xA0;<a href="http://wiki.nesdev.com/w/index.php/PPU_scrolling" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_scrolling">http://wiki.nesdev.com/w/index.php/PPU_scrolling</a><br>
<br>
&#xA0;<a href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs">http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs</a><br>
&#xA0;</div>
<br>
I&apos;ll read them. Thanks!<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                            
                <div class="tutorialCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-3">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">4: 0号精灵固定在状态栏</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b>This Week:</b> After scrolling this tutorial should be pretty simple.  Sprite 0 has a special PPU flag associated with it.  Here it will be used to do split screen scrolling to enable a static status bar on the top of the screen.<br>  <br><br><br><span class="Apple-style-span" style="font-size: medium; "><b>Sprite 0 Hit Flag</b></span><br>
Sprite 0 has a special flag in the PPU status register at bit 6.  When a non transparent pixel of sprite 0 overlaps a non transparent pixel of the background, the flag is set.  In the SMB example, sprite 0 is placed at the bottom of the coin icon.  That is one part of the status bar that does not move.<div><br>
<img src original-src="http://www.nespowerpak.com/nesasm/sprite0.png" show-src="scraper/images/sprite0.png">&#xA0;<div><br>
In our example we first set the scroll registers to 0 for the static status bar.  The nametable is also set to 0.  That makes sure that the background and sprite 0 will overlap in the correct place.<br>  <br><br><pre>NMI:<br><br>  ; all graphics updating code goes here<br><br>  LDA #$00
  STA $2006        ; clean up PPU address registers
  STA $2006
  
  LDA #$00         ; start with no scroll for status bar
  STA $2005
  STA $2005
  
  LDA #%10010000   ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1
  STA $2000        ; start with nametable = 0 for status bar<br><br>  LDA #%00011110   ; enable sprites, enable background, no clipping on left side
  STA $2001</pre>  
Next we make sure the sprite 0 hit flag is clear, to avoid it being tripped from the previous frame.  The flag is cleared at the end of vblank, so once it equals 0 you know the next frame has started.<br>  <br><br><pre>WaitNotSprite0:
  lda $2002
  and #%01000000
  bne WaitNotSprite0   ; wait until sprite 0 not hit</pre>
<br>  
Now we wait until the sprite 0 is hit.  How long this takes depends on how far down the screen your sprite 0 is placed.<br>  <br><br><pre>WaitSprite0:
  lda $2002
  and #%01000000
  beq WaitSprite0      ; wait until sprite 0 is hit</pre>
<br>
When that loop finishes, the PPU is drawing the first pixels of sprite 0 that overlap pixels on the background.  We add a small wait loop so the rest of the status bar is drawn, and then change the scroll registers.  The rest of the screen down is drawn using those settings.<br><br><br><pre>  ldx #$10
WaitScanline:
  dex
  bne WaitScanline
  
  LDA scroll
  STA $2005        ; write the horizontal scroll count register
  LDA #$00         ; no vertical scrolling
  STA $2005
    
  LDA #%10010000   ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1
  ORA nametable    ; select correct nametable for bit 0
  STA $2000</pre>
<br>
So the order is:<br>
<pre>  1 - set scroll to 0 for status bar
  2 - wait for sprite 0 hit = 0
  3 - wait for sprite 0 hit = 1
  4 - delay so scanline finishes drawing
  5 - set scroll for level background</pre>
<br>  
The only other change is to make sure your graphics updating code does not draw over the status bar.  The previous DrawNewColumn function handles the graphics updates so it has a few small differences.  The starting address is increased by $80 to skip the first 4 rows of background.  Then the source address is increased by $04 for the same reason.  <br><br><br><br><span class="Apple-style-span" style="font-size: medium; "><b>Putting It All Together</b></span><br>
Download and unzip the <a href="scraper/files/sprite0.zip" target="_blank" original-href="http://www.nespowerpak.com/nesasm/sprite0.zip">sprite0.zip</a> sample files.   sprite0.asm is the same as the previous scrolling5.asm file plus the changes covered here.  This is another good one to watch in an emulator.  
</div></div>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#advanced_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;advanced_tutorial-3__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36969" target="_blank">
                                来源网页
                            </a>
                        </div>

                    </div>
                </div>
                <div class="comments" style="display: none;" id="advanced_tutorial-3__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-3__1">
                                                        <div class="mdl-card__title"><strong>RetroBasement</strong> posted on 
		
			
				
				Aug 4, 2010 at 2:13:05 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					wow dude thats awesome you put these together if i knew what any of this meant id totally be into it. im sure your helping alot of ppl on here
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-3__2">
                                                        <div class="mdl-card__title"><strong>CMR</strong> posted on 
		
			
				
				Aug 4, 2010 at 6:54:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I can&apos;t wait till I get some time on my hands to go through all these.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-3__3">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				Aug 4, 2010 at 12:18:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Very helpful!  Thanks Brian.  I was thinking about putting something together for the NESDev coding competition, and these last two NNs really helped me understand these concepts.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-3__4">
                                                        <div class="mdl-card__title"><strong>y(oYo)</strong> posted on 
		
			
				
				Oct 15, 2013 at 5:37:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					At this point, waiting for sprite 0 to be hit confuses me.<br>
<br>
When we get out of the loop that tests if sprite 0 have been hit, we are outside the vblank period, right ?<br>
<br>
<pre style="color: rgb(0, 0, 0); font-size: 11px;"><code>WaitSprite0:
  lda $2002
  and #%01000000
  beq WaitSprite0      ; wait until sprite 0 is hit</code></pre>
<br>
So, it is actually possible to do graphics update in real time, even if the ppu is rendering?<br>
Or maybe, at this exact moment, all we can do is only update Scroll registers?<br>
<br>
Any help or futher information would be very appreciated <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
Thanks a lot.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-3__5">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Oct 15, 2013 at 8:55:56 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					All you are doing is waiting for the hit, and on the hits, you can update either scrolling or the graphics bank. The PPU just reads the ROM, we can switch the ROM data at our will at ANY point.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-3__6">
                                                        <div class="mdl-card__title"><strong>y(oYo)</strong> posted on 
		
			
				
				Oct 15, 2013 at 9:34:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Allright, and can we also update parts in our nametables here?
<br>Or is it a bad practice?
<br>
<br>What I am trying to do is to evaluate the ability to put the sprite 0 in the middle of the screen, and then manage the top and the bottom part to scroll independantly.
<br>I don&apos;t know if it is possible.
<br>
<br>Thanks.
<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-3__7">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Oct 15, 2013 at 10:58:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					VRAM access is not possible during active rendering, so no nametable or palette updates. Changing rendering parameters is possible, like switching to another CHR bank or changing scroll value.<br>
<br>
Independent scroll of top and bottom parts of the screen is possible. But it is not really related to the Sprite 0 hit, as it is only one of methods of catching specific scanline. The same could be done with well timed code, or with a mapper with scanline IRQ.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="advanced_tutorial-3__8">
                                                        <div class="mdl-card__title"><strong>y(oYo)</strong> posted on 
		
			
				
				Oct 15, 2013 at 12:24:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Right, thanks a lot for the hints.
<br>So I guess I have to improve my dev skills in order to implement such stuffs ^_^
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

            
        </div>
    </section>
</div>
<div class="mdl-layout__tab-panel" id="audio_tutorial">
    <section class="section--center mdl-grid mdl-grid--no-spacing">
        <div class="mdl-cell mdl-cell--12-col">
            <h4>音频教程</h4>

            <h5>目录</h5>
            <ul class="toc" id="audio_tutorial-toc">

                                    <a href="#audio_tutorial-0">0: 声音</a>
                                    <a href="#audio_tutorial-1">1: 制作一个 音乐/音效 引擎</a>
                                    <a href="#audio_tutorial-2">2: 方波、三角波</a>
                                    <a href="#audio_tutorial-3">3: 周期、查表</a>
                                    <a href="#audio_tutorial-4">4: 声音引擎</a>
                                    <a href="#audio_tutorial-5">5: 声音数据、指针表、标题</a>
                                    <a href="#audio_tutorial-6">6: 节奏、音符长度、缓冲和休止符</a>
                                    <a href="#audio_tutorial-7">7: 音量</a>
                                    <a href="#audio_tutorial-8">8: 操作码和循环</a>
                                    <a href="#audio_tutorial-9">9: 有限循环、调性变化、和弦</a>
                                    <a href="#audio_tutorial-10">10: 简单的鼓</a>
                            </ul>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="audio_tutorial-0">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">声音</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					People are starting to complete the Nerdy Nights tutorial series and we&apos;re seeing a lot of new homebrewers in the forum.&#xA0; This is great!&#xA0; One question that a lot of people ask after finishing up their Pong game is &quot;how do I do sound?&quot;&#xA0; Well, I hope to teach you <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">.<br><br>The plan is to have a series of tutorial that take you from having no sound to having a working music/sfx engine.&#xA0; We&apos;ll start very simple (making a beep) and work our way up.&#xA0; These tutorials will assume that you have completed the original Nerdy Nights tutorials (I won&apos;t reteach binary or 6502).<br><br>And I&apos;m going to steal bunnyboy&apos;s disclaimer and re-use it as my own:<br><br style="font-style: italic;"><span style="font-style: italic;">And finally these will not be without errors to begin with and may not
be the absolute best way to do anything. People develop their own
programming styles and this is just mine...</span><br>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#audio_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;audio_tutorial-0__comments&apos;);">
                            是否显示评论内容
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22487" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="audio_tutorial-0__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-0__1">
                                                        <div class="mdl-card__title"><strong>hanter</strong> posted on 
		
			
				
				Feb 26, 2016 at 9:59:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi, MetalSlime. Your website and download files is out of date. Do you update this resources?&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-0__2">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Feb 27, 2016 at 12:57:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>hanter</b></i><br>
<br>
Hi, MetalSlime. Your website and download files is out of date. Do you update this resources?&#xA0;</div>
<br>
<br>
You may be waiting a long time on a reply. He hasn&apos;t logged into NA since 2014.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-0__3">
                                                        <div class="mdl-card__title"><strong>zi</strong> posted on 
		
			
				
				Feb 27, 2016 at 1:05:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					plus when you attack him he just flees. super annoying.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-0__4">
                                                        <div class="mdl-card__title"><strong>guillavoie</strong> posted on 
		
			
				
				Feb 27, 2016 at 1:18:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>zi</b></i><br>
	<br>
	plus when you attack him he just flees. super annoying.</div>
<br>
<br>
This is simply the perfect post for this thread, we can now lock it in peace gentlemen!<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-0__5">
                                                        <div class="mdl-card__title"><strong>hanter</strong> posted on 
		
			
				
				Feb 27, 2016 at 5:07:54 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hah,  fc/nes go out of fashion now.I fisrt play nes game in 199x, now it&apos;s 2016.Hah, Im&apos;s old man.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-0__6">
                                                        <div class="mdl-card__title"><strong>zi</strong> posted on 
		
			
				
				Feb 27, 2016 at 10:04:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>guillavoie</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>zi</b></i><br>
		<br>
		plus when you attack him he just flees. super annoying.</div>
	<br>
	<br>
	This is simply the perfect post for this thread, we can now lock it in peace gentlemen!</div>
<br>
Can we start this? LIP - Lock In Peace<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-0__7">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Feb 27, 2016 at 10:31:59 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There&apos;s no need to lock a perfectly good thread, someone has the files I&apos;m sure, and where else to ask. Perfect reply though Zi <span class="sprites_emoticons absmiddle" id="emo_smile"></span>.
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Nerdy Nights Sound: Part 1: make a music/sfx engine</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b><font size="5">The APU</font></b><br>
<br>
Music and sound effects on the NES are generated by the <b>APU</b> (Audio Processing Unit), the sound chip inside the CPU.&#xA0; The CPU &quot;talks&quot; to the APU through a series of I/O ports, much like it does with the PPU and joypads.<br>
<br>
PPU: $2000-$2007<br>
Joypads: $4016-$4017<br>
APU: $4000-$4015, $4017<br>
<br>
<b><font size="4">Channels</font></b><br>
<br>
The APU has 5 channels: Square 1, Square 2, Triangle, Noise and DMC.&#xA0; The first four play waves and are used in just about every game.&#xA0; The DMC channel plays samples (pre-recorded sounds) and is used less often.<br>
<br>
<b><font size="3"><font size="2">Square</font></font></b><br>
The square channels produce square waveforms.&#xA0; A square wave is named for its shape.&#xA0; It looks like this:<br>
&#xA0;
<div id="j.ge" style="text-align: left;"><img src style="width: 240px; height: 50px;" original-src="http://tummaigames.com/square_wave.jpg" show-src="images/nerdy-nights-sound/square_wave.jpg"></div>
<br>
As you can see the wave transitions instantaneously from its high point to its low point (where the lines are vertical).&#xA0; This gives it a hollow sound like a woodwind or an electric guitar.<br>
<br>
<b><font size="3"><font size="2">Triangle</font></font></b><br>
The triangle channel produces triangle waveforms.&#xA0; A triangle wave is also named for its shape.&#xA0; It looks like this:<br>
&#xA0;
<div id="rnep" style="text-align: left;"><img src style="width: 240px; height: 50px;" original-src="http://tummaigames.com/triangle_wave.jpg" show-src="images/nerdy-nights-sound/triangle_wave.jpg"></div>
<br>
The sound of a triangle wave is smoother and less harsh than a square wave. On the NES, the triangle channel is often used for bass lines (in low octaves) or a flute (in high octaves).&#xA0; It can also be used for drums.<br>
<br>
<font size="2"><b>Noise</b></font><br>
The noise channel has a random generator, which makes the waves it produces sound like.. noise.&#xA0; This channel is generally used for percussion and explosion sounds.<br>
<br>
<font size="2"><b>DMC</b></font><br>
The DMC channel plays samples, which are pre-recorded sounds.&#xA0; It is often used to play voice recordings (&quot;Blades of Steel&quot;) and percussion samples.&#xA0; Samples take up a lot of ROM space, so not many games make use of the DMC channel.<br>
<br>
<br>
<b><font size="4">Enabling Channels</font></b><br>
<br>
Before you can use the channels to produce sounds, you need to enable them.&#xA0; Channels are toggled on and off via port $4015:<br>
<br>
<span style="font-family: Courier New;">APUFLAGS ($4015)</span><br style="font-family: Courier New;">
<br style="font-family: Courier New;">
<span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0; |||||</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0; ||||+- Square 1 (0: disable; 1: enable)</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0; |||+-- Square 2</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0; ||+--- Triangle</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0; |+---- Noise</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0; +----- DMC</span><br>
<br>
Here are some code examples using $4015 to enable and disable channels:&#xA0; &#xA0;<br>
&#xA0; &#xA0;<br>
<span style="font-family: Courier New;">&#xA0;&#xA0; lda #%00000001</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0; sta $4015 ;enable Square 1 channel, disable others</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0; lda #%00010110</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0; sta $4015 ;enable Square 2, Triangle and DMC channels.&#xA0; Disable Square 1 and Noise.</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0; sta $4015 ;disable all channels</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0; lda #$0F</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0; sta $4015 ;enable Square 1, Square 2, Triangle and Noise channels.&#xA0; Disable DMC.</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this is the most common usage.</span><br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;<br>
Try opening up some of your favorite games in FCEUXD SP and set a breakpoint on writes to $4015.&#xA0; Take a look at what values are getting written there.&#xA0; If you don&apos;t know how to do this, follow these steps:<br>
<br>
1. Open FCEUXD SP<br>
2. Load a ROM<br>
3. Open up the Debugger by pressing F1 or going to Tools-&gt;Debugger<br>
4. In the top right corner of the debugger, under &quot;BreakPoints&quot;, click the &quot;Add...&quot; button<br>
5. Type &quot;4015&quot; in the first box after &quot;Address:&quot;<br>
6. Check the checkbox next to &quot;Write&quot;<br>
7. Set &quot;Memory&quot; to &quot;CPU Mem&quot;<br>
8. Leave &quot;Condition&quot; and &quot;Name&quot; blank and click &quot;OK&quot;<br>
<br>
Now FCEUX will pause emulation and snap the debugger anytime your game makes a write (usually via STA) to $4015.&#xA0; The debugger will tell you the contents of the registers at that moment, so you can check what value will be written to $4015.&#xA0; Some games will write to $4015 every frame, and some only do so once at startup.&#xA0; Try resetting the game if your debugger isn&apos;t snapping.<br>
<br>
What values are being written to $4015?&#xA0; Can you tell what channels your game is using?<br>
<br>
<br>
<b><font size="4">Square 1 Channel</font></b><br>
<br>
Let&apos;s make a beep.&#xA0; This week we&apos;ll learn how to produce a sound on the Square 1 channel.&#xA0; The Square channels are everybody&apos;s favorites because you can control the volume and tone and perform sweeps on them.&#xA0; You can produce a lot of interesting effects using the Squares.<br>
<br>
Square 1 is controlled via ports $4000-$4003.&#xA0; The first port, $4000, controls the duty cycle (ie, tone) and volume for the channel.&#xA0; It looks like this:<br>
<br>
<span style="font-family: Courier New;">SQ1_ENV ($4000)</span><br style="font-family: Courier New;">
<br style="font-family: Courier New;">
<span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">||||||||</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">||||++++- Volume</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">|||+----- Saw Envelope Disable (0: use internal counter for volume; 1: use Volume for volume)</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">||+------ Length Counter Disable (0: use Length Counter; 1: disable Length Counter)</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">++------- Duty Cycle</span><br>
<br>
For our purposes, we will focus on Volume and Duty Cycle.&#xA0; We will set Saw Envelope Disable and Length Counter Disable to 1 and then forget about them.&#xA0; If we leave Saw Envelopes on, the volume of the channel will be controlled by an internal counter.&#xA0; If we turn them off, WE have control of the volume.&#xA0; If WE have control, we can code our own envelopes (much more versatile).&#xA0; Same thing with the Length Counter.&#xA0; If we disable it, we have more control over note lengths.&#xA0; If that didn&apos;t make sense, don&apos;t worry.&#xA0; It will become clearer later.&#xA0; For now we&apos;re just going to disable and forget about them.<br>
<br>
<i>Volume</i> controls the channel&apos;s volume.&#xA0; It&apos;s 4 bits long so it can have a value from 0-F.&#xA0; A volume of 0 silences the channel.&#xA0; 1 is very quiet and F is loud.<br>
<br>
<i>Duty Cycle</i> controls the tone of the Square channel.&#xA0; It&apos;s 2 bits long, so there are four possible values:<br>
<br>
00 = a weak, grainy tone.&#xA0; Think of the engine sounds in RC Pro-Am. (12.5% Duty)<br>
01 = a solid mid-strength tone. (25% Duty)<br>
10 = a strong, full tone, like a clarinet or a lead guitar (50% Duty)<br>
11 = sounds a lot like 01 (25% Duty negated)<br>
<br>
The best way to know the difference in sound is to listen yourself.&#xA0; I recommend downloading <a href="http://famitracker.shoodot.net/" target="_blank" original-href="http://famitracker.shoodot.net/">FamiTracker</a> and playing with the different Duty settings in the Instrument Editor.<br>
<br>
For those interested, Duty Cycle actually refers to the percentage of time that the wave is in &quot;up&quot; position vs. &quot;down&quot; position.&#xA0; Here are some pictures:<br>
<br>
12.5%
<div id="f0:l" style="text-align: left;"><img src style="width: 240px; height: 50px;" original-src="http://tummaigames.com/square_wave_125_duty.jpg" show-src="images/nerdy-nights-sound/square_wave_125_duty.jpg"></div>
25%<br><br><div id="ilti" style="text-align: left;"><img src style="width: 240px; height: 50px;" original-src="http://tummaigames.com/square_wave_25_duty.jpg" show-src="images/nerdy-nights-sound/square_wave_25_duty.jpg"></div>
50%<br><br><div id="bjx0" style="text-align: left;"><img src style="width: 240px; height: 50px;" original-src="http://tummaigames.com/square_wave_50_duty.jpg" show-src="images/nerdy-nights-sound/square_wave_50_duty.jpg"></div>
25% negated<br><br><div id="qi76" style="text-align: left;"><img src style="width: 240px; height: 50px;" original-src="http://tummaigames.com/square_wave_25neg_duty.jpg" show-src="images/nerdy-nights-sound/square_wave_25neg_duty.jpg"></div>
<br>
Don&apos;t sweat it if graphs and waves aren&apos;t your thing.&#xA0; Use your ears instead.<br>
<br>
Here&apos;s a code snippet that sets the Duty and Volume for the Square 1 channel:<br>
<br>
<span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%10111111; Duty 10 (50%), volume F (max!)</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4000</span><br>
<br>
$4001 controls sweeps for Square 1.&#xA0; We&apos;ll skip them for now.<br>
<br>
<font size="2"><b>Setting the Note</b></font><br>
$4002 and $4003 control the period of the wave, or in other words what note you hear (A, C#, G, etc).&#xA0; Periods are 11-bits long.&#xA0; $4002 holds the low 8-bits and $4003 holds the high 3-bits of the period.&#xA0; We&apos;ll get into more detail in a future tutorial, but for now just know that changing the values written to these ports will change the note that is played.<br>
<br>
<span style="font-family: Courier New;">SQ1_LO ($4002)</span><br style="font-family: Courier New;">
<br style="font-family: Courier New;">
<span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">||||||||</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">++++++++- Low 8-bits of period</span><br style="font-family: Courier New;">
<br style="font-family: Courier New;">
<span style="font-family: Courier New;">SQ1_HI ($4003)</span><br style="font-family: Courier New;">
<br style="font-family: Courier New;">
<span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">||||||||</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">|||||+++- High 3-bits of period</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">+++++---- Length Counter</span><br>
<br>
The Length Counter, if enabled, controls how long the note is played.&#xA0; We disabled it up in the $4000 section, so we can forget about it for now.<br>
<br>
Here is some code that will produce an eternal beep on the Square 1 channel:<br>
<br>
<span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%00000001</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4015 ;enable square 1</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%10111111 ;Duty 10, Volume F</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4000</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$C9&#xA0;&#xA0;&#xA0; ;0C9 is a C# in NTSC mode</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4002</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4003</span><br>
&#xA0;&#xA0; &#xA0;<br>
<b>Putting It All Together</b><br>
Download and unzip the <a href="downloads/NerdyNightsSoundSourceCollection/square1.zip" target="_blank" original-href="http://tummaigames.com/square1.zip">square1.zip</a> sample files. All the code above is in the square1.asm file. Make sure square1.asm and square1.bat are all in the same folder as NESASM3, then double click square1.bat. That will run NESASM3 and should produce the square1.nes file. Run that NES file in FCEUXD SP to listen to your beep!&#xA0; Edit square1.asm to change the Volume (0 to F), or to change the Duty Cycle for the square wave.&#xA0; Try changing the period to produce different notes.<br>
<br>
<b>Next Week</b>: <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22610" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22610">Square 2 and Triangle.&#xA0; Multiple beeps!</a>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#audio_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;audio_tutorial-1__comments&apos;);">
                            是否显示评论内容
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22484" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="audio_tutorial-1__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__1">
                                                        <div class="mdl-card__title"><strong>Jero</strong> posted on 
		
			
				
				Aug 20, 2009 at 9:48:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Good idea! I&apos;ll read trough it later......looks promising. :-)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__2">
                                                        <div class="mdl-card__title"><strong>AllYourBass</strong> posted on 
		
			
				
				Aug 20, 2009 at 9:53:06 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Awesome! Thanks for keeping Nerdy Nights going.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__3">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Aug 20, 2009 at 3:33:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					excellent, I will have to look at this tonight.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__4">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Aug 20, 2009 at 7:03:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank the maker.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__5">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Aug 20, 2009 at 7:31:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Looks great, you followed bunnys styling perfectly <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> I think I&apos;m going to learn a bit about some of the intricacies of the APU here too <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__6">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Aug 22, 2009 at 9:48:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					well, this is pretty neat, played around a bit, and now the ball makes a little &quot;blip&quot; sound when it hits my paddles. Still don&apos;t know enough to get the exact sound I want, but I figured out how to go up and down in key, and how to make it a short blip instead of a steady tone.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__7">
                                                        <div class="mdl-card__title"><strong>Vaevictus</strong> posted on 
		
			
				
				Aug 23, 2009 at 11:55:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Took me a while to find this.&#xA0; for NTSC roms, here&apos;s the period table.&#xA0; You can convert pitches to codes with it.<br><a href="downloads/missing/NotesTableNTSC.txt" target="_blank" original-href="http://www.freewebs.com/the_bott/NotesTableNTSC.txt">http://www.freewebs.com/the_bott/...</a><br>So, to play an E, 3rd octave... you&apos;d change that code from $0C9 to $152.<br>Specifically:<br>&#xA0;&#xA0;&#xA0; lda #$C9&#xA0;&#xA0;&#xA0; ;0C9 is a C# in NTSC mode<br>&#xA0;&#xA0;&#xA0; sta $4002<br>&#xA0;&#xA0;&#xA0; lda #$00<br>&#xA0;&#xA0;&#xA0; sta $4003<br>To:<br>&#xA0;&#xA0;&#xA0; lda #$52&#xA0;&#xA0;&#xA0; ;152 is a E3 in NTSC mode<br>&#xA0;&#xA0;&#xA0; sta $4002<br>&#xA0;&#xA0;&#xA0; lda #$01<br>&#xA0;&#xA0;&#xA0; sta $4003<br><br><br>I can&apos;t wait for the next section!&#xA0; <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__8">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Aug 24, 2009 at 12:01:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					excellent, I was trying to figure this out. trying to see why $00c9 was a c# I knew there was something to it, that chart is awesome.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__9">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Aug 24, 2009 at 12:49:39 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That&apos;s the chart I use too.  I&apos;m saving the period charts for week 3.  I didn&apos;t want to overwhelm anybody in the first lesson <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__10">
                                                        <div class="mdl-card__title"><strong>Vaevictus</strong> posted on 
		
			
				
				Aug 24, 2009 at 6:11:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					oops... didn&apos;t need to preempt, but some of us might be working a bit ahead <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> &#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__11">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Aug 27, 2009 at 1:46:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					no problem at all.  Working ahead is encouraged <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__12">
                                                        <div class="mdl-card__title"><strong>Zutano</strong> posted on 
		
			
				
				Jul 19, 2016 at 1:24:16 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry to dig up such an old thread. It looks like the example code links are broken for every APU tutorial. Does anyone have a mirror?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__13">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jul 19, 2016 at 5:40:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Zutano</b></i><br>
	<br>
	Sorry to dig up such an old thread. It looks like the example code links are broken for every APU tutorial. Does anyone have a mirror?</div>
<br>
Mog posted a new link a while ago, but I can&apos;t find it now.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__14">
                                                        <div class="mdl-card__title"><strong>Mog</strong> posted on 
		
			
				
				Jul 19, 2016 at 10:55:18 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Zutano</b></i><br>
		<br>
		Sorry to dig up such an old thread. It looks like the example code links are broken for every APU tutorial. Does anyone have a mirror?</div>
	<br>
	Mog posted a new link a while ago, but I can&apos;t find it now.<br>
	&#xA0;</div>
<br>
<br>
Here you go<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__15">
                                                        <div class="mdl-card__title"><strong>Zutano</strong> posted on 
		
			
				
				Jul 20, 2016 at 10:25:44 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mog</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>Zutano</b></i><br>
<br>
Sorry to dig up such an old thread. It looks like the example code links are broken for every APU tutorial. Does anyone have a mirror?</div>
<br>
Mog posted a new link a while ago, but I can&apos;t find it now.<br>
&#xA0;</div>
<br>
<br>
Here you go</div>
<br>
Thanks!<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__16">
                                                        <div class="mdl-card__title"><strong>Erdrick</strong> posted on 
		
			
				
				Oct 11, 2016 at 12:30:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am looking for the mirror links for this tutorial&apos;s sample codes and I can&apos;t see it in your post. I would really appreciate help finding the links. Thank you.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__17">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Oct 11, 2016 at 6:33:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Erdrick</b></i><br>
<br>
I am looking for the mirror links for this tutorial&apos;s sample codes and I can&apos;t see it in your post. I would really appreciate help finding the links. Thank you.</div>
<br>
Did you look at the attached file two posts up?<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__18">
                                                        <div class="mdl-card__title"><strong>thejonwithnoh</strong> posted on 
		
			
				
				Jan 13, 2017 at 5:45:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m also looking for the mirror links for this tutorial&apos;s sample code, and I&apos;ve looked at the message from Mog that says &quot;Here you go&quot; indicating that the mirror is attached, and then Zutano saying &quot;Thanks!&quot; afterwards, but there doesn&apos;t seem to actually be any link or attachment for me to click?&#xA0; Sorry if I&apos;m missing something obvious.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__19">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jan 13, 2017 at 6:31:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thejonwithnoh</b></i><br><br>I&apos;m also looking for the mirror links for this tutorial&apos;s sample code, and I&apos;ve looked at the message from Mog that says &quot;Here you go&quot; indicating that the mirror is attached, and then Zutano saying &quot;Thanks!&quot; afterwards, but there doesn&apos;t seem to actually be any link or attachment for me to click?&#xA0; Sorry if I&apos;m missing something obvious.</div><br><br><br><br><br>It&apos;s attached to Mog&apos;s post at the very botton. It&apos;s not a link.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__20">
                                                        <div class="mdl-card__title"><strong>thejonwithnoh</strong> posted on 
		
			
				
				Jan 13, 2017 at 8:37:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>thejonwithnoh</b></i><br>
<br>
I&apos;m also looking for the mirror links for this tutorial&apos;s sample code, and I&apos;ve looked at the message from Mog that says &quot;Here you go&quot; indicating that the mirror is attached, and then Zutano saying &quot;Thanks!&quot; afterwards, but there doesn&apos;t seem to actually be any link or attachment for me to click?&#xA0; Sorry if I&apos;m missing something obvious.</div>
<br>
<br>
<br>
It&apos;s attached to Mog&apos;s post at the very botton. It&apos;s not a link.</div>
<br>
<br>
Thank you so much!&#xA0; When I was a guest looking at this forum, the link was not available, and then when I got an account, I must have not looked over it carefully again.&#xA0; Knew it had to be something simple.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-1__21">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 14, 2017 at 2:59:48 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thejonwithnoh</b></i><br>
	<br>
	Thank you so much! When I was a guest looking at this forum, the link was not available, and then when I got an account, I must have not looked over it carefully again. Knew it had to be something simple.</div>
<br>
<br>
<br>By the way, welcome to NA Brewery! <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
Nice to see few more Europeans. <span class="sprites_emoticons absmiddle" id="emo_wink">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="audio_tutorial-2">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Nerdy Nights Sound: Part 2: Square 2 and Triangle Basics</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b>Last Week</b>: <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22484" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22484">APU Overview and Square 1 Basics</a><br><br><b>This week</b>: We will learn how to makes sounds with the Square 2 and Triangle channels.<br><br><font size="4" style="font-weight: bold;">Square 2</font><br><br>Last
time we produced a beep on the Square 1 channel by making writes to
$4000-$4003.&#xA0; Now we&apos;ll learn how to do it with Square 2.&#xA0; This is very
easy because Square 1 and Square 2 are almost identical.&#xA0; We control
the Square 2 channel with ports $4004-$4007, and they more or less
mirror Square 1&apos;s $4000-4003.<br><br><span style="font-family: Courier New;"><b>SQ2_ENV</b> ($4004)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">||||||||</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">||||++++- Volume</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">|||+----- Saw Envelope Disable (0: use internal counter for volume; 1: use Volume for volume)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">||+------ Length Counter Disable (0: use Length Counter; 1: disable Length Counter)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">++------- Duty Cycle</span><br><br>
<br><span style="font-family: Courier New;"><b>SQ2_SWEEP</b> ($4005)</span><br>Skip this for now.&#xA0; This port, incidentally, is where Square 2 differs from Square 1.<br><br style="font-family: Courier New;"><span style="font-family: Courier New;"><b><br>
SQ2_LO</b> ($4006)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">||||||||</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">++++++++- Low 8-bits of period</span><br><br><span style="font-family: Courier New;"><b><br>
SQ2_HI</b> ($4007)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">||||||||</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">|||||+++- High 3-bits of period</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">+++++---- Length Counter</span><br><br>To produce a sound, first we enable the channel via $4015:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%00000010 ;enable Square 2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4015</span><br>&#xA0;&#xA0; &#xA0;<br>Then we write to the Square 2 ports:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%00111000 ;Duty Cycle 00, Volume 8 (half volume)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4004</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$A9&#xA0;&#xA0; ;$0A9 is an E in NTSC mode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4006</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4007</span><br>&#xA0;&#xA0; &#xA0;<br>Except for sweeps, the Square 2 channel works just like the Square 1 channel.<br>&#xA0;&#xA0; &#xA0;<br><b><font size="4">Triangle</font></b><br><br>The
Triangle channel produces triangle waveforms which have a smooth sound
to them.&#xA0; Think of the flute-like melody in the Dragon Warrior overland
song.&#xA0; That&apos;s the Triangle.<br><br>Unlike the Square channels, we have
no control over the Triangle channel&apos;s volume or tone.&#xA0; It makes only
one type of sound and it&apos;s either on (playing) or off (silent).&#xA0; We
manipulate the Triangle channel via ports $4008-$400B.<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">TRI_CTRL ($4008)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">||||||||</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">|+++++++- Value</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">+-------- Control Flag (0: use internal counters; 1: disable internal counters)</span><br><br>The
triangle channel has two internal counters that can be used to
automatically control note duration.&#xA0; We are going to disable them so
that we can control note length manually.&#xA0; We will set the <b>Control Flag</b> to 1 and forget about it.<br><br>When the internal counters are disabled, <b>Value</b>
controls whether the channel is on or off.&#xA0; To silence the channel, set
Value to 0.&#xA0; To turn the channel on (ie, unsilence), set Value to any
non-zero value.&#xA0; Here are some examples:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%10000000 ;silence the Triangle channel</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4008</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%10000001 ;Triangle channel on</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4008</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%10001111 ;Triangle channel on</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4008</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%11111111 ;Triangle channel on</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4008</span><br>&#xA0;&#xA0; &#xA0;<br>Note that the last three examples are functionally the same.&#xA0; Any non-zero value in Value makes the Triangle channel play.<br><br><b>Unused Port</b><br>$4009 is unused<br><br><b>Setting the Note</b><br>$400A
and $400B control the period of the wave, or in other words what note
you hear (A, C#, G, etc).&#xA0; Like the Squares, Triangle periods are
11-bits long.&#xA0; $400A holds the low 8-bits and $400B holds the high
3-bits of the period.&#xA0; We&apos;ll learn more about periods next week, but
for now just know that changing the values written to these ports will
change the note that is played.<br><br><span style="font-family: Courier New;">TRI_LO ($400A)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">||||||||</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">++++++++- Low 8-bits of period</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">TRI_HI ($400B)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">||||||||</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">|||||+++- High 3-bits of period</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">+++++---- Length Counter</span><br><br>The
Length Counter, if enabled, controls how long the note is played.&#xA0; We
disabled it up in the $4008 section, so we can forget about it for now.<br><br>Here is some code to play an eternal beep on the Triangle channel:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%00000100 ;enable Triangle channel</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4015</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%10000001 ;disable counters, non-zero Value turns channel on</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4008</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$42&#xA0;&#xA0; ;a period of $042 plays a G# in NTSC mode.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400A</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400B</span><br>&#xA0;&#xA0; &#xA0;<br><font size="4"><b>Multiple Beeps</b></font><br>We
now know how to use the Square 1, Square 2 and Triangle channels to
make sound.&#xA0; It doesn&apos;t take too much extra work to make them all play
at the same time.&#xA0; We just have to enable all three channels via $4015
and then write to the ports.&#xA0; Here&apos;s some code that will play a C#m
chord (C# E G#) using the knowledge we have gained up to now:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%00000111&#xA0; ;enable Sq1, Sq2 and Tri channels</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4015</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;Square 1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%00111000&#xA0; ;Duty 00, Volume 8 (half volume)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4000</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$C9&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$0C9 is a C# in NTSC mode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;low 8 bits of period</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4003&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;high 3 bits of period</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;Square 2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%01110110&#xA0; ;Duty 01, Volume 6</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4004</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$A9&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$0A9 is an E in NTSC mode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4006</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4007</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;Triangle</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%10000001&#xA0; ;Triangle channel on</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4008</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$42&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$042 is a G# in NTSC mode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400A</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400B</span><br>&#xA0;&#xA0; &#xA0;<br><b>Putting It All Together</b><br>Download
and unzip the <a href="downloads/NerdyNightsSoundSourceCollection/triad.zip" target="_blank" original-href="http://tummaigames.com/triad.zip">triad.zip</a> sample files. All the code above is in the
triad.asm file. Make sure triad.asm and triad.bat are all in the same
folder as NESASM3, then double click triad.bat. That will run NESASM3
and should produce the triad.nes file. Run that NES file in FCEUXD SP
to listen to your C#m chord!&#xA0; Edit triad.asm to change the Volume and
Duty Cycle for the square waves.&#xA0; Try changing the Periods to produce
different notes.<br><br>Try to silence the various channels by either disabling them via $4015 or silencing them via $4000/$4004/$4008.<br><br>Finally try writing some code that will silence/unsilence the individual channels based on user input, like so:<br><br><span style="font-weight: bold;">A</span>: toggle Square 1 channel on/off<br><span style="font-weight: bold;">B</span>: toggle Square 2 channel on/off<br><span style="font-weight: bold;">Select</span>: toggle Triangle channel on/off<br><br><b>Next Week</b>: <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22776" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22776">Periods and Lookup Tables</a><br>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#audio_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;audio_tutorial-2__comments&apos;);">
                            是否显示评论内容
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22610" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="audio_tutorial-2__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-2__1">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Aug 24, 2009 at 2:27:56 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					it&apos;s times like this I wish I actually spent more time on music theory. I played guitar, bass, and drums, but I was all by ear. I have some chord books somewhere, may have to bust them out.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-2__2">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Aug 24, 2009 at 2:42:38 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you play guitar and bass by ear you&apos;ll be fine as long as you can identify what note you are playing on the fretboard (by the counting method <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> ).  If you are playing a chord on the guitar, just figure out the individual notes one at a time.  There&apos;s no reason you&apos;d have to know the technical name of the chord to transpose from the guitar to the NES.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-2__3">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Aug 24, 2009 at 2:51:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					oh, I know, but if I actually knew the note combinations, it would be much faster.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-2__4">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Aug 24, 2009 at 10:15:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, I&apos;m very happy that I took so many theory classes.  It helps me a lot on deciding where to go.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-2__5">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Dec 9, 2014 at 11:37:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Taking some time to finally work through this. Glad I took some music theory. I can see it is going to come in handy. Great tutorials so far.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-2__6">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Dec 10, 2014 at 1:03:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No theory classes here, but I cannot wait to get to doing music. If only everything else didn&apos;t take so much time <span class="sprites_emoticons absmiddle" id="emo_smile"></span>.
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="audio_tutorial-3">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Nerdy Nights Sound: Part 3: Periods and lookup tables</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b>Last Week</b>: <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22610" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22610">Square 2 and Triangle Basics</a><br><br><b>This week</b>: We will learn about periods and build a period lookup table that spans 8 octaves.<br><br><b><font size="4">Periods</font></b><br><br>In
the last two lessons, I&apos;ve been giving you the values to plug into the
11-bit periods for the Square and Triangle channels.&#xA0; I haven&apos;t been
giving you an explanation of what a period is, or where I got those
numbers.&#xA0; So this week we&apos;re going to learn about periods.<br><b><br>
What is a period?</b><br>A period refers to the length of a wave, or rather the <i>time</i> length of the <i>repeating</i> part of a wave.&#xA0; Take a look at this square wave (x-axis is time):<br><br><div id="xdzs" style="text-align: left;"><img style="width: 240px; height: 50px;" src original-src="http://docs.google.com/File?id=d36ccdg_32dh4jjkdf_b" show-src="images/missing/File_id_d36ccdg_32dh4jjkdf_b"></div>Notice
how it is repeating.&#xA0; It starts high and remains high for 2 time
units.&#xA0; Then it goes low and remains low for 2 time units.&#xA0; Then it
repeats.&#xA0; When we say period, we are talking about the horizontal time
length of this repeating wave.&#xA0; In this case, the period is 4 time
units.&#xA0; The longer a period is, the lower the note will sound.&#xA0;&#xA0;
Conversely, the shorter a period is, the higher the note will sound.&#xA0;
Look at these 3 Square waves:<br><br>Period = 6 time units<br><div id="o6dq" style="text-align: left;"><img style="width: 240px; height: 50px;" src original-src="http://docs.google.com/File?id=d36ccdg_33fm9jm9dg_b" show-src="images/missing/File_id_d36ccdg_33fm9jm9dg_b"></div><br>Period = 4 time units<br><div id="wj8x" style="text-align: left;"><img style="width: 240px; height: 50px;" src original-src="http://docs.google.com/File?id=d36ccdg_34gmf46jdj_b" show-src="images/missing/File_id_d36ccdg_34gmf46jdj_b"></div><br>Period = 1 time unit<br><div id="mw1w" style="text-align: left;"><img style="width: 240px; height: 50px;" src original-src="http://docs.google.com/File?id=d36ccdg_354r6gfhx5_b" show-src="images/missing/File_id_d36ccdg_354r6gfhx5_b"></div><br>The
top wave has the longest period (6 time units) and it will sound the
lowest.&#xA0; The bottom wave has a short period (1 time unit) and will
sound higher than the other two.<br><br>On the NES, we write an 11-bit
period to the APU ports.&#xA0; The smaller the number, the shorter the
period, the higher the note.&#xA0; Larger numbers = longer periods = lower
notes.&#xA0; Look at the following code snippets that write an 11-bit period
to the Square 1 ports:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$C9</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4002</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$05</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4003 ;period $5C9: large number = long period = low note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;----</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$09</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4002</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4003 ;period $009: small number = short period = very high note</span><br><br><b>Periods -&gt; Notes</b><br>So how do we know which 11-bit period values correspond to which notes?&#xA0; The magic forumla is:<br><br>&#xA0;&#xA0;&#xA0; P = C/(F*16) - 1<br>&#xA0;&#xA0; &#xA0;<br>&#xA0;&#xA0;&#xA0; P = Period<br>&#xA0;&#xA0;&#xA0; C = CPU speed (in Hz) <br>&#xA0;&#xA0;&#xA0; F = Frequency of the note (also in Hz). &#xA0;<br>&#xA0;&#xA0; &#xA0;<br>The
value of C differs between NTSC and PAL machines, which is why a game
made for NTSC will sound funny on a PAL NES, and vice-versa.<br><br>To
find the period values for notes, we will have to look up note
frequencies and plug them into the formula.&#xA0; Or we can cross our
fingers and hope somebody has already done the work for us and put the
answers in an easy-to-read table.&#xA0; Lucky for us a cool fellow named
Celius has done just that, for both NTSC and PAL.&#xA0; Here are the charts:<br><br><a href="downloads/missing/NotesTableNTSC.txt" target="_blank" original-href="http://www.freewebs.com/the_bott/NotesTableNTSC.txt">http://www.freewebs.com/the_bott/NotesTableNTSC.txt</a><br>
<a href="downloads/missing/NotesTablePAL.txt" target="_blank" original-href="http://www.freewebs.com/the_bott/NotesTablePAL.txt">http://www.freewebs.com/the_bott/NotesTablePAL.txt</a><br>
<br><b><font size="4">Lookup Tables</font></b><br>It is fairly common practice to store period values in a lookup table.&#xA0; A <b>lookup table</b>
is a table of pre-calculated data stored in ROM.&#xA0; Like an answer
sheet.&#xA0; Lookup tables are used to cut down on complicated,
time-consuming calculations.&#xA0; Let&apos;s look at a trivial example.&#xA0; Let&apos;s
say you want a subroutine that takes a value in A and returns 3^A.&#xA0; If
you took the brute-force approach, you might write something like this:<br><br><span style="font-family: Courier New;">multiplier .rs 1</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">; takes a value (0-5) in A and returns 3^A</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">three_to_the_a:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .not_zero</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;3^0 is 1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.not_zero:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$03</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop:&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta multiplier</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; dey</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .done</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; clc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; adc multiplier</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; adc multiplier</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp .loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.done:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>It works, but it&apos;s not very pretty.&#xA0; Here is how we would do it with a lookup table:<br><br><span style="font-family: Courier New;">;lookup table with pre-calculated answers</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">powers_of_3:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte 1, 3, 9, 27, 81, 243</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">three_to_the_a:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda powers_of_3, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Easier to code.&#xA0; Easier to read.&#xA0; And it runs faster too.<br><br><b>NESASM3 Tip#1: Local Labels</b><br>You may have noticed in the above example that I put a period in front of some labels: <b>.done</b>, <b>.loop</b>, <b>.not_zero</b>.&#xA0; NESASM3 treats these as local labels.&#xA0; There are two types of labels: global and local.&#xA0; A <b>global label</b> exists across the whole program and must be unique.&#xA0; A <b>local label</b>
only exists between two global labels.&#xA0; This means that we can reuse
the names of local labels - they only need to be unique within their
scope.&#xA0; Using local labels saves you the trouble of having to create
unique names for common case labels (like looping).&#xA0; I tend to use
local labels for all labels that occur within subroutines.&#xA0; To make a
label local, stick a period in front of it.<br>&#xA0;&#xA0; &#xA0;<br><font size="3"><b>Note Lookup Table</b></font><br>Let&apos;s
take Celius&apos;s tables and turn them into a note lookup table. Period
values are 11 bits so we will need to define our lookup table using
words.&#xA0; Note that .word is the same as .dw.&#xA0; Here is a note_table for
NTSC:<br><br><span style="font-family: Courier New;">;Note: octaves in music traditionally start from C, not A. &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; I&apos;ve adjusted my octave numbers to reflect this.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">note_table:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; $07F1, $0780, $0713 ; A1-B1 ($00-$02)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word $06AD, $064D, $05F3, $059D, $054D, $0500, $04B8, $0475, $0435, $03F8, $03BF, $0389 ; C2-B2 ($03-$0E)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word $0356, $0326, $02F9, $02CE, $02A6, $027F, $025C, $023A, $021A, $01FB, $01DF, $01C4 ; C3-B3 ($0F-$1A)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word $01AB, $0193, $017C, $0167, $0151, $013F, $012D, $011C, $010C, $00FD, $00EF, $00E2 ; C4-B4 ($1B-$26)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word $00D2, $00C9, $00BD, $00B3, $00A9, $009F, $0096, $008E, $0086, $007E, $0077, $0070 ; C5-B5 ($27-$32)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word $006A, $0064, $005E, $0059, $0054, $004F, $004B, $0046, $0042, $003F, $003B, $0038 ; C6-B6 ($33-$3E)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word $0034, $0031, $002F, $002C, $0029, $0027, $0025, $0023, $0021, $001F, $001D, $001B ; C7-B7 ($3F-$4A)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word $001A, $0018, $0017, $0015, $0014, $0013, $0012, $0011, $0010, $000F, $000E, $000D ; C8-B8 ($4B-$56)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word $000C, $000C, $000B, $000A, $000A, $0009, $0008&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; C9-F#9 ($57-$5D)</span><br style="font-family: Courier New;"><br>Notice
that at the highest octaves, some notes have the same value (C9 and C#9
for example).&#xA0; This is due to rounding.&#xA0; We lose precision the higher
we go, and a lot of the highest notes will sound out of tune as a
result.&#xA0; So in songs we probably wouldn&apos;t use octaves 8 and 9.&#xA0; These
high notes could be utilized for sound effects though, so we&apos;ll leave
them in.<br>&#xA0;&#xA0; &#xA0;<br>Once we have a note lookup table, we use the note
we want as an index into the table and pull the period values from it,
like this:<br>&#xA0;&#xA0; &#xA0;<br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$0C&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;the 13th entry in the table (A2)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply by 2 because we are indexing into a table of words</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table, y&#xA0;&#xA0; ;read the low byte of the period</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;write to SQ1_LO</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table+1, y ;read the high byte of the period</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4003&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;write to SQ1_HI</span><br>&#xA0;&#xA0; &#xA0;<br>To make it easier to know which index to use for each note, we can create a list of <b>symbols</b>:<br><br><span style="font-family: Courier New;">;Note: octaves in music traditionally start at C, not A</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">;Octave 1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">A1 = $00&#xA0;&#xA0;&#xA0; ;&quot;1&quot; means octave 1.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">As1 = $01&#xA0;&#xA0; ;&quot;s&quot; means &quot;sharp&quot;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">Bb1 = $01&#xA0;&#xA0; ;&quot;b&quot; means &quot;flat&quot;.&#xA0; A# == Bb</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">B1 = $02</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">;Octave 2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">C2 = $03</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">Cs2 = $04</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">Db2 = $04</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">D2 = $05</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;...</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">A2 = $0C</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">As2 = $0D</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">Bb2 = $0D</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">B2 = $0E</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">;Octave 3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">C3 = $0F</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;... etc</span><br><br>Now we can use our new symbols instead of the actual index values:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda <b>#A2</b>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;A2.&#xA0; #A2 will evaluate to #$0C</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply by 2 because we are indexing into a table of words</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table, y&#xA0;&#xA0; ;read the low byte of the period</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;write to SQ1_LO</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table+1, y ;read the high byte of the period</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4003&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;write to SQ1_HI</span><br>&#xA0;&#xA0; &#xA0;<br>And if later we want to have a series of notes, symbols are much easier to read and alter:<br><br><span style="font-family: Courier New;">sound_data:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte C3, E3, G3, B3, C4, E4, G4, B4, C5 ; Cmaj7 (CEGB)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_data_no_symbols:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $0F, $13, $16, $1A, $1B, $1F, $22, $26, $27 ;same as above, but hard to read. Cmaj7 (CEGB)</span><br>&#xA0;&#xA0; &#xA0;<br><br><b>Low Notes On Squares (Sweep Unit)</b><br>One
last thing needs to be mentioned.&#xA0; It&apos;s very important.&#xA0; It has to do
with the Square channels&apos; sweep units.&#xA0;&#xA0; The sweep units can silence
the square channels in certain situations (Periods &gt;= $400, our
lowest notes), <i>even when disabled</i>.&#xA0; We&apos;ll have to take a quick look at the sweep unit ports to solve this problem.<br><br><span style="font-family: Courier New;">SQ1_SWEEP ($4001), SQ2_SWEEP ($4005)</span><br style="font-family: Courier New;">
<br style="font-family: Courier New;">
<span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">||||||||</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">|||||+++- Shift</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">||||+---- Negate</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">|+++----- Sweep Unit Period</span><br style="font-family: Courier New;">
<span style="font-family: Courier New;">+-------- Enable (1: enabled; 0: disabled)</span><br><br>I&apos;m not going to go into how it works now, but the unwanted silencing of low notes can be circumvented by <b>setting the negate flag</b>:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$08&#xA0;&#xA0;&#xA0; ;set Negate flag on the sweep unit</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4001&#xA0;&#xA0; ;or $4005 for Square 2.</span><br>&#xA0;&#xA0; &#xA0;<br>If you really want to know why, check the Sweep Unit section of blargg&apos;s <a href="scraper/files/apu_ref.txt" target="_blank" original-href="http://www.slack.net/%7Eant/nes-emu/apu_ref.txt">NES APU Sound Hardware Technical Reference</a>.<br><br><b>What about PAL?</b><br>For
simplicity, these tutorials are going to use NTSC numbers.&#xA0; Once we
finish our sound engine I&apos;ll try to whip up a tutorial about adding PAL
support.<br><br><b>Putting It All Together</b><br>Download and unzip the <a href="downloads/NerdyNightsSoundSourceCollection/periods.zip" target="_blank" original-href="http://tummaigames.com/periods.zip">periods.zip</a>
sample files.&#xA0; Make sure periods.asm, periods.chr, note_table.i and
periods.bat are all in the same folder as NESASM3, then double click
periods.bat. That will run NESASM3 and should produce the periods.nes
file. Run that NES file in FCEUXD SP.&#xA0; Use the d-pad to select and play
any note from our note table on the Square 1 channel.&#xA0; Controls are as
follows:<br><br><b>Up</b> - Play selected note<br><b>Down</b> - Stop note<br><b>Left</b> - Move selection down a note<br><b>Right</b> - Move selection up a note<br><br><b>Homework</b>:
Edit periods.asm and add support for the Square 2 and Triangle
channels.&#xA0; Allow the user to select between channels and play different
notes on all three of them.<br><br><b>Homework #2</b>: Read Disch&apos;s document <a href="http://nesdevhandbook.googlepages.com/theframe.html" target="_blank" original-href="http://nesdevhandbook.googlepages.com/theframe.html">The Frame and NMIs</a>.&#xA0;
Pay special attention to the &quot;Take Full Advantage of NMI&quot; section.&#xA0; We
are going to use this style of NMI handler with our sound engine.&#xA0; In
fact, periods.asm already uses it.<br><br><b>Next Week</b>: <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=23024" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=23024">Starting our sound engine.</a><br><br><br><br><br><br>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#audio_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;audio_tutorial-3__comments&apos;);">
                            是否显示评论内容
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22776" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="audio_tutorial-3__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-3__1">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Dec 10, 2014 at 12:00:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The images in this document are broken links. Can someone repost the pics or fix the links? Thanks!<br>
<br>
<br>
Also, the link below is broken.<br>
<b>&quot;Homework #2</b>: Read Disch&apos;s document <a href="http://nesdevhandbook.googlepages.com/theframe.html" target="_blank" original-href="http://nesdevhandbook.googlepages.com/theframe.html">The Frame and NMIs</a>.&#xA0; Pay special attention to the &quot;Take Full Advantage of NMI&quot; section.&#xA0; We are going to use this style of NMI handler with our sound engine.&#xA0; In fact, periods.asm already uses it.&quot;<br>
<br>
EDIT: I think this is the new link: <a href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs">http://wiki.nesdev.com/w/index.ph...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-3__2">
                                                        <div class="mdl-card__title"><strong>freeman.pixelz</strong> posted on 
		
			
				
				Apr 11, 2016 at 4:16:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi,
<br>
<br>As the zip file is not downloadable, I tried to retrieve the values of E2, F2, E3, F3, G3, H3.
<br>
<br>Can someone tell me if these values are correct?
<br>
<br>;Octave 1
<br>A1 = $00    ;&quot;1&quot; means octave 1.
<br>As1 = $01   ;&quot;s&quot; means &quot;sharp&quot;
<br>Bb1 = $01   ;&quot;b&quot; means &quot;flat&quot;.  A# == Bb
<br>B1 = $02
<br>
<br>;Octave 2
<br>C2 = $03
<br>Cs2 = $04
<br>Db2 = $04
<br>D2 = $05
<br>
<br>E2 = $06
<br>Es2 = $07
<br>Fb2 = $07
<br>F2 = $08
<br>
<br>A2 = $0C
<br>As2 = $0D
<br>Bb2 = $0D
<br>B2 = $0E
<br>
<br>;Octave 3
<br>C3 = $0F
<br>Cs3 = $10
<br>Db3 = $10
<br>D3 = $11
<br>
<br>E3 = $12
<br>Es3 = $13
<br>Fb3 = $13
<br>F3 = $14
<br>
<br>G3 = $15
<br>Gs3 = $16
<br>Hb3 = $16
<br>H3 = $17
<br>
<br>A3 = $18
<br>As3 = $19
<br>Bb3 = $19
<br>B3 = $1A
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-3__3">
                                                        <div class="mdl-card__title"><strong>Mog</strong> posted on 
		
			
				
				Apr 11, 2016 at 5:15:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here is the zip file for part 3
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-3__4">
                                                        <div class="mdl-card__title"><strong>freeman.pixelz</strong> posted on 
		
			
				
				Apr 12, 2016 at 12:00:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank you Mog! <span class="sprites_emoticons absmiddle" id="emo_happy"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Nerdy Nights Sound: Part 4: sound engine skeleton</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b>Last Week</b>: <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22776" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22776">Periods, Lookup Tables</a><br><br><b>This Week</b>: Sound Engine Basics.&#xA0; We will setup the framework to get our sound engine running.<br><br><b><font size="4">Sound Engine</font></b><br><br>Now
that we know how to get notes to play we can start thinking about our
sound engine.&#xA0; What do we want it to be able to do?&#xA0; How will the main
program interact with it?<br><br>It&apos;s good practice to separate the
different pieces of your program.&#xA0; The sound engine shouldn&apos;t be
messing with main program code and vice-versa.&#xA0; If you mix them, your
code becomes harder to read, the danger of variable conflicts increases
and you open yourself up to hard-to-find bugs.&#xA0;&#xA0; If you keep the
different pieces of your program separate, you get the opposite: your
code reads well, you avoid variable conflicts, and bugs are easier to
trace.&#xA0; Separation also improves your ability to reuse code.&#xA0; If your
sound engine only accesses its own internal routines and variables, it
makes it that much easier to pull it out from one game and plug it into
another.<br><br>There has to be some communication between the main
program and the sound engine of course.&#xA0; The main program needs to be
able to tell the sound engine to do things like: &quot;Play song 2&quot; or &quot;shut
up&quot;.&#xA0; But we don&apos;t want the main program sticking its nose in the sound
engine&apos;s business.&#xA0; We only want it to issue commands.&#xA0; The sound
engine will handle the rest on its own.<br><br>To set this up, we will
create a small set of subroutines that the main program can use to
invoke the sound engine and give it commands.&#xA0; I&apos;ll call these
subroutines &quot;<b>entrances</b>&quot;.&#xA0; We want as few entrances into the
sound engine as possible.&#xA0; The sound engine itself will have several
internal subroutines it can work with, but the main program will only
use the entrances.<br><br><b>Entrances</b><br>So what will our entrance
subroutines be?&#xA0; We need to think about what the main program would
need to tell the sound engine to do.&#xA0; Here is a list of entrances we
might want for our sound engine:<br><br>-Initialize sound engine&#xA0;&#xA0;&#xA0; (sound_init)<br>-Load new song/sfx&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (sound_load)<br>-Play a frame of music/sfx&#xA0; (sound_play_frame)<br>-Disable sound engine&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (sound_disable)<br><br>The
names in paranthesis are what I&apos;m going to call the subroutines in
code.&#xA0; I prefixed them with sound_ for readability.&#xA0; You can tell at a
glance that they are sound routines.&#xA0; Here is a rundown of what our
commands will do:<br><br><b>sound_init</b> will enable channels and silence them.&#xA0; It will also initialize sound engine variables.<br><br><b>sound_load</b>
will take a song/sfx number as input.&#xA0; It will use that song number to
index into a table of pointers to song headers.&#xA0; It will read the
appropriate header and set up sound engine variables.&#xA0; If that didn&apos;t
make sense, don&apos;t worry.&#xA0; We&apos;ll be covering this stuff next week.<br><br><b>sound_play_frame</b>
will advance the sound engine by one frame.&#xA0; It will run the note
timers, read from the data streams (if necessary), update sound
variables and make writes to the APU ports.&#xA0; This stuff will also be
covered in future weeks.<br><b><br>
sound_disable</b> will disable channels via $4015 and set a disable flag variable.<br><br>We
already know enough to knock out two of those, sound_init and
sound_disable.&#xA0; Let&apos;s write them now.&#xA0; We&apos;ll write skeleton code for
the other entrance subroutines as well.&#xA0; A few things to mention before
we do that though:<br><br><b>RAM</b><br>A sound engine requires a lot
of RAM.&#xA0; A large sound engine might even take up a full page of RAM.&#xA0;
For this tutorial, we&apos;ll stick all our sound engine variables on the
$300 page of RAM.&#xA0; There is nothing magic about this number.&#xA0; I chose
$300 for convenience.&#xA0; $000 is your zero-page RAM.&#xA0; $100 is your
stack.&#xA0; If you completed the original Nerdy Nights series, $200 will be
your Sprite OAM.&#xA0; So $300 is next in line.<br><br><b>ROM</b><br>The
sound engine itself won&apos;t require a lot of ROM space for code, but if
you have a lot of music your song data might take up a lot of space.&#xA0;
For this reason, I&apos;m going to change our header to give us two 16k
PRG-ROM banks, like this:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .inesprg 2 ;2x 16kb PRG code</span><br>&#xA0;&#xA0; &#xA0;<br>Now
we have twice as much ROM space, just in case we need it.&#xA0; BTW, this is
the maximum amount of ROM we can have without using a mapper.<br>&#xA0;&#xA0; &#xA0;<br><b>Noise Channel</b><br>I
purposely haven&apos;t covered the Noise channel yet.&#xA0; We will want to
silence it in our init code though, so I will go ahead and teach that
much.&#xA0; Noise channel volume is controlled via port $400C.&#xA0; It works the
same as $4000/$4004 does for the Square channels, except there is no
Duty Cycle control:<br><br><span style="font-family: Courier New;">NOISE_ENV ($400C)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0; ||||||</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0; ||++++- Volume</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0; |+----- Saw Envelope Disable (0: use internal counter for volume; 1: use Volume for volume)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0; +------ Length Counter Disable (0: use Length Counter; 1: disable Length Counter)</span><br>&#xA0; <br>Like the Squares, we will silence the Noise channel by setting both disable flags, and setting the Volume to 0.<br>&#xA0;&#xA0; &#xA0;<br><b><font size="3">Skeleton Sound Engine</font></b><br>Let&apos;s
write the entrance subroutines to our sound engine.&#xA0; Most of this code
should be very familiar to you if you completed the first three
tutorials in this series.<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .rsset $0300 ;sound engine variables will be on the $0300 page of RAM</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_disable_flag&#xA0; .rs 1&#xA0;&#xA0; ;a flag variable that keeps track of whether the sound engine is disabled or not.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if set, sound_play_frame will return without doing anything.</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .bank 0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .org $8000&#xA0; ;we have two 16k PRG banks now.&#xA0; We will stick our sound engine in the first one, which starts at $8000.</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_init:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$0F</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4015&#xA0;&#xA0; ;enable Square 1, Square 2, Triangle and Noise channels</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$30</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4000&#xA0;&#xA0; ;set Square 1 volume to 0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4004&#xA0;&#xA0; ;set Square 2 volume to 0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400C&#xA0;&#xA0; ;set Noise volume to 0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$80</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4008&#xA0;&#xA0; ;silence Triangle</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_disable_flag&#xA0; ;clear disable flag</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;later, if we have other variables we want to initialize, we will do that here.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_disable:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4015&#xA0;&#xA0; ;disable all channels</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$01</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_disable_flag&#xA0; ;set disable flag</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_load:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;nothing here yet</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_play_frame:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_disable_flag</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .done&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if disable flag is set, don&apos;t advance a frame</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;nothing here yet</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.done:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br style="font-family: Courier New;"><br>&#xA0;&#xA0; &#xA0;<br><b>Driving the Sound Engine</b><br>We
have the framework setup for our sound engine to run.&#xA0; The main program
now has subroutines it can call to issue commands to the sound engine.&#xA0;
Most of them don&apos;t do anything yet, but we can still integrate them
into the main program.&#xA0; First we will want to make a call to sound_init
somewhere in our reset code:<br><br><span style="font-family: Courier New;">RESET:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sei</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cld</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldx #$FF</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; txs</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; inx</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;... clear memory, etc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr sound_init</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;... more reset stuff</span><br>&#xA0;&#xA0; &#xA0;<br>Next
we need something to drive our sound engine.&#xA0; Music is time-based.&#xA0; In
any piece of music, assuming a constant tempo, each quarter note needs
to last exactly as long as every other quarter note.&#xA0; A whole note has
to be exactly as long as four quarter notes.&#xA0; If our sound engine is
going to play music, it needs to be time-based as well.&#xA0; We have a
subroutine, sound_play_frame, that will advance our sound engine a
frame at a time.&#xA0; Now we need to ensure it gets called repeatedly at a
regular time interval.<br><br>One way to do this is to stick it in the
NMI.&#xA0; Recall that when enabled, the NMI will trigger at the start of
every vblank.&#xA0; Vblank is the only safe time to write to the PPU, so the
NMI is typically full of drawing code.&#xA0; We don&apos;t want to waste our
precious vblank time running sound code, but what about after we are
finished drawing?&#xA0; If we stick our call to sound_play_frame at the end
of NMI, after the drawing code, we are set.&#xA0; sound_play_frame gets
called once per frame, and we avoid stepping on the PPU&apos;s toes.&#xA0; And
since sound_play_frame doesn&apos;t write to the PPU registers, it doesn&apos;t
matter if our sound code spills out of vblank. &#xA0;<br><br>Let&apos;s setup the NMI to drive our sound engine:<br><br><span style="font-family: Courier New;">NMI:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; pha&#xA0;&#xA0;&#xA0;&#xA0; ;save registers</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; txa</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; pha</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tya</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; pha</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do sprite DMA</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;update palettes if needed</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;draw stuff on the screen</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;set scroll</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr sound_play_frame&#xA0;&#xA0;&#xA0; ;run our sound engine after all drawing code is done.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this ensures our sound engine gets run once per frame.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sleeping&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;did you do your homework and read Disch&apos;s document last week?</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;<a href="http://nesdevhandbook.googlepages.com/theframe.html" target="_blank" original-href="http://nesdevhandbook.googlepages.com/theframe.html">http://nesdevhandbook.googlepages...</a></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; pla&#xA0;&#xA0;&#xA0;&#xA0; ;restore registers</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; pla</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tax</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; pla</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rti</span><br><b><br>
.include</b><br>To further separate our sound engine from the main
program, we can keep all our sound engine code in a separate file.&#xA0;
NESASM3 gives us a directive .include that we can use to copy a source
file into our main program.&#xA0; We actually used this directive last week
to include the note_table.i file, which contained our period lookup
table. &#xA0;<br><br>Using .include to copy a source file into our code is
very similar to how we use .incbin to import a .chr file.&#xA0; Assuming our
sound engine code is saved in a file called sound_engine.asm, we will
add the following code to our main program:<br>&#xA0;&#xA0; &#xA0;<br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .include &quot;sound_engine.asm&quot;</span><br><br>We
will continue to include note_table.i, but since it is part of our
sound engine we will stick the .include directive in the
sound_engine.asm file.<br><br>It&apos;s not bad practice to use includes a
lot.&#xA0; You can pull your joypad routines out and stick them in their own
file.&#xA0; You can have separate files for your gamestate code, for your
PPU routines and for just about anything else you can think of.&#xA0;
Breaking up your code like this will make it easier to find things as
your program gets larger and more complicated.&#xA0; It also makes it easier
to plug your old routines into new programs.<br>&#xA0;&#xA0; &#xA0;<br><b>Putting It All Together</b><br>Download
and unzip the <a href="downloads/NerdyNightsSoundSourceCollection/skeleton.zip" target="_blank" original-href="http://tummaigames.com/skeleton.zip">skeleton.zip</a> sample files.&#xA0; Make sure skeleton.asm,
sound_engine.asm, skeleton.chr, note_table.i, sound_data.i and
skeleton.bat are all in the same folder as NESASM3, then double click
skeleton.bat. That will run NESASM3 and should produce the skeleton.nes
file. Run that NES file in FCEUXD SP.<br><br>I&apos;ve hardcoded sound_load
and sound_play_frame to play a little melody on the Square 1 channel.&#xA0;
It uses a simple frame counter to control note speed.&#xA0; The data for the
music is found in the sound_data.i file.&#xA0;&#xA0; Use the controller to
interact with the sound engine.&#xA0; Controls are as follows:<br>&#xA0;&#xA0; &#xA0;<br><span style="font-weight: bold;">A</span>: Play sound from the beginning (sound_load)<br><span style="font-weight: bold;">B</span>: Initialize the sound engine (sound_init)<br><span style="font-weight: bold;">Start</span>: Disable sound engine (sound_disable)<br><br>Try
editing sound_engine.asm to change the data stream that
sound_play_frame reads from.&#xA0; The different data streams available are
located in sound_data.i.&#xA0; Try adding your own data stream to
sound_data.i too.&#xA0; Use the note symbols we made last week and terminate
your data stream with $FF.<br><br><b>Homework</b>: Write two new sound engine entrance subroutines for the main program to use:<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1. sound_pause: pauses playback of the sound, but retains the current position in the data stream.<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 2. sound_unpause: if the sound is currently paused, resumes play from the saved position.<br>Then modify handle_joypad to allow the user to pause/unpause the music.<br><br><b>Homework #2</b>: If the ideas presented in Disch&apos;s <a href="http://nesdevhandbook.googlepages.com/theframe.html" target="_blank" original-href="http://nesdevhandbook.googlepages.com/theframe.html">The Frames and NMIs</a> document are still fuzzy in your head, read it again. <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"><br><br><b>Extra Credit</b>:&#xA0;
See if you can understand how my drawing buffer works.&#xA0; Use Disch&apos;s
document to help you.&#xA0; I won&apos;t cover drawing buffers in these sound
tutorials, for obvious reasons, but it is definitely worth your time to
learn how to use them.<br>&#xA0;&#xA0; &#xA0;<br><b>Next week</b>: <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=23452" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=23452">Sound Data, Pointer Tables, Headers</a><br>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#audio_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;audio_tutorial-4__comments&apos;);">
                            是否显示评论内容
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=23024" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="audio_tutorial-4__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__1">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Sep 4, 2009 at 3:53:13 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is pretty neat. I may neat to rewrite my NMI: I&apos;ve read Disch&apos;s document, but don&apos;t quite understand everything he does in it. I&apos;m hesitant to change my NMI right now, just cause it&apos;ll probably break my game since I don&apos;t understand what&apos;s all happening there yet.
<br>
<br>should a sound engine always go in the first bank? I&apos;m pretty sure the code runs banks in order, and since music can take a long time, you may always want the sound to run first. 
<br>
<br>the .i files gave me some trouble at first, cause I couldn&apos;t open them with windows, so I made copies of them and converted them to .txt files so I could look at them in notepad. I can see what they&apos;re doing now, so I&apos;m pretty sure I can write a different tune to play. According to the sound_data.1, it&apos;s playing 17 ascending notes on the 3 channels then writing $FF which I assume is a flag to stop.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__2">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Sep 4, 2009 at 5:56:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>udisi</b></i><br><br>This is pretty neat. I may neat to rewrite my NMI: I&apos;ve read Disch&apos;s document, but don&apos;t quite understand everything he does in it. I&apos;m hesitant to change my NMI right now, just cause it&apos;ll probably break my game since I don&apos;t understand what&apos;s all happening there yet.
<br></div><br>Keep rereading it and it will eventually click.&#xA0; That&apos;s been my experience with NES documents <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">.&#xA0; You can probably get away with not rewriting your NMI as long as you are able to stick the call to the sound engine in there somewhere to ensure the sound engine is run once per frame.<br><br><br><div class="FTQUOTE"><i>Originally posted by: <b>udisi</b></i><br><br>should a sound engine always go in the first bank? I&apos;m pretty sure
the code runs banks in order, and since music can take a long time, you
may always want the sound to run first. <br></div><br><br>It doesn&apos;t matter.&#xA0; You can stick the sound engine anywhere.&#xA0; The order the code is run doesn&apos;t have to anything to do with bank order.&#xA0; On startup, code execution starts at the address you state in the RESET vector.&#xA0; Then it executes one instruction at a time, only jumping/branching where you explicitly tell it to jump.<br><br>If you were using a mapper, you&apos;d probably want your sound engine in a swappable bank rather than the fixed bank, but other than that it doesn&apos;t matter where you stick it.<br><br><div class="FTQUOTE">the .i files gave me some trouble at first, cause I couldn&apos;t open
them with windows, so I made copies of them and converted them to .txt
files so I could look at them in notepad. I can see what they&apos;re doing
now, so I&apos;m pretty sure I can write a different tune to play.</div><br>Sorry about that.&#xA0; I&apos;ve seen other people put a .i extension on their includes so I was just copying the convention.&#xA0; They&apos;re just text files.&#xA0;&#xA0; You should be able to open them from Notepad&apos;s File-&gt;Open without changing their extension.<br><br><div class="FTQUOTE">&#xA0;According
to the sound_data.1, it&apos;s playing 17 ascending notes on the 3 channels
then writing $FF which I assume is a flag to stop.</div><br>Almost.&#xA0; If you look at sound_play_frame in sound_engine.asm, you&apos;ll see that I only write to the Square 1 channel.&#xA0; The different data streams just play a different variety of ascending notes.&#xA0; You&apos;re right about $FF.&#xA0; It terminates the data streams.<br><br>Try tracing through sound_play_frame and see if you can follow what it&apos;s doing.&#xA0; Feel free to ask more questions if there&apos;s something that&apos;s still unclear. <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__3">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Sep 14, 2009 at 1:08:59 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					well, I have the skeleton sound engine in my game now. The sound_play_frame works fine in my NMI. It doesn&apos;t interfere with anything that I can see. I have it play the scale when the game comes on and I can still use the controller buttons, so this works better than what I had tried before.
<br>
<br>I set the sound engine to disable when I select something. My plan being I can re-enable and load a different scale when the next screen comes up. we&apos;ll see.
<br>
<br>I was looking at the sound engine code itself, and thinking of making a variable to control looping. Like if gamestate is still the same, then loop. kinda treating the scale as a song. 
<br>
<br>Probably thinking ahead a bit here, but I was trying to see how to have a song play and still have soundfx. since sound fx will use the same channel as a song, I need to come up with a way to still progress the song data, but mute it and load the sound fx, and then return to the song when the soundfx is done.
<br>
<br>Still playing with this a bit, looking at what of things may be useful as a variable. maybe a tempo variable, to handle the CMP frame. 
<br>
<br>I assume that future tutorial will add the other channels in. I have someone who did music for me. The songs are done with a tracker program though and in NSF, so I&apos;m thinking they may need to be re-written to work in this engine. I&apos;d use the NSF player route, but I don&apos;t know how I&apos;d do that and still be able to use soundfx. 
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__4">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Sep 14, 2009 at 9:25:23 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>udisi</b></i><br><br>well, I have the skeleton sound engine in my game now. The sound_play_frame works fine in my NMI. It doesn&apos;t interfere with anything that I can see. I have it play the scale when the game comes on and I can still use the controller buttons, so this works better than what I had tried before.
<br><br>I set the sound engine to disable when I select something. My plan being I can re-enable and load a different scale when the next screen comes up. we&apos;ll see.
<br>
<br>I was looking at the sound engine code itself, and thinking of making a variable to control looping. Like if gamestate is still the same, then loop. kinda treating the scale as a song. 
<br>
<br>Probably thinking ahead a bit here, but I was trying to see how to have a song play and still have soundfx. since sound fx will use the same channel as a song, I need to come up with a way to still progress the song data, but mute it and load the sound fx, and then return to the song when the soundfx is done.
<br>
<br>Still playing with this a bit, looking at what of things may be useful as a variable. maybe a tempo variable, to handle the CMP frame. 
<br>
<br>I assume that future tutorial will add the other channels in. I have someone who did music for me. The songs are done with a tracker program though and in NSF, so I&apos;m thinking they may need to be re-written to work in this engine. I&apos;d use the NSF player route, but I don&apos;t know how I&apos;d do that and still be able to use soundfx. 
<br></div><br>Glad the the engine is working with your game.&#xA0; Good comments too.&#xA0; You already forsee some of the complications we&apos;ll run into.&#xA0; Some responses to your comments:<br><br>1) You likely won&apos;t ever need to disable the sound engine.&#xA0; Sound effects will terminate on their own when they finish playing.&#xA0; For forever-looping songs you&apos;ll be able to switch to a new song whenever you want.&#xA0; If for some reason you&apos;d want no song to play, you could have a &quot;silence song&quot; that will hush up the music channels.<br><br>2) We&apos;ll get to looping in a future lesson, but the way we&apos;ll do it is by having an opcode in the music data that will tell the sound engine to jump back to an earlier part in the data stream.&#xA0; <br><br>3) Dealing with channel conflicts between music and sfx is very important.&#xA0; I&apos;m going to talk about it a bit in the next lesson (which is almost finished).&#xA0; The way we&apos;ll handle it is to have the music and sfx both running their streams in RAM, but when it comes time to write to the APU regs we&apos;ll make sure the sfx data gets written instead of the music.<br><br>4) The simple frame counter that we have in the skeleton sound engine isn&apos;t what we will use in the end.&#xA0; It has a lot of problems, the biggest one being that it doesn&apos; let us have variable note lengths (8th note vs. quarter note).&#xA0; Timing, note lengths and tempo will be the topics covered in the the lesson after the next one.<br><br>5) Yes, future tutorials will add the other channels in.&#xA0; The next lesson will let us make basic little songs that play on all three tonal channels (Sq1, Sq2, Tri).&#xA0; The next 3 lessons are the really big ones.&#xA0; This is the tentative syllabus:<br><br>Part 5 - Pointer tables, playing on multiple channels at once, music/sfx channel conflicts<br>Part 6 - Timing, note length and tempo, buffering APU writes (maybe?), rests?<br>Part 7 - Opcodes, RTS Trick, Looping<br>Part 8 - Volume Envelopes, Transposing<br>Part 9 - Noise channel?<br>Part 10+ - other bells and whistles<br><br>6) You will have to convert the songs in your NSF to fit the music format of our sound engine.&#xA0; It&apos;s unavoidable.&#xA0; On the NES, every game has a different sound engine with a different format for its sound data.&#xA0; NSF files for game music actually include the game&apos;s sound engine in the file.&#xA0; But as long as you know the notes, note lengths and effects, it should be pretty easy to convert.<br><br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__5">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Sep 14, 2009 at 3:22:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I swear the sound engine is as big and complicated at the game itself <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
<br>some many things to handle. I&apos;m just trying to stick with the sound engine to learn how the sound truly works and to be able to have sfx and music at the same time.
<br>
<br>I can see why a lot of homebrew go the NSF player route. basically just have to tell a song to play. The bad thing with the nsf way is that the music engine is hidden. You have no idea what&apos;s going on to make the sound actually happen, and I don&apos;t think you have the versatility to play songs, and sfx at the same time. 
<br>
<br>Anyway, I went in and added my variable to handle which sfx to play, and added my sfx to the sound data file. so now the nerdy nights engine is running my sounds. Good thing I only had 2 different beeps at <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
<br>
<br>basically handle it like this. I initiate sound when the screen is loaded, then in my program when I wanted to call the sfx I wrote this
<br>
<br>LDA #$01
<br>STA sfx
<br>jsr sound_load
<br>
<br>or 
<br>
<br>LDA #$02
<br>STA sfx
<br>jsr sound_load
<br>
<br>I added a series of branches in the sound engine to check the sfx variable then load the corresponding data stream.
<br>
<br>I had to adjust the frame counter as checking every 8 frames was too slow. ended up making it 4. Now you said you are going to implement a new timing thing later, but for now, I was thinking another variable would work here. nae it something like &quot;time&quot; and add it to my call routine. something like this.
<br>
<br>LDA #$04
<br>STA time
<br>LDA #$01
<br>STA sfx
<br>jsr sound_load
<br>
<br>it should work well for sfx, but songs will probably change timings mid load and such, so I&apos;m looking forward to seeing how this will be handled.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__6">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Sep 15, 2009 at 9:40:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes a sound engine is pretty complicated, which I guess is the reason there aren&apos;t any tutorials for making one yet.
<br>
<br>I&apos;ve never actually used the FamiTracker engine in a game, but I&apos;ve heard that it doesn&apos;t have sfx support.  Writing my own sound engine has been more fun anyway <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
<br>
<br>Glad to see you are playing around with the engine and coming up with solutions to select a sound and a speed.  One thing you can do to save some bytes is to put the stores inside the sound_load routine:
<br>
<br>    ldy #$04 ;time
<br>    lda #$01 ;sfx number
<br>    jsr sound_load
<br>
<br>;...
<br>sound_load:
<br>    sty time
<br>    sta sfx
<br>    ; do other load stuff
<br>
<br>Having the subroutine take parameters in A and Y and do the stores itself will save you the trouble of having to manually store them everytime.
<br>
<br>I finished up Part 5 today.  Will post it tonight (Japan time).  It&apos;s the toughest one so far, but it teaches some really important techniques.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__7">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				Sep 20, 2009 at 5:46:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for posting this; great stuff. I wish I&apos;d had Disch&apos;s NMI doc when I was first getting started <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">. I have been totally slacking off with programming and everything else NES-related, but now I see that I must get back to it!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__8">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Sep 21, 2009 at 3:16:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Rachel</b></i><br><br>Thanks for posting this; great stuff. I wish I&apos;d had Disch&apos;s NMI doc when I was first getting started <img src border="0" complete="true" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">. I have been totally slacking off with programming and everything else NES-related, but now I see that I must get back to it!</div><br><br>Rachel lives!!!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__9">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 28, 2012 at 10:57:06 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Question: In the description of the add_to_dbuffer subroutine, you say the following:
<br>
<br>;   Note:   dbuffer starts at $0100.  This is the stack page.  The
<br>;               stack counts backwards from $1FF, and this program is small enough that there
<br>;               will never be a conflcit.  But for larger programs, watch out.
<br>
<br>
<br>What does this mean?  In the add_to_dbuffer and draw_dbuffer subroutines you appear to be reading everything from $0100 until you hit the termination control (#$00) for a string length.  I understand that in this situation we can only have from $0100 to $01FF in RAM for the stack (and therefore that is the maximum length of a buffer) because the sprite shadow OAM is in $0200 - $02FF, but I don&apos;t see anything in here that indicates there is a &quot;counting backwards&quot; sequence and I don&apos;t know what sort of trouble we could run into here.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__10">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Mar 1, 2012 at 12:30:23 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div>
	The trouble comes from the fact that we have two different arbitrarily-sized things (the drawing buffer and the stack) using the same page of RAM. &#xA0;There is a potential for conflict if they cross.</div>
<div>
	&#xA0;</div>
<div>
	The 6502 uses the $0100-$01FF range of RAM for the stack. &#xA0;The bottom of the stack is $01FF and when values are &quot;pushed&quot; onto the stack, they are placed in memory in descending memory addresses. &#xA0;So for example, say we have an empty stack and we push some values to it like this:</div>
<div>
	&#xA0;</div>
<div>
	lda #$01</div>
<div>
	pha</div>
<div>
	lda #$02</div>
<div>
	pha</div>
<div>
	lda #$03</div>
<div>
	pha</div>
<div>
	&#xA0;</div>
<div>
	After this code is executed the stack in memory would look like this:</div>
<div>
	$01FD: #03</div>
<div>
	$01FE: #02</div>
<div>
	$01FF: #01</div>
<div>
	&#xA0;</div>
<div>
	The first value is pushed into $01FF, then the next value into $01FE, and so on in reverse order. &#xA0;That&apos;s what I meant by &quot;counting backwards&quot;.</div>
<div>
	&#xA0;</div>
<div>
	You can push values onto the stack manually with PHA, but the 6502 also pushes things onto the stack automatically behind the scenes. &#xA0;For example, every time you call a subroutine with JSR, the 6502 will push a 2-byte return address onto the stack. &#xA0;This allows the program to know where to return to when it encounters an RTS command.</div>
<div>
	&#xA0;</div>
<div>
	So there is a danger anytime you choose to use the $0100 page of RAM to store game-related variables. &#xA0;If you accidentally overwrite a memory location that is currently in use by the stack, things can go terribly wrong. &#xA0;Look at the following code, assuming an empty stack:</div>
<div>
	&#xA0;</div>
<div>
	jsr my_subroutine</div>
<div>
	&#xA0;</div>
<div>
	; blah blah blah</div>
<div>
	&#xA0;</div>
<div>
	my_subroutine:</div>
<div>
	&#xA0; &#xA0;lda #$00</div>
<div>
	&#xA0; &#xA0;sta $01FF</div>
<div>
	&#xA0; &#xA0;rts</div>
<div>
	&#xA0;</div>
<div>
	Here we call a subroutine with JSR, which pushes a 2-byte address onto the stack at $01FF and $01FE. &#xA0;Then in the subroutine we change the value of $01FF. &#xA0;When the program hits the RTS, it will pop the 2-byte return address off of the stack, but that address will be the wrong address (because we foolishly changed it!).</div>
<div>
	&#xA0;</div>
<div>
	In practice, the stack usually doesn&apos;t grow very deep. &#xA0;Anything pushed onto the stack is usually popped off soon after. &#xA0;I&apos;ve never seen the stack come even close to using all 256 bytes of the $0100 page. &#xA0;Since memory is tight on the NES, it&apos;s quite common for programmers to use the &quot;front&quot; half of the $0100 page for game variables (like a drawing buffer) rather than seeing that RAM go to waste.</div>
<div>
	&#xA0;</div>
<div>
	Hope that clears it up. &#xA0;Let me know if you have any questions or need more clarification.s</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__11">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Mar 1, 2012 at 12:59:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That totally makes sense   I guess I had assumed that the stack usage in programs was negligible as you mentioned so I didn&apos;t know when they would cross but I suppose some data streams could come close if we&apos;re not careful. Thanks for the follow up, and for the audio tutorials!  There&apos;s a lot of good information here and I really feel like I&apos;ll be well equipped to get some homebrews brewin in no time <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__12">
                                                        <div class="mdl-card__title"><strong>tadashibashi</strong> posted on 
		
			
				
				Oct 31, 2014 at 1:20:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am really interested in seeing the source file for the sound driver. The download link/website seems to be down, does anyone happen to have the file?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__13">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Nov 4, 2014 at 10:21:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oops!  I forgot that I was hosting something important on that domain and let it expire.  I just re-purchased the domain, so it should be back up.  Really sorry about that!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__14">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Nov 6, 2014 at 4:29:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>MetalSlime</b></i><br>
	<br>
	Oops! I forgot that I was hosting something important on that domain and let it expire. I just re-purchased the domain, so it should be back up. Really sorry about that!</div>
<br>
Hi MetalSlime!<br>
<br>
It is very welcome if you publish these files again. I find your tutorials really interesting!<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__15">
                                                        <div class="mdl-card__title"><strong>NESMASTER14</strong> posted on 
		
			
				
				Nov 22, 2014 at 9:05:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Wow, just saw that the files have been re-hosted again. Thank you! Now I can go through the tutorials again with the proper files. These are great!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__16">
                                                        <div class="mdl-card__title"><strong>Baka94</strong> posted on 
		
			
				
				Dec 1, 2014 at 11:08:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>MetalSlime</b></i><br courier font-family:>
	<span courier font-family:>&#xA0;&#xA0;&#xA0; sta sleeping&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;did you do your homework and read Disch&apos;s document last week?</span><br courier font-family:>
	<span courier font-family:>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;<a href="http://nesdevhandbook.googlepages.com/theframe.html" target="_blank" original-href="http://nesdevhandbook.googlepages.com/theframe.html">http://nesdevhandbook.googlepages.com/theframe.html</a></span></div>
<div>
	The document doesn&apos;t exist anymore. Any else place where I can read the same stuff? What is it about? Just general NMI stuff? I&apos;d like to know so I know if I have learned this stuff (maybe just in different way?).<br>
	<br>
	EDIT: Wait, is this just the thing that is used to prevent main loop from running more than once per frame?</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__17">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Dec 1, 2014 at 2:18:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Baka94</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>MetalSlime</b></i><br courier font-family:>
<span courier font-family:>&#xA0;&#xA0;&#xA0; sta sleeping&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;did you do your homework and read Disch&apos;s document last week?</span><br courier font-family:>
<span courier font-family:>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;<a href="http://nesdevhandbook.googlepages.com/theframe.html" target="_blank" original-href="http://nesdevhandbook.googlepages.com/theframe.html">http://nesdevhandbook.googlepages.com/theframe.html</a></span></div><br><br><div>The document doesn&apos;t exist anymore. Any else place where I can read the same stuff? What is it about? Just general NMI stuff? I&apos;d like to know so I know if I have learned this stuff (maybe just in different way?).<br>
<br>
EDIT: Wait, is this just the thing that is used to prevent main loop from running more than once per frame?</div>
</div>
<br>
<br>
<a href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs">http://wiki.nesdev.com/w/index.ph...</a> &#xA0;&lt;--- Thar ye&apos;s be&apos;s!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-4__18">
                                                        <div class="mdl-card__title"><strong>Viclordbelial</strong> posted on 
		
			
				
				Apr 19, 2018 at 11:11:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi All,<br>
<br>
I search the skeleton.zip originally wrote for NESASM3. Some one know somewhere I can find this? The link is broken.<br>
<br>
I found an Nerdy Nights ca65 Remix at <a href="https://bitbucket.org/ddribin/nerdy-nights/src" target="_blank" original-href="https://bitbucket.org/ddribin/nerdy-nights/src">https://bitbucket.org/ddribin/ner...</a>. but not the original file. I try to recreate it from ca65 files, but I have difficulties.
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="audio_tutorial-5">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Nerdy Nights Sound: Part 5: Sound Data, Pointer Tables, Headers</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b>Last Week</b>: <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=23024" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=23024">Sound Engine Basics, Skeleton sound engine</a><br><br><b>This Week</b>: Sound Data, Pointer Tables, Headers<br><br><font size="4"><b>Designing Sound Data</b></font><br><br>We
have a skeleton sound engine in place.&#xA0; Time to pack it with flesh and
organs.&#xA0; Before we can play a song, we will have to load a song.&#xA0;
Before we can load a song, we will need song data.&#xA0; So our next step is
to decide how our sound data will look.&#xA0; We&apos;ll need to design our data
format, create some test data and then build our engine to read and
play that data.<br><br><b>Data Formats</b><br>So how do we go about
designing a sound data format?&#xA0; A good place to start would be to look
at what we are aiming to play.&#xA0; We know that our sound engine will have
two basic types of sound data:<br><br>1. Music<br>2. Sound Effects (SFX)<br><br><i>Music</i> plays in the background.&#xA0; It uses the first 4 channels, has a tempo, and usually loops over and over again.<br><br><i>Sound Effects</i> are triggered by game events (eg, ball hitting a paddle) and don&apos;t loop indefinitely.<br><br>Sound
effects have the job of communicating to the player what is going on
right now, so they have priority over music.&#xA0; If there is music playing
on the Square 2 channel, and a sound effect is also using the Square 2
channel, the sound effect should play instead of the music.<br><br>Depending
on the game, some sound effects may have higher priority than others.&#xA0;
For example, in a Zelda-like game the sound of the player taking damage
would have priority over the sound of the player swinging their sword.&#xA0;
The former communicates critical information to the player while the
latter is just for effect.<br><br><b>Streams</b><br>As mentioned above,
a sound effect will have to share a channel (or channels) with the
music.&#xA0; This is unavoidable because music typically uses all the
channels at once, all the time.&#xA0; So when a sound effect starts playing,
it has to steal a channel (or more) away from the music.&#xA0; The music
will continue to play on the other channels, but the shared channel
will go to the sound effect.&#xA0; This creates an interesting problem: if
we stop music on a channel to play a sound effect, how do we know where
to resume the music on that channel when the sound effect is finished?<br><br>The
answer is that we don&apos;t actually stop the music on the shared channel.&#xA0;
We still advance it frame by frame in time with the other music
channels.&#xA0; We just don&apos;t write its data to the APU ports when a sound
effect is playing.<br><br>To do this, we will need to keep track of multiple streams of sound data.&#xA0; A data <b>stream</b>
is a sequence of bytes stored in ROM that the sound engine will read
and translate into APU writes.&#xA0; Each stream corresponds to one
channel.&#xA0; Music will have 4 data streams - one for each channel.&#xA0; Sound
effects will have 2 streams and the sfx themselves will choose which
channel(s) they use.&#xA0; So 6 streams total that could potentially be
running at the same time.&#xA0; We will number them like this:<br><br><span style="font-family: Courier New;">MUSIC_SQ1 = $00 ;these are stream number constants</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">MUSIC_SQ2 = $01 ;stream number is used to index into stream variables (see below)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">MUSIC_TRI = $02</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">MUSIC_NOI = $03</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">SFX_1&#xA0;&#xA0;&#xA0;&#xA0; = $04</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">SFX_2&#xA0;&#xA0;&#xA0;&#xA0; = $05</span><br><br><br>Each
stream will need it&apos;s own variables in RAM.&#xA0; An easy way to organize
this is to reserve RAM space in blocks and use the stream number as an
index: <br><br><span style="font-family: Courier New;">;reserve 6 bytes each, one for each stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream_curr_sound .rs 6&#xA0;&#xA0;&#xA0;&#xA0; ;what song/sfx # is this stream currently playing?&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream_channel .rs 6&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;what channel is it playing on?</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream_vol_duty .rs 6&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;volume/duty settings for this stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream_note_LO .rs 6&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;low 8 bits of period for the current note playing on the stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream_note_HI .rs 6&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;high 3 bits of the note period</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;..etc</span><br><br>Here we have 6 bytes reserved for each variable.&#xA0; Each stream gets its own byte, for example:<br>&#xA0;&#xA0;&#xA0; stream_vol_duty+0:&#xA0; MUSIC_SQ1&apos;s volume/duty settings<br>&#xA0;&#xA0;&#xA0; stream_vol_duty+1:&#xA0; MUSIC_SQ2&apos;s volume/duty<br>&#xA0;&#xA0;&#xA0; stream_vol_duty+2:&#xA0; MUSIC_TRI&apos;s on/off<br>&#xA0;&#xA0;&#xA0; stream_vol_duty+3:&#xA0; MUSIC_NOI&apos;s volume<br>&#xA0;&#xA0;&#xA0; stream_vol_duty+4:&#xA0; SFX_1&apos;s volume/duty<br>&#xA0;&#xA0;&#xA0; stream_vol_duty+5:&#xA0; SFX_2&apos;s volume/duty<br>&#xA0;&#xA0; &#xA0;<br>In our sound_play_frame code we will loop through all of the streams using the stream number as an index:<br>&#xA0;&#xA0; &#xA0;<br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldx #$00&#xA0;&#xA0;&#xA0; ;start at stream 0 (MUSIC_SQ1)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;read from data stream in ROM if necessary</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;update stream variables based on what we read</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_vol_duty, x&#xA0; ;the value in x determines which stream we are working with</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do stuff with volume</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_note_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do stuff with note periods</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do more stuff with other variables</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; inx&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;next stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cpx #$06&#xA0;&#xA0;&#xA0; ;loop through all six streams</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .loop</span><br><br>The
music streams will always be running, updating the APU ports with their
data frame by frame.&#xA0; When a sound effect starts playing, one or both
of the sfx streams will start running.&#xA0; Because our loop processes the
SFX streams last, they will write to the APU last and thus overwrite
the shared-channel music streams.&#xA0; Our channel conflict is taken care
of automatically by the order of our loop!<br>&#xA0;&#xA0; &#xA0;<br><font size="4"><b>Music</b></font><br>We
now have an idea of how our stream data will be stored in RAM, but
there are still many unanswered questions.&#xA0; How do we load a song?&#xA0; How
do we know where to find the data streams in ROM?&#xA0; How do we read from
those data streams?&#xA0; How do we interpret what we read from those
streams?<br><br>To answer these questions, we need to make a data
format.&#xA0; Let&apos;s start with music.&#xA0; What should our music data look
like?&#xA0; Most NES music data is divided into three types:<br><br>1. <b>Note</b> - what note to play: A3, G#5, C2, etc<br>2. <b>Note Length</b> - how long to play the notes: eighth note, quarter note, whole note, etc<br>3. <b>Opcodes</b> - opcodes tell the engine to perform specific tasks: loop, adjust volume, change Duty Cycle for squares, etc<br>*3.5. <b>Arguments</b> - some opcodes will take arguments as input (e.g. how many times to loop, where to loop to).<br><br><b>Ranges</b><br>We
will need to design our data format to make it easy for the sound
engine to differentiate between these three types of data.&#xA0; We do this
by specifying ranges.&#xA0; For example, we might say that byte values of
$00-$7F represent Notes.&#xA0; $80-$9F are Note Lengths, and $A0-$FF are
opcodes.&#xA0; I just made those numbers up.&#xA0; It really doesn&apos;t matter what
values we use.&#xA0; The important thing is that we have ranges to test
against to determine whether a byte is a note, note length or opcode.&#xA0;
In our engine code we will have something like this:<br><br><span style="font-family: Courier New;">fetch_byte:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_pointer], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read a byte from the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bpl .note&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if &lt; #$80, it&apos;s a Note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .note_length&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else if &lt; #$A0, it&apos;s a Note Length</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.opcode:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else it&apos;s an opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Opcode stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note_length:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Note Length stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Note stuff</span><br>&#xA0;&#xA0; &#xA0;<br>This
code reads a byte from the sound data and then tests that byte to see
which range it falls into.&#xA0; It jumps to a different section of code for
each possible range.&#xA0; Almost any data format you create will be divided
into ranges like this, whether it be sound data, map data, text data,
whatever.<br><br><b>BPL and BMI</b><br>These two branch instructions
are worth learning if you don&apos;t know them already.&#xA0; After BEQ, BNE, BCS
and BCC they are the most common branch instructions.&#xA0; They are often
used in range-testing.<br><br><b>BPL</b> tests the Negative (N) flag
and will branch if it is clear.&#xA0; Think of BPL as Branch if PLus.&#xA0; The N
flag will be clear if the last instruction executed resulted in a value
less than #$80 (ie, <i>bit7 clear</i>).<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%01101011</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; |</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; +-------- bit7 is clear.&#xA0; This will clear the N flag.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bpl .somewhere&#xA0; ;N flag is clear, so this will branch</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%10010101</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; |</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; +-------- bit7 is set.&#xA0; This will set the N flag</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bpl .somewhere&#xA0; ;N flag is set, so this will not branch.</span><br><br><b>BMI</b>
is the opposite.&#xA0; It tests the N flag and will branch if it is set.&#xA0;
Think of BMI as Branch if MInus.&#xA0; The N flag will be set if the last
instruction executed resulted in a value greater than or equal to #$80
(ie, <i>bit7 set</i>).<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%01101011</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; |</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; +-------- bit7 is clear.&#xA0; This will clear the N flag.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bmi .somewhere&#xA0; ;N flag is clear, so this will not branch</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #%10010101</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; |</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; +-------- bit7 is set.&#xA0; This will set the N flag</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bmi .somewhere&#xA0; ;N flag is set, so this will branch to the label .somewhere.</span><br><br>In the range-testing code above, I used BPL to check if a byte fell into the Note range (00-7F).&#xA0; Go back and check it.<br><font size="4"><br>
<b>Song Headers</b></font><br>Music on the NES is typically composed of
four parts: a Square 1 part, a Square 2 part, a Triangle part and a
Noise part.&#xA0; When you want to play a song, you will have the main
program issue a command to the sound engine telling it what song you
want to play.&#xA0; It will look something like this:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$02</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr sound_load&#xA0; ;load song 2</span><br>&#xA0;&#xA0; &#xA0;<br>Somehow
our sound_load subroutine will have to take that &quot;2&quot; and translate it
into a whole song, complete with Square 1, Square 2, Triangle and Noise
parts.&#xA0; How does that little number become 4 streams of data?&#xA0; Well,
that number is an index into a pointer table, a table of pointers to
song headers.&#xA0; The song headers themselves will contain pointers to the
individual channels&apos; data streams.<br><br><font size="4"><b>Pointer Tables</b></font><br>A pointer table is a special kind of lookup table.&#xA0; Only instead of holding regular old numerical data a pointer table holds <b>addresses</b>.&#xA0;
These addresses &quot;point&quot; to the start of data.&#xA0; Addresses on the NES are
16-bit ($0000-$FFFF), so pointer tables are always tables of words.&#xA0;
Let&apos;s look at an example:<br><br><span style="font-family: Courier New;">pointer_table:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word $8000, $ABCD, $CC10, $DF1B</span><br>&#xA0;&#xA0; &#xA0;<br>Here
we have a pointer table.&#xA0; It&apos;s four entries long.&#xA0; Each entry is a
16-bit address.&#xA0; Presumably there is data at these four addresses that
we will want to read sometime in our program.&#xA0; To read this data we
will need to index into the pointer table, grab the address and store
it in a zero-page pointer variable and then read using indirect mode:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .rsset $0000</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">ptr1 .rs 2&#xA0; ;a 2-byte pointer variable.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;The first byte will hold the LO byte of an address</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;The second byte will hold the HI byte of an address</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .org $E000&#xA0; ;somewhere in ROM</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$02&#xA0;&#xA0;&#xA0; ;the third entry in the pointer table ($CC10)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply by 2 because we are indexing into a table of words</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda pointer_table, y&#xA0;&#xA0;&#xA0; ;#$10 - little endian, so words are stored LO-byte first</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta ptr1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda pointer_table+1, y&#xA0; ;#$CC</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta ptr1+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;now our pointer is setup in ptr1.&#xA0; It &quot;points&quot; to address $CC10.&#xA0; Let&apos;s read data from there.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [ptr1], y&#xA0;&#xA0; ;indirect mode.&#xA0; reads the byte at $CC10</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta some_variable</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [ptr1], y&#xA0;&#xA0; ;reads the byte at $CC11</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta some_other_variable</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;... etc</span><br>&#xA0;&#xA0; &#xA0;<br>This
code takes an index and uses it to read an address from our
pointer_table.&#xA0; It stores this address in a variable called ptr1 (LO
byte first).&#xA0; Then it reads from this address by using indirect mode.&#xA0;
We specify indirect mode by putting []&apos;s around our pointer variable.&#xA0;
Look at this instruction: &#xA0;<br>&#xA0;&#xA0; &#xA0;<br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [ptr1], y</span><br style="font-family: Courier New;"><br>It means &quot;Find the address ptr1 is pointing to.&#xA0; Add Y to that address.&#xA0; Load the value at that address into A&quot;.<br><br>This
is very versatile because we can stick any address we want into our
ptr1 variable and read from anywhere!&#xA0; A pointer table is just a lookup
table of places we want to read from.<br><br>Of course you usually
won&apos;t know where exactly in the ROM your data will be.&#xA0; So instead of
declaring addresses explicitely ($8000, $ABCD, $CC10, etc), you will
use labels instead:<br><br><span style="font-family: Courier New;">pointer_table:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word data1, data2, data3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;these entries will evaluate to the 16-bit addresses of the labels below</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">data1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $FF, $16, $82, $44&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;some random data</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">data2:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $0E, $EE, $EF, $16, $23</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">data3:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $00, $01</span><br>&#xA0;&#xA0;&#xA0; <br>
<b>Song Header Pointer Table</b><br>Our songs work the same way.&#xA0; When
the main program tells the sound engine to play a song, it will send
the song number with it.&#xA0; This song number is actually an index into a
pointer table of song headers:<br>&#xA0;&#xA0; &#xA0;<br><span style="font-family: Courier New;">song_headers:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song0_header</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song1_header</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song2_header</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;..etc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_load:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply by 2.&#xA0; we are indexing into a table of pointers (words)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda song_headers, y&#xA0;&#xA0;&#xA0;&#xA0; ;read LO byte of a pointer from the pointer table.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;sound_ptr is a zero page pointer variable</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda song_headers+1, y&#xA0;&#xA0; ;read HI byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta some_variable</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;...read the rest of the header data</span><br>&#xA0;&#xA0; &#xA0;<br><font size="4"><b>Header Data</b></font><br>So what will our song header data look like?&#xA0; At the very least it should tell us:<br><br>How many data streams we have (songs will usually have 4, but sfx will have fewer)<br>Which streams those are (which stream index to use)<br>Which channels those streams use<br>Where to find those streams (ie, pointers to the beginning of each stream).<br>Initial values for those streams (for example, initial volume)<br><br>As
we add more features to our sound engine, we may expand our headers to
initialize those features.&#xA0; Let&apos;s start simple.&#xA0; Our headers will look
like this:<br><br><span style="font-family: Courier New;">main header:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">--------+----------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">byte #&#xA0; | what it tells us</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">--------+----------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | number of streams</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">01+&#xA0;&#xA0;&#xA0;&#xA0; | stream headers (one for each stream)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream headers:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">--------+----------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">byte #&#xA0; | what it tells us</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">--------+----------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | which stream (stream number)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | status byte (see below)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">02&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | which channel</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">03&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | initial volume (and duty for squares)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">04-05&#xA0;&#xA0; | pointer to data stream</span><br><br>The <b>status byte</b>
will be a bit-flag that tells us special information about the stream.&#xA0;
For now we will just use bit0 to mark a stream as enabled or disabled.&#xA0;
In the future we may use other bits to store other information, such as
stream priority.<br><br style="font-family: Courier New;"><b><span style="font-family: Courier New;">Stream Status Byte</span></b><br style="font-family: Courier New;"><span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; |</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; +- Enabled (0: stream disabled; 1: enabled)</span><br style="font-family: Courier New;"><br><br>
<b>Sample Header</b><br>Here is some code showing a sample header:<br><br><span style="font-family: Courier New;">SQUARE_1 = $00 ;these are channel constants</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">SQUARE_2 = $01</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">TRIANGLE = $02</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">NOISE = $03</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">MUSIC_SQ1 = $00 ;these are stream # constants</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">MUSIC_SQ2 = $01 ;stream # is used to index into stream variables</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">MUSIC_TRI = $02</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">MUSIC_NOI = $03</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">SFX_1&#xA0;&#xA0;&#xA0;&#xA0; = $04</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">SFX_2&#xA0;&#xA0;&#xA0;&#xA0; = $05</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">song0_header:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $04&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4 streams</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte MUSIC_SQ1&#xA0;&#xA0;&#xA0;&#xA0; ;which stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;status byte (stream enabled)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte SQUARE_1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;which channel</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $BC&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;initial volume (C) and duty (10)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song0_square1 ;pointer to stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte MUSIC_SQ2&#xA0;&#xA0;&#xA0;&#xA0; ;which stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;status byte (stream enabled)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte SQUARE_2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;which channel</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $38&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;initial volume (8) and duty (00)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song0_square2 ;pointer to stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte MUSIC_TRI&#xA0;&#xA0;&#xA0;&#xA0; ;which stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;status byte (stream enabled)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte TRIANGLE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;which channel</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $81&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;initial volume (on)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song0_tri&#xA0;&#xA0;&#xA0;&#xA0; ;pointer to stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte MUSIC_NOI&#xA0;&#xA0;&#xA0;&#xA0; ;which stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;disabled.&#xA0; We will have our load routine skip the</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&#xA0;&#xA0; rest of the reads if the status byte disables the stream.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&#xA0;&#xA0; We are disabling Noise because we haven&apos;t covered it yet.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;"><br>
;these are the actual data streams that are pointed to in our stream headers. &#xA0;&#xA0; </span><br style="font-family: Courier New;"><span style="font-family: Courier New;">song0_square1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, C4, E4, A4, C5, E5, A5 ;some notes.&#xA0; A minor</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">song0_square2:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, A3, A3, E4, A3, A3, E4 ;some notes to play on square 2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">song0_tri:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, A3, A3, A3, A3, A3, A3 ;triangle data</span><br>&#xA0;&#xA0; &#xA0;<br><b>Sound Engine Variables</b><br>The
last thing we need before we can write our sound_load routine is some
variables.&#xA0; As mentioned, our sound engine will have several streams
running simultaneously.&#xA0; Four will be used for music (one for each
tonal channel).&#xA0; Two will be used for sound effects.&#xA0; So we will
declare all variables in blocks of 6.&#xA0; Based on our header data, we
will need the following variables:<br><br><span style="font-family: Courier New;">stream_curr_sound .rs 6&#xA0;&#xA0;&#xA0;&#xA0; ;reserve 6 bytes, one for each stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream_status .rs 6</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream_channel .rs 6</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream_vol_duty .rs 6</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream_ptr_LO .rs 6</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream_ptr_HI .rs 6</span><br><br><b>sound_load</b><br>Now
let&apos;s write some code to read our header.&#xA0; Pay special attention to the
X register.&#xA0; I recommend tracing through the code using the sample
header above.&#xA0; Here is our sound_load routine:<br><br><span style="font-family: Courier New;">;-------------------------------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">; load_sound will prepare the sound engine to play a song or sfx.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;&#xA0;&#xA0; input:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; A: song/sfx number to play</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_load:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save song number</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply by 2.&#xA0; We are indexing into a table of pointers (words)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda song_headers, y&#xA0;&#xA0;&#xA0;&#xA0; ;setup the pointer to our song header</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda song_headers+1, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read the first byte: # streams</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_temp2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;store in a temp variable.&#xA0; We will use this as a loop counter</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;stream number</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tax&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;stream number acts as our variable index</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;status byte.&#xA0; 1= enable, 0=disable</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_status, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .next_stream&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if status byte is 0, stream disabled, so we are done</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;channel number</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_channel, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;initial duty and volume settings</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_vol_duty, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;pointer to stream data.&#xA0; Little endian, so low byte first</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ptr_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.next_stream:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;song number</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_curr_sound, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; dec sound_temp2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;our loop counter</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Now our sound_load routine is ready.&#xA0; If the main program calls it, like this:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00 ;song 0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr sound_load</span><br>&#xA0;&#xA0; &#xA0;<br>Our
sound_load routine will take the value in the A register and use it to
fill our music RAM with everything we need to get our song running!<br><br><b>Reading Streams</b><br>Once
we have our header loaded, we are ready to rock.&#xA0; All of our active
streams have pointers to their data stored in their stream_ptr_LO and
stream_ptr_HI variables.&#xA0; That&apos;s all we need to start reading data from
them.<br><br>To read data from our data stream, we will first copy the
stream pointer into a zero-page pointer variable.&#xA0; Then we will read a
byte using indirect mode and range-test it to determine whether it is a
note, note length or opcode.&#xA0; If it&apos;s a note, we will read from our
note_table and store the 11-bit period in RAM.&#xA0; Finally, we will update
our stream pointer to point to the next byte in the stream. &#xA0;<br><br>First we will need to declare some new variable blocks for the note periods:<br><br><span style="font-family: Courier New;">stream_note_LO .rs 6&#xA0;&#xA0;&#xA0; ;low 8 bits of period</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream_note_HI .rs 6&#xA0;&#xA0;&#xA0; ;high 3 bits of period</span><br style="font-family: Courier New;"><br>Here is our se_fetch_byte routine (se_ stands for &quot;sound engine&quot;):<br><br><span style="font-family: Courier New;">;--------------------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">; se_fetch_byte reads one byte from a sound data stream and handles it</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;&#xA0;&#xA0; input: </span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; X: stream number</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_fetch_byte:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_LO, x&#xA0;&#xA0;&#xA0; ;copy stream pointer into a zero page pointer variable</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read a byte using indirect mode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bpl .note&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if &lt;#$80, we have a note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$A0&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else if &lt;#$A0 we have a note length</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .note_length</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.opcode:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else we have an opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;nothing here yet</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp .update_pointer</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note_length:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;nothing here yet</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp .update_pointer</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply by 2 because we are index into a table of words</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sty sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save our Y register because we are about to destroy it</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table, y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;pull low 8-bits of period and store it in RAM</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table+1, y&#xA0;&#xA0;&#xA0;&#xA0; ;pull high 3-bits of period from our note table</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;restore the Y register</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;;update our stream pointers to point to the next byte in the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;.update_pointer:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;set index to the next byte in the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tya</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; clc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; adc stream_ptr_LO, x&#xA0;&#xA0;&#xA0; ;add Y to the LO pointer</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .end</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; inc stream_ptr_HI, x&#xA0;&#xA0;&#xA0; ;if there was a carry, add 1 to the HI pointer.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.end:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br><br>Look
at the part that updates the stream pointer.&#xA0;&#xA0; After we finish all our
reads, Y will hold the index of the last byte read.&#xA0; To be ready for
the next frame, we will want to update our pointer to point to the next
byte in the data stream.&#xA0; To do this, we increment Y and add it to the
pointer.&#xA0; But we have to be careful here.&#xA0; What if our current position
is something like this:<br><br>stream_ptr: $C3FF <br>Y: 1&#xA0;&#xA0; &#xA0;<br><br>The
next position here should be $C400.&#xA0; But ADC only works on the 8-bit
level, so if we add 1 to the low byte of the pointer we will get this
instead:<br><br>stream_ptr: $C300<br><br>The FF in the low byte becomes
00, but the high byte remains the same.&#xA0; We need to increment the high
byte manually.&#xA0; But how do we know when to increment it and when to
leave it alone?&#xA0; Lucky for us, ADC sets the carry flag whenever it
makes a FF-&gt;00 transition.&#xA0; So we can just check the carry flag
after our addition.&#xA0; If it is set, increment the high byte of the
pointer.&#xA0; If it is clear, don&apos;t increment it.&#xA0; That&apos;s what our code
above does.<br><br><font size="4"><b>Playing Music</b></font><br>We&apos;ve
loaded our header.&#xA0; We&apos;ve set up our stream pointers in RAM.&#xA0; We&apos;ve
written a routine that will read bytes from the streams and turn them
into notes.&#xA0; Now we need to update sound_play_frame.&#xA0; sound_play_frame
will loop through all 6 streams.&#xA0; It will check the status byte to see
if they are enabled.&#xA0; If enabled, it will advance the stream by one
frame.&#xA0; Here&apos;s the code:<br><br><span style="font-family: Courier New;">sound_play_frame:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_disable_flag</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .done&#xA0;&#xA0; ;if sound engine is disabled, don&apos;t advance a frame</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; inc sound_frame_counter&#xA0;&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_frame_counter</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$08&#xA0;&#xA0;&#xA0; ;***change this compare value to make the notes play faster or slower***</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .done&#xA0;&#xA0; ;only take action once every 8 frames.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldx #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;our stream index.&#xA0; start at MUSIC_SQ1 stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_status, x&#xA0;&#xA0;&#xA0; ;check bit 0 to see if stream is enabled</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #$01</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .next_stream&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if disabled, skip to next stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr se_fetch_byte&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read from the stream and update RAM </span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr se_set_apu&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;write volume/duty, sweep, and note periods of current stream to the APU ports</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.next_stream:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; inx</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cpx #$06&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;loop through all 6 streams.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_frame_counter ;reset frame counter so we can start counting to 8 again. &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.done:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br><br><br>And here is se_set_apu which will write a stream&apos;s data to the APU ports:<br>&#xA0;&#xA0; &#xA0;<br><span style="font-family: Courier New;">se_set_apu:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_channel, x&#xA0;&#xA0; ;which channel does this stream write to?</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply by 4 so Y will index into the right set of APU ports (see below)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_vol_duty, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4000, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_note_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4002, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_note_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4003, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_channel, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #TRIANGLE</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcs .end&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if Triangle or Noise, skip this part</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$08&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else, set negate flag in sweep unit to allow low notes on Squares</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4001, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.end:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Writing to the APU ports directly like this is actually bad form.&#xA0; We&apos;ll learn why in a later lesson.<br><br>One
thing to pay attention to is how we get our APU port index.&#xA0; We take
the channel and multiply it by 4.&#xA0; Recall that we declared constants
for our channels:<br><br><span style="font-family: Courier New;">SQUARE_1 = $00 ;these are channel constants</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">SQUARE_2 = $01</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">TRIANGLE = $02</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">NOISE = $03</span><br><br>If our stream_channel is $00 (SQUARE_1), we multiply by 4 to get $00.&#xA0; y = 0<br>&#xA0;&#xA0;&#xA0; $4000, y = $4000 &#xA0;<br>&#xA0;&#xA0;&#xA0; $4001, y = $4001 <br>&#xA0;&#xA0;&#xA0; $4002, y = $4002 <br>&#xA0;&#xA0;&#xA0; $4003, y = $4003<br>If our stream_channel is $01 (SQUARE_2), we multiply by 4 to get $04.&#xA0; y = 4<br>&#xA0;&#xA0;&#xA0; $4000, y = $4004 &#xA0;<br>&#xA0;&#xA0;&#xA0; $4001, y = $4005 &#xA0;<br>&#xA0;&#xA0;&#xA0; $4002, y = $4006<br>&#xA0;&#xA0;&#xA0; $4003, y = $4007 <br>If our stream_channel is $02 (TRIANGLE), we multiply by 4 to get $08.&#xA0; y = 8<br>&#xA0;&#xA0;&#xA0; $4000, y = $4008 &#xA0;<br>&#xA0;&#xA0;&#xA0; $4001, y = $4009 (unused) &#xA0;<br>&#xA0;&#xA0;&#xA0; $4002, y = $400A <br>&#xA0;&#xA0;&#xA0; $4003, y = $400B<br>If our stream_channel is $03 (NOISE), we multiply by 4 to get $0C.&#xA0; y = C<br>&#xA0;&#xA0;&#xA0; $4000, y = $400C &#xA0;<br>&#xA0;&#xA0;&#xA0; $4001, y = $400D &#xA0;<br>&#xA0;&#xA0;&#xA0; $4002, y = $400E<br>&#xA0;&#xA0;&#xA0; $4003, y = $400F<br>
<br>
See how everything lines up nicely?<br><br><b>Putting It All Together</b><br>Download and unzip the <a href="downloads/NerdyNightsSoundSourceCollection/headers.zip" target="_blank" original-href="http://tummaigames.com/headers.zip">headers.zip</a> sample files.&#xA0; Make sure the following files are in the same folder as NESASM3:<br><br>&#xA0;&#xA0;&#xA0; headers.asm<br>&#xA0;&#xA0;&#xA0; sound_engine.asm<br>&#xA0;&#xA0;&#xA0; headers.chr<br>&#xA0;&#xA0;&#xA0; note_table.i<br>&#xA0;&#xA0;&#xA0; song0.i<br>&#xA0;&#xA0;&#xA0; song1.i<br>&#xA0;&#xA0;&#xA0; song2.i<br>&#xA0;&#xA0;&#xA0; song3.i<br>&#xA0;&#xA0;&#xA0; headers.bat<br><br>Double click headers.bat. That will run NESASM3 and should produce the headers.nes file. Run that NES file in FCEUXD SP.<br><br>Use the controller to select songs and play them.&#xA0; Controls are as follows:<br>&#xA0;&#xA0; &#xA0;<br><b>Up</b>: Play<br><b>Down</b>: Stop <br><b>Right</b>: Next Song<br><b>Left</b>: Previous Song<br><br>Song0
is a silence song.&#xA0; It is not selectable.&#xA0; headers.asm &quot;plays&quot; song0 to
stop the music when you press down.&#xA0; See song0.i to find out how it
works.<br>Song1 is an evil sounding series of minor thirds.<br>Song2 is
a short sound effect on the Sq2 channel.&#xA0; It uses the SFX_1 stream.&#xA0;
Try playing it over the other songs to see how it steals the channel
from the music.<br>Song3 is a simple descending chord progression.<br><br>Try
creating your own songs and sound effects and add them into the mix.&#xA0;
To add a new song you will need to take the following steps:<br><br>1) create a song header and song data (use the included songs as reference).&#xA0; Note that data streams are terminated with $FF<br>2) add your header to the song_headers pointer table at the bottom of sound_engine.asm<br>3) update the constant NUM_SONGS to reflect the new song number total (also at the bottom of sound_engine.asm)<br><br>Although
not necessary, I recommend keeping your song data in a separate file
like I&apos;ve done with song0.i, song1.i, song2.i and song3.i.&#xA0; This makes
it easier to find the data if you need to edit your song later.&#xA0; If you
do this, don&apos;t forget to .include your file.<br><br><b>Next Week</b>: <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=24885" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=24885">Timing, Note Lengths, Buffering and Rests</a><br>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#audio_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;audio_tutorial-5__comments&apos;);">
                            是否显示评论内容
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=23452" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="audio_tutorial-5__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-5__1">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Sep 16, 2009 at 8:24:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is a monster lesson, and probably the most important of the series.  Please take your time with it and ask any questions you have here in the thread.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-5__2">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Sep 16, 2009 at 10:21:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					this is excellent. I actually think week 4 was the big step for me. This one kinda just built off of that one more. I don&apos;t understand everything in this one for sure, but I can definitely follow it enough to know what the sections of code are doing. It took me like 10 mins to add my old SFX into this engine and place the updated engine into my game. 
<br>
<br>I was was thinking about blank notes or breaks and wondering if the easiest way to do it would to be just add a word byte to the note_table.i call BK and have it with a value of $0000. then when writing a song with a rest or something would be like
<br>.byte D3,D4,BK,D4,D3,$FF
<br>
<br>I&apos;m learning a lot about pointers, lookup tables, and include from you which is just as useful as the music engine itself. I&apos;ve always been a bit better at hacking existing code, then designing. I much prefer seeing code in use, then trying to figure out how to design it. After seeing this, it will probably help me a ton on my next game with all kinds of loads. Right now I have seperate subroutines to load my backgrounds and each one of them has the same sets of loops to load the background tiles and attribute table. Now that I kinda see how these lookup tables work, I could cut a ton of code out and use a single loading loop and use a table to decide which backgound and attributes to load. 
<br>
<br>I tend to be able to always make things work, but I design poorly. These sound tutorials will make me much more efficient in the future.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-5__3">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Sep 17, 2009 at 10:36:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>udisi</b></i><br><br>this is excellent. I actually think week 4 was the big step for me. This one kinda just built off of that one more. I don&apos;t understand everything in this one for sure, but I can definitely follow it enough to know what the sections of code are doing. It took me like 10 mins to add my old SFX into this engine and place the updated engine into my game. 
<br></div><br>Oh good!&#xA0; I was a little worried that this week might be too much all at once, but I cut it down as far as it would go.&#xA0; Glad to see that it turned out ok!<br><br><div class="FTQUOTE">I was was thinking about blank notes or breaks and wondering if the
easiest way to do it would to be just add a word byte to the
note_table.i call BK and have it with a value of $0000. then when
writing a song with a rest or something would be like
<br>.byte D3,D4,BK,D4,D3,$FF
<br></div><br>That should work for the Squares.&#xA0; I don&apos;t remember the exact number off the top of my head, but the Square channels output silence for any period below $006 or $007.&#xA0; I think I read somewhere that the Triangle channel will still produce audible output even at a period of $000, so you will have to do something else in the Triangle case.&#xA0; I&apos;ll see if I can fit Rests into the next lesson.&#xA0; I think the next lesson is a little easy, so adding an extra topic shouldn&apos;t hurt.<br><br><div class="FTQUOTE"><i>&#xA0;</i>I&apos;m learning a lot about pointers, lookup tables, and include from
you which is just as useful as the music engine itself. I&apos;ve always
been a bit better at hacking existing code, then designing. I much
prefer seeing code in use, then trying to figure out how to design it.
After seeing this, it will probably help me a ton on my next game with
all kinds of loads. Right now I have seperate subroutines to load my
backgrounds and each one of them has the same sets of loops to load the
background tiles and attribute table. Now that I kinda see how these
lookup tables work, I could cut a ton of code out and use a single
loading loop and use a table to decide which backgound and attributes
to load. <br></div><br>Great!&#xA0; Aside from the sound-specific stuff, one of my goals with these tutorials is to introduce some advanced techniques that can be applied to other components of a game.&#xA0; Pretty much everything carries over.&#xA0; If you were going to write an RPG textbox engine for example, you&apos;d have the same thing.&#xA0; You&apos;d have a pointer table to all the text strings in the game.&#xA0; Talking to a villager would &quot;load&quot; one of the strings from the pointer table.&#xA0; Your text data would be divided into ranges: one range for characters, one for opcodes (next line, clear the box, play a sound, etc).&#xA0; Your data reading routine would test the ranges and branch to different sections of code.&#xA0; The method is the same, just the details are different.<br><br>Good call on the background loading routines.&#xA0; That&apos;s exactly how I&apos;d do it.&#xA0; Setup a pointer table and have a single set of routines that will load and draw your background based on an index (background number).<br><br><br><br><div class="FTQUOTE">I tend to be able to always make things work, but I design poorly. These sound tutorials will make me much more efficient in the future.<br></div><br>We all start out that way.&#xA0; You should see the code of my first project.&#xA0; It wasn&apos;t very pretty <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">.&#xA0; But you learn a lot just trying stuff and tinkering with things.&#xA0; Once you get that experience under your belt, you can start looking at other peoples&apos; code and figuring out better ways to do things.&#xA0; I learned most of these techniques from peeking at commercial games in FCEUX&apos;s debugger.&#xA0; But I wouldn&apos;t have been able to do that if I hadn&apos;t gotten my hands dirty with my own project first.&#xA0; I&apos;m glad you are finding these tutorials helpful!<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-5__4">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Sep 29, 2009 at 2:22:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					As I was saying I was looking at how you did the text strings, but I have a few questions about them to see if I can use the idea in my next game. Below is a screen shot from Wizardry and it uses the type of display I want to use.<img hspace="0" vspace="0" border="0" align="0" src alt="0" original-src="http://www.nintendoagemedia.com/users/93/photobucket/07002427-CF1D-7AA0-005F77DB3C2E5350.JPG" show-src="scraper/images/07002427-CF1D-7AA0-005F77DB3C2E5350.JPG"><br><br>I want to split the screen with the red circles and be able to update the red lines within those circles independently.<br><br>The top left would be used for some picture graphics, top right would be some test like the example, and the bottom would be some status and inventory info. <br><br>1) Now your text loading doesn&apos;t load a bunch of tiles. it pretty much just loads &quot;playing&quot;, &quot;not&quot;, &quot;disabled&quot;, etc...so like maybe 10 tiles. I&apos;m wondering is there a limit to the amount of tiles I can load using your method, or will I run out of vblank time. Kinda like how you can only load 64 sprites per frame? <br><br>2) You don&apos;t load any other background besides the text in your tutorial, so the background just fills the other space with $00. I want to put a border in like in the example with the white lines. Can I load the border once, and then just update the lines within the border? I know I can make strings that start and terminate at the spots I want, but I don&apos;t know if I can have a static border or not? <br><br>Pretty much that&apos;s all I want to do. Have that static boarder, and then be able to use text/graphic strings to fill in the areas of the boarders independently. You&apos;re code seems like it can be modified to do such, but I don&apos;t know if there&apos;s any hardware limitations to it. <br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-5__5">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Oct 1, 2009 at 3:53:32 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>udisi</b></i><br><br>As I was saying I was looking at how you did the text strings, but I have a few questions about them to see if I can use the idea in my next game. Below is a screen shot from Wizardry and it uses the type of display I want to use.<img hspace="0" border="0" align="0" vspace="0" alt="0" src original-src="http://www.nintendoagemedia.com/users/93/photobucket/07002427-CF1D-7AA0-005F77DB3C2E5350.JPG" show-src="scraper/images/07002427-CF1D-7AA0-005F77DB3C2E5350.JPG"><br><br>I want to split the screen with the red circles and be able to update the red lines within those circles independently.<br><br>The top left would be used for some picture graphics, top right would be some test like the example, and the bottom would be some status and inventory info. <br><br>1) Now your text loading doesn&apos;t load a bunch of tiles. it pretty much just loads &quot;playing&quot;, &quot;not&quot;, &quot;disabled&quot;, etc...so like maybe 10 tiles. I&apos;m wondering is there a limit to the amount of tiles I can load using your method, or will I run out of vblank time. Kinda like how you can only load 64 sprites per frame? <br><br>2) You don&apos;t load any other background besides the text in your tutorial, so the background just fills the other space with $00. I want to put a border in like in the example with the white lines. Can I load the border once, and then just update the lines within the border? I know I can make strings that start and terminate at the spots I want, but I don&apos;t know if I can have a static border or not? <br><br>Pretty much that&apos;s all I want to do. Have that static boarder, and then be able to use text/graphic strings to fill in the areas of the boarders independently. You&apos;re code seems like it can be modified to do such, but I don&apos;t know if there&apos;s any hardware limitations to it. <br></div><br><br>To answer question 1, yes you can run out of vblank time if you fill your buffer with too many tile writes.&#xA0; You will probably have to stagger all of your text writing across several frames.&#xA0; Write some tiles, wait for the next frames, write some more, wait til the next frame, write some more, etc until you&apos;ve written all the data you need to write.&#xA0; Use trial and error to figure out how many tiles you can safely write before you spill out of vblank.<br><br>Alternatively, if you don&apos;t mind the screen flashing black for a second, you can turn the PPU off, write everything at once and then turn it back on.&#xA0; If the PPU is off you don&apos;t have to pay attention to vblank at all (except for palette updates I think) so you can write as much to the screen in one go as you like.&#xA0; This would be an ok solution if the text inside the boxes wouldn&apos;t change after displaying it, like pressing the select button to load up a static stats screen.&#xA0; It would be a bad solution for something like a character selection screen, where pressing the d-pad left and right would select the next character and update the text with their individual stats.&#xA0; You&apos;d get an annoying black flash in between every character.<br><br>For question 2, yes you should be able to draw the border once and then just update the lines within the borders.&#xA0; As long as you don&apos;t draw something in the same space as the border, or turn off the PPU or mess with the scroll, it should stay put.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-5__6">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Oct 3, 2009 at 1:43:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok, yeah. I was wanting to try and load the backgound circles once, and since the areas are smaller inside them I was thinking I may be able to do all the updates in them without turning off the ppu. That link you posted about in the sound tutorials about NMI, said something about using the buffer and never turning off NMI. 
<br>
<br>I would think I could save a lot of PRG space if I only have to .db a few lines instead of a whole screen full of tiles. You know, like loading say 50 tiles instead of 256. 
<br>
<br>I know all about the flash from the disable/enable of NMI. It happens in my BattleBall game cause that&apos;s the way the Neardy Nights showed you how to do it. Also, I&apos;m loading a full 256 tiles for every screen change, so I pretty much had no choice.
<br>
<br>I&apos;m just trying to plan out some more efficient ideas for my next game. If this works it&apos;ll save space and not have the screen flashes.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-5__7">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Oct 3, 2009 at 11:15:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think you&apos;re confusing &quot;turning off the NMI&quot; and &quot;turning of the PPU&quot; a little bit.
<br>
<br>Turning off the NMI is done by clearing bit 7 of $2000, and will stop the NMI from interrupting the game at the beginning of each vblank.
<br>
<br>Turning off the PPU is done by clearing bits 3 and 4 of $2001 (background and sprite rendering) and it will stop the PPU from rendering background tiles and sprites.  In other words, turning the PPU off will mean that nothing gets drawn to the screen at all (black screen).
<br>
<br>You can turn the PPU off and still have the NMI running.  Any graphics updates you do while the PPU is off won&apos;t show until you turn it on again, but if you have any non-graphics code in the NMI (sound engine being a common example), it will still get run when it needs to be run.
<br>
<br>Yeah, if you are loading a full 256 tiles all at once, turning off the PPU is the only way to do it.  You can make it look smoother by fading your palettes to black before you turn the PPU off.
<br>
<br>Anyway, to address your original problem, it is very possible to load the background circles once, and then be able to update the smaller insides without turning off the PPU.  It just might take more than one frame depending on how many tile updates you have.  You might have to do something like this:
<br>
<br>update box 1
<br>wait for next frame
<br>update box 2
<br>wait for next frame
<br>update box 3
<br>
<br>Each frame is only a fraction of a second, so the player won&apos;t be able to tell.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-5__8">
                                                        <div class="mdl-card__title"><strong>rizz</strong> posted on 
		
			
				
				May 8, 2010 at 2:28:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi MetalSlime/Thomas,
<br>
<br>First &amp; foremost, your sound lessons are fantastic.  I&apos;ve been liking the extra tips that you throw in as well, and your simplicity makes it easy to envision other areas of code that can benefit from your examples.
<br>
<br>
<br>I&apos;m writing to ask about this part of your code, which manually deals with 8-bit addition:
<br>    clc
<br>    adc stream_ptr_LO, x    ;add Y to the LO pointer
<br>    sta stream_ptr_LO, x
<br>    bcc .end
<br>    inc stream_ptr_HI, x    ;if there was a carry, add 1 to the HI pointer.
<br>
<br>
<br>As far as I know, this could be done instead:
<br>sta stream_ptr_LO, x
<br>LDA stream_ptr_HI, x
<br>ADC #$00
<br>STA stream_ptr_HI, x
<br>
<br>Was there any specific reason why you chose to check a branch condition?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-5__9">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				May 8, 2010 at 9:35:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>rizz</b></i><br><br>Hi MetalSlime/Thomas,
<br>
<br>First &amp; foremost, your sound lessons are fantastic.  I&apos;ve been liking the extra tips that you throw in as well, and your simplicity makes it easy to envision other areas of code that can benefit from your examples.
<br>
<br>
<br>I&apos;m writing to ask about this part of your code, which manually deals with 8-bit addition:
<br>    clc
<br>    adc stream_ptr_LO, x    ;add Y to the LO pointer
<br>    sta stream_ptr_LO, x
<br>    bcc .end
<br>    inc stream_ptr_HI, x    ;if there was a carry, add 1 to the HI pointer.
<br>
<br>
<br>As far as I know, this could be done instead:
<br>sta stream_ptr_LO, x
<br>LDA stream_ptr_HI, x
<br>ADC #$00
<br>STA stream_ptr_HI, x
<br>
<br>Was there any specific reason why you chose to check a branch condition?</div><br><br>Thanks.&#xA0; Glad you find the tutorials helpful.&#xA0; As far as branching vs. adding 0, I didn&apos;t really have a specific reason to use one over the other.&#xA0; I&apos;m just more accustomed to doing it the bcc way.<br><br>But now that I think about it, branching is probably slightly better performance-wise.&#xA0; A &quot;bcc&quot; and an &quot;inc abs,x&quot; take up 5 bytes of ROM space.&#xA0; &quot;lda abs,x&quot;, &quot;adc&quot;, &quot;sta abs,x&quot; takes up 8 bytes of ROM space.&#xA0; Most of the time the carry will be clear, so skipping instructions in the most common case saves some cpu cycles too.&#xA0; Even when the carry is set, the INC takes fewer cycles than the LDA/ADC/STA combo.<br><br>By the way, I had to look that up just now.&#xA0; I&apos;m not a cycle counter so I don&apos;t know any of this stuff off the top of my head <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">.&#xA0; I never considered any of this when I wrote the code.&#xA0;&#xA0; The savings are negligible, so it seems like a pick &apos;em to me.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-5__10">
                                                        <div class="mdl-card__title"><strong>ubuntuyou</strong> posted on 
		
			
				
				Nov 20, 2016 at 3:21:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Is there any way I can still get all the attachments for these tutorials? I got the first one a few weeks ago but they don&apos;t seem to be available anymore. I tried following along with this one but I only get one repeating note that changes if I disable different channels and I&apos;d like to compare. Thanks in advance.
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Nerdy Nights Sound: Part 6: Tempo, Note Lengths, Buffering and Rests</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b>Last Week</b>: <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=23452" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=23452">Sound Data, Pointer Tables and Headers</a><br><br><b>This Week</b>: Tempo, Note Lengths, Buffering and Rests<br><br><b><font size="4">Timing</font></b><br><br>Last
week we put together a huge chunk of the sound engine.&#xA0; We finally got
it to play something that resembled a song.&#xA0; But we had big limitations
when it came to timing and note lengths.&#xA0; We were using a single frame
counter to keep time across all 6 streams of the sound engine.&#xA0; This is
a problem because it imposes the music&apos;s speed on our sound effects.&#xA0;
If you were to use such a system in a real game, your sound effects
would speed up or slow down whenever you change to a faster or slower
song.<br><br>We also made the mistake of advancing the sound engine
when our frame counter hit its mark, but skipping it when it didn&apos;t.&#xA0;
What happens if a game event triggers a sound effect one or two frames
after the counter hits its mark?&#xA0; The sound effect won&apos;t start until
the next time our counter reaches its mark - we have to wait for it!&#xA0;
There will be a delay.&#xA0; Not good.<br><br>Worst of all, our frame
counter also doesn&apos;t allow for variable note lengths.&#xA0; Unless every
song you write is going to consist of only 32nd notes, this is a
problem.&#xA0; It becomes apparent then that we need a more complex timing
system.<br><br><font size="3"><b>Tempo</b></font><br>
<br>We&apos;ll correct the first two problems by ripping out the universal
counter and giving each stream it&apos;s own private counter.&#xA0; We&apos;ll also
change our method of counting.&#xA0; Our old method of counting frames and
taking action when we reach a certain number is very limited.&#xA0; For
example, let&apos;s say that we have a song and our frame counter is taking
action every 4 frames.&#xA0; Maybe the song sounds a tad faster than we
want, so we slow it down by changing the speed to update once every 5
frames.&#xA0; But now the song sounds too slow.&#xA0; The speed we really want is
somewhere in between 4 and 5, but we can&apos;t get there with our frame
counting method.&#xA0; Instead we&apos;ll use a ticker.<br><br><b>Ticker</b><br>The ticker method involves taking a number (a <b>tempo</b>)
and adding it to a total, frame by frame.&#xA0; Eventually, that total will
wraparound from FF-&gt;00 and when it does the carry flag will be set
(a <b>tick</b>).&#xA0; This carry flag tick will be the signal we look for to advance our stream.<br><br>For
example, let&apos;s say our tempo value is $40 and our total starts at $00.&#xA0;
After one frame we will add our tempo to the total.&#xA0; $00 + $40 = $40.&#xA0;
Now our total is $40.&#xA0; Another frame goes by (2).&#xA0; We add our tempo to
the total again.&#xA0; $40 + $40 = $80.&#xA0; Our total is $80.&#xA0; Another frame
goes by (3).&#xA0; $80 + $40 = $C0.&#xA0; Another frame goes by (4).&#xA0; $C0 + $40 =
$00.&#xA0; Carry flag is set.&#xA0; TICK!&#xA0; A tick tells us that it is time to
advance this stream.&#xA0; When we finish updating, we start adding again
until we get another tick.<br><br>As you can see, a tempo value of $40
will advance our stream once every 4 frames.&#xA0; If you do some math (256
/ 5), you will discover that a tempo of $33 will advance the stream
roughly every 5 frames.&#xA0; If $40 is too fast for your song and $33 is
too slow, you still have the values $34-$39 to experiment with.&#xA0; Much
more versatile!&#xA0; To see why this works, let&apos;s see what happens with a
tempo value of say $36:<br><br><span style="font-family: Courier New;">$00 + $36 + $36 + $36 + $36 + $36 = $0E (Tick in 5 frames)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">$0E + $36 + $36 + $36 + $36 + $36 = $1C (Tick in 5 frames)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">$1C + $36 + $36 + $36 + $36&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; = $02 (Tick in 4 frames)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">$02 + $36 + $36 + $36 + $36 + $26 = $10 (Tick in 5 frames)</span><br><br>A
tempo of $36 produces a tick every 5 frames most of the time, but
sometimes it only takes 4 frames.&#xA0; You might think that this disparity
would make our song sound uneven, but really a single frame only lasts
about 1/60 of a second.&#xA0; Our ears won&apos;t notice.&#xA0; It will sound just
right to us.<br><br>Here is some code that demonstrates how to implement a ticker:<br><br><span style="font-family: Courier New;">stream_tempo .rs 6&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;the value to add to our ticker total each frame</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream_ticker_total .rs 6&#xA0;&#xA0; ;our running ticker total.</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_play_frame:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_disable_flag</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .done&#xA0;&#xA0; ;if disable flag is set, don&apos;t advance a frame</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldx #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop: </span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_status, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #$01</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .endloop&#xA0;&#xA0;&#xA0; ;if stream disabled, skip this stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;add the tempo to the ticker total.&#xA0; If there is a FF-&gt; 0 transition, there is a tick</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">lda stream_ticker_total, x</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; clc</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; adc stream_tempo, x</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sta stream_ticker_total, x</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; bcc .endloop&#xA0;&#xA0;&#xA0; ;carry clear = no tick. if no tick, we are done with this stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr se_fetch_byte&#xA0;&#xA0; ;else there is a tick, so do stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do more stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.endloop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; inx</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cpx #$06</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.done:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br><b>Initializing</b><br>Anytime we add a new feature to our sound engine we will want to ask ourselves the following questions:<br><br>1) Is this a feature that needs to be initialized for each song/sfx?<br>2) If so, are the values we use to initialize the feature variable (ie, not necessarily the same for every song/sfx)?<br><br>If the answer to question #1 is yes, we will have to update sound_load to initialize the feature.<br>If
the answer to question #2 is also yes, we will have to add a field to
the song header format.&#xA0; The values to plug into the initialization are
different for each song, so the songs&apos; headers will need to provide
those values for us.<br><br>In the case of our new timing scheme, we
have two variables that need to be initialized: sound_ticker_total and
sound_tempo.&#xA0; Of the two, only sound_tempo will be variable.&#xA0; Different
songs will have different tempos, but they won&apos;t need to have different
starting sound_ticker_totals.&#xA0; So we will have to add one new field to
our song header format for tempo:<br><br><span style="font-family: Courier New;">main header:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">--------+----------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">byte #&#xA0; | what it tells us</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">--------+----------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | number of streams</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">01+&#xA0;&#xA0;&#xA0;&#xA0; | stream headers (one for each stream)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream headers:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">--------+----------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">byte #&#xA0; | what it tells us</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">--------+----------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | which stream (stream number)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | status byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">02&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | which channel</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">03&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | initial volume (and duty for squares)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">04-05&#xA0;&#xA0; | pointer to data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New; background-color: rgb(255, 255, 255); color: rgb(255, 0, 0);">06&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | initial tempo</span><br><br>Then
we will need to edit sound_load to read this new byte for each stream
and store it in RAM.&#xA0; We&apos;ll also want to initialize stream_ticker_total
to some fixed starting value, preferably a high one so that the first
tick will happen without a delay.&#xA0; Finally, we will have to update all
of our songs to include tempos in their headers.<br><br><font size="4"><b>Note Lengths</b></font><br><br>We
still have the problem of note lengths.&#xA0; Songs are made up of notes of
variable length: quarter notes, eighth notes, sixteenth notes, etc.&#xA0;
Our sound engine needs to be able to differentiate between different
note lengths.&#xA0; But how?&#xA0; We will use note length counters.<br><br><b>Note Length Counters</b><br>Think
of the fastest note you&apos;d ever need to play, say a 32nd note.&#xA0; Since
that will be our fastest note, we&apos;ll give it the smallest count
possible: $01.&#xA0; The next fastest note is a 16th note.&#xA0; In music, a 16th
note equals two 32nd notes.&#xA0; In other words, a 16th note lasts twice as
long as a 32nd note.&#xA0; So we will give it a count value that is twice
the count value of our 32nd note: $02.&#xA0; The next fastest note is an 8th
note.&#xA0; An 8th note equals two 16th notes.&#xA0; It is twice as long as a
16th note.&#xA0; So its count value will be twice that of the 16th note:
$04.&#xA0; Going all the way up to a whole note, we can produce a lookup
table like this:<br><br><span style="font-family: Courier New;">note_length_table:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $01&#xA0;&#xA0; ;32nd note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $02&#xA0;&#xA0; ;16th note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $04&#xA0;&#xA0; ;8th note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $08&#xA0;&#xA0; ;quarter note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $10&#xA0;&#xA0; ;half note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $20&#xA0;&#xA0; ;whole note</span><br>&#xA0;&#xA0; &#xA0;<br>We&apos;ll add more entries later for things like dotted quarter notes, but for now this is sufficient to get us started.<br><br>To play different note lengths, we will give each stream a note length counter:<br><br><span style="font-family: Courier New;">stream_note_length_counter .rs 6</span><br><br>When
a note is played, for example an 8th note, its count value will be
pulled from the note_length_table and stored in the stream&apos;s note
length counter.&#xA0; Then every time a tick occurs we will decrement the
counter.&#xA0; When the note length counter reaches 0, it will signal to us
that our note has finished playing and it is time for the next note.&#xA0;
To say it another way, a note&apos;s count value is simply how many ticks it
lasts.&#xA0; An eighth note is 4 ticks long.&#xA0; A quarter note is 8 ticks
long.&#xA0; A half note is 16 ticks long ($10).<br><br><b>Note Lengths in Data</b><br>Now
we need to add note lengths to our sound data.&#xA0; Recall that we
specified that byte values in the range of $80-$9F were note lengths:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_fetch_byte:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bpl .note&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if &lt; #$80, it&apos;s a Note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .note_length&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else if &lt; #$A0, it&apos;s a Note Length</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.opcode:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else it&apos;s an opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Opcode stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note_length:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do note length stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do note stuff</span><br>&#xA0;&#xA0; &#xA0;<br>So
the first byte value that we can use for note lengths is $80.&#xA0; We are
going to be reading from a lookup table (note_length_table above), so
we should assign the bytes in the same order as the lookup table. <br><br><span style="font-family: Courier New;">-----+--------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">byte | note length</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">-----+--------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">$80&#xA0; | 32nd note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">$81&#xA0; | 16th note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">$82&#xA0; | 8th note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">$83&#xA0; | quarter note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">$84&#xA0; | half note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">$85&#xA0; | whole note</span><br><br>Now we can use these values in our sound data to represent note lengths:<br><br><span style="font-family: Courier New;">;music data for song 0, square 1 channel</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">song0_sq1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $82, C3 ;play a C eighth note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $84, D5 ;play a D half note</span><br>&#xA0;&#xA0; &#xA0;<br>Of
course, memorizing which byte value corresponds to which note length is
a pain.&#xA0; Let&apos;s create some aliases to make it easier on us when we are
creating our sound data:<br><br><span style="font-family: Courier New;">;note length constants</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">thirtysecond = $80</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sixteenth = $81</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">eighth = $82</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">quarter = $83</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">half = $84</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">whole = $85</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">song0_sq1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth, C3&#xA0;&#xA0;&#xA0; ;play a C eighth note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte half, D5&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;play a D half note</span><br>&#xA0;&#xA0; &#xA0;<br><b>Pulling from the table</b><br>There
is a small problem here.&#xA0; Lookup tables index from 0.&#xA0;&#xA0; This wasn&apos;t a
problem for note values (C5, D3, G6) because our note range started
from 0 ($00-$7f).&#xA0; But our note length data has a range of $80-$9F.&#xA0;
Somehow we will need to translate the note length byte that comes from
the data stream into a number we can use to index into our table.&#xA0; In
other words, we need to figure out a way to turn $80 into $00, $81 into
$01, $82 into $02, etc.&#xA0; Anything come to mind?<br><br>If you thought
&quot;just subtract $80 from the note length value&quot;, give yourself a
cookie.&#xA0; If you thought &quot;just chop off the 7-bit&quot;, give yourself two
cookies.&#xA0; Both solutions work, but the second solution is a little bit
faster and only takes one instruction to perform:<br><br><span style="font-family: Courier New;">se_fetch_byte:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.fetch:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bpl .note&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if &lt; #$80, it&apos;s a Note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .note_length&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else if &lt; #$A0, it&apos;s a Note Length</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.opcode:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else it&apos;s an opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Opcode stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note_length:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do note length stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; and #%01111111&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;chop off bit7</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sty sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save Y because we are about to destroy it</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda note_length_table, y&#xA0;&#xA0;&#xA0; ;get the note length count value</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sta stream_note_length_counter, x&#xA0;&#xA0; ;stick it in our note length counter</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; ldy sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;restore Y</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; iny&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;set index to next byte in the stream</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; jmp .fetch&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;fetch another byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do note stuff</span><br>&#xA0;&#xA0; &#xA0;<br>Notice
that we jump back up to .fetch after we set the note length counter.&#xA0;
This is so that we can read the note that will surely follow the note
length in the data stream.&#xA0; If we simply stop after setting the note
length, we&apos;ll know how long to play, but we won&apos;t know which note to
play!<br><br>Here&apos;s an updated sound_play_frame routine that implements
both the ticker and the note length counters.&#xA0; Notice how the note
length counter is only decremented when we have a tick, and we only
advance the stream when the note length counter reaches zero:<br><br><span style="font-family: Courier New;">sound_play_frame:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_disable_flag</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .done&#xA0;&#xA0; ;if disable flag is set, don&apos;t advance a frame</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldx #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop: </span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_status, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #$01</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .endloop&#xA0;&#xA0;&#xA0; ;if stream disabled, skip this stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;add the tempo to the ticker total.&#xA0; If there is a FF-&gt; 0 transition, there is a tick</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ticker_total, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; clc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; adc stream_tempo, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ticker_total, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .endloop&#xA0;&#xA0;&#xA0; ;carry clear = no tick.&#xA0; if no tick, we are done with this stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">dec stream_note_length_counter, x&#xA0;&#xA0; ;else there is a tick. decrement the note length counter</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; bne .endloop&#xA0;&#xA0;&#xA0; ;if counter is non-zero, our note isn&apos;t finished playing yet</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr se_fetch_byte&#xA0;&#xA0; ;else our note is finished.&#xA0; Time to read from the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do more stuff. set volume, note, sweep, etc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.endloop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; inx</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cpx #$06</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.done:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br><br>We
have one last change to make.&#xA0; When we load a new song we will want it
to start playing immediately, so we should initialize the
stream_note_length_counter in the sound_load routine to do just that.&#xA0;
Our sound_play_frame routine decrements the counter and takes action if
the result is zero.&#xA0; Therefore, to ensure that our song starts
immediately, we should initialize our stream_note_length_counter to $01:<br>&#xA0;&#xA0; &#xA0;<br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;somewhere inside the loop of sound_load</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$01</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_length_counter, x</span><br>&#xA0;&#xA0; &#xA0;<br>And
now our engine supports note lengths.&#xA0; But there is still room for
improvement.&#xA0; What if we want to play a series of 8th notes?&#xA0; Not an
uncommon thing to have in music.&#xA0; Here is how our data would have to
look now:<br><br><span style="font-family: Courier New;">sound_data:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth, C5, eighth, E5, eighth, G5, eighth, C6, eighth, E6, eighth, G6, eighth, C7 ;Cmajor</span><br>&#xA0;&#xA0; &#xA0;<br>That&apos;s
a lot of &quot;eighth&quot; bytes.&#xA0; Wouldn&apos;t it be better to just state &quot;eighth&quot;
once, and assume that all notes following it are eighth notes?&#xA0; Like
this:<br><br><span style="font-family: Courier New;">sound_data:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth, C5, E5, G5, C6, E6, G6, C7 ;Cmajor</span><br>&#xA0;&#xA0; &#xA0;<br>That
saved us 6 bytes of ROM space.&#xA0; And if you consider that a game may
have 20+ songs, each with 4 streams of data, each with potentially
several strings of equal-length notes, this kind of change might save
us hundreds, maybe even thousands of bytes!&#xA0; Let&apos;s do it.<br><br>To
pull this off, we will have to store the current note length count
value in RAM.&#xA0; Then when our note length counter runs to 0, we will
refill it with our RAM count value.<br><br><span style="font-family: Courier New; color: rgb(255, 0, 0);">stream_note_length .rs 6&#xA0;&#xA0;&#xA0; ;note length count value</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">;-------</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_fetch_byte:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.fetch:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bpl .note&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if &lt; #$80, it&apos;s a Note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .note_length&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else if &lt; #$A0, it&apos;s a Note Length</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.opcode:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else it&apos;s an opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Opcode stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note_length:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do note length stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #%01111111&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;chop off bit7</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sty sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save Y because we are about to destroy it</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_length_table, y&#xA0;&#xA0;&#xA0; ;get the note length count value</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">sta stream_note_length, x&#xA0;&#xA0; ;save the note length in RAM so we can use it to refill the counter</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_length_counter, x&#xA0;&#xA0; ;stick it in our note length counter</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;restore Y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;set index to next byte in the stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp .fetch&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;fetch another byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do note stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;--------</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_play_frame:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_disable_flag</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .done&#xA0;&#xA0; ;if disable flag is set, don&apos;t advance a frame</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldx #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop: </span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_status, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #$01</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .endloop&#xA0;&#xA0;&#xA0; ;if stream disabled, skip this stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;add the tempo to the ticker total.&#xA0; If there is a FF-&gt; 0 transition, there is a tick</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ticker_total, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; clc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; adc stream_tempo, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ticker_total, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .endloop&#xA0;&#xA0;&#xA0; ;carry clear = no tick.&#xA0; if no tick, we are done with this stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; dec stream_note_length_counter, x&#xA0;&#xA0; ;else there is a tick. decrement the note length counter</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .endloop&#xA0;&#xA0;&#xA0; ;if counter is non-zero, our note isn&apos;t finished playing yet</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">lda stream_note_length, x&#xA0;&#xA0; ;else our note is finished. reload the note length counter</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sta stream_note_length_counter, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr se_fetch_byte&#xA0;&#xA0; ;Time to read from the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do more stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.endloop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; inx</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cpx #$06</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.done:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Adding
those 4 lines of code just saved us hundreds of bytes of ROM space.&#xA0; A
nice tradeoff for 6 bytes of RAM.&#xA0; Now our data will be made up of
&quot;strings&quot;, where we have a note length followed by a series of notes:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_data:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth, C5, E5, G5, C6, E6, G6, quarter, C6 ;six 8th notes and a quarter note</span><br>&#xA0;&#xA0; &#xA0;<br>Easy to read and easy to write.<br><b><br>
Other Note Lengths</b><br>Now that everything is setup, we can add more
note lengths to our note_length_table.&#xA0; Dotted notes are very common in
music.&#xA0; Dotted notes are equal in length to the note plus the next
fastest note.&#xA0; For example, a dotted quarter note = a quarter note + an
8th note.&#xA0; A dotted 8th note = an 8th note + a 16th note.&#xA0; Let&apos;s add
some dotted notes to our table:<br><br>note_length_table:<br>&#xA0;&#xA0;&#xA0; .byte $01&#xA0;&#xA0; ;32nd note<br>&#xA0;&#xA0;&#xA0; .byte $02&#xA0;&#xA0; ;16th note<br>&#xA0;&#xA0;&#xA0; .byte $04&#xA0;&#xA0; ;8th note<br>&#xA0;&#xA0;&#xA0; .byte $08&#xA0;&#xA0; ;quarter note<br>&#xA0;&#xA0;&#xA0; .byte $10&#xA0;&#xA0; ;half note<br>&#xA0;&#xA0;&#xA0; .byte $20&#xA0;&#xA0; ;whole note<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;---dotted notes<br>&#xA0;&#xA0;&#xA0; .byte $03&#xA0;&#xA0; ;dotted 16th note<br>&#xA0;&#xA0;&#xA0; .byte $06&#xA0;&#xA0; ;dotted 8th note<br>&#xA0;&#xA0;&#xA0; .byte $0C&#xA0;&#xA0; ;dotted quarter note<br>&#xA0;&#xA0;&#xA0; .byte $18&#xA0;&#xA0; ;dotted half note<br>&#xA0;&#xA0;&#xA0; .byte $30&#xA0;&#xA0; ;dotted whole note?<br>&#xA0;&#xA0; &#xA0;<br>The
actual order of our note_length_table doesn&apos;t matter.&#xA0; We just have to
make sure our aliases are in the same order as the table:<br><br><span style="font-family: Courier New;">;note length constants (aliases)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">thirtysecond = $80</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sixteenth = $81</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">eighth = $82</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">quarter = $83</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">half = $84</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">whole = $85</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">d_sixteenth = $86</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">d_eighth = $87</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">d_quarter = $88</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">d_half = $89</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">d_whole = $8A&#xA0;&#xA0; ;don&apos;t forget we are counting in hex</span><br><br>Your
music will determine what other entries you&apos;ll need to add to your note
length table.&#xA0; If one of your songs has a really really long note, like
3 whole notes tied together, add it to the table ($60) and make an
alias for it (whole_x3).&#xA0; If your song contains a note that is seven
8th notes long (a half note plus a dotted quarter note tied together),
add it to the table ($1C) and make an alias for it (seven_eighths).<br><font size="4"><b><br>
Buffering APU Writes</b></font><br>Before, we&apos;ve been writing to the
APU one stream at a time.&#xA0; If two different streams shared a channel,
they would both write to the same APU ports.&#xA0; If three streams were to
share a channel, which is possible if there are two different sound
effects loaded into SFX_1 and SFX_2, all three would write to the same
APU ports in the same frame.&#xA0; This is bad practice.&#xA0; It can also cause
some unwanted noise on the square channels.<br><br>A better method is
to buffer our writes.&#xA0; Instead of writing to the APU ports directly,
each stream will instead write its data to temporary ports in RAM.&#xA0;
We&apos;ll keep our loop order, so sfx streams will still overwrite the
music streams.&#xA0; Then when all the streams are done, we will copy the
contents of our temporary RAM ports directly to the APU ports all at
once.&#xA0; This ensures that the APU ports only get written to once per
frame max.&#xA0; To do this, we first need to reserve some RAM space for our
temporary port variables:<br><br><span style="font-family: Courier New;">soft_apu_ports .rs 16</span><br><br>We reserved 16 bytes for our temporary ports.&#xA0; Each one corresponds to an APU port:<br><br><span style="font-family: Courier New;">soft_apu_ports+0&#xA0; -&gt; $4000&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Square 1 ports</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+1&#xA0; -&gt; $4001</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+2&#xA0; -&gt; $4002</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+3&#xA0; -&gt; $4003</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+4&#xA0; -&gt; $4004&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Square 2 ports</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+5&#xA0; -&gt; $4005</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+6&#xA0; -&gt; $4006</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+7&#xA0; -&gt; $4007</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+8&#xA0; -&gt; $4008&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Triangle ports</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+9&#xA0; -&gt; $4009 (unused)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+10 -&gt; $400A</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+11 -&gt; $400B</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+12 -&gt; $400C&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Noise ports</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+13 -&gt; $400D (unused)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+14 -&gt; $400E</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">soft_apu_ports+15 -&gt; $400F</span><br><br>Let&apos;s
implement this by working backwards.&#xA0; First we will edit
sound_play_frame and pull our call to se_set_apu out of the loop.&#xA0; We
do this because we only want to write to the APU once, after all the
streams are done looping:<br><br><span style="font-family: Courier New;">;--------------------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">; sound_play_frame advances the sound engine by one frame</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_play_frame:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_disable_flag</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .done&#xA0;&#xA0; ;if disable flag is set, don&apos;t advance a frame</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldx #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_status, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #$01&#xA0;&#xA0;&#xA0; ;check whether the stream is active</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .endloop&#xA0; ;if the channel isn&apos;t active, skip it</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;add the tempo to the ticker total.&#xA0; If there is a FF-&gt; 0 transition, there is a tick</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ticker_total, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; clc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; adc stream_tempo, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ticker_total, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .endloop&#xA0;&#xA0;&#xA0; ;carry clear = no tick.&#xA0; if no tick, we are done with this stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; dec stream_note_length_counter, x&#xA0;&#xA0; ;else there is a tick. decrement the note length counter</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .endloop&#xA0;&#xA0;&#xA0; ;if counter is non-zero, our note isn&apos;t finished playing yet</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_note_length, x&#xA0;&#xA0; ;else our note is finished. reload the note length counter</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_length_counter, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr se_fetch_byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">;snip</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.endloop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; inx</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cpx #$06</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">jsr se_set_apu</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.done:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Next we will modify se_set_apu to copy the temporary APU ports to the real APU ports:<br><br><span style="font-family: Courier New;">se_set_apu:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$0F</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cpy #$09</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .skip&#xA0;&#xA0; ;$4009 is unused</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cpy #$0D</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .skip&#xA0;&#xA0; ;$400D is unused</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4000, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.skip:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; dey</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bpl .loop&#xA0;&#xA0; ;stop the loop when Y is goes from $00 -&gt; $FF</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Now
we have to write the subroutine that will populate the temporary APU
ports with a stream&apos;s data.&#xA0; This part will get more complicated as we
add more features to our sound engine, but for now it&apos;s quite simple:<br><br><span style="font-family: Courier New;">se_set_temp_ports:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_channel, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_vol_duty, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports, y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;vol</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$08</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports+1, y&#xA0;&#xA0;&#xA0;&#xA0; ;sweep</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_note_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports+2, y&#xA0;&#xA0;&#xA0;&#xA0; ;period LO</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_note_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports+3, y&#xA0;&#xA0;&#xA0;&#xA0; ;period HI</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>We
will make the call to se_set_temp_ports after our call to
se_fetch_byte, where the old se_set_apu call was before we snipped it
out of the loop.&#xA0; Notice that we don&apos;t bother to check the channel
before writing the sweep.&#xA0; se_set_apu takes care of this part for us.&#xA0;
There&apos;s no harm in writing these values to RAM, so we&apos;ll avoid
branching here to simplify the code.<br><br><b>Crackling Sounds</b><br>Writing
to the 4th port of the Square channels ($4003/$4007) has the side
effect of resetting the sequencer.&#xA0; If we write here too often, we will
get a nasty crackling sound out of our Squares.&#xA0; This is not good.<br><br>The
way our engine is setup now, we call se_set_apu once per frame.&#xA0;
se_set_apu writes to $4003/$4007, so these ports will get written to
once per frame.&#xA0; This is too often.&#xA0; We need to find a way to write
here less often.&#xA0; We will do this by cutting out redundant writes.&#xA0; If
the value we want to write this frame is the same as the value written
last frame, skip the write.<br><br>First we will need to keep track of what was last written to the ports.&#xA0; This will require some new variables:<br><br><span style="font-family: Courier New;">sound_sq1_old .rs 1&#xA0; ;the last value written to $4003</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_sq2_old .rs 1&#xA0; ;the last value written to $4007</span><br><br>Whenever
we write to one of these ports, we will also write the value to the
corresponding sound_port4_old variable.&#xA0; Saving this value will allow
us to compare against it next frame.&#xA0; To implement this, we will have
to unroll our loop in se_set_apu:<br><br><span style="font-family: Courier New;">se_set_apu:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.square1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4000</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4001</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4002</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4003</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_sq1_old&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save the value we just wrote to $4003</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.square2:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4004</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+5</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4005</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+6</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4006</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+7</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4007</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_sq2_old&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save the value we just wrote to $4007</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.triangle:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+8</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4008</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+10</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400A</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+11</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400B</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.noise:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+12</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400C</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+14</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400E</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+15</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400F</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Now
we have a variable that will keep track of the last value written to a
channel&apos;s 4th port.&#xA0; The next step is to add a check before we write:<br><br><span style="font-family: Courier New;">se_set_apu:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.square1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4000</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4001</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4002</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">cmp sound_sq1_old&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;compare to last write</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; beq .square2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;don&apos;t write this frame if they were equal</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4003</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_sq1_old&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save the value we just wrote to $4003</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.square2:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4004</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+5</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4005</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+6</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4006</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+7</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">cmp sound_sq2_old</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; beq .triangle</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4007</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_sq2_old&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save the value we just wrote to $4007</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.triangle:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+8</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4008</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+10&#xA0;&#xA0; ;there is no $4009, so we skip it</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400A</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+11</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400B</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.noise:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+12</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400C</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+14&#xA0;&#xA0; ;there is no $400D, so we skip it</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400E</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda soft_apu_ports+15</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $400F</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Finally
we have to consider initialization.&#xA0; The only case we really have to
worry about is the first time a song is played in the game.&#xA0; Consider
what happens if we initialize the sound_sq1_old and sound_sq2_old
variables to $00.&#xA0; We are essentially saying that on startup (RESET)
the last byte written to $4003/$4007 was a $00, which isn&apos;t true of
course.&#xA0; On startup, no write has ever been made to these ports.&#xA0; If we
initialize to $00, and if the first note of the first song played has a
$00 for the high 3 bits of its period, it will get skipped.&#xA0; That is
not what we want.&#xA0; Instead, we should initialize these variables to
some value that will never be written to $4003/$4007, like $FF.&#xA0; This
ensures that the first note(s) played in the game won&apos;t be skipped.<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_init:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$0F</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta $4015&#xA0;&#xA0; ;enable Square 1, Square 2, Triangle and Noise channels</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_disable_flag&#xA0; ;clear disable flag</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;later, if we have other variables we want to initialize, we will do that here.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">lda #$FF</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sta sound_sq1_old</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sta sound_sq2_old</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_silence:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$30</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">sta soft_apu_ports&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;set Square 1 volume to 0</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sta soft_apu_ports+4&#xA0;&#xA0;&#xA0; ;set Square 2 volume to 0</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sta soft_apu_ports+12&#xA0;&#xA0; ;set Noise volume to 0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$80</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">sta soft_apu_ports+8&#xA0;&#xA0;&#xA0;&#xA0; ;silence Triangle</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br><font size="4"><b>Rests</b></font><br><br>The final topic we will cover this lesson is rests.&#xA0; A <b>rest</b>
is a period of silence in between notes.&#xA0; Like notes, rests can be of
variable length: quarter rest, half rest, whole rest, etc.&#xA0; In other
words a rest is a silent note.<br><br>So how will we implement it?&#xA0; We
will handle rests by considering a rest to be special case note.&#xA0; We
will give the rest a dummy period in our note table.&#xA0; Then, when we
fetch a byte from the data stream and determine the byte to be a note,
we will add an extra check to see if that note is a rest.&#xA0; If it is, we
will make sure that it shuts up the stream.<br><br>First let&apos;s add the
rest to our note table.&#xA0; We will give it a dummy period.&#xA0; It doesn&apos;t
really matter what value we use.&#xA0; I&apos;m going to give it a period of
$0000.&#xA0; We will also want to add the rest to our list of note aliases:<br><br><span style="font-family: Courier New;">note_table:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word $07F1, $0780, etc...</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;....more note table values here</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.word $0000 ;rest.&#xA0; Last entry</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;Note: octaves in music traditionally start at C, not A&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">A1 = $00&#xA0;&#xA0;&#xA0; ;the &quot;1&quot; means Octave 1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">As1 = $01&#xA0;&#xA0; ;the &quot;s&quot; means &quot;sharp&quot;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">Bb1 = $01&#xA0;&#xA0; ;the &quot;b&quot; means &quot;flat&quot;&#xA0; A# == Bb, so same value</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">B1 = $02</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;..... other aliases here</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">F9 = $5c</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">Fs9 = $5d</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">Gb9 = $5d</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">rest = $5e</span><br><br>Now
we can use the symbol &quot;rest&quot; in our music data.&#xA0; &quot;rest&quot; will evaluate
to the value $5E, which falls within our note range ($00-$7F).&#xA0; When
our sound engine encounters a $5E in the data stream, it will pull the
period ($0000) from the note table and store it in RAM.&#xA0; A period of
$0000 is actually low enough to silence the square channels, but the
triangle channel is still audible at this period so we have more work
to do.<br><br><b>Checking for a rest</b><br>When we encounter a rest,
we will want to tell the sound engine to shut this stream up until the
next note.&#xA0; The rest functions differently from all the other notes, so
we will need to make a special check for it in our code.&#xA0; We will make
a subroutine se_check_rest to do this for us:<br><br><span style="font-family: Courier New;">se_fetch_byte:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.fetch:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bpl .note&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if &lt; #$80, it&apos;s a Note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .note_length&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else if &lt; #$A0, it&apos;s a Note Length</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.opcode:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else it&apos;s an opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Opcode stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note_length:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Note Length stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Note stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sty sound_temp1&#xA0;&#xA0;&#xA0;&#xA0; ;save our index into the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table+1, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy sound_temp1&#xA0;&#xA0;&#xA0;&#xA0; ;restore data stream index</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">;check if it&apos;s a rest</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; jsr se_check_rest&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.update_pointer:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tya</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; clc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; adc stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .end</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; inc stream_ptr_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.end:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>se_check_rest
will check to see if the note value is equal to $5E or not.&#xA0; If it is,
we will need to tell the sound engine to silence the stream.&#xA0; If the
note isn&apos;t equal to $5E, we can go on our merry way.<br><br>How will we
silence our stream then?&#xA0; This is actually a little complicated.&#xA0;
Recall that the stream&apos;s volume (stream_vol_duty) is set in the song&apos;s
header.&#xA0;&#xA0; se_set_temp_ports copies the value of stream_vol_duty to
soft_apu_ports.&#xA0; If we have se_check_rest modify the stream_vol_duty
variable directly (set it to 0 volume), the old volume value
disappears.&#xA0; We won&apos;t know what to restore it to when we are done with
our rest.&#xA0; Oh no!<br><br>What we will want to do instead is leave
stream_vol_duty alone.&#xA0; We will copy it into soft_apu_ports every frame
as usual.&#xA0; Then, after the copy we will check to see if we are
currently resting.&#xA0; If we are, we will make another write
soft_apu_ports with a value that will set the volume to 0.&#xA0; Make sense?<br><br><b>stream_status</b><br>To
do this we will need to keep track of our resting status in a
variable.&#xA0; If our sound engine encounters a $5E in the data stream,
we&apos;ll turn our resting status on.&#xA0; If it&apos;s not, we&apos;ll turn our resting
status off.&#xA0; There are only two possibilities: on or off.&#xA0; Rather than
declare a whole new block of variables and waste six bytes of RAM,
let&apos;s assign one of the bits in our stream_status variable to be our
rest indicator:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">Stream Status Byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ||</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; |+- Enabled (0: stream disabled; 1: enabled)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; +-- Rest (0: not resting; 1: resting)</span><br>&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;<br>Our new subroutine se_check_rest will be in charge of setting or clearing this bit of the status byte:<br><br><span style="font-family: Courier New;">se_check_rest:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0; ;read the note byte again</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #rest&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;is it a rest? (==$5E)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .not_rest</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_status, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ora #%00000010&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if so, set the rest bit in the status byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .store&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this will always branch.&#xA0; bne is cheaper than a jmp.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.not_rest:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_status, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #%11111101&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;clear the rest bit in the status byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.store:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_status, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Then we modify se_set_temp_ports to check the rest bit and silence the stream if it is set:<br><br><span style="font-family: Courier New;">se_set_temp_ports:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_channel, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_vol_duty, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports, y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;vol</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$08</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports+1, y&#xA0;&#xA0;&#xA0;&#xA0; ;sweep</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_note_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports+2, y&#xA0;&#xA0;&#xA0;&#xA0; ;period LO</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_note_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports+3, y&#xA0;&#xA0;&#xA0;&#xA0; ;period HI</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">;check the rest flag. if set, overwrite volume with silence value </span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda stream_status, x</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; and #%00000010</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; beq .done&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if clear, no rest, so quit</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda stream_channel, x</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; cmp #TRIANGLE&#xA0;&#xA0; ;if triangle, silence with #$80</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; beq .tri&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda #$30&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else, silence with #$30</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; bne .store&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this will always branch.&#xA0; bne is cheaper than a jmp.</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">.tri:</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda #$80</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">.store:&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sta soft_apu_ports, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.done:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>That&apos;s it.&#xA0; Now our engine supports rests!&#xA0; They work just like notes, so their lengths are controlled with note lengths:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">song_data:&#xA0; ;this data has two quarter rests in it.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte half, C2, quarter, rest, eighth, D4, C4, quarter, B3, rest</span><br>&#xA0;&#xA0; &#xA0;<br><b>Putting It All Together</b><br>Download and unzip the <a href="downloads/NerdyNightsSoundSourceCollection/tempo.zip" target="_blank" original-href="http://tummaigames.com/tempo.zip">tempo.zip</a> sample files.&#xA0; Make sure the following files are in the same folder as NESASM3:<br><br>&#xA0;&#xA0;&#xA0; tempo.asm<br>&#xA0;&#xA0;&#xA0; sound_engine.asm<br>&#xA0;&#xA0;&#xA0; tempo.chr<br>&#xA0;&#xA0;&#xA0; note_table.i<br>&#xA0;&#xA0;&#xA0; note_length_table.i<br>&#xA0;&#xA0;&#xA0; song0.i<br>&#xA0;&#xA0;&#xA0; song1.i<br>&#xA0;&#xA0;&#xA0; song2.i<br>&#xA0;&#xA0;&#xA0; song3.i<br>&#xA0;&#xA0;&#xA0; song4.i<br>&#xA0;&#xA0;&#xA0; song5.i<br>&#xA0;&#xA0;&#xA0; tempo.bat<br><br>Double click tempo.bat. That will run NESASM3 and should produce the tempo.nes file. Run that NES file in FCEUXD SP.<br><br>Use the controller to select songs and play them.&#xA0; Controls are as follows:<br>&#xA0;&#xA0; &#xA0;<br><b>Up</b>: Play<br><b>Down</b>: Stop <br><b>Right</b>: Next Song/SFX<br><b>Left</b>: Previous Song/SFX<br><br>Song0
is a silence song.&#xA0; Not selectable.&#xA0; tempo.asm &quot;plays&quot; song0 to stop
the music when you press down.&#xA0; See song0.i to find out how it works.<br>Song1 is last week&apos;s evil sounding series of minor thirds, but much faster now thanks to tempo settings.<br>Song2 is the same short sound effect from last week.<br>Song3
is a simple descending chord progression.&#xA0; We saved some bytes in the
triangle data using note lengths (compare to last week&apos;s file)<br>Song4 is a new song that showcases variable note lengths and rests.<br>Song5
is a short sound effect.&#xA0; It plays 10 notes extremely fast.&#xA0; Play it
over songs and see how it steals the SQ2 channel from the music.<br><br>Try
creating your own songs and sound effects and add them into the mix.&#xA0;
To add a new song you will need to take the following steps:<br><br>1)
create a song header and song data (use the included songs as
reference).&#xA0; Don&apos;t forget to add tempos for each stream in your
header.&#xA0; Data streams are terminated with $FF.<br>2) add your header to the song_headers pointer table at the bottom of sound_engine.asm<br>3) update the constant NUM_SONGS to reflect the new song number total (also at the bottom of sound_engine.asm)<br><br>Although
not necessary, I recommend keeping your song data in a separate file
like I&apos;ve done with song0.i, song1.i, song2.i and song3.i.&#xA0; This makes
it easier to find the data if you need to edit your song later.&#xA0; If you
do this, don&apos;t forget to .include your file.<br><br><b>Next Week</b>: <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=25253" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=25253">Volume Envelopes</a><br>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#audio_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;audio_tutorial-6__comments&apos;);">
                            是否显示评论内容
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=24885" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="audio_tutorial-6__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__1">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Oct 23, 2009 at 4:39:44 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This one is long again, but not as long as it looks.  Most of the code is stuff we&apos;ve already written.  Wherever I modified an existing subroutine I tried to highlight the new parts in red.  I hope that will make it easier to understand the changes.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__2">
                                                        <div class="mdl-card__title"><strong>removed-07-06-2016</strong> posted on 
		
			
				
				Oct 23, 2009 at 5:12:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Man, you&apos;re tutorials are so thorough.  Fantastic job!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__3">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Oct 23, 2009 at 9:06:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oh god...my brain hurts.  
<br>Excellent job though.  This is awesome!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__4">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Oct 23, 2009 at 11:30:01 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sweet.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__5">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Oct 23, 2009 at 11:14:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					well, somehow this broke my splash screen tune, but I do have it working with my sound effects. If I recall though I had to initialize it weird before and had issues with it. 
<br>
<br>well, looks like after the next week comes out, I will actually be able to put music in. need the looping and envelopes. 
<br>
<br>now back to trying to fix the stupid splash tune.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__6">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Oct 24, 2009 at 12:23:54 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here are some changes I can think of off the top of my head that would need to be made between the old sound format and the new:<br><br>1) In your song headers, make sure you add a tempo field for each stream<br>2) Make sure you add note lengths into your sound data.&#xA0; For each stream, the very first byte should be a note length.<br><br>Can you send me the song data for your song and sfx (in this thread or in a PM)?&#xA0; Maybe if I see it I can spot the problem.&#xA0; It&apos;s also possible that my code has a bug that I didn&apos;t catch.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__7">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Oct 24, 2009 at 12:54:59 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I can send it, but I&apos;m pretty sure it has to do with my code. I had problems with it in the last sound engine. I set the current song and jsr sound_load in my gamestate, but I don&apos;t sound_init till a certain spot in the animation(which is in a whole other function). The song works, cause I can run it on the title screen instead of a sound effect. If you don&apos;t find anything, I&apos;ll go look at my build right before this one and see.
<br>
<br>It&apos;s the only way I could get it to start when I wanted it to before, without a constant tone playing before the sound before.
<br>
<br>Here&apos;s the engine, it&apos;s pretty much just checking for the start of the &quot;homebrew animation&quot; which is the cue to load the song. after that it&apos;s just a delay after games pops up before going to the title screen.
<br>
<br>EngineSplash:
<br>  LDA rowcount
<br>  CMP #$01
<br>  BCS godelay
<br>  <span style="color: rgb(255, 0, 0); font-weight: bold;">LDA #$02
</span><br style="color: rgb(255, 0, 0); font-weight: bold;"><span style="color: rgb(255, 0, 0); font-weight: bold;">  STA current_song
</span><br style="color: rgb(255, 0, 0); font-weight: bold;"><span style="color: rgb(255, 0, 0); font-weight: bold;">  JSR sound_load
</span><br>godelay:
<br>  LDA game2
<br>  CMP #$9F
<br>  BEQ INCdelay
<br>  JMP GameEngineDone
<br>INCdelay:
<br>  INC delaycount
<br>  LDA delaycount
<br>  CMP #$40
<br>  BEQ loadgame
<br>  JMP GameEngineDone
<br>loadgame:
<br>  JSR ClrSprites
<br>  JSR sound_disable
<br>  LDA #BGTITLE
<br>  STA BG_ptr
<br>  STA ATT_ptr
<br>  JSR loadbackground
<br>  JSR loadattribute
<br>  JSR LoadTitle
<br>  JMP GameEngineDone
<br>
<br>here&apos;s the actual hackish animation for the splash page. no laughing at my ugly code <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> note the JSR sound_init is right when the first sprites of the &quot;H&quot; are suppose to move into place.
<br>
<br>splashanim:
<br>
<br>  LDA beerpnt
<br>  CMP #$04
<br>  BNE INCbeer
<br>  JMP Homebrew
<br>
<br>INCbeer:
<br>  INC beercount
<br>  LDA beercount
<br>  CMP #$20
<br>  BEQ beer1
<br>  JMP beerover
<br>beer1:
<br>  LDA beerpnt
<br>  CMP #$00
<br>  BNE beer2
<br>
<br>  LoadPalettesbeer:
<br>  LDA $2002             ; read PPU status to reset the high/low latch
<br>  LDA #$3F
<br>  STA $2006             ; write the high byte of $3F00 address
<br>  LDA #$00
<br>  STA $2006             ; write the low byte of $3F00 address
<br>  LDX #$00              ; start out at 0
<br>LoadPalettesbeerLoop:
<br>  LDA palettebeer, x        ; load data from address (palette + the value in x)
<br>                          ; 1st time through loop it will load palette+0
<br>                          ; 2nd time through loop it will load palette+1
<br>                          ; 3rd time through loop it will load palette+2
<br>                          ; etc
<br>  STA $2007             ; write to PPU
<br>  INX                   ; X = X + 1
<br>  CPX #$20              ; Compare X to hex $20, decimal 32 - copying 32 bytes = 8 palettes
<br>  BNE LoadPalettesbeerLoop  ; Branch to LoadPalettesLoop if compare was Not Equal to zero
<br>                        ; if compare was equal to 32, keep going down
<br>
<br>  LDA beerpnt
<br>  CLC
<br>  ADC #$01
<br>  STA beerpnt
<br>  LDA #$00
<br>  STA beercount
<br>  JMP beerover
<br>beer2:
<br>  LDA beerpnt
<br>  CMP #$01
<br>  BNE beer3
<br>
<br>  LoadPalettesbeer2:
<br>  LDA $2002             ; read PPU status to reset the high/low latch
<br>  LDA #$3F
<br>  STA $2006             ; write the high byte of $3F00 address
<br>  LDA #$00
<br>  STA $2006             ; write the low byte of $3F00 address
<br>  LDX #$00              ; start out at 0
<br>LoadPalettesbeer2Loop:
<br>  LDA palettebeer2, x        ; load data from address (palette + the value in x)
<br>                          ; 1st time through loop it will load palette+0
<br>                          ; 2nd time through loop it will load palette+1
<br>                          ; 3rd time through loop it will load palette+2
<br>                          ; etc
<br>  STA $2007             ; write to PPU
<br>  INX                   ; X = X + 1
<br>  CPX #$20              ; Compare X to hex $20, decimal 32 - copying 32 bytes = 8 palettes
<br>  BNE LoadPalettesbeer2Loop  ; Branch to LoadPalettesLoop if compare was Not Equal to zero
<br>                        ; if compare was equal to 32, keep going down
<br>
<br>  LDA beerpnt
<br>  CLC
<br>  ADC #$01
<br>  STA beerpnt
<br>  LDA #$00
<br>  STA beercount
<br>  JMP beerover
<br>beer3:
<br>  LDA beerpnt
<br>  CMP #$02
<br>  BNE beer4
<br>
<br>  LoadPalettesbeer3:
<br>  LDA $2002             ; read PPU status to reset the high/low latch
<br>  LDA #$3F
<br>  STA $2006             ; write the high byte of $3F00 address
<br>  LDA #$00
<br>  STA $2006             ; write the low byte of $3F00 address
<br>  LDX #$00              ; start out at 0
<br>LoadPalettesbeer3Loop:
<br>  LDA palettebeer3, x        ; load data from address (palette + the value in x)
<br>                          ; 1st time through loop it will load palette+0
<br>                          ; 2nd time through loop it will load palette+1
<br>                          ; 3rd time through loop it will load palette+2
<br>                          ; etc
<br>  STA $2007             ; write to PPU
<br>  INX                   ; X = X + 1
<br>  CPX #$20              ; Compare X to hex $20, decimal 32 - copying 32 bytes = 8 palettes
<br>  BNE LoadPalettesbeer3Loop  ; Branch to LoadPalettesLoop if compare was Not Equal to zero
<br>                        ; if compare was equal to 32, keep going down
<br>
<br>  LDA beerpnt
<br>  CLC
<br>  ADC #$01
<br>  STA beerpnt
<br>  LDA #$00
<br>  STA beercount
<br>  JMP beerover
<br>beer4:
<br>
<br>  LDA beerpnt
<br>  CMP #$03
<br>  BNE beerover
<br>
<br>  LoadPalettesbeer4:
<br>  LDA $2002             ; read PPU status to reset the high/low latch
<br>  LDA #$3F
<br>  STA $2006             ; write the high byte of $3F00 address
<br>  LDA #$00
<br>  STA $2006             ; write the low byte of $3F00 address
<br>  LDX #$00              ; start out at 0
<br>LoadPalettesbeer4Loop:
<br>  LDA palettebeer4, x        ; load data from address (palette + the value in x)
<br>                          ; 1st time through loop it will load palette+0
<br>                          ; 2nd time through loop it will load palette+1
<br>                          ; 3rd time through loop it will load palette+2
<br>                          ; etc
<br>  STA $2007             ; write to PPU
<br>  INX                   ; X = X + 1
<br>  CPX #$20              ; Compare X to hex $20, decimal 32 - copying 32 bytes = 8 palettes
<br>  BNE LoadPalettesbeer4Loop  ; Branch to LoadPalettesLoop if compare was Not Equal to zero
<br>                        ; if compare was equal to 32, keep going down
<br>
<br>  LDA #$04
<br>  STA beerpnt
<br>  LDA #$00
<br>  STA beercount
<br>
<br>beerover:
<br>  RTS
<br>
<br>Homebrew:
<br>  
<br>  LDA rowcount
<br>  CMP #$0C
<br>  BNE INChomebrew
<br>  JMP Games
<br>
<br>INChomebrew:
<br>  
<br>  INC homebrewcount
<br>  LDA homebrewcount
<br>  CMP #$08
<br>  BEQ loadrow1
<br>  JMP hbover
<br>loadrow1:
<br>  LDA rowcount
<br>  CMP #$00
<br>  BNE loadrow2
<br>
<br>  <span style="font-weight: bold; color: rgb(255, 0, 0);">JSR sound_init
</span><br>  LDA #$5F
<br>  STA hone1
<br>  LDA #$67
<br>  STA hone2
<br>
<br>  LDA rowcount
<br>  CLC
<br>  ADC #$01
<br>  STA rowcount
<br>  LDA #$00
<br>  STA homebrewcount
<br>  JMP hbover
<br>loadrow2:
<br>  LDA rowcount
<br>  CMP #$01
<br>  BNE loadrow3
<br>
<br>  LDA #$57
<br>  STA htwo1
<br>  LDA #$5F
<br>  STA htwo2
<br>  LDA #$67
<br>  STA htwo3
<br>  
<br>  LDA rowcount
<br>  CLC
<br>  ADC #$01
<br>  STA rowcount
<br>  LDA #$00
<br>  STA homebrewcount
<br>  JMP hbover
<br>loadrow3:
<br>  LDA rowcount
<br>  CMP #$02
<br>  BNE loadrow4
<br>
<br>  LDA #$4F
<br>  STA hthree1
<br>  LDA #$57
<br>  STA hthree2
<br>  LDA #$5F
<br>  STA hthree3
<br>  
<br>  LDA rowcount
<br>  CLC
<br>  ADC #$01
<br>  STA rowcount
<br>  LDA #$00
<br>  STA homebrewcount
<br>  JMP hbover
<br>loadrow4:
<br>  LDA rowcount
<br>  CMP #$03
<br>  BNE loadrow5
<br>
<br>  LDA #$4F
<br>  STA hfour1
<br>  LDA #$57
<br>  STA hfour2
<br>  LDA #$5F
<br>  STA hfour3
<br>  
<br>  LDA rowcount
<br>  CLC
<br>  ADC #$01
<br>  STA rowcount
<br>  LDA #$00
<br>  STA homebrewcount
<br>  JMP hbover
<br>loadrow5:
<br>  LDA rowcount
<br>  CMP #$04
<br>  BNE loadrow6
<br>
<br>  LDA #$4F
<br>  STA hfive1
<br>  LDA #$57
<br>  STA hfive2
<br>  
<br>  LDA rowcount
<br>  CLC
<br>  ADC #$01
<br>  STA rowcount
<br>  LDA #$00
<br>  STA homebrewcount
<br>  JMP hbover
<br>loadrow6:
<br>  LDA rowcount
<br>  CMP #$05
<br>  BNE loadrow7
<br>
<br>  LDA #$4F
<br>  STA hsix1
<br>  LDA #$57
<br>  STA hsix2
<br>  
<br>  LDA rowcount
<br>  CLC
<br>  ADC #$01
<br>  STA rowcount
<br>  LDA #$00
<br>  STA homebrewcount
<br>  JMP hbover
<br>loadrow7:
<br>  LDA rowcount
<br>  CMP #$06
<br>  BNE loadrow8
<br>
<br>  LDA #$4F
<br>  STA hseven1
<br>  LDA #$57
<br>  STA hseven2
<br>  
<br>  LDA rowcount
<br>  CLC
<br>  ADC #$01
<br>  STA rowcount
<br>  LDA #$00
<br>  STA homebrewcount
<br>  JMP hbover
<br>loadrow8:
<br>  LDA rowcount
<br>  CMP #$07
<br>  BNE loadrow9
<br>
<br>  LDA #$4F
<br>  STA height1
<br>  LDA #$57
<br>  STA height2
<br>  
<br>  LDA rowcount
<br>  CLC
<br>  ADC #$01
<br>  STA rowcount
<br>  LDA #$00
<br>  STA homebrewcount
<br>  JMP hbover
<br>loadrow9:
<br>  LDA rowcount
<br>  CMP #$08
<br>  BNE loadrow10
<br>
<br>  LDA #$4F
<br>  STA hnine1
<br>  LDA #$57
<br>  STA hnine2
<br>  LDA #$5F
<br>  STA hnine3
<br>  
<br>  LDA rowcount
<br>  CLC
<br>  ADC #$01
<br>  STA rowcount
<br>  LDA #$00
<br>  STA homebrewcount
<br>  JMP hbover
<br>loadrow10:
<br>  LDA rowcount
<br>  CMP #$09
<br>  BNE loadrow11
<br>
<br>  LoadPalettes5S:
<br>  LDA $2002             ; read PPU status to reset the high/low latch
<br>  LDA #$3F
<br>  STA $2006             ; write the high byte of $3F00 address
<br>  LDA #$00
<br>  STA $2006             ; write the low byte of $3F00 address
<br>  LDX #$00              ; start out at 0
<br>LoadPalettes5SLoop:
<br>  LDA palette5S, x        ; load data from address (palette + the value in x)
<br>                          ; 1st time through loop it will load palette+0
<br>                          ; 2nd time through loop it will load palette+1
<br>                          ; 3rd time through loop it will load palette+2
<br>                          ; etc
<br>  STA $2007             ; write to PPU
<br>  INX                   ; X = X + 1
<br>  CPX #$20              ; Compare X to hex $20, decimal 32 - copying 32 bytes = 8 palettes
<br>  BNE LoadPalettes5SLoop  ; Branch to LoadPalettesLoop if compare was Not Equal to zero
<br>                        ; if compare was equal to 32, keep going down
<br>
<br>  LDA #$5F
<br>  STA hten2
<br>
<br>  LDA rowcount
<br>  CLC
<br>  ADC #$01
<br>  STA rowcount
<br>  LDA #$00
<br>  STA homebrewcount
<br>  JMP hbover
<br>loadrow11:
<br>  LDA rowcount
<br>  CMP #$0A
<br>  BNE loadrow12
<br>
<br>  LoadPalettes6S:
<br>  LDA $2002             ; read PPU status to reset the high/low latch
<br>  LDA #$3F
<br>  STA $2006             ; write the high byte of $3F00 address
<br>  LDA #$00
<br>  STA $2006             ; write the low byte of $3F00 address
<br>  LDX #$00              ; start out at 0
<br>LoadPalettes6SLoop:
<br>  LDA palette6S, x        ; load data from address (palette + the value in x)
<br>                          ; 1st time through loop it will load palette+0
<br>                          ; 2nd time through loop it will load palette+1
<br>                          ; 3rd time through loop it will load palette+2
<br>                          ; etc
<br>  STA $2007             ; write to PPU
<br>  INX                   ; X = X + 1
<br>  CPX #$20              ; Compare X to hex $20, decimal 32 - copying 32 bytes = 8 palettes
<br>  BNE LoadPalettes6SLoop  ; Branch to LoadPalettesLoop if compare was Not Equal to zero
<br>                        ; if compare was equal to 32, keep going down
<br>
<br>  LDA #$5F
<br>  STA heleven2
<br>  LDA #$67
<br>  STA heleven3
<br>
<br>  LDA rowcount
<br>  CLC
<br>  ADC #$01
<br>  STA rowcount
<br>  LDA #$00
<br>  STA homebrewcount
<br>  JMP hbover
<br>loadrow12:
<br>  LDA rowcount
<br>  CMP #$0B
<br>  BNE hbover
<br>
<br>  LDA #$5F
<br>  STA htweleve1
<br>  LDA #$67
<br>  STA htweleve2
<br>
<br>  
<br>  LDA rowcount
<br>  CLC
<br>  ADC #$01
<br>  STA rowcount
<br>  LDA #$00
<br>  STA homebrewcount
<br>  JMP hbover
<br>hbover:
<br>
<br>  RTS
<br>
<br>Games:
<br>
<br>  INC gamecount
<br>  LDA gamecount
<br>  CMP #$20
<br>  BNE gamesdone
<br>  LDA #$97
<br>  STA game1
<br>  LDA #$9F
<br>  STA game2
<br>gamesdone:
<br>
<br>  RTS
<br>
<br>
<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__8">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Oct 24, 2009 at 6:05:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ll take a closer look at the code when I have a little more time (ie, after the kid goes to bed), but right off the bat the call to sound_init looks fishy.  sound_init only needs to be called once, and normally you would call it on startup.  Try pulling the jsr sound_init out of the game engine code and sticking it somewhere in your reset code.
<br>
<br>Once your sound engine is initialized, you should never have to touch sound_init again.  Just call it once on startup and you&apos;re done.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__9">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Oct 24, 2009 at 1:55:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve tried that. I didn&apos;t do that initially cause I didn&apos;t want the music to start upon startup. you can load the song and use the initialization function to play when you want it to start. 
<br>
<br>I actually use the initialization and disable functions throughout. If I have a screen without music, I want to disable, otherwise the song from the previous page will continue to play on the new page.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__10">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Oct 25, 2009 at 5:57:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>udisi</b></i><br><br>I&apos;ve tried that. I didn&apos;t do that initially cause I didn&apos;t want the music to start upon startup. you can load the song and use the initialization function to play when you want it to start. 
<br>
<br>I actually use the initialization and disable functions throughout. If I have a screen without music, I want to disable, otherwise the song from the previous page will continue to play on the new page.</div><br><br>Music won&apos;t play on startup if you don&apos;t load a song, so you don&apos;t have to worry about that anymore.&#xA0; The intended usage of the engine is this:<br><br>1) call sound_init on startup (in reset)<br>2) when you want to play a song or sound effect, call sound_load<br>3) when you want the engine to be quiet (like when changing states/screens), play the silence song (see song0.i included in tempo.zip)<br><br>You shouldn&apos;t be using sound_disable/sound_init to silence and restart the engine like that.&#xA0; Everything should be done through sound_load.&#xA0; You&apos;ll save on ROM space this way (fewer JSRs) and you&apos;ll have perfect control of when a song/sfx starts and finishes.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__11">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Oct 25, 2009 at 6:25:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ll give it a try tonight and see if it helps. I have a lot of stuff happening in the splash screen. palette changes, and sprite movements, maybe there&apos;s some register conflicts or something.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__12">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Oct 25, 2009 at 9:00:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					ok, progress. It had nothing to do with sound_init, sound_load, etc. It had something to do with duty cycle. In the old engine, I made a mistake, when I changed the duty cycle and had enabled the length counter and envelope volume. %10001111, was the value. In the new engine, it has to be %10111111. I had done a bad hex to binary conversion. works fine no matter where I initialize sound, etc. I knew it was probably my issue lol. once again, one damn value screwed things up.<br><br>Only thing weird now, is the tune is more fluid. before it seemed more choppy, and I haven&apos;t figured out how to get that choppy sound back.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__13">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Oct 27, 2009 at 1:53:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<span style="font-weight: bold;">Typo</span><br>Glad you got it fixed.&#xA0; Little value errors like that are an annoying problem.&#xA0; I get them all the time too <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">.&#xA0; One way to avoid this kind of error is to use constants/aliases, which we have been doing for the notes, channels, streams and note lengths.&#xA0; We could make some constants for the different duty cycles:<br><br>duty_0 =&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0; %00110000 ;bottom 4 bits blank, because we will OR with volume<br>duty_25 =&#xA0;&#xA0;&#xA0; &#xA0;&#xA0; %01110000<br>duty_50 =&#xA0;&#xA0;&#xA0; &#xA0;&#xA0; %10110000<br>duty_25_neg = %11110000<br><br>and then in our song files, instead of declaring the duty_vol byte like this:<br><br>.byte %10111111 ;duty 50%, volume F, but I might make a typo!<br><br>we could declare it like this:<br><br>.byte duty_50 | $0F ;the assembler will translate this into %10111111<br><br>At least I think that will work.&#xA0; I think nesasm reads the &quot;|&quot; as a logical OR.<br><br><span style="font-weight: bold;">Sound</span><br>The difference in sound (smooth vs. choppy) is probably the result of turning off the saw envelopes and length counter. The saw envelope is the one built-in volume envelope you get with the hardware.&#xA0; It&apos;s a simple volume-decreasing envelope (down to 0), so when you had it enabled it you probably got some hush on the notes.&#xA0; Enabling the length counter would take control of the note lengths, and the length value that we&apos;ve been feeding to $4003/$4007 would make those notes quite short.&#xA0; That&apos;s my guess as to why you had a choppy sound before. &#xA0;<br><br>When you turned saw envelopes and the length counter off, you basically told the square to give you a constant volume (which you set to F: %xxxx1111) for full-length notes, so the notes will have the same volume for the whole duration of the note.&#xA0; Across several notes this gives a fluid sound.<br><br>If I&apos;m right about the cause of the sound change (hard to know for sure without actually hearing what you mean by &quot;choppy&quot;), we should be able to fix it when we get to volume envelopes, since that is how we will control note volume and length.&#xA0; You will be able to create your own volume envelope that gives you short, quieting notes.<br><br>Next &quot;week&apos;s&quot; lesson is supposed to be opcodes and looping.&#xA0; I was going to try to fit volume envelopes in too if it didn&apos;t get too long, but I was also thinking about splitting it into two lessons.&#xA0; I wasn&apos;t satisfied with the length of the last two lessons (too long).&#xA0; If I do split them, do you have a preference for which topic I cover first (looping vs. volume envelopes)?&#xA0; Maybe it will be easier if I cover volume envelopes first.&#xA0; The tutorials might come faster if I do it that way too.&#xA0; I&apos;ll think about it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__14">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Oct 27, 2009 at 11:30:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I would think envelopes would be preference. The music, I&apos;m gonna use is pretty involved, and has envelopes and vibrato, etc. I&apos;ve been dying to try some roughed in tunes, but the engine hasn&apos;t been capable yet. 
<br>
<br>Looping probably more logical step, but some of the bells and whistles are needed for me personally to try out some of the music that is planned for my game. It uses a lot of duty cycle sweeps, and volume envelopes. If I had those, I should be able to at least put in some partial tunes and see how they play through the engine.
<br>
<br>So far though, must say, I&apos;m liking the versatility of the engine, and the simplicity of the song data.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__15">
                                                        <div class="mdl-card__title"><strong>ddribin</strong> posted on 
		
			
				
				Dec 13, 2009 at 6:41:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div>Hey MetalSlime,</div><div><br></div><div>Thanks a <i>bunch</i>&#xA0;for these tutorials. &#xA0;They&apos;ve been very interesting, and I&apos;ve been having fun with the sound engine. However, I think I found a bug in sound_load in regards to stream_ticker_total. &#xA0;In this article, you mention:</div><div><br></div><hr><div class="FTQUOTE"><i>Originally posted by: <b>MetalSlime</b></i><br>Then
we will need to edit sound_load to read this new byte for each stream
and store it in RAM.&#xA0; We&apos;ll also want to initialize stream_ticker_total
to some fixed starting value, preferably a high one so that the first
tick will happen without a delay.&#xA0; Finally, we will have to update all
of our songs to include tempos in their headers.<br></div><hr>Then, in the code, it gets initialized to $A0:<div><br></div><div><div>&#xA0;&#xA0; &#xA0;lda #$A0</div><div>&#xA0;&#xA0; &#xA0;sta stream_ticker_total, x</div><div><br></div><div>The problem is if a song has a tempo of less than $60, then the ticker won&apos;t roll over on the first frame. To hear this, change the tempo of song 2 to $10 and then play it twice in a row. The second time it gets played, the last note is briefly played again.</div><div><br></div><div>If I initialize stream_ticker_total to $FF in sound_load, then it seems to fix it. Is this the best fix? What was the reasoning behind using $A0?</div><div><br></div><div>Thanks,</div><div><br></div><div>-Dave</div><div><br></div><br>
</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-6__16">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Dec 14, 2009 at 6:21:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>ddribin</b></i><br><br><div>Hey MetalSlime,</div><div><br></div><div>Thanks a <i>bunch</i>&#xA0;for these tutorials. &#xA0;They&apos;ve been very interesting, and I&apos;ve been having fun with the sound engine. However, I think I found a bug in sound_load in regards to stream_ticker_total. &#xA0;In this article, you mention:</div><div><br></div><hr><div class="FTQUOTE"><i>Originally posted by: <b>MetalSlime</b></i><br>Then
we will need to edit sound_load to read this new byte for each stream
and store it in RAM.&#xA0; We&apos;ll also want to initialize stream_ticker_total
to some fixed starting value, preferably a high one so that the first
tick will happen without a delay.&#xA0; Finally, we will have to update all
of our songs to include tempos in their headers.<br></div><hr>Then, in the code, it gets initialized to $A0:<div><br></div><div><div>&#xA0;&#xA0; &#xA0;lda #$A0</div><div>&#xA0;&#xA0; &#xA0;sta stream_ticker_total, x</div><div><br></div><div>The problem is if a song has a tempo of less than $60, then the ticker won&apos;t roll over on the first frame. To hear this, change the tempo of song 2 to $10 and then play it twice in a row. The second time it gets played, the last note is briefly played again.</div><div><br></div><div>If I initialize stream_ticker_total to $FF in sound_load, then it seems to fix it. Is this the best fix? What was the reasoning behind using $A0?</div><div><br></div><div>Thanks,</div><div><br></div><div>-Dave</div><div><br></div><br>
</div></div><br>Thanks for the comments.&#xA0; Glad you are finding the tutorials useful!&#xA0; <br><br>You are right, at low tempo values the rollover is late.&#xA0; $FF sounds like a good fix.&#xA0; As for what I was thinking using $A0 I&apos;m not sure.&#xA0; I originally coded in a 16-bit counter for even more tempo precision, but later cut it because the tutorial was getting too long.&#xA0; With a 16-bit counter, the tempo values tend to be higher so maybe $A0 seemed like a high enough initial value to me.&#xA0; $FF seems like a better choice right now though.&#xA0; Nice catch!<br><br>I had planned to make the 16-bit counter a homework idea, but looks like I forgot to add it at the end.<br><br>Thanks a lot!<br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="audio_tutorial-7">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Nerdy Nights Sound: Part 7: Volume Envelopes</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<span style="font-weight: bold;">Last Week:</span> <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=24885" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=24885">Tempo, Note Lengths, Buffering and Rests</a><br><br><span style="font-weight: bold;">This Week</span>: Volume Envelopes<br><font size="4"><b><br>Volume Envelopes</b></font><br><br>This week we will
add volume envelopes to our engine.&#xA0; A <span style="font-weight: bold;">volume envelope</span> is a series of
volume values that are applied to a note one frame at a time.&#xA0; For
example, if we had a volume envelope that looked like this:<br><br><span style="font-family: Courier New;">F E D C 9 5 0</span><br><br>Then
whenever we played a note, it would have a volume of F on the first
frame, a volume of E on the second frame, then D, then C, then 9, then
5 until it is finally silenced with a volume of 0 on the 7th frame.&#xA0;
Applying this volume envelope on our notes would give them a sharp,
short staccato feel.&#xA0; Conversely, if we had a volume envelope that
looked like this:<br><br><span style="font-family: Courier New;">1 1 2 2 3 3 4 4 7 7 8 8 A A C C D D E E F F F</span><br><br>Each note would start very quietly and fade in to full volume.&#xA0; Look at this volume envelope:<br><br><span style="font-family: Courier New;">D D D C B 0 0 0 0 0 0 0 0 6 6 6 5 4 0</span><br><br>Here
we start at a high volume (D) and let it ring for 5 frames.&#xA0; Then we
silence the note for 8 frames.&#xA0; Then the note comes back at a very low
volume for 5 frames.&#xA0; Notes using this volume envelope would sound like
they had an faint echo.<br><br>As you can see, volume envelopes are pretty cool.&#xA0; We can get a lot of different sounds out of them.&#xA0; Let&apos;s add them in.<br><br><b>Channels</b><br>Volume
envelopes are best suited for the square and noise channels where we
have full control of the volume.&#xA0; The triangle channel on the other
hand doesn&apos;t allow much volume control.&#xA0; It only has two settings: full
blast and off.&#xA0; We can still apply volume envelopes in a limited way
though.&#xA0; Consider these two volume envelopes:<br><br><span style="font-family: Courier New;">0F 0E 0D 0C 09 05 00</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">04 04 05 05 06 06 07 07 08 08 09 09 0A 0A 00</span><br><br>These two envelopes would have a vastly different sound on the square channels, but to the triangle they look like this:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">On On On On On On Off</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">On On On On On On On On On On On On On On Off</span><br><br>You
don&apos;t get the subtle shifts in volume, but you do get a different
length.&#xA0; We can use volume envelopes that end in 00 to control when the
triangle key-off occurs.&#xA0; Not as cool as full volume control, but still
useful.<br><br><b>Defining volume envelopes</b><br>First let&apos;s define some volume envelopes so we have some data to work with.&#xA0; We&apos;ll use some of the examples from above:<br><br><span style="font-family: Courier New;">se_ve_1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $0F, $0E, $0D, $0C, $09, $05, $00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $FF</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_ve_2:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $01, $01, $02, $02, $03, $03, $04, $04, $07, $07</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $08, $08, $0A, $0A, $0C, $0C, $0D, $0D, $0E, $0E</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $0F, $0F</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $FF</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_ve_3:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $0D, $0D, $0D, $0C, $0B, $00, $00, $00, $00, $00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $00, $00, $00, $00, $06, $06, $06, $05, $04, $00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $FF</span><br><br>Notice
that I terminated each envelope with $FF.&#xA0; We need some terminator
value so the engine will know when we&apos;ve reached the end of the
envelope.&#xA0; We could have used any value, but $FF is pretty common.<br><br>Next we will make a pointer table that holds the addresses of our volume envelopes:<br><br><span style="font-family: Courier New;">volume_envelopes:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_ve_1, se_ve_2, se_ve_3</span><br>&#xA0;&#xA0; &#xA0;<br><b>Declaring variables</b><br>In
order to apply a volume envelope to a particular stream, we will need a
variable that tells us which one to use.&#xA0; We will also need an index
variable that tells us our current position within the volume envelope:<br><br><span style="font-family: Courier New;">stream_ve .rs 6&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;current volume envelope</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream_ve_index .rs 6&#xA0;&#xA0; ;current position within the volume envelope</span><br><br>stream_ve
will tell us which volume envelope to use.&#xA0; Code-wise, it will act as
an index into our pointer table so we know where to read from.&#xA0; Sound
familiar?&#xA0; It works the same way as &quot;song number&quot; did for loading a
song.&#xA0; We aren&apos;t there yet, but here&apos;s a peek at how we will use these
variables to read from the volume envelopes. (x holds the stream
number):<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sty sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save y because we are about to destroy it.</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ve, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;which volume envelope?</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply by 2 because we are indexing into a table of addresses (words)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda volume_envelopes, y&#xA0;&#xA0;&#xA0;&#xA0; ;get the low byte of the address from the pointer table</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda volume_envelopes+1, y&#xA0;&#xA0; ;get the high byte of the address</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy stream_ve_index, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;our current position within the volume envelope.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;grab the value.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;check against $FF (our termination value)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;set the volume</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;increment stream_ve_index</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;etc</span><br>&#xA0;&#xA0; &#xA0;<br>Compare this code to the beginning of the sound_load routine.&#xA0; Are you starting to see a pattern?<br>&#xA0;&#xA0; &#xA0;<br><b>Initializing</b><br>Whenever
we add a new feature, we need to consider how we should initialize it.&#xA0;
Every stream in our music data will potentially have a different volume
envelope, so we should add a volume envelope field to our header.&#xA0;
Volume envelopes will deprecate our old &quot;initial volume&quot; field, but we
will still need to have duty cycle info, so we&apos;ll just rename that
field:<br><br><span style="font-family: Courier New;">main header:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">--------+----------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">byte #&#xA0; | what it tells us</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">--------+----------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | number of streams</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">01+&#xA0;&#xA0;&#xA0;&#xA0; | stream headers (one for each stream)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">stream headers:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">--------+----------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">byte #&#xA0; | what it tells us</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">--------+----------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | which stream (stream number)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | status byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">02&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | which channel</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">03&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | initial duty (for triangle, set the 7bit)</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">04&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | volume envelope</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">05-06&#xA0;&#xA0; | pointer to data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">07&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | initial tempo</span><br><br>To
read this data from the header, we will have to insert the following
code into our sound_load routine (after reading the duty):<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;the stream&apos;s volume envelope</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ve, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br>&#xA0;&#xA0; &#xA0;<br>Notes will always start from the beginning of the volume envelope, so we can just initialize stream_ve_index to 0:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ve_index, x</span><br>&#xA0;&#xA0; &#xA0;<br>Now we just need to make sure to assign volume envelopes to all the streams in our song data and we&apos;re ready to go:<br><br><span style="font-family: Courier New;">song5_header:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;1 stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte SFX_1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;which stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;status byte (stream enabled)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte SQUARE_2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;which channel</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $70&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;initial duty (01).&#xA0; Initial volume deprecated.</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; .byte $00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;the first volume envelope (se_ve_1)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song5_square2 ;pointer to stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $FF&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;tempo..very fast tempo</span><br><br>Remember
that you can always create descriptive aliases for your volume
envelopes if you don&apos;t want to remember which number is which:<br><br><span style="font-family: Courier New;">;volume envelope aliases</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">ve_short_staccato = $00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">ve_fade_in = $01</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">ve_blip_echo = $02</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">song5_header:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;1 stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte SFX_1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;which stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;status byte (stream enabled)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte SQUARE_2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;which channel</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $7F&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;initial duty (01).&#xA0; Initial volume deprecated.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte <span style="color: rgb(255, 0, 0);">ve_short_staccato</span>&#xA0;&#xA0; ;the first volume envelope (se_ve_1)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song5_square2 ;pointer to stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $FF&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;tempo..very fast tempo</span><br>&#xA0;&#xA0; &#xA0;<br>Using
aliases is a good idea because the assembler will give you an error if
you mistype your alias.&#xA0; If you mistype your number, and it is still a
valid number, the assembler won&apos;t know there&apos;s a problem and will
assemble it.&#xA0; This kind of bug in your data can be hard to trace.<br><br><br><font size="3"><b>Implementing Volume Envelopes</b></font><br><br>To
implement volume envelopes, we need to modify the code where we set the
volume.&#xA0; Instead of using a fixed value like we were doing before, we
need to read from our current position in the volume envelope and use
that value instead.&#xA0; Our volume code is starting to get a little
complicated, so let&apos;s pull it out into its own subroutine.&#xA0; This will
make our code easier to follow:<br><br><span style="font-family: Courier New;">;----------------------------------------------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">; se_set_temp_ports will copy a stream&apos;s sound data to the temporary apu variables</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; input:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; X: stream number</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_set_temp_ports:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_channel, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">jsr se_set_stream_volume&#xA0;&#xA0;&#xA0; ;let&apos;s stick all of our volume code into a new subroutine</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;less cluttered that way</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$08</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports+1, y&#xA0;&#xA0;&#xA0;&#xA0; ;sweep</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_note_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports+2, y&#xA0;&#xA0;&#xA0;&#xA0; ;period LO</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_note_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports+3, y&#xA0;&#xA0;&#xA0;&#xA0; ;period HI</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts&#xA0;&#xA0; &#xA0;</span><br><br>What
should our new subroutine se_set_stream_volume do?&#xA0; First it needs to
read a value from our stream&apos;s volume envelope.&#xA0; Then it needs to
modify the stream&apos;s volume using that value.&#xA0; Then we need to update
our position within the volume envelope.&#xA0; Finally it needs to check to
see if we are resting, and silence the stream if we are (we wrote this
code last week).&#xA0; It looks something like this (new code in red):<br><br><br><span style="font-family: Courier New;">se_set_stream_volume:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">sty sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save our index into soft_apu_ports (we are about to destroy y)</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda stream_ve, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;which volume envelope?</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; asl a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply by 2 because we are indexing into a table of addresses (words)</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda volume_envelopes, y&#xA0;&#xA0;&#xA0;&#xA0; ;get the low byte of the address from the pointer table</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sta sound_ptr&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;put it into our pointer variable</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda volume_envelopes+1, y&#xA0;&#xA0; ;get the high byte of the address</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sta sound_ptr+1</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">.read_ve:</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; ldy stream_ve_index, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;our current position within the volume envelope.</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;grab the value.</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; cmp #$FF</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; bne .set_vol&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if not FF, set the volume</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; dec stream_ve_index, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else if FF, go back one and read again</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; jmp .read_ve&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&#xA0; FF essentially tells us to repeat the last</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&#xA0; volume value for the remainder of the note</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">.set_vol:</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sta sound_temp2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save our new volume value (about to destroy A)</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda stream_vol_duty, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;get current vol/duty settings</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; and #$F0&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;zero out the old volume</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; ora sound_temp2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;OR our new volume in.</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; ldy sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;get our index into soft_apu_ports</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sta soft_apu_ports, y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;store the volume in our temp port</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; inc stream_ve_index, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;set our volume envelop index to the next position</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><br style="font-family: Courier New;"><span style="font-family: Courier New;">.rest_check:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;check the rest flag. if set, overwrite volume with silence value </span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_status, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #%00000010</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .done&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if clear, no rest, so quit</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_channel, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #TRIANGLE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if triangle, silence with #$80</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .tri&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else, silence with #$30</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$30&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .store&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this always branches.&#xA0; bne is cheaper than a jmp</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.tri:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$80</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.store:&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.done:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>After
we read a value from our volume envelope, we AND stream_vol_duty with
#$F0.&#xA0; This has the nice effect of clearing the old volume while
preserving our squares&apos; duty cycle settings.&#xA0; But we need to be careful
here.&#xA0; Recall that the triangle channel&apos;s on/off status is controlled
by the low 7 bits of the port:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">TRI_CTRL ($4008)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">||||||||</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">|+++++++- Value</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">+-------- Control Flag (0: use internal counters; 1: disable internal counters)</span><br><br>If
any of those Value bits are set, the triangle channel will be
considered on.&#xA0; Consider what happens if bit 4, 5 or 6 happen to be
set.&#xA0; In this case, ANDing with #$F0 won&apos;t turn the triangle channel
off.&#xA0; If the volume we pull from the volume envelope is 0, it won&apos;t
silence our triangle channel because bit 4, 5 or 6 will still be set.&#xA0;
If we are careful not to set these bits in our song headers, the
problem should never come up.&#xA0; But for completeness we should fix it:<br><br><span style="font-family: Courier New;">se_set_stream_volume:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sty sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save our index into soft_apu_ports (we are about to destroy y)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ve, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;which volume envelope?</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply by 2 because we are indexing into a table of addresses (words)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda volume_envelopes, y&#xA0;&#xA0;&#xA0;&#xA0; ;get the low byte of the address from the pointer table</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;put it into our pointer variable</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda volume_envelopes+1, y&#xA0;&#xA0; ;get the high byte of the address</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.read_ve:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy stream_ve_index, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;our current position within the volume envelope.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;grab the value.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$FF</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .set_vol&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if not FF, set the volume</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; dec stream_ve_index, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else if FF, go back one and read again</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp .read_ve&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&#xA0; FF essentially tells us to repeat the last</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&#xA0; volume value for the remainder of the note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.set_vol:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_temp2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save our new volume value (about to destroy A)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;<span style="color: rgb(255, 0, 0);"> cpx #TRIANGLE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; bne .squares&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if not triangle channel, go ahead</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda sound_temp2</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; bne .squares&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else if volume not zero, go ahead (treat same as squares)</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda #$80</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; bmi .store_vol&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else silence the channel with #$80</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">.squares:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_vol_duty, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;get current vol/duty settings</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #$F0&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;zero out the old volume</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ora sound_temp2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;OR our new volume in.</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">.store_vol:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;get our index into soft_apu_ports</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports, y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;store the volume in our temp port</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; inc stream_ve_index, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;set our volume envelop index to the next position</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">.rest_check:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;check the rest flag. if set, overwrite volume with silence value </span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_status, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #%00000010</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .done&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if clear, no rest, so quit</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_channel, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #TRIANGLE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if triangle, silence with #$80</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .tri&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else, silence with #$30</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$30&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .store&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this always branches.&#xA0; bne is cheaper than a jmp</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.tri:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$80</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.store:&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta soft_apu_ports, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.done:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br><b>New notes</b><br>The
last thing we need to consider is new notes.&#xA0; When an old note finishes
and we start playing a new note, we will want to reset the volume
envelope back to the beginning.&#xA0; This is as easy as setting
stream_ve_index to 0 when we read a new note:<br><br><span style="font-family: Courier New;">se_fetch_byte:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;...snip... (setup pointers, read byte, test range, etc)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Note stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sty sound_temp1&#xA0;&#xA0;&#xA0;&#xA0; ;save our index into the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table+1, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy sound_temp1&#xA0;&#xA0;&#xA0;&#xA0; ;restore data stream index</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">lda #$00</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; sta stream_ve_index, x&#xA0; ;reset the volume envelope.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;check if it&apos;s a rest and modify the status flag appropriately</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr se_check_rest&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;...snip... (update pointer)</span><br>&#xA0;&#xA0; &#xA0;<br>And now we have volume envelopes.<br><br><b>Putting It All Together</b><br>Download and unzip the <a href="downloads/NerdyNightsSoundSourceCollection/envelopes.zip" target="_blank" original-href="http://tummaigames.com/envelopes.zip">envelopes.zip</a> sample files.&#xA0; Make sure the following files are in the same folder as NESASM3:<br><br>&#xA0;&#xA0;&#xA0; envelopes.asm<br>&#xA0;&#xA0;&#xA0; sound_engine.asm<br>&#xA0;&#xA0;&#xA0; envelopes.chr<br>&#xA0;&#xA0;&#xA0; note_table.i<br>&#xA0;&#xA0;&#xA0; note_length_table.i<br>&#xA0;&#xA0;&#xA0; vol_envelopes.i<br>&#xA0;&#xA0;&#xA0; song0.i<br>&#xA0;&#xA0;&#xA0; song1.i<br>&#xA0;&#xA0;&#xA0; song2.i<br>&#xA0;&#xA0;&#xA0; song3.i<br>&#xA0;&#xA0;&#xA0; song4.i<br>&#xA0;&#xA0;&#xA0; song5.i<br>&#xA0;&#xA0;&#xA0; envelopes.bat<br><br>Double click envelopes.bat. That will run NESASM3 and should produce the envelopes.nes file. Run that NES file in FCEUXD SP.<br><br>Use the controller to select songs and play them.&#xA0; Controls are as follows:<br>&#xA0;&#xA0; &#xA0;<br><b>Up</b>: Play<br><b>Down</b>: Stop <br><b>Right</b> : Next Song/SFX<br><b>Left </b>: Previous Song/SFX<br><br>Song0 is a silence song.&#xA0; Not selectable.<br>Song1 is a boss song from The Guardian Legend, almost the same as the original.<br>Song2 is the same short sound effect from last week.<br>Song3 is a song from Dragon Warrior, very close to the original.<br>Song4 is the same song4 as last week, but volume envelopes allow us to save some bytes by reducing rests.<br>Song5 is a short sound effect, same as last week.<br><br>Try
creating your own songs and sound effects and add them into the mix.&#xA0;
To add a new song you will need to take the following steps:<br><br>1)
create a song header and song data (use the included songs as
reference).&#xA0; Don&apos;t forget to select a volume envelope for each stream
in your header.&#xA0; Data streams are terminated with $FF.<br>2) add your header to the song_headers pointer table at the bottom of sound_engine.asm<br>3) update the constant NUM_SONGS to reflect the new song number total (also at the bottom of sound_engine.asm)<br><br>Try
making your own volume envelopes too.&#xA0; To do so you will need to modify
vol_envelopes.i.&#xA0; Remember that volume envelopes are terminated with
$FF.<br>
<br><b>Next Week</b>: <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=25583" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=25583">Opcodes, Looping</a><br>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#audio_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;audio_tutorial-7__comments&apos;);">
                            是否显示评论内容
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=25253" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="audio_tutorial-7__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-7__1">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Nov 2, 2009 at 9:02:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Wow...that&apos;s intense.  You&apos;re doing a great job, dude, keep &apos;em comming!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-7__2">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Nov 3, 2009 at 2:15:18 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					well, this is neat, was able to add back the staccato sound I had in my splash page. A few things I was wondering though. will probably be covered in the next tutorial.
<br>
<br>1) what if I don&apos;t want an envelope? We split the byte between Duty cycle and Volume in this tutorial. The Volume is controlled solely by the envelope byte now. since this is an expected byte in the header, I have to put some value in. Do you make an envelope with just OF, OF, OF, etc. or is there a simpler way?
<br>
<br>2)This will probably be covered by Opcodes. Will opcodes allow my to change the Duty Cycle and envelope mid-stream? Say I want to start with a staccato then change to something else. or change the duty cycle. I would think I may want to change the tempo maybe also. 
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-7__3">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Nov 3, 2009 at 7:56:08 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>udisi</b></i><br><br>well, this is neat, was able to add back the staccato sound I had in my splash page. A few things I was wondering though. will probably be covered in the next tutorial.
<br>
<br>1) what if I don&apos;t want an envelope? We split the byte between Duty cycle and Volume in this tutorial. The Volume is controlled solely by the envelope byte now. since this is an expected byte in the header, I have to put some value in. Do you make an envelope with just OF, OF, OF, etc. or is there a simpler way?
<br>
<br>2)This will probably be covered by Opcodes. Will opcodes allow my to change the Duty Cycle and envelope mid-stream? Say I want to start with a staccato then change to something else. or change the duty cycle. I would think I may want to change the tempo maybe also. 
<br>
<br></div><br>Good questions.<br><br>1) Right now, if you don&apos;t want an envelope and you don&apos;t want to change any code you could make a custom envelope for a constant volume.&#xA0; It would only need to be two bytes long, like this:<br><br>ve_F:<br>&#xA0;&#xA0;&#xA0; .byte $0F, $FF<br><br>Since the $FF automatically sustains the last value for the remainder of the note you get this pretty cheaply:&#xA0; 2 bytes for the envelope, plus 2 more bytes for the pointer table entry. <br><br>If you wanted to take volume control away from the envelopes, you could add in a flag (one of the bits in stream_status maybe) that you could use to turn volume envelopes off and on.&#xA0; If off, you could tell the engine to use the default value in stream_duty_vol.&#xA0; This would require a check of the flag in your se_set_volume code, and you&apos;d have to code in a way to set and clear the flag.&#xA0; <br><br>2) Yes, opcodes will allow you to pretty much do anything you want at any point in a stream.&#xA0; Change volume envelope, change duty cycle, change tempo, change keys, trigger a sound effect, loop, jump.&#xA0; Anything you can write code for you can make into an opcode and allow the sound engine to call it as needed.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-7__4">
                                                        <div class="mdl-card__title"><strong>zi</strong> posted on 
		
			
				
				Mar 15, 2011 at 4:11:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					whilst i LOVE these, as a musician and a super user of both ppmck and famitracker, there is a slight addition necessary to bring the power of volume envelopes to their fullest power: loops.
<br>
<br>now, i tried literally adding the loop code (found in future NNS) to no avail, so i&apos;m guessing this has to be implemented as part of the sound engine. is there a way to set yr sound env and then a loop point, which, instead of looping the last byte, loop a set of bytes?
<br>
<br>note: i&apos;m aware that this is a tall order and this is also a year and a half late.
<div><br></div><div>edit: i hope you and those you love are safe!!!!!!!!</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-7__5">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Mar 15, 2011 at 6:18:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It will be the same thing we did with the pitch envelope looping. <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> but with the volume envelopes.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-7__6">
                                                        <div class="mdl-card__title"><strong>zi</strong> posted on 
		
			
				
				Jun 6, 2015 at 3:47:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					and hello from the future!
<br>
<br>I&apos;ve searched and searched, but no soundop for changing tempo on the fly so I made one!
<br>
<br>
<br>se_op_set_tempo:
<br>    lda [sound_ptr], y      ;read the argument
<br>    sta stream_tempo, x        ;store it in our tempo variable
<br>    lda #$00
<br>    rts
<br>
<br>it works! granted, it was easy, almost too easy, I just ripped off the volume env change. but, BUT, this is sloppy slap-dash work and I want the opinion of the programmers to evaluate and crush any potential mistakes. 
<br>
<br>thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="audio_tutorial-8">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Nerdy Nights Sound: Part 8: Opcodes and Looping</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b>Last Week</b>: <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=25253" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=25253">Volume Envelopes</a><br>
<br>
<b>This Week</b>: Opcodes and Looping<br>
<br>
<font size="5"><b>Opcodes</b></font><br>
<br>So far our sound engine handles two type of data that it reads from
music data streams: notes and note lengths.&#xA0; This is enough to write
complex music but of course we are going to want more features.&#xA0; We
will want control over the sound of our notes.&#xA0; What if we want to
change duty cycles midstream?&#xA0; Or volume envelopes?&#xA0; Or keys?&#xA0; What if
we want to loop one part of the song four times?&#xA0; Or loop the entire
song continuously?&#xA0; What if we want to play a sound effect as part of a
song?<br><br>All of these types of features, features where you are
issuing commands to the engine, are going to be done through opcodes
(also called control codes or command codes).&#xA0; An <b>opcode</b> is a
value in the data stream that tells the engine to run a specific,
specialized subroutine or piece of code.&#xA0; Most opcodes will have <b>arguments</b>
sent along with them.&#xA0; For example, an opcode that changes a stream&apos;s
volume envelope will come with an argument that specifies which volume
envelope to change to.<br><br>We&apos;ve actually been using an opcode for
weeks, I just haven&apos;t mentioned it.&#xA0; It&apos;s the opcode that ends a sound,
and we&apos;ve been encoding it in our data streams as $FF.&#xA0; Here is the
code we&apos;ve been using:<br><br><span style="font-family: Courier New;">se_fetch_byte:</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;---snip--- (fetch a byte and range test)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">.opcode:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else it&apos;s an opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Opcode stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$FF</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .end</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_status, x&#xA0;&#xA0;&#xA0; ;if $FF, end of stream, so disable it and silence</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #%11111110</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_status, x&#xA0;&#xA0;&#xA0; ;clear enable flag in status byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_channel, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #TRIANGLE</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .silence_tri&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;triangle is silenced differently from squares and noise</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$30&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;squares and noise silenced with #$30</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .silence</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.silence_tri:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$80&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;triangle silenced with #$80</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.silence:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_vol_duty, x&#xA0; ;store silence value in the stream&apos;s volume variable.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp .update_pointer&#xA0;&#xA0;&#xA0;&#xA0; ;done</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;---snip--- (do note lengths and notes, update the stream&apos;s pointer)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Here we check if the byte read has a value of $FF.&#xA0; If so we turn the stream off and silence it.&#xA0; That&apos;s an opcode.<br><br>It
would be pretty messy if every opcode we had was just written straight
out like this.&#xA0; Normally we would pull this code into its own
subroutine, like this:<br><br><span style="font-family: Courier New;">se_fetch_byte:</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;---snip--- (fetch a byte and range test)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">.opcode:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else it&apos;s an opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Opcode stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$FF&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;end sound opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .end</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><span style="color: rgb(255, 0, 0); font-family: Courier New;">jsr se_op_endsound&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;call the endsound subroutine</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp .fetch&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;grab the next byte in the stream.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;---snip--- (do note lengths and notes, update the stream&apos;s pointer)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_op_endsound:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_status, x&#xA0;&#xA0;&#xA0; ;end of stream, so disable it and silence</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #%11111110</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_status, x&#xA0;&#xA0;&#xA0; ;clear enable flag in status byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_channel, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #TRIANGLE</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .silence_tri&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;triangle is silenced differently from squares and noise</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$30&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;squares and noise silenced with #$30</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .silence</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.silence_tri:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$80&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;triangle silenced with #$80</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.silence:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_vol_duty, x&#xA0; ;store silence value in the stream&apos;s volume variable.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>The .opcode branch is much shorter now.&#xA0; If we wanted to add more opcodes, we could just add some more compares:<br><br><span style="font-family: Courier New;">.opcode:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Opcode stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$FF&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;is it the end sound opcode? </span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .not_FF</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">jsr se_op_endsound&#xA0; ;if so, call the end sound subroutine</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp .end&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;and finish</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.not_FF:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$FE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else is it the loop opcode?</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .not_FE</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">jsr se_op_loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if so, call the loop subroutine</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp .opcode_done</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.not_FE:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$FD&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else is it the change volume envelope opcode?</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .not_FD</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">jsr se_op_change_ve ;if so, call the change volume envelope subroutine</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp .opcode_done</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.not_FD:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.opcode_done:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;update index to next byte in the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp .fetch&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;go fetch another byte</span><br>&#xA0;&#xA0; &#xA0;<br><br>This
will work, but it&apos;s ugly.&#xA0; The more opcodes we add to our engine, the
more checks we need to make.&#xA0; What if we have 20 opcodes?&#xA0; Do we really
want to do that many compares?&#xA0; It&apos;s a waste of ROM space and cycles.<br><br><b>Tables</b><br>Anytime you find yourself in a situation where you are doing a lot of CMPs on one value, the answer is to use a <b>lookup tabl</b>e.&#xA0;
It will simplify everything!&#xA0; We&apos;ve done it already with notes, note
lengths, song numbers and volume envelopes.&#xA0; Could you imagine trying
to get a note&apos;s period without using the lookup table?&#xA0; It would look
like this:<br><br><span style="font-family: Courier New;">Is the note an A1?&#xA0; If so, use this period, else</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">Is the note an A#1?&#xA0; If so, use this period, else</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">Is the note a B1?&#xA0; If so, use this period, else</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">Is the note a C2?&#xA0; If so, use this period, else</span><br style="font-family: Courier New;"><b style="color: rgb(255, 0, 0);"><span style="font-family: Courier New;">... (about 100 more checks)</span></b><br style="font-family: Courier New;"><span style="font-family: Courier New;">Is the note an F#9? If so, use this period, else</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">Is the note a rest?&#xA0; If so, use this period</span><br><br>That&apos;s
just crazy.&#xA0; It would be hundreds of lines of unreadable code and you&apos;d
run into branch-range errors too.&#xA0; When we use a lookup table, the code
is simplified to this:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Note stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sty sound_temp1&#xA0;&#xA0;&#xA0;&#xA0; ;save our index</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table+1, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy sound_temp1&#xA0;&#xA0;&#xA0;&#xA0; ;restore data stream index</span><br>&#xA0;&#xA0; &#xA0;<br>Much cleaner.&#xA0; Again, I can&apos;t stress it enough: <b>if you find yourself doing lots of CMPs on a single value, use a table instead!</b><br>&#xA0;&#xA0; &#xA0;<br>With notes and note lengths we used a straight <i>lookup table</i> of values.&#xA0; With song numbers and volume envelopes we used a special type of lookup table called a <i>pointer table</i>, which stored data addresses.&#xA0; For opcodes we have two choices.&#xA0; We can use something called a <b>jump table</b> or we can use an <b>RTS table</b>.&#xA0;
They are almost the same and the difference in performance between the
two methods is negligible so for most programmers it&apos;s a matter of
personal preference. &#xA0;<br><br>I prefer RTS tables myself, but we&apos;re going to use jump tables because they are easier to explain and understand.<br><br><b>Jump Tables</b><br>Ok,
here&apos;s our problem:&#xA0; Our sound engine has opcodes.&#xA0; A lot of them,
let&apos;s say 10 or more.&#xA0; Each opcode has its own subroutine.&#xA0; When our
sound engine reads an opcode byte from the data stream, we want to
avoid a long list of CMP and BNE instructions to select the right
subroutine.&#xA0; How do we do that?&#xA0;&#xA0; We use a jump table.<br><br>A jump
table is similar to a pointer table: it is a table of addresses.&#xA0; But
whereas a pointer table holds addresses that point to the start of
data, a <b>jump table</b> holds addresses that point to the start of <i>code</i> (ie, the start of subroutines).&#xA0; For example, suppose we have some subroutines:<br><br><span style="font-family: Courier New;">sub_a:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldx #$FF</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sub_b:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; clc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; adc #$03</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sub_c:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sec</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sbc #$03</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Here is how a jump table would look using these subroutines:<br><br><span style="font-family: Courier New;">sub_jump_table:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word sub_a, sub_b, sub_c</span><br>&#xA0;&#xA0; &#xA0;<br>Hey,
that&apos;s pretty easy.&#xA0; We just use the subroutine label and the assembler
will translate that into the address where the subroutine starts.&#xA0;
Let&apos;s make a jump table for our sound opcode subroutines:<br><br><span style="font-family: Courier New;">se_op_endsound:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_op_infinite_loop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_op_change_ve:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;etc..&#xA0; more subroutines</span><br style="font-family: Courier New;"><br>
<span style="font-family: Courier New;">;this is our jump table</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_opcodes:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_endsound</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_infinite_loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_change_ve</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;etc, one entry per subroutine</span><br>&#xA0;&#xA0; &#xA0;<br>Cool.&#xA0; We have a jump table now.&#xA0; So how do we use it?<br><br><b>Indirect Jumping</b><br>The 6502 let&apos;s us do some cool things.&#xA0; One of those things is called an indirect jump.&#xA0; An <b>indirect jump</b> let&apos;s you stick a destination address into a zero-page pointer variable and jump there.&#xA0; It works like this:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .rsset $0000</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;first declare a pointer variable somewhere in the zero-page</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">jmp_ptr .rs 2&#xA0; ;2 bytes because an address is always a word</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta jmp_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$80</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta jmp_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp [jmp_ptr] ;will jump to $8000</span><br>&#xA0;&#xA0; &#xA0;<br>Here we stick an address ($8000, lo byte first) into our <b>jmp_ptr</b> variable.&#xA0; Then we do an indirect jump by using the JMP instruction followed by a pointer variable in brackets:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp [jmp_ptr] ;indirect jump</span><br>&#xA0;&#xA0; &#xA0;<br>This
instruction translates into English as &quot;Jump to the address that is
stored in jmp_ptr and jmp_ptr+1&quot;.&#xA0; It&apos;s extrememly useful.&#xA0; We can
stick any address we want in there:<br>&#xA0;&#xA0; &#xA0;<br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta jmp_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$C0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta jmp_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp [jmp_ptr] ;will jump to $C000</span><br>&#xA0;&#xA0; &#xA0;<br>We could read an address from ROM and use that if we wanted to, for example our reset vector:<br>&#xA0;&#xA0; &#xA0;<br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda $FFFC</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta jmp_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda $FFFD</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta jmp_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp [jmp_ptr] ;will jump to our reset routine</span><br>&#xA0;&#xA0; &#xA0;<br>And we can use it in combination with our jump table:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_opcodes, y&#xA0;&#xA0;&#xA0; ;read low byte of address from jump table</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta jmp_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_opcodes+1, y&#xA0; ;read high byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta jmp_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp [jmp_ptr]&#xA0;&#xA0; ;will jump to whatever address we pulled from the table.</span><br>&#xA0;&#xA0; &#xA0;<br>Pretty powerful.&#xA0; We can dynamically jump to any section of code we want!<br>&#xA0;&#xA0; &#xA0;<br><b>Implementation</b><br>So
we know how to build a jump table and we know how to do an indirect
jump.&#xA0; Let&apos;s tie it all together and stick it into our sound engine.&#xA0;
Let&apos;s start with <b>se_fetch_byte</b>.&#xA0; se_fetch_byte reads a byte
from the data stream and range-checks it to see if it is a note, note
length or opcode.&#xA0; Recall that notes have a byte range of $00-$7F.&#xA0;
Note lengths have a range of $80-$9F.&#xA0; The opcode byte range is $A0-$FF:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_fetch_byte:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bpl .note&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if &lt; #$80, it&apos;s a Note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .note_length&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else if &lt; #$A0, it&apos;s a Note Length</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.opcode:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; </span><span style="color: rgb(255, 0, 0); font-family: Courier New;">;else ($A0-$FF) it&apos;s an opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Opcode stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note_length:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do note length stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do note stuff</span><br>&#xA0;&#xA0; &#xA0;<br>So
we need to assign our opcodes to values between $A0 and $FF.&#xA0; Just as
with notes and note lengths, the opcode byte we read from the data
stream will be used as a table index (after subtracting $A0), so we
will assign our opcodes in the same order as our table:<br><br><span style="font-family: Courier New;">sound_opcodes:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_endsound&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this should be $A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_infinite_loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this should be $A1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_change_ve&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this should be $A2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;etc, 1 entry per subroutine</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">;these are aliases to use in the sound data.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">endsound = $A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">loop = $A1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;be careful of conflicts here.&#xA0; this might be too generic.&#xA0; maybe song_loop is better</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">volume_envelope = $A2</span><br><br>Now let&apos;s alter se_fetch_byte to take care of our opcodes:<br><br><span style="font-family: Courier New;">se_fetch_byte:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.fetch:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bpl .note&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if &lt; #$80, it&apos;s a Note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .note_length&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else if &lt; #$A0, it&apos;s a Note Length</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.opcode:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else ($A0-$FF) it&apos;s an opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">;do Opcode stuff</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; jsr se_opcode_launcher&#xA0;&#xA0; ;launch our opcode!!!</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; iny&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;next position in the data stream</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda stream_status, x</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; and #%00000001</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; bne .fetch&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;after our opcode is done, grab another byte unless the stream is disabled</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; rts&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; in which case we quit&#xA0; (explained below)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note_length:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do note length stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do note stuff</span><br>&#xA0;&#xA0; &#xA0;<br>I
added a call to a subroutine called se_opcode_launcher and a little
branch.&#xA0; Not a big change is it?&#xA0; But there&apos;s an important detail
here.&#xA0; se_opcode_launcher will be a short, simple subroutine that will
read from the jump table and perform an indirect jump.&#xA0; It looks like
this:<br><br><span style="font-family: Courier New;">se_opcode_launcher:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sty sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save y register, because we are about to destroy it</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sec</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sbc #$A0&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;turn our opcode byte into a table index by subtracting $A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&#xA0;&#xA0; $A0-&gt;$00, $A1-&gt;$01, $A2-&gt;$02, etc.&#xA0; Tables index from $00.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply by 2 because we index into a table of addresses (words)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_opcodes, y&#xA0;&#xA0;&#xA0; ;get low byte of subroutine address</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta jmp_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_opcodes+1, y&#xA0; ;get high byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta jmp_ptr+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy sound_temp1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;restore our y register</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;set to next position in data stream (assume an argument)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jmp [jmp_ptr]&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;indirect jump to our opcode subroutine</span><br>&#xA0;&#xA0; &#xA0;<br>Short
and simple.&#xA0; So why did I wrap this code in its own subroutine?&#xA0; Why
not just stick this code as-is in the .opcode branch of se_fetch_byte?&#xA0;
Because we need a place to return to.<br><br>The JSR and RTS
instructions work as a pair.&#xA0; They go hand in hand.&#xA0; They need each
other.&#xA0; Without going into too much detail, this is what goes on behind
the scenes:<br>
<br>
<b>JSR</b> sticks a return address on the stack and jumps to a
subroutine.&#xA0; One way to look at it is to think of JSR as a JMP that
remembers where it started from.<br>
<b>RTS</b> pops the return address off the stack and jumps there.&#xA0; <br>
<br>
So JSR leaves a treasure map for RTS to pick up and follow later.&#xA0; The <b>key point</b> here is that <b>RTS expects a return address to be waiting for it on the stack</b>. &#xA0;<br><br>Now our opcode subroutines all end in an RTS instruction.&#xA0; Do you see the potential problem here?<br><br>We
call our opcode subroutines using an indirect jump.&#xA0; This requires us
to use a JMP instruction, not a JSR instruction.&#xA0; A JMP instruction
doesn&apos;t remember where it started from.&#xA0; No return address is pushed
onto the stack with a JMP instruction.&#xA0; So when we jump to our opcode
subroutine and hit the RTS instruction at the end, there is no return
address waiting for us!&#xA0; The RTS will pull whatever random values
happen to be on the stack at the time and jump there.&#xA0; We&apos;ll end up
somewhere random and our program will surely crash!<br><br>To fix this,
we wrap our indirect jump in a subroutine, se_opcode_launcher.&#xA0; We call
it with a JSR instruction, completing the JSR/RTS pair:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr se_opcode_launcher&#xA0; ;this jsr will let us remember where we came from</span><br>&#xA0;&#xA0; &#xA0;<br>This
JSR instruction will stick a return address on the stack for us.&#xA0; Then
inside se_opcode_launcher we perform our indirect jump to our desired
opcode subroutine.&#xA0; Now when we hit that RTS instruction at the end of
the opcode subroutine we have a return address waiting for us on the
stack.&#xA0; Our program returns back to where we started.&#xA0; We are safe.<br><font size="4"><b><br>
Opcode Subroutines</b></font><br>With our opcode launcher written, we are all set up to make opcodes.&#xA0; We already have one written: the <b>endsound</b>
opcode.&#xA0; This is the opcode we will use to terminate sound effects.&#xA0;
Sound effects don&apos;t loop continuously like songs do, so they need to be
stopped.&#xA0; Let&apos;s take a look again:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_op_endsound:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_status, x&#xA0;&#xA0;&#xA0; ;end of stream, so disable it and silence</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #%11111110</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_status, x&#xA0;&#xA0;&#xA0; ;clear enable flag in status byte</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_channel, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #TRIANGLE</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .silence_tri&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;triangle is silenced differently from squares and noise</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$30&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;squares and noise silenced with #$30</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bne .silence&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; (this will always branch.&#xA0; bne is cheaper than a jmp)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.silence_tri:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$80&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;triangle silenced with #$80</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.silence:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_vol_duty, x&#xA0; ;store silence value in the stream&apos;s volume variable.</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>This opcode is special.&#xA0; It&apos;s the reason for the check after the call to se_opcode_launcher:<br><br><span style="font-family: Courier New;">se_fetch_byte:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;---snip---</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.opcode:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else ($A0-$FF) it&apos;s an opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Opcode stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr se_opcode_launcher</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;next position in the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">lda stream_status, x</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; and #%00000001</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; bne .fetch&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;after our opcode is done, grab another byte unless the stream is disabled</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; rts&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; in which case we quit&#xA0; (explained below)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;---snip---</span><br>&#xA0;&#xA0; &#xA0;<br>Normally,
we want se_fetch_byte to keep fetching bytes until it hits a note.&#xA0;
Recall that with note lengths we jumped back to .fetch after setting
the new note length.&#xA0; This is because after setting the length of the
note, we needed to know WHAT note to play.&#xA0; So we fetch another byte.&#xA0;
The same thing is true of opcodes.&#xA0; If we change the volume envelope
with an opcode, great!&#xA0; But we still need to know what note to play
next.&#xA0; If we use an opcode to switch our square&apos;s duty cycle, great!&#xA0;
But we still need to know what note to play next.&#xA0; If we use an opcode
to loop back to the beginning of the song, that&apos;s great!&#xA0; But we still
need to read that first note of the song.&#xA0; This is why we jump back to
fetch a byte after we run an opcode.<br><br>The ONE exception to this
rule is when we end a sound effect.&#xA0; We are terminating the sound
effect completely, so there is no next note.&#xA0; We don&apos;t want to fetch
something that isn&apos;t there, so we need to skip the jump.&#xA0; That&apos;s why we
check the status byte after we run the opcode.&#xA0; If the stream is
disabled by the endsound opcode, we are finished.&#xA0; Otherwise, fetch
another byte.<br><br><b>Looping</b><br>The next opcode in our list is the <b>loop</b>
opcode.&#xA0; This is the opcode that we will stick at the end of every song
to tell the sound engine to play the song again, and again and again.&#xA0;
It is actually quite easy to implement.&#xA0; It takes a <b>2-byte argument</b>, which is <b>the address to loop back to</b>.&#xA0; The subroutine looks like this:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_op_infinite_loop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read LO byte of the address argument from the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ptr_LO, x&#xA0;&#xA0;&#xA0; ;save as our new data stream position</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read HI byte of the address argument from the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ptr_HI, x&#xA0;&#xA0;&#xA0; ;save as our new data stream position data stream position</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;update the pointer to reflect the new position.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$FF&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;after opcodes return, we do an iny.&#xA0; Since we reset &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;the stream buffer position, we will want y to start out at 0 again.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>The
first thing to notice about this subroutine is that it reads two bytes
from the data stream.&#xA0; This is the address argument that gets passed
along with the opcode.&#xA0; To make it clear, let&apos;s look at some example
sound data:<br><br><span style="font-family: Courier New;">song1_square1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth ;set note length to eighth notes</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte C5, E5, G5, C6, E6, G6, C5, Eb5, G5, C6, Eb6, half, G6 ;play some notes</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.byte loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this alias evaluates to $A1, the loop opcode</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; .word song1_square1 ;this evaluates to the address of the song1_square1 label</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;ie, the address we want to loop to.</span><br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;<br>After
the &quot;loop&quot; opcode comes a word which is the address to loop back to.&#xA0;
In this example I chose to loop back to the beginning of the stream
data.<br><br>So what does our loop opcode do?&#xA0; It reads the first byte
of this address argument (the low byte) and stores it in
stream_ptr_LO.&#xA0; Then it reads the second byte of the address argument
(the high byte) and stores it in stream_ptr_HI.&#xA0; These are the
variables that keep track of our data stream position!&#xA0; The loop opcode
just changes these values to some address that we specify.&#xA0; Not too
complicated at all.&#xA0; The last step is to update the actual pointer (<b>sound_ptr</b>) so that the next byte we read from the data stream will be the first note we looped back to.<br><br>In
the example sound data above I looped back to the beginning of the
stream data, but there&apos;s nothing stopping me from looping somewhere
else:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">song1_square1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">;intro, don&apos;t loop this part</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte quarter</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte C4, C4, C4, C4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;"><span style="color: rgb(255, 0, 0);">.loop_point:</span>&#xA0;&#xA0;&#xA0; ;this is where we will loop back to.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth ;set note length to eighth notes</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte C5, E5, G5, C6, E6, G6, C5, Eb5, G5, C6, Eb6, half, G6</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.byte loop</span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this alias evaluates to $A1, the loop opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.word .loop_point</span> ;this evaluates to the address of the .loop_point label</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;ie, the address we want to loop to.</span><br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;<br>Technically
we can also &quot;loop&quot; to a forward position, in which case it&apos;s actually
more like a jump than a loop.&#xA0; That&apos;s all a loop is really: a jump...
backwards.<br><br><b>Changing Volume Envelopes</b><br>Let&apos;s write the opcode subroutine to change volume envelopes.&#xA0; This one is even easier.&#xA0; It takes <b>one argument</b>, which will be <b>which volume envelope to switch to</b>:<br><br><span style="font-family: Courier New;">se_op_change_ve:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read the argument</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ve, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;store it in our volume envelope variable</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ve_index, x&#xA0; ;reset volume envelope index to the beginning</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>That&apos;s it!<br><br><b>Changing Duty Cycles</b><br>Now let&apos;s add an opcode that will change the duty cycle for a square stream.&#xA0; This one also takes <b>one argument: which duty cycle to switch to</b>.<br><br><span style="font-family: Courier New;">se_op_duty:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read the argument (which duty cycle to change to)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_vol_duty, x&#xA0; ;store it.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Done!&#xA0; Now we have the subroutine, but we still need to add it to our jump table:<br><br><span style="font-family: Courier New;">sound_opcodes:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_endsound&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this should be $A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this should be $A1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_change_ve&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this should be $A2</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; .word se_op_duty&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this should be $A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;etc, 1 entry per subroutine</span><br><br><span style="font-family: Courier New;">;these are aliases to use in the sound data.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">endsound = $A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">loop = $A1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">volume_envelope = $A2</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">duty = $A3</span><br><br>And it&apos;s ready to use:<br><br><span style="font-family: Courier New;">song0_square1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;intro, don&apos;t loop this part</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte quarter</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte C4, C4, C4, C4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop_point:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this is where we will loop back to.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.byte duty, $B0</span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;change the duty cycle</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.byte volume_envelope, ve_blip_echo</span> ;change the volume envelope</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;set note length to eighth notes</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte C5, E5, G5, C6, E6, G6&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;play some notes</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.byte duty, $30&#xA0;</span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;change the duty cycle</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.byte volume_envelope, ve_short_staccato</span>&#xA0;&#xA0;&#xA0; ;change volume envelope</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte C5, Eb5, G5, C6, Eb6, half, G6&#xA0;&#xA0;&#xA0; ;play some eighth notes and a half note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;loop to .loop_point </span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word .loop_point</span><br>&#xA0;&#xA0; &#xA0;<br><b>Readability</b><br>sound_engine.asm
is getting pretty bulky with all these subroutines.&#xA0; It will only get
bigger as we add more opcodes.&#xA0; It&apos;s nice to have all of our opcodes
together in one place, but it&apos;s annoying to have to scroll around to
find them.&#xA0; So let&apos;s pull all of our opcodes into their own file: <b>sound_opcodes.asm</b>.&#xA0; Then, at the bottom of sound_engine.asm, we can .include it:<br><br>&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.include &quot;sound_opcodes.asm&quot;</span> ;our opcode subroutines, jump table and aliases<br>&#xA0;&#xA0;&#xA0; .include &quot;note_table.i&quot; ;period lookup table for notes<br>&#xA0;&#xA0;&#xA0; .include &quot;note_length_table.i&quot;<br>&#xA0;&#xA0;&#xA0; .include &quot;vol_envelopes.i&quot;<br>&#xA0;&#xA0;&#xA0; .include &quot;song0.i&quot;&#xA0; ;holds the data for song 0 (header and data streams)<br>&#xA0;&#xA0;&#xA0; .include &quot;song1.i&quot;&#xA0; ;holds the data for song 1<br>&#xA0;&#xA0;&#xA0; .include &quot;song2.i&quot;<br>&#xA0;&#xA0;&#xA0; .include &quot;song3.i&quot;<br>&#xA0;&#xA0;&#xA0; .include &quot;song4.i&quot;<br>&#xA0;&#xA0;&#xA0; .include &quot;song5.i&quot;<br>&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.include &quot;song6.i&quot;</span>&#xA0; ;oooh.. new song!<br>&#xA0;&#xA0; &#xA0;<br>I
gave it the extension .asm because it contains code as well as data,
and I like to be able to tell at a glance what files have what in
them.&#xA0; Now whenever we want to add new opcodes, or tweak old ones, we
have them nice and compact in their own file.<br><br><b>Updating Sound Data</b><br>Whenever
we add new things to our sound engine, we have to think about how it
will affect our old sound data.&#xA0; This week we added opcodes, which will
change our songs and sound effects terminate.&#xA0; Before we were
terminating them with $FF.&#xA0; This won&apos;t work anymore because $FF doesn&apos;t
do anything.&#xA0; For songs, we should terminate with &quot;loop&quot; followed by an
address to loop to.&#xA0; With sound effects we should terminate with the
opcode &quot;endsound&quot;.&#xA0; See the included songs and sound effects for
examples.<br><br><b>RTS Tables</b><br>We talked about jump tables and
indirect jumping this week.&#xA0; Another method for doing the same thing
involves something called an <b>RTS table</b> and the <b>RTS Trick</b>.&#xA0;
I won&apos;t cover it in these tutorials, but if you are curious to know how
this works you can read <a href="http://wiki.nesdev.com/w/index.php/RTS_Trick" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/RTS_Trick">this nesdev wiki article I wrote about the RTS
Trick</a>.<br><br><br><b>Putting It All Together</b><br>Download and unzip the <a href="downloads/NerdyNightsSoundSourceCollection/opcodes.zip" target="_blank" original-href="http://tummaigames.com/opcodes.zip">opcodes.zip</a> sample files.&#xA0; Make sure the following files are in the same folder as NESASM3:<br><br>&#xA0;&#xA0;&#xA0; opcodes.asm<br>&#xA0;&#xA0;&#xA0; sound_engine.asm<br>&#xA0;&#xA0;&#xA0; sound_opcodes.asm<br>&#xA0;&#xA0;&#xA0; opcodes.chr<br>&#xA0;&#xA0;&#xA0; note_table.i<br>&#xA0;&#xA0;&#xA0; note_length_table.i<br>&#xA0;&#xA0;&#xA0; vol_envelopes.i<br>&#xA0;&#xA0;&#xA0; song0.i<br>&#xA0;&#xA0;&#xA0; song1.i<br>&#xA0;&#xA0;&#xA0; song2.i<br>&#xA0;&#xA0;&#xA0; song3.i<br>&#xA0;&#xA0;&#xA0; song4.i<br>&#xA0;&#xA0;&#xA0; song5.i<br>&#xA0;&#xA0;&#xA0; song6.i<br>&#xA0;&#xA0;&#xA0; opcodes.bat<br><br>Double click opcodes.bat. That will run NESASM3 and should produce the opcodes.nes file. Run that NES file in FCEUXD SP.<br><br>Use the controller to select songs and play them.&#xA0; Controls are as follows:<br>&#xA0;&#xA0; &#xA0;<br><b>Up</b>: Play<br><b>Down</b>: Stop <br><b>Right</b>: Next Song/SFX<br><b>Left</b>: Previous Song/SFX<br><br>Song0 is a silence song.&#xA0; Not selectable.<br>Song1 is a boss song from The Guardian Legend.&#xA0; Now it loops!<br>Song2 is the same short sound effect from last week.&#xA0; Terminated with endsound.<br>Song3 is a song from Dragon Warrior.&#xA0; Now it loops!<br>Song4 is the same song4 as last week, but now it loops!<br>Song5 is a short sound effect, terminated with the endsound opcode.<br>Song6
should be familiar to readers of this forum.&#xA0; Do you recognize it?&#xA0; It
utilizes opcodes for changing duty cycles and volume envelopes.&#xA0; Plus
it loops!<br><br>Try adding your own songs and sound effects in.&#xA0; Try to add your own opcodes too.&#xA0; Here&apos;s some ideas for opcodes:<br><br>1. Trigger a sound effect mid-song<br>2. Implement duty cycle envelopes (similar to volume envelopes).&#xA0; Then make an opcode that allows you to change it.<br>3. Finite loops<br><br><b>Next Week</b>: <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=26247" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=26247">more opcode fun.&#xA0; Finite Loops, Changing Keys and Autom...</a> .<br>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#audio_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;audio_tutorial-8__comments&apos;);">
                            是否显示评论内容
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=25583" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="audio_tutorial-8__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-8__1">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Nov 10, 2009 at 1:42:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					excellent...muhahahaha.<br><br>btw, song6 would be battlekid minus noise channel <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-8__2">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Nov 13, 2009 at 8:55:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>Wow, dude, this is awesome! </p><p>I like the Jump Tables.&#xA0; I was wondering if you could do that, for like the interference in various rooms, but I hadn&apos;t got to it yet.&#xA0; Cool beans.</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-8__3">
                                                        <div class="mdl-card__title"><strong>zi</strong> posted on 
		
			
				
				Jan 10, 2015 at 5:22:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					question from five years later: how can I change the duty to the noise channel?
<br>
<br>In famitracker you can change the noise channel duty (00 or 010). I tried changing the duty via opcode, either by increasing the duty increment by one or by 16, nothing besides a different note (instead of a C noise it&apos;s an F noise, but increasing by all sorts of odd numbers doesn&apos;t give me the sound I get from a duty change in Fami)
<br>
<br>Is there a way to do this or am I forcing a famitracker feature on an in game music engine?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-8__4">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Jan 10, 2015 at 7:04:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m not sure about this specific engine, but are you referring to making the more chime-like sound in the noise channel? If so, that can be made by setting bit 7 of $400e:
<br>
<br><a href="http://wiki.nesdev.com/w/index.php/APU#Noise_.28.24400C-400F.29" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/APU#Noise_.28.24400C-400F.29">http://wiki.nesdev.com/w/index.ph...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-8__5">
                                                        <div class="mdl-card__title"><strong>zi</strong> posted on 
		
			
				
				Jan 10, 2015 at 10:27:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am, and I&apos;m going to task the programmer to make that a pretty lil&apos; opcode so I can call it and not worry about ever typing lda. <span class="sprites_emoticons absmiddle" id="emo_wink"></span> thanks rob!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-8__6">
                                                        <div class="mdl-card__title"><strong>skadiet</strong> posted on 
		
			
				
				Dec 9, 2017 at 2:19:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oh my gosh!!  This is really putting it all together!! I can&apos;t wait to try this.
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="audio_tutorial-9">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Nerdy Nights Sound: Part 9: Finite Loops, Key Changes, Chord Progressions</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b>Last Week</b>: <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=25583" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=25583">Opcodes and Looping</a><br><br><b>This Week</b>: More opcodes: Finite Loops, Key Changes, Chord Progressions<br><br><font size="4"><b>Opcodes</b></font><br>Last
week we learned how to use opcodes.&#xA0; Opcodes allow a song&apos;s streams to
call a subroutine mid-play.&#xA0; This is a very powerful tool.&#xA0; We learned
some of the most common opcodes: infinite loop (really a jump), change
volume envelopes and change duty cycles.&#xA0; Today we are going to expand
on opcodes and learn some cool opcode tricks that can save us a lot (!)
of bytes and time.<br><b><font size="3"><br>
Finite Looping</font></b><br>Last week we added the infinite loop
opcode, which was really just an unconditional jump back to an earlier
part of the song.&#xA0; Today we&apos;re going to add a finite loop opcode.&#xA0; A
finite loop opcode tells the sound engine to repeat a particular
section of a song X times, where X is some number defined by you.&#xA0; In
the Battle Kid theme song I added last week there is a passage that
looks like this:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte sixteenth</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, C4, E4, A4, A3, C4, E4, A4, A3, C4, E4, A4, A3, C4, E4, A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, C4, E4, A4, A3, C4, E4, A4, A3, C4, E4, A4, A3, C4, E4, A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, C4, E4, A4, A3, C4, E4, A4, A3, C4, E4, A4, A3, C4, E4, A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, C4, E4, A4, A3, E4, E3, E2</span><br>&#xA0;&#xA0; &#xA0;<br>This
is really just the same 4 notes repeated over and over again.&#xA0; Wouldn&apos;t
it be cooler if we could do something like this instead:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte sixteenth</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, C4, E4, A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop_13_times_please</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, E4, E3, E2</span><br>&#xA0;&#xA0; &#xA0;<br>That
saves a lot of bytes.&#xA0; We go from 56 bytes all the way down to around
10.&#xA0; The Battle Kid song actually plays this same phrase on both square
channels, so really we go from 100+ bytes down to 20 or so.&#xA0; That&apos;s a
big deal!&#xA0; If we consider how common repetitions of 4 or 8 occur in
music, we can easily see that having a finite loop opcode could
potential save us hundreds if not thousands of bytes in our sound data.<br><br><b>Finite Looping?</b><br>So
what is a finite loop really?&#xA0; We saw that with an infinite loop it was
really more like an unconditional jump.&#xA0; When the sound engine hits the
infinite loop opcode, it jumps back, always, no matter what, no
questions asked.&#xA0;&#xA0; A finite loop on the other hand is a conditional
jump.&#xA0; It checks a counter.&#xA0; If the counter isn&apos;t 0 it jumps.&#xA0; If it is
0, it doesn&apos;t jump. &#xA0;<br><b><br>
Loop Counter</b><br>First things first we need a loop counter.&#xA0; Each
stream will have the ability to loop, so each stream will need its own
loop counter:<br><br><span style="font-family: Courier New;">stream_loop1 .rs 6&#xA0; ;loop counter variable (one for each stream)</span><br><br>We will want to initialize this to 0 in our sound_load code:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_loop1, x</span><br style="font-family: Courier New;"><br>Next
we will need a way to set this counter to some value.&#xA0; Some games
bundle this up together in the finite loop opcode, but I prefer to make
it its own opcode:<br><br><span style="font-family: Courier New;">;-----------------------------------------------------------------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;this is our JUMP TABLE!</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_opcodes:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_endsound&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_infinite_loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_change_ve&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_duty&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.word se_op_set_loop1_counter&#xA0;&#xA0; ;$A4</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;etc, one entry per subroutine</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;these are aliases to use in the sound data.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">endsound = $A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">loop = $A1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">volume_envelope = $A2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">duty = $A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">set_loop1_counter = $A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_op_set_loop1_counter:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read the argument (# times to loop)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_loop1, x&#xA0;&#xA0;&#xA0;&#xA0; ;store it in the loop counter variable</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br><br>Now we have an easy way to set the loop counter any time we want, like this:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;somewhere in sound data:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte set_loop1_counter, $04&#xA0;&#xA0;&#xA0; ;repeat 4 times</span><br><b><br>
Looping With The Counter</b><br>Our finite loop opcode will work like the infinite loop opcode, with two changes:<br><br>1) it will decrement the loop counter<br>2) it will check the result and only jump on a non-zero result<br><br>Let&apos;s write it:<br><br><span style="font-family: Courier New;">;-----------------------------------------------------------------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;this is our JUMP TABLE!</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_opcodes:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_endsound&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_infinite_loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_change_ve&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_duty&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_set_loop1_counter&#xA0;&#xA0; ;$A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.word se_op_loop1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A5</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;etc, one entry per subroutine</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;these are aliases to use in the sound data.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">endsound = $A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">loop = $A1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">volume_envelope = $A2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">duty = $A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">set_loop1_counter = $A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">loop1 = $A5</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_op_loop1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; dec stream_loop1, x&#xA0;&#xA0;&#xA0;&#xA0; ;decrement the counter</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_loop1, x&#xA0;&#xA0;&#xA0;&#xA0; ;and check it</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .last_iteration&#xA0;&#xA0;&#xA0;&#xA0; ;if zero, we are done looping</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop_back:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read ptr LO from the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ptr_LO, x&#xA0;&#xA0;&#xA0; ;update our data stream position</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read ptr HI from the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ptr_HI, x&#xA0;&#xA0;&#xA0; ;update our data stream position</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;update the pointer to reflect the new position.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$FF&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;after opcodes return, we do an iny.&#xA0; Since we reset &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;the stream buffer position, we will want y to start out at 0 again.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.last_iteration:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;skip the first byte of the address argument</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; the second byte will be skipped automatically upon return</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; (see se_fetch_byte.&#xA0; There is an &quot;iny&quot; after &quot;jsr se_opcode_launcher&quot;)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Now we can loop.&#xA0; To use the Battle Kid example above, we go from this (56 bytes):<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, C4, E4, A4, A3, C4, E4, A4, A3, C4, E4, A4, A3, C4, E4, A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, C4, E4, A4, A3, C4, E4, A4, A3, C4, E4, A4, A3, C4, E4, A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, C4, E4, A4, A3, C4, E4, A4, A3, C4, E4, A4, A3, C4, E4, A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, C4, E4, A4, A3, E4, E3, E2</span><br>&#xA0;&#xA0; &#xA0;<br>to this (13 bytes):<br>&#xA0;&#xA0; &#xA0;<br>&#xA0;&#xA0;&#xA0; <span style="font-family: Courier New;">.byte set_loop1_counter, 13 ;repeat 13 times.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.intro_loop:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;make sure our loop point is AFTER we set the counter!</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, C4, E4, A4&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;the phrase to repeat.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;finite loop opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word .intro_loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;address to jump back to</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, E4, E3, E2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;the last 4 notes</span><br>&#xA0;&#xA0; &#xA0;<br>Pretty nice savings.&#xA0; Chances are we will be using this opcode set a lot.<br><br><b>Bonus</b><br>We
can save a few more bytes here.&#xA0; You may have noticed that the code in
the .loop_back section of our finite loop opcode is identical to the
infinite loop code:<br><br><span style="font-family: Courier New;">se_op_loop1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;---snip---</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop_back:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read ptr LO from the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ptr_LO, x&#xA0;&#xA0;&#xA0; ;update our data stream position</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read ptr HI from the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ptr_HI, x&#xA0;&#xA0;&#xA0; ;update our data stream position</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;update the pointer to reflect the new position.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$FF&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;after opcodes return, we do an iny.&#xA0; Since we reset &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;the stream buffer position, we will want y to start out at 0 again.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;---snip---</span><br>&#xA0;&#xA0; &#xA0;<br>Compare with:<br><br><span style="font-family: Courier New;">se_op_infinite_loop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read ptr LO from the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ptr_LO, x&#xA0;&#xA0;&#xA0; ;update our data stream position</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read ptr HI from the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ptr_HI, x&#xA0;&#xA0;&#xA0; ;update our data stream position</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;update the pointer to reflect the new position.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_ptr</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy #$FF&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;after opcodes return, we do an iny.&#xA0; Since we reset &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;the stream buffer position, we will want y to start out at 0 again.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Why
have identical code in two places?&#xA0; Let&apos;s cut out the whole .loop_back
section and replace it with a &quot;jmp se_op_infinite_loop&quot;:<br><br><span style="font-family: Courier New;">se_op_loop1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; dec stream_loop1, x&#xA0;&#xA0;&#xA0;&#xA0; ;decrement the counter</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_loop1, x&#xA0;&#xA0;&#xA0;&#xA0; ;check the counter</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .last_iteration&#xA0;&#xA0;&#xA0;&#xA0; ;if zero, we are done looping</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">jmp se_op_infinite_loop ;if not zero, loop back</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.last_iteration:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;skip the first byte of the address argument</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; the second byte will be skipped automatically upon return</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; (see se_fetch_byte after &quot;jsr se_opcode_launcher&quot;)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br><b>Multiple Finite Loops</b><br>You
may have been wondering why I named the finite loop opcode &quot;loop1&quot;.&#xA0;
Why stick a 1 on the end there?&#xA0; This is because sometimes one finite
loop opcode isn&apos;t enough.&#xA0; Consider the following song structure.&#xA0;
Assume each letter represents a long series of notes:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; A A A B C</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; A A A B C</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; A A A B C</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; A A A B C</span><br>&#xA0;&#xA0; &#xA0;<br>With one finite loop opcode you could reduce it to this:<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; (A A A B C)x4</span><br>&#xA0;&#xA0; &#xA0;<br>But if you had two finite loop opcodes available, you could nest them to reduce it even further:<br><br>&#xA0;&#xA0;<span style="font-family: Courier New;">&#xA0; (Ax3 B C)x4</span><br>&#xA0;&#xA0; &#xA0;<br>If
the music you write has a lot of patterns like this, it may be worth
your while to have two or more finite loop opcodes available to you so
that you can nest them.&#xA0; To add another finite loop opcode you need to:<br><br>1) declare another loop counter variable block in RAM (stream_loop2 .rs 6)<br>2) initialize the new loop counter to 0 in the sound_load routine.<br>3) add a new opcode for setting the new loop counter (se_op_set_loop2_counter)<br>4) add a new opcode to check the new counter and loop (se_op_loop2)<br>5) make sure to add the new opcodes to the jump table and give them an alias (set_loop2_counter, loop2).<br><br><br>Each
finite loop opcode you add requires 6 bytes of RAM (a limited
resource!), so please consider carefully if it is worth the tradeoff.&#xA0;
It all depends on your music data.<br><br>
<br><b><font size="3">Changing Keys</font></b><br><br>Another useful
feature to have is the ability to change keys.&#xA0; Imagine you write a
song and you have it all done.&#xA0; Then at the last minute you decide you
want it to be in another key, say a step (2 notes) lower.&#xA0; Rather than
rewrite the whole song by hand (it takes forever), wouldn&apos;t it be nice
if there was an opcode that you could set to automatically subtract two
from every note?&#xA0; What if you have a song pattern that gets played in
more than one key (a rhythm track for a Blues song, for example)?&#xA0; We
could save lots of bytes if we can figure out a way to write the
pattern once, and then loop it while changing keys each iteration.&#xA0;
Let&apos;s do it.<br><br><b>Note Offset</b><br>We will implement keys by having a note offset variable:<br><br><span style="font-family: Courier New;">stream_note_offset .rs 6&#xA0;&#xA0;&#xA0; ;note offset</span><br><br>The
note offset is a value that gets added to the note value before pulling
the period out of the note_table.&#xA0; We will initialize
stream_note_offset to 0 so that the default behavior is to add 0 to the
note (resulting in no change).&#xA0; However, if we set stream_note_offset
to some value via an opcode, it will change the notes.&#xA0; Here is an
updated se_fetch_byte that demonstrates how this works:<br><br><span style="font-family: Courier New;">se_fetch_byte:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;...snip...</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Note stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sty sound_temp1&#xA0;&#xA0;&#xA0;&#xA0; ;save our index into the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">clc</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; adc stream_note_offset, x&#xA0;&#xA0; ;add note offset</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table+1, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy sound_temp1&#xA0;&#xA0;&#xA0;&#xA0; ;restore data stream index</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;...snip...</span><br>&#xA0;&#xA0; &#xA0;<br>Imagine what would happen if we have stream_note_offset set to 2.&#xA0; Say we read a C4 note from the data stream:<br>&#xA0;&#xA0; &#xA0;<br>1. A C4 note is equivalent to hex value #$1b (see aliases in note_table.i)<br>2. we add stream_note_offset to this value.&#xA0; #$1b + #$02 = #$1d.<br>3. hex value #$1d is equivalent to a D4 note (see note_table.i)<br>4. wow, we raised the note up a step!<br><br>Using the same value for stream_note_offset, if we had a string of notes like this:<br><br><span style="font-family: Courier New;">C4, E4, G4, B4, C5, E5, G5, E5, B5, C6 ;Cmaj7</span><br style="font-family: Courier New;"><br>it would get translated to:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">D4, Fs4, A4, C#5, D5, Fs5, A5, C#6, D6 ;Dmaj7</span><br><br>Using
stream_note_offset we can easily transpose entire sections of music
into other keys.&#xA0; As mentioned above, we will initialize a stream&apos;s
stream_note_offset to zero:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_load:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;---snip---</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_offset, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;---snip---</span><br>&#xA0;&#xA0; &#xA0;<br><b>Set Note Offset</b><br>Now let&apos;s make an opcode that will set stream_note_offset to a specific value:<br><br><span style="font-family: Courier New;">;-----------------------------------------------------------------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;this is our JUMP TABLE!</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_opcodes:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_endsound&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_infinite_loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_change_ve&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_duty&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_set_loop1_counter&#xA0;&#xA0; ;$A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_loop1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A5</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; .word se_op_set_note_offset&#xA0;&#xA0;&#xA0;&#xA0; ;$A6</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;these are aliases to use in the sound data.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">endsound = $A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">loop = $A1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">volume_envelope = $A2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">duty = $A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">set_loop1_counter = $A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">loop1 = $A5</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">set_note_offset = $A6</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_op_set_note_offset:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read the argument</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_offset, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;set the note offset.</span><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br><br>Now we can set the note offset anytime we want in the data stream:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">;oops, after writing the song, I realized I wanted it to be in D instead.&#xA0; No problem.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_data:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte set_note_offset, 2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte C2, C3, C4, C5, ;etc.. more notes in the key of C.</span><br>&#xA0;&#xA0; &#xA0;<br><b>Adjust Note Offset</b><br>Setting
the note offset to a specific value has very limited application.&#xA0; It&apos;s
like a one-time keychange.&#xA0; More often we will want to set the note
offset to some relative value.&#xA0; For example, instead of setting
stream_note_offset to 2, we might want to set stream_note_offset to
&quot;the current offset + 2&quot;.&#xA0; If we had an opcode that let us adjust
stream_note_offset by a relative value, we could use it together with
loops.&#xA0; First let&apos;s write the opcode:<br><br><span style="font-family: Courier New;">;-----------------------------------------------------------------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;this is our JUMP TABLE!</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_opcodes:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_endsound&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_infinite_loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_change_ve&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_duty&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_set_loop1_counter&#xA0;&#xA0; ;$A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_loop1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A5</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_set_note_offset&#xA0;&#xA0;&#xA0;&#xA0; ;$A6</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.word se_op_adjust_note_offset&#xA0; ;$A7</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;these are aliases to use in the sound data.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">endsound = $A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">loop = $A1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">volume_envelope = $A2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">duty = $A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">set_loop1_counter = $A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">loop1 = $A5</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">set_note_offset = $A6</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">adjust_note_offset = $A7</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_op_adjust_note_offset:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read the argument (what value to add)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; clc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; adc stream_note_offset, x&#xA0;&#xA0; ;add it to the current offset</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_offset, x&#xA0;&#xA0; ;and save.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Let&apos;s look at this opcode in use.&#xA0; Say we have a long arpeggiated line like this:<br><br><span style="font-family: Courier New;">C2, E2, G2, B2, C3, E3, G3, B3, C4, E4, G4, B4, C5, E5, G5, B5, C6, E6, G6, B6, C7 ;Cmaj7 (21 bytes)</span><br><br>This passage just repeats the same 4 notes (C E G B) over 5 octaves. &#xA0;<br><br><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte set_loop1_counter, 5&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;loop 5 times</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte C2, E2, G2, B2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;these are the 4 notes to loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte adjust_note_offset, 12&#xA0;&#xA0;&#xA0; ;each iteration add 12 to the offset (ie, go up an octave)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word .loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte C2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;will be a C7.&#xA0; Cmaj7 (12 bytes)</span><br>&#xA0;&#xA0; &#xA0;<br>The
first time through the loop it will play C2, E2, G2, B2.&#xA0; The second
time through the loop it will play C3, E3, G3, B3.&#xA0; The third time
through will be C4, E4, G4, B4, etc.&#xA0; Using our opcodes, we reduce the
size of our data from 21 bytes to 12 bytes.&#xA0; That&apos;s almost 50% savings.<br><br><b>Battle Kid</b><br>To take a better example, let&apos;s look at the bassline to the Battle Kid theme song.&#xA0; Last week, it looked like this:<br><br><span style="font-family: Courier New;">song6_tri:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, A3, A4, A4, A3, A3, A4, A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte G3, G3, G4, G4, G3, G3, G4, G4&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;down a step (-2)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte F3, F3, F4, F4, F3, F3, F4, F4&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;down a step (-2)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte Eb3, Eb3, Eb4, Eb4, Eb3, Eb3, Eb4, Eb4&#xA0;&#xA0;&#xA0; ;down a step (-2)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song6_tri</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;36 bytes</span><br>&#xA0;&#xA0; &#xA0;<br>We have a pattern here: <span style="font-family: Verdana;">X3, X3, X4, X4, X3, X3, X4, X4</span>,
where X = some note.&#xA0; It just so happens that each new X is just the
previous X minus 2. Using our new opcode, we can rewrite the bassline
like this:<br><br><span style="font-family: Courier New;">song6_tri:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte set_loop1_counter, 4&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;repeat 4 times</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A3, A3, A4, A4, A3, A3, A4, A4&#xA0;&#xA0;&#xA0; ;series of notes to repeat</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte adjust_note_offset, -2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;go down a step</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word .loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte set_note_offset, 0&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;after 4 repeats, reset note offset to 0.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;infinite loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song6_tri&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;21 bytes</span><br>&#xA0;&#xA0; &#xA0;<br>We drop from 36 bytes to 21 bytes of ROM space.&#xA0; About 40% savings!<br>&#xA0;&#xA0; &#xA0;<br><b>Loopy Sound Effects</b><br>We can produce some cool sound effects if we combine loops and key changes at high tempos.&#xA0; Look at this one (tempo is $FF):<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">song7_square2:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte set_loop1_counter, $08&#xA0;&#xA0;&#xA0; ;repeat 8 times</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte thirtysecond, D7, D6, G6&#xA0; ;play two D notes at different octaves and a G.&#xA0; Pretty random</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte adjust_note_offset, -4&#xA0;&#xA0;&#xA0; ;go down 2 steps</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word .loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte endsound</span><br>&#xA0;&#xA0; &#xA0;<br>This
sound effect plays a simple 3-note pattern in descending keys super
fast.&#xA0; The sound data is only 12 bytes, but it produces a pretty
complex sound effect.&#xA0; Listen to song7 in this week&apos;s sample files to
hear it.&#xA0; By experimenting with loops like this we can come up with
some sounds that would be difficult to compose by hand.<br>&#xA0;&#xA0; &#xA0;<br><b><font size="3">Complex Chord Progressions</font></b><br>We
made some good savings percentage-wise on the bassline to Battle Kid.&#xA0;
But we were lucky.&#xA0; The chord progression went down in consistent
steps: -2, -2, -2.&#xA0; It was possible to loop this because we adjust the
note_offset by the same value (-2) each time.&#xA0; But what if we had a
pattern that was repeated in a more complicated way?&#xA0; We do.&#xA0; Let&apos;s
look at the rhythm pattern for our Guardian Legend boss song:<br><br><span style="font-family: Courier New;">song1_square1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A2, A2, A2, A3, A2, A3, A2, A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte F3, F3, F3, F4, F3, F4, F3, F4&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;+8 (A2 + 8 = F3)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A2, A2, A2, A3, A2, A3, A2, A3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;-8</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte F3, F3, F3, F4, F3, F4, F3, F4&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;+8</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte E3, E3, E3, E4, E3, E4, E3, E4&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;-1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte E3, E3, E3, E4, E3, E4, E3, E4&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;+0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte Ds3, Ds3, Ds3, Ds4, Ds3, Ds4, Ds3, Ds4&#xA0;&#xA0;&#xA0; ;-1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte D3, D3, D3, D4, D3, D4, D3, D4&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;-1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte C3, C3, C3, C4, C3, C4, C3, C4&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;-2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte B2, B2, B2, B3, B2, B3, B2, B3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;-1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte As2, As2, As2, As3, As2, As3, As2, As3&#xA0;&#xA0;&#xA0; ;-1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A2, A2, A2, A3, A2, A3, A2, A3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;-1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte Gs2, Gs2, Gs2, Gs3, Gs2, Gs3, Gs2, Gs3&#xA0;&#xA0;&#xA0; ;-1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte G2, G2, G2, G3, G2, G3, G2, G3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;-1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;+2 (loop back to A2)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song1_square1</span><br>&#xA0;&#xA0; &#xA0;<br>Here
we have another pattern: Xi, Xi, Xi, Xi+1, Xi, Xi+1, Xi, Xi+1, where X
= some note and i = some octave.&#xA0; Cool.&#xA0; A pattern means we have an
opportunity to save bytes by looping.&#xA0; But wait.&#xA0; Unlike Battle Kid,
this pattern jumps around in an inconsistent way.&#xA0; What should we do?<br><br><b>Super TGL Transposition Trick</b><br>I learned this trick from The Guardian Legend, so I call it the <b>TGL Transposition Trick</b>.&#xA0;
What we do is we loop the pattern, and then use the loop counter as an
index into a lookup table.&#xA0; The lookup table contains note offset
values.&#xA0; Because the loop counter decrements, our lookup table will be
sequentially backwards.<br><br>Wait, what?&#xA0; Let&apos;s looks at our example:<br><br><span style="font-family: Courier New;">song1_square1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte set_loop1_counter, 14&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;repeat 14 times</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A2, A2, A2, A3, A2, A3, A2, A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">;pull a value from lookup_table and</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; ; add it to stream_note_offset</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;finite loop (14 times)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word .loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;infinite loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song1_square1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.lookup_table:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte 2, -1, -1, -1, -1, -1, -2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte -1, -1, 0, -1, 8, -8, 8&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;14 entries long, reverse order</span><br>&#xA0;&#xA0; &#xA0;<br>I&apos;m
going to break it down in a second here, but first let me tell you that
the part highlighted in red above will be covered by a single opcode,
transpose.&#xA0; The transpose opcode takes a 2-byte argument, so altogether
that commented section will be replaced with 3 bytes of data.&#xA0; So if we
count up all of the bytes in our rhythm sound data we get 34 bytes.&#xA0;
The original was 116 bytes.&#xA0; By using the TGL Transposition Trick, we
save 82 bytes.&#xA0; That&apos;s 70%!<br><br><span style="font-family: Courier New;">song1_square1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte set_loop1_counter, 14&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;repeat 14 times</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.loop:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte A2, A2, A2, A3, A2, A3, A2, A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.byte transpose&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;the transpose opcode take a 2-byte argument</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; .word .lookup_table&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;which is the address of the lookup table</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;finite loop (14 times)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word .loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;infinite loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song1_square1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.lookup_table:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte 2, -1, -1, -1, -1, -1, -2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte -1, -1, 0, -1, 8, -8, 8&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;14 entries long, reverse order</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">;*** altogether 34 bytes ***</span><br><br>The
transpose opcode will set up a pointer variable to point to the lookup
table.&#xA0; Then it will take the loop counter, subtract 1, and use the
result as an index into the table.&#xA0; We subtract 1 because the tables
index from zero.&#xA0; If we loop 14 times, our table will have 14 entries
numbered 0-13.&#xA0; Once the transpose opcode has its index, it will pull a
value from the table.&#xA0; This value will be added to stream_note_offset.<br><br>Before
we write the opcode, let&apos;s trace through the data to see how it works.&#xA0;
We&apos;ll start at the very first byte of song1_square1:<br><br>1) set note length to eighth notes<br>2) set the loop counter to 14<br><br>(.loop iteration 1)<br>3) play a series of notes: A2, A2, A2, A3, A2, A3, A2, A3<br>4)
transpose opcode.&#xA0; Setup a pointer to lookup_table.&#xA0; Use our loop
counter, minus one, as an index.&#xA0; The loop counter is 14 now, so we
will pull out .lookup_table+13, which is an 8.&#xA0; Add 8 to the current
stream_note_offset: 0 + 8 = 8.<br>5) decrement the loop counter (14-&gt;13) and loop back to the .loop label<br><br>(iteration 2)<br>6) our new string of notes with the +8: F3, F3, F3, F4, F3, F4, F3, F4. <br>7) transpose opcode.&#xA0; Loop counter is 13.&#xA0; Grab .lookup_table+12, which is -8.&#xA0; Add -8 to stream_note_offset: 8 + -8 = 0.<br>8) decrement loop counter (13-&gt;12) and loop back to .loop label<br><br>(iteration 3)<br>9) our new string of notes with the +0: A2, A2, A2, A3, A2, A3, A2, A3 <br>10) transpose opcode.&#xA0; Loop counter is 12.&#xA0; Grab .lookup_table+11, which is 8.&#xA0; Add 8 to stream_note_offset: 0 + 8 = 8.<br>11) decrement loop counter (12-&gt;11) and loop back to .loop label<br><br>(iteration 4)<br>12) our new string of notes with the +8: F3, F3, F3, F4, F3, F4, F3, F4. <br>13) transpose opcode.&#xA0; Loop counter is 11.&#xA0; Grab .lookup_table+10, which is -1.&#xA0; Add -1 to stream_note_offset: 8 + -1 = 7.<br>14) decrement loop counter (11-&gt;10) and loop back to .loop label<br><br>(iteration 4)<br>15) our new string of notes with the +7: E3, E3, E3, E4, E3, E4, E3, E4. <br>16) transpose opcode.&#xA0; Loop counter is 10.&#xA0; Grab .lookup_table+9, which is 0.&#xA0; Add 0 to stream_note_offset: 7 + 0 = 7.<br>17) decrement loop counter (10-&gt;9) and loop back to .loop label<br><br>etc.&#xA0;
On the last iteration our loop counter is 1.&#xA0; We grab .lookup_table+0
and add it to stream_note_offset.&#xA0; Then we decrement the loop counter
(1-&gt;0).&#xA0; Our loop counter is now 0, so our loop breaks.&#xA0; Pretty
cool, no?&#xA0; Let&apos;s write it.<br><br><span style="font-family: Courier New;">;-----------------------------------------------------------------------</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;this is our JUMP TABLE!</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">sound_opcodes:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_endsound&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_infinite_loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_change_ve&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_duty&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_set_loop1_counter&#xA0;&#xA0; ;$A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_loop1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A5</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_set_note_offset&#xA0;&#xA0;&#xA0;&#xA0; ;$A6</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word se_op_adjust_note_offset&#xA0; ;$A7</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; .word se_op_transpose&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$A8</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">;these are aliases to use in the sound data.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">endsound = $A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">loop = $A1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">volume_envelope = $A2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">duty = $A3</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">set_loop1_counter = $A4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">loop1 = $A5</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">set_note_offset = $A6</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">adjust_note_offset = $A7</span><br style="font-family: Courier New;"><span style="font-family: Courier New; color: rgb(255, 0, 0);">transpose = $A8</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">se_op_transpose:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read low byte of the pointer to our lookup table</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta <span style="color: rgb(255, 0, 0);">sound_ptr2</span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;store it in a new pointer variable</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read high byte of pointer to table</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta <span style="color: rgb(255, 0, 0);">sound_ptr2</span>+1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sty sound_temp&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save y because we are about to destroy it</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda stream_loop1, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;get loop counter, put it in Y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&#xA0;&#xA0; this will be our index into the lookup table</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; dey&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;subtract 1 because indexes start from 0.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [<span style="color: rgb(255, 0, 0);">sound_ptr2</span>], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;read a value from the table.</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; clc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; adc stream_note_offset, x&#xA0;&#xA0; ;add it to the note offset</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_offset, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy sound_temp&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;restore Y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>There
is a new pointer variable here, sound_ptr2.&#xA0; Actually, what I really
did was rename jmp_ptr to sound_ptr2.&#xA0; The new name let&apos;s me know it&apos;s
for sound engine use only.&#xA0; Since we finish with jmp_ptr as soon as we
jump, there are no pointer conflicts here.<br><br><b>Conclusion</b><br>This
is just an example of how clever use of opcodes and looping can save
you lots of bytes.&#xA0; Keep in mind that this transpose opcode is only
useful if you write music that has repeating patterns in the rhythm
section.&#xA0; If you don&apos;t, then save yourself some bytes and cut the
opcode from your sound engine.<br><br><b>Putting It All Together</b><br>Download and unzip the <a href="downloads/NerdyNightsSoundSourceCollection/opcodes2.zip" target="_blank" original-href="http://tummaigames.com/opcodes2.zip">opcodes2.zip</a> sample files.&#xA0; Make sure the following files are in the same folder as NESASM3:<br><br>&#xA0;&#xA0;&#xA0; opcodes2.asm<br>&#xA0;&#xA0;&#xA0; sound_engine.asm<br>&#xA0;&#xA0;&#xA0; sound_opcodes.asm<br>&#xA0;&#xA0;&#xA0; opcodes2.chr<br>&#xA0;&#xA0;&#xA0; note_table.i<br>&#xA0;&#xA0;&#xA0; note_length_table.i<br>&#xA0;&#xA0;&#xA0; vol_envelopes.i<br>&#xA0;&#xA0;&#xA0; song0.i<br>&#xA0;&#xA0;&#xA0; song1.i<br>&#xA0;&#xA0;&#xA0; song2.i<br>&#xA0;&#xA0;&#xA0; song3.i<br>&#xA0;&#xA0;&#xA0; song4.i<br>&#xA0;&#xA0;&#xA0; song5.i<br>&#xA0;&#xA0;&#xA0; song6.i<br>&#xA0;&#xA0;&#xA0; song7.i<br>&#xA0;&#xA0;&#xA0; opcodes2.bat<br><br>Double click opcodes2.bat. That will run NESASM3 and should produce the opcodes2.nes file. Run that NES file in FCEUXD SP.<br><br>Use the controller to select songs and play them.&#xA0; Controls are as follows:<br>&#xA0;&#xA0; &#xA0;<br><b>Up</b>: Play<br><b>Down</b>: Stop <br><b>Right</b> : Next Song/SFX<br><b>Left</b> : Previous Song/SFX<br><br>Song0 is a silence song.&#xA0; Not selectable.<br>Song1-Song6 are the same as last week, but they take up less ROM-space now<br>Song7 is a new sound effect created by looping a key change at high tempo.<br><br>As usual, try adding your own songs and sound effects in using the new opcodes.&#xA0; Experiment.<br><br><b>Next Week</b>: <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=27943" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=27943">Noise, Simple Drums</a><br>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#audio_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;audio_tutorial-9__comments&apos;);">
                            是否显示评论内容
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=26247" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="audio_tutorial-9__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-9__1">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Nov 29, 2009 at 11:02:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					sweeeeet. this is getting good. Tom had some stuff working in the last engine, but this should really simplify things.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-9__2">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Nov 30, 2009 at 8:43:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This looks great!  I can&apos;t wait to start making music.  Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-9__3">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				May 2, 2010 at 10:36:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for such a thorough sound tutorial! Using some of the core concepts here and important facts (such as what happens when writing to the 4th register of square channels), I&apos;ve written my own sound engine for use in my game.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-9__4">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 17, 2010 at 4:19:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>Holy Christ...this one is pretty intense. My brain hurts. <br><br>I do have a question though.&#xA0; I have tried to use negative numbers before and the assembler rejected it. Not to sound too dumb, but how are you getting it to just let you &quot;add negative numbers&quot;? </p><p>
				</p></div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-9__5">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				May 18, 2010 at 11:39:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br><p>Holy Christ...this one is pretty intense. My brain hurts. <br><br>I do have a question though.&#xA0; I have tried to use negative numbers before and the assembler rejected it. Not to sound too dumb, but how are you getting it to just let you &quot;add negative numbers&quot;? </p><p></p></div><br><br>-1 gets interpreted by the assembler as $FF.&#xA0; -2 is $FE, -3 is $FD, etc.&#xA0; I use the negative values because it&apos;s easier to read and understand what they&apos;re used for, but in the final ROM they will appear as FF, FE, etc.<br><br>If you try out some 8bit addition, you can see that they work the same:<br><br>1 + FF = 0&#xA0; (carry set)<br>2 + FF = 1<br>3 + FF = 2<br>etc..<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-9__6">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 19, 2010 at 8:45:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You know, since I made that post I had been thinking about it.  I came up with the solution of &quot;adding $FF or $FE&quot; to subtract.  But I like that the assembler will interpret the numbers for you.  That makes life a lot easier.  I will have to make another stab at it.  I must have been doing something retarted like $-01 or something before.
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="audio_tutorial-10">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Nerdy Nights Sound: Part 10: Simple Drums</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b>Last Week</b>: <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=26247" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=26247">Finite Looping, Key Changes, Chord Progressions</a><br><b><br>
This Week</b>: Simple Drums<br><br><font size="5"><b>Drums</b></font><br>This week we are going to take a look at drums.&#xA0; I saved them until now because they use the <b>Noise</b>
channel, which operates much differently from the other 3 channels.&#xA0;
With the Square and Triangle channels we manually set the waveform
period to choose what note to play.&#xA0; Our note lookup table was just a
table of periods to plug into the channel ports.&#xA0; The Noise channel on
the other hand produces random noise.&#xA0; We don&apos;t use a note table at all.<br><br><font size="3"><b>Noise Channel</b></font><br>The noise channel doesn&apos;t produce notes, it produces noise.&#xA0; We communicate with the noise channel through 3 ports: <b>$400C</b>, <b>$400E</b>, <b>$400F</b>.&#xA0; Note that port $400D is <i>unused</i>.&#xA0; Let&apos;s take a closer look at the Noise ports.<br><br><b>Volume - $400C</b><br>$400C let&apos;s you control the volume of the Noise channel.&#xA0; It works just like the Square channels, except there is no Duty Cycle:<br><br><span style="font-family: Courier New;">NOI_ENV ($400C)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0; ||||||</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0; ||++++- Volume</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0; |+----- Saw Envelope Disable (0: use internal counter for volume; 1: use Volume for volume)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0; +------ Length Counter Disable (0: use Length Counter; 1: disable Length Counter)</span><br>&#xA0; <br>For
our purposes, we will set Saw Envelope Disable and Length Counter
Disable and forget about them.&#xA0; This will allow us to have full control
of &quot;note&quot; length and volume via Volume Envelopes.&#xA0; We did the same
thing for the Square channels.<br><br><b>Random Generator - $400E</b><br>$400E let&apos;s us control the settings for the random generator.&#xA0; It looks like this:<br><br><span style="font-family: Courier New;">NOI_RAND ($400E)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">|&#xA0;&#xA0; ||||</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">|&#xA0;&#xA0; ++++- Sound Type</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">+-------- Mode</span><br><br><b>Mode</b> sets the mode.&#xA0; There are two modes, <b>Mode-0</b> and <b>Mode-1</b>.&#xA0;
Mode-0 sounds dull and breathy, like static sssh.&#xA0; Mode-1 sounds more
sharp, robotic and buzzy.&#xA0; There&apos;s really no good way to describe in
words, so the best way to know the difference in sound is to listen to
both modes.&#xA0; (see below)<br><br>Each mode has 16 possible sounds, selected by <b>Sound Type</b>.&#xA0;
This means that the Noise channel really only gives us 32 possible
sounds total!&#xA0; More complex sound effects on the Noise channel are
created by playing combinations of these 32 noises one after another.&#xA0;
To hear what each of the 32 sounds sound like, listen to <b>Song 8</b> in this week&apos;s sample program.&#xA0; It plays the 16 Mode-0 sounds followed by the 16 Mode-1 sounds.<br><br>Note:
In this tutorial I will assign each of the 32 Noise channel sounds a
number 00-1F.&#xA0; The left number (0 or 1) refers to the <i>Mode</i>.&#xA0; The right number (0-F) refers to the <i>Sound Type</i>.&#xA0; For example, sound &quot;04&quot; means &quot;Mode 0, Sound Type 4&quot;.&#xA0; Sound &quot;1E&quot; means &quot;Mode 1, Sound Type E&quot;.<br><br><b>Length Counter - $400F</b><br>$400F is the Noise channel&apos;s length counter.&#xA0; We disabled the length counter in $400C, so we can ignore this port completely!<br><font size="3"><b><br>
Simple Noise Drums<br>
</b></font><br>The simplest way to make a drum sound on the Noise
channel is to play a single Sound Type under a volume envelope that
decays to 0 (silence).&#xA0; Many games use this kind of drum exclusively.&#xA0;
The Guardian Legend for example only uses two drum sounds throughout
the whole game: 04 and 06.&#xA0; Battle Kid makes heavy use this simple drum
style too.&#xA0; Lots of games do.<br><br>So how will we represent simple
drums in the sound data?&#xA0; Recall that our sound engine distinguishes
between Notes, Note Lengths and Opcodes using ranges:<br><br><span style="font-family: Courier New;">.fetch:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda [sound_ptr], y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bpl .note&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if &lt; #$80, it&apos;s a Note</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; cmp #$A0</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .note_length&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else if &lt; #$A0, it&apos;s a Note Length</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.opcode:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else it&apos;s an opcode</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do opcode stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;<span style="color: rgb(255, 0, 0);">range A0-FF</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note_length:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do note length stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;<span style="color: rgb(255, 0, 0);">range 80-9F</span></span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.note:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do note stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;<span style="color: rgb(255, 0, 0);">range 00-7F</span></span><br>&#xA0;&#xA0; &#xA0;<br>Although
we won&apos;t use our note table for the Noise channel, we will treat drums
like notes as far as ranges are concerned.&#xA0; So we need our drum data
values to be in the range of $00-$7F.&#xA0; That&apos;s easy.&#xA0; We&apos;ll assign the
Mode-0 sounds to $00-$0F and Mode-1 sounds to $10-$1F.&#xA0; Some drum data
might look like this then:<br><br><span style="font-family: Courier New;">example_drum_data:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth, $04</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte sixteenth, $1E, $1E, $1F</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte d_eighth, $04</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte sixteenth, $06, $06, $08, $08</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth, $17, $07</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word example_drum_data</span><br><br><br>Since
we are not using the note table for Noise, we will need to alter our
Note code to check the channel and branch to different code if we are
processing the Noise channel (new stuff in red):<br><br><span style="font-family: Courier New;">.note:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;do Note stuff</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">sta sound_temp2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save the note value</span></span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda stream_channel, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;what channel are we using?</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; cmp #NOISE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;is it the Noise channel?</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; bne .not_noise&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; jsr se_do_noise&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if so, JSR to a subroutine to handle noise data</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; jmp .reset_ve&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;and skip the note table when we return</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">.not_noise:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;else grab a period from the note_table</span><br style="font-family: Courier New; color: rgb(255, 0, 0);"><span style="font-family: Courier New; color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; lda sound_temp2&#xA0;&#xA0;&#xA0;&#xA0; ;restore note value</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sty sound_temp1&#xA0;&#xA0;&#xA0;&#xA0; ;save our index into the data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; clc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; adc stream_note_offset, x&#xA0;&#xA0; ;add note offset</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; asl a</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tay</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda note_table+1, y</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ldy sound_temp1&#xA0;&#xA0;&#xA0;&#xA0; ;restore data stream index</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ;check if it&apos;s a rest and modify the status flag appropriately</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; jsr se_check_rest</span><br style="font-family: Courier New;"><span style="font-family: Courier New;"><span style="color: rgb(255, 0, 0);">.reset_ve:</span>&#xA0;&#xA0; &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda #$00</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ve_index, x &#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.update_pointer:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; iny</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; tya</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; clc</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; adc stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_ptr_LO, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; bcc .end</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; inc stream_ptr_HI, x</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.end:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>This
code checks to see if the channel is the Noise channel.&#xA0; If so it JSRs
to a special Noise subroutine.&#xA0; Upon return, it jumps over the
note_table code and updates the volume envelope and stream pointer like
normal.<br><br>So what does our special Noise subroutine, <span style="font-family: Courier New;">se_do_noise</span>, look like?&#xA0; The job of <span style="font-family: Courier New;">se_do_noise</span>
will be to take the note value and convert it into something we can
write to $400E (NOI_RAND).&#xA0; Recall that $400E expects the Mode number
in bit7 and the Sound Type in bits 0-3:<br><br style="font-family: Courier New;"><span style="font-family: Courier New;">NOI_RAND ($400E)</span><br style="font-family: Courier New;"><br style="font-family: Courier New;"><span style="font-family: Courier New;">76543210</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">|&#xA0;&#xA0; ||||</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">|&#xA0;&#xA0; ++++- Sound Type</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">+-------- Mode</span><br><br><b>Mode-0</b>
sounds don&apos;t need to be converted at all.&#xA0; We represent them with the
values $00-$0F, which correspond exactly to the values we need to write
to $400E.<br><br><b>Mode-1</b> sounds need to be tweaked a bit.&#xA0; We
represent Mode-1 sounds with the values $10-$1F, or in binary
%00010000-%00011111.&#xA0; Notice we identify the Mode number using bit4.&#xA0;
Port $400E expects the Mode number in bit7 though, not bit4, so we will
need to set bit7 ourselves:<br><br><span style="font-family: Courier New;">se_do_noise:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_temp2&#xA0;&#xA0;&#xA0;&#xA0; ;restore the note value</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; and #%00010000&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;isolate bit4</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; beq .mode0&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if it&apos;s clear, Mode-0, so no conversion</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.mode1:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_temp2&#xA0;&#xA0;&#xA0;&#xA0; ;else Mode-1, restore the note value</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; ora #%10000000&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;set bit 7 to set Mode-1</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta sound_temp2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">.mode0:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; lda sound_temp2</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; sta stream_note_LO, x&#xA0;&#xA0; ;temporary port that gets copied to $400E</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; rts</span><br>&#xA0;&#xA0; &#xA0;<br>Now everything is set.&#xA0; Note values of $00-$0F will get written to <span style="font-family: Courier New;">stream_note_LO</span> directly.&#xA0; Note values of $10-$1F will get converted to $90-$9F first and then get written to <span style="font-family: Courier New;">stream_note_LO</span>.&#xA0; Note that we do not bother clearing bit4 for Mode-1 sounds.&#xA0; Bit4 has no effect on $400E so we can just leave it as it is.<br><br><font size="3"><b>Drum Decay</b></font><br>The only thing left to add is a volume envelope for the simple drums to use.&#xA0; It should be short and decay to zero (silence):<br><br>volume_envelopes:<br>&#xA0;&#xA0;&#xA0; .word se_ve_1<br>&#xA0;&#xA0;&#xA0; .word se_ve_2<br>&#xA0;&#xA0;&#xA0; .word se_ve_3<br>&#xA0;&#xA0;&#xA0; .word se_ve_tgl_1<br>&#xA0;&#xA0;&#xA0; .word se_ve_tgl_2<br>&#xA0;&#xA0;&#xA0; .word se_battlekid_loud<br>&#xA0;&#xA0;&#xA0; .word se_battlekid_loud_long<br>&#xA0;&#xA0;&#xA0; .word se_battlekid_soft<br>&#xA0;&#xA0;&#xA0; .word se_battlekid_soft_long<br>&#xA0;&#xA0;&#xA0; <span style="color: rgb(255, 0, 0);">.word se_drum_decay</span><br>&#xA0;&#xA0; &#xA0;<br><span style="color: rgb(255, 0, 0);">se_drum_decay:</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; .byte $0E, $09, $08, $06, $04, $03, $02, $01, $00&#xA0; ;7 frames per drum.&#xA0; Experiment to get the length and attack you want.</span><br style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">&#xA0;&#xA0;&#xA0; .byte $FF</span><br>&#xA0;&#xA0; &#xA0;<br><span style="color: rgb(255, 0, 0);">ve_drum_decay = $09</span><br style="color: rgb(255, 0, 0);"><br>You can of course make multiple volume envelopes for the drums to choose from.<br><br><font size="3"><b>Conclusion</b></font><br><br>Now we can add drum data to our songs.&#xA0; Here is the drum data for The Guardian Legend boss song we&apos;ve been using:<br><br><span style="font-family: Courier New;">;in the song header, after the header info for Squares and Triangle:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte MUSIC_NOI&#xA0;&#xA0;&#xA0;&#xA0; ;which stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;status byte: enabled</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte NOISE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;which channel</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $30&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;initial volume_duty value (disable length counter and saw envelope)</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte ve_drum_decay ;volume envelope</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song1_noise&#xA0;&#xA0; ;pointer to the sound data stream</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte $53&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;tempo</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">song1_noise:</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth, $04&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this song only uses drum 04 (Mode-0, Sound Type 4) for a snare</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte sixteenth, $04, $04, $04</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte d_eighth, $04</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte sixteenth, $04, $04, $04, $04</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte eighth, $04, $04</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .byte loop</span><br style="font-family: Courier New;"><span style="font-family: Courier New;">&#xA0;&#xA0;&#xA0; .word song1_noise</span><br>&#xA0;&#xA0; &#xA0;<br>Try adding some drums to your own songs!<br>&#xA0;&#xA0; &#xA0;<br><b>Putting It All Together</b><br>Download and unzip the <a href="downloads/NerdyNightsSoundSourceCollection/drums.zip" target="_blank" original-href="http://tummaigames.com/drums.zip">drums.zip</a> sample files.&#xA0; Make sure the following files are in the same folder as NESASM3:<br><br>&#xA0;&#xA0;&#xA0; drums.asm<br>&#xA0;&#xA0;&#xA0; sound_engine.asm<br>&#xA0;&#xA0;&#xA0; sound_opcodes.asm<br>&#xA0;&#xA0;&#xA0; drums.chr<br>&#xA0;&#xA0;&#xA0; note_table.i<br>&#xA0;&#xA0;&#xA0; note_length_table.i<br>&#xA0;&#xA0;&#xA0; vol_envelopes.i<br>&#xA0;&#xA0;&#xA0; song0.i<br>&#xA0;&#xA0;&#xA0; song1.i<br>&#xA0;&#xA0;&#xA0; song2.i<br>&#xA0;&#xA0;&#xA0; song3.i<br>&#xA0;&#xA0;&#xA0; song4.i<br>&#xA0;&#xA0;&#xA0; song5.i<br>&#xA0;&#xA0;&#xA0; song6.i<br>&#xA0;&#xA0;&#xA0; song7.i<br>&#xA0;&#xA0;&#xA0; song8.i<br>&#xA0;&#xA0;&#xA0; drums.bat<br><br>Double click drums.bat. That will run NESASM3 and should produce the drums.nes file. Run that NES file in FCEUXD SP.<br><br>Use the controller to select songs and play them.&#xA0; Controls are as follows:<br>&#xA0;&#xA0; &#xA0;<br><b>Up</b>: Play<br><b>Down</b>: Stop <br><b>Right</b> : Next Song/SFX<br><b>Left</b> : Previous Song/SFX<br><br><b>Song0</b> is a silence song.&#xA0; Not selectable.<br><b>Song1-Song7</b> are the same as last week, but a few of them (1, 4 and 6) have drums now.<br><b style="color: rgb(255, 0, 0);">Song8</b>
is a new &quot;song&quot; that plays each of the Noise channel&apos;s 32 sounds, in
order from 00-1F.&#xA0; First it plays them with a sustained volume envelope
so that you can hear how they sound drawn out.&#xA0; Next they are played
using the 7-frame ve_drum_decay volume envelope we made so you can hear
how they sound as simple drum sounds.<br><br><b>Next Week</b>: More Complex Drums, Noise SFX
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#audio_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;audio_tutorial-10__comments&apos;);">
                            是否显示评论内容
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=27943" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="audio_tutorial-10__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-10__1">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jan 18, 2010 at 8:56:31 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Awesome, nicely done!  Keep them comming.  I can&apos;t wait to start adding music to my game.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-10__2">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Jan 19, 2010 at 3:48:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					getting close now. woot
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-10__3">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Jan 19, 2010 at 5:26:39 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					what part/feature are you waiting for the most?&#xA0; I might be able to explain how to do it and then you could try writing it on your own instead of waiting for the tutorial to come around.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-10__4">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Jan 20, 2010 at 1:17:18 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oh, nothing in particular. I think you&apos;ll have it all covered. May even be good after this one. need to talk to zi.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-10__5">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Jan 20, 2010 at 1:40:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Your blog looks great too Thomas, you&apos;ve got some neat ideas documented there!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-10__6">
                                                        <div class="mdl-card__title"><strong>removed-07-06-2016</strong> posted on 
		
			
				
				Feb 8, 2010 at 3:34:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I just wanted to bump this thread with a hearty thank you.  This stuff is really fantastic, and while I&apos;m not programming at the moment, I still take the time to read through your tutorials every time one is posted.  Keep up the awesome work, and thank you for contributing to the community like this.
<br>
<br>Cheers!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-10__7">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 17, 2010 at 4:37:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					And that&apos;s ten.  Whew.  Some good stuff here.  I can&apos;t wait to bust out some Pantera on this bad boy.  <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-happy.gif" show-src="images/blank.gif">  Seriously, though, good job.  I can&apos;t imagine the time investment that you put into these.  This is a great asset to the programming community.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-10__8">
                                                        <div class="mdl-card__title"><strong>rizz</strong> posted on 
		
			
				
				Jun 4, 2010 at 2:02:34 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					For some reason, I have to do a write to $400F (any value) prior to my write to $400E.  Any clue as to why?
<br>
<br>I believe I&apos;ve said it before, but these tutorials are fantastic.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-10__9">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Aug 29, 2011 at 1:05:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>rizz</b></i><br><br>For some reason, I have to do a write to $400F (any value) prior to my write to $400E.  Any clue as to why?
<br>
<br>I believe I&apos;ve said it before, but these tutorials are fantastic.</div><br>I&apos;ve also been wondering why this is (even when length counter is disabled and using the constant volume flag for the envelope). Haven&apos;t been able to find an explanation for it from any of the available APU docs.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-10__10">
                                                        <div class="mdl-card__title"><strong>Mog</strong> posted on 
		
			
				
				Jan 23, 2016 at 5:34:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Does anyone have the zip file from this?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="audio_tutorial-10__11">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jan 23, 2016 at 5:54:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>rizz</b></i><br>
<br>
For some reason, I have to do a write to $400F (any value) prior to my write to $400E. Any clue as to why?<br>
<br>
I believe I&apos;ve said it before, but these tutorials are fantastic.</div>
<br>
I&apos;ve also been wondering why this is (even when length counter is disabled and using the constant volume flag for the envelope). Haven&apos;t been able to find an explanation for it from any of the available APU docs.</div>
Going to answer myself here. <span class="sprites_emoticons absmiddle" id="emo_smile"></span> I&apos;m guessing that the $400F write is needed because the length counter might be initially holding a 0 value -- the $400F write will reload a non-zero value into the length counter (and the length counter&apos;s halt flag will then keep it at a non-zero value).<br>
<br>
You don&apos;t see this problem with the pulse channels because the pulse&apos;s &quot;length counter load&quot; is in the same register ($4003/$4007) as the high 3 bits of period, so the length counter reload will happen as a side-effect of writing those high 3 bits.<br>
<br>
Also, since the length counter value is read from a lookup table which doesn&apos;t contain zeros, the written value is irrelevant (if the length counter halt flag is set).<br>
<br>
EDIT: Just as a further note, even if length counter is not used, the zero value in it is a problem because it will unconditionally silence the channel.<br>
EDIT #2: Accidentally had written &quot;$400E write&quot;, not &quot;$400F write&quot;. Fixed.
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

            
        </div>
    </section>
</div>
<div class="mdl-layout__tab-panel" id="main_tutorial">
    <section class="section--center mdl-grid mdl-grid--no-spacing">
        <div class="mdl-cell mdl-cell--12-col">
            <h4>基础教程</h4>

            <h5>目录</h5>
            <ul class="toc" id="main_tutorial-toc">
                                    <a href="#main_tutorial-0">0: 简介</a>
                                    <a href="#main_tutorial-1">1: 数字系统及核心编程思想</a>
                                    <a href="#main_tutorial-2">2: NES 架构概述</a>
                                    <a href="#main_tutorial-3">3: 6502 ASM, 第一个程序</a>
                                    <a href="#main_tutorial-4">4: 调色板，精灵，第二个程序</a>
                                    <a href="#main_tutorial-5">5: 多个精灵，手柄控制，更多介绍</a>
                                    <a href="#main_tutorial-6">6: 背景</a>
                                    <a href="#main_tutorial-7">7: 子程序，游戏布局，Pong游戏</a>
                                    <a href="#main_tutorial-8">8: 16进制，指针，循环嵌套</a>
                                    <a href="#main_tutorial-9">9: 数字转换，BIN - DEC 二进制 十进制</a>
                            </ul>

                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="main_tutorial-0">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">简介</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					This is going to be a series of weekly NES programming lessons, starting from absolutely no knowledge.  Right now the plan is 16-20 lessons ending with a complete game like pong or breakout.  The first lessons may be easy but they will get harder!  People who have done any type of programming before may have an easier time but anyone should be able to make it through.  All the tools will be Windows based, so Linux users will have to use wine and MacOS users will have to use Parallels, Boot Camp, or VirtualPC.
<br><br>
Many things will simply not be covered in this series.  No audio or scrolling will be done.  Only the NROM mapper will be used.  After you make it through all the lessons those will be much more simple than when you are first learning.
<br><br>
And finally these will not be without errors to begin with and may not be the absolute best way to do anything.  People develop their own programming styles and this is just mine, which tends to be quickly written and not super efficient.
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#main_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;main_tutorial-0__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4150" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>

                <div class="comments" style="display: none;" id="main_tutorial-0__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__1">
                                                        <div class="mdl-card__title"><strong>Dain</strong> posted on 
		
			
				
				Dec 5, 2007 at 7:08:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is a really great idea -- it goes back to the &quot;teach a man to fish&quot; saying, and even if only one person learns enough to create a new game, then it was well worth it for the entire community.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__2">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Dec 5, 2007 at 7:27:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This should be awesome for the community bunnyboy <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-happy.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__3">
                                                        <div class="mdl-card__title"><strong>burnambill333</strong> posted on 
		
			
				
				Dec 5, 2007 at 9:17:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Wow, I am so glad you are doing this. <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> I glanced briefly over lesson 1, which seems like pretty easy stuff I already know. I&apos;ll read over it thoroughly when I get home later today (and ask any questions I may have).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__4">
                                                        <div class="mdl-card__title"><strong>NationalGameDepot</strong> posted on 
		
			
				
				Dec 5, 2007 at 1:38:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am super excited about all this even though I have my doubts of how fair I will make it into the lessons, esp since I will be start work soon and won&apos;t have as much free time again.  Good luck to all on this, and I really hope everyone gives it a chance.
<br>~~NGD
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__5">
                                                        <div class="mdl-card__title"><strong>NewUser123456789</strong> posted on 
		
			
				
				Dec 5, 2007 at 3:49:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Great idea..<br><br>Thank you for taking the time out to do this..<br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__6">
                                                        <div class="mdl-card__title"><strong>Nistle</strong> posted on 
		
			
				
				Dec 5, 2007 at 3:52:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Seems like a really good ideam. Im trying to learn C# right now so this could help me out. 
<br>
<br>Where was lesson 1 posted?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__7">
                                                        <div class="mdl-card__title"><strong>dangevin</strong> posted on 
		
			
				
				Dec 5, 2007 at 5:10:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4147&amp;enterthread=y" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4147&amp;enterthread=y">http://www.nintendoage.com/for...did=4147&amp;enterthread=y</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__8">
                                                        <div class="mdl-card__title"><strong>Stan</strong> posted on 
		
			
				
				May 23, 2008 at 12:59:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey, has someone been reading my SMS tutorial? This runs almost the same as it... Awesome idea though. Very well written, but I&apos;m not sure I&apos;d call this a good tutorial for people with no knowledge. If that&apos;s the case, you REALLY need to explain everything. It might be best to explain what the accumulator does before you introduce assembly, like explain this very basic so people can understand easier. Like have a WHOLE section explaining the MPU system piece by piece. But seriously, very awesome man, a good reference. Would be nice to put it on the main site in some way.&#xA0;&#xA0; Also, I just skimmed some stuff real quick, but you mentioned negative numbers and I didn&apos;t see any indication that you explained signed binary or complements in there.&#xA0; I may have missed it though, and I guess it isn&apos;t really important.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__9">
                                                        <div class="mdl-card__title"><strong>Stan</strong> posted on 
		
			
				
				May 23, 2008 at 9:15:36 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					By the way, buns, if you want to put this on the main site, I&apos;d be happy to help write it and put it together.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__10">
                                                        <div class="mdl-card__title"><strong>Joshi</strong> posted on 
		
			
				
				Mar 15, 2010 at 2:42:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I hope I&apos;m not just too silly, but which assembler is used in this tut? heard of nesasm, would that be good?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__11">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Mar 15, 2010 at 3:29:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					it uses nesasm
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__12">
                                                        <div class="mdl-card__title"><strong>toshi5o3</strong> posted on 
		
			
				
				Jun 23, 2011 at 7:34:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is going to be awesome! Thanks bunnyboy and everyone else that&apos;s helped with this! Cheers!&#xA0;<span class="sprites_emoticons absmiddle" id="emo_beer"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__13">
                                                        <div class="mdl-card__title"><strong>luluxiu</strong> posted on 
		
			
				
				Jun 25, 2011 at 2:22:23 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m not sure I&apos;d call this a good tutorial for people with no knowledge. If that&apos;s the case, you REALLY need to explain everything. It might be best to explain what the accumulator does before you introduce assembly, like explain this very basic so people can understand easier.
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-0__14">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jun 25, 2011 at 2:24:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>luluxiu</b></i><br><br>I&apos;m not sure I&apos;d call this a good tutorial for people with no knowledge. If that&apos;s the case, you REALLY need to explain everything. It might be best to explain what the accumulator does before you introduce assembly, like explain this very basic so people can understand easier.
<br></div><br><br>Go read the actual tutorials, his are fine.
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>


                <div class="spacer"></div>

                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="main_tutorial-1">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">1: 数字系统及核心编程思想</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<font size="+1">Number Systems</font><br>
<b>Decimal 十进制</b><br>
十进制数以 10 为基数。每个数字可以是 0-9。每个数字位都是 10 的幂。左边的每个数字位都是前一个数字位的 10 倍。如果你把数字 10 放在右边，它就变成 100，即 10 倍。把右边的0去掉，就变成1了，少了10倍。<br>
&#xA0;
<pre>100&apos;s place    10&apos;s place    1&apos;s place
    0              0            1         = 001
    0              1            0         = 010
    1              0            0         = 100</pre>
<br>
要获得数字的值，请将每个数字乘以它的位值，然后将它们全部加在一起。<br>
&#xA0;
<pre>100&apos;s place    10&apos;s place    1&apos;s place
    3              8            0         = 3*100 + 8*10 + 0*1 = 380
    0              4            1         = 0*100 + 4*10 + 1*1 = 41</pre>
<br>
<b>Binary 二进制</b><br>
计算机中的一切都是以 2 为基数的二进制完成的。这是因为最底层的计算是一个切换开关；开/关，1/0。<br>
<br>
以 2 为基数的二进制工作方式相同，只不过每个数字可以是 0-1，并且位值是 2 的幂而不是 10。在数字右侧插入 0，数字就会变大 2 倍。去掉一个0，它就会变小​​2倍。<br>
&#xA0;
<pre>8&apos;s place    4&apos;s place    2&apos;s place   1&apos;s place
   0            1            0           0       = 0*8 + 1*4 + 0*2 + 0*1 = 4
   1            1            1           1       = 1*8 + 1*4 + 1*2 + 1*1 = 15</pre>
<br>
NES 是一个 8 位系统，这意味着它使用的是 8 个二进制。8个二进制位是一个字节。举例：<br>
&#xA0;
<pre> Binary    Decimal
00000000 =  0
00001111 =  15
00010000 =  16
10101010 =  170
11111111 =  255</pre>
<br>
这里你需要学会这些转换方法，或者拿计算器搞定这些。8位二进制数据可以表示 0-255。如果比255还大你需要使用2个字节或者更多字节，没有负数，后面会介绍。<br>
<br>
<br>
<b>Hexadecimal 16进制</b><br>
十六进制以 16 为基数，因此每个数字是 0-15，每个数字位置是 16 的幂。问题是 10 及以上的任何数字都需要 2 位数字。为了解决这个问题，使用字母而不是以 A 开头的数字：<br>
&#xA0;
<pre>Decimal   Hex
    0   =  0
    1   =  1
    9   =  9
   10   =  A
   11   =  B
   12   =  C
   13   =  D
   14   =  E
   15   =  F</pre>
<br>
16进制，每个数字位数都是 16 的幂：<br>
&#xA0;
<pre> 16&apos;s place   1&apos;s place
     6           A       = 6*16 + A(10)*1 = 106
     1           0       = 1*16 +     0*1 = 16</pre>
<br>
使用十六进制，私因为写入速度比二进制快。8 位二进制数变成 2 位十六进制数：<br>
&#xA0;
<pre>Binary     01101010
split        |  |
in half     /    \
         0110   1010
into       |     |
 hex       6     A
           |     |
 put       \    /
 back        6A
 <br><br> 01101010 = 6A</pre>
<br>
<br>
举个例子:
<pre>Binary     Hex   Decimal 
00000000 = 00  = 0
00001111 = 0F  = 15
00010000 = 10  = 16
10101010 = AA  = 170
11111111 = FF  = 255</pre>
<br>
可以使用window内置的计算器切换到程序员，里面可以完成各种转换<br>
<br>
使用的时候，二进制通常以 % 为前缀，例如 %00001111。十六进制以 $ 为前缀，如 $2A。其他约定的写法是在二进制数字后加字母 b，如 00001111b，在十六进制后置 h，如 2Ah。<br>
<br>
NES 有 16 位地址总线（稍后会详细介绍），因此它可以访问 2^16 字节的内存。16 个二进制数字变成 4 个十六进制数字，因此 NES 地址会是后面的写法 $8000、$FFFF 和 $4017。<br>
<br>
一条线可以有高低2种电平，表示1或0，16条线可以有 65536 个组合，对应访问不同地址的数据<br>
<br>
<br>
<font size="+1">核心编程概念</font><br>
所有编程语言都具有三个基本概念。它们是指令、变量和控制流。如果缺少这三者中的任何一个，它就不再是真正的编程语言。例如，HTML 没有控制流，因此它不是一种编程语言。<br>
<br>
<b>指令 Instructions</b><br>
指令是处理器运行的最小命令。指令是逐个运行。NES 处理器有 56 条指令。常用的就10个，还有10个可以忽略不管。常用指令有，加载数据，加法，变量值和 0 做判断( 类似 if(x > 0)跳到给定位置执行命令，else 否则执行后面的程序 )。<br>
<br>
<b>变量 Variables</b><br>
变量存储可以修改的数据，如马里奥中的跳跃高度，金币数量等，通常代码里会写成对应的变量名字 MarioHorizPosition 或 Coins 等，便于程序调用修改<br>
<br>
<b>控制流程 Control Flow</b><br>
这里其实说的是条件判断，if满足条件执行A，else不满足条件执行B，还有循环 x 自增，当 x = x + 1 超过了 ff 也就是 255 的时候，x的值会变成 0，判断条件就是 x 是否是0，或者判断 x 是否等于 10 。<br>
<br>
<br>
<br>
<b>NEXT WEEK: basic NES architecture</b>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#main_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;main_tutorial-1__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4147" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>

                <div class="comments" style="display: none;" id="main_tutorial-1__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__1">
                                                        <div class="mdl-card__title"><strong>mb7241</strong> posted on 
		
			
				
				Dec 5, 2007 at 12:34:42 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This reminds me of one of my old programming courses in college.  Fun stuff <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> .
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__2">
                                                        <div class="mdl-card__title"><strong>NationalGameDepot</strong> posted on 
		
			
				
				Dec 5, 2007 at 12:41:56 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I just complete lesson 1, and had a pretty tough time with it.  I don&apos;t know jack shit about this type of stuff but I hope I can learn.
<br>~~NGD
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__3">
                                                        <div class="mdl-card__title"><strong>Little Samson</strong> posted on 
		
			
				
				Dec 5, 2007 at 1:09:24 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is great stuff &#x2014; I was familiar with some of the concepts, but not with how they play into the way the NES runs programs.  I&apos;m looking forward to this series of threads!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__4">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 5, 2007 at 4:32:30 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ahhh my brain hurts.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__5">
                                                        <div class="mdl-card__title"><strong>NewUser123456789</strong> posted on 
		
			
				
				Dec 5, 2007 at 9:26:38 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Great Lesson Bunnyboy..<br><br>I&apos;m looking forward to this..<br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__6">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				Dec 5, 2007 at 11:42:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Great lesson , can&apos;t wait for the next one !
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__7">
                                                        <div class="mdl-card__title"><strong>Shags</strong> posted on 
		
			
				
				Dec 5, 2007 at 12:46:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					this looks like it is going to be very good,<br>&#xA0;can&apos;t wait for the next lesson
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__8">
                                                        <div class="mdl-card__title"><strong>burnambill333</strong> posted on 
		
			
				
				Dec 5, 2007 at 10:43:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, I finally got a chance to go through and read this. It looks good so far Brian. A few questions:
<br>
<br>1 - In scientific mode on windows calculator, what is the &quot;Oct&quot; number system? I&apos;m just curious about this really.
<br>
<br>2 - Can&apos;t binary represent letters as well? For example, on <a href="http://www.nickciske.com/tools/binary.php" target="_blank" original-href="http://www.nickciske.com/tools/binary.php">this site</a> you can convert binary to text and back again, which can hold letters, numbers, and punctuation.
<br>
<br>3 - In assembly language, can variables be named anything? For example, would &quot;MarioHorizPosition&quot; be a valid name for a variable? What are the naming restrictions?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__9">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Dec 6, 2007 at 12:53:24 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><begin quote><i>Originally posted by: <b>burnambill333</b></i>
1 - In scientific mode on windows calculator, what is the &quot;Oct&quot; number system? I&apos;m just curious about this really.</begin></div><br>
Oct is Octal, base 8.  Not really used in computing anymore.  You should be able to figure out how it works based on the descriptions of bin/dec/hex  <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
<br><br>
<div class="FTQUOTE"><begin quote><i>Originally posted by: <b>burnambill333</b></i>
2 - Can&apos;t binary represent letters as well? For example, on <a href="http://www.nickciske.com/tools/binary.php" target="_blank" original-href="http://www.nickciske.com/tools/binary.php">this site</a> you can convert binary to text and back again, which can hold letters, numbers, and punctuation.</begin></div><br>
The <a href="http://www.asciitable.com/" target="_blank" original-href="http://www.asciitable.com/">ascii table</a> is the standard conversion between a number and a letter or other character.  The main benefits of ascii are that the letters are sequential (which seems like an obviously good idea) and you can change between lower case and upper case by adding or subtracting the same number.  One byte holds almost all characters including punctuation.  It is slowly being replaced by unicode, which uses more than one byte so it can do things like Chinese characters.
<br><br>
<div class="FTQUOTE"><begin quote><i>Originally posted by: <b>burnambill333</b></i>
3 - In assembly language, can variables be named anything? For example, would &quot;MarioHorizPosition&quot; be a valid name for a variable? What are the naming restrictions?</begin></div>
You set the name so it can be anything that doesn&apos;t have special characters like spaces or colons.  There are some typical capitalizing conventions for naming which will come in a later lesson, but that again gets into personal style.  Usually function names have the first letters capitalized (MarioJumpUp), variables have first letter not caps (marioVertPos), and constants are all caps (MARIOSPEED).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__10">
                                                        <div class="mdl-card__title"><strong>jimpoleshuk</strong> posted on 
		
			
				
				Dec 6, 2007 at 1:23:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Very Nice BunnyBoy
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__11">
                                                        <div class="mdl-card__title"><strong>Stan</strong> posted on 
		
			
				
				May 29, 2008 at 5:39:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>NationalGameDepot</b></i><br><br>I just complete lesson 1, and had a pretty tough time with it. I don&apos;t know jack shit about this type of stuff but I hope I can learn. <br>~~NGD</div><p><br>N, check out my binary/hex and such tutorial.&#xA0; They apply to all programming and I go into great depth.&#xA0; We need to maybe put this on the main site here somehow over time, it would be a good idea.</p><p><a href="http://www.smstributes.co.uk/view_article.asp?articleid=40" target="_blank" original-href="http://www.smstributes.co.uk/view_article.asp?articleid=40">http://www.smstributes.co.uk/view_article.asp?articleid=40</a></p><p>The first three sections (up through binary math), will tell you all you need to know.&#xA0; There are some SMS references in there, but just to illustrate a bit.&#xA0; Also, buns, maybe we should put together an assembly tutorial starting from real basics.&#xA0; The instruction sets should be illustrated very slowly in my opinion, getting to how they function later, showing &apos;programs&apos; that essentially look like this:</p><p>ld bc, mpdand</p><p>ld b, 8</p><p>ld c, 0</p><p>and so forth, showing essentially fake programs so users learn how to work with fake data before moving on to the real deal.&#xA0; Again, not trying to say anything bad, you&apos;ve done some awesome work here, I think it would be good if it was fleshed out more.</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__12">
                                                        <div class="mdl-card__title"><strong>toshi5o3</strong> posted on 
		
			
				
				Jun 23, 2011 at 7:35:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I completed this lesson last night! woooooo!!! Cheers!&#xA0;<span class="sprites_emoticons absmiddle" id="emo_beer"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__13">
                                                        <div class="mdl-card__title"><strong>Farid</strong> posted on 
		
			
				
				Feb 10, 2012 at 9:57:44 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					First of all thanks for the great tutorial.<br>
<br>
There is a slight typo&#xA0;:<br>
&#xA0;
<div class="FTQUOTE">
	Base 2 binary works the same way, except each digit can be 0-1 and the place values are powers of 2 instead of 10. Insert a 0 to the right of a number and it becomes 2 times bigger. Remove a 0 and it becomes <span style="color: #ff0000">10 times </span>smaller.</div>
<br>
<br>
It must be &quot;2 times&quot; not 10 times. For example :<br>
<br>
1110b = 14d<br>
111b = 7d<br>
<br>
1010b = 10d<br>
101b = 5d<br>
<br>
As you can see removing 0 from right makes the number only 2 times smaller not 10 times.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__14">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 12, 2012 at 11:07:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Kunio</b></i><br>
	<br>
	First of all thanks for the great tutorial.<br>
	<br>
	There is a slight typo&#xA0;:<br>
	&#xA0;
	<div class="FTQUOTE">
		Base 2 binary works the same way, except each digit can be 0-1 and the place values are powers of 2 instead of 10. Insert a 0 to the right of a number and it becomes 2 times bigger. Remove a 0 and it becomes <span style="color: #ff0000">10 times </span>smaller.</div>
	<br>
	<br>
	It must be &quot;2 times&quot; not 10 times. For example :<br>
	<br>
	1110b = 14d<br>
	111b = 7d<br>
	<br>
	1010b = 10d<br>
	101b = 5d<br>
	<br>
	As you can see removing 0 from right makes the number only 2 times smaller not 10 times.</div>
<br>
<br>
I&apos;m thinking this was a binary joke (since %10 = 2).&#xA0; Maybe a tutorial on binary isn&apos;t the best place for it but chances are if you&apos;re prepared to program the NES you&apos;ve had some exposure to binary already.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__15">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 13, 2012 at 3:13:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Kunio is right, it should be 2 times smaller, it must be a binary joke as muffins suggested.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__16">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Feb 13, 2012 at 11:32:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Not a joke, fixed!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__17">
                                                        <div class="mdl-card__title"><strong>mlbfan10</strong> posted on 
		
			
				
				Feb 13, 2012 at 12:19:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Great stuff man! I&apos;m glad you make more sense than my college professors did. I still struggle with programming, if you any pointers on how I can try to improve my comfort zone and ability I would be grateful. I&apos;ve always been intrigued with programming but it is my weakest point.<br>
<br>
edit: found the answer to my question. <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__18">
                                                        <div class="mdl-card__title"><strong>dra600n</strong> posted on 
		
			
				
				Feb 13, 2012 at 12:20:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Shoulda just gone with it bunny <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__19">
                                                        <div class="mdl-card__title"><strong>XYZ</strong> posted on 
		
			
				
				Mar 9, 2013 at 12:31:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Bunnyboy I know this is an old threat but I want to say I really enjoy the nerdy nights series. Thanks for these!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__20">
                                                        <div class="mdl-card__title"><strong>WhiteCastle10</strong> posted on 
		
			
				
				Feb 4, 2016 at 5:49:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve always wanted to make a classic NES game and I&apos;m just now starting in on my development. I know I&apos;ll be referencing this thread a bunch. Thanks again for adding this!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__21">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 4, 2016 at 9:00:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Be sure to ask any questions you&apos;d like in the &quot;Ask all programming questions here!&quot; thread, or any of the Nerdy Nights threads if you&apos;d like!
<br>
<br>Welcome to the site.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__22">
                                                        <div class="mdl-card__title"><strong>Nesmaniac</strong> posted on 
		
			
				
				Jul 26, 2016 at 4:30:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for posting this information. I can&apos;t imagine how many countless hours was spent figuring all this out. I&apos;m thinking about learning all I can about the NES programming in hopes of possibly creating my own NES game someday but even if I don&apos;t I find it fascinating to see a basic concept of how the games I grew up playing actually worked.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__23">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jul 27, 2016 at 2:05:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Best of luck! Its a lot of fun to go through and much more work after you completed the tutorials. I only wish I had more time to program, but I enjoy the time I do.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-1__24">
                                                        <div class="mdl-card__title"><strong>Candied Hat</strong> posted on 
		
			
				
				Jan 8, 2017 at 7:21:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Amazing!<br>
I&apos;m lazy, so I just took your files and ran.<br>
I now realize that you had all those at your website. <span class="sprites_emoticons absmiddle" id="emo_tongue">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>


                <div class="spacer"></div>

                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="main_tutorial-2">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">2: NES 架构概述</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b><a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4147" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4147">Previous week:</a></b> number systems and core programming ideas<br><br>
<b>This week:</b> general overview of the NES architecture with the major components covered.  All general purpose computers are arranged the same way with a place to store code (ROM), a place to store variables (RAM), and a processor to run code (CPU).  The NES also adds another processor to generate the graphics (PPU) and a section of the CPU to generate audio (APU).  Everything here is very general and will have more details than you want in the next few weeks.
<br><br>
<font size="+1">NES System Architecture</font><br>
<br>
<i>KB - Memory size is listed in KiloBytes or KB.  1KB = 1024 bytes.  Everything is powers of 2, so 2^10 = 1024 is used instead of 1000.  If the capitalization is different, the meaning can change.  Kb is Kilobits.  Divide Kb by 8 to get KB, because 1 byte = 8 bits.
<br><br>
ROM - Read Only Memory,  holds data that cannot be changed.  This is where the game code or graphics is stored on the cart.  
<br><br>
RAM - Random Access Memory, holds data that can be read and written.  When power is removed, the chip is erased.  A battery can be used to keep power and data valid.
<br><br>
PRG - Program memory, the code for the game
<br><br>
CHR - Character memory, the data for graphics
<br><br>
CPU - Central Processing Unit, the main processor chip
<br><br>
PPU - Picture Processing Unit, the graphics chip
<br><br>
APU - Audio Processing Unit, the sound chip inside the CPU</i>
<br><br>
<br><br>
<b>System Overview</b>
<br><br>
The NES includes a custom 6502 based CPU with the APU and controller handling inside one chip, and a PPU that displays graphics in another chip.  Your code instructions run on the CPU and sends out commands to the APU and PPU.  The NOAC (NES On A Chip) clones like the Yobo and NEX put all of these parts onto one chip.
<br><br>
<img src original-src="http://www.nesmuseum.com/images/nesarchitecture.png" show-src="scraper/images/nesarchitecture.png"><br>
<img src original-src="http://www.nesmuseum.com/images/nesboard.png" show-src="scraper/images/nesboard.png"><br>
<br>
There is only 2KB of RAM connected to the CPU for storing variables, and 2KB of RAM connected to the PPU for holding two TV screens of background graphics.  Some carts add extra CPU RAM, called Work RAM or WRAM.  If a cart needs to store saved games, this WRAM will have a battery attached to make sure it isn&apos;t erased.  A few carts add extra PPU RAM to hold four screens of background graphics at once.  This is not common.  The rest of this tutorial will not use WRAM or four screen RAM.
<br><br>
Each cart includes at least three chips.  One holds the program code (PRG), another holds the character graphics (CHR), and the last is the lockout.  The graphics chip can be RAM instead of ROM, which means the game code would copy graphics from the PRG ROM chip to the CHR RAM.  PRG is always a ROM chip.
<br><br><br>
<b>Lockout Chip</b><br>
Inside the NES and the cart are also two lockout chips.  The lockout chip controls resetting the console.  First the NES lockout sends out a stream ID, 0-15.  The cart lockout records this number.  Then both lockout chips run a complex equation using that number and send the results to each other.  Both chips know what the other is supposed to send so they both know when something is wrong.  If that happens the system enters the continuous reseting loop.  This is the screen flashing you see with a dirty cart.
<br><br>
When you cut pin 4 of the NES lockout chip, you are making it think it is inside the cart.  It sits there waiting for the ID from the NES which never happens, so the system is never reset.  If you were to completely remove the NES lockout chip the system would not work because it controls the reset button.  
<br><br>
Most lockout defeaters used by the unlicensed game companies used large voltage spikes sent from the cart to the NES lockout.  When timed right those would crash the NES lockout, preventing it from resetting the system.  Nintendo slowly added protection against those on the NES board.  Next time you open your NES, check the board for the revision number.  Right in the middle it will say NES-CPU- then a number.  That number is the revision.  If you have 05 it is an early one.  07 and 09 added some lockout protection.  11 was the last version with the most lockout protection.  Almost all unlicensed carts that use lockout defeaters will not work on a NES-CPU-11 system.
<br><br><br>
<b>CPU Overview</b><br>
The NES CPU is a modified 6502, an 8 bit data processor similar to the Apple 2, Atari 2600, C64, and many other systems.  By the time the Famicom was created it was underpowered for a computer but great for a game system.
<br><br>
The CPU has a 16 bit address bus which can access up to 64KB of memory.  2^16 = 65536, or 64KB.    Included in that memory space is the 2KB of CPU RAM, ports to access PPU/APU/controllers, WRAM (if on the cart), and 32KB for PRG ROM.  The 16 bit addresses are written in hex, so they become 4 digits starting with a $ symbol.  For example the internal RAM is at $0000-0800.  $0800 = 2048 or 2KB.  
32KB quickly became too small for games, which is why memory mappers were used.  Those mappers can swap in different banks of PRG code or CHR graphics.  Mappers like the MMC3 allowed up to 512KB of PRG, and 256KB of CHR.  There is no limit to the memory size if you create a new mapper chip, but 128KB PRG and 64KB CHR was the most common size.  <br>
<br>
<img src original-src="http://www.nesmuseum.com/images/cpumemmap.png" show-src="scraper/images/cpumemmap.png"><br>
<br><br>
<b>PPU Overview</b><br>
The NES PPU is a custom chip that does all the graphics display.  It includes internal RAM for sprites and the color palette.  There is RAM on the NES board that holds the background, and all actual graphics are fetched from the cart CHR memory.
<br><br>
Your program does not run on the PPU, the PPU always goes through the same display order.  You only set some options like colors and scrolling.  The PPU processes one TV scanline at a time.  First the sprites are fetched from the cart CHR memory.  If there are more than 8 sprites on the scanline the rest are ignored.  This is why some games like Super Dodge Ball will blink when there is lots happening on screen.  After the sprites the background is fetched from CHR memory.  When all the scanlines are done there is a period when no graphics are sent out.  This is called VBlank and is the only time graphics updates can be done. PAL has a longer VBlank time (when the TV cathode ray gun is going back to the top of the screen) which allows more time for graphics updates.  Some PAL games and demos do not run on NTSC systems because of this difference in VBlank time.
Both the NTSC and PAL systems have a resolution of 256x240 pixels, but the top and bottom 8 rows are typically cut off by the NTSC TV resulting in 256x224.  TV variations will cut off an additional 0-8 rows, so you should allow for a border before drawing important information.
<br><br>
NTSC runs at 60Hz and PAL runs at 50Hz.  Running an NTSC game on a PAL system will be slower because of this timing difference.  Sounds will also be slower.
<br><br>
<img src original-src="http://www.nesmuseum.com/images/ppumemmap.png" show-src="scraper/images/ppumemmap.png">
<br><br><br><br><br>
<font size="+1">Graphics System Overview</font><br><br>
<b>Tiles</b><br>
All graphics are made up of 8x8 pixel tiles.  Large characters like Mario are made from multiple 8x8 tiles.  All the backgrounds are also made from these tiles.  The tile system means less memory is needed (was expensive at the time) but also means that things like bitmap pictures and 3d graphics aren&apos;t really possible.  To see all the tiles in a game, download <a href="downloads/missing/tilemolester-0.16.zip" target="_blank" original-href="http://www.zophar.net/utilities/download/TileMolester_015a_bin.zip">Tile Molester</a> and open up your .NES file.  Scroll down until you see graphics that don&apos;t look like static.  You can see that small tiles are arranged by the game to make large images.<br>
<b>Sprites</b><br>
The PPU has enough memory for 64 sprites, or things that move around on screen like Mario.  Only 8 sprites per scanline are allowed, any more than that will be ignored.  This is where the flickering comes from in some games when there are too many objects on screen.<br>
<b>Background</b><br>
This is the landscape graphics, which scrolls all at once.  The sprites can either be displayed in front or behind the background.  The screen is big enough for 32x30 background tiles, and there is enough internal RAM to hold 2 screens.  When games scroll the background graphics are updated off screen before they are scrolled on screen. 
<br>
<b>Pattern Tables</b><br>
These are where the actual tile data is stored.  It is either ROM or RAM on the cart.  Each pattern table holds 256 tiles.  One table is used for backgrounds, and the other for sprites.  All graphics currently on screen must be in these tables.<br>
<b>Attribute Tables</b><br>
These tables set the color information in 2x2 tile sections.  This means that a 16x16 pixel area can only have 4 different colors selected from the palette.<br>
<b>Palettes</b><br>
These two areas hold the color information, one for the background and one for sprites.  Each palette has 16 colors.<br><br>
To display a tile on screen, the pixel color index is taken from the Pattern Table and the Attribute Table.  That index is then looked up in the Palette to get the actual color.<br><br>
<img src original-src="http://www.nesmuseum.com/images/pputile.png" show-src="scraper/images/pputile.png">
<br><br><br>
To see all the graphics, download the <a href="http://www.the-interweb.com/serendipity/exit.php?url_id=627&amp;entry_id=90" target="_blank" original-href="http://www.the-interweb.com/serendipity/exit.php?url_id=627&amp;entry_id=90">FCEUXD SP emulator</a>.  Open up your .NES game and choose PPU Viewer from the Tools menu.  This will show you all the active background tiles, all the active sprite tiles, and the color palettes.  Then choose Name Table Viewer from the Tools menu.  This will show you the backgrounds as they will appear on screen.  If you choose a game that scrolls like SMB you can see the off screen background sections being updated.
<br><br><br>
<b>NEXT WEEK:</b> CPU details, start of 6502 assembly programming
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#main_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;main_tutorial-2__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4291" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>

                <div class="comments" style="display: none;" id="main_tutorial-2__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__1">
                                                        <div class="mdl-card__title"><strong>dangevin</strong> posted on 
		
			
				
				Dec 11, 2007 at 1:43:23 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					How do dual-backgrounds work? I guess I get a choice for which one to display first. So for DDR, I can
<br>
<br>1. display Bkgd-1, the &quot;movie&quot; background with &quot;visualizations&quot; and the 4 static arrows at the top of the screen. These would be illuminated with palette swaps. I don&apos;t think they could be scrolled unless there&apos;s a way to always write the static arrows to the same portion of the screen? Perhaps only doing a lateral scroll for the area below them on-screen (after pixel 24-down) if that&apos;s possible?
<br>
<br>...then 2. display Bkgd-2, the stepchart, which scrolls from bottom to top.
<br>
<br>...and 3. display sprites, such as combo counter text, &quot;Perfect&quot; or &quot;Great&quot; feedback, etc.
<br>
<br>and that will effectively do what I want to do? This allows for big 4x4 tile arrows, an unlimited number of steps onscreen (well, as opposed to using sprites) and I can still get the arrows to flash wth the beat by palette-swapping them during vblank when I scroll.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__2">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Dec 11, 2007 at 3:35:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There is only one layer of background, the 2 screens worth are arranged next to each other either vertically or horizontally.  They cannot be placed on top of each other.  What you can do is switch between those 2 screens part way down the screen.  The SMB screen is a good example of this.  The status bar is fixed at the top, not scrolling.  Then when the last scanline is drawn the game switches to the game background, which does scroll. Yes this may be more confusing  <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> <br><br><br><br>For DDR you will have to limit the arrow sizes to avoid the 8 sprites per scanline limit.  You need 4 static arrows, so if you used sprites they could only be 2x2 tiles maximum.  You will also need the stepchart, which could have more than 2 arrows horizontally (start of two arrows overlapping end of two others).  So if those used sprites it couldn&apos;t be more than 2x2 tiles.  You only get 64 sprites so if the stepchart was sprites there could only be 16 steps on screen.  You want the static arrows to be on top of the stepchart so they can&apos;t both use the background.<br><br>
I would do the non scrolling status bar like SMB, either at the top or bottom depending on which way the stepchart scrolls.  Then you have the stepchart as a scrolling background.  Since it is background you can do those arrows as big as you want.  The screen is only ~28 tiles tall, so you probably don&apos;t want arrows bigger than 2x2 or not enough will be on screen.    When the step is hit correctly, you erase the arrow from the background.  Then you have the static arrows as sprites.  They can either be in front or behind the stepchart arrows.  And finally more sprites for the ok/good/great messages, because those also do not scroll and will be in front of the stepchart.<br><br>If you wanted 2 player then you could do stepchart as 2x2 arrows, then use 1x1 for the static arrows so there can be 8 across.  The static ones would be centered horiz on the stepchart ones.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__3">
                                                        <div class="mdl-card__title"><strong>dangevin</strong> posted on 
		
			
				
				Dec 11, 2007 at 9:30:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<a href="http://www.crypticalley.com/files/images/ddr-screenshot.JPG" target="_blank" original-href="http://www.crypticalley.com/files/images/ddr-screenshot.JPG">DDR Screenshot</a>
<br>
<br>Take note of the green/blue arrows, the usable screen space is about 6 arrows including static ones. At 32 pixels you can fit 7 onscreen, the same dimensions as real DDR. I fear 16 pixel arrows might be too small.
<br>
<br>How about getting tricky with alternating sprite displays? Displaying every other tile for the four arrows each refresh. 
<br>
<br><img src original-src="http://img116.imageshack.us/img116/5488/ddraa1.gif" show-src="images/missing/ddraa1.gif">
<br> 
<br>They&apos;ll flicker but it will be uniform and it might produce an interesting effect if they&apos;re put over the background, a transparent effect. How many refreshes does the NES display per second? This (really rough) demo gif looks to be about 6-8fps on my browser. Is there enough time to update all 32 of these tiles plus other sprites during vblank? 
<br>
<br>The other option if this looks like crap is to only draw parts of the arrows. This configuration only has 6 sprites per line and still gives you the visual cue you need.
<br>
<br><img src original-src="http://img444.imageshack.us/img444/7823/ddremptyarrowpc7.gif" show-src="images/missing/ddremptyarrowpc7.gif">
<br>
<br>Although 2player mode is possible with a four-score I don&apos;t think I&apos;ll be programming that into this first foray, I&apos;ve got better ideas for the other half of the screen <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> And really, thinking of the target market, I think two player capability is superfluous for this release. Who&apos;s going to invite their buddy over for a rousing game of 2-play 8-bit DDR? <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> They can take turns, damnit! The most likely user is going to just be holding two control pads, sitting on their ass and playing using thumbs-on-d-pads to listen to the tunes <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__4">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Dec 12, 2007 at 12:30:05 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><begin quote><i>Originally posted by: <b>dangevin</b></i>
 How many refreshes does the NES display per second?</begin></div><br>
NES is 60 fps on NTSC, 50 fps on PAL.  Any flickering will just look annoying.  When games have lots of stuff on screen they will reorder sprites so the same one isn&apos;t always hidden but you should be able to avoid that.
<br><br><br><br><div class="FTQUOTE"><begin quote><i>Originally posted by: <b>dangevin</b></i>
Is there enough time to update all 32 of these tiles plus other sprites during vblank? </begin></div><br>
Wait for week 4!  <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-wink.gif" show-src="images/blank.gif">  On NTSC you have enough vblank time to update all 64 sprites, and about 3 rows or columns of background.  Your game should only have to update a maximum of 1 row for stuff scrolling in, then maybe another row worth for status bar and erasing step chart arrows that were hit.  Some games like Battletoads will turn the screen on late or turn it off early to get more vblank time.
<br><br>
<div class="FTQUOTE"><begin quote><i>Originally posted by: <b>dangevin</b></i>
Although 2player mode is possible with a four-score I don&apos;t think I&apos;ll be programming that into this first foray</begin></div>
If you are sticking to 1 player, you can rotate everything 90 degrees and have the step chart scrolling from right to left.  That way on a scanline there are only 4 sprites for one large static arrows.  It will also give you more look ahead from the longer screen and not having the status bar in the way.  Only thing to make sure is that the ok/good/great either use 4 or fewer sprites, or just go on a line that doesnt have static arrows.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__5">
                                                        <div class="mdl-card__title"><strong>burnambill333</strong> posted on 
		
			
				
				Dec 13, 2007 at 5:00:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So wait...SMB can hold only of 512x240 pixels of background data at a time? So as I&apos;m scrolling through the level, they continually update as I&apos;m running along?
<br>
<br>How does the background data update? Does each individual pixel update, or does it update in increments of X amount of pixels at a time?
<br>
<br>Also, I assume the audio data is stored in PRG correct? Only graphics (background and sprite) are stored in CHR, right?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__6">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Dec 13, 2007 at 7:43:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><begin quote><i>Originally posted by: <b>burnambill333</b></i><br><br>So wait...SMB can hold only of 512x240 pixels of background data at a time? So as I&apos;m scrolling through the level, they continually update as I&apos;m running along?</begin></div>
<br>
Exactly, the background data that is off screen gets updated so you don&apos;t see it changing on screen.
<br><br>
<div class="FTQUOTE"><begin quote><i>Originally posted by: <b>burnambill333</b></i>
How does the background data update? Does each individual pixel update, or does it update in increments of X amount of pixels at a time?</begin></div>
Background updates are done by tiles, so an 8x8 pixel tile is changed.  When a game is scrolling horizontally there will be one vertical column of tiles to update for every 8 pixels scrolled.  SMB looks like it is keeping 16 columns ahead off screen correct, or 8 columns of its brick sized blocks.  Using the <a href="http://www.the-interweb.com/serendipity/exit.php?url_id=627&amp;entry_id=90" target="_blank" original-href="http://www.the-interweb.com/serendipity/exit.php?url_id=627&amp;entry_id=90">FCEUXD SP debugger</a> you can see it in action.  First download the <a href="http://www.nespowerpak.com/smb.nes" target="_blank" original-href="http://www.nespowerpak.com/smb.nes">SMB/DH game</a> and load it up in FCEUXD. Before choosing SMB, open the Name Table Viewer in tools menu, and the Debug in the tools menu.  In the 6502 Debugger window press the Add... button below breakpoints.  Type 8082 into the first Address field and click the Execute checkbox.  Hit OK.  This tells the emulator to stop when the code reaches memory address $8082, which happens once per frame in SMB.  You can now select SMB.  The screen will stop at all black.  Now continually click the Run button in the debugger to see the screen being updated.  You will have to click 60 times for one second of game play.  Once the demo starts running you will be able to watch new background being added as mario scrolls.  I would bet the 8 block look ahead is why a turtle can go off screen and come back if there is something out of view to bounce off.
<br><br> 
<div class="FTQUOTE"><begin quote><i>Originally posted by: <b>burnambill333</b></i>
Also, I assume the audio data is stored in PRG correct? Only graphics (background and sprite) are stored in CHR, right?</begin></div>
Yes audio data is in the PRG.  Sounds are all generated by software, anything prerecorded is low quality (Get The Spellbook!).  CHR is only used for graphics, except in some really crazy cases like Racermate when it is used for save files.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__7">
                                                        <div class="mdl-card__title"><strong>burnambill333</strong> posted on 
		
			
				
				Dec 13, 2007 at 8:37:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Cool dude. Do you have to program the background data to update, or will it do that automatically? I imagine that you need to program the game to scroll, and it will work automatically after that. I remember reading some nesdev forums a while back and scrolling seems to be a difficult thing to program.
<br>
<br>I think I had another question but I can&apos;t think of it right now. So far it all makes sense to me. I&apos;ll probably get lost at about week 4 or 5 <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-happy.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__8">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Dec 13, 2007 at 9:39:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You have to program EVERYTHING  <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">  Pretty much nothing happens automatically.  Scrolling isn&apos;t too difficult, it just takes extra work to calculate which column to update.  But for this tutorial there will be no scrolling just to take out one more point of possible confusion.  I always say the first game you write should be single screen.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__9">
                                                        <div class="mdl-card__title"><strong>collectinisgame</strong> posted on 
		
			
				
				Apr 4, 2008 at 3:47:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					i&apos;m trying to find the programs to download to get started <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
<br>
<br>any links?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__10">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Apr 5, 2008 at 12:14:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think week 3 has the downloads in it
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__11">
                                                        <div class="mdl-card__title"><strong>collectinisgame</strong> posted on 
		
			
				
				Apr 5, 2008 at 12:17:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					cool, thnx
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__12">
                                                        <div class="mdl-card__title"><strong>Joshi</strong> posted on 
		
			
				
				Mar 16, 2010 at 11:45:46 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					can&apos;t get, how the graphics are made <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-sad.gif" show-src="images/blank.gif">
<br>in the pattern table, the 8*8 tile is stored, and it contains 64 bits (every bit contains information bout the color) ??
<br>
<br>and then in the attribute table, are there more information about the color and this is added to the pattern table?
<br>
<br>so e.g. in pattern table first pixel has &quot;5&quot; and by the attribute table &quot;2&quot; is added, so the final pixel is in &quot;7&quot; (white) and in the position that is set in the pattern table???
<br>
<br>sry for complicated question, hope someone can help me or at least understand what i want to know ^^
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__13">
                                                        <div class="mdl-card__title"><strong>arch_8ngel</strong> posted on 
		
			
				
				Mar 16, 2010 at 11:51:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					^^^ There are 2 bits per pixel.  Otherwise everything would be monochrome, since a single bit can only contain a 1 or a 0.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__14">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Mar 16, 2010 at 12:11:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					In the 8x8 tiles, the pixles are specified with colors 1-4 of the pallette you specify.
<br>
<br>There are 4 background palletts (of 4 colors each) that can be active at one time.  
<br>
<br>So, the tile can be displayed with any of the 4 active palletts.
<br>
<br>It is not additive or multiplicitive like you&apos;re suggesting.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__15">
                                                        <div class="mdl-card__title"><strong>toshi5o3</strong> posted on 
		
			
				
				Jun 23, 2011 at 7:40:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Lesson 2 completed today! Cheers!&#xA0;<span class="sprites_emoticons absmiddle" id="emo_beer"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__16">
                                                        <div class="mdl-card__title"><strong>farmerdwight</strong> posted on 
		
			
				
				Sep 1, 2012 at 10:08:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Question about this line of text near the beginning:
<br>
<br>&quot;Divide Kb by 8 to get KB, because 1 byte = 8 bits.&quot;
<br>
<br>Should that be &quot;Divide KB by 8 to get Kb&quot;?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__17">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Sep 1, 2012 at 10:42:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					no, you take 8 kilobits (8kb) divide that by 8 and you get 1kiloByte (1KB)<br>
<br>
---Edited for a mundane comparison to help clarify ---<br>
<br>
Imagine that kilobits are like pennies and that KiloBytes are like dollars. now you have 100 pennies, if you divided that by 100 you get $1 but in computer memory schemes (most not all as there are others) it&apos;s in 8&apos;s instead of 10&apos;s or 100&apos;s<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__18">
                                                        <div class="mdl-card__title"><strong>farmerdwight</strong> posted on 
		
			
				
				Sep 1, 2012 at 11:19:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					&quot;no, you take 8 kilobits (8kb) divide that by 8 and you get 1kiloByte (1KB)&quot;<br>
<br>
That&apos;s definetly not right cause if you take 8 Kb and divide that by 8, you get 1 Kb.<br>
<br>
1 KB (byte) is equal to 8 Kb (bits). &#xA0;So 1 Byte is equal to 8 bits. &#xA0;So you divide 1 Byte by 8 and you get 1 bit. &#xA0;So if you divide 1 KB by 8, you get 1 Kb.<br>
<br>
&#xA0;<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__19">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Sep 1, 2012 at 11:40:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					technically yes, but you&apos;re failing to get the basic point. The basic point it to quickly calculate kb to KB. 8kb = 1KB so if you had 32kb and wanted to know how many KB you have take 32 and divide it by 8, you get 4. that means 32kb is the same as 4KB. Rather than doing it the long way and going 8, 16, 24, 32 in 8 kb increments it&apos;s faster and easier to do the divide by method.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__20">
                                                        <div class="mdl-card__title"><strong>farmerdwight</strong> posted on 
		
			
				
				Sep 1, 2012 at 11:57:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					lol, well actually I believe I do indeed get the <em>basic</em>&#xA0;point that a Byte is bigger than a bit by a factor of 8 to which your initial response stated otherwise and had me going for a second wondering if I was getting dyslexic or something. &#xA0;I&apos;m sure the tutorial just has a minor typo then.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__21">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Sep 2, 2012 at 12:51:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					1. &quot;Divide Kb by 8 to get KB, because 1 byte = 8 bits.&quot;<br>
<br>
2. Should that be &quot;Divide KB by 8 to get Kb&quot;?<br>
<br>
Nothing is wrong in line 1. Your reply to line 2 is wrong though. You would multiply KB by 8 to figure out the number of Kb in the chip. No typo at all.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__22">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Sep 2, 2012 at 12:56:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					if you said that then I believe it&apos;s safe to assume that you haven&apos;t taken any computer courses. BB&apos;s tuts have a basic belief that you have some understanding of the computer just not the ASM code structure so he only did a quick recap to refresh our brains. Let me give you a quick lesson in Binary (this may not actually be that quick FYI) 
<br>
<br>first I need to re-teach you how to count. Humans count in a system called Base 10, it consists of the numbers 0-9. why? it is believed that counting originated from the number of fingers on our hands and that&apos;s how many fingers most humans have. So we start at 0 (nothing) and add 1
<br>0+1=1 then we continue this process
<br>1+1=2
<br>... until we reach 9 then we add 1 more and OH NO we don&apos;t have any more numbers!! what do we do? Well we shift, recycle, and repeat
<br>09+1=10. This process goes on for infinity. Now lets talk computer numbers and counting. Computers instead count in a system known as Base 2, also called Binary. This means they only have 2 numbers, 0 and 1. This is because the computer uses electric pulses to count and the only way to do this is if wither the electric current is on or off (1 and 0 respectively) So the computer starts at 0 then adds 1 0+1=1 then if it wishes to count higher it adds 1 again 1+1=? OH NO we ran out of numbers in computer counting! so we shift, recycle and repeat just like how we count 01+1=10 (to the normal person going from 1 to 10 looks bizarre, but this is how the computer works, in reality that 10 if converted to our counting scheme is 2) So we keep doing this 10+1=11 (11 in binary = 3) Each individual 0 or 1 is known as a bit.
<br>
<br>I hope so far you are understanding this
<br>Now, way back in the beginning of electronic computing they needed a way to fixate these individual 1&apos;s and 0&apos;s and group them together and use them. So it was decided that they would take 8 of them and use those 8 to translate it into numbers, letters and special characters (now they use 32 because of the inclusion of foreign languages but that&apos;s another lesson) these 8 bits grouped together is called a byte (it&apos;s literally a joke, the word bit could be like I bit someone, so the byte is like I bite into something. but because bite could be accidentally mistyped as bit they changed the spelling to byte) 
<br>
<br>now lets do a binary map with a binary number underneath 
<br>128 64 32 16 8 4 2 1
<br>..1..0..0..1.1.1.1.0  or 10011110 
<br>if you notice, on the right side the chart starts with 1, each instance after that is double the previous number, why? because it&apos;s base 2, our base 10 systems works in a similar way, but because it&apos;s base 10 the number is multiplied by 10. (see the correlation? base 2 multiplied by 2, base 10 multiplied by 10  1&apos;s 10&apos;s 100&apos;s etc...)
<br>
<br>Now with this simple chart we can translate what the binary number, or Byte, equal in our own system by adding the correlating numbers above the 1&apos;s from the binary number to the chart. 128+16+8+4+2=158  
<br>now I want you to add up all those numbers on the chart, what does it equal? the maximum number is 255. This next thing is rather important, that is the highest countable value of a byte but in computing WE ALWAYS start with 0, so there are 256 possibilities, but the highest number is 255. (being able to do this math is useful for many things in computing but for now that&apos;s all you need to know about binary)
<br>
<br>now we get into higher numbers, what is a kilo? kilo is the metric term meaning 1,000. but the metric system is in base 10 and computers are in base 2. this means we can&apos;t have what we consider an even 1,000 when we have a kilo of a computer measurement. because of this we take the base 2 and use the kilo to multiply it to the 10th power ( 2^10, or 2*2*2*2*2*2*2*2*2*2) and that gives us a number of 1024 bits. so 1kilobit = 1024 bits. now if we want to figure out how many Bytes there are in a kilobit we know that every 8 bits = 1 Byte, so 1024/8= 128. so there are 128B in 1kb. now lets get into even higher numbers. a kiloByte is like saying 1,000 bytes, but as noted earlier we can&apos;t use that number exactly. A kiloByte is 2^10 Bytes. or 1024 Bytes each byte is 8 bits so if we wanted to break that down into individual bits we multiply it by 8 so 1024*8=8192 bits in a kiloByte. (I know, this math is really weird to get the hang of)
<br>
<br>now just like how you can take 8 bits and make a byte, the same thing is true for the kilo version, 8kilobits = 1kiloByte. 
<br>Now we get to the point I was trying to make, it takes 8 small units to make 1 big unit. the math just so happens to come out that if you take 8 and divide by 8 you get 1 so when you have all of those small units, if you divide by 8 it will show you how many of the big units you have. let&apos;s say you have 72kilobits let&apos;s divide that by 8, 72/8=9. so 72 kilobits is = to 9kiloBytes. 
<br>
<br>does the tutorial have a typo? No, it doesn&apos;t. It&apos;s just that people aren&apos;t wired to inertly understand binary conversions.
<br>back to my penny description it takes 100 pennies to make a dollar, 100/100 equals 1 but instead of saying it equals 1 penny i&apos;m saying that 100 pieces out of 100 pieces equals 1 whole or a dollar
<br>
<br> I know this was a ramble and at least I hope it taught you something or at least peeked your curiosity to learn more about computers.
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__23">
                                                        <div class="mdl-card__title"><strong>farmerdwight</strong> posted on 
		
			
				
				Sep 2, 2012 at 7:47:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ah i see what you were getting at there in your initial response jc.  The wording just threw me off cause, yes, dividing 8 bits by 8 will yield a single bit but dividing the NUMBER of bits by 8 will yield the number of bytes.  All is clear now, appreciate your help you two!<br><br>Fyi i dont think jc or the tutorial had poor wording.  Just my weird interpretation.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__24">
                                                        <div class="mdl-card__title"><strong>vegeta4ss</strong> posted on 
		
			
				
				Sep 7, 2012 at 11:10:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					this is a wonderful wealth of information. Still trying to figure out how the palette color indexes work. Hopefully it will be a topic covered in future tutorials because the little diagram didn&apos;t do it for me.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__25">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Sep 7, 2012 at 11:29:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Do you have specific questions?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__26">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Sep 8, 2012 at 3:51:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=6082" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=6082">http://www.nintendoage.com/forum/...</a>
<br>Nerdy Nights - Week 4 (Color Palettes, Sprites, Second App)
<br><span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__27">
                                                        <div class="mdl-card__title"><strong>vegeta4ss</strong> posted on 
		
			
				
				Sep 19, 2012 at 12:58:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=6082" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=6082">http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;am...</a> <br>
	Nerdy Nights - Week 4 (Color Palettes, Sprites, Second App)</div>
<br>
You beat me to it. This is the lesson I am working on now. My earlier post can be ignored.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__28">
                                                        <div class="mdl-card__title"><strong>HiQConsoul</strong> posted on 
		
			
				
				Jun 21, 2013 at 7:42:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<a href="http://www.nesmuseum.com/images/pputile.png" target="_blank" original-href="http://www.nesmuseum.com/images/pputile.png">http://www.nesmuseum.com/images/p...</a><br>
<br>
.... what... the hell... is going on here?...... <span class="sprites_emoticons absmiddle" id="emo_sad"></span><br>
<br>
0+1=4?.. wat?!?! --- essentially the +1 is making me go &apos;waaaat?!?!&apos; most of all..&#xA0;<br>
0+1*2upperbits&amp;lowerbits, so this = 4 sure sure.. but.. ... what????<br>
<br>
the 2 +1*2upper&amp;lower makes 6, so seems to fit fine.. but.... .. what?! (doesnt seem to fit with all the other info.. I dunno..)<br>
<br>
(been sittin here 20 mins lookin at it feeling my brain tie up into a supercurly knot.. q.q .. <span class="sprites_emoticons absmiddle" id="emo_smile"></span> )<br>
<br>
(note, i r nubish@this..)<br>
<br>
- it seems like it&apos;s extremely simple to understand, so moving past this without figuring it out makes me feel like Im ignoring a chest that takes a very easy jump just cuz I cant find the right pixel to jump from.. which imo *should* be there...<br>
something like that anyway..
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__29">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jun 21, 2013 at 8:04:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					O the left is the pixel data, bits are from 0 to 3. He adds the attribute value*4 to basically &quot;adjust&quot; the output numbers for the tile, basically to show how other colors are chosen. Think of it as a math equation, except with an array.<br>
<br>
TileColor+(Palette*4)=Final Color.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__30">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jun 22, 2013 at 3:25:31 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					PatternTableEntry is 2 bits
<br>AttributeTableEntry is 2 bits
<br>
<br>ColorIndex = (AttributeTableEntry &lt;&lt; 2) + PatternTableEntry
<br>
<br>&lt;&lt; is a &quot;bit shift left&quot; operator
<br>
<br>In the example, PatternTableEntry is 2, AttributeTableEntry is 1, thus:
<br>
<br>ColorIndex = (1 &lt;&lt; 2) + 2 = 4 + 2 = 6
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__31">
                                                        <div class="mdl-card__title"><strong>HiQConsoul</strong> posted on 
		
			
				
				Jun 24, 2013 at 8:05:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I love you <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__32">
                                                        <div class="mdl-card__title"><strong>fawfulmark2</strong> posted on 
		
			
				
				Aug 1, 2013 at 2:22:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok, so I&apos;ve been writing these guides down inside a notebook,and I need toknow: can I get a listof what exactly the 16 colors used in the example chart are? like I know #7 is white but what about the rest?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__33">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Aug 1, 2013 at 2:30:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Rephrase the question? The colors are viewable in fceux. But still, the exact colors don&apos;t really matter...or at least I see no purpose to needing to know what they are...I mean, the palette data is in the file.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__34">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Aug 1, 2013 at 2:52:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>fawfulmark2</b></i><br>
	<br>
	Ok, so I&apos;ve been writing these guides down inside a notebook,and I need toknow: can I get a listof what exactly the 16 colors used in the example chart are? like I know #7 is white but what about the rest?</div>
Your code picks the 16 color palette, so that number/color chart is not something to memorize.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__35">
                                                        <div class="mdl-card__title"><strong>Tommy The Cat</strong> posted on 
		
			
				
				Sep 3, 2013 at 3:10:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Question: The first table above shows a layout of the various addresses and what they are for. The second table goes into further detail for $0000 thru $3FFF and shows $2000 thru $23C0 as being a name table of 30x32 tiles.
<br>
<br>1) What exactly is a name table? (I&apos;m not a programmer)
<br>
<br>2) How come later on in the tutorial specific values/settings are stored in the low $2000&apos;s? These don&apos;t seem to be related to tiles.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__36">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Sep 3, 2013 at 3:26:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Tommy The Cat</b></i><br>
	<br>
	Question: The first table above shows a layout of the various addresses and what they are for. The second table goes into further detail for $0000 thru $3FFF and shows $2000 thru $23C0 as being a name table of 30x32 tiles.<br>
	<br>
	1) What exactly is a name table? (I&apos;m not a programmer)<br>
	<br>
	2) How come later on in the tutorial specific values/settings are stored in the low $2000&apos;s? These don&apos;t seem to be related to tiles.</div>
<br>
1) A name table is basically the background for one full screen.<br>
<br>
2) The name table starting at $2000 is in the PPU, the values written to the low $2000&apos;s are in the CPU. You can&apos;t write directly to the PPU, or read from it.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__37">
                                                        <div class="mdl-card__title"><strong>Baka94</strong> posted on 
		
			
				
				Apr 4, 2014 at 12:28:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<img src original-src="http://www.nesmuseum.com/images/pputile.png" show-src="scraper/images/pputile.png"><br>
	&#xA0;</div>
<br>
Can someone explain what Attribute Table does to the Pattern Table Entry to change 0 to 4, 1 to 5 and 2 to 6.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__38">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 4, 2014 at 1:30:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The pattern table for that example is using attribute table 1 (remember, we&apos;re using hex here), which basically means it&apos;s only using colors 4-7.  (Attribute table 0 would use 0-3, Attribute table 2 would use 8-11, etc).
<br>
<br>The pattern table numbers are showing which color each pixel is using from that attribute table.
<br>
<br>The 0s are using the first color out of the second set of attribute colors, which would be color 4 (or black).
<br>The 1s are using the second color out of the second set of attribute colors, which would be color 5 (or red).
<br>The 2s are using the third color out of the second set of attribute colors, which would be color 6 (or yellow).
<br>If there were any 3s, it would use white.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__39">
                                                        <div class="mdl-card__title"><strong>HerpDerpDerp</strong> posted on 
		
			
				
				May 17, 2014 at 11:30:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Maybe I&apos;m missing something but what would the possible benefit to having CHR as RAM be? Aren&apos;t you just adding a step for the program to copy the data from PRG before it can send sprites to the PPU? Wouldn&apos;t that be worse overall for the game?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__40">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 17, 2014 at 11:33:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You can upload graphics on a per-level or per-area basis in your engine is a good one. Animate graphics using less memory in total, and other cool effects like changing all chars by uploading 1 tile instead of changing all the tiles, or swapping a whole bank.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__41">
                                                        <div class="mdl-card__title"><strong>HerpDerpDerp</strong> posted on 
		
			
				
				May 17, 2014 at 11:43:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have a couple other questions. Is the information on the cart viewed as part of the CPU by the console? I see it on the CPU map diagram. Also, if I keep making bigger and bigger cartridges won&apos;t they eventually push the system too far? Like how Action 52 and other multicarts can overheat?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-2__42">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 17, 2014 at 11:52:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There are 2 separate computers in the NES. One is the PRG-ROM, which only sees the CPU ROM. The other is the CHR-ROM, which is used by the PPU for the graphics. BUT if RAM is here, the CPU and upload data to the PPU-RAM. But, they are 2 entirely separate computers. And no, the hardware can do what it can do and that is the limit, cart size can get to as big as you ever need it. The heat problem is entirely bad cart hardware design, nothing about the limits of the system, there are systems in place in the chips and such to make sure even big hardware doesn&apos;t use that much power.
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>


                <div class="spacer"></div>

                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="main_tutorial-3">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">3: 6502 ASM, 第一个程序</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4291" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4291">Previous Week</a> - NES architecture overview<br><br>
<b>This Week:</b> starts getting into more details about the 6502 and
intro to assembly language. The lessons for asm usage and NES specifics
will be done in sections together. There are many other 6502 <a href="http://www.obelisk.demon.co.uk/6502/" target="_blank" original-href="http://www.obelisk.demon.co.uk/6502/">websites</a> and good books which may help you learn better.<br><br><br><br><font size="+2">6502 Assembly</font><br>
<i>Bit - The smallest unit in computers.  It is either a 1 (on) or a 0 (off), like a light switch. <br><br>
Byte - 8 bits together form one byte, a number from 0 to 255. Two bytes
put together is 16 bits, forming a number from 0 to 65535. Bits in the
byte are numbered starting from the right at 0.<br><br>
Instruction - one command a processor executes. Instructions are run sequentially.</i>
<br><br>
<font size="+1">Code Layout</font><br>
In assembly language there are 5 main parts. Some parts must be in a
specific horizontal position for the assembler to use them correctly.<br><br>
<b>Directives</b><br>
Directives are commands you send to the assembler to do things like
locating code in memory. They start with a . and are indented. Some
people use tabs, or 4 spaces, and I use 2 spaces. This sample directive
tells the assembler to put the code starting at memory location $8000,
which is inside the game ROM area:<br>
<pre>  .org $8000</pre>
<br>
<b>Labels</b><br>
The label is aligned to the far left and has a : at the end. The label
is just something you use to organize your code and make it easier to
read. The assembler translates the label into an address. Sample label:<br>
<pre>  .org $8000<br>MyFunction:<br></pre>
When the assembler runs, it will do a find/replace to set MyFunction to
$8000. The if you have any code that uses MyFunction like:<br>
<pre>  STA MyFunction<br></pre>
It will find/replace to:<br>
<pre>  STA $8000<br></pre><br>
<b>Opcodes</b><br>
The opcode is the instruction that the processor will run, and is
indented like the directives. In this sample, JMP is the opcode that
tells the processor to jump to the MyFunction label:<br>
<pre>  .org $8000<br>MyFunction:<br>  JMP MyFunction<br></pre><br>
<b>Operands</b><br>
The operands are additional information for the opcode. Opcodes have
between one and three operands. In this example the #$FF is the operand:<br>
<pre>  .org $8000<br>MyFunction:<br>  LDA #$FF<br>  JMP MyFunction<br></pre><br>
<b>Comments</b><br>
Comments are to help you understand in English what the code is doing.
When you write code and come back later, the comments will save you.
You do not need a comment on every line, but should have enough to
explain what is happening. Comments start with a ; and are completely
ignored by the assembler. They can be put anywhere horizontally, but
are usually spaced beyond the long lines.<br>
<pre>  .org $8000<br>MyFunction:        ; loads FF into accumulator<br>  LDA #$FF<br>  JMP MyFunction<br></pre>
This code would just continually run the loop, loading the hex value $FF into the accumulator each time.<br>
<br><br><br><font size="+1">6502 Processor Overview</font><br>
The 6502 is an 8 bit processor with a 16 bit address bus. It can access
64KB of memory without bank switching. In the NES this memory space is
split up into RAM, PPU/Audio/Controller access, and game ROM.<br>
<pre>$0000-0800 - Internal RAM, 2KB chip in the NES<br>$2000-2007 - PPU access ports<br>$4000-4017 - Audio and controller access ports<br>$6000-7FFF - Optional WRAM inside the game cart<br>$8000-FFFF - Game cart ROM<br></pre>
Any of the game cart sections can be bank switched to get access to
more memory, but memory mappers will not be included in this tutorial.<br><br><br><br>
<font size="+1">6502 Assembly Overview</font><br>
The assembly language for 6502 starts with a 3 character code for the
instruction &quot;opcode&quot;. There are 56 instructions, 10 of which you will
use frequently. Many instructions will have a value after the opcode,
which you can write in decimal or hex. If that value starts with a #
then it means use the actual number. If the value doesn&apos;t have then #
then it means use the value at that address. So LDA #$05 means load the
value 5, LDA $0005 means load the value that is stored at address $0005.<br><br><br><br><font size="+1">6502 Registers</font><br>
A register is a place inside the processor that holds a value. The 6502
has three 8 bit registers and a status register that you will be using.
All your data processing uses these registers. There are additional
registers that are not covered in this tutorial.<br><br>
<b>Accumulator</b><br>
The Accumulator (A) is the main 8 bit register for loading, storing,
comparing, and doing math on data. Some of the most frequent operations
are:<br>
<pre>LDA #$FF  ;load the hex value $FF (decimal 256) into A<br>STA $0000 ;store the accumulator into memory location $0000, internal RAM<br></pre><br>
<b>Index Register X</b><br>
The Index Register X (X) is another 8 bit register, usually used for
counting or memory access. In loops you will use this register to keep
track of how many times the loop has gone, while using A to process
data. Some frequent operations are:<br>
<pre>LDX $0000 ;load the value at memory location $0000 into X<br>INX       ;increment X   X = X + 1<br></pre><br>
<b>Index Register Y</b><br>
The Index Register Y (Y) works almost the same as X. Some instructions
(not covered here) only work with X and not Y. Some operations are:
<pre>STY $00BA ;store Y into memory location $00BA<br>TYA       ;transfer Y into Accumulator<br></pre><br>
<b>Status Register</b><br>The Status Register holds flags with
information about the last instruction. For example when doing a
subtract you can check if the result was a zero. <br><br><br><br><font size="+1">6502 Instruction Set</font><br>
These are just the most common and basic instructions. Most have a few
different options which will be used later. There are also a few more
complicated instructions to be covered later.<br><br>
<b>Common Load/Store opcodes</b><br>
<pre>LDA #$0A   ; LoaD the value 0A into the accumulator A<br>           ; the number part of the opcode can be a value or an address<br>           ; if the value is zero, the zero flag will be set.<br><br>LDX $0000  ; LoaD the value at address $0000 into the index register X<br>           ; if the value is zero, the zero flag will be set.<br><br>LDY #$FF   ; LoaD the value $FF into the index register Y<br>           ; if the value is zero, the zero flag will be set.<br><br>STA $2000  ; STore the value from accumulator A into the address $2000<br>           ; the number part must be an address<br><br>STX $4016  ; STore value in X into $4016<br>           ; the number part must be an address<br><br>STY $0101  ; STore Y into $0101<br>           ; the number part must be an address<br><br>TAX        ; Transfer the value from A into X<br>           ; if the value is zero, the zero flag will be set<br><br>TAY        ; Transfer A into Y<br>           ; if the value is zero, the zero flag will be set<br><br>TXA        ; Transfer X into A<br>           ; if the value is zero, the zero flag will be set<br><br>TYA        ; Transfer Y into A<br>           ; if the value is zero, the zero flag will be set<br><br></pre><br>
<b>Common Math opcodes</b><br>
<pre>ADC #$01   ; ADd with Carry<br>           ; A = A + $01 + carry<br>           ; if the result is zero, the zero flag will be set<br><br>SBC #$80   ; SuBtract with Carry<br>           ; A = A - $80 - (1 - carry)<br>           ; if the result is zero, the zero flag will be set<br><br>CLC        ; CLear Carry flag in status register<br>           ; usually this should be done before ADC<br><br>SEC        ; SEt Carry flag in status register<br>           ; usually this should be done before SBC<br><br>INC $0100  ; INCrement value at address $0100<br>           ; if the result is zero, the zero flag will be set<br><br>DEC $0001  ; DECrement $0001<br>           ; if the result is zero, the zero flag will be set<br><br>INY        ; INcrement Y register<br>           ; if the result is zero, the zero flag will be set<br><br>INX        ; INcrement X register<br>           ; if the result is zero, the zero flag will be set<br><br>DEY        ; DEcrement Y<br>           ; if the result is zero, the zero flag will be set<br><br>DEX        ; DEcrement X<br>           ; if the result is zero, the zero flag will be set<br><br>ASL A      ; Arithmetic Shift Left<br>           ; shift all bits one position to the left<br>           ; this is a multiply by 2<br>           ; if the result is zero, the zero flag will be set<br><br>LSR $6000  ; Logical Shift Right<br>           ; shift all bits one position to the right<br>           ; this is a divide by 2<br>           ; if the result is zero, the zero flag will be set<br></pre><br>
<b>Common Comparison opcodes</b><br>
<pre>CMP #$01   ; CoMPare A to the value $01<br>           ; this actually does a subtract, but does not keep the result<br>           ; instead you check the status register to check for equal, <br>           ; less than, or greater than<br><br>CPX $0050  ; ComPare X to the value at address $0050<br><br>CPY #$FF   ; ComPare Y to the value $FF<br></pre><br>
<b>Common Control Flow opcodes</b><br>
<pre>JMP $8000  ; JuMP to $8000, continue running code there<br><br>BEQ $FF00  ; Branch if EQual, contnue running code there<br>           ; first you would do a CMP, which clears or sets the zero flag<br>           ; then the BEQ will check the zero flag<br>           ; if zero is set (values were equal) the code jumps to $FF00 and runs there<br>           ; if zero is clear (values not equal) there is no jump, runs next instruction<br><br>BNE $FF00  ; Branch if Not Equal - opposite above, jump is made when zero flag is clear<br></pre><br><br>
<font size="+2">NES Code Structure</font><br>
<b>Getting Started</b><br>
This section has a lot of information because it will get everything
set up to run your first NES program. Much of the code can be
copy/pasted then ignored for now. The main goal is to just get NESASM
to output something useful.<br><br>
<b>iNES Header</b><br>
The 16 byte iNES header gives the emulator all the information about
the game including mapper, graphics mirroring, and PRG/CHR sizes. You
can include all this inside your asm file at the very beginning.<br>
<pre>  .inesprg 1   ; 1x 16KB bank of PRG code<br>  .ineschr 1   ; 1x 8KB bank of CHR data<br>  .inesmap 0   ; mapper 0 = NROM, no bank swapping<br>  .inesmir 1   ; background mirroring (ignore for now)<br></pre><br>
<b>Banking</b><br>
NESASM arranges everything in 8KB code and 8KB graphics banks. To fill
the 16KB PRG space 2 banks are needed. Like most things in computing,
the numbering starts at 0. For each bank you have to tell the assembler
where in memory it will start.<br>
<pre>  .bank 0<br>  .org $C000<br>;some code here<br><br>  .bank 1<br>  .org $E000<br>; more code here<br><br>  .bank 2<br>  .org $0000<br>; graphics here<br></pre><br>
<b>Adding Binary Files</b>
Additional data files are frequently used for graphics data or level
data. The incbin directive can be used to include that data in your
.NES file. This data will not be used yet, but is needed to make the
.NES file size match the iNES header.<br>
<pre>  .bank 2<br>  .org $0000<br>  .incbin &quot;mario.chr&quot;   ;includes 8KB graphics file from SMB1<br></pre><br><br>
<b>Vectors</b><br>
There are three times when the NES processor will interrupt your code
and jump to a new location. These vectors, held in PRG ROM tell the
processor where to go when that happens. Only the first two will be
used in this tutorial.<br><br>
<b>NMI Vector</b> - this happens once per video frame, when enabled.
The PPU tells the processor it is starting the VBlank time and is
available for graphics updates.<br>
<b>RESET Vector</b> - this happens every time the NES starts up, or the reset button is pressed.<br>
<b>IRQ Vector</b> - this is triggered from some mapper chips or audio interrupts and will not be covered.<br><br>
These three must always appear in your assembly file the right order.
The .dw directive is used to define a Data Word (1 word = 2 bytes):<br>
<pre>  .bank 1<br>  .org $FFFA     ;first of the three vectors starts here<br>  .dw NMI        ;when an NMI happens (once per frame if enabled) the <br>                   ;processor will jump to the label NMI:<br>  .dw RESET      ;when the processor first turns on or is reset, it will jump<br>                   ;to the label RESET:<br>  .dw 0          ;external interrupt IRQ is not used in this tutorial<br><br></pre><br>
<b>Reset Code</b><br>
The reset vector was set to the label RESET, so when the processor
starts up it will start from RESET: Using the .org directive that code
is set to a space in game ROM. A couple modes are set right at the
beginning. We are not using IRQs, so they are turned off. The NES 6502
processor does not have a decimal mode, so that is also turned off.
This section does NOT include everything needed to run code on the real
NES, but will work with the FCEUXD SP emulator. More reset code will be
added later.<br>
<pre>  .bank 0<br>  .org $C000<br>RESET:<br>  SEI        ; disable IRQs<br>  CLD        ; disable decimal mode<br></pre><br>
<b>Completing The Program</b><br>
Your first program will be very exciting, displaying an entire screen
of one color! To do this the first PPU settings need to be written.
This is done to memory address $2001. The 76543210 is the bit number,
from 7 to 0. Those 8 bits form the byte you will write to $2001.<br>
<pre>PPUMASK ($2001)<br><br>76543210<br>||||||||<br>|||||||+- Grayscale (0: normal color; 1: AND all palette entries<br>|||||||   with 0x30, effectively producing a monochrome display;<br>|||||||   note that colour emphasis STILL works when this is on!)<br>||||||+-- Disable background clipping in leftmost 8 pixels of screen<br>|||||+--- Disable sprite clipping in leftmost 8 pixels of screen<br>||||+---- Enable background rendering<br>|||+----- Enable sprite rendering<br>||+------ Intensify reds (and darken other colors)<br>|+------- Intensify greens (and darken other colors)<br>+-------- Intensify blues (and darken other colors)<br></pre><br>
So if you want to enable the sprites, you set bit 3 to 1.  For this program bits 7, 6, 5 will be used to set the screen color:<br>
<pre>  LDA %10000000   ;intensify blues<br>  STA $2001<br>Forever:<br>  JMP Forever     ;infinite loop<br></pre><br>
<b>Putting It All Together</b><br>
Download and unzip the <a href="scraper/files/background.zip" target="_blank" original-href="http://www.nespowerpak.com/nesasm/background.zip">background.zip</a>
sample files. All the code above is in the background.asm file. Make
sure that file, mario.chr, and background.bat is in the same folder as <a href="scraper/files/NESASM3.zip" target="_blank" original-href="http://www.nespowerpak.com/nesasm/NESASM3.zip">NESASM3</a>, then double click on background.bat.  That will run NESASM3 and should produce background.nes.  Run that NES file in <a href="http://www.the-interweb.com/serendipity/exit.php?url_id=627_id=90" target="_blank" original-href="http://www.the-interweb.com/serendipity/exit.php?url_id=627_id=90">FCEUXD SP</a> to see your background color!  Edit background.asm to change the intensity bits 7-5 to make the background red or green.<br><br>
You can start the Debug... from the Tools menu in <a href="http://www.the-interweb.com/serendipity/exit.php?url_id=627&amp;entry_id=90" target="_blank" original-href="http://www.the-interweb.com/serendipity/exit.php?url_id=627&amp;entry_id=90">FCEUXD SP</a>
to watch your code run. Hit the Step Into button, choose Reset from the
NES menu, then keep hitting Step Into to run one instruction at a time.
On the left is the memory address, next is the hex opcode that the 6502
is actually running. This will be between one and three bytes. After
that is the code you wrote, with the comments taken out and labels
translated to addresses. The top line is the instruction that is going
to run next. So far there isn&apos;t much code, but the debugger will be
very helpful later.
<br><br><br>
<b>NEXT WEEK:</b> more PPU details, start of graphics
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#main_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;main_tutorial-3__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4440" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>

                <div class="comments" style="display: none;" id="main_tutorial-3__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__1">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Jan 17, 2008 at 1:56:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Is there any documentation about NESASM3? It&apos;d be nice to see what it can or can&apos;t do. I wasn&apos;t able to find anything on the web. Then again, I&apos;ve noticed I&apos;m not as patient in my searches as I used to be : P
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__2">
                                                        <div class="mdl-card__title"><strong>Sivak</strong> posted on 
		
			
				
				Jan 17, 2008 at 3:22:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It seems to be able to make fairly simple games without too much problem.&#xA0; I&apos;ve not tried anything more sophisticated like mapper use.&#xA0; What specifically do you want to do?<br><br>Side note:&#xA0; NESASM has&#xA0;a tendency to be bashed for being a bad assembler.&#xA0; It&apos;s a good teaching assembler, I suppose, but for any future projects, I&apos;m going to look at others and see if they truly are better.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__3">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Jan 17, 2008 at 4:58:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><begin quote><i>Originally posted by: <b>Sivak</b></i>
<br>
<br>It seems to be able to make fairly simple games without too much problem.  I&apos;ve not tried anything more sophisticated like mapper use.  What specifically do you want to do?&lt;BR&gt;&lt;BR&gt;Side note:  NESASM has a tendency to be bashed for being a bad assembler.  It&apos;s a good teaching assembler, I suppose, but for any future projects, I&apos;m going to look at others and see if they truly are better.</begin></div>
<br>
<br>Well, I was using a different assembler before (was learning it). NESASM wasn&apos;t at version 3 before, so I was wondering what has been done to it. Like you said, it&apos;s supposed to be pretty good for smaller games, so I was going to check out what it can do in terms of macros and the like (if at all). Anyway, I&apos;m sure I&apos;m going to stick with what I&apos;m using now, which is ca65, but I&apos;m curious to know what has been tweaked in NESASM.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__4">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 17, 2008 at 6:04:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Mostly the changes I made for version 3 were removing some illegal instructions (like inc a), changing the () vs [] syntax, and generating a function listing file. I think other than that it is the same as previous versions. At some point I plan to add more header directives for things like the battery info. I put the old version of the usage doc at <a href="scraper/files/usage.txt" target="_blank" original-href="http://www.nespowerpak.com/nesasm/usage.txt">http://www.nespowerpak.com/nesasm...</a><br>
<br>
If you are already getting ca65 to produce good .nes files then it should be no problem to stick with. You may also want to look at ASM6 if you want something other than ca65.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__5">
                                                        <div class="mdl-card__title"><strong>Sivak</strong> posted on 
		
			
				
				Jan 17, 2008 at 7:26:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Just curious, Roth:&#xA0; Are you making a full-fledged game or just learning to make?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__6">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Jan 17, 2008 at 8:00:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					bunnyboy:
<br>Alright, I wasn&apos;t sure if NESASM was greatly expanded on or not since it was going from 2.xx to ver 3. I was just curious : )  I had a great deal of help getting ca65 setup though, which at first I had used p65. I&apos;ll look up ASM6 to see what that&apos;s all about, thanks!
<br>
<br>Sivak:
<br>It&apos;s more like a demo, but... I don&apos;t know, it&apos;s not really a game, but not really a demo haha It&apos;s something to get my feet wet for the most part. You can get the latest upload here:
<br>
<br><a href="http://roth.zhxhome.net/games/index.htm
" target="_blank" original-href="http://roth.zhxhome.net/games/index.htm
">http://roth.zhxhome.net/games/index.htm
</a><br>
<br>It&apos;s a bit further along than that now. Different title screen, the cat sprite tiles are pulled onto the screen, and the checkmark on the notepad in the bottom left actually stop at each selection instead of moving up and down really fast haha You&apos;ll also notice that when you come back from the instruction screen in this upload, that the little &quot;Decepticon looking cat-head&quot; is in the wrong spot. That&apos;s fixed also.
<br>
<br>Right now I&apos;m trying to come up with a better controller routine using EORs and ANDs (something recommended to me, now I just have to figure it out). Also, changing sprites when the button is pressed. That&apos;s a whole different issue. Anyway, yeah, you can check it out in the link above. Not much, but at least I&apos;m learning : )
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__7">
                                                        <div class="mdl-card__title"><strong>Sivak</strong> posted on 
		
			
				
				Jan 17, 2008 at 8:57:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I see.&#xA0; Well, it seems interesting.&#xA0; You got drawing routines down pretty well.<br><br>Was that NSF made with Famitracker?<br><br>Be sure to check out my game as well:<br><a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4960&amp;enterthread=y" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4960&amp;enterthread=y">http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;th...</a> 
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__8">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Jan 17, 2008 at 9:16:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Nah, I used NerdTracker2 because that&apos;s what I knew at the time. I&apos;m just now checking out FamiTracker since it has the option to have multiple songs in an .nsf.
<br>
<br>I checked your game out last night, and I suck at it haha! I&apos;ll have to figure it out sometime : ) Good job!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__9">
                                                        <div class="mdl-card__title"><strong>albailey</strong> posted on 
		
			
				
				Jan 22, 2008 at 1:03:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>Hi Bunnyboy,</p><p>&#xA0;I dont know if its my browser, but I notice a lot of the code snippets above are showing up altogether on the same line.&#xA0;&#xA0; So if I was to copy and paste those into a file,&#xA0; it obviously wouldnt compile.</p><p>The only other comment I would make would be mentioning something about CONSTANTS or DEFINES</p><p>I can see that you have some declared for PPUMASK, etc.. in the code&#xA0; but there is no separate heading for them like you have for COMMENTS and OPERANDS.&#xA0; That threw me for a loop since the syntax is slightly different for those constants between different assemblers.</p><p>Keep up the good work</p><p>Al</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__10">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Jan 22, 2008 at 1:19:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m wondering if that&apos;s a result of the new layout. It wasn&apos;t like that before, and this is the first time I came back to this thread since the changeover.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__11">
                                                        <div class="mdl-card__title"><strong>bubbahotep</strong> posted on 
		
			
				
				Jun 5, 2008 at 8:33:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi,
<br>
<br>I&apos;m new to this, so these may be dumb questions.
<br>
<br>In background.asm
<br>
<br>In the vblankwait1: section
<br>What does BIT and BPL mean?
<br>
<br>In the clrmem: section
<br>You increment x and then branch if not equal
<br>I thought you had to do some kind of comparison on the line before BNE
<br>What is the BNE comparing to? What values must be equal to continue and not jump back to clrmem:?
<br>
<br>
<br>
<br>
<br>
<br>Thanks
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__12">
                                                        <div class="mdl-card__title"><strong>Stan</strong> posted on 
		
			
				
				Jun 7, 2008 at 1:20:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Those are opcodes, you should get an assembly manual for the 6502.  I&apos;m sure there&apos;s a complete one online somewhere.  BIT tests bits in the accumuluator.  BPL means branch result plus.  It checks the status of flag N.  If you don&apos;t know what that means, it&apos;s highly recommended you read through a 6502 Assembly book.  I believe Zaks did one awhile ago that&apos;s quite good.  Not familiar with it, but I Have his Z80 Assembly book and it&apos;s boss.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__13">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				Jun 7, 2008 at 1:32:36 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bubbahotep</b></i><br><br>Hi,
<br>
<br>I&apos;m new to this, so these may be dumb questions.
<br>
<br>In background.asm
<br>
<br>In the vblankwait1: section
<br>What does BIT and BPL mean?
<br>
<br>In the clrmem: section
<br>You increment x and then branch if not equal
<br>I thought you had to do some kind of comparison on the line before BNE
<br>What is the BNE comparing to? What values must be equal to continue and not jump back to clrmem:?
<br>
<br>
<br>
<br>
<br>
<br>Thanks</div><br>BNE will cause a branch if the result is not zero, right? <br><br>Oh, and you probably shouldn&apos;t listen to anything I say. I&apos;m about a half-step above NoobExtreem(TM). Okay, I&apos;m going to stop posting now. Bye. <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"><span style="text-decoration: underline;"></span><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__14">
                                                        <div class="mdl-card__title"><strong>Sivak</strong> posted on 
		
			
				
				Jun 7, 2008 at 1:38:03 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bubbahotep</b></i><br><br>Hi,
<br>
<br>I&apos;m new to this, so these may be dumb questions.
<br>
<br>In background.asm
<br>
<br>In the vblankwait1: section
<br>What does BIT and BPL mean?
<br>
<br>In the clrmem: section
<br>You increment x and then branch if not equal
<br>I thought you had to do some kind of comparison on the line before BNE
<br>What is the BNE comparing to? What values must be equal to continue and not jump back to clrmem:?
<br>
<br>
<br>
<br>
<br>
<br>Thanks</div><br><br>BNE in this case kind of functions like &quot;jump if not zero&quot;.&#xA0; So basically, the loop increases until it hits the number 255 (FF in hex).&#xA0; The next increment in would normally make it be 256, but in the world of 8 bit,&#xA0; it goes back to 0 and the branching stops because you&apos;re at 0.<br><br>I think the way it works is the zero flag gets set, and that&apos;s what stops the branching.<br><br><br>The loop could also have been set up like this:<br><font face="courier">
&#xA0;&#xA0;LDX #$FF<br>
.loop:<br>
&#xA0;&#xA0;;Do whatever code you want<br>
&#xA0;&#xA0;DEX<br>
&#xA0;&#xA0;BNE .loop</font><br><br><br>That&apos;s the best way to do most counting loops.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__15">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jun 7, 2008 at 3:15:56 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bubbahotep</b></i><br>
<br>In the vblankwait1: section
<br>What does BIT and BPL mean?
<br>
<br></div><div><br></div><div><br></div><div>If you are just getting started, then you can largely ignore those. &#xA0;They won&apos;t be useful until much later.
</div><div><br></div><div>The BIT instruction first does an AND with A and the memory location, then copies the resulting data bit 7 from A to the Negative (N) flag, and data bit 6 from A to the Overflow (V) flag. &#xA0;Everything else is left alone.</div><div><br></div><div>The BPL instruction is Branch if Positive. &#xA0;When the N flag is zero, the branch is taken. &#xA0;If the N flag is 1, the branch is not taken.</div><div><br></div><div>Combining those two in the loop is just the fastest way to wait until data bit 7 = 1. &#xA0;When D7 = 0, BIT sets N = 0, and the BPL branch is taken to repeat the loop. &#xA0;When D7 = 1, N = 1, and the loop ends.</div><div><br></div><div>A very good 6502 instruction reference is at&#xA0;<a href="http://www.obelisk.demon.co.uk/6502/reference.html" target="_blank" original-href="http://www.obelisk.demon.co.uk/6502/reference.html">http://www.obelisk.demon.co.uk/65...</a> &#xA0;It has all the instructions with a quick description and how the flags are affected.</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__16">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jun 7, 2008 at 3:17:34 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Sivak</b></i><br><br><br>The loop could also have been set up like this:<br><font face="courier">
&#xA0;&#xA0;LDX #$FF<br>
.loop:<br>
&#xA0;&#xA0;;Do whatever code you want<br>
&#xA0;&#xA0;DEX<br>
&#xA0;&#xA0;BNE .loop</font><br><br><br>That&apos;s the best way to do most counting loops.<br></div><br>Except that loop will only run 255 times, not 256. &#xA0;When the loop is run with X=1, the dex makes X=0, and it ends. &#xA0;The 0th time thro the loop is never run. &#xA0;To make it correct it should be ldx #$00 at the top.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__17">
                                                        <div class="mdl-card__title"><strong>bubbahotep</strong> posted on 
		
			
				
				Jun 10, 2008 at 9:34:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for clearing that up!<br><br><br>Keep up the good work bunnyboy, these tutorials are helping me immensely.<br><br><br><br><br><br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__18">
                                                        <div class="mdl-card__title"><strong>dutch</strong> posted on 
		
			
				
				Jun 27, 2008 at 7:41:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					have a problem with the exsample.
<br>
<br>I downloaded the background and unzipped it.Then when i put it in the nesasm 3 and try to open it(by double clikking background.bat),i get a message that asm3 is not recognized as intern or extern mission or program?
<br>
<br>Whats going on? is nesasm3 dos instead of windows or something?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__19">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Jun 27, 2008 at 7:53:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If the NESASM3.exe file is in the same directory as the Bat file, try changing the Bat file to be &quot;NESASM3.exe background.asm&quot;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__20">
                                                        <div class="mdl-card__title"><strong>dutch</strong> posted on 
		
			
				
				Jun 27, 2008 at 8:27:01 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>Changing it does not help<img src style="display: none;" original-src="i/expressions/face-icon-small-sad.gif" show-src="images/blank.gif"></p><p>Still think that DOS is the problem</p><p>I can open and see the mario.chr and the background.asm. Only the background.bat wont open,black screen with not recognized bla bla</p><p>
				</p></div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__21">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jun 27, 2008 at 10:09:08 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					NESASM3 isn&apos;t included in the background.zip file, click on the NESASM3 link in the article to download it separately.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__22">
                                                        <div class="mdl-card__title"><strong>dutch</strong> posted on 
		
			
				
				Jun 27, 2008 at 2:10:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br>NESASM3 isn&apos;t included in the background.zip file, click on the NESASM3 link in the article to download it separately.</div><p><br><br><br>thats not the problem.</p><p>&#xA0;have downloaded the background zip, the nesasm3 en de fceuxd sp</p><p>i have unzipped the background and have put it in the nesasm3 but when i try to dubbel click the bat file the nesasm3 programm is not recignized as a internal or ext. programm or command?</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__23">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jun 27, 2008 at 3:06:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					take a screenshot of the folder everything is in and the window with error message  <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__24">
                                                        <div class="mdl-card__title"><strong>dutch</strong> posted on 
		
			
				
				Jul 8, 2008 at 3:13:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Finaly had some time to work on this again.
<br>tried again and got something working i unzipped the background and nesasm and trew the background in the nesasm that became background.fns threw it in again and it became background.nes
<br>
<br>BUT if i trow it in a emulator i only get a grey screen?
<br>do have to ad something to the background code?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__25">
                                                        <div class="mdl-card__title"><strong>albailey</strong> posted on 
		
			
				
				Jul 8, 2008 at 4:47:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Unzip the background.zip file.
<br>Open a DOS window.
<br>change into that background folder
<br>
<br>type the following:
<br>dir
<br>
<br>
<br>There should be 3 files
<br>background.asm
<br>background.bat
<br>mario.chr
<br>
<br>type:
<br>background.bat
<br>
<br>It should complain: &apos;NESASM3&apos; is not recognized as an internal or external command
<br>
<br>Update background.bat to include the entire path to nesasm (be aware that you may need quotes if there are spaces in the path).
<br>
<br>Alternativly, add nesasm to your sytem &quot;PATH&quot; variable.
<br>to do this:
<br>Open your &quot;Control Panel&quot;  and click on &quot;System&quot;.  to open &quot;System Properties&quot;
<br>In &quot;System Properties&quot; find the &quot;Advanced&quot; tab.  and click on the &quot;Environment Variables&quot; button.
<br>Find an item entitled &quot;PATH&quot;  and edit it to add the path to your nesasm (you probably should add this at the end, and remember to add a semi colon before you enter the path)
<br>
<br>If this all works, and nesasm is working, you should see your  background.nes file being created.
<br>Double click the NES file and your emulator should load it.
<br>Al
<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__26">
                                                        <div class="mdl-card__title"><strong>dutch</strong> posted on 
		
			
				
				Jul 13, 2008 at 10:03:46 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Finaly made nesasm work with the controller.zip file<br><br>thanks al.<br><br>it was great to see asm make controller.nes and when the fceuxd showed mario i jumped sky high! <br>i can finally test all my codes and work on them.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__27">
                                                        <div class="mdl-card__title"><strong>ddribin</strong> posted on 
		
			
				
				Oct 20, 2009 at 12:03:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi all,<div><br></div><div>I&apos;m interested in getting started on some NES programming just for kicks, and I&apos;ve been reading the Nerdy Nights series, along with some other docs. &#xA0;I&apos;m on a Mac, so I want to try translating these tutorials into ca65 and test on Nestopia, since that works better than NESASM3 +&#xA0;FCEUXD SP.</div><div><br></div><div>This first tutorial doesn&apos;t seem to work, however. &#xA0;The screen shows up as all black. &#xA0;I have to add in code like this to setup the palette before storing %10000000 into&#xA0;$2001:</div><div><br></div><div><br></div><div><div><span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>lda<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>#$3f<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; Set PPU address to BG palette RAM ($3F00)</div><div><span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>sta<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>$2006</div><div><span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>lda<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>#$00</div><div><span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>sta<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>$2006</div><div><br></div><div><span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>lda<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>#$00</div><div><span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>sta<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>$2007</div><div><span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>sta<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>$2007</div><div><span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span></div><div>@vblankwait3:</div><div><span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>bit<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>$2002</div><div><span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>bpl<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>@vblankwait3</div><div><br></div></div><div><br></div><div><div>Any help on why this is needed on Nestopia? &#xA0;Does it make sense that the palette needs to be setup like this? &#xA0;Is there a more proper way to initialize the PPU to get a light blue background by setting bit 7 of $2001? Is Nestopia just broken?</div><div><br></div><div>Thanks,</div><div><br></div><div>-Dave</div><div><br></div><div>P.S. Sorry for not formatting the code properly. I don&apos;t see how to choose a fixed width font.</div></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__28">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Oct 20, 2009 at 12:24:20 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					well you may have copied it wrong here, but it should be #%10000000 , not %10000000. # signs can screw a lot of things up lol.
<br>
<br>you&apos;re palette initialization looks right to me, but you shouldn&apos;t even need a palette loaded to intensify color.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__29">
                                                        <div class="mdl-card__title"><strong>ddribin</strong> posted on 
		
			
				
				Oct 20, 2009 at 12:37:54 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div>I am indeed using #%10000000. &#xA0;Here&apos;s the code just following the previous snippet:</div><div><br></div><div><div><span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>lda<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>#%10000000<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; intensify blues</div><div><span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>sta<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>$2001</div><div><br></div><div>@forever:</div><div><span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>jmp<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>@forever</div><div><br></div></div><div>And here&apos;s the whole file: <a href="http://gist.github.com/213995" target="_blank" original-href="http://gist.github.com/213995">http://gist.github.com/213995...</a></div><div><br></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__30">
                                                        <div class="mdl-card__title"><strong>ddribin</strong> posted on 
		
			
				
				Oct 21, 2009 at 12:23:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is definitely a difference between&#xA0;FCEUXDSP and Nestopia. &#xA0;I compiled&#xA0;FCEUX on OS X, and it did not need the palette initialized. &#xA0;I&apos;ll leave it in is it doesn&apos;t change anything on FCEU*.<div><br></div><div>I&apos;ve put the code up on Bit Bucket:</div><div><br></div><div><a href="http://bitbucket.org/ddribin/nerdy-nights/" target="_blank" original-href="http://bitbucket.org/ddribin/nerdy-nights/">http://bitbucket.org/ddribin/nerd...</a></div><div><br></div><div>I hope to add all the tutorials, ported to ca65, as I work through them.</div><div><br></div><div>-Dave</div><div><br></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__31">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Oct 21, 2009 at 12:37:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					cool, I use NESASM3 and FCEU so, I couldn&apos;t be much help. I looked at your source and I didn&apos;t see any reason it shouldn&apos;t run. I thought maybe there might have been a difference between ca65 and NESASM, but nice to know it was just the emulator.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__32">
                                                        <div class="mdl-card__title"><strong>ddribin</strong> posted on 
		
			
				
				Oct 25, 2009 at 12:18:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve verified that the initial palette on Nestopia is not all zeros. &#xA0;Take a look at the Nestopia source code in NstPpu.cpp:<div><br></div><div><div>static const byte powerUpPalette[] =</div><div>{</div><div>&#xA0;&#xA0; &#xA0;0x3F,0x01,0x00,0x01,0x00,0x02,0x02,0x0D,</div><div>&#xA0;&#xA0; &#xA0;0x08,0x10,0x08,0x24,0x00,0x00,0x04,0x2C,</div><div>&#xA0;&#xA0; &#xA0;0x09,0x01,0x34,0x03,0x00,0x04,0x00,0x14,</div><div>&#xA0;&#xA0; &#xA0;0x08,0x3A,0x00,0x02,0x00,0x20,0x2C,0x08</div><div>};</div><div><br></div><div>So to make this example work properly, the palettes should be cleared to zero first.</div><div><br></div><div>-Dave</div><div><br></div></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__33">
                                                        <div class="mdl-card__title"><strong>JohnB544</strong> posted on 
		
			
				
				Nov 12, 2009 at 6:57:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
  .bank 0 <br>
  .org $C000 <br>
;some code here
</div>
Is there any reason, that bank 0 is at memory location $C000, instead of $8000, where the cartige ROM starts?
<div class="FTQUOTE">
  .bank 2 <br>
  .org $0000 <br>
  .incbin &quot;mario.chr&quot;   ;includes 8KB graphics file from SMB1
</div>
$0000 is the internal RAM, but there is only 2KB of RAM, and bank 2 is 8KB. And what about the CHR RAM? The graphics shouldn&apos;t be there?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__34">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Nov 12, 2009 at 7:15:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You can have 16k of ROM space starting at $C000 or 32k starting at $8000.
<br>
<br>The bank 2 here is referring to CHR ROM starting at $0000 in the PPU (note that the PPU and CPU memory are in different address spaces).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__35">
                                                        <div class="mdl-card__title"><strong>JohnB544</strong> posted on 
		
			
				
				Nov 13, 2009 at 11:14:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Zzap</b></i><br><br>You can have 16k of ROM space starting at $C000 or 32k starting at $8000.
<br>
<br>The bank 2 here is referring to CHR ROM starting at $0000 in the PPU (note that the PPU and CPU memory are in different address spaces).</div>
Thank you, now I understand it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__36">
                                                        <div class="mdl-card__title"><strong>fireseed</strong> posted on 
		
			
				
				Feb 5, 2010 at 1:11:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Would anyone know the reason why, when I make a save state on fcgeux, that the colors turn from green, where I have it now;
<br>
<br>  LDA #%11000000   ;intensify blues
<br>  STA $2001
<br>
<br>Back to a dull gray.
<br>I don&apos;t yet know how to bring the new save state back into a format that I can analyze in a text document like the original asm to see what has changed either...
<br>
<br>You guys rock the rocks, btw.
<br>Cheers!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__37">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 5, 2010 at 9:17:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m not really sure how save states work.  I assume it just picks up the code from wherever it left off when you saved it.  Perhaps it&apos;s just waking up in the infinite loop and bypasses all the loading stuff?  I have no idea.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__38">
                                                        <div class="mdl-card__title"><strong>fireseed</strong> posted on 
		
			
				
				Feb 5, 2010 at 12:35:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Would there be a way to open it into the rom and the decompile it reanalyze the code in the save state to try to see exactly what changed where? Wouldn&apos;t Fceuxdsp be able to do this somehow? 
<br>
<br>P.S. I hope there&apos;s a tutorial coming up here on changing the palette more, cause I want to make my rom- yellow!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__39">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Feb 5, 2010 at 1:09:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					oh, the tutorials will do a lot more than that. I think week 4 does palettes, you&apos;ll probably never use the intensify line again. It&apos;s the most basic of things. Palettes are much more fun <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__40">
                                                        <div class="mdl-card__title"><strong>Farid</strong> posted on 
		
			
				
				Apr 3, 2010 at 4:33:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					How can I make a NES ROM to support right to left language?
<br>I don&apos;t have any problem for translating fixed text on the screen but texts which gradually appear from left to right, are really hard to translate.
<br>Captain Tsubasa Arabic translation is a good example for this matter.
<br>I guess I have to do it in assembly 6502 but I don&apos;t have any idea how to do it?
<br>I appreciate anyone who can help me.
<br>
<br>Also some other nice people guide me but I really need some more help :
<br>
<br><a href="http://www.romhacking.net/forum/index.php/topic,10389.0.html" target="_blank" original-href="http://www.romhacking.net/forum/index.php/topic,10389.0.html">http://www.romhacking.net/forum/i...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__41">
                                                        <div class="mdl-card__title"><strong>nullending</strong> posted on 
		
			
				
				Jun 28, 2010 at 1:27:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Anyone know what the label NMI means for the vBlank section? Why NMI? Why not vBlank0 or something?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__42">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				Jun 28, 2010 at 2:08:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE" sab="137"><i sab="138">Originally posted by: <b sab="139">nullending</b></i><br sab="140"><br sab="141">Anyone know what the label NMI means for the vBlank section? Why NMI? Why not vBlank0 or something?</div><a href="http://wiki.nesdev.com/w/index.php/NMI" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/NMI">http://wiki.nesdev.com/w/index.php/NMI</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__43">
                                                        <div class="mdl-card__title"><strong>-Basti-</strong> posted on 
		
			
				
				Aug 30, 2010 at 12:04:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					i have a question to the BNE/BEQ command. How can i figure out which adress the code passages have?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__44">
                                                        <div class="mdl-card__title"><strong>CMR</strong> posted on 
		
			
				
				Jul 9, 2011 at 7:06:11 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry for the necropost, but I&apos;m having trouble understanding why the banks begin where they do.  In the sample code from the download link .bank0 starts at .org $C000, .bank1 starts at .org $FFFA, and .bank2 starts at .org $0000.  Is .org specifying where to put the code in reference to the system&apos;s memory map or the cart rom&apos;s?  $FFFA is too big a number for the 32KB cart, so I have to assume we&apos;re dealing with the CPU&apos;s memory map.  And why does .bank0 start at $C000?  Does it need to go there or did you just put it there because you wanted to?  Also, the 32KB cart rom on the memory map from week 2 doesn&apos;t include the 16KB chr rom, correct?  I&apos;m thinking the chr rom is outside the CPU&apos;s memory map and can only be accessed by the PPU.  Is that why the chr rom can start at $0000, because it isn&apos;t really a part of the CPU&apos;s memory map?
<br>
<br>Thanks for the tutorials.  Anymore help you or anyone else can give is greatly appreciated.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__45">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jul 9, 2011 at 7:31:59 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>CMR</b></i><br><br>Is .org specifying where to put the code in reference to the system&apos;s memory map or the cart rom&apos;s?  $FFFA is too big a number for the 32KB cart, so I have to assume we&apos;re dealing with the CPU&apos;s memory map</div><div><br></div><div>What .org really is doing is hinting the assembler where the code will be placed when it is run, so that it can build the instructions correctly. So .org doesn&apos;t actually &quot;place&quot; the code anywhere.</div><br><div style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: white; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; font-family: sans-serif; font-size: 12px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; "><div class="FTQUOTE" style="background-color: rgb(255, 255, 255); padding-top: 6px; padding-right: 6px; padding-bottom: 6px; padding-left: 6px; margin-left: 30px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(119, 119, 119); border-top-width: 1px; border-top-style: solid; border-top-color: rgb(119, 119, 119); border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); width: 446px; "><i>Originally posted by:&#xA0;<b>CMR</b></i><br><br>And why does .bank0 start at $C000? Does it need to go there or did you just put it there because you wanted to?</div><br>Since the ROM has 16KB PRG-ROM, and the PRG-ROM area is at 8000-FFFF, we know the ROM will be mapped both at 8000-BFFF and C000-FFFF (because of mirroring) when the code is executed. So really we&apos;re just telling the assembler where the code will appear, like said earlier.</div><div style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: white; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; font-family: sans-serif; font-size: 12px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; ">It would be fine to use .org $8000 as well&#xA0;(and .org $A000 for the 2nd 8K bank), but it&apos;s somewhat easier to use $C000 (and $E000), because then the vectors will be placed correctly when using .org $FFFA.</div><div style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: white; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; font-family: sans-serif; font-size: 12px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; "><br></div><div style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: white; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; font-family: sans-serif; font-size: 12px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; "><div class="FTQUOTE" style="background-color: rgb(255, 255, 255); padding-top: 6px; padding-right: 6px; padding-bottom: 6px; padding-left: 6px; margin-left: 30px; border-left-width: 1px; border-left-style: solid; border-left-color: rgb(119, 119, 119); border-top-width: 1px; border-top-style: solid; border-top-color: rgb(119, 119, 119); border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); width: 446px; "><i>Originally posted by:&#xA0;<b>CMR</b></i><br><br>I&apos;m thinking the chr rom is outside the CPU&apos;s memory map and can only be accessed by the PPU. Is that why the chr rom can start at $0000, because it isn&apos;t really a part of the CPU&apos;s memory map?&#xA0;<br></div><div style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: white; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; font-family: sans-serif; font-size: 12px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; "><br></div>That is correct. The .org doesn&apos;t really matter for this bank.</div><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__46">
                                                        <div class="mdl-card__title"><strong>CMR</strong> posted on 
		
			
				
				Jul 9, 2011 at 2:11:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the reply.  Is 16KB the maximum the prg rom can be?  I was under the impression it could be a maximum of 32KB with 4 8K banks.  Also why are things arranged in 8K banks?  Is this just how NESASM likes to do it, or does the hardware need it that way for some reason.  
<br>
<br>Sorry for all the questions, but I would like to get this down before I move on.  Thanks again.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__47">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jul 9, 2011 at 2:21:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					NESASM just puts them in 8KB banks. You can put more data in it, but then you&apos;ll have to use a mapper, probably first off a logic mapper, then maybe MMC1 then if you get really good, MMC3.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__48">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jul 9, 2011 at 11:26:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>CMR</b></i><br><br>Thanks for the reply.  Is 16KB the maximum the prg rom can be?  I was under the impression it could be a maximum of 32KB with 4 8K banks.  Also why are things arranged in 8K banks?  Is this just how NESASM likes to do it, or does the hardware need it that way for some reason.  
<br>
<br>Sorry for all the questions, but I would like to get this down before I move on.  Thanks again.</div><br>Yes, 32KB is the maximum without mappers. Then the data will appear at $8000-FFFF, unmirrored, so you should use .org $8000 and put it in 4 NESASM banks.<div><br></div><div>The 8K bank system of NESASM is completely arbitrary, no hardware requirements behind it. AFAIK the reason is that NESASM is based on a PC Engine assembler, and PC Engine used 8K banking internally.<br><br>
</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__49">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Dec 29, 2011 at 5:45:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hello, I&apos;m trying to get into assembly programming through NES development,<br>
but I have some trouble understanding some stuff from your attached code. Please help me,<br>
I really want to understand this before moving on.<br><br><br><br>01. RESET:<br>
02.   SEI          ; disable IRQs<br>
03.   CLD          ; disable decimal mode<br>
04.   LDX #$40<br>
05.   STX $4017    ; disable APU frame IRQ<br>
06.   LDX #$FF<br>
07.   TXS          ; Set up stack<br>
08.   INX          ; now X = 0<br>
09.   STX $2000    ; disable NMI<br>
10.   STX $2001    ; disable rendering<br>
11.   STX $4010    ; disable DMC IRQs<br>
12. vblankwait1:       ; First wait for vblank to make sure PPU is ready<br>
13.   BIT $2002<br>
14.   BPL vblankwait1<br><br><br><br>Line 02       - IRQ&apos;s have to be disabled if not used, but why?<br>
Line 03       - Decimal mode not supported by the 2A03<br>
Line 04.05    - Aren&apos;t address $4017 controller 2? How is that connected to the APU? What is so special<br>
                about the number $40?<br><br>
Line 06.07    - $FF last memory location in stack, initialize stack to this value.<br>
Line 08       - Increment $FF so it overflows and becomes 0.<br>
Line 09.10.11 - Set all bits in address $2000, $2001 and $4010 to 0. The first two I understand<br>
                but what is a DMC IRQ, and why does it need to be disabled?<br><br>
Line 12.13.14 - I know the PPU have to warm up before using it, but what exactly do these lines of code do?<br><br><br><br>Please someone, look through this and correct me where I&apos;m wrong,<br>
and help me understand this code. I&apos;m new to the field of computer science,<br>
but I got a book coming in the mail any day now that will introduce me to<br>
boolean algebra and stuff like that, which, if I understand it correctly,<br>
is essential to NES dev and ASM programming in general.<br>
Sorry for the long post.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__50">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Dec 29, 2011 at 5:51:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Line 2: Because it can still be triggered and will do bad things if your program is set up. You never do not initialize registers and just leave them what they are, you need the computer in a known state. Plus, on mappers that do have it, you have to do it anyway so nothing changes when moving to a better mapper.<br>
<br>Line 3: Yep, it doesn&apos;t have it because it&apos;s disabled.&#xA0;<br>
<br>Line 4/5: On $4016 write it resets both controllers. On 4016 read and 4017 read it reads the controllers. On 4017 writes it write to the APU, registers don&apos;t exist in both states (read and write) all the time, they sometimes change &quot;meaning&quot; completely. 4017 is one of those registers that changes on reads and writes.
<br>
<br>Line 9/10/11: It&apos;s when sound is playing samples. If they are playing you want to disable the sound and the acknowledging program.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__51">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Dec 29, 2011 at 7:42:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					02: It&apos;s good practice to initialize everything to a known state in the beginning of the program.
<br>03: Technically this isn&apos;t required on the NES CPU, but it&apos;s still a good practice to have it.
<br>04-05: $4017 is connected to the APU when it&apos;s being written. I won&apos;t go into details about $40, but long story short it sets on bit in the APU register 4017 that makes sure frame IRQs won&apos;t happen
<br>06-07: $FF (the actual memory location is $1FF) is actually the first location, because stack grows from top ($1FF) to bottom ($100). So when a value gets pushed, the stack pointer gets decreased.
<br>08: That&apos;s right.
<br>11: Once again, it&apos;s good practice to initialize everything to a known state, even though IRQs won&apos;t be actually triggered regardless because of the SEI instruction on line 2.
<br>12-14: vblankwait1 is a label, BIT $2002 (in this case) copies the top bit of value read from $2002 to CPU&apos;s sign flag (plus/minus). This happens to be the bit that indicates whether vblank has started. BPL vblankwait1 jumps back to the label if the result is positive, in other words if the top bit of the value read from $2002 was 0.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__52">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Jan 1, 2012 at 8:02:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok, thanks guys! And thanks for the tutorials, will probably get through week 5 tonight. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__53">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 12, 2012 at 7:35:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m just wondering is .bank2 always used for graphics storage via the PPU?<br>
How does it know to access $0000 of PPU memory and not $0000 of CPU memory?<br>
<br>
Also why is STA $0000, x used continuously inside the clrmem: label? isn&apos;t the contents of register X at this point 0 and hence doesn&apos;t modify the address accessed?<br>
<br>
*Edit*<br>
I know the answers to my questions now.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__54">
                                                        <div class="mdl-card__title"><strong>jarrodparkes</strong> posted on 
		
			
				
				Oct 16, 2012 at 8:47:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have been doing my best to understand banking; however, I am still a little unclear about why explicitly specifying it is necessary. Here is my understanding and questions, let me know where I am messing up...
<br>
<br>1. A bank is portion of memory that is set aside as a holding place for some kind of data (like CHR or PRG)
<br>2. For the NESASM, banks occupy a space of 8KB
<br>3. The .bank directive does what exactly? Couldn&apos;t you just get by using a .org directive to navigate to the portions of memory where CHR/PRG data is intended to be stored? Why do you have to specify the .bank?
<br>4. How are you supposed to know if your PRG memory exceeds a 8KB bank? What would happen if it does?
<br>5. Are all directives handled pre-assembling? Almost like C++ pre-processor directives?
<br>
<br>Thanks,
<br>Jarrod
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__55">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Oct 16, 2012 at 11:06:16 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>jarrodparkes</b></i><br>
	<br>
	I have been doing my best to understand banking; however, I am still a little unclear about why explicitly specifying it is necessary. Here is my understanding and questions, let me know where I am messing up...<br>
	<br>
	1. A bank is portion of memory that is set aside as a holding place for some kind of data (like CHR or PRG)<br>
	2. For the NESASM, banks occupy a space of 8KB<br>
	3. The .bank directive does what exactly? Couldn&apos;t you just get by using a .org directive to navigate to the portions of memory where CHR/PRG data is intended to be stored? Why do you have to specify the .bank?<br>
	4. How are you supposed to know if your PRG memory exceeds a 8KB bank? What would happen if it does?<br>
	5. Are all directives handled pre-assembling? Almost like C++ pre-processor directives?<br>
	<br>
	Thanks,<br>
	Jarrod</div>
<br>
1. Yes, &quot;bank&quot; can mean any arbitrary block of memory, depending on the context. NESASM bank is 8KB, MMC1 bank can be 16KB or 32KB, UxROM bank is 16KB, MMC3 uses 8KB banks, NSF uses 4KB banks, and so on.<br>
2. Yes, this is an arbitrary restriction stemming from the fact that it was originally an assembler for the PC Engine/TurboGrafx-16, which has native support for 8KB banking.<br>
3. It specifies the 8KB multiple of where the data should go in the output file. And yes, other assemblers use .org (and some other directives to reset the address, etc) or some other method (linker memory configuration file in CA65) for the same purpose.<br>
4. The assembler is supposed to tell you. NESASM has bugs in it so it sometimes doesn&apos;t, and will overwrite the beginning of the bank instead. <span class="sprites_emoticons absmiddle" id="emo_wink"></span><br>
5. Yes.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__56">
                                                        <div class="mdl-card__title"><strong>jarrodparkes</strong> posted on 
		
			
				
				Oct 16, 2012 at 1:14:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the help. I have another question, and maybe this example will help...<br>
<br>
Here is what the documentation (<a href="scraper/files/usage.txt" target="_blank" original-href="http://www.nespowerpak.com/nesasm/usage.txt">http://www.nespowerpak.com/nesasm...</a>) says about BANK:<br>
BANK - Select a 8KB ROM bank (0-127) and reset the location counter to the latest known position in this bank.<br>
<br>
EXAMPLE ASM FILE:<br>
<br>
; some header info...<br>
<br>
.bank 0<br>
.org $8000<br>
SEI ; <strong>will each command after the .bank and .org be offset from memory location $8000 ?</strong><br>
{ ... } ; more opcodes<br>
<br>
.bank 1<br>
.org $FFFA<br>
{ ... } ; commands to set NMI, IRQ, and RESET vectors...<br>
<br>
.bank 0 ; <strong>does re-using this directive now set the location counter to where we left off in bank 0 ?</strong><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__57">
                                                        <div class="mdl-card__title"><strong>DamienC666</strong> posted on 
		
			
				
				Mar 13, 2013 at 9:10:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry to dig this up, but I had a question about the &quot;clrmem&quot; routine. I got everything to compile and run just fine.<br>
<br>
I get why we&apos;re writing $00 to pages 0-7 of memory, but why are we writing $FE to page 3? Specifically, I don&apos;t get:<br>
<br>
<div style="margin-left: 40px;">
	clrmem:<br>
	&#xA0; &#xA0; &#xA0;&#xA0; LDA #$00<br>
	&#xA0; &#xA0; &#xA0;&#xA0; STA $0000, x<br>
	&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0100, x<br>
	&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0200, x<br>
	&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0400, x<br>
	&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0500, x<br>
	&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0600, x<br>
	&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0700, x<br>
	&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LDA #$FE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;------------- These two lines<br>
	&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0300, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;----/<br>
	&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; INX<br>
	&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; BNE clrmem</div>
<br>
Just trying to understand every part of the code before moving on.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__58">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Mar 13, 2013 at 11:08:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DamienC666</b></i><br>
	<br>
	Sorry to dig this up, but I had a question about the &quot;clrmem&quot; routine. I got everything to compile and run just fine.<br>
	<br>
	I get why we&apos;re writing $00 to pages 0-7 of memory, but why are we writing $FE to page 3? Specifically, I don&apos;t get:<br>
	<br>
	<div style="margin-left: 40px;">
		clrmem:<br>
		&#xA0; &#xA0; &#xA0;&#xA0; LDA #$00<br>
		&#xA0; &#xA0; &#xA0;&#xA0; STA $0000, x<br>
		&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0100, x<br>
		&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0200, x<br>
		&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0400, x<br>
		&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0500, x<br>
		&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0600, x<br>
		&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0700, x<br>
		&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LDA #$FE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;------------- These two lines<br>
		&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $0300, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;----/<br>
		&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; INX<br>
		&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; BNE clrmem</div>
	<br>
	Just trying to understand every part of the code before moving on.</div>
The code assumes that $300-$3FF is used for shadow OAM (that is copied to the real OAM later with OAM DMA, PPU register $4014). Initializing OAM to $FE causes all sprite Y positions to be 254, placing the sprites offscreen. Alternatively any other value between 239..255 ($EF..$FF) could be used to the same effect.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__59">
                                                        <div class="mdl-card__title"><strong>DamienC666</strong> posted on 
		
			
				
				Mar 13, 2013 at 11:21:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	The code assumes that $300-$3FF is used for shadow OAM (that is copied to the real OAM later with OAM DMA, PPU register $4014). Initializing OAM to $FE causes all sprite Y positions to be 254, placing the sprites offscreen. Alternatively any other value between 239..255 ($EF..$FF) could be used to the same effect.</div>
<br>
I gotcha, that makes perfect sense. All these mirrored sections of memory kind of throw me off a bit.<br>
<br>
Thanks.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__60">
                                                        <div class="mdl-card__title"><strong>HiQConsoul</strong> posted on 
		
			
				
				Jun 24, 2013 at 7:54:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<pre style="color: rgb(0, 0, 0); font-size: 11px;">LDA #$0A   ; LoaD the value 0A into the accumulator A
           ; the number part of the opcode can be a value or an address
           ; if the value is zero, the zero flag will be set.<br><br>
LDY #$FF   ; LoaD the value $FF into the index register Y
           ; if the value is zero, the zero flag will be set.</pre>
</div>
<br>
*** Im pretty nubby at this..<br>
ok so... can u see my question forming?<br>
<br>
above, lda and ldy have a #$ before the hex value ..<br>
<br>
lda #$22 would seem to load 22 into a ...<br>
(rephrase.. lda #$22 LoaD into A the value 22)<br>
ldy #$22 would seem to load $22 into y ...<br>
(rephrase.. ldy #$22 LoaD into Y the value $22)<br>
<br>
.. why does y get the $ before 22, and why does a not get the $ before 22?<br>
<br>
a and y are different thingies and work differently, it could be something like that I guess - but the way things are worded I also seem to think it may just as well be a typo from author altho probability is low cuz it&apos;s so old, yet it seems most who check it out are fairly skilled and thus just shrug at it if even noticing it.. and nubs like myself may just think &quot;it&apos;s just me who&apos;s a nub&quot;.. so, I feel I should ask..<br>
<br>
cheers <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
edit:<br>
<br>
at the bottom it shows the 76543210 bits with lines to what they do.. after that it says:<br>
<span style="color: rgb(0, 0, 0); font-family: Geneva, Verdana, Arial, Helvetica, sans-serif; font-size: 11px;">&quot;So if you want to enable the sprites, you set bit 3 to 1.&quot;<br>
<br>
I just rechecked like 5 times and Im sure bit 3 on the &apos;drawing&apos; is pointing to the background and bit 4 to the &apos;enable rendering sprites&apos; .. so, basically same question: Am I just nub and will find out why it&apos;s right, or is it like.. typo ?</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__61">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jun 24, 2013 at 8:24:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					LDA and LDY work the same with the same right side, just different registers.
<br>
<br>LDA #$22 puts #$22 ($22 is a memory location, NOT the number, big difference.) to A.
<br>
<br>LDY #$22 puts #$22 to Y.
<br>
<br>That&apos;s basically it. I don&apos;t understand your problem, as it just does what the text says. If it says #22, it gets decimal 22 loaded. If it says #$, it&apos;s hex, if it says #%, it&apos;s binary.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__62">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jun 24, 2013 at 10:42:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think he&apos;s getting confused by the notes on the side.  He just forgot to put #$ before 0A.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__63">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Oct 12, 2013 at 8:40:31 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Three questions:<br>
1.What&apos;s so special about #$40?<br>
2.What is up with<br>
STA $0000, x<br>
STA $0100, x<br>
STA $0200, x<br>
STA $0400, x<br>
STA $0500, x<br>
STA $0600, x<br>
STA $0700, x<br>
LDA #$FE<br>
STA $0300, x<br>
I know it&apos;s about loading the value in the accumulator (#$00) to these addresses, but why do we have to do it?<br>
3.Why do we have to set up stack with TXS (which here means transfering hex value FF to register S) in the beginning?<br>
Thanks <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__64">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				Oct 12, 2013 at 9:13:02 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					All these answers exist in this thread already.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__65">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Oct 12, 2013 at 9:42:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I still don&apos;t understand question 3, and I still don&apos;t know why we have to do this
<br>
<br>STA $0000, x
<br>STA $0100, x
<br>STA $0200, x
<br>STA $0400, x
<br>STA $0500, x
<br>STA $0600, x
<br>STA $0700, x
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__66">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Oct 12, 2013 at 12:43:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You don&apos;t have to reset the RAM, some even say it&apos;s bad.
<br>
<br>S is the Stack pointer. The stack always resides in page 1, so RAM addresses $0100-$01FF. The value
<br>you transfer with TXS tells you where in page 1 the stack pointer will point to.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__67">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Oct 12, 2013 at 1:26:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Setting up stack pointer is not really needed if you don&apos;t plan to use the stack page ($100..1ff) for anything else. But if you place something else there, you have to set up stack pointer to be sure the stack is always in the same place and does not overlap your other data.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__68">
                                                        <div class="mdl-card__title"><strong>Jazzmarazz</strong> posted on 
		
			
				
				Sep 30, 2014 at 7:26:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Found a tiny typo:
<br>
<br>&quot;Accumulator
<br>The Accumulator (A) is the main 8 bit register for loading, storing, comparing, and doing math on data. Some of the most frequent operations are:
<br>LDA #$FF  ;load the hex value $FF (decimal 256) into A
<br>STA $0000 ;store the accumulator into memory location $0000, internal RAM&quot;
<br>
<br>It should read decimal 255, not 265. great TUT so far.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__69">
                                                        <div class="mdl-card__title"><strong>Cockroachcharlie</strong> posted on 
		
			
				
				Sep 15, 2015 at 4:58:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok. I think I have figured out where my major roadblock is on 6502 design. I am going to write an excerpt in BASIC (we should all recognize this one)<br>
<br>
10: Print &quot;Hello World&quot;<br>
<br>
20 Goto 10<br>
<br>
It&apos;s obvious here why the words &quot;Hello World&quot; appear on the screen. The command &quot;Print&quot; told them to. I think that&apos;s where I am running into trouble here. In 6502 all I am STILL seeing is storing numbers in memory locations (after various tutorials and two books), but I am not understanding how all this number movement adds up to telling the processor to print &quot;Hello World&quot; to the screen. From this weeks tutorial<br>
<br>
LDA %10000000 ;intensify blues<br>
<br>
STA $2001<br>
<br>
I don&apos;t get how that storage is any different than storing at any other location, yet produces a different result. Can somebody explain what I am missing here or guide me to a place that would help me wrap my head around this part. I am actually becoming pretty educated in assembly, but still fail to see how to APPLY all of it to produce an intended result other than moving numbers around.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__70">
                                                        <div class="mdl-card__title"><strong>dra600n</strong> posted on 
		
			
				
				Sep 15, 2015 at 6:17:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Cockroachcharlie</b></i><br>
<br>
Ok. I think I have figured out where my major roadblock is on 6502 design. I am going to write an excerpt in BASIC (we should all recognize this one)<br>
<br>
10: Print &quot;Hello World&quot;<br>
<br>
20 Goto 10<br>
<br>
It&apos;s obvious here why the words &quot;Hello World&quot; appear on the screen. The command &quot;Print&quot; told them to. I think that&apos;s where I am running into trouble here. In 6502 all I am STILL seeing is storing numbers in memory locations (after various tutorials and two books), but I am not understanding how all this number movement adds up to telling the processor to print &quot;Hello World&quot; to the screen. From this weeks tutorial<br>
<br>
LDA %10000000 ;intensify blues<br>
<br>
STA $2001<br>
<br>
I don&apos;t get how that storage is any different than storing at any other location, yet produces a different result. Can somebody explain what I am missing here or guide me to a place that would help me wrap my head around this part. I am actually becoming pretty educated in assembly, but still fail to see how to APPLY all of it to produce an intended result other than moving numbers around.</div>
<br>
Different parts of RAM are utilized by the hardware, which use those values to control their inputs/outputs.&#xA0;<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__71">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Sep 15, 2015 at 6:17:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<a href="http://wiki.nesdev.com/w/index.php/PPU_registers" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_registers">http://wiki.nesdev.com/w/index.ph...</a><br>
<br>
As you can see from this wiki, the $2001 address is the address where the color emphasis is located.<br>
<br>
If you wanted to write actual text on the screen, as in HELLO WORLD, (assuming you were writing to the background, and not using sprites), first you would load $2002 to get the PPU ready, and then you would be using the $2006/$2007 registers to tell it where the text goes, and what background tiles contain those letters.<br>
<br>
You&apos;ll find out that you are basically using the same registers all the time when it comes to the NES. &#xA0;Some for sprites, some for background, etc.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__72">
                                                        <div class="mdl-card__title"><strong>Cockroachcharlie</strong> posted on 
		
			
				
				Sep 15, 2015 at 6:24:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					LOL.  Man.  I can see why people wanted to simplify it.  Assembly is seriously a lot different than anything I have ever worked with so far.  Again.  It&apos;s just hard to grasp how number transferring produces these results.  Almost like trying to visualize in pure binary.  So now that I have the actual coding a little more in place, I should probably work more on the architecture and the specifics of memory locations?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__73">
                                                        <div class="mdl-card__title"><strong>Lincoln</strong> posted on 
		
			
				
				Sep 15, 2015 at 6:27:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Cockroachcharlie</b></i><br>
<br>
Ok. I think I have figured out where my major roadblock is on 6502 design. I am going to write an excerpt in BASIC (we should all recognize this one)<br>
<br>
10: Print &quot;Hello World&quot;<br>
<br>
20 Goto 10<br>
<br>
It&apos;s obvious here why the words &quot;Hello World&quot; appear on the screen. The command &quot;Print&quot; told them to. I think that&apos;s where I am running into trouble here. In 6502 all I am STILL seeing is storing numbers in memory locations (after various tutorials and two books), but I am not understanding how all this number movement adds up to telling the processor to print &quot;Hello World&quot; to the screen. From this weeks tutorial<br>
<br>
LDA %10000000 ;intensify blues<br>
<br>
STA $2001<br>
<br>
I don&apos;t get how that storage is any different than storing at any other location, yet produces a different result. Can somebody explain what I am missing here or guide me to a place that would help me wrap my head around this part. I am actually becoming pretty educated in assembly, but still fail to see how to APPLY all of it to produce an intended result other than moving numbers around.</div>
<br>
<br>
on the NES, $2001 isn&apos;t really storage- it&apos;s like a set of switches the system provides you to interact with the graphics system. flipping the first switch does blue intensity, second switch is red, third is green (or vice versa on those last two), and whatever else the other 5 bits control. there are several addresses like this in the $2000 range that affect ppu activities, and there are more in the $4000 range that handle controller communication and audio, etc.&#xA0;<br>
<br>
I still don&apos;t know how to put hello world on the screen though. someone else can explain that.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__74">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Sep 15, 2015 at 6:47:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Cockroachcharlie</b></i><br>
<br>
LOL. Man. I can see why people wanted to simplify it. Assembly is seriously a lot different than anything I have ever worked with so far. Again. It&apos;s just hard to grasp how number transferring produces these results. Almost like trying to visualize in pure binary. So now that I have the actual coding a little more in place, I should probably work more on the architecture and the specifics of memory locations?</div>
<br>
You&apos;ll get used to the registers, there aren&apos;t too many so you&apos;ll get a good grasp on how they work the more you program.<br>
<br>
Also, here&apos;s how I would do a &quot;Hello World&quot; program if you&apos;re interested (Basically what KHAN said in code form). It&apos;s covered in a later tutorial, because even simple things like that need to have you understand the registers and what they do.<br>
<br>
&#xA0;&#xA0;<br>
<span style="font-family:courier new,courier,monospace;"><span style="font-size:12px;">&#xA0; LDA $2002 &#xA0; &#xA0; &#xA0; ;wake up PPU<br>
&#xA0;&#xA0;LDA #$22<br>
&#xA0;&#xA0;STA $2006 &#xA0; &#xA0; &#xA0; ;Write the hi part of the starting address to $2006<br>
&#xA0;&#xA0;LDA #$00<br>
&#xA0;&#xA0;STA $2006 &#xA0; &#xA0; &#xA0; ;and the second part.<br>
&#xA0;&#xA0;LDX #$00<br>
.hwloop<br>
&#xA0;&#xA0;LDA helloworld,x &#xA0; &#xA0; &#xA0; ;Draws h, e, l, l, o, etc. on the background with $2007<br>
&#xA0;&#xA0;STA $2007<br>
&#xA0;&#xA0;INX &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;x register makes the writing possible<br>
&#xA0;&#xA0;CPX #$0B &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;Do it 11 times<br>
&#xA0;&#xA0;BNE .hwloop<br>
<br>
helloworld:<br>
&#xA0;&#xA0;.db $11,$0E,$15,$15,$18,$2F,$20,$18,$1B,$14,$0D<br>
&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;The CHR goes like that.______0123456789ABCDEF<br>
&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;That&apos;s just my way of using__GHIJKLMNOPQRSTUV<br>
&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;using fonts on the CHR tho.__WXYZ.,-!?&#xA9;:;&apos;()&#xA0;</span></span><br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__75">
                                                        <div class="mdl-card__title"><strong>Cockroachcharlie</strong> posted on 
		
			
				
				Sep 15, 2015 at 7:00:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Vectrex280996</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>Cockroachcharlie</b></i><br>
<br>
LOL. Man. I can see why people wanted to simplify it. Assembly is seriously a lot different than anything I have ever worked with so far. Again. It&apos;s just hard to grasp how number transferring produces these results. Almost like trying to visualize in pure binary. So now that I have the actual coding a little more in place, I should probably work more on the architecture and the specifics of memory locations?</div>
<br>
You&apos;ll get used to the registers, there aren&apos;t too many so you&apos;ll get a good grasp on how they work the more you program.<br>
<br>
Also, here&apos;s how I would do a &quot;Hello World&quot; program if you&apos;re interested (Basically what KHAN said in code form). It&apos;s covered in a later tutorial, because even simple things like that need to have you understand the registers and what they do.<br>
<br>
&#xA0;&#xA0;<br>
<span style="font-family:courier new,courier,monospace;"><span style="font-size:12px;">&#xA0; LDA $2002 &#xA0; &#xA0; &#xA0; ;wake up PPU<br>
&#xA0;&#xA0;LDA #$22<br>
&#xA0;&#xA0;STA $2006 &#xA0; &#xA0; &#xA0; ;Write the hi part of the starting address to $2006<br>
&#xA0;&#xA0;LDA #$00<br>
&#xA0;&#xA0;STA $2006 &#xA0; &#xA0; &#xA0; ;and the second part.<br>
&#xA0;&#xA0;LDX #$00<br>
.hwloop<br>
&#xA0;&#xA0;LDA helloworld,x &#xA0; &#xA0; &#xA0; ;Draws h, e, l, l, o, etc. on the background with $2007<br>
&#xA0;&#xA0;STA $2007<br>
&#xA0;&#xA0;INX &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;x register makes the writing possible<br>
&#xA0;&#xA0;CPX #$0B &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;Do it 11 times<br>
&#xA0;&#xA0;BNE .hwloop<br>
<br>
helloworld:<br>
&#xA0;&#xA0;.db $11,$0E,$15,$15,$18,$2F,$20,$18,$1B,$14,$0D<br>
&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;The CHR goes like that.______0123456789ABCDEF<br>
&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;That&apos;s just my way of using__GHIJKLMNOPQRSTUV<br>
&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;using fonts on the CHR tho.__WXYZ.,-!?&#xA9;:;&apos;()&#xA0;</span></span><br>
&#xA0;</div>
<br>
I think I am starting to see what you mean.&#xA0; I actually grasped a lot of the &quot;what&quot; in what you wrote.&#xA0; It&apos;s the &quot;why&quot; that is still elusive, but coming together.&#xA0; From a basic standpoint, some parts of memory act as temporary/permanent data holders, while others act as (sorta) switchboards.&#xA0; I think with a little more research into the hardware topic itself (both my books fail to cover such aspects, but then, both were written in 1980 for a specific board).<br>
<br>
LOL.&#xA0; Sadly, in the class I took, as well as all studies, the actual hardware part was always where I was left with swirly eyes.&#xA0; But.&#xA0; My son and I are bound and determined to put a game onto our favorite console, so for once I have a reason not to just say to hell with it all.&#xA0; :-)<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__76">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Sep 15, 2015 at 7:03:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Honestly I think the best way to figure this stuff out is just to sit down, decide what you want to do, and then slowly get to work figuring out how to do it while asking questions.
<br>
<br>Trying to figure the entire NES architecture out from the start sounds terribly daunting to me.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__77">
                                                        <div class="mdl-card__title"><strong>Cockroachcharlie</strong> posted on 
		
			
				
				Sep 15, 2015 at 7:28:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Either way.&#xA0; Thanks guys.&#xA0; As I&apos;ve said elsewhere on these boards.&#xA0; Every little insight is a step forward that keeps me from giving up and the support this board has shown myself and others I see struggling is very uplifting.&#xA0; I think I have enough understanding that a little research will get me started on a simple thing to boost morale.&#xA0; Even if I can&apos;t do the &quot;from scratch&quot; method yet, two player controlled sprites running around the screen is a sure start.<br>
<br>
p.s.&#xA0; Is it considered kosher on these boards to post &quot;junk&quot; roms of our progress?<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__78">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Sep 17, 2015 at 6:34:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Cockroachcharlie</b></i><br>
<br>
Either way.&#xA0; Thanks guys.&#xA0; As I&apos;ve said elsewhere on these boards.&#xA0; Every little insight is a step forward that keeps me from giving up and the support this board has shown myself and others I see struggling is very uplifting.&#xA0; I think I have enough understanding that a little research will get me started on a simple thing to boost morale.&#xA0; Even if I can&apos;t do the &quot;from scratch&quot; method yet, two player controlled sprites running around the screen is a sure start.<br>
<br>
p.s.&#xA0; Is it considered kosher on these boards to post &quot;junk&quot; roms of our progress?<br>
&#xA0;</div>
<br>
Go ahead and do it. It is appreciated to post any kinds of homebrew ROMs IMO<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__79">
                                                        <div class="mdl-card__title"><strong>EvelynPangolins</strong> posted on 
		
			
				
				Dec 28, 2018 at 10:38:34 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					uhh, hi. So, im not used to using this kind of website but I am trying to learn to program for the NES. The only problem is, the zip file mentioned here doesnt seem to be anywhere. I just cant find the link. Am I being dumb? Is can someone send me it?&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-3__80">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 28, 2018 at 10:42:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you hover over the mentioned &quot;background.zip&quot; file it is a hyperlink, but here is the link location to make it a little easier on you: <a href="scraper/files/background.zip" target="_blank" original-href="http://www.nespowerpak.com/nesasm/background.zip">http://www.nespowerpak.com/nesasm...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>


                <div class="spacer"></div>

                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="main_tutorial-4">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">4: 调色板，精灵，第二个程序</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4440&amp;enterthread=y" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=4440&amp;enterthread=y">Previous Week</a> - 6502 ASM  <div><div><br class="webkit-block-placeholder"></div><div><span class="Apple-style-span" style="font-weight: bold;">This Week</span>: now that you can make and run a program, time to put something on screen!</div><div><br class="webkit-block-placeholder"></div><div><span class="Apple-style-span" style="font-weight: bold;"><span class="Apple-style-span" style="font-size: large;">Palettes</span></span><span class="Apple-style-span" style="font-size: large;">&#xA0;</span></div><div><br class="webkit-block-placeholder"></div><div>Before putting any graphics on screen, you first need to set the color palette.  There are two separate palettes, each 16 bytes.  One palette is used for the background, and the other for sprites.  The byte in the palette corresponds to one of the 64 base colors the NES can display.  $0D is a bad color and should not be used.  These colors are not exact and will look different on emulators and TVs.</div><div align="baseline"><br></div><div><img src original-src="http://www.NintendoAgeMedia.com/users/142/photobucket/4924FAF3-9FC9-CED2-8403873F9EA75342.png" show-src="scraper/images/4924FAF3-9FC9-CED2-8403873F9EA75342.png"><br class="webkit-block-placeholder"></div><div><br class="webkit-block-placeholder"></div><div>The palettes start at PPU address $3F00 and $3F10.  To set this address, PPU address port $2006 is used.  This port must be written twice, once for the high byte then for the low byte: </div><div><pre>  LDA $2002    ; read PPU status to reset the high/low latch to high<br>  LDA #$3F<br>  STA $2006    ; write the high byte of $3F10 address<br>  LDA #$10<br>  STA $2006    ; write the low byte of $3F10 address</pre></div><div>That code tells the PPU to set its address to $3F10.  Now the PPU data port at $2007 is ready to accept data.  The first write will go to the address you set ($3F10), then the PPU will automatically increment the address ($3F11, $3F12, $3F13) after each read or write.  You can keep writing data and it will keep incrementing.  This sets the first 4 colors in the palette:
<pre>  LDA #$32   ;code for light blueish<br>  STA $2007  ;write to PPU $3F10<br>  LDA #$14   ;code for pinkish<br>  STA $2007  ;write to PPU $3F11<br>  LDA #$2A   ;code for greenish<br>  STA $2007  ;write to PPU $3F12<br>  LDA #$16   ;code for redish<br>  STA $2007  ;write to PPU $3F13<br></pre>
You would continue to do writes to fill out the rest of the palette.  Fortunately there is a smaller way to write all that code.  First you can use the .db directive to store data bytes:<pre>PaletteData:<br>  .db $0F,$31,$32,$33,$0F,$35,$36,$37,$0F,$39,$3A,$3B,$0F,$3D,$3E,$0F  ;background palette data<br>  .db $0F,$1C,$15,$14,$0F,$02,$38,$3C,$0F,$1C,$15,$14,$0F,$02,$38,$3C  ;sprite palette data<br></pre>
Then a loop is used to copy those bytes to the palette in the PPU.  The X register is used as an index into the palette, and used to count how many times the loop has repeated.  You want to copy both palettes at once which is 32 bytes, so the loop starts at 0 and counts up to 32.<pre>  LDX #$00                ; start out at 0<br>LoadPalettesLoop:<br>  LDA PaletteData, x      ; load data from address (PaletteData + the value in x)<br>                          ; 1st time through loop it will load PaletteData+0<br>                          ; 2nd time through loop it will load PaletteData+1<br>                          ; 3rd time through loop it will load PaletteData+2<br>                          ; etc<br>  STA $2007               ; write to PPU<br>  INX                     ; X = X + 1<br>  CPX #$20                ; Compare X to hex $20, decimal 32<br>  BNE LoadPalettesLoop    ; Branch to LoadPalettesLoop if compare was Not Equal to zero<br>                          ; if compare was equal to 32, keep going down</pre><br><br><br class="webkit-block-placeholder">Once that code finishes, the full color palette is ready.  One byte or the whole thing can be changed while your program is running.</div><div><br class="webkit-block-placeholder"></div><div><br></div></div><span class="Apple-style-span" style="font-weight: bold;"><span class="Apple-style-span" style="font-size: large;">
Sprites</span></span><div><br class="webkit-block-placeholder"></div><div>Anything that moves separately from the background will be made of sprites.  A sprite is just an 8x8 pixel tile that the PPU renders anywhere on the screen.  Generally objects are made from multiple sprites next to each other.  Examples would be Mario and any of the enemies like Goombas and Bowser.  The PPU has enough internal memory for 64 sprites. This memory is separate from all other video memory and cannot be expanded.</div><div><br class="webkit-block-placeholder"></div><div><span class="Apple-style-span" style="font-weight: bold;">Sprite DMA </span></div><div>The fastest and easiest way to transfer your sprites to the sprite memory is using DMA (direct memory access).  This just means a block of RAM is copied from CPU memory to the PPU sprite memory. The on board RAM space from $0200-02FF is usually used for this purpose.  To start the transfer, two bytes need to be written to the PPU ports:<pre>  LDA #$00<br>  STA $2003  ; set the low byte (00) of the RAM address<br>  LDA #$02<br>  STA $4014  ; set the high byte (02) of the RAM address, start the transfer<br></pre>Once the second write is done the DMA transfer will start automatically.  All data for the 64 sprites will be copied.  Like all graphics updates, this needs to be done at the beginning of the VBlank period, so it will go in the NMI section of your code.</div><div><br class="webkit-block-placeholder"></div><div><span class="Apple-style-span" style="font-weight: bold;">Sprite Data</span> </div><div>Each sprite needs 4 bytes of data for its position and tile information in this order: </div><div><br class="webkit-block-placeholder"></div><div>1 - Y Position - vertical position of the sprite on screen.  $00 is the top of the screen.  Anything above $EF is off the bottom of the screen. </div><div><br class="webkit-block-placeholder"></div><div>2 - Tile Number - this is the tile number (0 to 256) for the graphic to be taken from a Pattern Table. </div><div><br class="webkit-block-placeholder"></div><div>3 - Attributes - this byte holds color and displaying information:<pre>  76543210<br>  |||   ||<br>  |||   ++- Color Palette of sprite.  Choose which set of 4 from the 16 colors to use<br>  |||<br>  ||+------ Priority (0: in front of background; 1: behind background)<br>  |+------- Flip sprite horizontally<br>  +-------- Flip sprite vertically<br></pre>4 - X Position - horizontal position on the screen.  $00 is the left side, anything above $F9 is off screen. </div><div><br class="webkit-block-placeholder"></div><div>Those 4 bytes repeat 64 times (one set per sprite) to fill the 256 bytes of sprite memory.  If you want to edit sprite 0, you change bytes $0200-0203.  Sprite 1 is $0204-0207, sprite 2 is $0208-020B, etc </div><div><br class="webkit-block-placeholder"></div><div><span class="Apple-style-span" style="font-weight: bold;">Turning NMI/Sprites On</span> </div><div>The PPU port $2001 is used again to enable sprites.  Setting bit 4 to 1 will make them appear.
NMI also needs to be turned on, so the Sprite DMA will run and the sprites will be copied every frame.  This is done with the PPU port $2000.  The Pattern Table 0 is also selected to choose sprites from.  Background will come from Pattern Table 1 when that is added later.<pre>  PPUCTRL ($2000)<br>  76543210<br>  | ||||||<br>  | ||||++- Base nametable address<br>  | ||||    (0 = $2000; 1 = $2400; 2 = $2800; 3 = $2C00)<br>  | |||+--- VRAM address increment per CPU read/write of PPUDATA<br>  | |||     (0: increment by 1, going across; 1: increment by 32, going down)<br>  | ||+---- Sprite pattern table address for 8x8 sprites (0: $0000; 1: $1000)<br>  | |+----- Background pattern table address (0: $0000; 1: $1000)<br>  | +------ Sprite size (0: 8x8; 1: 8x16)<br>  |<br>  +-------- Generate an NMI at the start of the<br>            vertical blanking interval vblank (0: off; 1: on)<br></pre>
And the new code to set up the sprite data:<pre>  LDA #$80<br>  STA $0200        ;put sprite 0 in center ($80) of screen vertically<br>  STA $0203        ;put sprite 0 in center ($80) of screen horizontally<br>  LDA #$00<br>  STA $0201        ;tile number = 0<br>  STA $0202        ;color palette = 0, no flipping<br><br>  LDA #%10000000   ; enable NMI, sprites from Pattern Table 0<br>  STA $2000<br><br>  LDA #%00010000   ; no intensify (black background), enable sprites<br>  STA $2001</pre><span class="Apple-style-span" style="font-weight: bold;"><div style="text-align: left;">Putting It All Together <br></div></span></div><div style="text-align: left;">Download and unzip the <a href="scraper/files/sprites.zip" target="_blank" original-href="http://www.nespowerpak.com/nesasm/sprites.zip">sprites.zip</a> sample files.  All the code above is in the sprites.asm file.  Make sure sprites.asm, mario.chr, and sprites.bat are all in the same folder as NESASM3, then double click sprites.bat.  That will run NESASM3 and should produce the sprites.nes file.  Run that NES file in FCEUXD SP to see your sprite!  Tile number 0 is the back of Mario&apos;s head and hat, can you see it?  Edit sprites.asm to change the sprite position (0 to 255), or to change the color palette for the sprite (0 to 3).
You can choose the PPU viewer in FCEUXD SP to see both Pattern Tables, and both Palettes.</div><div style="text-align: left;"><br class="webkit-block-placeholder"></div><div><span class="Apple-style-span" style="font-weight: bold;">Next Week</span>: multiple sprites, reading controllers</div>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#main_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;main_tutorial-4__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=6082" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>

                <div class="comments" style="display: none;" id="main_tutorial-4__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__1">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Feb 23, 2008 at 9:51:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Edited: Dain fixed formatting below!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__2">
                                                        <div class="mdl-card__title"><strong>Dain</strong> posted on 
		
			
				
				Feb 23, 2008 at 10:38:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Not sure why... I just re-saved and it fixed it. I&apos;ll take a look at the Apply-generated goulash.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__3">
                                                        <div class="mdl-card__title"><strong>Sivak</strong> posted on 
		
			
				
				Feb 24, 2008 at 1:23:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Seeing that palette again...&#xA0; Is there any way of knowing if $1D is black or a very dark grey?&#xA0; The whole XD range of the palette actually isn&apos;t clear.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__4">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Feb 24, 2008 at 2:56:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That palette isn&apos;t very accurate, it will be better to look at emulators like Nintendulator.  PAL and NTSC will also be slightly different.  Having 2 colors next to each other can blur them together or create new colors.  And of course RF vs composite will be different too.  Basically you have to test on a real NES and TV to see what it really looks like  <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__5">
                                                        <div class="mdl-card__title"><strong>NationalGameDepot</strong> posted on 
		
			
				
				Feb 24, 2008 at 10:49:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I gave up on the last Nerdy Nights...<img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-sad.gif" show-src="images/blank.gif">  I just don&apos;t have the know how for this kinda stuff.  If you teach once person though Brian it is worth it to have just 1 new game.
<br>~~NGD
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__6">
                                                        <div class="mdl-card__title"><strong>rizz</strong> posted on 
		
			
				
				Feb 11, 2010 at 5:42:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Could someone explain the need for loading $2002 before the accessing $2006?  Is it because vblank flag needs to be reset manually?  Also, during the memory clear, is there any reason putting sprites outside the visible area?  Or could the loop simply set everything to 0?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__7">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Feb 11, 2010 at 6:01:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You can use a loop to set the sprites offscreen, or clear them. It&apos;s actually done that way in the reset code. Took me a long time till I noticed that myself.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__8">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Feb 11, 2010 at 9:20:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					$2006 is a 16 bit address.  You write to it twice, once for the high byte of the address and once for the low byte.  But at reset or when your code is running you may not know if the PPU is expecting the high or the low byte.  If you write low but the PPU is expecting high then the address will be wrong.  So reading $2002 resets the PPU to expect the high byte first.
<div><br></div><div>After the initial setup you will almost entirely ignore the vblank flag. &#xA0;Instead you will use NMI.</div><div><br></div><div>Sprites go outside the visible area to cure some of confusion. &#xA0;If they are left at 0 all 64 sprites will be in the upper left corner. &#xA0;Because of the 8 sprites per scanline limit anything else you put on that top row will be invisible, possibly causing you to spend hours debugging for nothing &#xA0;<img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__9">
                                                        <div class="mdl-card__title"><strong>rizz</strong> posted on 
		
			
				
				Feb 12, 2010 at 1:29:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ah, so the 8 sprites per scanline even counts sprites that are turned off.
<br>
<br>So, is it necessary to read $2002 as a precaution every time you are writing addresses to the PPU registers?  Or are there only specific times?
<br>
<br>Is it best (or is it necessary) to turn off sprites &amp; background (using $2001) during all palette, sprite, and background updates?
<br>
<br>Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__10">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 12, 2010 at 3:21:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;d say yes yes and yes.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__11">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Feb 12, 2010 at 5:24:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>rizz</b></i><br><br>Ah, so the 8 sprites per scanline even counts sprites that are turned off.
<br>
<br>So, is it necessary to read $2002 as a precaution every time you are writing addresses to the PPU registers?  Or are there only specific times?
<br>
<br>Is it best (or is it necessary) to turn off sprites &amp; background (using $2001) during all palette, sprite, and background updates?
<br>
<br>Thanks!</div><br><br>The 8 sprites per scanline does count offscreen, but it doesn&apos;t really matter since you&apos;ll never see them. You can set them all offscreen.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__12">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Feb 12, 2010 at 5:57:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>rizz</b></i><br><br>Ah, so the 8 sprites per scanline even counts sprites that are turned off.
<br>
<br>So, is it necessary to read $2002 as a precaution every time you are writing addresses to the PPU registers?  Or are there only specific times?
<br>
<br>Is it best (or is it necessary) to turn off sprites &amp; background (using $2001) during all palette, sprite, and background updates?
<br>
<br>Thanks!</div><br><br>You don&apos;t have to read $2002 if you know for a fact that $2006 is already expecting a high byte.&#xA0; If you don&apos;t know, or are unsure, it&apos;s best to read it as a precaution.&#xA0; An example of when you would know might be a case like this:<br><br>lda $2002 ;reset hi/lo latch<br>lda #$20<br>sta $2006<br>lda #$00 <br>sta $2006<br>sta $2007<br><br>lda #$23&#xA0;&#xA0; ;look, we didn&apos;t need to read $2002 here<br>sta $2006<br>lda #$C0<br>sta $2006<br>lda #$00<br>sta $2007<br><br>We don&apos;t need to read $2002 here because we know $2006 is expecting a high byte since we wrote to $2006 exactly two times since we read $2002.<br><br>As for turning off sprites/bg, you definitely <span style="font-weight: bold;">don&apos;t</span> want to do it everytime you update something or your screen will black out every update (turning off BG blacks out the screen).<br><br>You <span style="font-weight: bold;">do</span> want to make sure all your graphics updates are done during vblank (in your NMI routine) though.&#xA0; This includes writing palettes, updating nametables and performing sprite DMA.<br><br>The only time you&apos;d need to turn sprites/bg off would be if you need to draw an entire screen all in one go, like redrawing the title screen after the game is over, or drawing the first screen at the beginning of a new level or something like that.&#xA0; In these cases you need more drawing time than vblank allows, and a black transition screen is usually desirable.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__13">
                                                        <div class="mdl-card__title"><strong>steamx</strong> posted on 
		
			
				
				Aug 27, 2010 at 10:05:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					edit: This is based on this tutorial number 4. You can try it with the next one (that is 5) too, but be sure to understand what i did. It will help you to understand ASM. It is very simple though.)<br>If someone wants multiple sprites (max 8) but has problems you can try this code:<br>
<pre>  LDA #$80<br>  STA $0200        ; put sprite 0 in center ($80) of screen vert<br>  STA $0203        ; put sprite 0 in center ($80) of screen horiz<br>  LDA #$00<br>  STA $0201        ; tile number = 0<br>  STA $0202        ; color = 0, no flipping<br><br>  LDA #$80<br>  STA $0204<br>  LDA #$88<br>  STA $0207<br>  LDA #$01<br>  STA $0205<br>  LDA #$00<br>  STA $0206<br><br>  LDA #$88<br>  STA $0208<br>  LDA #$80<br>  STA $020B<br>  LDA #$02<br>  STA $0209<br>  LDA #$00<br>  STA $020A<br><br>  LDA #$88<br>  STA $020C<br>  LDA #$88<br>  STA $020F<br>  LDA #$03<br>  STA $020D<br>  LDA #$00<br>  STA $020E<br><br>  LDA #$90<br>  STA $0210<br>  LDA #$80<br>  STA $0213<br>  LDA #$04<br>  STA $0211<br>  LDA #$00<br>  STA $0212<br><br>  LDA #$90<br>  STA $0214<br>  LDA #$88<br>  STA $0217<br>  LDA #$05<br>  STA $0215<br>  LDA #$00<br>  STA $0216<br><br>  LDA #$98<br>  STA $0218<br>  LDA #$80<br>  STA $021B<br>  LDA #$06<br>  STA $0219<br>  LDA #$00<br>  STA $021A<br><br>  LDA #$98<br>  STA $021C<br>  LDA #$88<br>  STA $021F<br>  LDA #$07<br>  STA $021D<br>  LDA #$00<br>  STA $021E<br><br>  LDA #%10000000   ; enable NMI, sprites from Pattern Table 0<br>  STA $2000<br><br>  LDA #%00010000   ; enable sprites<br>  STA $2001<br></pre><br> Replace it with the original code and you&apos;ll get a full Mario who is prepared to jump <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-wink.gif" show-src="images/blank.gif"><br>Oh by the way a question. How did they include the enemies and other sprites? With a mapper or did they use tiles?<br><br>P.S.: Replace the first 4 numbers of your sprite palette with $0F,$16,$27,$18 and you&apos;ll get a Mario that is as close as possible to the original (they do have a small color difference. Maybe because of PAL and NTSC. I don&apos;t know)<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__14">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Aug 27, 2010 at 10:25:02 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>steamx</b></i><br><br>edit: This is based on this tutorial number 4. You can try it with the next one (that is 5) too, but be sure to understand what i did. It will help you to understand ASM. It is very simple though.)<br>If someone wants multiple sprites (max 8) but has problems you can try this code:<br><pre>  LDA #$80<br>  STA $0200        ; put sprite 0 in center ($80) of screen vert<br>  STA $0203        ; put sprite 0 in center ($80) of screen horiz<br>  LDA #$00<br>  STA $0201        ; tile number = 0<br>  STA $0202        ; color = 0, no flipping<br><br>  LDA #$80<br>  STA $0204<br>  LDA #$88<br>  STA $0207<br>  LDA #$01<br>  STA $0205<br>  LDA #$00<br>  STA $0206<br><br>  LDA #$88<br>  STA $0208<br>  LDA #$80<br>  STA $020B<br>  LDA #$02<br>  STA $0209<br>  LDA #$00<br>  STA $020A<br><br>  LDA #$88<br>  STA $020C<br>  LDA #$88<br>  STA $020F<br>  LDA #$03<br>  STA $020D<br>  LDA #$00<br>  STA $020E<br><br>  LDA #$90<br>  STA $0210<br>  LDA #$80<br>  STA $0213<br>  LDA #$04<br>  STA $0211<br>  LDA #$00<br>  STA $0212<br><br>  LDA #$90<br>  STA $0214<br>  LDA #$88<br>  STA $0217<br>  LDA #$05<br>  STA $0215<br>  LDA #$00<br>  STA $0216<br><br>  LDA #$98<br>  STA $0218<br>  LDA #$80<br>  STA $021B<br>  LDA #$06<br>  STA $0219<br>  LDA #$00<br>  STA $021A<br><br>  LDA #$98<br>  STA $021C<br>  LDA #$88<br>  STA $021F<br>  LDA #$07<br>  STA $021D<br>  LDA #$00<br>  STA $021E<br><br>  LDA #%10000000   ; enable NMI, sprites from Pattern Table 0<br>  STA $2000<br><br>  LDA #%00010000   ; enable sprites<br>  STA $2001<br></pre><br>Replace it with the original code and you&apos;ll get a full Mario who is prepared to jump <img src border="0" complete="true" style="display: none;" original-src="/media/_images/expressions/face-icon-small-wink.gif" show-src="images/blank.gif"><br>Oh by the way a question. How did they include the enemies and other sprites? With a mapper or did they use tiles?<br><br>P.S.: Replace the first 4 numbers of your sprite palette with $0F,$16,$27,$18 and you&apos;ll get a Mario that is as close as possible to the original (they do have a small color difference. Maybe because of PAL and NTSC. I don&apos;t know)<br></div><p><br>That&apos;s a lot of hard coding right there.&#xA0; I&apos;d do something like this:</p><p>data:<br>&#xA0; .db $80,$00,$00,$80,$80,$01,$00,$88, etc.</p><p><br>load_sprite_data:</p><p>&#xA0; LDX #$00</p><p>.loop:<br>&#xA0; LDA data,x<br>&#xA0; STA $0200,x<br>&#xA0; INX<br>&#xA0; CPX #$??<br>&#xA0; BNE .loop</p><p>RTS</p><p>Cleaner and easier to read.</p><p></p><p><br><br></p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__15">
                                                        <div class="mdl-card__title"><strong>steamx</strong> posted on 
		
			
				
				Aug 27, 2010 at 10:30:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I know its in the next tutorial. But i wanted to try it with doing it again and again by my self to understand it better. Because this is what the loop does.
<br>Btw i didn&apos;t read the scanline thing so the question with the enemies is solved....
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__16">
                                                        <div class="mdl-card__title"><strong>-Basti-</strong> posted on 
		
			
				
				Sep 23, 2010 at 6:11:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					how can I expand the memory space for sprites? I need 356 (#$164 bytes of space.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__17">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Sep 23, 2010 at 10:39:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You don&apos;t, it is a fixed space inside the PPU.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__18">
                                                        <div class="mdl-card__title"><strong>-Basti-</strong> posted on 
		
			
				
				Sep 23, 2010 at 10:49:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Damn! So there is no way to display more than 63 tiles at once?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__19">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Sep 23, 2010 at 12:03:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Nope, 64 sprites is the limit.  Other than that you&apos;re going to have to do tricks with backgrounds.
<br>
<br>I can&apos;t imagine needing more than 64 sprites at a time though.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__20">
                                                        <div class="mdl-card__title"><strong>Jemoozu</strong> posted on 
		
			
				
				Feb 24, 2011 at 10:42:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yikes! This is gonna make my head explode! Which address(es) indicates the position of the sprite? How do I do that?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__21">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 24, 2011 at 10:48:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; ">  LDA #$00<br>  STA $2003  ; set the low byte (00) of the RAM address<br>  LDA #$02<br>  STA $4014  ; set the high byte (02) of the RAM address, start the transfer</pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; "><br></pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; ">That piece of code tells the PPU&apos;s internal sprite RAM to point to the first sprite RAM spot (#$00) to start uploading sprites. $02 tells it to put the sprites from $200-$2FF inside the NES to that memory. (Called sprite DMA. Uploads faster then a LDA STA loop which is why we use the special pointer. Can also point to $300, $400, and so on. Uploading bytes $X00-$XFF to the sprite RAM, but $200 is used consistently for sprite data, so that&apos;s why it&apos;s used. Pretty much a &quot;standard&quot; spot.)</pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; "><br></pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; "><br></pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; ">So locations $200-$2FF of the RAM inside the NES holds 64 sprites. 256/64=4, so every 4 bytes is a new sprite. The 4 bytes used for the sprite data are called the attributes.</pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; ">Byte $200 (1st sprite, 1st attribute)</pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; ">Y position on screen. Moves the sprite up/down. 0=top, Higher number, more down is goes.</pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; "><br></pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; ">Byte $201 (1st sprite, 2nd attribute)</pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; ">Tile number. whatever bank is switched on, the tile number from that bank will be put on the screen. In most programs, the 2nd 4K &quot;page&quot; of CHR-ROM are the sprites.</pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; "><br></pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; ">Byte $202 (1st sprite, 3rd attribute)</pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; ">Other misc. attributes. Each bit does this function in this byte:</pre><pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; white-space: normal; "><pre>  76543210<br>  |||   ||<br>  |||   ++- Color Palette of sprite.  Choose which set of 4 from the 16 colors to use<br>  |||<br>  ||+------ Priority (0: in front of background; 1: behind background)<br>  |+------- Flip sprite horizontally<br>  +-------- Flip sprite vertically</pre></pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; white-space: normal; "><br></pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; white-space: normal; ">Byte $203 (1st sprite, 4th attribute)</pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; white-space: normal; ">X position on the screen. Moves player character left/right. 0=far left. Higher the number, more right it goes.</pre><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; white-space: normal; "><br></pre><pre><span class="Apple-style-span" style="font-size: 11px; ">Bytes $204-$207, $208-$20B, $20C-$20F, $210-$213 of Sprite RAM are different sprites, but each follows the same attributes. For unused sprites, just write #$FF to the Y locaion and they will be put off the screen. If you write #$FF to the X, It may cause sprite overflow on some scanlines and cause sprites not to show up. (There can only be 8 sprites per scanline. Any sprite after the first 8 will be left out. The ones that come first in RAM will be shown on top/in priority to other sprites if there&apos;s overflow/overlap.)</span></pre><pre><span class="Apple-style-span" style="font-size: 11px; "><br></span></pre><pre><span class="Apple-style-span" style="font-size: 11px; ">Hope this helps you understand, I simplified it a lot for the sake of making it easier to understand, but if you get this, understanding the technicalities behind it isn&apos;t so hard. Any questions, just PM me.</span></pre></pre>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__22">
                                                        <div class="mdl-card__title"><strong>Jemoozu</strong> posted on 
		
			
				
				Feb 24, 2011 at 11:39:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here&apos;s what I did, I don&apos;t know if this is correct or not.
<br>
<br>The original code:
<br>
<br> LDA #$80
<br>  STA $0200        ; put sprite 0 in center ($80) of screen vert
<br>  STA $0203        ; put sprite 0 in center ($80) of screen horiz
<br>  LDA #$00
<br>  STA $0201        ; tile number = 2
<br>  STA $0202        ; color = 2, no flipping
<br>
<br>Newer code:
<br>
<br> LDA #$C0
<br>  STA $0200        ; put sprite 0 in center ($80) of screen vert
<br>  STA $0203        ; put sprite 0 in center ($80) of screen horiz
<br>  LDA #$00
<br>  STA $0201        ; tile number = 2
<br>  STA $0202        ; color = 2, no flipping
<br>
<br>I only changed the value of #$80, because when I messed with $#00 
and $#80, the sprite was translated to a different part of the screen, 
but it changed. By changing only $#80, the sprite moved, but it retained
 its original form.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__23">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 25, 2011 at 12:01:56 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Not sure what the question is. <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
<br>
<br>Yes, changing the value you are storing to $0200 and $0203 will change the horizontal and vertical positioning.
<br>
<br>I&apos;m not sure what color = 2 means.  You&apos;re writing 0 to the color, so it would take the first palette.  And also, the tile number you&apos;re writing is 0, and not 2. <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__24">
                                                        <div class="mdl-card__title"><strong>Jemoozu</strong> posted on 
		
			
				
				Feb 25, 2011 at 12:12:08 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br><br>Not sure what the question is. <img border="0" src style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
<br>
<br>Yes, changing the value you are storing to $0200 and $0203 will change the horizontal and vertical positioning.
<br>
<br>I&apos;m not sure what color = 2 means.  You&apos;re writing 0 to the color, so it would take the first palette.  And also, the tile number you&apos;re writing is 0, and not 2. <img border="0" src style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"></div><br><br>Oops! I completely forgot that I changed 0 to 2 in the comments area thinking it would do something (silly me <img src style="display: none;" original-src="/media/_images/expressions/face-icon-small-confused.gif" show-src="images/blank.gif">). My concern was how I can change the position of the sprite with out altering sprite 0.<br><br>Speaking of color, what address do I need to go to to change the color or palette of the sprite?<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__25">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 25, 2011 at 7:24:43 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You need to point the PPU to the sprite RAM. Without looking I want to say:
<br>
<br>LDA $2002
<br>LDA #$3F<br>STA $2003
<br>LDA #$00&#xA0;<br>STA $2003
<br>
<br>That will point it to the PPU&apos;s pallet ram. Then you upload a new pallet, or you can do something like storing $3F10 and then only change the pallets you need. Go to $3020 to upload both palettes at the same time.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__26">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 25, 2011 at 8:39:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					3GenGames, you&apos;ve confused me. The sprite palettes are in bits 0and1, not as you&apos;ve specified above. Also. Couple other things I can&apos;t xo on my phone.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__27">
                                                        <div class="mdl-card__title"><strong>albailey</strong> posted on 
		
			
				
				Feb 25, 2011 at 9:27:44 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Do this to change the palette for sprites:
<br>LDA $2002   ; this resets the toggle
<br>LDA #$3F 
<br>STA $2006 
<br>LDA #$10 
<br>STA $2006 
<br>
<br>        LDX #$00
<br>:       LDA myPaletteTable,x
<br>        STA $2007
<br>        inx
<br>        cpx #$10 ; $10 hex == 16 decimal
<br>        bne :-
<br>
<br>This gets you pointing at $3F10  which is the first of the sprite palette.
<br>It then copies 16 bytes to the sprite palette.
<br>
<br>This assumes you are set to increment PPU by 1.
<br>
<br>Refer to this page: <a href="http://wiki.nesdev.com/w/index.php/PPU_registers" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_registers">http://wiki.nesdev.com/w/index.ph...</a> and the entry that says: VRAM address increment per CPU read/write of PPUDATA
<br>
<br>
<br><div><br></div><div>As for your question about sprite 0.</div><div>It appears that you are using mem page 2 for sprites.</div><div>That means $0200-02FF will represent all 64 possible sprites you can have on the screen.</div><div>$0200-$0203 &#xA0;are for sprite 0</div><div><div>$0204-$0207 &#xA0;are for sprite 1</div><div>etc..</div><div><br></div><div>If you want to create or move a different sprite, do so for the memory that corresponds to that sprite.</div><div>Al</div><div><br></div>
<br>Al
</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__28">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 25, 2011 at 10:56:44 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes, if you want to move NOT sprite 0, you skip $0200-$0203 and just move $0204 and $0207 for sprite 1.<br>
<br>To change the color of the sprite, you need to first of all edit the palettes that you have.  There are four different palette sections for sprites.  Something like this is in your document if you&apos;re using nerdy nights. <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
<br>
<br>$xx,$00,$00,$00, $xx,$00,$00,$00, $xx,$00,$00,$00, $xx,$00,$00,$00 ;sprites
<br>$xx,$00,$00,$00, $xx,$00,$00,$00, $xx,$00,$00,$00, $xx,$00,$00,$00 ;background
<br>
<br>The first 16 bytes are the color palette for sprites.  You need to write #$00 to $0202 to use the first section, #$01 to $0202 to use the second palette, #$02 to $0203 to use the third, and #$03 to use the fourth.
<br>
<br>Of course you&apos;re going to need to change all of the values in the palette area to something other than $00 to get colors you want.
<br>
<br>The first color in each of the 16 4-byte sections (designated here with x&apos;s) is the transparent color.  Usually these all need to be the same, but I think basically whatever you have the first value set at, it will automatically make the other 7 first-bytes that same value.  So don&apos;t be surprised if you try to change that color and nothing happens.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__29">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 25, 2011 at 3:36:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br>3GenGames, you&apos;ve confused me. The sprite palettes are in bits 0and1, not as you&apos;ve specified above. Also. Couple other things I can&apos;t xo on my phone.</div><br><br>Sorry. I am touching on changing the palette since I thought he just asked that, but I guess he wants to assign the sprite a different palette. Since he is confused about the palette assigning, I&apos;ll try to help with that now:<div><br></div><div><br><div>
<div>Bits number 0 and 1 assign the color palette inside the attributes byte of sprite RAM in the 3rd register for sprite RAM.</div></div></div><div><br></div><div>#%00000000=Palette 0;</div><div>#%00000001=Palette 1;</div><div>#%00000010=Palette 2;</div><div>#%00000011=Palette 3;</div><div><br></div><div><br></div><div>Those values will change what palette the sprite uses. if you want any other attributes set, just set the bits you want (ORA instruction):</div><div><br></div><div><span class="Apple-style-span" style="font-family: monospace; white-space: pre; font-size: 11px; "><pre style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 11px; white-space: normal; "><pre>  76543210<br>  |||   ||<br>  |||   ++- Color Palette of sprite.  Choose which set of 4 from the 16 colors to use<br>  |||<br>  ||+------ Priority (0: in front of background; 1: behind background)<br>  |+------- Flip sprite horizontally<br>  +-------- Flip sprite vertically</pre><pre><br></pre><pre>Edit: fixed text width to fixed-width. Sorry for the mix up.</pre></pre></span></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__30">
                                                        <div class="mdl-card__title"><strong>toshi5o3</strong> posted on 
		
			
				
				Jul 24, 2011 at 8:40:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Finally had a chance to get back on track with the lessons! Went back a bit to refresh what I had studied, but so far so good. Lesson 4 is in the bag! It&apos;s really cool to be able to change the colors on the back of Mario&apos;s head/hat. Cheers!<br><br><span id="emo_beer" class="sprites_emoticons absmiddle"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__31">
                                                        <div class="mdl-card__title"><strong>Laserbeak43</strong> posted on 
		
			
				
				Aug 3, 2011 at 3:36:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br><div><div>$0D is a bad color and should not be used. </div></div></div><br><br><br>was that a joke? <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__32">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Aug 3, 2011 at 3:38:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Laserbeak43</b></i><br><br><div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br><div><div>$0D is a bad color and should not be used. </div></div></div><br><br><br>was that a joke? <span class="sprites_emoticons absmiddle" id="emo_smile"></span></div><br><br>Nope. On digitally run TV&apos;s, it will likely roll the screen. Don&apos;t use it. Use 0F.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__33">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				Aug 3, 2011 at 4:58:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>3GenGames</b></i><br><br><div class="FTQUOTE"><i>Originally posted by: <b>Laserbeak43</b></i><br><br><div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br><div><div>$0D is a bad color and should not be used. </div></div></div><br><br><br>was that a joke? <span class="sprites_emoticons absmiddle" id="emo_smile"></span></div><br><br>Nope. On digitally run TV&apos;s, it will likely roll the screen. Don&apos;t use it. Use 0F.</div>Quoted from nesdev wiki &quot;Note that a value of $0D should not be used (brightness=0, hue=13), as this results in a &quot;blacker than black&quot; color that causes stability problems on some televisions. &quot;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__34">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Aug 3, 2011 at 5:04:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That&apos;d be it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__35">
                                                        <div class="mdl-card__title"><strong>derekb</strong> posted on 
		
			
				
				Sep 3, 2011 at 8:24:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m having a trouble doing palette cycling and was wondering if anyone could help, when I change a palette color my entire background winds up pushing itself down for some reason, my lil code snip is
<br>
<br>[code]
<br>   lda	 $2002
<br>   lda   #$3F
<br>   sta   $2006
<br>   lda   #$00
<br>   sta   $2006
<br>   lda   #$0F
<br>   sta   $2007
<br>   RTS
<br>[/code]
<br>
<br>before:
<br>
<br><img src original-src="http://bombsomedodongos.com/a/images/001.png" show-src="images/missing/001.png">
<br>
<br>after code runs:
<br>
<br><img src original-src="http://bombsomedodongos.com/a/images/002.png" show-src="images/missing/002.png">
<br>
<br>(the boxes on top are just reference points to see whats happened)
<br>
<br>if anyone has an idea off top of their head of what would cause this please lmk <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__36">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Sep 3, 2011 at 8:37:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Are you only doing it in vblank? That could be because of the $2006 writes during rendering aren&apos;t the same as pointing it so memory, it affects the internal registers for such things as scroll and stuff. And also, you&apos;re only changing palette 0 there, so that&apos;ll only affect the background color 0, making it 0F, which is the right color black. For best help, post all of your code and we can point all the stuff out.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__37">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Sep 3, 2011 at 8:58:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>derekb</b></i><br><br>I&apos;m having a trouble doing palette cycling and was wondering if anyone could help, when I change a palette color my entire background winds up pushing itself down for some reason, my lil code snip is&#xA0;</div><br><b>Always</b> at the end of vblank, after all PPU updates (but still in vblank) remember to set the scroll using $2005 <b>*and*</b> $2000.<br><br>
<div>Something like this should be enough if you just want to scroll to the upper left corner (of course you can change the $2000 flags depending on your needs):</div><div><br></div><div>lda #%10001000</div><div>sta $2000</div><div>lda #0</div><div>sta $2005</div><div>sta $2005</div><div><br></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__38">
                                                        <div class="mdl-card__title"><strong>derekb</strong> posted on 
		
			
				
				Sep 4, 2011 at 8:36:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					3GenGames: I&apos;m gonna change more palette values, I just condensed my code down to easily show the problem
<br>
<br>thefox thanks I&apos;ll try that out
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__39">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Sep 4, 2011 at 8:40:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you want me to help, I&apos;m online all the time, just send me a PM and I&apos;ll work with you to fix it. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__40">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 14, 2012 at 1:44:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Just curious, where in the PPU memory are these 64 sprites stored which you transferred via DMA, where is sprite memory located?
<br>I thought it would be somewhere between $0000 and $2000 but the mario.chr data is stored there correct?
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__41">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Feb 14, 2012 at 1:52:52 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sprites are in their own RAM, internal to the PPU chip.  Writing them with DMA is the only reliable way to access it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__42">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 14, 2012 at 2:15:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok then, thanks for the quick reply bunnyboy!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__43">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 15, 2012 at 4:46:43 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					*Edit*<br>
This should only be posted in the week 5 tutorial section, remove this post. I accidently posted here first, wasn&apos;t paying attention as to which week I was posting under.<br>
<br>
Is this an acceptable way to make sprites move slower than 1 pixel per Vblank:<br>
<br>
; Just before JMP Forever I cleared the X register.<br>
ReadA:<br>
LDA $4016 ; player 1 - A<br>
AND #%00000001 ; only look at bit 0<br>
BEQ ReadADone ; branch to ReadADone if button is NOT pressed (0)<br>
; add instructions here to do something when button IS pressed (1)<br>
INX ; if a press is registered for 3 Vblanks then translate the sprite.<br>
CPX #$03<br>
BNE ReadADone<br>
LDX #$00 ; Once it has been moved reset the Vblank counter.<br>
LDA $0203 ; load sprite X position<br>
CLC ; make sure the carry flag is clear<br>
ADC #$01 ; A = A + 3 (changed to 3)<br>
STA $0203 ; save sprite X position (sprite moves 1 unit right).<br>
ReadADone: ; handling this button is done<br>
<br>
I&apos;ve tried it and it works, just wondering if it&apos;s the right way to go about it.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__44">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 18, 2012 at 2:25:06 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hmm, I can get mario to move as a whole, but I get an additional sprite moving along at the top of the screen, it appears to be a duplicate of the first sprite. Any idea why this would happen? Here is my code to shift mario across:<br>
<br>
<br>
&#xA0;&#xA0;&#xA0;&#xA0; LDX $00<br>
ReadA:<br>
&#xA0;&#xA0;&#xA0;&#xA0; LDA $4016 ; player 1 - A<br>
&#xA0;&#xA0;&#xA0;&#xA0; AND #%00000001 ; only look at bit 0<br>
&#xA0;&#xA0;&#xA0;&#xA0; BEQ ReadADone ; branch to ReadADone if button is NOT pressed (0)<br>
; add instructions here to do something when button IS pressed (1)<br>
SpriteUpdateA<br>
&#xA0;&#xA0;&#xA0;&#xA0; LDA $0203,x ; load sprite X position with offset<br>
&#xA0;&#xA0;&#xA0;&#xA0; CLC ; make sure the carry flag is clear<br>
&#xA0;&#xA0;&#xA0;&#xA0; ADC #$01 ; A = A + 1<br>
&#xA0;&#xA0;&#xA0;&#xA0; STA $0203,x ; save sprite X position (sprite moves 1 unit right).<br>
&#xA0;&#xA0;&#xA0;&#xA0; INX<br>
&#xA0;&#xA0;&#xA0;&#xA0; INX<br>
&#xA0;&#xA0;&#xA0;&#xA0; INX<br>
&#xA0;&#xA0;&#xA0;&#xA0; INX<br>
&#xA0;&#xA0;&#xA0;&#xA0; CPX $10 ; When x=16 done all sprites.<br>
&#xA0;&#xA0;&#xA0;&#xA0; BNE SpriteUpdateA<br>
ReadADone: ; handling this button is done<br>
<br>
I do the exact same for moving left but I subtract of course <span class="sprites_emoticons absmiddle" id="emo_smile"></span> But the algorithm is the same.<br>
<br>
*Edit*<br>
I fixed it! ah damn syntax, I didn&apos;t put a &apos;#&quot; before $! But I&apos;m still curious as to why another mario sprite would appear?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__45">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 18, 2012 at 11:01:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It&apos;s hard to say but effectively what that code would be doing is loading a number representing each sprite&apos;s x-coordinate, adding the value stored at memory address $0001, then storing that value in the sprite&apos;s x-coordinate.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__46">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 19, 2012 at 3:33:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah that&apos;s exactly what I thought, it is quite strange how the y-coordinate is effected by comparing the value stored at memory address $10 and not the value #$10. Especially because I am not doing anything with the addresses which hold the y-coordinates. I think it might actually have to do with how I wrote the address (even though that wasn&apos;t intended), normally they are written as a 4 digit hex value, I think that&apos;s the key, it&apos;s incorrect syntax.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__47">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 19, 2012 at 3:42:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Can I see your entire code?  Paste it at pastebin.com, please.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__48">
                                                        <div class="mdl-card__title"><strong>SomewhatEvil</strong> posted on 
		
			
				
				Aug 8, 2012 at 7:50:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I was having some issues with the palette, so I tried to run the provided code for this section as a sanity check. Unfortunately I don&apos;t think I&apos;m getting the expected results.
<br>
<br>When I run sprites.nes in FCEUX I get this:
<br><a href="http://i.imgur.com/R0VYK.png" target="_blank" original-href="http://i.imgur.com/R0VYK.png">http://i.imgur.com/R0VYK.png...</a>
<br>
<br>Here is the debug PPU viewer:
<br><a href="http://i.imgur.com/hO3ln.png" target="_blank" original-href="http://i.imgur.com/hO3ln.png">http://i.imgur.com/hO3ln.png...</a>
<br>
<br>Anyone know why the provided code may not be running as expected? It looks to me like some of the color palette isn&apos;t loading properly. The patterns table also looks a bit weird, but it may just be that this is the first patterns table I&apos;ve looked at since I&apos;m following along with the series.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__49">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				Aug 8, 2012 at 8:16:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Looks like it is running as expected.  You need to change your palette entries if you want it the colors YOU want.  The colors are from the chart in the first post.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__50">
                                                        <div class="mdl-card__title"><strong>SomewhatEvil</strong> posted on 
		
			
				
				Aug 8, 2012 at 10:15:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Okay, I guess I just got confused when it said that it should look like Mario&apos;s hat. I guess I assumed the sample code was intending to also use the same colors as used in game, but I probably should have noticed that wasn&apos;t the case looking through the source.
<br>
<br>Thanks for your help =)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__51">
                                                        <div class="mdl-card__title"><strong>Samarth</strong> posted on 
		
			
				
				Feb 16, 2013 at 9:28:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					ok, question, why did u set the color palletes? wat will be the use of the colors your stored in the memory from $3F10?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__52">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 16, 2013 at 9:33:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think he set the palette just to show how the data is transferred. But the pallet entries at 0x3000 are the background, and 0x3010 are sprites. 16 bytes. Not all the bytes are there. Keep the background color the same for each 4th entry as writes are mirrored down (3010 goes to 3000 entry.) and will screw up if not written right.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__53">
                                                        <div class="mdl-card__title"><strong>Samarth</strong> posted on 
		
			
				
				Feb 16, 2013 at 10:45:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					but this is in the code sprite.asm :-
<br>
<br>
<br>
<br>LoadPalettes:
<br>  LDA $2002    ; read PPU status to reset the high/low latch
<br>  LDA #$3F
<br>  STA $2006    ; write the high byte of $3F00 address
<br>  LDA #$00
<br>  STA $2006    ; write the low byte of $3F00 address
<br>  LDX #$00
<br>LoadPalettesLoop:
<br>  LDA palette, x        ;load palette byte
<br>  STA $2007             ;write to PPU
<br>  INX                   ;set index to next byte
<br>  CPX #$20            
<br>  BNE LoadPalettesLoop  ;if x = $20, 32 bytes copied, all done
<br>
<br>
<br>
<br>that means palletes are loaded to $3F00, but i couldn&apos;t figure out, where is this data getting used in?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__54">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 16, 2013 at 11:48:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The data is loaded through the PPU $2007 register after wiriting $3f00 to PPUAddr because the data goes to the PPU, The CPU doesn&apos;t access the pallet RAM directly, it does it through the PPU. But the LDA palette,X loads the data from the array pointed to by the pallet label. Then, the STA $2007 store it to the PPU with then puts it to the area that the PPUAddr ($2006 register) points to.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__55">
                                                        <div class="mdl-card__title"><strong>Samarth</strong> posted on 
		
			
				
				Feb 17, 2013 at 2:01:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					yup, i agree with that, but i am confused, about the use of storing that data into PPU ram, what happens of the stored data after $3F00? where are they loaded on screen? or where is the color seen on the screen? these colors are those which are included in background and sprites, but what is this data
<br>
<br>
<br>  .bank 1
<br>  .org $E000
<br>palette:
<br>  .db $0F,$31,$32,$33,$0F,$35,$36,$37,$0F,$39,$3A,$3B,$0F,$3D,$3E,$0F
<br>  .db $0F,$1C,$15,$14,$0F,$02,$38,$3C,$0F,$1C,$15,$14,$0F,$02,$38,$3C
<br>
<br>helping the sprite to color up?
<br>
<br>because the sprite data [in mario.chr] is
<br>
<br>0 0 0 0 0 0 1 1
<br>0 0 0 0 1 1 1 1 
<br>0 0 0 1 1 1 1 1 
<br>0 0 0 1 1 1 0 0 
<br>0 0 1 0 0 1 0 0
<br>0 0 1 0 0 1 1 0 
<br>0 1 1 0 0 1 1 0 
<br>
<br>0 0 0 0 0 0 0 0 
<br>0 0 0 0 0 0 0 0 
<br>0 0 0 0 0 0 0 0 
<br>0 0 0 0 0 0 0 0 
<br>0 0 0 1 1 1 1 1 
<br>0 0 1 1 1 1 1 1 
<br>0 0 1 1 1 1 1 1 
<br>0 1 1 1 1 1 1 1 
<br>
<br>in the first 16 bytes, now how does the color from the palettes gets filled in sprite?
<br>
<br>[question is - we have the shape of the sprite in mario.chr, and the colors in color palette, my question is how to choose color? ]
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__56">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 17, 2013 at 2:30:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The data is put together and the put together data makes each pixel 2 bits. That&apos;s 4 different pixel values, which are then displayed as colors. 16 entries for $3000 (4 palettes of 3 colors+the universal color.), and 16 entries for $3010 (4 palettes of 3 colors, value 00 is transparent.) It uses 16 bytes per tile, and 2 bits per pixel. The palette for sprites is selected by OAM bits on the 2nd byte of OAM ($201,205,etc.), and the background color pallets are selected by attribute memory at the end of the nametable. Then it pulls the tile, and uses each of the 2 bits to pull the color. Sprite pixel 0 (00) is transparent. And the background tile color $00 is always pulled from $3000, also called the &quot;universal&quot; background color.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__57">
                                                        <div class="mdl-card__title"><strong>Samarth</strong> posted on 
		
			
				
				Feb 17, 2013 at 10:12:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					i am heartly sorry sir, but i cann&apos;t understand wat you mean, can you expalin with detail? i think this is the thing which i wanted to hear...
<br>
<br>or can you post any website which contains the detailed information of the stuff you said?
<br>
<br>wat i understand is that the 16 byte data are 2 images of a tile, i.e. a pixel can be
<br>
<br>
<br>pixel 1:
<br>
<br>I tile   II tile
<br> 0          0
<br> 0          1
<br> 1          0
<br> 1          1
<br>
<br>and the result will contain the 2 bit of the color
<br>
<br>but i dont understand the line 
<br>&quot;The palette for sprites is selected by OAM bits on the 2nd byte of OAM ($201,205,etc.), &quot;
<br>
<br>because $0201 is the place to put the tile number to pick up the pattern from.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__58">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 17, 2013 at 2:28:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Okay, I used the wrong address. $202 has the pallet selection for sprites. Look at the last 2 bits on the attributes byte. It&apos;s clearly outlines in the first post with the meaning of the attribute bit. Look under SPRITES and then SPRITE DATA.
<br>
<br>And the nametables you&apos;ll get to later. Basically it works the same way. 2 bits per tile group select the pallet they&apos;ll use.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__59">
                                                        <div class="mdl-card__title"><strong>Samarth</strong> posted on 
		
			
				
				Feb 18, 2013 at 1:30:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					ok, the other 2 bits are the 2 l.s.b. of the 3rd byte of the sprite attribute bytes...
<br>
<br>thanks dude, i think i got your point, thank you for you time it helped me a lot... <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__60">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Mar 28, 2014 at 12:13:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	$xx,$00,$00,$00, $xx,$00,$00,$00, $xx,$00,$00,$00, $xx,$00,$00,$00 ;sprites<br>
	$xx,$00,$00,$00, $xx,$00,$00,$00, $xx,$00,$00,$00, $xx,$00,$00,$00 ;background<br>
	<br>
	<br>
	The first color in each of the 16 4-byte sections (designated here with x&apos;s) is the transparent color. Usually these all need to be the same, but I think basically whatever you have the first value set at, it will automatically make the other 7 first-bytes that same value. So don&apos;t be surprised if you try to change that color and nothing happens.</div>
Yup, just learned this tonight trying to program my game. Really threw a wrench into what I was doing. I was thinking I get 4 colors, but really, you get 3 and a bonus forth if it happens to be apart of the background.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__61">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Mar 28, 2014 at 12:23:33 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Basically:
<br>
<br>$3F00,$3F04,$3F08,$3F0C are the background palettes. Only $3F00 is used for rendering, it&apos;s the background color. Sprite entries with the %00 bottom bits mirror down to the BG palette entries. So, $3F10 mirrors to $3F00, $3F14 mirrors to $3F04, etc. So you have to write the BG color to $3F10 too, or you will get an incorrectly colored background. The other entries do nothing, though, so those don&apos;t matter unless you store 3 values there for whatever reason. But that is something not mentioned here AFAIK, but can be important/problematic.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__62">
                                                        <div class="mdl-card__title"><strong>spoonybard</strong> posted on 
		
			
				
				Aug 7, 2014 at 10:17:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi, I have a question about the DMA part. First of all, I have looked for information about DMA in general and more specifically for the Nes. Let me tell you what I understand so far.<br>
<br>
The &quot;classical&quot; way of communication between CPU and PPU is to write data at the $2000 - $2007 CPU address range : this range of memory can be called the &quot;communication ports&quot; between the CPU and the PPU. But there is another way to move data from the CPU memory to the PPU memory (quick thought : does it work both ways ? CPU mem &lt;--&gt; PPU mem) by using DMA. DMA is a faster way to copy data between the CPU and PPU memories because we do not send data byte by byte like the CPU would do : the exchange of data by DMA does not involve the CPU (I even think I&apos;ve read that during DMA, the CPU is not working).<br>
<br>
Now, in the code, you send the sprite data which is stored at $0200 - $02FF in the CPU RAM. We send the origin address $0200 by writing first the low byte $00 at the CPU address $2003 and the high byte $02 at the CPU address $4014 which triggers the &quot;DMA data exchange&quot;.<br>
<br>
But we didn&apos;t give any information about how many bytes we transfer and we didn&apos;t tell where to<br>
store it in the PPU memory. Is the number of bytes fixed for each DMA transfer ? Is the DMA transfer only possible for the sprites data, in terms of hardware : the hardware is such that the PPU memory range target is only the sprite data memory range ?<br>
<br>
Thanks in advance.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__63">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Aug 8, 2014 at 2:43:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>spoonybard</b></i><br>
	<br>
	The &quot;classical&quot; way of communication between CPU and PPU is to write data at the $2000 - $2007 CPU address range : this range of memory can be called the &quot;communication ports&quot; between the CPU and the PPU. But there is another way to move data from the CPU memory to the PPU memory (quick thought : does it work both ways ? CPU mem &lt;--&gt; PPU mem) by using DMA.</div>
It does not work both ways, only CPU =&gt; PPU.<br>
<br>
<div class="FTQUOTE" "width: 679.1875px;">
	<i>Originally posted by:&#xA0;<b>spoonybard</b></i><br>
	<br>
	DMA is a faster way to copy data between the CPU and PPU memories because we do not send data byte by byte like the CPU would do : the exchange of data by DMA does not involve the CPU (I even think I&apos;ve read that during DMA, the CPU is not working).</div>
Yeah, normal CPU instructions are not executed while a DMA is active.<br>
<br>
<div class="FTQUOTE" "width: 679.1875px;">
	<i>Originally posted by:&#xA0;<b>spoonybard</b></i><br>
	<br>
	Now, in the code, you send the sprite data which is stored at $0200 - $02FF in the CPU RAM. We send the origin address $0200 by writing first the low byte $00 at the CPU address $2003 and the high byte $02 at the CPU address $4014 which triggers the &quot;DMA data exchange&quot;.</div>
This is slightly incorrect. You can only control the source address at a 256 byte granularity. So if you write $02 to $4014, the transfer will always start from $200. Simply put, the source address is writtenByte*256. The register at $2003 sets the destination address (0..255) at the PPU side, not CPU.<br>
<br>
<div class="FTQUOTE" "width: 679.1875px;">
	<i>Originally posted by:&#xA0;<b>spoonybard</b></i><br>
	<br>
	But we didn&apos;t give any information about how many bytes we transfer and we didn&apos;t tell where to<br>
	store it in the PPU memory. Is the number of bytes fixed for each DMA transfer ? Is the DMA transfer only possible for the sprites data, in terms of hardware : the hardware is such that the PPU memory range target is only the sprite data memory range ?</div>
Yes, the number of bytes is fixed at 256. Yes, the DMA can only be used to transfer sprite (OAM) data.<br>
<br>
If you write $02 to $4014, what actually happens during DMA is functionally exactly equivalent to the following code:<br>
<br>
LDA $200<br>
STA $2004<br>
LDA $201<br>
STA $2004<br>
... (lines stripped) ...<br>
LDA $2FE<br>
STA $2004<br>
LDA $2FF<br>
STA $2004<br>
<br>
The advantage of DMA is that it is 4 times faster than using code like above (it reads from $200 in a single cycle, then writes to $2004 in a single cycle, rinse and repeat, whereas LDA and STA would take 4 cycles each).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__64">
                                                        <div class="mdl-card__title"><strong>spoonybard</strong> posted on 
		
			
				
				Aug 8, 2014 at 4:48:10 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m confused. If I understand what you&apos;re saying, since we wrote $00 at $2003, the data sent by DMA will be stored at address $00 in the PPU RAM. In total we have copied 256 bytes from address $200 (CPU side) to address $00 (PPU side). But I thought this range ($00 - $FF) in the PPU memory was the pattern table #0 for the sprites : the bytes that represent the 8x8 tiles for the sprites. But if I follow the code, we are sending the 4 bytes for a sprite (we are in fact sending 256 bytes of data but the 252 other ones are zeros) describing the position on the X (byte 3) and Y (byte 0) axes, the tile index number (byte 1) and the attributes (byte 2).<br>
<br>
I found in the link below<br>
<br>
<a href="http://badderhacksnet.ipage.com/badderhacks/index.php?option=com_content&amp;view=article&amp;id=270:the-nes-picture-processing-unit-ppu&amp;catid=14" target="_blank" original-href="http://badderhacksnet.ipage.com/badderhacks/index.php?option=com_content&amp;view=article&amp;id=270:the-nes-picture-processing-unit-ppu&amp;catid=14">http://badderhacksnet.ipage.com/badderhacks/index.php?option...</a> <br>
<br>
,in the section&#xA0;<strong "color: rgb(255, 255, 255); font-family: helvetica, arial, sans-serif; font-size: 14px; line-height: 21px; background-color: rgb(0, 0, 0);">II) Pattern Tables $[0000-1FFF]</strong>, that this is the starting memory region for sprite patterns (followed by the background patterns). The range $0000 - $0FFF is said to be for the sprite tiles but the autor does not mention the 4 bytes that describe the [X,Y] position, the tile number and the attributes. She/he explains the graphical interpretation of 2 bytes to form a sprite/background 8x8 pixels tile, but not the organization of the memory in this region.<br>
<br>
The first 256 bytes starting from $00 to $FF (the ones we sent using DMA) are then followed by 64 * 2 = 128 bytes of sprite pattern tiles ?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__65">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Aug 8, 2014 at 5:46:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>spoonybard</b></i><br>
	<br>
	I&apos;m confused. If I understand what you&apos;re saying, since we wrote $00 at $2003, the data sent by DMA will be stored at address $00 in the PPU RAM. In total we have copied 256 bytes from address $200 (CPU side) to address $00 (PPU side). But I thought this range ($00 - $FF) in the PPU memory was the pattern table #0 for the sprites : the bytes that represent the 8x8 tiles for the sprites.</div>
There&apos;s a separate 256 bytes of memory in the PPU for the sprites. This memory is completely separated from other PPU memory that is used for background/sprite tiles and nametables. The registers at $2003 and $2004 address the 256 byte sprite memory (only).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__66">
                                                        <div class="mdl-card__title"><strong>spoonybard</strong> posted on 
		
			
				
				Aug 8, 2014 at 6:07:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok and this 256 bytes long memory is called the SPR-RAM. Now I understand why the DMA only needs the origin of the memory in the PPU side : every DMA transfer copies 256 bytes starting from a specified byte in the CPU memory, to the SPR-RAM located in the PPU.<br>
<br>
Thanks a lot, you really did help me there !
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__67">
                                                        <div class="mdl-card__title"><strong>spoonybard</strong> posted on 
		
			
				
				Aug 8, 2014 at 7:48:24 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Now I have a question concerning the graphic data in the PPU memory. Following the source code, I clearly see that the CPU sends the two palettes for the background and the sprites, then the sprite data by DMA into the SPR-RAM. However, I don&apos;t see the part where the pattern tables, the name tables and their attribute tables are sent to the PPU memory. Is there a directive that does this job ?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__68">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Aug 8, 2014 at 8:09:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>spoonybard</b></i><br>
	<br>
	Now I have a question concerning the graphic data in the PPU memory. Following the source code, I clearly see that the CPU sends the two palettes for the background and the sprites, then the sprite data by DMA into the SPR-RAM. However, I don&apos;t see the part where the pattern tables, the name tables and their attribute tables are sent to the PPU memory. Is there a directive that does this job ?</div>
In this case the program uses CHR-ROM, so it doesn&apos;t need to transfer the pattern tables to PPU, they will be visible in PPU&apos;s memory space at $0000-1FFF by default. Some other program might use CHR-RAM, in which case $0000-1FFF would be RAM and the program would have to copy the data from CPU memory to PPU memory manually with $2006 and $2007 writes.<br>
<br>
Since the program only displays sprites, it doesn&apos;t need to upload nametables (the write to $2001 only enables sprite rendering). Same goes for attribute tables, which are really just a part of the nametables. If it <em>did</em> use background rendering, it would have to upload the nametable through registers $2006 and $2007.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__69">
                                                        <div class="mdl-card__title"><strong>spoonybard</strong> posted on 
		
			
				
				Aug 8, 2014 at 8:21:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok thanks again for your help.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__70">
                                                        <div class="mdl-card__title"><strong>lazerbeat</strong> posted on 
		
			
				
				Aug 13, 2014 at 9:29:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<br>
	<div>
		&#xA0;</div>
	<div>
		Sprite DMA<br>
		<br>
		<span "font-size: 12px;">&#xA0; LDA #$00</span><br>
		<span "font-size: 12px;">&#xA0; STA $2003 ; set the low byte (00) of the RAM address</span><br>
		<span "font-size: 12px;">&#xA0; LDA #$02</span><br>
		<span "font-size: 12px;">&#xA0; STA $4014 ; set the high byte (02) of the RAM address, start the transfer</span></div>
</div>
I have a question about this bit of the code. Sorry if I am being really really silly here, but I don&apos;t understand why we are writing $02 to $4014, I thought the PPU was $2000 - $2007 and $4000 - $4017 were audio and controller ports? What am I missing here?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__71">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				Aug 14, 2014 at 1:11:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>lazerbeat</b></i><br>
	<br>
	<div class="FTQUOTE">
		<br>
		<div>
			&#xA0;</div>
		<div>
			Sprite DMA<br>
			<br>
			<span font-size:>&#xA0; LDA #$00</span><br>
			<span font-size:>&#xA0; STA $2003 ; set the low byte (00) of the RAM address</span><br>
			<span font-size:>&#xA0; LDA #$02</span><br>
			<span font-size:>&#xA0; STA $4014 ; set the high byte (02) of the RAM address, start the transfer</span></div>
	</div>
	I have a question about this bit of the code. Sorry if I am being really really silly here, but I don&apos;t understand why we are writing $02 to $4014, I thought the PPU was $2000 - $2007 and $4000 - $4017 were audio and controller ports? What am I missing here?</div>
<br>
$4014 is the OAM DMA register. &#xA0;<a href="http://wiki.nesdev.com/w/index.php/PPU_OAM" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_OAM">http://wiki.nesdev.com/w/index.ph...</a><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__72">
                                                        <div class="mdl-card__title"><strong>lazerbeat</strong> posted on 
		
			
				
				Aug 14, 2014 at 6:29:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ah ok! Thanks very much, I understand more clearly now!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__73">
                                                        <div class="mdl-card__title"><strong>NeLaxt</strong> posted on 
		
			
				
				Oct 12, 2014 at 6:58:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					-edit-<br>
oh wait never mind I didn&apos;t read it right
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__74">
                                                        <div class="mdl-card__title"><strong>Dredster</strong> posted on 
		
			
				
				Dec 30, 2014 at 1:16:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So, I tried to change the palete by changing the values in .db, but it just came up a black screen. Does the directives only use certain values in the palette based on the Chr rom ? Is this what is meant by High and low byte like the pallet is based off the value of high or low byte ?&#xA0; Also, not sure if it is covered latter on, but how do I start making a sprite from ground up ? I downloaded Nindraw the learning curve is hard to use. I wanted to fool around with changing the color and sprite formation for learning purposes. I opened up the mario.chr file with textedit and just got some weird unicode. What is that code or should I use like tile molester to open that up and mess with it ?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__75">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 30, 2014 at 4:57:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Dredster</b></i><br>
	<br>
	<strong>So, I tried to change the palete by changing the values in .db, but it just came up a black screen.</strong> (cut...)</div>
<br>
I&apos;m not sure this will help, however, I&apos;ll try to help. All this is AFAIK.<br>
<br>
You have two palettes of 16 values: one palette is for the sprites, the other is for the background.<br>
<br>
Each palette is composed by 4 sub-palettes of 4 values each, the first value (of the four values) of each sub-palette is the same <em>transparency </em>color, which is common in all the (4 x 2 palettes) eight sub-palettes.<br>
<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/21264/photobucket/07321682-F930-22C9-979A2CCF3C1B635F.png" show-src="images/missing/07321682-F930-22C9-979A2CCF3C1B635F.png"><br>
<br>
This is the sprite palette of <em>Swords and Runes</em>. As you can see, each sub-palette has the same black color in its first <em>slot</em> (I don&apos;t know what is the best word to use, I mean the first hex value of each sub-palette); then three other colors. Note that you cannot mix these colors: for instance, you can&apos;t have in your game a sprite with a yellow, a green and a blue color using this palette, since these colors are not in the same sub-palette.<br>
<br>
So, a single 8x8 sprite, can only use three colors from a specific sub-palette, plus the <em>transparency </em>color.<br>
<br>
I hope this helps a little, but I&apos;m not too sure this is what you asked for.<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user<br>
<br>
<strong>Edit</strong>: misspelling.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__76">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 30, 2014 at 8:41:03 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Dredster</b></i><br>
	<br>
	So, I tried to change the palete by changing the values in .db, but it just came up a black screen. Does the directives only use certain values in the palette based on the Chr rom ? Is this what is meant by High and low byte like the pallet is based off the value of high or low byte ?&#xA0; Also, not sure if it is covered latter on, but how do I start making a sprite from ground up ? I downloaded Nindraw the learning curve is hard to use. I wanted to fool around with changing the color and sprite formation for learning purposes. I opened up the mario.chr file with textedit and just got some weird unicode. What is that code or should I use like tile molester to open that up and mess with it ?</div>
<br>
Yes, the CHR file is a binary file so you can&apos;t open it in a text editor and expect to make sense of it.&#xA0; It is best opened in a program like TileLayerPro or Tile Molester, like you suggested.<br>
<br>
And make sure you are changing the values in the correct .db table, since half of it is for background colors and half of it is for sprite colors.&#xA0; Plus the first value of each set of four colors is the transparency color, like Jack mentioned.&#xA0; Changing that value for sprites would make no difference since that color doesn&apos;t actually visually show up.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__77">
                                                        <div class="mdl-card__title"><strong>Dredster</strong> posted on 
		
			
				
				Dec 30, 2014 at 12:18:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<br>
	I hope this helps a little, but I&apos;m not too sure this is what you asked for.</div>
<br>
You and Khan helped a little. I was trying to change the colors in the directive .db. So, they have to have that first transparent color ? Why do they all have to have that ? I&apos;m still not understanding what is meant by high byte and low byte. What is their signifigance and why do you have to set them to a pallete value ?&#xA0; Looking forward to Swords and Ruins as I do every homebrew. Will it be released on here, Inifite NES lives or RetroUSB ?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__78">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 30, 2014 at 12:59:13 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Dredster</b></i><br>
	<br>
	<div class="FTQUOTE">
		<br>
		I hope this helps a little, but I&apos;m not too sure this is what you asked for.</div>
	<br>
	You and Khan helped a little. I was trying to change the colors in the directive .db. So, they have to have that first transparent color ? Why do they all have to have that ? I&apos;m still not understanding what is meant by high byte and low byte. What is their signifigance and why do you have to set them to a pallete value ?&#xA0; Looking forward to Swords and Ruins as I do every homebrew. Will it be released on here, Inifite NES lives or RetroUSB ?</div>
<br>
<em>So, they have to have that first transparent color ?</em><br>
Yes.<br>
<br>
<em>Why do they all have to have that ?</em><br>
It is the way the NES handles transparency. Someone more tech-oriented can be more precise about it.<br>
<br>
<em>I&apos;m still not understanding what is meant by high byte and low byte. What is their signifigance and why do you have to set them to a pallete value ?</em><br>
<br>
Each colors in the palette is a <u>single </u>byte. Hi/Lo is for addresses and pointers.<br>
But you can just set a &quot;dataline&quot; of 16 hex values and load it up as your palette.<br>
Just remember: #0,#4,#8,#12, i.e. the first byte (i.e. color) of each sub-palette, is transparent.<br>
<br>
<em>Will it be released on here, Inifite NES lives or RetroUSB ?</em><br>
I don&apos;t handle the release, just the coding. Updates, when available, will be in the S&amp;R thread.<br>
I fear this is not the correct thread to discuss about it, and that discussing it further would be considered spam in here.<br>
I posted that image just to (try to) explain a concept about sprites palettes.<br>
<br>
<em>You and Khan helped a little.</em><br>
I hope this helped a little more! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__79">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Dec 30, 2014 at 1:38:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>KHAN Games</b></i><br>
		$xx,$00,$00,$00, $xx,$00,$00,$00, $xx,$00,$00,$00, $xx,$00,$00,$00 ;sprites<br>
		$xx,$00,$00,$00, $xx,$00,$00,$00, $xx,$00,$00,$00, $xx,$00,$00,$00 ;background<br>
		<br>
		<br>
		The first color in each of the 16 4-byte sections (designated here with x&apos;s) is the transparent color. Usually these all need to be the same, but I think basically whatever you have the first value set at, it will automatically make the other 7 first-bytes that same value. So don&apos;t be surprised if you try to change that color and nothing happens.</div>
	Yup, just learned this tonight trying to program my game. Really threw a wrench into what I was doing. I was thinking I get 4 colors, but really, you get 3 and a bonus forth if it happens to be apart of the background.<br>
	<br>
	&#xA0;</div>
<br>
<br>
This is a pretty good depiction about the transparent colors. I swear I wrote a great post explaining this but I can&apos;t find it for the life of me.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__80">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 30, 2014 at 2:48:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Basically when you play a Nintendo game, the player isn&apos;t a square is he?  Mario has a shape, Link has a shape, etc, etc.  Without a transparent color to tell the Nintendo which pixels to draw invisible, everything would be a square or rectangle.  <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__81">
                                                        <div class="mdl-card__title"><strong>Dredster</strong> posted on 
		
			
				
				Jan 3, 2015 at 11:04:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	Basically when you play a Nintendo game, the player isn&apos;t a square is he? Mario has a shape, Link has a shape, etc, etc. Without a transparent color to tell the Nintendo which pixels to draw invisible, everything would be a square or rectangle.</div>
<br>
ahhh, that makes sense now. There are only two paletes one for sprites and one for background ? All colors that are represented within a game exist within these two palettes ? Their adress in the PPU is brought up by the accumulator through operands in the PRG Rom. Does that make any sense ? Am I getting this at all ?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__82">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				Jan 3, 2015 at 11:47:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Dredster</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>KHAN Games</b></i><br>
		<br>
		Basically when you play a Nintendo game, the player isn&apos;t a square is he? Mario has a shape, Link has a shape, etc, etc. Without a transparent color to tell the Nintendo which pixels to draw invisible, everything would be a square or rectangle.</div>
	<br>
	ahhh, that makes sense now. There are only two paletes one for sprites and one for background ? All colors that are represented within a game exist within these two palettes ? Their adress in the PPU is brought up by the accumulator through operands in the PRG Rom. Does that make any sense ? Am I getting this at all ?</div>
Not really. &#xA0;You have 4 different palettes for sprites, and 4 different palettes for backgrounds. &#xA0;Each of these palettes are made up of 3 colors, plus the background color. &#xA0;In the sprite palette, the background color is actually transparent, so if a sprite is on top of the background, the background will show through.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__83">
                                                        <div class="mdl-card__title"><strong>Farid</strong> posted on 
		
			
				
				Feb 25, 2015 at 11:12:42 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	<div>
		Sprite DMA</div>
	<div>
		The fastest and easiest way to transfer your sprites to the sprite memory is using DMA (direct memory access). This just means a block of RAM is copied from CPU memory to the PPU sprite memory. The on board RAM space from $0200-02FF is usually used for this purpose. To start the transfer, two bytes need to be written to the PPU ports:
		<pre>  LDA #$00
  STA $2003  ; <span>set the low byte (00) of the RAM address</span>
  LDA #$02
  STA $4014  ; set the high byte (02) of the RAM address, start the transfer
</pre>
	</div>
</div>
<br>
It seems that there is a small mistake on the comments, which confused me at first.<br>
First of all RAM is not a suitble word for&#xA0; $2003, it is Sprite Memory<br>
Then Sprites Memory can address from 00 ~ FF (8bit address range) so it doesn&apos;t have any low / high address bytes<br>
<br>
Thanks for the great tutorial
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__84">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 25, 2015 at 12:20:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It&apos;s setting the sprites to $0200, which is definitely in RAM.<br>
<br>
The comments are referring to the LDA #$00 and the LDA #$02.&#xA0; Low byte and high byte.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__85">
                                                        <div class="mdl-card__title"><strong>Mog</strong> posted on 
		
			
				
				Feb 25, 2015 at 12:35:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Farid</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>bunnyboy</b></i><br>
		<br>
		<div>
			Sprite DMA</div>
		<div>
			The fastest and easiest way to transfer your sprites to the sprite memory is using DMA (direct memory access). This just means a block of RAM is copied from CPU memory to the PPU sprite memory. The on board RAM space from $0200-02FF is usually used for this purpose. To start the transfer, two bytes need to be written to the PPU ports:
			<pre>  LDA #$00
  STA $2003  ; <span>set the low byte (00) of the RAM address</span>
  LDA #$02
  STA $4014  ; set the high byte (02) of the RAM address, start the transfer
</pre>
		</div>
	</div>
	<br>
	It seems that there is a small mistake on the comments, which confused me at first.<br>
	First of all RAM is not a suitble word for&#xA0; $2003, it is Sprite Memory<br>
	Then Sprites Memory can address from 00 ~ FF (8bit address range) so it doesn&apos;t have any low / high address bytes<br>
	<br>
	Thanks for the great tutorial</div>
<br>
$2003 and $4014 are PPU registers.<br>
<br>
See here:<br>
<a href="http://wiki.nesdev.com/w/index.php/PPU_registers" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_registers">http://wiki.nesdev.com/w/index.ph...</a><br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__86">
                                                        <div class="mdl-card__title"><strong>Farid</strong> posted on 
		
			
				
				Feb 25, 2015 at 3:06:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Writing #$00 to $2003 sets the OAM address (from $00 to $FF)<br>
Writing #$02 to $4014 sets the CPU RAM address (from $XX00 to $XXFF) and then begins the transfer from CPU RAM to OAM automatically<br>
00 and 02 are not High/low bytes of a single address, they are referring to different addresses<br>
<br>
Edit :<br>
fixed a typo : $2014 --&gt; $4014
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__87">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 25, 2015 at 3:09:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Whatever you say, friend. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__88">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Feb 25, 2015 at 6:01:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Farid</b></i><br>
	<br>
	Writing #$00 to $2003 sets the OAM address (from $00 to $FF)<br>
	Writing #$02 to $2014 sets the CPU RAM address (from $XX00 to $XXFF) and then begins the transfer from CPU RAM to OAM automatically<br>
	00 and 02 are not High/low bytes of a single address, they are referring to different addresses</div>
This should say $4014 instead of $2014, and the DMA source address doesn&apos;t have to be RAM; it can be any address in the memory space (you can do OAM transfers from ROM if you want). Other than that it&apos;s correct.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__89">
                                                        <div class="mdl-card__title"><strong>Piputkin3</strong> posted on 
		
			
				
				Apr 27, 2017 at 10:40:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					How to set the sprite speed?
<br>
<br>Eg. The character is at the speed x, ap the missile fired at a speed of 2x. Is it possible to set it somehow
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__90">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 27, 2017 at 11:33:46 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Just have the sprite move more pixels per frame.<br>
<br>
If your character is moving 1 pixel per frame, increment the missile to move 2 pixels per frame.<br>
<br>
Example for:<br>
Character<br>
LDA $0200<br>
CLC<br>
ADC #$01<br>
STA $0200<br>
<br>
Missile:<br>
LDA $0210<br>
CLC<br>
ADC #$02 ;Twice as fast<br>
STA $0210
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__91">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 27, 2017 at 11:50:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
Just have the sprite move more pixels per frame.<br>
<br>
If your character is moving 1 pixel per frame, increment the missile to move 2 pixels per frame.<br>
<br>
Example for:<br>
Character<br>
LDA $0200<br>
CLC<br>
ADC #$01<br>
STA $0200<br>
<br>
Missile:<br>
LDA $0210<br>
CLC<br>
ADC #$02 ;Twice as fast<br>
STA $0210</div>
<br>
<br>
To build on this, you can use a variable and change the speed of the missile before moving it x or y pixels per frame.<br>
<br>
;In Variables Area<br>
MissileSpeed&#xA0;&#xA0;&#xA0; .rs 1<br>
<br>
;Changing Missile speed in code for whatever reason<br>
LDA #$02&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;You can load this with whatever number you want based on things<br>
STA MissileSpeed<br>
<br>
;Adjusting the speed of the missile (assuming $0210 is the direction the missile is moving)<br>
LDA $0210<br>
CLC<br>
ADC MissileSpeed&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Move sprite this many pixels<br>
STA $0210<br>
<br>
<br>
<strong>2x Character Speed</strong><br>
If you want the missile to be twice as fast as the character, you can do this.<br>
<br>
;In Variables Area<br>
CharacterSpeed&#xA0;&#xA0;&#xA0; .rs 1<br>
MissileSpeed&#xA0;&#xA0;&#xA0; .rs 1<br>
<br>
;Changing Missile speed in code for whatever reason<br>
LDA CharacterSpeed&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Current number of pixel per frame the character is moving<br>
CLC<br>
ADC CharacterSpeed&#xA0;<br>
STA MissileSpeed&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;CharacterSpeed + CharacterSpeed = MissileSpeed<br>
<br>
;Adjusting the speed of the missile (assuming $0210 is the direction the missile is moving)<br>
LDA $0210<br>
CLC<br>
ADC MissileSpeed&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Move sprite this many pixels<br>
STA $0210
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__92">
                                                        <div class="mdl-card__title"><strong>Piputkin3</strong> posted on 
		
			
				
				Apr 27, 2017 at 2:52:13 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It&apos;s slower than ADC #$01?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__93">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 27, 2017 at 3:16:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Piputkin3</b></i><br>
<br>
It&apos;s slower than ADC #$01?</div>
With what I posted, the Missile is 2x faster than the character. I hope that is what you are asking, I&apos;m not sure what &quot;It&quot; is.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__94">
                                                        <div class="mdl-card__title"><strong>Piputkin3</strong> posted on 
		
			
				
				Apr 27, 2017 at 3:40:13 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I will ask another question, can you determine the sprite rate of less than 1?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__95">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Apr 27, 2017 at 3:57:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Piputkin3</b></i><br>
	<br>
	I will ask another question, can you determine the sprite rate of less than 1?</div>
<br>
<br>Yes, using a further byte of RAM.
<br>Example: you store somewhere (e.g. variable FOO) the value HEX00.
<br> then each NMI you add HEX40 to that variable.
<br> each four MNIs the variable will reach &quot;HEX100&quot; (which is HEX FF+1 ) reset to zero and trigger the carry flag.
<br> When the carry flag is triggered, you advance by 1 pixel.
<br>So, you advance by 1/4 of pixel each NMI.
<br>tell me if this helps. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__96">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 27, 2017 at 4:03:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Piputkin3</b></i><br>
<br>
I will ask another question, can you determine the sprite rate of less than 1?</div>
<br>
Yes. Instead of moving 1 pixel per frame, you move 1 pixel every other frame, every third frame, etc. However slow you want it to go.<br>
<br>
The way I would tackle this by using a counter variable to skip frames.<br>
<br>
;Variables<br>
MissileSpeedCounter&#xA0;&#xA0; .rs 1<br>
<br>
;Code to Move Missile<br>
INC MissileSpeedCounter&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
LDA MissileSpeedCounter<br>
CMP #$02 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Adjust this value depending on how many frames you want to skip, here I&apos;m going every other frame. You can use a variable here if you want different speeds<br>
BNE .SkipMoveMissile&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Skip moving the missile this frame if not equal to #$02<br>
&#xA0;&#xA0;&#xA0;&#xA0; LDA $0210<br>
&#xA0;&#xA0;&#xA0;&#xA0; CLC<br>
&#xA0;&#xA0;&#xA0;&#xA0; ADC #$01<br>
&#xA0;&#xA0;&#xA0;&#xA0; STA $0210&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Move Missile 1 pixel<br>
&#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0;&#xA0;&#xA0;&#xA0; LDA #$00<br>
&#xA0;&#xA0;&#xA0;&#xA0; STA MissileSpeedCounter&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Reset counter back to #$00<br>
.SkipMoveMissile :<br>
<br>
<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__97">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 27, 2017 at 4:06:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>Piputkin3</b></i><br>
<br>
I will ask another question, can you determine the sprite rate of less than 1?</div>
<br>
<br>
Yes, using a further byte of RAM.<br>
Example: you store somewhere (e.g. variable FOO) the value HEX00.<br>
then each NMI you add HEX40 to that variable.<br>
each four MNIs the variable will reach &quot;HEX100&quot; (which is HEX FF+1 ) reset to zero and trigger the carry flag.<br>
When the carry flag is triggered, you advance by 1 pixel.<br>
So, you advance by 1/4 of pixel each NMI.<br>
tell me if this helps. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span></div>
I think this may be better touched in the 16-bit math section further a long in the tutorials. This is only lesson #4. <span class="sprites_emoticons absmiddle" id="emo_wink">&#xA0;</span>&#xA0;<br>
<br>
But yes, that is a shorter way to do this than what I posted if you are wanting to save cycles and RAM space.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-4__98">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Apr 27, 2017 at 4:43:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>user</b></i><br>
		<div class="FTQUOTE">
			<i>Originally posted by: <b>Piputkin3</b></i><br>
			<br>
			I will ask another question, can you determine the sprite rate of less than 1?</div>
		<br>
		<br>
		Yes, using a further byte of RAM.<br>
		Example: you store somewhere (e.g. variable FOO) the value HEX00.<br>
		then each NMI you add HEX40 to that variable.<br>
		each four MNIs the variable will reach &quot;HEX100&quot; (which is HEX FF+1 ) reset to zero and trigger the carry flag.<br>
		When the carry flag is triggered, you advance by 1 pixel.<br>
		So, you advance by 1/4 of pixel each NMI.<br>
		tell me if this helps. <span class="sprites_emoticons absmiddle" id="emo_smile"> </span></div>
	I think this may be better touched in the 16-bit math section further a long in the tutorials. This is only lesson #4. <span class="sprites_emoticons absmiddle" id="emo_wink"> </span><br>
	<br>
	But yes, that is a shorter way to do this than what I posted if you are wanting to save cycles and RAM space.<br>
	&#xA0;</div>
<br>
<br>Indeed. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
<br>What you say makes perfect sense. And nice from you to write a full routine, I was too lazy. <span class="sprites_emoticons absmiddle" id="emo_tongue">&#xA0;</span>
<br>
<br>In the end, I think that providing Piputkin3 two different solutions, won&apos;t hurt! <span class="sprites_emoticons absmiddle" id="emo_happy">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>


                <div class="spacer"></div>

                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="main_tutorial-5">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">5: 多个精灵，手柄控制，更多介绍</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=6082" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=6082">Previous Week</a> - Palettes, Sprites<br><br><div><br class="webkit-block-placeholder"></div><div><span class="Apple-style-span" style="font-weight: bold; ">This Week</span>: &#xA0;one sprite is boring, so now we add many more! &#xA0;Also move that sprite around using the controller.</div><div><br class="webkit-block-placeholder"></div><div><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: large; ">Multiple Sprites</span></span></div><div><br class="webkit-block-placeholder"></div><div>Last time there was only 1 sprite loaded so we just used a few LDA/STA pairs to load the sprite data. &#xA0;This time we will have 4 sprites on screen. &#xA0;Doing that many load/stores just takes too much writing and code space. &#xA0;Instead a loop will be used to load the data, like was used to load the palette before. &#xA0;First the data bytes are set up using the .db directive:</div><div><br class="webkit-block-placeholder"></div><div><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">sprites:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0; &#xA0; ;vert tile attr horiz</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; .db $80, $32, $00, $80 &#xA0; ;sprite 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; .db $80, $33, $00, $88 &#xA0; ;sprite 1</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; .db $88, $34, $00, $80 &#xA0; ;sprite 2</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; .db $88, $35, $00, $88 &#xA0; ;sprite 3</span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><br class="webkit-block-placeholder"></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">There are 4 bytes per sprite, each on one line.&#xA0; The bytes are in the correct order and easily changed.&#xA0; &#xA0; This is only the starting data, when the program is running the copy in RAM can be changed to move the sprite around.</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">Next you need the loop to copy the data into RAM.&#xA0; This loop also works the same way as the palette loading, with the X register as the loop counter.</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">LoadSprites:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDX #$00&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; start at 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">LoadSpritesLoop:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA sprites, x&#xA0; &#xA0; &#xA0; &#xA0; ; load data from address (sprites + x)</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; STA $0200, x&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; store into RAM address ($0200 + x)</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; INX &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; X = X + 1</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; CPX #$10&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; Compare X to hex $10, decimal 16</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; BNE LoadSpritesLoop &#xA0; ; Branch to LoadSpritesLoop if compare was Not Equal to zero</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; if compare was equal to 16, continue down</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">If you wanted to add more sprites, you would add lines into the sprite .db section then increase the CPX compare value.&#xA0; That will run the loop more times, copying more bytes.</span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; ">Once the&#xA0;sprites have been loaded into RAM, you can modify the data there. &#xA0;</p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><br class="webkit-block-placeholder"></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><br></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; font-family: sans-serif; font-size: 12px; "><br class="webkit-block-placeholder"></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; font-family: sans-serif; font-size: 12px; "><br></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; font-family: sans-serif; font-size: 12px; "></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 18px/normal Helvetica; "><span style="letter-spacing: 0px; "><b>Controller Ports</b></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">The controllers are accessed through memory port addresses $4016 and $4017.&#xA0; First you have to write the value $01 then the value $00 to port $4016.&#xA0; This tells the controllers to latch the current button positions.&#xA0; Then you read from $4016 for first player or $4017 for second player.&#xA0; The buttons are sent&#xA0; one at a time, in bit 0.&#xA0; If bit 0 is 0, the button is not pressed.&#xA0; If bit 0 is 1, the button is pressed.</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">Button status for each controller is returned in the following order: A, B, Select, Start, Up, Down, Left, Right.</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA #$01</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; STA $4016</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA #$00</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; STA $4016 &#xA0; &#xA0; ; tell both the controllers to latch buttons</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - A</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - B</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - Select</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - Start</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - Up</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - Down</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - Left</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - Right</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4017 &#xA0; &#xA0; ; player 2 - A</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4017 &#xA0; &#xA0; ; player 2 - B</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4017 &#xA0; &#xA0; ; player 2 - Select</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4017 &#xA0; &#xA0; ; player 2 - Start</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4017 &#xA0; &#xA0; ; player 2 - Up</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4017 &#xA0; &#xA0; ; player 2 - Down</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4017 &#xA0; &#xA0; ; player 2 - Left</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4017 &#xA0; &#xA0; ; player 2 - Right</span></p><div><span class="Apple-style-span" style="font-family: Monaco; font-size: 10px; "><br class="webkit-block-placeholder"></span></div>
<p></p><p></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 18px/normal Helvetica; "><span style="letter-spacing: 0px; "><b>AND Instruction</b></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">Button information is only sent in bit 0, so we want to erase all the other bits.&#xA0; This can be done with the AND instruction.&#xA0; Each of the 8 bits is ANDed with the bits from another value.&#xA0; If the bit from both the first AND second value is 1, then the result is 1.&#xA0; Otherwise the result is 0.</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">0 AND 0 = 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">0 AND 1 = 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">1 AND 0 = 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">1 AND 1 = 1</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">For a full random 8 bit value:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; 01011011</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">AND &#xA0; 10101101</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">--------------</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; 00001001</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">We only want bit 0, so that bit is set and the others are cleared:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; 01011011&#xA0; &#xA0; controller data</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">AND &#xA0; 00000001&#xA0; &#xA0; AND value</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">--------------</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; 00000001&#xA0; &#xA0; only bit 0 is used, everything else erased</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">So to erase all the other bits when reading controllers, the AND should come after each read from $4016 or $4017:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4016 &#xA0; &#xA0; &#xA0; ; player 1 - A</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; AND #%00000001</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4016 &#xA0; &#xA0; &#xA0; ; player 1 - B</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; AND #%00000001</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4016 &#xA0; &#xA0; &#xA0; ; player 1 - Select</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; AND #%00000001</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 18px/normal Helvetica; "><span style="letter-spacing: 0px; "><b>BEQ instruction</b></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">The BNE instruction was used earlier in loops to Branch when Not Equal to a compared value.&#xA0; Here BEQ will be used without the compare instruction to Branch when EQual to zero.&#xA0; When a button is not pressed, the value will be zero, so the branch is taken.&#xA0; That skips over all the instructions that do something when the button is pressed:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">ReadA:&#xA0;</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4016 &#xA0; &#xA0; &#xA0; ; player 1 - A</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; AND #%00000001&#xA0; ; erase everything but bit 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; BEQ ReadADone &#xA0; ; branch to ReadADone if button is NOT pressed (0)</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; add instructions here to do something when button IS pressed (1)</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">ReadADone:&#xA0; &#xA0; &#xA0; &#xA0; ; handling this button is done</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 18px/normal Helvetica; "><span style="letter-spacing: 0px; "><b>CLC/ADC instructions</b></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">For this demo we will use the player 1 controller to move the Mario sprite around.&#xA0; To do that we need to be able to add to values.&#xA0; The ADC instruction stands for Add with Carry.&#xA0; Before adding, you have to make sure the carry is cleared, using CLC.&#xA0; This sample will load the sprite position into A, clear the carry, add one to the value, then store back into the sprite position:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $0203 &#xA0; ; load sprite X (horizontal) position</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; CLC &#xA0; &#xA0; &#xA0; &#xA0; ; make sure the carry flag is clear</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; ADC #$01&#xA0; &#xA0; ; A = A + 1</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; STA $0203 &#xA0; ; save sprite X (horizontal) position</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 18px/normal Helvetica; "><span style="letter-spacing: 0px; "><b>SEC/SBC instructions</b></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">To move the sprite the other direction, a subtract is needed.&#xA0; SBC is Subtract with Carry.&#xA0; This time the carry has to be set before doing the subtract:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $0203 &#xA0; ; load sprite position</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; SEC &#xA0; &#xA0; &#xA0; &#xA0; ; make sure carry flag is set</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; SBC #$01&#xA0; &#xA0; ; A = A - 1</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; STA $0203 &#xA0; ; save sprite position</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 18px/normal Helvetica; "><span style="letter-spacing: 0px; "><b>Putting It All Together</b></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">Download and unzip the <a href="scraper/files/controller.zip" target="_blank" original-href="http://www.nespowerpak.com/nesasm/controller.zip">controller.zip</a>&#xA0;</span><span style="letter-spacing: 0px; ">sample files.&#xA0; All the code above is in the controller.asm file.&#xA0; Make sure that file, mario.chr, and controller.bat is in the same folder as NESASM, then double click on controller.bat.&#xA0; That will run NESASM and should produce controller.nes.&#xA0; Run that NES file in FCEUXD SP to see small Mario.&#xA0; Press the A and B buttons on the player 1 controller to move one sprite of Mario.&#xA0; The movement will be one pixel per frame, or 60 pixels per second on NTSC machines.&#xA0; If Mario isn&apos;t moving, make sure your controls are set up correctly in the Config menu under Input...&#xA0; If you hold both buttons together, the value will be added then subtracted so no movement will happen.</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">Try editing the ADC and SBC values to make him move faster.&#xA0; The screen is only 256 pixels across, so too fast and he will just jump around randomly!&#xA0; Also try editing the code to move all 4 sprites together.</span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; ">Finally try changing the code to use the dpad instead of the A and B buttons. &#xA0;Left/right should change the X position of the sprites, and up/down should change the Y position of the sprites.</p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><br class="webkit-block-placeholder"></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span class="Apple-style-span" style="font-weight: bold; ">NEXT WEEK</span>: &#xA0;Backgrounds, attribute table</p><div><br class="webkit-block-placeholder"></div>
<p></p><p></p></div>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#main_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;main_tutorial-5__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=7974" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>

                <div class="comments" style="display: none;" id="main_tutorial-5__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__1">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				May 17, 2008 at 5:40:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					need some help:
<br>
<br>1) I can make the sprite move to left and right (with the left and right buttons),
<br>but going to the left goes twice as fast.
<br>
For going left I used &quot;SBC #$01&quot; and for going right I used &quot;ADC #$01&quot;
<br>If I change ADC to ADC #$02, the speeds are equal.
<br>
EDIT: Same problem for goin up and down. Up goes twice as fast as down.<br>Anyone got an idea what I&apos;m doing wrong ? 
<br>
<br>2) And to move up, I need to subtract ? (and vica versa) Is this right ? <br><br>3) Can someone give me some extra info about including the 3 other sprites ? Can&apos;t seem to find it.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__2">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 17, 2008 at 6:13:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thats where the CLC and SEC instructions right before the add and subtract come in.
<br>
<br>ADC stands for ADd with Carry.  It is actually doing A + value + carry.  Before doing the add you CLear Carry (CLC) so it does A + value + 0.
<br>
<br>SBC is SuBtract with Carry, A - value - opposite of carry.  Before doing the subtract you SEt Carry (SEC) to 1.  Opposite of carry will now be 0,  so it does A - value - 0.  
<br>
<br>When going left you are probably doing CLC before the SBC.  That clears the carry, so the subtract is doing A - value - 1.  Thats where the extra speed comes in because you end up subtracting 2 instead of 1.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__3">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				May 17, 2008 at 6:49:18 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br>Thats where the CLC and SEC instructions right before the add and subtract come in.
<br>
<br>ADC stands for ADd with Carry.  It is actually doing A + value + carry.  Before doing the add you CLear Carry (CLC) so it does A + value + 0.
<br>
<br>SBC is SuBtract with Carry, A - value - opposite of carry.  Before doing the subtract you SEt Carry (SEC) to 1.  Opposite of carry will now be 0,  so it does A - value - 0.  
<br>
<br>When going left you are probably doing CLC before the SBC.  That clears the carry, so the subtract is doing A - value - 1.  Thats where the extra speed comes in because you end up subtracting 2 instead of 1.</div><br><br>That solved my speed problem, thx ! <br><br>But I still have the opposite direction problem. If I press up, it goes down. <br>Here is my up and down code. Is there something wrong with it ? <br><br><br><br><div class="FTQUOTE"><i><span style="font-weight: bold;">code</span><b>&#xA0;</b></i><br><br>ReadUp: <br>&#xA0; LDA $4016&#xA0;&#xA0;&#xA0;&#xA0; <br>&#xA0; AND #%00000001 <br>&#xA0; BEQ ReadUpDone<br>&#xA0; LDA $0200&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <br>&#xA0; CLC&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <br>&#xA0; ADC #$01&#xA0;&#xA0; <br>&#xA0; STA $0200&#xA0; <br>ReadUpDone: <br><br>ReadDown: <br>&#xA0; LDA $4016&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <br>&#xA0; AND #%00000001&#xA0; <br>&#xA0; BEQ ReadDownDone&#xA0; <br>&#xA0; LDA $0200 <br>&#xA0; SEC&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <br>&#xA0; SBC #$01&#xA0;&#xA0;&#xA0;&#xA0; <br>&#xA0; STA $0200&#xA0;&#xA0;&#xA0; <br><br>ReadDownDone:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <br></div><br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__4">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				May 17, 2008 at 8:33:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Need to reverse up and down. Add to go down, subtract to go up. 0,0 is the top left corner of the screen.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__5">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				May 17, 2008 at 10:26:44 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Zzap</b></i><br><br>Need to reverse up and down. Add to go down, subtract to go up. 0,0 is the top left corner of the screen.</div><br><br><br>Thx, got it now (actually, I had it already but now I know the reason why it shoud be reversed)<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__6">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				May 17, 2008 at 10:56:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Easily done, I was doing some calculations with some angles the other day and it looked great on paper until I coded it and everything was heading in the wrong directions. Turned out to be the same problem, I had my Y axis around the wrong way <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__7">
                                                        <div class="mdl-card__title"><strong>Kizul Emeraldfire</strong> posted on 
		
			
				
				Jun 30, 2008 at 9:56:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have a different problem; I can get the whole sprite to move around left/right/up/down, but I can&apos;t figure out how to map the movement to buttons other than A and B. &gt;.&gt;
<br>
<br>Anyone have any hints/suggestions? xD;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__8">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Jun 30, 2008 at 11:01:13 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The buttons are determined in the set order you read from $4016. Each time you read from $4016 after latching the buttons, it will be for a different button. See below and add your own updates for the different buttons.
<br>
<br>  LDA $4016       ; player 1 - A
<br>  AND #%00000001
<br>  BNE NotA
<br>
<br>  ; do stuff for A button
<br>
<br>NotA:
<br>  LDA $4016       ; player 1 - B
<br>  AND #%00000001
<br>  BNE NotB
<br>
<br>  ; Do stuff for B button
<br>
<br>NotB:
<br>  LDA $4016       ; player 1 - Select
<br>  AND #%00000001
<br>  BNE NotSelect
<br>
<br>  ; Do stuff for Select button
<br>
<br>NotSelect:
<br>  LDA $4016     ; player 1 - Start
<br>  AND #%00000001
<br>  BNE NotStart
<br>
<br>  ; Stuff for Start button
<br>
<br>NotStart:
<br>  LDA $4016     ; player 1 - Up
<br>  AND #%00000001
<br>  BNE NotUp
<br>
<br>  ; Stuff for Up button
<br>
<br>NotUp:
<br>  LDA $4016     ; player 1 - Down
<br>  AND #%00000001
<br>  BNE NotDown
<br>
<br>  ; Stuff for Down button
<br>
<br>NotDown:
<br>  LDA $4016     ; player 1 - Left
<br>  AND #%00000001
<br>  BNE NotLeft
<br>
<br>  ; Stuff for Left button
<br>
<br>NotLeft:
<br>  LDA $4016     ; player 1 - Right
<br>  AND #%00000001
<br>  BNE NotRight
<br>
<br>  ; Stuff for Right button
<br>
<br>NotRight:
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__9">
                                                        <div class="mdl-card__title"><strong>Kizul Emeraldfire</strong> posted on 
		
			
				
				Jul 1, 2008 at 2:07:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yay, it worked! <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-happy.gif" show-src="images/blank.gif"> Thanks, Zzap!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__10">
                                                        <div class="mdl-card__title"><strong>dutch</strong> posted on 
		
			
				
				Jul 16, 2008 at 7:44:08 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have a really strange problem!
<br>If i open the controller file in the fceuxd sp i see the small mario BUT.. it wont move.
<br>If i open the controller file in another emulator jnes ,i see mario Bigger then in the fceuxd and it moves BUT... i have to use the d button for moving left and the f button for moving right??
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__11">
                                                        <div class="mdl-card__title"><strong>dutch</strong> posted on 
		
			
				
				Jul 17, 2008 at 4:30:43 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Made my code longer,aded up and down . That Strangly enough is converted to A and S on my keyboard? Remember is use jnes as emulator because fceuxdsp doesn&apos;t react at all.
<br>
<br>I tried to be smart and changed a and b by left and right(and didn&apos;t changed anything else of that code)4 errors right away,hahaha
<br>
<br>Can change the speed of the sprite ,but how do i ad the other sprites with the controls??
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__12">
                                                        <div class="mdl-card__title"><strong>collectinisgame</strong> posted on 
		
			
				
				Jul 17, 2008 at 7:36:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					does anyone have a link and a list of programs needed to make a homebrew?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__13">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Jul 17, 2008 at 8:02:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					See previous week links above
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__14">
                                                        <div class="mdl-card__title"><strong>dutch</strong> posted on 
		
			
				
				Jul 17, 2008 at 8:10:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>collectinisgame</b></i><br><br>does anyone have a link and a list of programs needed to make a homebrew?</div><p><br><br><br>Its not as simple as that. You need to read ALOT&#xA0; of stuff.</p><p>There is no easy way </p><p>Try reading programming that 8bit beast of power,the nes</p><p>You can read and print this on the nesdev site.</p><p>
				</p></div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__15">
                                                        <div class="mdl-card__title"><strong>dutch</strong> posted on 
		
			
				
				Jul 18, 2008 at 5:47:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					can somebody please tell me what part of the code needs to be updated to make all the sprites move together?
<br>
<br>Can&apos;t seem to figure it out
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__16">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Jul 18, 2008 at 9:19:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					When you add or subtract to the sprite position for up, down, left, right etc you&apos;ll need to add and subtract for each of the sprites. So instead of just:
<br>
<br>  LDA $0203   ; load sprite position
<br>  SEC         ; make sure carry flag is set
<br>  SBC #$01    ; A = A - 1
<br>  STA $0203   ; save sprite position
<br>
<br>You&apos;ll need to:
<br>
<br>  LDA $0203   ; load sprite 1 position
<br>  SEC         ; make sure carry flag is set
<br>  SBC #$01    ; A = A - 1
<br>  STA $0203   ; save sprite 1 position
<br>  LDA $0207   ; load sprite 2 position
<br>  SEC         ; make sure carry flag is set
<br>  SBC #$01    ; A = A - 1
<br>  STA $0207   ; save sprite 2 position
<br>  LDA $020B   ; load sprite 3 position
<br>  SEC         ; make sure carry flag is set
<br>  SBC #$01    ; A = A - 1
<br>  STA $020B   ; save sprite 3 position
<br>  LDA $020F   ; load sprite 4 position
<br>  SEC         ; make sure carry flag is set
<br>  SBC #$01    ; A = A - 1
<br>  STA $020F   ; save sprite 4 position
<br>
<br>Note, I think I&apos;ve got those sprite memory location&apos;s right, but I did rush through them a bit
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__17">
                                                        <div class="mdl-card__title"><strong>dutch</strong> posted on 
		
			
				
				Jul 19, 2008 at 11:53:16 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks zzap,
<br>
<br> changed my asm file and it works.
<br>Even made up and down go right.
<br>
<br> just added 4 up each time 00 04 08 0c this works but i have no idea where these numbers come from i just saw the pattern of left and right.
<br>And figured out i had to do +4. So where do you get the code from?
<br>
<br>Also i assume that the code for controller 2 4017 is the same(except you use $4017)
<br>I dont play pc games so how do you test player 2 controlls btw???????????????
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__18">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Jul 20, 2008 at 5:15:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Have a look in the options or preferences section of your emulator. There should be a setting in there somewhere to configure the second gamepad
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__19">
                                                        <div class="mdl-card__title"><strong>resynthesize</strong> posted on 
		
			
				
				Oct 26, 2009 at 4:28:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi, <br><br>I was able to modify the code to update all four sprites that comprised mario at the same time.&#xA0; However, when I try to generalize the update with a loop, it doesn&apos;t work.&#xA0; Here is the code I came up with:<br><br><br><br><br><code>
ReadRight:<br>&#xA0; lda $4016&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; player 1 - A<br>&#xA0; and #%00000001&#xA0;&#xA0;&#xA0;&#xA0; ; only look at bit 0<br>&#xA0; beq ReadRightDone <br>&#xA0; ldx #$03&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; x position of sprite starts at $0203 <br><br>moveloop:<br>&#xA0; lda $2000, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; load sprite X position ($2000 + x)<br>&#xA0; clc&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; make sure the carry flag is clear<br>&#xA0; adc #$02&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; A = A + 1<br>&#xA0; sta $2000, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; save sprite X position<br>&#xA0; inx&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; increment X 4 times to get to next sprite<br>&#xA0; inx&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; x position<br>&#xA0; inx<br>&#xA0; inx<br>&#xA0; cpx #$0F&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; if x = $0f, all 4 sprites have been moved<br>&#xA0; bne moveloop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; otherwise keep going.<br><br>ReadRightDone:<br><br></code>I think the problem may be in my understanding of lda/sta.  When I debug the code, the accumulator has a value of 0 after the &quot;lda $2000, x&quot; statement.  If I use four sequential lda/sta blocks with the sprite offset hardcoded, it works fine and the accumulator contains the correct x position or the sprite.  Any ideas where I am going wrong? <br><br><br><br>As an aside, is there a better way to add 4 to X than doing the four INX statements?  It appears ADC only operates on the accumulator.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__20">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Oct 26, 2009 at 4:48:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Not sure what the issue you&apos;re having is, but try it this way.  
<br>  
<br>  LDA $0200       ; load sprite Y position
<br>  CLC             ; make sure the carry flag is clear
<br>  ADC #$02        ; A = A + 2
<br>  STA $0200       ; save sprite Y position
<br>  STA $0204
<br>  CLC
<br>  ADC #$08
<br>  STA $020C       
<br>  STA $0208       
<br>
<br>  LDA $0203       ; load sprite X position
<br>  STA $020B
<br>  CLC
<br>  ADC #$08
<br>  STA $0207
<br>  STA $020F
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__21">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Oct 26, 2009 at 4:58:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Your error is the $2000 part, you likely meant $0200.
<br>
<br>Yup 4x inx is the fastest way.  Can&apos;t do general math on X or Y.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__22">
                                                        <div class="mdl-card__title"><strong>resynthesize</strong> posted on 
		
			
				
				Oct 26, 2009 at 5:03:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Man, <br><br>Without fail, as soon as I spend the time to type up a message on a forum, the solution jumps out to me a few minutes later.&#xA0; The problem was that I was using the wrong address for the sprites!&#xA0; It is supposed to be $0200, not $2000.&#xA0; After I changed that, it worked OK except the last sprite did not update.&#xA0; That was because the &quot;cpx #$0F&quot; was branching before the last sprite was moved.&#xA0; Here is the finished code that can move the entire sprite.&#xA0; I wanted to write the code this way so that moving an arbitrarily large sprite wouldn&apos;t need a ton of repetitive code:<br><br>&#xA0;<br>&#xA0; ldx #$03 <br>moveloop:<br>&#xA0; lda $0200, x ;load sprite X position<br>&#xA0; clc&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; make sure the carry flag is clear<br>&#xA0; adc #$02&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <br>&#xA0; sta $0200, x ; save sprite X position<br>&#xA0; inx<br>&#xA0; inx<br>&#xA0; inx<br>&#xA0; inx<br>&#xA0; cpx #$13<br>&#xA0; bne moveloop&#xA0;&#xA0;&#xA0; <br><br>I&apos;m still wondering if there is a better way to &quot;add 4 to x&quot; instead of using 4 inx statements.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__23">
                                                        <div class="mdl-card__title"><strong>resynthesize</strong> posted on 
		
			
				
				Oct 26, 2009 at 5:06:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br>Not sure what the issue you&apos;re having is, but try it this way.  
<br>  
<br>  LDA $0200       ; load sprite Y position
<br>  CLC             ; make sure the carry flag is clear
<br>  ADC #$02        ; A = A + 2
<br>  STA $0200       ; save sprite Y position
<br>  STA $0204
<br>  CLC
<br>  ADC #$08
<br>  STA $020C       
<br>  STA $0208       
<br>
<br>  LDA $0203       ; load sprite X position
<br>  STA $020B
<br>  CLC
<br>  ADC #$08
<br>  STA $0207
<br>  STA $020F</div><br><br>ah, that is clever as well <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">&#xA0; Thanks.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__24">
                                                        <div class="mdl-card__title"><strong>RevEng</strong> posted on 
		
			
				
				Jan 3, 2010 at 6:25:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>resynthesize</b></i><br><br>I&apos;m still wondering if there is a better way to &quot;add 4 to x&quot; instead of using 4 inx statements.<br></div><br><font size="1"><span style="font-style: italic;">I know this was posted long ago, but here&apos;s an answer for posterity&apos;s sake.</span></font><br><br>Since you can only do math on the A register (accumulator), you&apos;ll want to copy the value of X into A, do the math, then copy it back to X.&#xA0; The following code will do that:<br><br>TXA<br>CLC<br>ADC #$04<br>TAX<br><br>This code can replace the 4 INX statements.&#xA0; Note that it wrecks what&apos;s currently in the accumulator.&#xA0; If you still need what&apos;s in the accumulator, you can push it on to the stack and pull it back off when you are done:<br><br><span style="font-weight: bold;">PHA</span><br>TXA<br>
CLC<br>
ADC #$04<br>
TAX<br>
<span style="font-weight: bold;">PLA</span><br><br>As you can see, that&apos;s a lot of code just to add a number to the X register.&#xA0; This is why it&apos;s best to avoid doing math (other than increment/decrement) on these registers.&#xA0; For X+4, it&apos;s actually less code (and less CPU cycles) to do INX 4 times than to use the code above.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__25">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Jan 3, 2010 at 6:53:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here&apos;s the breakdown of size required and CPU cycles for all 3 methods:
<br>
<br>INX method: 4 bytes, 8 cycles
<br>TXA method: 5 bytes, 8 cycles
<br>Clean TXA method: 7 bytes, 15 cycles
<br>
<br>So the INX method looks best since it&apos;s clean, less bytes, and equally as efficient with the CPU.
<br>
<br>A nice site I use to look up exact details of instructions is this one:
<br><a href="http://www.obelisk.demon.co.uk/6502/instructions.html" target="_blank" original-href="http://www.obelisk.demon.co.uk/6502/instructions.html">http://www.obelisk.demon.co.uk/65...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__26">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jan 3, 2010 at 9:01:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>JamesCooper</b></i><br><br><div class="FTQUOTE"><i>Originally posted by: <b>resynthesize</b></i><br><br>I&apos;m still wondering if there is a better way to &quot;add 4 to x&quot; instead of using 4 inx statements.<br></div><br><font size="1"><span style="FONT-STYLE: italic">I know this was posted long ago, but here&apos;s an answer for posterity&apos;s sake.</span></font><br><br>Since you can only do math on the A register (accumulator), you&apos;ll want to copy the value of X into A, do the math, then copy it back to X.&#xA0; The following code will do that:<br><br>TXA<br>CLC<br>ADC #$04<br>TAX<br><br>This code can replace the 4 INX statements.&#xA0; Note that it wrecks what&apos;s currently in the accumulator.&#xA0; If you still need what&apos;s in the accumulator, you can push it on to the stack and pull it back off when you are done:<br><br><span style="FONT-WEIGHT: bold">PHA</span><br>TXA<br>CLC<br>ADC #$04<br>TAX<br><span style="FONT-WEIGHT: bold">PLA</span><br><br>As you can see, that&apos;s a lot of code just to add a number to the X register.&#xA0; This is why it&apos;s best to avoid doing math (other than increment/decrement) on these registers.&#xA0; For X+4, it&apos;s actually less code (and less CPU cycles) to do INX 4 times than to use the code above.<br></div><br>GOOD FIRST POST!!<br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__27">
                                                        <div class="mdl-card__title"><strong>rizz</strong> posted on 
		
			
				
				Feb 9, 2010 at 1:42:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m a latecomer for the nerdy nights stuff, but maybe someone can answer my question(s).  Up until this point, I&apos;ve been using NESASM3 to follow along on the tutorials, but I want to switch over to asm6.  I attempt to code the conversion, replacing a few lines of code, but for some reason, I&apos;m getting a solid gray screen when I run the .nes file that was made from asm6.  As far as I can tell, I just need to replace the header with the ines header, and use .base directives in the place of .bank.  At this point, it&apos;s a bit frustrating, so I&apos;d really appreciate it if someone could explain the specific code changes to make.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__28">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Feb 9, 2010 at 5:14:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>rizz</b></i><br><br>I&apos;m a latecomer for the nerdy nights stuff, but maybe someone can answer my question(s).  Up until this point, I&apos;ve been using NESASM3 to follow along on the tutorials, but I want to switch over to asm6.  I attempt to code the conversion, replacing a few lines of code, but for some reason, I&apos;m getting a solid gray screen when I run the .nes file that was made from asm6.  As far as I can tell, I just need to replace the header with the ines header, and use .base directives in the place of .bank.  At this point, it&apos;s a bit frustrating, so I&apos;d really appreciate it if someone could explain the specific code changes to make.</div><br><br>1) Remove all the .inesxxx stuff and specify your 16-byte ines header at the top like this:<br><br><span style="font-weight: bold;">.byte &quot;NES&quot;,$1a</span><br style="font-weight: bold;"><span style="font-weight: bold;">.byte $01 ; 1 PRG-ROM block</span><br style="font-weight: bold;"><span style="font-weight: bold;">.byte $01 ; 1 CHR-ROM block</span><br style="font-weight: bold;"><span style="font-weight: bold;">.byte $00 ;</span><br style="font-weight: bold;"><span style="font-weight: bold;">.byte $00 ; </span><br style="font-weight: bold;"><span style="font-weight: bold;">.byte 0,0,0,0,0,0,0,0</span><br><br>2) remove the lines .bank 0, .bank1 and .bank2 (asm6 doesn&apos;t use them)<br><br>3) replace .org $c000 with: <span style="font-weight: bold;">.base $c000</span><br><br>4) remove .org $e000 (you don&apos;t really need to make a division here.&#xA0; If you really want to you can replace .org $e000 with <span style="font-weight: bold;">.pad $E000</span> followed by a <span style="font-weight: bold;">.base $E000</span>)<br><br>5) replace .org $FFFa with:&#xA0;<span style="font-weight: bold;"> .pad $FFFA</span><br><br>5) replace .org $0000 with:&#xA0; <span style="font-weight: bold;">.base $0000</span><br><br>I think those are all the changes I made to get controller.asm to assemble with asm6.&#xA0; <br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__29">
                                                        <div class="mdl-card__title"><strong>rizz</strong> posted on 
		
			
				
				Feb 9, 2010 at 10:37:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This fixed everything.  Thanks so much.  At first, that&apos;s all I was going to say, but then I clicked on your nesdev blog, and found a lot more to be thankful for.  Looks like some awesome stuff in there!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__30">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Feb 19, 2010 at 12:42:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m a noob assembly programmer (and not a professional programmer at all) so I was wondering if the following would screw me in the long run:
<br>
<br>While revisiting the controller reading in a graphics test I&apos;m doing, I was also trying to clean it up by looping through the four addresses of four different sprites tiles, but then discovered the INC and DEC instructions.  So now, for example, my ReadUp looks like this:
<br>
<br>ReadUp:
<br>  LDA $4016       ; player 1 - Up
<br>  AND #%00000001  ; only look at bit 0
<br>  BEQ ReadUpDone   ; branch to ReadBDone if button is NOT pressed (0)
<br>                  ; add instructions here to do something when button IS pressed (1)
<br>
<br>   DEC $0200
<br>   DEC $0204
<br>   DEC $0208
<br>   DEC $020C
<br>ReadUpDone:        ; handling this button is done
<br>
<br>I&apos;ve ran through NESASM and it&apos;s working.  But again, I get a bad feeling like there&apos;s something that may come around and bite me later on if I use this on more complicated stuff.  Was this a decent way to handle this or was it sloppy?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__31">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 19, 2010 at 12:57:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;d imagine that when you got to collision detection, this will not be as efficient.  But then, I&apos;m a noob as well, and I don&apos;t really know what I&apos;m talking about.  <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-tongue.gif" show-src="images/blank.gif">
<br>
<br>I basically use a routine that stores $0200 into sprite_vertical and $0203 into_sprite horizontal.  Then do all the moving, collision detection and all the with these variables.  That way you can loop all the enemies and stuff through without having to write the same code for them.  At the end, you just reverse the process putting the sprite_--- into the addresses then updating the other 3 sprites with reference to that one.
<br>
<br>Make sense?
<br>
<br>But if your way works, run with it.  You have to figure out your own style.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__32">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Feb 19, 2010 at 1:16:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br>I&apos;d imagine that when you got to collision detection, this will not be as efficient.  But then, I&apos;m a noob as well, and I don&apos;t really know what I&apos;m talking about.  <img border="0" src style="display: none;" original-src="i/expressions/face-icon-small-tongue.gif" show-src="images/blank.gif">
<br>
<br>I basically use a routine that stores $0200 into sprite_vertical and $0203 into_sprite horizontal.  Then do all the moving, collision detection and all the with these variables.  That way you can loop all the enemies and stuff through without having to write the same code for them.  At the end, you just reverse the process putting the sprite_--- into the addresses then updating the other 3 sprites with reference to that one.
<br>
<br>Make sense?
<br>
<br>But if your way works, run with it.  You have to figure out your own style.</div>Speak of the devil!&#xA0; Collision detection is actually what I&apos;m starting on with this latest test right now!&#xA0; <img src style="display: none;" original-src="/i/expressions/face-icon-small-happy.gif" show-src="images/blank.gif"><br><br>Are these routines working well for you on the collision detection?&#xA0; And if so (forgive me if this is massively inappropriate - like I said I&apos;m a noob) would you mind pasting some example code?&#xA0; If you&apos;d rather not, I understand.<br><br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__33">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Feb 19, 2010 at 1:18:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The problem with just using inc/dec is your movement will be fixed at 1 pixel/frame.  Later you will want variable speeds, sub pixel movement, etc.  But for now its just fine.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__34">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 19, 2010 at 1:33:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>See the second demo in this thread (in the original post). </p><p><a href="messageview.cfm?catid=22&amp;threadid=25663" target="_blank" original-href="messageview.cfm?catid=22&amp;threadid=25663">http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;am...</a> </p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__35">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 19, 2010 at 1:44:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>I have this for all four directions, this is for the Up botton:</p><p>&#xA0; LDA $0200&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; load sprite Y position<br>&#xA0; SEC&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; make sure the carry flag is clear<br>&#xA0; SBC #Speed&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; A = A +&#xA0;the variable&#xA0;&#xA0;<br>&#xA0; STA $0200</p><p>&#xA0; JSR transfer_nightman_info ;transfers the $0200 and $0203 into the variables</p><p>&#xA0; JSR top_wall_collision&#xA0;&#xA0; ;checks to see if he has hit the top wall, then sends it to the various room detections</p><p>&#xA0; LDA #room_change&#xA0;&#xA0;&#xA0; ;for room changes skip the next part<br>&#xA0; BEQ AnimationupCounter</p><p>&#xA0; JSR update_nightman_sprites</p><p>top_wall_collision:&#xA0;&#xA0;&#xA0; ; This is for all four directions</p><p>&#xA0; LDY #$00<br>&#xA0; STY room_change </p><p>&#xA0; LDA sprite_vertical<br>&#xA0; CMP #top_wall&#xA0;&#xA0;&#xA0; ;check location<br>&#xA0; BCS .done&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;jump to code for inside the L/R door frames</p><p>&#xA0; LDX door_status&#xA0; ;see if the doors are open<br>&#xA0; CPX #$01<br>&#xA0; BEQ .doorclosed&#xA0; ;either jump to the top wall collsion or enter the door</p><p>&#xA0; TAY<br>&#xA0; LDA banks_and_doors&#xA0;&#xA0;&#xA0; ;enter the door/active room switching<br>&#xA0; AND #%10000000&#xA0;&#xA0; ;see if there is a door in this direction<br>&#xA0; BEQ .doorclosed</p><p>&#xA0; LDX sprite_horizontal&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;see if he is in the door frame<br>&#xA0; CPX #vertical_door_right+2<br>&#xA0; BCS .doorclosed<br>&#xA0; CPX #vertical_door_left-2<br>&#xA0; BCC .doorclosed<br>&#xA0; <br>&#xA0; LDX #vertical_door_left+2&#xA0;&#xA0;&#xA0; ;this is so the dumb ass doesn&apos;t run into said door frame.<br>&#xA0; STX sprite_horizontal</p><p>&#xA0; TYA<br>&#xA0; CMP #top_exit&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;see if he is at the top yet<br>&#xA0; BCS .done2<br>&#xA0; <br>&#xA0; JSR exit_on_top<br>&#xA0; LDY #$01<br>&#xA0; STY room_change<br>&#xA0; RTS</p><p>.doorclosed:<br>&#xA0; LDA #top_wall&#xA0;&#xA0; ;if the door is closed or outside the frame, stay below the wall<br>&#xA0; STA sprite_vertical<br>&#xA0; JSR direction_change<br>&#xA0; JMP .done2</p><p>.done&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;doors open routine<br>&#xA0; LDX door_status&#xA0; ;see if the doors are open<br>&#xA0; CPX #$01<br>&#xA0; BEQ .done1</p><p>&#xA0; CMP #horizontal_door_top&#xA0;&#xA0;&#xA0; ;this is for if he is in the door frame<br>&#xA0; BCS .done1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;see if he is at the top of the door</p><p>&#xA0; LDX sprite_horizontal&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;check left<br>&#xA0; CPX #left_wall<br>&#xA0; BCC .next</p><p>&#xA0; CPX #right_wall+1&#xA0;&#xA0;&#xA0;&#xA0; ;check right<br>&#xA0; BCC .done1<br>&#xA0; <br>.next<br>&#xA0; LDA #horizontal_door_top&#xA0; ;stay in the door frame<br>&#xA0; STA sprite_vertical<br>&#xA0; JMP .done2&#xA0; </p><p>.done1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;load info for which direction to use<br>&#xA0; LDX #$00<br>&#xA0; STX collide_direction<br>&#xA0; JSR collision_detection&#xA0; ;indirect jump to collision detection<br>&#xA0; <br>.done2<br>&#xA0; RTS</p><p>collision_detection:&#xA0;&#xA0; ;indirect jumping for collision detection<br>&#xA0; JMP [collideptr]&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;the collideptr is set to collide0 in the room loading routine</p><p>collision0:<br>&#xA0; .word up_collide0,down_collide0,right_collide0,left_collide0</p><p>collide0:<br>&#xA0; LDX collide_direction&#xA0; ;$00=up, $02=down, $04=right, $06=left<br>&#xA0; LDY collision0,X<br>&#xA0; STY collideptr2<br>&#xA0; LDY collision0+1,X<br>&#xA0; STY collideptr2+1</p><p>&#xA0; JMP [collideptr2]</p><p>up_collide0:</p><p>&#xA0; LDA sprite_vertical<br>&#xA0; LDX sprite_horizontal&#xA0; ;top pipe on right side of the screen<br>&#xA0; CPX #$7F<br>&#xA0; BCC .done<br>&#xA0; CPX #$C8<br>&#xA0; BCS .done<br>&#xA0; CMP #$70<br>&#xA0; BCC .done<br>&#xA0; CMP #$78<br>&#xA0; BCS .done<br>&#xA0; LDA #$78<br>&#xA0; STA sprite_vertical<br>&#xA0; JSR direction_change<br>&#xA0; JMP .dones</p><p>.done<br>&#xA0; CPX #$68&#xA0; ; bottom of the engine<br>&#xA0; BCS .done1<br>&#xA0; CMP #$AF<br>&#xA0; BCS .done1<br>&#xA0; CMP #$A0<br>&#xA0; BCC .done1<br>&#xA0; LDA #$AF<br>&#xA0; STA sprite_vertical<br>&#xA0; JSR direction_change<br>&#xA0; JMP .dones</p><p>.done1<br>&#xA0; CPX #$78&#xA0; ;very top piece of pipe<br>&#xA0; BCS .done2<br>&#xA0; CMP #$67<br>&#xA0; BCS .done2<br>&#xA0; LDA #$67<br>&#xA0; STA sprite_vertical<br>&#xA0; JSR direction_change<br>&#xA0; JMP .dones</p><p>.done2<br>&#xA0; CPX #$7F&#xA0; ;bottom pipe on right side of the screen<br>&#xA0; BCC .done3<br>&#xA0; CPX #$C8<br>&#xA0; BCS .done3<br>&#xA0; CMP #$B0<br>&#xA0; BCC .done3<br>&#xA0; CMP #$B8<br>&#xA0; BCS .done3<br>&#xA0; LDA #$B8<br>&#xA0; STA sprite_vertical<br>&#xA0; JSR direction_change<br>&#xA0; JMP .dones</p><p>.done3<br>&#xA0; CPX #$68&#xA0; ;get around the top corner of the engine<br>&#xA0; BCC .done4<br>&#xA0; CPX #$6E<br>&#xA0; BCS .done4<br>&#xA0; CMP #$A7<br>&#xA0; BCC .done4<br>&#xA0; CMP #$AE<br>&#xA0; BCS .done4<br>&#xA0; INC sprite_horizontal<br>&#xA0; JMP .dones </p><p>.done4<br>&#xA0; CPX #$C8<br>&#xA0; BCC .done5<br>&#xA0; CPX #$CE<br>&#xA0; BCS .done5<br>&#xA0; CMP #$6D&#xA0; ;Get around the top pipe tip.<br>&#xA0; BCC .next<br>&#xA0; CMP #$78<br>&#xA0; BCC .next1<br>.next<br>&#xA0; CMP #$AD&#xA0; ;get around the bottom pipe tip<br>&#xA0; BCC .done5<br>&#xA0; CMP #$B8<br>&#xA0; BCS .done5<br>.next1<br>&#xA0; INC sprite_horizontal<br>&#xA0; JMP .dones</p><p>.done5<br>&#xA0; CMP #$68&#xA0;&#xA0;&#xA0; ;move around the top elbow<br>&#xA0; BCC .done6<br>&#xA0; CMP #$78<br>&#xA0; BCS .done6<br>&#xA0; CPX #$74<br>&#xA0; BCC .done6<br>&#xA0; CPX #$80<br>&#xA0; BCS .done6<br>&#xA0; DEC sprite_horizontal<br>&#xA0; JMP .dones</p><p>.done6<br>.dones<br>&#xA0; RTS</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__36">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Feb 19, 2010 at 1:56:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br><p>See the second demo in this thread (in the original post). </p><p><a href="messageview.cfm?catid=22&amp;threadid=25663" target="_blank" original-href="messageview.cfm?catid=22&amp;threadid=25663">http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;am...</a>  </p></div><br><br>Nice.&#xA0; I thought you said you were a noob!&#xA0; This is way far ahead of anything I&apos;m doing!&#xA0; :-)&#xA0; Of course, I&apos;ve also only been playing around with all this for about two weeks.&#xA0; I mean, I am a NOOB!<br><br>Anyway, thanks for the guidance!&#xA0; This NES Homebrew stuff is so awesome!<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__37">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Feb 19, 2010 at 8:13:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bigjt_2</b></i><br><br>I&apos;m a noob assembly programmer (and not a professional programmer at all) so I was wondering if the following would screw me in the long run:
<br>
<br>While revisiting the controller reading in a graphics test I&apos;m doing, I was also trying to clean it up by looping through the four addresses of four different sprites tiles, but then discovered the INC and DEC instructions.  So now, for example, my ReadUp looks like this:
<br>
<br>ReadUp:
<br>  LDA $4016       ; player 1 - Up
<br>  AND #%00000001  ; only look at bit 0
<br>  BEQ ReadUpDone   ; branch to ReadBDone if button is NOT pressed (0)
<br>                  ; add instructions here to do something when button IS pressed (1)
<br>
<br>   DEC $0200
<br>   DEC $0204
<br>   DEC $0208
<br>   DEC $020C
<br>ReadUpDone:        ; handling this button is done
<br>
<br>I&apos;ve ran through NESASM and it&apos;s working.  But again, I get a bad feeling like there&apos;s something that may come around and bite me later on if I use this on more complicated stuff.  Was this a decent way to handle this or was it sloppy?</div><br><br>One technique you can use to clean things up is to separate controller reading from input handling.&#xA0; <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8747" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8747">Week 7</a> talks about how to do this.<br><br>Another thing you can do is instead of treating each of those 4 sprites as individuals, is to wrap them in a &quot;metasprite&quot;.&#xA0; A metasprite will be a data type that you create to organize objects that are made up of more than one sprite.&#xA0; Your metasprite will have its own pair of X/Y coordinates, and pressing up for example will decrement the <span style="font-style: italic;">metasprite&apos;s</span> Y coordinate (1 subtraction), rather than doing each of the pieces individually (4 subtractions).&#xA0; Then, in your metasprite handling code you set the X/Y coords of the individual pieces to values <span style="font-style: italic;">relative</span> to the metasprite&apos;s X/Y.<br><br>This separation makes things cleaner when your program becomes large.&#xA0; Instead of having to keep track of 64 sprites that can go all over the place you are instead dealing with a handful of metasprites.&#xA0; Each metasprite will be in charge of setting the values for each of its own individual sprites.&#xA0; And the individual sprites themselves are effectively hidden from the rest of the program - only their parent metasprite touches them.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__38">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Feb 24, 2010 at 9:48:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks MetalSlime.&#xA0; I&apos;ve been reading the word &quot;metasprite&quot; dropped here and there on the forums recently.&#xA0; But only now after reading your description do I understand what they actually are.<br><br>I&apos;m confused, however, as to how one goes about coding something like that.&#xA0; Is it done perhaps by storing the cooresponding addresses in a db directive?&#xA0; For example, say we have a 4tile x 4tile metasprite:<br><br>Metasprite1y:<br>&#xA0; db. $0200, $0204, $0208, $020C<br>..then when I want to move it UP...<br>&#xA0; INC Metasprite1y<br>?<br><br>Or can those addresses be grouped together in a constant or variable?&#xA0; I&apos;m just getting my feet went on directives and am having a really hard time finding out exactly what they do.&#xA0; For example, I&apos;m still completely clueless on what .word does (or .dw, which I understand is the same thing from reading the NESASM usage doc).&#xA0; As for constants or variables, I&apos;m kind exploring the different uses of those, as well, testing out different things and seeing what makes the assembler yell at me.&#xA0; :-)<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__39">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 25, 2010 at 10:36:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>Here is an example of how to code the metasprite updates:</p><p>update_enemy1_sprites: <br>LDA sprite_vertical <br>STA $0214 ; save sprite Y position <br>STA $0218 <br>CLC <br>ADC #$08 <br>STA $021C <br>STA $0220 <br><br>LDA sprite_horizontal <br>STA $0217 ; load sprite X position <br>STA $021F <br>CLC <br>ADC #$08 <br>STA $021B <br>STA $0223 <br>RTS </p><p>The way your doing it doesn&apos;t mean anything.&#xA0; What MetalSlime meant is that you transfer $0214 and $0217 to the variables above, then run your moving and collision detection ON the variables, then run something like above.&#xA0; You can&apos;t update them like you&apos;re doing there.</p><p>.db is for numbers, .word is for addresses.&#xA0; MetalSlime goes through this in his sound tutorials.&#xA0; i.e.</p><p>&#xA0; .db $01, $02, $09, $FF, etc.</p><p>&#xA0; .word $0217, $0218, $02FF, etc.</p><p>or you can use variables or constants defined in your zerospace in these tables or pretty much anything you want.&#xA0; </p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__40">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Feb 25, 2010 at 1:38:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks again, m-RIGHT-n.&#xA0; That was very helpful.&#xA0; Just thought about it and rushed here to correct.&#xA0; Looks like you beet me to it.&#xA0; :-)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__41">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 25, 2010 at 1:41:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Fuck MLN. I&apos;m mRn...recognize.&#xA0;&#xA0; <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-happy.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__42">
                                                        <div class="mdl-card__title"><strong>NewUser123456789</strong> posted on 
		
			
				
				Feb 25, 2010 at 2:06:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					DOn&apos;t talk bad about Vito like that..
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__43">
                                                        <div class="mdl-card__title"><strong>DoctorMikeReddy</strong> posted on 
		
			
				
				May 8, 2010 at 9:15:10 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I realise that this is an old (if bloody excellent) tutorial, but I wondered what (if any) significance the other 7 bits have, in reading from $4016 each time? Are they just random noise? Seems strange to transmit only one bit of data each time, when the whole controller could be mapped to one byte. Also, if I had a button pressed and let go before that button state was passed to the processor, would there be some lag in value?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__44">
                                                        <div class="mdl-card__title"><strong>DoctorMikeReddy</strong> posted on 
		
			
				
				May 8, 2010 at 9:26:01 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Doh! Reread it. That&apos;s what the latch is for. So, if I let go it won&apos;t matter as the bit will already be set and I won&apos;t lose the fact that a button was pressed. However, if you are familiar with real sized projects, just how often can this call be made to the controller, given a typical load of other code? That is, what is a likely frequency of checking the controller status per second?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__45">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				May 8, 2010 at 9:31:23 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>DoctorMikeReddy</b></i><br><br>I realise that this is an old (if bloody excellent) tutorial, but I wondered what (if any) significance the other 7 bits have, in reading from $4016 each time? Are they just random noise? Seems strange to transmit only one bit of data each time, when the whole controller could be mapped to one byte. Also, if I had a button pressed and let go before that button state was passed to the processor, would there be some lag in value?</div><br>It&apos;s good practice to also check the 2nd bit (D1) because Famicom external controllers use it. The other bits are not really very useful for normal stuff (they go to the expansion port however). Bits D8-D5 are not connected at all and will return whatever value was previously on the data line (unless the cart has resistors on the data lines like the PowerPak).<br>
<div><br></div><div>The reason it transmits the data serially is so that they can get away with less wires. There&apos;s basically an 8 bit shift register (think of it as a variable) in the controller. When the controller is latched by writing to $4016 all the button states are copied to the shift register. Then when $4016 or $4017 is read the shift register will place the bits on the D0 data line one by one.</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__46">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				May 8, 2010 at 9:33:44 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>DoctorMikeReddy</b></i><br><br>Doh! Reread it. That&apos;s what the latch is for. So, if I let go it won&apos;t matter as the bit will already be set and I won&apos;t lose the fact that a button was pressed. However, if you are familiar with real sized projects, just how often can this call be made to the controller, given a typical load of other code? That is, what is a likely frequency of checking the controller status per second?</div><br>Most (probably ~all) games check the controller once per frame, so 60Hz on NTSC, 50Hz on PAL. Well, actually games that use DPCM check it multiple times per frame because NTSC CPU has a bug where it will corrupt the controller bits sometimes when DPCM samples are playing.<br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__47">
                                                        <div class="mdl-card__title"><strong>DoctorMikeReddy</strong> posted on 
		
			
				
				May 8, 2010 at 9:38:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So, if I only wanted to check A, I would rewrite $0100 to $4016 and that would reset the shift register so a read would take the A button? That right?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__48">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				May 9, 2010 at 8:11:33 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>DoctorMikeReddy</b></i><br><br>So, if I only wanted to check A, I would rewrite $0100 to $4016 and that would reset the shift register so a read would take the A button? That right?</div><br>Yes.<br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__49">
                                                        <div class="mdl-card__title"><strong>-Basti-</strong> posted on 
		
			
				
				Jun 4, 2010 at 1:15:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have another problem. I wanted to add some more sprites but i cant put more than 8 sprites on the screen. Is this because of the NES limits or is something wrong with my code?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__50">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jun 4, 2010 at 2:04:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You can only do 8 sprites per scan line, 64 sprites total.  I&apos;d imagine there is something wrong with your code.  You&apos;d have to post it to get a better answer than that.  <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-tongue.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__51">
                                                        <div class="mdl-card__title"><strong>-Basti-</strong> posted on 
		
			
				
				Jun 4, 2010 at 2:59:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think this is the important part of the code:<br>
  <br><br><br>  .bank 1<br>
  .org $E000<br>
palette:<br>
  .db $0F,$31,$32,$33,$34,$35,$36,$37,$38,$39,$3A,$3B,$3C,$3D,$3E,$0F<br>
  .db $0F,$29, $07, $36 <br>
  <br>
sprites:<br>
<br>
  ;------- Dragon--------<br>
  .db $10, $02, $00, $10 <br>
  .db $10, $03, $00, $18<br>
  .db $10, $04, $00, $1F ;<br>
  .db $18, $12, $00, $10<br>
  .db $18, $13, $00, $18<br>
  .db $18, $14, $00, $1F;<br>
  .db $1F, $22, $00, $10<br>
  .db $1F, $23, $00, $18<br>
  .db $1F, $24, $00, $1F<br>
  <br>
  <br>
  <br>
  .org $FFFA <br>    
  .dw NMI <br>       
   <br>                
  .dw RESET   <br>   
   <br>               
  .dw 0   <br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__52">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jun 4, 2010 at 3:21:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					What does your sprite loading loop look like?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__53">
                                                        <div class="mdl-card__title"><strong>-Basti-</strong> posted on 
		
			
				
				Jun 4, 2010 at 3:26:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					LoadSprites:
<br>  LDX #$00             
<br>LoadSpritesLoop:
<br>  LDA sprites, x        
<br>  STA $0200, x         
<br>  INX                 
<br>  CPX #$20              
<br>  BNE LoadSpritesLoop
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__54">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jun 4, 2010 at 3:30:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, assuming that the BNE goes to LoadSpritesLoop, you need CPX #$23 at the bottom.  X values, like so:
<br>
<br>Sprite 1: 0,1,2,3
<br>Sprite 2: 4,5,6,7
<br>Sprite 3: 8,9,a,b
<br>Sprite 4: c,d,e,f
<br>Sprite 5: 10,11,12,13
<br>Sprite 6: 14,15,16,17
<br>Sprite 7: 18,19,1a,1b
<br>Sprite 8: 1c,1d,1e,1f
<br>Sprite 9: 20,21,22,23
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__55">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Jun 4, 2010 at 3:33:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Bump your X register compare up to #$24. I&apos;d imagine you just forgot to do that after adding the four bytes for another sprite in your sprite table hehe I&apos;ve done the same thing before : )
<br>
<br>Quick question for my own curiosity. How do you add colors to your palette? I&apos;ve never really seen palette entries stored like that.<br><br>EDIT: MRN beat me to it, but it&apos;s #$24, as there are 36 bytes total. Bad MRN, BAD! ; )<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__56">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jun 4, 2010 at 3:41:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oops.  Roth is right.  I usually set my loops up differently.  But, after you load the data in loop 23, you incriment it.  So the value is in fact $24.  
<br>
<br>Kick to the <img src border="0" style="display: none;" original-src="/media/_images/expressions/teabag.gif" show-src="images/blank.gif">.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__57">
                                                        <div class="mdl-card__title"><strong>-Basti-</strong> posted on 
		
			
				
				Jun 4, 2010 at 3:45:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oh man thanks ,I really have missed that one^^ 
<br>I was editing the NA-tutorial palette and missed to fix the MRN.
<br>I&#xB4;m new in homebrewing thats the reason of this mistakes :-)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__58">
                                                        <div class="mdl-card__title"><strong>-Basti-</strong> posted on 
		
			
				
				Jun 5, 2010 at 11:19:54 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Now i have another problem. I can&#xB4;t move the 9th sprite :-(
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__59">
                                                        <div class="mdl-card__title"><strong>-Basti-</strong> posted on 
		
			
				
				Jun 7, 2010 at 1:18:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok maybe I should depict my problem better. 
<br>I&#xB4;m putting 9 sprites on the screen. With help of NN Chapter 5, I use to move them around but only the first 8 sprites move. Anybody got some advice for me?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__60">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jun 7, 2010 at 2:17:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Are you using meta-sprites?  Or are you moving each one individually?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__61">
                                                        <div class="mdl-card__title"><strong>-Basti-</strong> posted on 
		
			
				
				Jun 7, 2010 at 2:32:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I use the technique which is shown in NN 5, I think that&#xB4;s moving each sprite individually.
<br>Here&#xB4;s my code
<br>
<br>ReadLeft: 
<br>  LDA $4016       ; player 1 - Left
<br>  AND #%00000001  ; only look at bit 0
<br>  BEQ ReadLeftDone   ; branch to ReadBDone if button is NOT pressed (0)
<br>                  ; add instructions here to do something when button IS pressed (1)
<br>  LDA $0203       ; load sprite X position
<br>  SEC             ; make sure carry flag is set
<br>  SBC #$01        ; A = A - 1
<br>  STA $0203       ; save sprite X position
<br>  STA $020F       ; save sprite X position
<br>  STA $021B 
<br>  CLC
<br>  ADC #$08
<br>  STA $0207
<br>  STA $0213
<br>  STA $021F
<br>  CLC
<br>  ADC #$08
<br>  STA $020B
<br>  STA $0217
<br>  STA $2022
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__62">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jun 7, 2010 at 2:45:13 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>-Basti-</b></i><br><br>  STA $2022
<br></div><br>Typo!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__63">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jun 7, 2010 at 2:47:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>^^ Beat me to it.</p><p>The STA $2022 should be STA $2023. <br><br>I&apos;d suggest writing out a chart that looks like this: <br>vert, tile, att, horz <br>$2000,$2001,$2002,$2003 <br>$2004,$2005,$2006,$2007...etc. <br><br>That helped me a lot. And when you get multiple sprites, it helps you keep track of which address manipulates which sprite. </p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__64">
                                                        <div class="mdl-card__title"><strong>-Basti-</strong> posted on 
		
			
				
				Jun 7, 2010 at 3:02:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					thank you, now it works :-)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__65">
                                                        <div class="mdl-card__title"><strong>Kreese</strong> posted on 
		
			
				
				Jun 17, 2010 at 6:25:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					In this Nerdy Nights, we learn how to read from controllers... Is it hard to make a 4-player game using a four score? Is there any 4-player homebrews out there?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__66">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jun 17, 2010 at 6:37:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The latest X-mas 09 cart had 4 player snowball fighting action.  Other than that, I don&apos;t think so.
<br>
<br>I may incorporate 4 players into my latest project, but I haven&apos;t decided yet.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__67">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				Jun 17, 2010 at 9:26:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Kreese</b></i><br><br>In this Nerdy Nights, we learn how to read from controllers... Is it hard to make a 4-player game using a four score? Is there any 4-player homebrews out there?</div>I think Chu Chu Rocket has four player support planned.  <a href="http://www.dwedit.org/nes/chuchurocket.php" target="_blank" original-href="http://www.dwedit.org/nes/chuchurocket.php">http://www.dwedit.org/nes/chuchur...</a><br><br>From the looks of the title screen anyways.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__68">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jun 18, 2010 at 10:22:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have another Nerdy Nights planned for this, but Four Score is really easy.  You just need to read $4016/$4017 8 more times without setting the latch to get the buttons for controllers 3 and 4.  More info at <a href="http://wiki.nesdev.com/w/index.php/Four_score" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/Four_score">http://wiki.nesdev.com/w/index.ph...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__69">
                                                        <div class="mdl-card__title"><strong>-Basti-</strong> posted on 
		
			
				
				Sep 24, 2010 at 5:02:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi, I want to make am tile smoothly move. this is my code, but it doesn&#xB4;t work, can anybody help me?:
<br>
<br>LatchController:
<br>
<br>  LDA #$01
<br>  STA $4016
<br>  LDA #$00
<br>  STA $4016       ; tell both the controllers to latch buttons
<br>
<br>
<br>ReadA: 
<br>  LDA $4016       ; player 1 - A
<br>  AND #%00000001  ; only look at bit 0
<br>  BEQ ReadADone   ; branch to ReadADone if button is NOT pressed (0)
<br>
<br>fire:
<br>  LDA sprite_RAM+68          ;$D8
<br>  SBC #$01
<br>  STA sprite_RAM+68
<br>  ;---
<br>  LDA sprite_RAM+68
<br>  CMP $50
<br>  BNE fire
<br>
<br>ReadADone:        
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__70">
                                                        <div class="mdl-card__title"><strong>Herbalist</strong> posted on 
		
			
				
				Feb 2, 2011 at 3:06:33 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>-Basti-</b></i><br><br>Hi, I want to make am tile smoothly move. this is my code, but it doesn&#xB4;t work, can anybody help me?:
<br>
<br>LatchController:
<br>
<br>  LDA #$01
<br>  STA $4016
<br>  LDA #$00
<br>  STA $4016       ; tell both the controllers to latch buttons
<br>
<br>
<br>ReadA: 
<br>  LDA $4016       ; player 1 - A
<br>  AND #%00000001  ; only look at bit 0
<br>  BEQ ReadADone   ; branch to ReadADone if button is NOT pressed (0)
<br>
<br>fire:
<br>  LDA sprite_RAM+68          ;$D8
<br>  SBC #$01
<br>  STA sprite_RAM+68
<br>  ;---
<br>  LDA sprite_RAM+68
<br>  CMP $50
<br>  BNE fire
<br>
<br>ReadADone:        
<br>
<br></div><br>Really, really, late response, and Im a noob, but maybe it didnt work because you didnt put a SEC before your SBC to make sure the carry flag was set<br><br><br><br>I was also having trouble with my sprites moving in certain direction faster until I realized it was because when I was copying + pasting code I accidentally forgot to change SEC to CLC when I had to add instead of subtract. After I fixed that up my program was fine.<br><br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__71">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 2, 2011 at 11:22:52 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Is sprite_RAM a variable?  If you&apos;re not actually writing to $0200 or $0300, it won&apos;t do anything.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__72">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 2, 2011 at 11:29:48 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sprite_RAM should be a constant when used in this case.
<br>
<br>i.e.
<br>Sprite_RAM = $0200
<br>Then 
<br>STA Sprite_RAM+68
<br>means
<br>STA $0244
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__73">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Apr 25, 2011 at 12:04:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					alright w00t! got the back of Mario&apos;s head to move! now I just got to get all the different directions to work with the whole sprite! 
<br>
<br>P.S. I love that the nesasm let&apos;s you know which line your errors are being found in. makes troubleshooting a little simpler. Since I&apos;m taking the source that you are giving and manually typing it out myself to get familiar with the syntax and data structure. Sometimes I press the wrong button and poof it doesn&apos;t work.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__74">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Apr 25, 2011 at 1:41:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I can&apos;t tell you an assembler that&apos;s half modern that doesn&apos;t do that, truthfully. It lacks the nicest features IMO (+/- labels!) but it&apos;s a decent assembler still.
<br>
<br>
<br>Forewarning you, though. Don&apos;t read the controller and do the sprite movement at the same time. Store the controller value in a variable and reference it later on, because there&apos;s lots of parts in games you don&apos;t want sprites to move at all. Just telling you this now so you don&apos;t have to rediscover this bad coding problem these tutorials don&apos;t exactly say not to do. <span class="sprites_emoticons absmiddle" id="emo_wink"></span> <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__75">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Apr 25, 2011 at 6:23:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					make sense like a cut scene where the sprite is present but you don&apos;t want them moving around and such. but in the tutorials so far there hasn&apos;t been a comment that says &quot;; variable&quot;
<br>so I assume that &quot; controller1: &quot; would be a variable? and the information contained under it would be it&apos;s parameters?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__76">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Apr 25, 2011 at 6:28:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No, it&apos;s just the memory where it&apos;s stored at when it reads the controller. A lot of programs that people do just read the controller and then move, but if it&apos;s not one right ofter the other, it&apos;s probably better, haha. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__77">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Apr 25, 2011 at 7:04:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					so then how would you put the controller functions into a variable?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__78">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Apr 25, 2011 at 7:05:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Overly complicated tutorials is a common mistake.  By trying to teach everything exactly right the first time the reader will be overloaded and far more likely to fail.  Keeping it simple on purpose, then adding more detail in future lessons keeps the progress moving forward.  Ignore variables until they are brought up in week 7.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__79">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Apr 25, 2011 at 7:12:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oh ok, I&apos;ll do just that then. Currently I&apos;ve got the back of Mario&apos;s head working on the x and y axis and can move it in 8 directions. No I&apos;ve just got to get all 4 sprites moving in tangent.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__80">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Apr 25, 2011 at 7:26:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The variable is already there, it&apos;s whatever it rotates the values into. If you aren&apos;t using variables, how else do you remember the sprites X and Y coordinates? <span class="sprites_emoticons absmiddle" id="emo_wink"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__81">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Apr 25, 2011 at 8:40:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					By going back and looking at the code to see in which memory address they were put into???...
<br>
<br>but right now I&apos;m having the hardest time getting all four sprites to move together. I saw resynthesize&apos;s code and it somewhat makes sense to me but not entirely. I can get it to work left and right but up and down does some freaky stuff. I figured that my replacing the x&apos;s with y&apos;s and where the sprite address started it would just kick over and work
<br>
<br>ReadUp:			;Player 1 D-Pad UP
<br>  LDA $4016		; controller port 1 IRQ
<br>  AND #%00000001	; AND IRQ byte 
<br>  BEQ ReadUpDone	; Branch EQuals to ReadUpDone if Up was NOT pressed
<br>	;button is pressed
<br>  	
<br>  ldY #$00           ; y position of sprite starts at $0203
<br>
<br>moveloopUp:
<br>  lda $0203, y       ; load sprite y position ($2000 + y)
<br>  clc                ; make sure the carry flag is clear
<br>  SBC #$02           ; A = A + 1
<br>  sta $0203, y       ; save sprite y position
<br>  iny                ; increment y 4 times to get to next sprite
<br>  iny                ; y position
<br>  iny
<br>  iny
<br>  cpY #$13           ; if x = $13 (HEX), all 4 sprites have been moved
<br>  bne moveloopUp      ; otherwise keep going.
<br>
<br>ReadUpDone:
<br>
<br>vs his
<br>
<br>  ldx #$03           ; x position of sprite starts at $0203
<br>
<br>moveloop:
<br>  lda $2000, x       ; load sprite X position ($2000 + x)
<br>  clc                ; make sure the carry flag is clear
<br>  adc #$02           ; A = A + 1
<br>  sta $2000, x       ; save sprite X position
<br>  inx                ; increment X 4 times to get to next sprite
<br>  inx                ; x position
<br>  inx
<br>  inx
<br>  cpx #$0F           ; if x = $0f, all 4 sprites have been moved
<br>  bne moveloop       ; otherwise keep going.
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__82">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Apr 25, 2011 at 8:53:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Mailed, I&apos;ll help you there. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__83">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Apr 27, 2011 at 2:31:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Alright, So I came back to this and finally managed to get all the sprites moving together But now I&apos;ve come to another problem. they seem to move at different speeds in different direction. Up goes nice and slow, left goes the same speed. however Down and right go faster. I assume it has to deal with the Y and X coordinate getting&#xA0;&#xA0; loaded first for Up and Left, then for Down and right it doubles it in some respect.<br><br>I have the flag CLC&apos;ed for each sprite on each direction then SEC&apos;ed for each one in each direction. (At first I thought it was because the flag was carrying the math and at first it helped with one of the direction when 3 of them were moving fast and Up was the only one that was slow) and it may be a Flag issue but I&apos;m just not sure<br><br>any suggestions?<br><br>P.S. I&apos;m also working on the Background as part of this piece and I&apos;m not quite finished with it so a lot of 2&apos;s will show up when complied. <br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__84">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 27, 2011 at 2:50:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You only need SEC with SBC and CLC with ADC.  Not both SEC and CLC.
<br>
<br>You&apos;re clearing the carry flag and setting the carry flag.  Try that and see if it works.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__85">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Apr 27, 2011 at 2:59:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yup, that Did it. thanks MRM!
<br>
<br>but why do you only use one for one not the other?<br><br>[EDIT]<br><br>let me rephrase, why do you only use SEC with SBC and CLC with ADC? what makes the difference?<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__86">
                                                        <div class="mdl-card__title"><strong>Berserker</strong> posted on 
		
			
				
				Jun 21, 2011 at 12:41:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry to bump a rather old thread but...<br><br>How do I get the sprite to:<br><br>A. Move faster. (Doesn&apos;t necessarily need to be variable, but I may be doing it wrong or there may be a better way. Code only changed for Dpad_Right)<br>B. Move more smoothly.<br>C. Move more accurately to the button press.<br><br>Thanks.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__87">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jun 21, 2011 at 2:38:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Berserker</b></i><br><br>Sorry to bump a rather old thread but...<br><br>How do I get the sprite to:<br><br>A. Move faster. (Doesn&apos;t necessarily need to be variable, but I may be doing it wrong or there may be a better way. Code only changed for Dpad_Right)<br>B. Move more smoothly.<br>C. Move more accurately to the button press.<br><br>Thanks.<br></div><p>A. Change $01 to however fast you want it to move.&#xA0;As you get more advanced, you&apos;ll figure out the whole &quot;meta sprite&quot; deal.&#xA0; It works easier.</p><p>B. I assume that this is in reference to the &quot;$08&quot; you put in there.&#xA0; That means that you move 8 pixels per frame.&#xA0; You need to slow down if you don&apos;t want it to jump around.</p><p>C.&#xA0; I don&apos;t know, but I suspect that if you used a more advanced controller reading method, it would work better.&#xA0; Like MetalSlime uses.&#xA0; <br><br><br></p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__88">
                                                        <div class="mdl-card__title"><strong>Memblers</strong> posted on 
		
			
				
				Jun 21, 2011 at 4:19:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Berserker</b></i><br><br>Sorry to bump a rather old thread but...<br><br>How do I get the sprite to:<br><br>A. Move faster. (Doesn&apos;t necessarily need to be variable, but I may be doing it wrong or there may be a better way. Code only changed for Dpad_Right)<br>B. Move more smoothly.<br>C. Move more accurately to the button press.<br><br>Thanks.<br></div><br><br>A/B:&#xA0; You&apos;ll use what is known as fixed-point addition (also using it like this it&apos;s often called &quot;sub-pixel precision&quot;.&#xA0; That just means there is a decimal point, and it&apos;s fixed to a certain position.&#xA0;&#xA0;&#xA0; The easy way is to make your speed use 2 bytes, instead of adding #1 per pixel to your sprite position, you do a 16-bit add and use the upper 8 bits as the actual sprite position (so your sprite position must be 16-bit as well, with the lower 8-bits as it&apos;s own variable, completely separate from NES sprite-memory).&#xA0; So the &quot;decimal point&quot; is between those 2 bytes, giving you 256 fractional speeds (and by preserving the lower 8 bits of the sprite position, you&apos;ll have 256 fractional positions within each pixel on the screen).&#xA0; That allows for really smooth movement, and all kinds of different speed possibilities.&#xA0; Also makes it easy to adjust for NTSC/PAL differences.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__89">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jun 21, 2011 at 9:01:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					^^ think the &quot;ticker&quot; in metalslimes sound tutorials.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__90">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 15, 2012 at 4:55:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Is this an acceptable way to make sprites move slower than 1 pixel per Vblank:
<br>
<br>; Just before JMP Forever I cleared the X register.
<br>ReadA:
<br>LDA $4016 ; player 1 - A
<br>AND #%00000001 ; only look at bit 0
<br>BEQ ReadADone ; branch to ReadADone if button is NOT pressed (0)
<br>; add instructions here to do something when button IS pressed (1)
<br>INX ; if a press is registered for 3 Vblanks then translate the sprite.
<br>CPX #$03
<br>BNE ReadADone
<br>LDX #$00 ; Once it has been moved reset the Vblank counter.
<br>LDA $0203 ; load sprite X position
<br>CLC ; make sure the carry flag is clear
<br>ADC #$01 ; A = A + 3 (changed to 3)
<br>STA $0203 ; save sprite X position (sprite moves 1 unit right).
<br>ReadADone: ; handling this button is done
<br>
<br>I&apos;ve tried it and it works, just wondering if it&apos;s the right way to go about it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__91">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 15, 2012 at 7:18:05 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It looks like a workaround. I don&apos;t see anything wrong with it up front though I can see that if you really wanted something to drag, like moving through mud, it could use up precious processor time.  I think what Memblers is suggesting three posts above is worth looking into.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__92">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 15, 2012 at 12:17:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Basically what Memblers is saying is this:
<br>
<br>  LDA PartialVariable
<br>  CLC
<br>  ADC #$80    ;any speed here.
<br>  STA PartialVariable
<br>  LDA $0200
<br>  ADC #$00    ;any speed here. (usually #00 or #01 unless your stuff is moving super fast)
<br>  STA $0200
<br>
<br>You have control over two addresses now, with this way giving you a ton more speed options.  The downside to this is you have to have a partialvariable for every sprite you want more control over. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__93">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 15, 2012 at 6:22:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the replies guys. But I don&apos;t exactly follow where the sprites postion ($0200) is being updated though, following memory:<br>
<br>
A = PartialVariable<br>
A = PartialVariable+$80<br>
PartialVariable = A (so partialVariable is being updated each time).<br>
A = $0200 (same x-position each time? PartialVariable isn&apos;t being to offset number stored in $0200?)<br>
A = $0200<br>
$0200 = A<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__94">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 15, 2012 at 9:39:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think it has to do with the carry flag.  Someone with better knowledge should reply.  I just know it works. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__95">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Jun 30, 2012 at 9:45:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					alright, so I&apos;m back at the NN tutorials after a year of hiatus. Sadly most of my saved stuff from back then is gone so I&apos;ve started over. a lot of things make WAY more sense this time around but I have a question. why does this 
<br>ReadUp:	
<br>	LDA $4016     ; player 1 - Up
<br>	AND #%00000001
<br>	BEQ ReadUpDone
<br>	LDA $0203 ; load sprite 1 position
<br>	SEC ; make sure carry flag is set
<br>	SBC #$01 ; A = A - 1
<br>	STA $0203 ; save sprite 1 position
<br>	LDA $0207 ; load sprite 2 position
<br>	SEC ; make sure carry flag is set
<br>	SBC #$01 ; A = A - 1
<br>	STA $0207 ; save sprite 2 position
<br>	LDA $020B ; load sprite 3 position
<br>	SEC ; make sure carry flag is set
<br>	SBC #$01 ; A = A - 1
<br>	STA $020B ; save sprite 3 position
<br>	LDA $020F ; load sprite 4 position
<br>	SEC ; make sure carry flag is set
<br>	SBC #$01 ; A = A - 1
<br>	STA $020F ; save sprite 4 position 
<br>ReadUpDone:
<br>
<br>
<br>move it horizontally while this 
<br>
<br>ReadUp:	
<br>	LDA $4016     ; player 1 - Up
<br>	AND #%00000001
<br>	BEQ ReadUpDone
<br>	LDA $0200 ; load sprite 1 position
<br>	SEC ; make sure carry flag is set
<br>	SBC #$01 ; A = A - 1
<br>	STA $0200 ; save sprite 1 position
<br>	LDA $0204 ; load sprite 2 position
<br>	SEC ; make sure carry flag is set
<br>	SBC #$01 ; A = A - 1
<br>	STA $0204 ; save sprite 2 position
<br>	LDA $0208 ; load sprite 3 position
<br>	SEC ; make sure carry flag is set
<br>	SBC #$01 ; A = A - 1
<br>	STA $0208 ; save sprite 3 position
<br>	LDA $020C ; load sprite 4 position
<br>	SEC ; make sure carry flag is set
<br>	SBC #$01 ; A = A - 1
<br>	STA $020C ; save sprite 4 position 
<br>ReadUpDone:
<br>
<br>moves it vertically? 
<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__96">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jun 30, 2012 at 9:49:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m not sure what you&apos;re doing, but that&apos;s a terrible way of reading the controller. Just realize the right way to do it is to get all the data in one byte then do your bit masks with it, not straight off of $4016 like it is doing.<br>
<br>
But the reason it moves it different ways is because each of the 64 OAM data values goes $200=Y location,$201=Tile,$202=Sprite Attribute,$204=X location.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__97">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Jun 30, 2012 at 9:56:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					yes yes I know, we talked about that last year. lol but I&apos;m just going through the tutorials as they are. You sent me a ton of PMs helping me but going back over them my mind decided to freeze. For right now I just want to know why there&apos;s a difference in the movement.<br>
<br>
---EDIT--<br>
<br>
i didn&apos;t realize that you had answered my question in that response. thank you.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__98">
                                                        <div class="mdl-card__title"><strong>The Adventurer</strong> posted on 
		
			
				
				Sep 27, 2012 at 4:34:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div>
	I&apos;ve been going through the tutorial (amazing resource btw) and have managed to suss out how to rebind all four sprites to move with the directional buttons. Figuring out that everything as a specific registry port in a specific order was a bit of a learning experience. But I&apos;m starting to get it.</div>
<div>
	&#xA0;</div>
<div>
	My question is... I know this works...</div>
<div>
	&#xA0;</div>
<div>
	ReadR:</div>
<div>
	&#xA0; LDA $4016 &#xA0; &#xA0; &#xA0; ; player 1 - Right</div>
<div>
	&#xA0; AND #%00000001 &#xA0;; only look at bit 0</div>
<div>
	&#xA0; BEQ ReadRDone &#xA0; ; branch to ReadBDone if button is NOT pressed (0)</div>
<div>
	&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; add instructions here to do something when button IS pressed (1)</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; LDA $0203 &#xA0; &#xA0; &#xA0; ; load sprite0 X position</div>
<div>
	&#xA0; CLC &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; make sure carry flag is set</div>
<div>
	&#xA0; ADC #$01 &#xA0; &#xA0; &#xA0; &#xA0;; A = A + 1</div>
<div>
	&#xA0; STA $0203 &#xA0; &#xA0; &#xA0; ; save sprite0 X position</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; LDA $0207 &#xA0; &#xA0; &#xA0; ; load sprite1 X position</div>
<div>
	&#xA0; CLC</div>
<div>
	&#xA0; ADC #$01</div>
<div>
	&#xA0; STA $0207</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; LDA $020B &#xA0; &#xA0; &#xA0; ; load sprite2 X position</div>
<div>
	&#xA0; CLC</div>
<div>
	&#xA0; ADC #$01</div>
<div>
	&#xA0; STA $020B</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; LDA $020F &#xA0; &#xA0; &#xA0; ; load sprite3 X position</div>
<div>
	&#xA0; CLC</div>
<div>
	&#xA0; ADC #$01</div>
<div>
	&#xA0; STA $020F</div>
<div>
	&#xA0;&#xA0;</div>
<div>
	ReadRDone: &#xA0; &#xA0; &#xA0; &#xA0;; handling this button is done</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	But... why doesn&apos;t this work?</div>
<div>
	&#xA0;</div>
<div>
	ReadRight:</div>
<div>
	&#xA0; LDA $4016 &#xA0; &#xA0; &#xA0; ; player 1 - Right</div>
<div>
	&#xA0; AND #%00000001 &#xA0;; only look at bit 0</div>
<div>
	&#xA0; BEQ ReadRightDone &#xA0; ; branch to ReadBDone if button is NOT pressed (0)</div>
<div>
	&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; add instructions here to do something when button IS pressed (1)</div>
<div>
	&#xA0; LDA $0203</div>
<div>
	&#xA0; LDA $0207</div>
<div>
	&#xA0; LDA $020B</div>
<div>
	&#xA0; LDA $020F</div>
<div>
	&#xA0; CLC</div>
<div>
	&#xA0; ADC #$01</div>
<div>
	&#xA0; STA $0203</div>
<div>
	&#xA0; STA $0207</div>
<div>
	&#xA0; STA $020B</div>
<div>
	&#xA0; STA $020F &#xA0;</div>
<div>
	&#xA0;&#xA0;</div>
<div>
	ReadRightDone: &#xA0; &#xA0; &#xA0; &#xA0;; handling this button is done</div>
<div>
	&#xA0;</div>
<div>
	I mean... it sort of works. It will move the entire sprite around the screen. BUT. It garbles the sprites themselves (it kinda reverses them front to back on the first button press) Is there anything at a glance that would cause this strangeness? Because it sure cuts down on a few lines of code, and makes it look neater.</div>
<div>
	&#xA0;</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__99">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Sep 27, 2012 at 8:42:23 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You can only have one value in a register at a time.<br>
So your way, you add 1 to the value in $020F.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__100">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Sep 27, 2012 at 12:16:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The A accumulator only holds 8 bits.  If you do LDA twice in a row, the first one is overwritten.  So the first 3x LDA are ignored when you do the last LDA $020F, and the same value gets written to $0203/$0207/$020B/$020F.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__101">
                                                        <div class="mdl-card__title"><strong>The Adventurer</strong> posted on 
		
			
				
				Sep 27, 2012 at 3:06:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	The A accumulator only holds 8 bits. If you do LDA twice in a row, the first one is overwritten. So the first 3x LDA are ignored when you do the last LDA $020F, and the same value gets written to $0203/$0207/$020B/$020F.</div>
<br>
Ah. Okay that makes sense.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__102">
                                                        <div class="mdl-card__title"><strong>jarrodparkes</strong> posted on 
		
			
				
				Oct 17, 2012 at 9:13:30 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I can&apos;t get next to a debugger at the moment, but I hoped this question might have a quick answer.<br>
<br>
If directives like the following are handled first by the assembler like &quot;C pre-processor directives&quot;, then will each piece of data be stored off in memory prior to the first line of opcode being executed? Additionally, if that is the case, wouldn&apos;t the assembler be generating similar machine code to handle the initial storage of data in .db directives? If so, is there ever a need to worry about the time taken for those operations?<br>
<br>
sprites:<br>
;vert tile attr horiz<br>
.db $80, $32, $00, $80 ;sprite 0<br>
.db $80, $33, $00, $88 ;sprite 1<br>
.db $88, $34, $00, $80 ;sprite 2<br>
.db $88, $35, $00, $88 ;sprite 3
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__103">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Oct 17, 2012 at 10:07:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Nope. The data goes in to the ROM how you set it up. Imagine this as assembly:
<br>
<br>Code:
<br>  LDA #$Whatever
<br>  JMP .NextCode
<br>CodeData: .db $00,$00
<br>.NextCode
<br>  STA Wherever
<br>  RTS
<br>
<br>That would be compiled in the order it is put in. First two commands, then come data, then two more commands. It does not optimize anything for you, you have to do that by managing the data and program yourself.
<br>
<br>And the speed for all the instructions can be found online. Minimum is two, maximum is 7 CPU clocks. LDA #$00 is 2 clocks for example, while a more complex instruction like LDA [$20],Y would take 5 (or 6 if a page is crossed).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__104">
                                                        <div class="mdl-card__title"><strong>jarrodparkes</strong> posted on 
		
			
				
				Oct 17, 2012 at 10:18:06 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m not sure I am following. In the controller.asm example the following code is used...
<br>
<br>LoadPalettes:
<br>  LDA $2002             ; read PPU status to reset the high/low latch
<br>  LDA #$3F
<br>  STA $2006             ; write the high byte of $3F00 address
<br>  LDA #$00
<br>  STA $2006             ; write the low byte of $3F00 address
<br>  LDX #$00              ; start out at 0
<br>LoadPalettesLoop:
<br>  LDA palette, x        ; load data from address (palette + the value in x)
<br>
<br>The &quot;palette&quot; label is defined near the bottom of the assembly file. Also, right before the label, the directive is given to start loading data/instructions into memory location $E000. For the above execution to work as intended, I&apos;m guessing the assembler would have to ensure that all the palette data has been stored in memory locations starting at $E000 prior to execution?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__105">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Oct 17, 2012 at 10:46:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It is just pulling data from the &quot;palette&quot; data map right at that moment. Nothing is stored in memory beforehand.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__106">
                                                        <div class="mdl-card__title"><strong>jarrodparkes</strong> posted on 
		
			
				
				Oct 17, 2012 at 10:51:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So is data ever getting stored in those locations (the ones at $E000)? If so, when? Or is this all hindering on some sort of pseudo-state of storage?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__107">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Oct 17, 2012 at 12:13:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					??
<br>
<br>It&apos;s only stored when you do a STA command.  
<br>
<br>
<br>...unless it&apos;s the ROM, that is.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__108">
                                                        <div class="mdl-card__title"><strong>jarrodparkes</strong> posted on 
		
			
				
				Oct 17, 2012 at 12:24:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					$E000 falls into the range of 32KB cartridge ROM. So are the .DB directives seen below &quot;storing&quot; those values beforehand, so that when the LoadPalette&apos;s label is hit it can retrieve those values?
<br>
<br>  .bank 1
<br>  .org $E000
<br>palette:
<br>  .db $0F,$31,$32,$33,$34,$35,$36,$37,$38,$39,$3A,$3B,$3C,$3D,$3E,$0F
<br>  .db $0F,$1C,$15,$14,$31,$02,$38,$3C,$0F,$1C,$15,$14,$31,$02,$38,$3C 
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__109">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Oct 17, 2012 at 12:43:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No, this is not like C where you have to TELL the preprocessor that a function will come up sometime later in the program and what type and what variables it needs. I reread it and that makes sense what you&apos;re asking now. But yes, if you use hardcoded values and not labels, then yes you need to make sure the ROM data at $E000 is the palette. If you use labels though, it keeps &quot;track&quot; of everything for you and you don&apos;t need to do anything. And technically it&apos;s &quot;storing&quot; the values, but it&apos;s not doing it before hand. ROM is programmed with that data, it just puts it there. And you can access any part of the ROM (In the 32KB range) at any time, but yeah in that program it uses it. But if you&apos;re talking about $3F00 for the palette, that&apos;s on the PPU.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__110">
                                                        <div class="mdl-card__title"><strong>jarrodparkes</strong> posted on 
		
			
				
				Oct 17, 2012 at 1:46:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for all the help. I think I am turning the corner on this concept now.<br>
<br>
I&apos;m going to try to summarize, please tweak if necessary:<br>
The assembler has already assembled those values of the palette into ROM, so when the .NES is executing it can access them. Thus, the palette values are not &quot;stored&quot; during execution, but have already been placed in the correct memory addresses via assembling/compiling.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__111">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Oct 17, 2012 at 3:13:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thats right, anything that is &quot;.db&quot; is in ROM so there is no load time.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__112">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Oct 15, 2013 at 5:18:31 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<a href="http://s1074.photobucket.com/user/KilleRotom/media/softie000_zpsafd56252.png.html" target="_blank" original-href="http://s1074.photobucket.com/user/KilleRotom/media/softie000_zpsafd56252.png.html"><img src original-src="http://i1074.photobucket.com/albums/w408/KilleRotom/softie000_zpsafd56252.png" show-src="scraper/images/softie000_zpsafd56252.png"></a><br>
I managed to move my little dude in all 4 directions, but the screen is garbled! My code is as follows...<br>
<div>
	&#xA0; .inesprg 1 ; 1x 16KB PRG code&#xA0;</div>
<div>
	&#xA0; .ineschr 1 ; 1x 8KB CHR data&#xA0;</div>
<div>
	&#xA0; .inesmap 0 ; mapper 0 = NROM, no bank swapping&#xA0;</div>
<div>
	&#xA0; .inesmir 1 ; background mirroring&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	;;;;;;;;;;;;;;;&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; .bank 0&#xA0;</div>
<div>
	&#xA0; .org $C000&#xA0;</div>
<div>
	RESET:&#xA0;</div>
<div>
	&#xA0; SEI&#xA0;</div>
<div>
	&#xA0; CLD&#xA0;</div>
<div>
	&#xA0; LDX #$40&#xA0;</div>
<div>
	&#xA0; STX $4017&#xA0;</div>
<div>
	&#xA0; LDX #$FF&#xA0;</div>
<div>
	&#xA0; TXS&#xA0;</div>
<div>
	&#xA0; INX&#xA0;</div>
<div>
	&#xA0; STX $2000&#xA0;</div>
<div>
	&#xA0; STX $2001&#xA0;</div>
<div>
	&#xA0; STX $4010&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	vblankwait1:&#xA0;</div>
<div>
	&#xA0; BIT $2002&#xA0;</div>
<div>
	&#xA0; BPL vblankwait1&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	clrmem:&#xA0;</div>
<div>
	&#xA0; LDA #$00&#xA0;</div>
<div>
	&#xA0; STA $0000, x&#xA0;</div>
<div>
	&#xA0; STA $0100, x&#xA0;</div>
<div>
	&#xA0; STA $0300, x&#xA0;</div>
<div>
	&#xA0; STA $0400, x&#xA0;</div>
<div>
	&#xA0; STA $0500, x&#xA0;</div>
<div>
	&#xA0; STA $0600, x&#xA0;</div>
<div>
	&#xA0; STA $0700, x&#xA0;</div>
<div>
	&#xA0; LDA #$FE&#xA0;</div>
<div>
	&#xA0; STA $0200, x&#xA0;</div>
<div>
	&#xA0; INX&#xA0;</div>
<div>
	&#xA0; BNE clrmem&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	vblankwait2:&#xA0;</div>
<div>
	&#xA0; BIT $2002&#xA0;</div>
<div>
	&#xA0; BPL vblankwait2&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	LoadPalettes:&#xA0;</div>
<div>
	&#xA0; LDA $2002 ; read PPU &#xA0; STAtus to reset the high/low latch&#xA0;</div>
<div>
	&#xA0; LDA #$3F&#xA0;</div>
<div>
	&#xA0; STA $2006 ; write the high byte of $3F00 address&#xA0;</div>
<div>
	&#xA0; LDA #$00&#xA0;</div>
<div>
	&#xA0; STA $2006 ; write the low byte of $3F00 address&#xA0;</div>
<div>
	&#xA0; LDX #$00&#xA0;</div>
<div>
	LoadPalettesLoop:&#xA0;</div>
<div>
	&#xA0; LDA palette, x ;load palette byte&#xA0;</div>
<div>
	&#xA0; STA $2007 ;write to PPU&#xA0;</div>
<div>
	&#xA0; INX ;set index to next byte&#xA0;</div>
<div>
	&#xA0; CPX #$20&#xA0;</div>
<div>
	&#xA0; BNE LoadPalettesLoop ;if x = $20, 32 bytes copied, all done&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	load_sprite_data:&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; LDX #$00&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	.loop:&#xA0;</div>
<div>
	&#xA0; LDA data, x&#xA0;</div>
<div>
	&#xA0; STA $0200, x&#xA0;</div>
<div>
	&#xA0; INX&#xA0;</div>
<div>
	&#xA0; CPX #$FF&#xA0;</div>
<div>
	&#xA0; BNE .loop&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	RTS&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; LDA #%10000000 ; enable NMI, sprites from Pattern Table 1&#xA0;</div>
<div>
	&#xA0; STA $2000&#xA0;</div>
<div>
	&#xA0; LDA #%00010000 ; enable sprites&#xA0;</div>
<div>
	&#xA0; STA $2001&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	Forever:&#xA0;</div>
<div>
	&#xA0; JMP Forever ;jump back to Forever, infinite loop&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	NMI:&#xA0;</div>
<div>
	&#xA0; LDA #$00&#xA0;</div>
<div>
	&#xA0; STA $2003 ; set the low byte (00) of the RAM address&#xA0;</div>
<div>
	&#xA0; LDA #$02&#xA0;</div>
<div>
	&#xA0; STA $4014 ; set the high byte (02) of the RAM address, &#xA0; STArt the transfer&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	LatchController:&#xA0;</div>
<div>
	&#xA0; LDA #$01&#xA0;</div>
<div>
	&#xA0; STA $4016&#xA0;</div>
<div>
	&#xA0; LDA #$00&#xA0;</div>
<div>
	&#xA0; STA $4016 ; tell both the controllers to latch buttons&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	ReadA:&#xA0;</div>
<div>
	&#xA0; LDA $4016 &#xA0; &#xA0; &#xA0; ; player 1 - A</div>
<div>
	&#xA0; AND #%00000001 &#xA0;; only look at bit 0</div>
<div>
	&#xA0; BEQ ReadADone &#xA0; ; branch to ReadADone if button is NOT pressed (0)</div>
<div>
	ReadADone:</div>
<div>
	ReadB:&#xA0;</div>
<div>
	&#xA0; LDA $4016 &#xA0; &#xA0; &#xA0; ; player 1 - A</div>
<div>
	&#xA0; AND #%00000001 &#xA0;; only look at bit 0</div>
<div>
	&#xA0; BEQ ReadBDone &#xA0; ; branch to ReadADone if button is NOT pressed (0)</div>
<div>
	ReadBDone:</div>
<div>
	ReadSe:&#xA0;</div>
<div>
	&#xA0; LDA $4016 &#xA0; &#xA0; &#xA0; ; player 1 - A</div>
<div>
	&#xA0; AND #%00000001 &#xA0;; only look at bit 0</div>
<div>
	&#xA0; BEQ ReadSeDone &#xA0; ; branch to ReadADone if button is NOT pressed (0)</div>
<div>
	ReadSeDone:</div>
<div>
	ReadSt:&#xA0;</div>
<div>
	&#xA0; LDA $4016 &#xA0; &#xA0; &#xA0; ; player 1 - A</div>
<div>
	&#xA0; AND #%00000001 &#xA0;; only look at bit 0</div>
<div>
	&#xA0; BEQ ReadStDone &#xA0; ; branch to ReadADone if button is NOT pressed (0)</div>
<div>
	ReadStDone:</div>
<div>
	ReadD:&#xA0;</div>
<div>
	&#xA0; LDA $4016 ; dans l&apos;ordre - A,B,Se,St,H,B,G,D&#xA0;</div>
<div>
	&#xA0; AND #%00000001&#xA0;</div>
<div>
	&#xA0; BEQ ReadDDone&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; LDA $0200&#xA0;</div>
<div>
	&#xA0; SEC&#xA0;</div>
<div>
	&#xA0; SBC #$01&#xA0;</div>
<div>
	&#xA0; STA $0200&#xA0;</div>
<div>
	&#xA0; LDA $0204&#xA0;</div>
<div>
	&#xA0; SEC&#xA0;</div>
<div>
	&#xA0; SBC #$01&#xA0;</div>
<div>
	&#xA0; STA $0204&#xA0;</div>
<div>
	&#xA0; LDA $0208&#xA0;</div>
<div>
	&#xA0; SEC&#xA0;</div>
<div>
	&#xA0; SBC #$01&#xA0;</div>
<div>
	&#xA0; STA $0208&#xA0;</div>
<div>
	&#xA0; LDA $020C&#xA0;</div>
<div>
	&#xA0; SEC&#xA0;</div>
<div>
	&#xA0; SBC #$01&#xA0;</div>
<div>
	&#xA0; STA $020C&#xA0;</div>
<div>
	ReadDDone:&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	ReadU:&#xA0;</div>
<div>
	&#xA0; LDA $4016 ; dans l&apos;ordre - A,B,Se,St,H,B,G,D&#xA0;</div>
<div>
	&#xA0; AND #%00000001&#xA0;</div>
<div>
	&#xA0; BEQ ReadUDone&#xA0;</div>
<div>
	&#xA0; LDA $0200&#xA0;</div>
<div>
	&#xA0; CLC&#xA0;</div>
<div>
	&#xA0; ADC #$01&#xA0;</div>
<div>
	&#xA0; STA $0200&#xA0;</div>
<div>
	&#xA0; LDA $0204&#xA0;</div>
<div>
	&#xA0; CLC&#xA0;</div>
<div>
	&#xA0; ADC #$01&#xA0;</div>
<div>
	&#xA0; STA $0204&#xA0;</div>
<div>
	&#xA0; LDA $0208&#xA0;</div>
<div>
	&#xA0; CLC&#xA0;</div>
<div>
	&#xA0; ADC #$01&#xA0;</div>
<div>
	&#xA0; STA $0208&#xA0;</div>
<div>
	&#xA0; LDA $020C&#xA0;</div>
<div>
	&#xA0; CLC&#xA0;</div>
<div>
	&#xA0; ADC #$01&#xA0;</div>
<div>
	&#xA0; STA $020C&#xA0;</div>
<div>
	ReadUDone:&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; LDA $4016 ; dans l&apos;ordre - A,B,Se,St,H,B,G,D&#xA0;</div>
<div>
	&#xA0; AND #%00000001&#xA0;</div>
<div>
	&#xA0; BEQ ReadLDone&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; LDA $0203&#xA0;</div>
<div>
	&#xA0; SEC&#xA0;</div>
<div>
	&#xA0; SBC #$01&#xA0;</div>
<div>
	&#xA0; STA $0203&#xA0;</div>
<div>
	&#xA0; LDA $0207&#xA0;</div>
<div>
	&#xA0; SEC&#xA0;</div>
<div>
	&#xA0; SBC #$01&#xA0;</div>
<div>
	&#xA0; STA $0207&#xA0;</div>
<div>
	&#xA0; LDA $020B&#xA0;</div>
<div>
	&#xA0; SEC&#xA0;</div>
<div>
	&#xA0; SBC #$01&#xA0;</div>
<div>
	&#xA0; STA $020B&#xA0;</div>
<div>
	&#xA0; LDA $020F&#xA0;</div>
<div>
	&#xA0; SEC&#xA0;</div>
<div>
	&#xA0; SBC #$01&#xA0;</div>
<div>
	&#xA0; STA $020F&#xA0;</div>
<div>
	ReadLDone:&#xA0;</div>
<div>
	&#xA0; LDA $4016 ; dans l&apos;ordre - A,B,Se,St,H,B,G,D&#xA0;</div>
<div>
	&#xA0; AND #%00000001&#xA0;</div>
<div>
	&#xA0; BEQ ReadRDone&#xA0;</div>
<div>
	&#xA0; LDA $0203&#xA0;</div>
<div>
	&#xA0; CLC&#xA0;</div>
<div>
	&#xA0; ADC #$01&#xA0;</div>
<div>
	&#xA0; STA $0203&#xA0;</div>
<div>
	&#xA0; LDA $0207&#xA0;</div>
<div>
	&#xA0; CLC&#xA0;</div>
<div>
	&#xA0; ADC #$01&#xA0;</div>
<div>
	&#xA0; STA $0207&#xA0;</div>
<div>
	&#xA0; LDA $020B&#xA0;</div>
<div>
	&#xA0; CLC&#xA0;</div>
<div>
	&#xA0; ADC #$01&#xA0;</div>
<div>
	&#xA0; STA $020B&#xA0;</div>
<div>
	&#xA0; LDA $020F&#xA0;</div>
<div>
	&#xA0; CLC&#xA0;</div>
<div>
	&#xA0; ADC #$01&#xA0;</div>
<div>
	&#xA0; STA $020F&#xA0;</div>
<div>
	ReadRDone:&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	RTI&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	;;;;;;;;;;;;;;&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; .bank 1&#xA0;</div>
<div>
	&#xA0; .org $E000&#xA0;</div>
<div>
	palette:&#xA0;</div>
<div>
	&#xA0; .db $0F,$29,$37,$3D,$0F,$35,$36,$37,$0F,$39,$3A,$3B,$0F,$3D,$3E,$0F&#xA0;</div>
<div>
	&#xA0; .db $0F,$29,$37,$3D,$0F,$02,$38,$3C,$0F,$1C,$15,$14,$0F,$02,$38,$3C&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	data:&#xA0;</div>
<div>
	&#xA0; .db $80,$00,$00,$80,$80,$01,$00,$88,$88,$02,$00,$80,$88,$03,$00,$88&#xA0;</div>
<div>
	&#xA0; .org $FFFA ;first of the three vectors &#xA0; STArts here&#xA0;</div>
<div>
	&#xA0; .dw NMI ;when an NMI happens (once per frame if enabled) the&#xA0;</div>
<div>
	;processor will jump to the label NMI:&#xA0;</div>
<div>
	&#xA0; .dw RESET ;when the processor first turns on or is reset, it will jump&#xA0;</div>
<div>
	;to the label RESET:&#xA0;</div>
<div>
	&#xA0; .dw 0 ;external interrupt IRQ is not used in this tutorial&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	;;;;;;;;;;;;;;&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; .bank 2&#xA0;</div>
<div>
	&#xA0; .org $0000&#xA0;</div>
<div>
	&#xA0; .incbin &quot;mario.chr&quot; ;includes 8KB graphics file from SMB1</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__113">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Oct 15, 2013 at 8:54:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, when you don&apos;t set the screen up in any way, you expect it to be right? <span class="sprites_emoticons absmiddle" id="emo_tongue"></span> Also, don&apos;t read straight off of $4016.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__114">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Oct 15, 2013 at 10:26:32 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div style="font-family: Arial, Verdana, sans-serif; font-size: 12px; color: rgb(34, 34, 34); background-color: rgb(255, 255, 255); ">
	<div class="FTQUOTE" style="background-color: rgb(255, 255, 255); border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); border-left-width: 1px; border-left-style: solid; border-left-color: rgb(119, 119, 119); border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); border-top-width: 1px; border-top-style: solid; border-top-color: rgb(119, 119, 119); width: 529px; margin-top: 10px; margin-right: 30px; margin-bottom: 10px; margin-left: 30px; padding-top: 6px; padding-right: 6px; padding-bottom: 6px; padding-left: 6px; ">
		&#xA0;</div>
</div>
Never mind. I got it now!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__115">
                                                        <div class="mdl-card__title"><strong>Dreadmoc</strong> posted on 
		
			
				
				Apr 23, 2014 at 1:56:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					How do you know the location of each sprite. I gathered 203 from from reading the code, but I can&apos;t seem to find 207, 20b, or 20f anywhere.
<br>
<br>I wanted to do the &quot;homework&quot; on my own as best I could, but I had to read through the thread to figure out the location of the other three sprites. How would I locate them on my own?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__116">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 23, 2014 at 8:11:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Dread</b></i><br>
	<br>
	How do you know the location of each sprite. I gathered 203 from from reading the code, but I can&apos;t seem to find 207, 20b, or 20f anywhere.<br>
	<br>
	I wanted to do the &quot;homework&quot; on my own as best I could, but I had to read through the thread to figure out the location of the other three sprites. How would I locate them on my own?</div>
<br>
Sprite data starts at $0200 and the address is increased by 1 for each byte afterwards. Each sprite needs 4 bytes of data and is loaded in this order:<br>
1. Vertical Position<br>
2. Tile Number<br>
3. Sprite Attribute<br>
4. Horizontal Position<br>
<br>
If you look at the sprites section, you will see this.<br>
<br>
sprites:<br>
&#xA0;&#xA0;&#xA0;&#xA0; ;vert tile attr horiz<br>
&#xA0; .db $80, $32, $00, $80&#xA0;&#xA0; ;sprite 0<br>
&#xA0; .db $80, $33, $00, $88&#xA0;&#xA0; ;sprite 1<br>
&#xA0; .db $88, $34, $00, $80&#xA0;&#xA0; ;sprite 2<br>
&#xA0; .db $88, $35, $00, $88&#xA0;&#xA0; ;sprite 3<br>
<br>
So, the first sprite would load like this:<br>
SPRITE 0<br>
1. Vertical Position&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; =$0200<br>
2. Tile Number&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; =$0201<br>
3. Sprite Attribute&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; =$0202<br>
4. Horizontal Position&#xA0;&#xA0; =$0203<br>
<br>
After Sprite 0 loads, the sprite loading loop will continue on to the next sprite (if the loop is set for loading more sprite data). So this:<br>
<br>
&#xA0;&#xA0;&#xA0;&#xA0; ;vert tile attr horiz<br>
&#xA0; .db $80, $32, $00, $80&#xA0;&#xA0; ;sprite 0<br>
&#xA0; .db $80, $33, $00, $88&#xA0;&#xA0; ;sprite 1<br>
&#xA0; .db $88, $34, $00, $80&#xA0;&#xA0; ;sprite 2<br>
&#xA0; .db $88, $35, $00, $88&#xA0;&#xA0; ;sprite 3<br>
<br>
Will load like this:<br>
&#xA0;&#xA0;&#xA0; vert&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; tile&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; attr &#xA0;&#xA0; horiz<br>
&#xA0;$0200, $0201, $0202, $0203 &#xA0; ;sprite 0<br>
&#xA0;$0204, $0205, $0206, $0207 &#xA0; ;sprite 1<br>
&#xA0;$0208, $0209, $020A, $020B &#xA0; ;sprite 2<br>
&#xA0;$020C, $020D, $020E, $020F &#xA0; ;sprite 3<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__117">
                                                        <div class="mdl-card__title"><strong>Dreadmoc</strong> posted on 
		
			
				
				Apr 23, 2014 at 10:22:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Dread</b></i><br>
		<br>
		How do you know the location of each sprite. I gathered 203 from from reading the code, but I can&apos;t seem to find 207, 20b, or 20f anywhere.<br>
		<br>
		I wanted to do the &quot;homework&quot; on my own as best I could, but I had to read through the thread to figure out the location of the other three sprites. How would I locate them on my own?</div>
	<br>
	Sprite data starts at $0200 and the address is increased by 1 for each byte afterwards. Each sprite needs 4 bytes of data and is loadedin this order:<br>
	1. Vertical Position<br>
	2. Tile Number<br>
	3. Sprite Attribute<br>
	4. Horizontal Position<br>
	<br>
	If you look at the sprites section, you will see this.<br>
	<br>
	sprites:<br>
	&#xA0;&#xA0;&#xA0;&#xA0; ;vert tile attr horiz<br>
	&#xA0; .db $80, $32, $00, $80&#xA0;&#xA0; ;sprite 0<br>
	&#xA0; .db $80, $33, $00, $88&#xA0;&#xA0; ;sprite 1<br>
	&#xA0; .db $88, $34, $00, $80&#xA0;&#xA0; ;sprite 2<br>
	&#xA0; .db $88, $35, $00, $88&#xA0;&#xA0; ;sprite 3<br>
	<br>
	So, the first sprite would load like this:<br>
	SPRITE 0<br>
	1. Vertical Position&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; =$0200<br>
	2. Tile Number&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; =$0201<br>
	3. Sprite Attribute&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; =$0202<br>
	4. Horizontal Position&#xA0;&#xA0; =$0203<br>
	<br>
	After Sprite 0 loads, the sprite loading loop will continue on to the next sprite (if the loop is set load more sprite data). So this:<br>
	<br>
	&#xA0;&#xA0;&#xA0;&#xA0; ;vert tile attr horiz<br>
	&#xA0; .db $80, $32, $00, $80&#xA0;&#xA0; ;sprite 0<br>
	&#xA0; .db $80, $33, $00, $88&#xA0;&#xA0; ;sprite 1<br>
	&#xA0; .db $88, $34, $00, $80&#xA0;&#xA0; ;sprite 2<br>
	&#xA0; .db $88, $35, $00, $88&#xA0;&#xA0; ;sprite 3<br>
	<br>
	Will load like this:<br>
	&#xA0;&#xA0;&#xA0; vert&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; tile&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; attr &#xA0;&#xA0; horiz<br>
	&#xA0;$0200, $0201, $0202, $0203 &#xA0; ;sprite 0<br>
	&#xA0;$0204, $0205, $0206, $0207 &#xA0; ;sprite 1<br>
	&#xA0;$0208, $0209, $020A, $020B &#xA0; ;sprite 2<br>
	&#xA0;$020C, $020D, $020E, $020F &#xA0; ;sprite 3</div>
<br>
Awesome.<br>
<br>
That makes perfect sense to me. Thanks. I&apos;m gonna try to make all four sprites move today, but I&apos;m a liitle confused regarding x and y axis movement. I&apos;ll mess around and see what happens. What you just said really makes sense, and I&apos;m starting to understand the code too. I have a very long way to go and if your going to explain everything so well, I might have to bother you a lot over the next few days.<br>
<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__118">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 23, 2014 at 10:38:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					x and y should not be confused with the registers x and y.  In the sprite case, it refers to the vertical and horizontal movement.
<br>
<br>The &quot;vert&quot; byte is the number of pixels the top of the sprite is from the top of the screen.
<br>
<br>The &quot;horz&quot; byte is the number of pixels the left side of the sprite is from the left side of the screen.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__119">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 23, 2014 at 10:55:46 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Keep at it Dread, I&apos;m less than 2 months into programming and you can go a long way really fast. I was in the same boat you were just a few weeks ago, and now I have a functional game but it is no where close to done. 
<br>
<br>Many have helped me along the way. My advice, once you get through the Nerdy Nights and have a working program, go back and read it all again. It&apos;s amazing what you pick up the second, third, and fourth time through.
<br>
<br>Also, if you would like, I would can invite you to my private thread that sort of documents my journey of programming my first game. I also try to keep an up-to-date ROM posted in the first post of the private thread so you can see my bugs and play with the game mechanics.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__120">
                                                        <div class="mdl-card__title"><strong>Dreadmoc</strong> posted on 
		
			
				
				Apr 23, 2014 at 2:24:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	Keep at it Dread, I&apos;m less than 2 months into programming and you can go a long way really fast. I was in the same boat you were just a few weeks ago, and now I have a functional game but it is no where close to done.<br>
	<br>
	Many have helped me along the way. My advice, once you get through the Nerdy Nights and have a working program, go back and read it all again. It&apos;s amazing what you pick up the second, third, and fourth time through.<br>
	<br>
	Also, if you would like, I would can invite you to my private thread that sort of documents my journey of programming my first game. I also try to keep an up-to-date ROM posted in the first post of the private thread so you can see my bugs and play with the game mechanics.</div>
<br>
That would be awesome. I&apos;m having a lot of fun learning, so none of this is a chore. It&apos;s just good fun, challenging and worth every minute.<br>
<br>
MRN!!! Dude, thanks. so when I&apos;m coding movement for up and down, what changes do I need to make so the program knows it&apos;s working vertically. I have the left right movement set to the arrow keys and all other buttons have no function.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__121">
                                                        <div class="mdl-card__title"><strong>Dreadmoc</strong> posted on 
		
			
				
				Apr 23, 2014 at 2:47:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ah,
<br>
<br>0203 Is horizontal
<br>0200 is vertical?
<br>
<br>So LDA $0200 for up/down?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__122">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 23, 2014 at 3:20:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					up/down for sprite 0, yes. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__123">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 23, 2014 at 3:47:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here&apos;s a nice confusing tip:
<br>
<br>Adding is Down
<br>Subtrating is Up
<br>
<br>Why?
<br>Vertical line 00 starts at the top and the numbers increase as you work from the top to the bottom.
<br>00
<br>01
<br>02
<br>03
<br>04
<br>05
<br>etc
<br>etc
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__124">
                                                        <div class="mdl-card__title"><strong>Dreadmoc</strong> posted on 
		
			
				
				Apr 23, 2014 at 3:54:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br><br>up/down for sprite 0, yes. <span class="sprites_emoticons absmiddle" id="emo_smile"></span></div><br><br><br><br><br>So then just add all other positions for sprites 1,2,3?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__125">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 23, 2014 at 4:19:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Dread</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>KHAN Games</b></i><br>
		<br>
		up/down for sprite 0, yes.</div>
	<br>
	<br>
	<br>
	So then just add all other positions for sprites 1,2,3?</div>
<br>
Sounds to me that you are on the right path. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__126">
                                                        <div class="mdl-card__title"><strong>Dreadmoc</strong> posted on 
		
			
				
				Apr 23, 2014 at 11:03:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Okay, I got him moving good. Little Mario moves in all eight directions using the arrow keys.
<br>
<br>I forgot a dollar on 0208 for down and one his little legs fell off. I felt bad so I added it and it&apos;s working great. Kinda creepy to watch some of him move, like just his head flying off his body! 
<br>
<br>Thanks for the help guys.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__127">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 24, 2014 at 12:14:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Glad you got him working! Small victories are what keep you moving forward.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__128">
                                                        <div class="mdl-card__title"><strong>Baka94</strong> posted on 
		
			
				
				Sep 4, 2014 at 3:07:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I guess it&apos;s time to see if I understand how the controller reading works. Each time you read a controller the NES cycles through the buttons (since it only uses bit 0 for this) and I need to store each button state to separate memory slot where the game itself reads the buttons. Is this correct?
<br>
<br>BTW, do I need to write the 0 and 1 to the $4017 if I want to use controller 2 too, or does writing to $4016 set up both controllers?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__129">
                                                        <div class="mdl-card__title"><strong>Dredster</strong> posted on 
		
			
				
				Jan 3, 2015 at 10:31:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					How do the controller ports recognize different buttons for different functions ? I don&apos;t understand how the bit is set for on/off is set for all the buttons. It would seem that they have to be set to different adresses.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__130">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 4, 2015 at 12:10:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Baka94</b></i><br>
	<br>
	I guess it&apos;s time to see if I understand how the controller reading works. Each time you read a controller the NES cycles through the buttons (since it only uses bit 0 for this) and I need to store each button state to separate memory slot where the game itself reads the buttons. Is this correct?<br>
	<br>
	BTW, do I need to write the 0 and 1 to the $4017 if I want to use controller 2 too, or does writing to $4016 set up both controllers?</div>
<br>
If only one input each NMI is needed, and the priority order is: A, B, Se, St, DPad, then:<br>
<pre>ldx #$09
LOOP:
  dex
  beq DONE
  lda $4016
  and #$01
  beq LOOP
DONE:
  ...           ; if x ==... 8=A 7=B 6=Se 5=St 4=U 3=D 2=L 1=R 0=None</pre>
would (likely be faster and) work too I guess! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Just an alternative idea, I don&apos;t mean to teach anything.<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user<br>
<br>
<strong>Edit</strong>: changed 00000001 to #$01, it is the same thing, but probably better understandable this way.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__131">
                                                        <div class="mdl-card__title"><strong>Dredster</strong> posted on 
		
			
				
				Jan 9, 2015 at 10:06:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am at a loss; how do I get the sprite to move up and down I tried adding ReadUp: 
<br>  LDA $4016
<br>  AND #%00000001
<br>  BEQ ReadUpDone
<br>
<br>  LDA $0200
<br>  SEC
<br>  SBC #$01  
<br>  STA $0200
<br>ReadUpDone:
<br>
<br>
<br>ReadDown:
<br>  LDA $4016
<br>  AND #%00000001
<br>  BEQ ReadDownDone
<br>
<br>  LDA $0200
<br>  CLC       
<br>  ADC #$01   
<br>  STA $0200
<br>ReadDownDone:
<br>, but that does not work is there another directive I need to add or change. Could someone point me in the right direction or tell me ?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__132">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 9, 2015 at 10:22:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Dredster</b></i><br>
	<br>
	I am at a loss; how do I get the sprite to move up and down I tried adding ReadUp:<br>
	LDA $4016<br>
	AND #%00000001<br>
	BEQ ReadUpDone<br>
	<br>
	LDA $0200<br>
	SEC<br>
	SBC #$01<br>
	STA $0200<br>
	ReadUpDone:<br>
	<br>
	<br>
	ReadDown:<br>
	LDA $4016<br>
	AND #%00000001<br>
	BEQ ReadDownDone<br>
	<br>
	LDA $0200<br>
	CLC<br>
	ADC #$01<br>
	STA $0200<br>
	ReadDownDone:<br>
	, but that does not work is there another directive I need to add or change. Could someone point me in the right direction or tell me ?</div>
<br>
1. Did you put this before?<br>
<pre><span>  LDA #$01</span>
<span>  STA $4016</span>
<span>  LDA #$00</span>
<span>  STA $4016     ; tell both the controllers to latch buttons</span><br><br>2. Try pushing A and B buttons. <span class="sprites_emoticons absmiddle" id="emo_wink"></span>
</pre>
<p>
	I hope this helps. <span class="sprites_emoticons absmiddle" id="emo_smile"></span></p>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__133">
                                                        <div class="mdl-card__title"><strong>Dredster</strong> posted on 
		
			
				
				Jan 9, 2015 at 10:39:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, I just added the code that I thought would move the sprite up and down based on what someone else posted. Everything is in place as normal. I push the A and B buttons but they just move it left to right. I&apos;m trying to figure out how to get the sprite to move up and down using the up and down buttons. I assumed the $0200 was to set for the Y movements and $203 was for the X coordinates. I am also not getting how to move multiple sprites. I tried setting it to the 8x16 byte in $2000, but the sprite is scrabbled and the sprite is still in the same position as before.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__134">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 9, 2015 at 10:58:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Dredster</b></i><br>
	<br>
	Yeah, I just added the code that I thought would move the sprite up and down based on what someone else posted. Everything is in place as normal. I push the A and B buttons but they just move it left to right.<strong> I&apos;m trying to figure out how to get the sprite to move up and down using the up and down buttons</strong>. I assumed the $0200 was to set for the Y movements and $203 was for the X coordinates. I am also not getting how to move multiple sprites. I tried setting it to the 8x16 byte in $2000, but the sprite is scrabbled and the sprite is still in the same position as before.</div>
<br>
Sequence:<br>
<br>
LDA $4016<br>
AND #%00000001 ; A button<br>
<br>
LDA $4016<br>
AND #%00000001 ; B button<br>
<br>
LDA $4016<br>
AND #%00000001 ; Select<br>
<br>
LDA $4016<br>
AND #%00000001 ; Start<br>
<br>
5th and 6th time you do so...<br>
<br>
LDA $4016<br>
AND #%00000001 ; Up<br>
<br>
LDA $4016<br>
AND #%00000001 ; Down<br>
<br>
7th and 8th time you do so...<br>
<br>
LDA $4016<br>
AND #%00000001 ; Left<br>
<br>
LDA $4016<br>
AND #%00000001 ; Right<br>
<br>
But you obviously use a loop to make things more rational to read, and save space in the ROM. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Hope this helps! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<strong>Edit</strong>: I messed up U/D/L/R
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__135">
                                                        <div class="mdl-card__title"><strong>Dredster</strong> posted on 
		
			
				
				Jan 10, 2015 at 2:13:38 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I see that it&apos;s latched by 
<br>LatchController:
<br>  LDA #$01
<br>  STA $4016
<br>  LDA #$00
<br>  STA $4016       
<br>Which is the same as writing it out like that. I understand how it cycles through the buttons.  I just want to be able to make the sprite go up and down. It only goes left and right using B. BunnyBoy says to try to figure out how to move multiple sprites,figure out how to make the sprites move up and down and go left and right using the D-Pad buttons. I am not able to figure out how to do those things.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__136">
                                                        <div class="mdl-card__title"><strong>MadnessVX</strong> posted on 
		
			
				
				Jan 10, 2015 at 4:25:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					After the latch, you want your controller reading code to do something when it sees that a button is pushed. Each time you read $4016, it will be for a different button as User stated above. So if you want to read that up or down was pressed, you must have a total of 8 reads. (Technically 5 or 6, but its best to read the whole controller! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>) You cannot simply have two reads from $4016, and call them up and down.<br>
<br>
Some pseudoish-code:<br>
<br>
Latch_Controller:&#xA0; ;Controller gets latched here<br>
&#xA0; lda #$01<br>
&#xA0; sta $4016<br>
&#xA0; lda #$00<br>
&#xA0; sta $4016<br>
<br>
Read_Control:&#xA0; ;Here is where we actually read the controller<br>
<br>
&#xA0; lda $4016&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;First read from 4016. This is the A button.<br>
&#xA0; and #%00000001<br>
&#xA0; cmp $%01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;compare the value you just loaded into the accumulator with #%00000001. (Same as #$01)<br>
&#xA0; bne .not a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if they are not equal, skip the code for A<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;---------------&#xA0; ;Code for the A button will go here<br>
.not a:<br>
&#xA0; Read the controller again to see if B was pressed<br>
&#xA0; More code<br>
<br>
.not b:<br>
&#xA0; More code<br>
&#xA0; etc...<br>
<br>
You keep making reads until you have read them all. (8 times) You want to put your increments or decrements where the up or down reads are.<br>
<br>
&#xA0;I hope this makes sense. For you veterans if I have said anything wrong, please publicly humiliate me! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__137">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jan 10, 2015 at 10:22:01 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That&apos;s basically what I was going to ask... if he had all the routine going through all 8 button latches.  Hard to tell with only a small code snippet. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__138">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 10, 2015 at 11:59:01 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Dredster</b></i><br>
	<br>
	I see that it&apos;s latched by<br>
	LatchController:<br>
	LDA #$01<br>
	STA $4016<br>
	LDA #$00<br>
	STA $4016<br>
	Which is the same as writing it out like that. I understand how it cycles through the buttons. I just want to be able to make the sprite go up and down. It only goes left and right using B. BunnyBoy says to try to figure out how to move multiple sprites,figure out how to make the sprites move up and down and go left and right using the D-Pad buttons. I am not able to figure out how to do those things.</div>
<em><span><b>Controller Ports</b></span></em><br>
<p>
	<em><span>The controllers are accessed through memory port addresses $4016 and $4017.&#xA0; First you have to write the value $01 then the value $00 to port $4016.&#xA0; This tells the controllers to latch the current button positions.&#xA0; Then you read from $4016 for first player or $4017 for second player.&#xA0; <strong>The buttons are sent&#xA0; one at a time, in bit 0.&#xA0; If bit 0 is 0, the button is not pressed.&#xA0; If bit 0 is 1, the button is pressed.</strong></span></em></p>
<p>
	<strong><em><span>Button status for each controller is returned in the following order: A, B, Select, Start, Up, Down, Left, Right.</span></em></strong></p>
<p>
	<span>&#xA0; LDA #$01<br>
	&#xA0; STA $4016</span><br>
	<span>&#xA0; LDA #$00</span><br>
	<span>&#xA0; STA $4016 &#xA0; &#xA0; ; tell both the controllers to latch buttons</span></p>
<p>
	<span>&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - A<br>
	&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - B<br>
	&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - Select<br>
	&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - Start<br>
	&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - Up<br>
	&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - Down<br>
	&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - Left<br>
	&#xA0; LDA $4016 &#xA0; &#xA0; ; player 1 - Right</span></p>
<em><span><b>AND Instruction</b></span></em>
<p>
	<em><span><strong>Button information is only sent in bit 0, so we want to erase all the other bits.</strong>&#xA0; This can be done with the AND instruction.&#xA0; Each of the 8 bits is ANDed with the bits from another value.&#xA0; If the bit from both the first AND second value is 1, then the result is 1.&#xA0; Otherwise the result is 0.</span></em><br>
	<br>
	<br>
	If all this BunnyBoy wrote is undestood, try looking at the following (really bad, good-coding wise) example, hoping that you can find out what your code is missing. Think this way if this helps: when you ask about inputs, you get always <strong>_8_</strong> answers, yes or no (1 or 0), one for each possible input (A,B,Sel,Start,U,D,L,R), which are in bit 0 of a read to $4016, forcefully in that specific order.</p>
<pre><span>  LDA #$01
  STA $4016</span>
<span>  LDA #$00</span>
<span>  STA $4016     ; tell both the controllers to latch buttons<br><br><span>  LDA $4016     ; player 1 - A, you don&apos;t care about the answer
  LDA $4016     ; player 1 - B, you don&apos;t care<span><span> about the answer</span></span>
  LDA $4016     ; player 1 - Select, you don&apos;t care<span><span> about the answer</span></span>
  LDA $4016     ; player 1 - Start, you don&apos;t care<span><span> about the answer</span></span><br><br>  LDA $4016     ; player 1 - Up, NOW you DO care<span><span> about the answer
</span></span>  AND #%00000001 ; you want to keep only bit0
  BEQ SKIPUP    ; Up was NOT pressed, so skip the next instructions<br><br>  LDA $0200     ; sprite y position
  SEC           ; set carry
  SBC #$01      ; subtract 1
<span><span><span><span>  STA <span><span><span><span>$0200     ; sprite <span><span><span><span><span><span><span><span>NEW </span></span></span></span></span></span></span></span>y position</span></span></span></span></span></span></span></span>
  JMP SKIPDOWN  ; it is either Up or Down, so if Up is pressed you skip the next check<br><br>SKIPUP:
  <span><span>LDA $4016     ; player 1 - Down, NOW you DO care</span></span><span><span> about the answer
<span><span><span><span>  AND #%00000001 ; you want to keep only bit0
</span></span>  BEQ SKIPDOWN  ; Down was NOT pressed, so skip the next instructions
</span></span>
</span></span><span><span>  LDA $0200     ; sprite y position
  CLC           ; clear carry
  ADC #$01      ; add 1
  STA <span><span><span><span>$0200     ; sprite <span><span><span><span><span><span><span><span>NEW </span></span></span></span></span></span></span></span>y position<br><br></span></span></span></span>SKIPDOWN:
; ...           ; the program continues here
</span></span></span></span>
</pre>
It is ugly coding wise, but it works. <span class="sprites_emoticons absmiddle" id="emo_wink"></span><br>
<br>
Check the attachments (rename controller.txt to .asm).<br>
<br>
I hope this helps! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__139">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jan 10, 2015 at 1:04:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you read $4016 directly from the controller, you&apos;re doing it 100% wrong. Please don&apos;t advocate doing it that way. I&apos;m not going to argue with people again (Main reason I left for so long) how it&apos;s okay to do it how they want. It&apos;s not, it&apos;s the shittiest code you could ever write. Put it into variables, add button press variables, and stop doing it 10000% wrong.<br>
<br>
Set 3 variables in RAM: ControllerData, ControllerDataOld (For figuring button presses), and then set ControllerOutput to $4016. Jump to this routine, then do a LDA-BIT/LDA-AND combo to test. 100% less crappy.<br>
<br>
<div>
	<div>
		ReadController:</div>
	<div>
		&#xA0; LDA ControllerData</div>
	<div>
		&#xA0; STA ControllerDataOld ;Store old key presses.</div>
	<div>
		&#xA0; LDY #$01</div>
	<div>
		&#xA0; STY ControllerOutput ;Set to $4016</div>
	<div>
		&#xA0; STY ControllerData</div>
	<div>
		&#xA0; DEY</div>
	<div>
		&#xA0; STY ControllerOutput</div>
	<div>
		.ReadControllers</div>
	<div>
		&#xA0; LDA $4016</div>
	<div>
		&#xA0; LSR A</div>
	<div>
		&#xA0; ROL ControllerData</div>
	<div>
		&#xA0; BCC .ReadControllers</div>
	<div>
		&#xA0; LDA ControllerDataOld</div>
	<div>
		&#xA0; EOR #$FF ;Reverse keys not pressed last time.</div>
	<div>
		&#xA0; AND ControllerData ;Test with new keys.</div>
	<div>
		&#xA0; STA ControllerDataNewlyPressed ;Store buttons that were just pressed.</div>
	<div>
		&#xA0; RTS</div>
	<div>
		&#xA0;</div>
</div>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__140">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jan 10, 2015 at 1:20:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The way 3Gen is describing is definitely the better way of doing it (and way less code), but the way user described it also works fine for getting started and learning how things work.  Bunnyboy switches to the better method in a later Nerdy Nights tutorial.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__141">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 10, 2015 at 2:03:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Original post deleted by the author.<br>
<br>
The post of <em>bunnyboy </em>here below expresses the same concept more technically and in a more correct English.<br>
<br>
- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__142">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 10, 2015 at 3:57:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>3GenGames</b></i><br>
<br>
If you read $4016 directly from the controller, you&apos;re doing it 100% wrong. Please don&apos;t advocate doing it that way. I&apos;m not going to argue with people again (Main reason I left for so long) how it&apos;s okay to do it how they want. It&apos;s not, it&apos;s the shittiest code you could ever write. Put it into variables, add button press variables, and stop doing it 10000% wrong.</div>
Your example is more correct (start a new thread if you want it ripped apart) for a final product, but far more complicated for an <strong>intro</strong> lesson. &#xA0;Now you need to first explain jsr/rts, variables vs constants vs addresses, naming conventions, shifting, and bcc. &#xA0;How are those tutorials you were writing going? &#xA0;<span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__143">
                                                        <div class="mdl-card__title"><strong>Cockroachcharlie</strong> posted on 
		
			
				
				Sep 9, 2015 at 5:07:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>3GenGames</b></i><br>
<br>
If you read $4016 directly from the controller, you&apos;re doing it 100% wrong. Please don&apos;t advocate doing it that way. I&apos;m not going to argue with people again (Main reason I left for so long) how it&apos;s okay to do it how they want. It&apos;s not, it&apos;s the shittiest code you could ever write. Put it into variables, add button press variables, and stop doing it 10000% wrong.</div>
Your example is more correct (start a new thread if you want it ripped apart) for a final product, but far more complicated for an <strong>intro</strong> lesson. &#xA0;Now you need to first explain jsr/rts, variables vs constants vs addresses, <u><em><strong>naming conventions, shifting</strong></em></u>, and bcc. &#xA0;How are those tutorials you were writing going? &#xA0;</div>
<br>
WAAAH!&#xA0; I actually understood what you were talking about until you mentioned those parts I underlined in the quote!&#xA0; I was soooo close!&#xA0; [retreats to corner to sulk].<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__144">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Sep 9, 2015 at 6:46:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Cockroachcharlie</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>3GenGames</b></i><br>
<br>
If you read $4016 directly from the controller, you&apos;re doing it 100% wrong. Please don&apos;t advocate doing it that way. I&apos;m not going to argue with people again (Main reason I left for so long) how it&apos;s okay to do it how they want. It&apos;s not, it&apos;s the shittiest code you could ever write. Put it into variables, add button press variables, and stop doing it 10000% wrong.</div>
Your example is more correct (start a new thread if you want it ripped apart) for a final product, but far more complicated for an <strong>intro</strong> lesson. &#xA0;Now you need to first explain jsr/rts, variables vs constants vs addresses, <u><em><strong>naming conventions, shifting</strong></em></u>, and bcc. &#xA0;How are those tutorials you were writing going? &#xA0;</div>
<br>
WAAAH!&#xA0; I actually understood what you were talking about until you mentioned those parts I underlined in the quote!&#xA0; I was soooo close!&#xA0; [retreats to corner to sulk].<br>
&#xA0;</div>
It&apos;s not too bad. You&apos;ll be fine. These tutorials are fantastic and guide you through perfectly.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__145">
                                                        <div class="mdl-card__title"><strong>Cockroachcharlie</strong> posted on 
		
			
				
				Sep 9, 2015 at 9:14:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>Cockroachcharlie</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>3GenGames</b></i><br>
<br>
If you read $4016 directly from the controller, you&apos;re doing it 100% wrong. Please don&apos;t advocate doing it that way. I&apos;m not going to argue with people again (Main reason I left for so long) how it&apos;s okay to do it how they want. It&apos;s not, it&apos;s the shittiest code you could ever write. Put it into variables, add button press variables, and stop doing it 10000% wrong.</div>
Your example is more correct (start a new thread if you want it ripped apart) for a final product, but far more complicated for an <strong>intro</strong> lesson. &#xA0;Now you need to first explain jsr/rts, variables vs constants vs addresses, <u><em><strong>naming conventions, shifting</strong></em></u>, and bcc. &#xA0;How are those tutorials you were writing going? &#xA0;</div>
<br>
WAAAH!&#xA0; I actually understood what you were talking about until you mentioned those parts I underlined in the quote!&#xA0; I was soooo close!&#xA0; [retreats to corner to sulk].<br>
&#xA0;</div>
It&apos;s not too bad. You&apos;ll be fine. These tutorials are fantastic and guide you through perfectly.<br>
<br>
&#xA0;</div>
Actually, the part that made me laugh is that, unless I&apos;m mistaken, he hasn&apos;t mentioned subroutines yet in the tutorial, yet I have a pretty firm grounding on those.&#xA0; Likewise with variables, constants, addresses...and so on.&#xA0; I was so pleased that I understood things he hadn&apos;t even discussed yet, until I got to the underlined point.&#xA0; :-)<br>
<br>
Either way, yeah, these tutorials are a huge help in understanding the differences needed between simply writing in 6502 and writing in 6502 FOR THE NES.&#xA0; My son and I are working on a game right now and taking the step-by-step approach (step 1; learn 6502, step 2; make our character appear on the screen, step 3; make our character move in some way etc...).&#xA0; So getting my 15 sprite character to pop up and shift left and right was quite exciting for us.&#xA0; Still not quite understanding WHY the code caused it to happen, so we are sticking to the design phase while I work on wrapping my head around it, but these tutorials are being an exciting adventure for us.&#xA0; :-)<br>
<br>
edit:&#xA0; Come to think of it, would it be advisable (and speaking way into the future) to put the movement controls into a subroutine for multi-level games (ala Contra, Super Mario Bros., etc...)?&#xA0; Or can they be left in the main code block?<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__146">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Sep 9, 2015 at 11:19:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Cockroachcharlie</b></i><br>
<br>
Actually, the part that made me laugh is that, unless I&apos;m mistaken, he hasn&apos;t mentioned subroutines yet in the tutorial, yet I have a pretty firm grounding on those.&#xA0; Likewise with variables, constants, addresses...and so on.&#xA0; I was so pleased that I understood things he hadn&apos;t even discussed yet, until I got to the underlined point.&#xA0; :-)<br>
<br>
Either way, yeah, these tutorials are a huge help in understanding the differences needed between simply writing in 6502 and writing in 6502 FOR THE NES.&#xA0; My son and I are working on a game right now and taking the step-by-step approach (step 1; learn 6502, step 2; make our character appear on the screen, step 3; make our character move in some way etc...).&#xA0; So getting my 15 sprite character to pop up and shift left and right was quite exciting for us.&#xA0; Still not quite understanding WHY the code caused it to happen, so we are sticking to the design phase while I work on wrapping my head around it, but these tutorials are being an exciting adventure for us.&#xA0; :-)<br>
<br>
edit:&#xA0; <strong>Come to think of it, would it be advisable (and speaking way into the future) to put the movement controls into a subroutine for multi-level games (ala Contra, Super Mario Bros., etc...)?</strong>&#xA0; Or can they be left in the main code block?<br>
&#xA0;</div>
<br>
This is the perfect way to do it. <span class="sprites_emoticons absmiddle" id="emo_wink"></span><br>
<br>
I really don&apos;t&#xA0; have a lot in my main code in the few games I have written. Pretty much, all my main code block does is call subroutines.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__147">
                                                        <div class="mdl-card__title"><strong>SomeGuy#27</strong> posted on 
		
			
				
				Feb 7, 2016 at 11:34:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey, I found this a few months ago when I renewed my previously misguided efforts to learn 6502 a few years ago. It&apos;s a good tutorial so far, and thanks for making it!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__148">
                                                        <div class="mdl-card__title"><strong>SomeGuy#27</strong> posted on 
		
			
				
				Mar 3, 2016 at 2:03:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Quick question, is it possible to use comparators with the X and Y registers? Meaning
<br>
<br>CMP Y
<br>
<br>Or something of that like.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__149">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Mar 3, 2016 at 5:13:20 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SomeGuy#27</b></i><br>
<br>
Quick question, is it possible to use comparators with the X and Y registers? Meaning<br>
<br>
CMP Y<br>
<br>
Or something of that like.</div>
<br>
I simply store the Y or X reg in a temporary variable and compare things to that temp variable, something like<br>
<br>
&#xA0; STY maintemp<br>
&#xA0; CMP maintemp
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__150">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Mar 3, 2016 at 7:55:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Another way of doing that is to make a 256-byte lookup table containing values 0..255, then you can do &quot;CMP lut,Y&quot; to compare A to Y. The same lookup table can be reused for various other things also.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__151">
                                                        <div class="mdl-card__title"><strong>SomeGuy#27</strong> posted on 
		
			
				
				Mar 3, 2016 at 10:10:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Okay, that shouldn&apos;t even add too much to my code, Vectrex! Thanks! The lookup table might be used if I need one for something else, but thanks anyways.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__152">
                                                        <div class="mdl-card__title"><strong>Piputkin3</strong> posted on 
		
			
				
				Apr 26, 2017 at 11:02:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have a problem because when using BEQ, if the button is not pressed then this code is executed below<br>
<br>
ButtonA:<br>
LDA $4016<br>
AND #%00000001<br>
BEQ ButtonB<br>
LDA $0210<br>
CLC<br>
ADC #$01<br>
STA $0210<br>
;Works regardless of the status of the button<br>
ButtonB
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__153">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 26, 2017 at 11:10:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Piputkin3</b></i><br>
<br>
I have a problem because when using BEQ, if the button is not pressed then this code is executed below<br>
<br>
ButtonA:<br>
LDA $4016<br>
AND #%00000001<br>
BEQ ButtonB<br>
LDA $0210<br>
CLC<br>
ADC #$01<br>
STA $0210<br>
;Works regardless of the status of the button<br>
ButtonB</div>
Last line needs a colon.<br>
<br>
ButtonB:<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__154">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 26, 2017 at 11:21:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>Piputkin3</b></i><br>
<br>
I have a problem because when using BEQ, if the button is not pressed then this code is executed below<br>
<br>
ButtonA:<br>
LDA $4016<br>
AND #%00000001<br>
BEQ ButtonB<br>
LDA $0210<br>
CLC<br>
ADC #$01<br>
STA $0210<br>
;Works regardless of the status of the button<br>
ButtonB</div>
Last line needs a colon.<br>
<br>
ButtonB:<br>
<br>
&#xA0;</div>
<br>
<br>
Can you post your enitre Read Controller code for all buttons? I don&apos;t think this is giving me enough information.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__155">
                                                        <div class="mdl-card__title"><strong>Piputkin3</strong> posted on 
		
			
				
				Apr 26, 2017 at 11:28:54 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here:
<br>ButtonA:
<br>  LDA $4016
<br>  AND #%00000001
<br>  BEQ ButtonB
<br>  LDA $0210
<br>  CLC
<br>  ADC #$01
<br>  STA $0210
<br>ButtonB:
<br>  LDA $4016
<br>  AND #%00000001
<br>  BNE SelectButton
<br>  
<br>SelectButton:
<br>  LDA $4016
<br>  AND #%00000001
<br>  BNE StartButton
<br> 
<br>StartButton:
<br>  LDA $4016
<br>  AND #%00000001
<br>  BNE UpButton
<br> 
<br>UpButton:
<br>  LDA $4016
<br>  AND #%00000001
<br>  BNE DownButton
<br>  LDA $0200
<br>  CMP #$DF
<br>  BEQ DownButton
<br>  LDA $0200
<br>  CLC
<br>  ADC #$01
<br>  STA $0200
<br> 
<br>DownButton:
<br>  LDA $4016
<br>  AND #%00000001
<br>  BNE LeftButton
<br>  LDA $0200
<br>  CMP #$00
<br>  BEQ LeftButton
<br>  LDA $0200
<br>  SEC
<br>  SBC #$01
<br>  STA $0200
<br> 
<br>LeftButton:
<br>  LDA $4016
<br>  AND #%00000001
<br>  BNE RightButton
<br>  LDA $0203
<br>  CMP #$F0
<br>  BEQ RightButton
<br>  LDA $0203
<br>  CLC
<br>  ADC #$01
<br>  STA $0203
<br>
<br> 
<br>RightButton:
<br>  LDA $4016
<br>  AND #%00000001
<br>  BNE NotRightButton
<br>  LDA $0203
<br>  CMP #$00
<br>  BEQ NotRightButton
<br>  LDA $0203
<br>  SEC
<br>  SBC #$01
<br>  STA $0203
<br> 
<br>NotRightButton:
<br>  JMP Here
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__156">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 26, 2017 at 12:08:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Do you have this before ButtonA: 
<br>
<br>LatchController:
<br>  LDA #$01
<br>  STA $4016
<br>  LDA #$00
<br>  STA $4016       ; tell both the controllers to latch buttons
<br>
<br>All of those BNEs need to be BEQs on buttons B, Select, Start, Up, Down, Left, Right. Button A looks correct.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__157">
                                                        <div class="mdl-card__title"><strong>Piputkin3</strong> posted on 
		
			
				
				Apr 26, 2017 at 12:23:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I had a latch controller.
<br>But I did&apos;t know that everywhere had to be BEQ. Thank you very much for your help.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__158">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 26, 2017 at 12:40:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Piputkin3</b></i><br>
<br>
I had a latch controller.<br>
But I did&apos;t know that everywhere had to be BEQ. Thank you very much for your help.</div>
Yup.<br>
<br>
We only care about Bit 0 of $4016. Every time you read $4016 (LDA $4016), it automatically jumps to the next button. If that button is pressed, $4016 will be equal to %00000001. If the button is not pressed, it will be equal to %00000000. This is why we do the AND %00000001. We only check if the Bit 0 is equal to 1.<br>
<br>
So, if the button is pressed, this it what will happen:<br>
LDA $4016&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;$4016=%00000001 because the button is pressed.<br>
AND #%00000001&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; ANDing $4016 and %00000001 = %00000001<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;whenever there is no CMP before a Branch, then CPU sees it as CMP #$00 (compare to #$00 or #%00000000)<br>
BEQ NextButton&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Jump to Next Button if Equal to %00000000. In this case, it is not equal because our value is #%00000000, so we continue to the Run Code.<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Run Code<br>
NextButton:<br>
<br>
To move on the next button, we simply just read LDA $4016 again. Do this until you have read all 8 buttons on the controller.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__159">
                                                        <div class="mdl-card__title"><strong>think1st</strong> posted on 
		
			
				
				Dec 29, 2017 at 1:49:24 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi, first post here. 
<br>
<br>Can you store things in CPU ram using .org and .db directives? Like placing the sprite data directly in ram.
<br>
<br>.org $0200
<br>.db #128,#0,#0,#128
<br>.db #128,#1,#0,#136 
<br>
<br>etc.?
<br>
<br>On that note, I notice I&apos;m a bit confused how the assemblers decides where to put stuff in memory when you use .org. Is the address you hand to .org relative to the current .bank you&apos;re working on? Otherwise, the way mario.chr is included looks like you&apos;re writing the first 8 KB of CPU memory, including mirrored sections of RAM (since the code does .org $0000 followed by include). On the other hand, the entire previous code section looks as if its absolutely addressing all of the 64kb memory space the CPU has, even though the PRG ROM is only 16kb if you specify .inesprg 1. If I understand correctly, .bank 1 should be the second 8kb memory block from PRG ROM so for example all code I would expect to be .org-ed to $2000  instead of $C000 like it is at the top of the file.
<br>
<br>Also, how does the assembler know that .bank 2 belongs to PPU memory? I guess NESDEV just knows that you&apos;re targeting NES, but how do you handle stuff like that with a more generic assembler like ca65 or asm6?
<br>
<br>Hope I&apos;m not dumping too many questions.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__160">
                                                        <div class="mdl-card__title"><strong>think1st</strong> posted on 
		
			
				
				Dec 29, 2017 at 3:58:16 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I found the answer. Seems the INES file format only contains ROM data, so the answer to my first question would be a simple NO. And after some experimentation with some other assemblers I figured that out, too. The assemblers don&apos;t care what goes to the PPU and what not, they just output the raw data as you define it using .org statements. Then, when the assembled .nes file is 16 bytes (header) + 16kb (1x prg rom) + 8kb (1x chr rom), the emulator is actually responsible for realizing that the first 16kb after header is for prg rom and the 8kb after is for chr rom.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__161">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Dec 29, 2017 at 8:28:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>think1st</b></i><br>
<br>
I found the answer. Seems the INES file format only contains ROM data, so the answer to my first question would be a simple NO. And after some experimentation with some other assemblers I figured that out, too. The assemblers don&apos;t care what goes to the PPU and what not, they just output the raw data as you define it using .org statements. Then, when the assembled .nes file is 16 bytes (header) + 16kb (1x prg rom) + 8kb (1x chr rom), the emulator is actually responsible for realizing that the first 16kb after header is for prg rom and the 8kb after is for chr rom.</div>
I know you found the answers, but I just wanted to assure you.<br>
<br>
No, .db cannot be used in RAM. You can only use .db to build tables in ROM.<br>
<br>
The address you associate with the .org directive is relative to the bank you are in. That&apos;s how bank switching works. Small example from my code. Whatever bankSource I am current using, the CPU will use the proper code from that address. This is all PRG Data as I program in UNROM, so I don&apos;t use CHRROM. I have 15 banks that look like this below that can swap out $8000-$BFFF and 1 fixed bank that never swaps out in addresses $C000-$FFFF. Essentially, the concept is the same with CHR Data as well, that&apos;s why the Mario.chr is in $0000 at that the start of CHRROM. This confused me for the longest time as well. Just remember, you have PRGROM and CHRROM in NROM, so you have 2 sets of addresses to deal with.<br>
<br>
;----------------------------------------------------------<br>
;-----------------------BANKS------------------------------<br>
;----------------------------------------------------------<br>
;;;;;;;;;;;;;;;;;bankSource=00;;;;;;;;;;;;;;;;;;;;<br>
&#xA0; .bank 0&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; .org $8000 &#xA0;<br>
&#xA0; .include &quot;maincode2.asm&quot;<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0; .bank 1<br>
&#xA0; .org $A000<br>
&#xA0; .include &quot;maincode3.asm&quot;&#xA0;&#xA0;&#xA0; &#xA0;<br>
<br>
;;;;;;;;;;;;;;;;;bankSource=01;;;;;;;;;;;;;;;;;;;;<br>
&#xA0; .bank 2&#xA0;&#xA0; &#xA0;<br>
&#xA0; .org $8000<br>
&#xA0;&#xA0;&#xA0; .include &quot;SpriteData.asm&quot;<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0; .bank 3<br>
&#xA0; .org $A000<br>
&#xA0;<br>
;;;;;;;;;;;;;;;;;bankSource=02;;;;;;;;;;;;;;;;;;;; &#xA0;<br>
&#xA0; .bank 4&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; .org $8000<br>
TitleGraphics: &#xA0;<br>
&#xA0; .incbin &quot;CHRfiles\titlesprites.chr&quot;<br>
&#xA0; .incbin &quot;CHRfiles\titlegraphics.chr&quot;<br>
&#xA0;<br>
&#xA0; .bank 5<br>
&#xA0; .org $A000<br>
RoomGraphics:<br>
&#xA0; .incbin &quot;CHRfiles\MainCharacterSprites.chr&quot;<br>
&#xA0; .incbin &quot;CHRfiles\RoomGraphics.chr&quot;<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-5__162">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Dec 29, 2017 at 8:52:32 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;d add that, basically the way an assembler works under the hood is it has a variable called the &quot;program counter.&quot; This is not the same thing as the pc or program counter in the cpu while running your game---this concept I&apos;m about to describe is only for the assembler.<br>
<br>
It basically starts at 0, but if you say .org $8000, that will effectively set the assembler&apos;s program counter to that value. Then, if you do some .db&apos;s<br>
<br>
.org $8000<br>
some_data:<br>
.db 1, 2, 3<br>
<br>
more_data:<br>
.db 1, 2, 3<br>
<br>
Each byte output to your rom will increment the program counter by 1. When the assembler sees &quot;more_data&quot;, the program counter will now be $8003. So if you use the address &quot;more_data&quot; somewhere in your code, it&apos;ll know to use the address $8003.<br>
<br>
The program counter does the same thing in ram, only you are not outputting any data, you&apos;re just reserving space. So you go:<br>
<br>
.org $0000 ;or it might actually be .rsset in nesasm. every assembler has small differences with these commands. but it&apos;s still going to affect the program counter as the assembler creates your rom file. In the case of variables, nothing gets output, it&apos;s just counting using how many bytes you&apos;re reserving, so when you use &quot;variable1&quot; or &quot;variable2&quot; etc. in your code, it knows the right address to use.<br>
variable1:<br>
.ds 1<br>
<br>
;program counter is now at $0001<br>
variable2:<br>
.ds 2<br>
<br>
;program counter is now at $0003<br>
variable3:<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>


                <div class="spacer"></div>

                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="main_tutorial-6">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">6: 背景</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=7974" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=7974">Previous Week</a> - Multiple sprites, reading controllers<div><br></div><div><span class="Apple-style-span" style="font-weight: bold; ">This Week: &#xA0;</span>Now that you have a basic understanding of the NES tile graphics, we learn how to display one static non scrolling background. &#xA0;</div><div><span class="Apple-style-span" style="font-size: x-large; "><br></span></div><div><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: x-large; ">Backgrounds</span></span></div><div><span class="Apple-style-span" style="font-size: small; ">There are three components used to generate backgrounds on the NES. &#xA0;First is the background color palette, used to select the colors that will be used on screen. &#xA0;Next is the nametable that tells the layout of the graphics. &#xA0;Finally is the attribute table that assigns the colors in the palette to areas on screen.</span></div><div><span class="Apple-style-span" style="font-size: 18px; font-weight: bold; "><br></span></div><div><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: medium; ">Background Palette</span></span></div><div><span class="Apple-style-span" style="font-size: small; ">Like the sprites there are 16 colors in the <span class="Apple-style-span" style="font-weight: bold; ">background palette</span>. &#xA0;Our previous apps were already loading a background palette but it was not being used yet. &#xA0;You can use the PPU Viewer in FCEUXD SP to see the color palettes. &#xA0;</span></div><div><span class="Apple-style-span" style="font-size: 16px; font-weight: bold; "><br></span></div><div><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: medium; ">Nametables</span></span></div><div><span class="Apple-style-span" style="font-size: small; ">L</span><span class="Apple-style-span" style="font-size: small; ">ike the sprites, background images are made up from 8x8 pixel tiles. &#xA0;The screen video resolution is 32x30 tiles, or 256x240 pixels. &#xA0;PAL systems will show this full resolution but NTSC crops the top 8 and bottom 8 rows of pixels for a final resolution of 256x224. &#xA0;Additionally TV&apos;s on either system can crop another few rows on the top or bottom.</span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: small; ">One screen full of background tiles is called a <span class="Apple-style-span" style="font-weight: bold; ">nametable</span>, and the NES has enough internal RAM connected to the PPU for two nametables. &#xA0;Only one will be used here. &#xA0;The nametable has one byte (0-255) for which 8x8 pixel graphics tile to draw on screen. &#xA0;The nametable we will use starts at PPU address $2000 and takes up 960 bytes (32x30). &#xA0;You can use the Nametable viewer in FCEUXD SP to see all the nametables. &#xA0;</span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: medium; ">Attribute Tables</span></span></div><div><span class="Apple-style-span" style="font-size: small; ">The attribute tables may be the most difficult thing to understand, and sets many of the graphics limitations. &#xA0;Each nametable has an <span class="Apple-style-span" style="font-weight: bold; ">attribute table</span> that sets which colors in the palette will be used in sections of the screen. &#xA0;The attribute table is stored in the same internal RAM as the nametable, and we will use the one that starts at PPU address $23C0 ($2000+960). &#xA0;</span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; ">First the screen is divided into a 32x32 pixel grid, or 4x4 tiles. &#xA0;Each byte in the attribute table sets the color group&#xA0;(0-3)&#xA0;in the background palette that will be used in that area. &#xA0;That 4x4 tile area is divided again into 4 2x2 tile grids. &#xA0;Two bits of the attribute table byte are assigned to each 2x2 area. &#xA0;That is the size of one block in SMB. &#xA0;This limitation means that only 4 colors (one color group) can be used in any 16x16 pixel background section. &#xA0;A green SMB pipe section cannot use the color red because it already uses 4 colors.</span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div align="baseline"><span class="Apple-style-span" style="font-size: 13px; ">When looking at a sample SMB screen, first the 4x4 tile grid is added and the palette is shown at the bottom:</span></div><div><span class="Apple-style-span" style="font-size: 13px; "><img src original-src="http://www.NintendoAgeMedia.com/users/142/photobucket/F837623F-9C98-E50B-F4D377EE82FA2BDA.png" show-src="scraper/images/F837623F-9C98-E50B-F4D377EE82FA2BDA.png"></span></div><div><span class="Apple-style-span" style="font-size: 16px; font-weight: bold; "><br></span></div><div><span class="Apple-style-span" style="font-size: small; ">You can see there are 8 grid squares horizontally, so there will be 8 attribute bytes horizontally. &#xA0;Then each one of those grid squares is split up into 2x2 tile sections to generate the attribute byte:</span></div><div align="baseline"><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><img src original-src="http://www.NintendoAgeMedia.com/users/142/photobucket/F8376193-9343-AF0D-B8DA7BD8B7DD9301.png" show-src="scraper/images/F8376193-9343-AF0D-B8DA7BD8B7DD9301.png"></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; ">No 16x16 area can use more than 4 colors, so the question mark and the block cannot use the greens from the palette.</span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: medium; ">Uploading the data</span></span></div><div><span class="Apple-style-span" style="font-size: small; ">To set the background graphics your data has to be defined in your ROM using the .db directive, then copied to the PPU RAM. &#xA0;Some graphics tools will generate this data but here it will just be done manually. &#xA0;To keep it shorter only a few rows of graphics will be created. &#xA0;The same CHR file from SMB will be used here too. &#xA0;First the nametable data is defined, with each graphics row split into two 16 byte sections to keep lines shorter:</span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">nametable:</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24&#xA0; ;;all sky ($24 = sky)</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24&#xA0; ;;row 2</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24&#xA0; ;;all sky</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; .db $24,$24,$24,$24,$45,$45,$24,$24,$45,$45,$45,$45,$45,$45,$24,$24&#xA0; ;;row 3</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$53,$54,$24,$24&#xA0; ;;some brick tops</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; .db $24,$24,$24,$24,$47,$47,$24,$24,$47,$47,$47,$47,$47,$47,$24,$24&#xA0; ;;row 4</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$55,$56,$24,$24&#xA0; ;;brick bottoms</p></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><span class="Apple-style-span" style="font-size: 12px; "><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; ">Then the attribute table data is defined. &#xA0;Each byte covers 4x4 tiles, so only 8 bytes are needed here. &#xA0;Binary is used so editing the 2 bits per 2x2 tile area is easier:</span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">attribute:</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; .db %00000000, %00010000, %01010000, %00010000, %00000000, %00000000, %00000000, %00110000</p></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div></span></span></div><div><span class="Apple-style-span" style="font-size: 13px; ">And finally the same color palette as SMB is used:</span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">palette:</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; .db $22,$29,$1A,$0F,&#xA0; $22,$36,$17,$0F,&#xA0; $22,$30,$21,$0F,&#xA0; $22,$27,$17,$0F</p></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; ">Just like our previous palette loading, a loop is used to copy a specific number of bytes from a memory location to the PPU. &#xA0;First the PPU address is set to the beginning of the nametable at $2000. &#xA0;Then our 128 bytes of background data are copied. &#xA0;Next the PPU address is set to the beginning of the attribute table at $23C0 and 8 bytes are copied.</span></div><div><br></div><div><span class="Apple-style-span" style="font-size: 13px; "><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">LoadBackground:</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; LDA $</span><span style="color: rgb(28, 0, 207); ">2002</span><span style="color: rgb(0, 0, 0); "> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span>; read PPU status to reset the high/low latch</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; LDA <span style="color: rgb(0, 116, 0); ">#$20</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; STA $</span><span style="color: rgb(28, 0, 207); ">2006</span><span style="color: rgb(0, 0, 0); "> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span>; write the high byte of $2000 address</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; LDA <span style="color: rgb(0, 116, 0); ">#$00</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; STA $</span><span style="color: rgb(28, 0, 207); ">2006</span><span style="color: rgb(0, 0, 0); "> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span>; write the low byte of $2000 address</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; LDX </span>#$00&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; start out at 0</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">LoadBackgroundLoop:</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; LDA background, x &#xA0; &#xA0; </span>; load data from address (background + the value in x)</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; STA $<span style="color: rgb(28, 0, 207); ">2007</span> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <span style="color: rgb(0, 116, 0); ">; write to PPU</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; INX &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <span style="color: rgb(0, 116, 0); ">; X = X + 1</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; CPX </span>#$80&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; Compare X to hex $80, decimal 128 - copying 128 bytes</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; BNE LoadBackgroundLoop&#xA0; </span>; Branch to LoadBackgroundLoop if compare was Not Equal to zero</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span>; if compare was equal to 128, keep going down</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; ">&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">LoadAttribute:</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; LDA $</span><span style="color: rgb(28, 0, 207); ">2002</span><span style="color: rgb(0, 0, 0); "> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span>; read PPU status to reset the high/low latch</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; LDA <span style="color: rgb(0, 116, 0); ">#$23</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; STA $</span><span style="color: rgb(28, 0, 207); ">2006</span><span style="color: rgb(0, 0, 0); "> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span>; write the high byte of $23C0 address</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; LDA <span style="color: rgb(0, 116, 0); ">#$C0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; STA $</span><span style="color: rgb(28, 0, 207); ">2006</span><span style="color: rgb(0, 0, 0); "> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span>; write the low byte of $23C0 address</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; LDX </span>#$00&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; start out at 0</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">LoadAttributeLoop:</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; LDA attribute, x&#xA0; &#xA0; &#xA0; </span>; load data from address (attribute + the value in x)</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; STA $<span style="color: rgb(28, 0, 207); ">2007</span> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <span style="color: rgb(0, 116, 0); ">; write to PPU</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; INX &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <span style="color: rgb(0, 116, 0); ">; X = X + 1</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span style="color: rgb(0, 0, 0); ">&#xA0; CPX </span>#$08&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; Compare X to hex $08, decimal 8 - copying 8 bytes</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; BNE LoadAttributeLoop</p><div><br></div></span></div><div><span class="Apple-style-span" style="font-size: 13px; ">The final changes are to tell the PPU to use the Pattern Table 0 graphics for sprites, and Pattern Table 1 for background:</span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0;&#xA0;LDA #%10010000 ;enable NMI, sprites from Pattern 0, background from Pattern 1</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; STA $2000</p></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; ">Enable the background rendering:</span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0;&#xA0;LDA #%00011110 ; enable sprites, enable background</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; STA $2001</p></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; ">And to tell the PPU that we are not doing any scrolling at the end of NMI:</span></div><div><span class="Apple-style-span" style="font-size: 13px; "><br></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0;&#xA0;LDA #$00</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; STA $2005</p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; ">&#xA0; STA $2005</p></span></div><div><span class="Apple-style-span" style="font-size: 13px; "><div><span class="Apple-style-span" style="color: rgb(28, 0, 207); font-family: Monaco; font-size: 10px; "><br></span></div></span></div><div><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: large; ">Putting It All Together</span></span></div><div><span class="Apple-style-span" style="font-size: 18px; font-weight: bold; "><span class="Apple-style-span" style="font-family: Helvetica; font-size: 12px; font-weight: normal; "><span style="letter-spacing: 0px; ">Download and unzip the <a href="scraper/files/background2.zip" target="_blank" original-href="http://www.nespowerpak.com/nesasm/background2.zip">background2.zip</a>&#xA0;</span><span style="letter-spacing: 0px; ">sample files.&#xA0; All the code above is in the background.asm file.&#xA0; Make sure that file, mario.chr, and background.bat is in the same folder as NESASM, then double click on background.bat.&#xA0; That will run NESASM and should produce background.nes.&#xA0; Run that NES file in FCEUXD SP to see the background. &#xA0;Set it to PAL Emulation so you get to see the whole screen.</span></span></span></div><div><span class="Apple-style-span" style="font-family: Helvetica; "><br></span></div><div><span class="Apple-style-span" style="font-size: 18px; font-weight: bold; "><span class="Apple-style-span" style="font-family: Helvetica; font-size: 12px; font-weight: normal; "><span style="letter-spacing: 0px; ">Any background areas that you did not write to will still be using tile 0, which happens to be the number 0 in the SMB graphics. &#xA0;Try adding more nametable and attribute data to the .db sections, then changing the loops so they copy more bytes to the PPU RAM. &#xA0;You can also try changing the starting PPU address of the nametable and attribute table writes to move the rows further down.</span></span></span></div><div><span class="Apple-style-span" style="font-family: Helvetica; "><span class="Apple-style-span" style="font-size: small; "><br></span></span></div><div><span class="Apple-style-span" style="font-family: Helvetica; "><span class="Apple-style-span" style="font-size: small; "><br></span></span></div><div><span class="Apple-style-span" style="font-family: Helvetica; "><span class="Apple-style-span" style="font-weight: bold; "><span class="Apple-style-span" style="font-size: small; ">NEXT WEEK</span></span><span class="Apple-style-span" style="font-size: small; ">: &#xA0;Subroutines, game structure, states</span></span></div>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#main_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;main_tutorial-6__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8172" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>

                <div class="comments" style="display: none;" id="main_tutorial-6__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__1">
                                                        <div class="mdl-card__title"><strong>Jero</strong> posted on 
		
			
				
				May 17, 2008 at 6:48:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This makes me wanna work on pong again! I sent it to myself in an email, but hotmail wont open it cause &quot;it might contain virusses&quot; damn hotmail. I know theres no virus in my files
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__2">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				Jun 2, 2008 at 8:20:42 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Excellent! That explanation actually made attribute tables seem... super easy! Thanks++. I&apos;m looking forward to your lesson on game structure. That&apos;s the very thing that I&apos;m struggling with right now.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__3">
                                                        <div class="mdl-card__title"><strong>-JoSeph-</strong> posted on 
		
			
				
				Jun 3, 2008 at 8:08:05 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Keep them coming. =]
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__4">
                                                        <div class="mdl-card__title"><strong>Kizul Emeraldfire</strong> posted on 
		
			
				
				Jul 4, 2008 at 1:54:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Geh, I&apos;m stuck again. &gt;.&gt; I can&apos;t seem to figure out how to make more background. I just get blue sky on the two ready-made rows, and there&apos;re still a ton of zeroes all over the place. &gt;.&lt;&apos;
<br>
<br>Help? ^^;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__5">
                                                        <div class="mdl-card__title"><strong>albailey</strong> posted on 
		
			
				
				Jul 4, 2008 at 2:05:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Kizul Emeraldfire</b></i><br><br>Geh, I&apos;m stuck again. &gt;.&gt; I can&apos;t seem to figure out how to make more background. I just get blue sky on the two ready-made rows, and there&apos;re still a ton of zeroes all over the place. &gt;.&lt;&apos; <br><br>Help? ^^;</div><p><br><br><br>Did you update this part:<br>CPX #$80&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare X to hex $80, decimal 128 - copying 128 bytes</p><p>If you are adding more bytes to the background to be copied, you need to increment that to be bigger than 128</p><p>Al</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__6">
                                                        <div class="mdl-card__title"><strong>Kizul Emeraldfire</strong> posted on 
		
			
				
				Jul 6, 2008 at 1:56:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ahhh, yeah, that was it -- forgot to update that. ^^;
<br>
<br>Now it works; I doubled its value to $FF. <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-happy.gif" show-src="images/blank.gif"> Now there&apos;s two rows of sky above the blocks, and one below them. The weird thing is, now the blocks are green. o.O I also changed the CPX value in LoadAttribute (doubled it from $08 to $10), but that didn&apos;t seem to do anything. &gt;.&gt; (also quadrupled the LoadAttribute CPX value -- now the zeroes below the bottom sky-row have mixed-up colors! <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-happy.gif" show-src="images/blank.gif">) I happened to double (actually, duplicate) the &apos;attribute&apos; data, so I dunno what&apos;s going wrong with the colors. o.o&apos;
<br>
<br>Also, (I&apos;m guessing due to the fact that $FF is only 255, not 256,) for some reason the bottom-right corner in the last block on the bottom row of sky has a 0 in it, instead of being blank blue. o.O
<br>
<br>-------------------------
<br>Hark, the newbie hath spoken!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__7">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Jul 6, 2008 at 2:05:03 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Did you increase the attribute&apos;s in this section so you had more? There were only enough attribute entries for the number of background tiles copied before, so you&apos;ll need to add more into this section to make it correct
<br>
<br>attribute:
<br>  .db %00000000, %00010000, %0010000, %00010000, %00000000, %00000000, %00000000, %00110000
<br>
<br>Compare to #$00 instead of #$FF, this will do a complete 256 tiles. To do more tiles than this, you&apos;ll need to use both the X and Y registers in the loop.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__8">
                                                        <div class="mdl-card__title"><strong>Kizul Emeraldfire</strong> posted on 
		
			
				
				Jul 7, 2008 at 4:57:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Okay, this is currently what I&apos;m having a problem with right now. As far as I can tell, it SHOULD be fine! \o.o/ At least, I <i>think</i> it should. &gt;.&gt;<br><br><div class="FTQUOTE"><pre>LoadBackground:<br>  LDA $2002             ; read PPU status to reset the high/low latch<br>  LDA #$20<br>  STA $2006             ; write the high byte of $2000 address<br>  LDA #$00<br>  STA $2006             ; write the low byte of $2000 address<br>  LDX #$00              ; start out at 0<br>LoadBackgroundLoop:<br>  LDA background, x     ; load data from address (background + the value in x)<br>  STA $2007             ; write to PPU<br>  INX                   ; X = X + 1<br>  CPX #$00              ; Compare X to hex $80, decimal 128 - copying 128 bytes<br>  BNE LoadBackgroundLoop  ; Branch to LoadBackgroundLoop if compare was Not Equal to zero<br>                        ; if compare was equal to 128, keep going down<br>              <br>              <br>LoadAttribute:<br>  LDA $2002             ; read PPU status to reset the high/low latch<br>  LDA #$23<br>  STA $2006             ; write the high byte of $23C0 address<br>  LDA #$C0<br>  STA $2006             ; write the low byte of $23C0 address<br>  LDX #$00              ; start out at 0<br>LoadAttributeLoop:<br>  LDA attribute, x      ; load data from address (attribute + the value in x)<br>  STA $2007             ; write to PPU<br>  INX                   ; X = X + 1<br>  CPX #$10              ; Compare X to hex $08, decimal 8 - copying 8 bytes<br>  BNE LoadAttributeLoop  ; Branch to LoadAttributeLoop if compare was Not Equal to zero<br>                        ; if compare was equal to 128, keep going down</pre></div>
<br>
<div class="FTQUOTE"><pre>background:<br>  .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24  ;;row 1<br>  .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24  ;;all sky<br><br>  .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24  ;;row 2<br>  .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24  ;;all sky<br><br>  .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24  ;;row 1<br>  .db $24,$24,$24,$24,$24,$24,$24,$24,$36,$37,$24,$24,$24,$24,$24,$24  ;;all sky<br><br>  .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24  ;;row 2<br>  .db $24,$24,$24,$24,$24,$24,$24,$35,$25,$25,$38,$24,$24,$24,$24,$24  ;;all sky<br><br>  .db $24,$24,$24,$24,$45,$45,$24,$24,$45,$45,$45,$45,$45,$45,$24,$24  ;;row 3<br>  .db $24,$24,$24,$24,$24,$24,$24,$39,$3A,$3B,$3C,$24,$53,$54,$24,$24  ;;some brick tops<br><br>  .db $24,$24,$24,$24,$47,$47,$24,$24,$47,$47,$47,$47,$47,$47,$24,$24  ;;row 4<br>  .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$55,$56,$24,$24  ;;brick bottoms<br><br>  .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24  ;;row 1<br>  .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24  ;;all sky<br><br>  .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24  ;;row 2<br>  .db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24  ;;all sky<br><br>attribute:<br>  .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000010, %00001010, %00000000<br>  .db %00000000, %01000000, %01010000, %01000000, %00000000, %00000000, %00000000, %11000000</pre></div>
<br>What am I doing wrong? \o.o/ Oh, and a screenshot of how it looks when I kick it up in NESTopia (Mario&apos;s colors may differ from ROM-to-ROM):<br><div style="text-align: center;"><img src original-src="http://img178.imageshack.us/img178/2452/background001vf4.png" show-src="images/missing/background001vf4.png"><br><div style="text-align: left;">P.S.: sorry for the ridiculously-long post -- I dunno how to create &apos;Spoiler&apos; sections with this software. &lt;.&lt;<br></div></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__9">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Jul 7, 2008 at 7:28:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ummm, what *should* it be looking like? One big thing there is you don&apos;t appear to be loading any palettes, did you just not paste the code or is that missing?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__10">
                                                        <div class="mdl-card__title"><strong>Kizul Emeraldfire</strong> posted on 
		
			
				
				Jul 7, 2008 at 7:54:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry, I just didn&apos;t paste that in. &gt;.&gt; LoadPalettes and LoadPalettesLoop are currently unmodified from the example ASM file.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__11">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Jul 8, 2008 at 5:12:59 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Not 100% sure what you&apos;re after, but to use the palettes appropriately you&apos;ll need to shuffle around your attribute values a bit:
<br>
<br>attribute:
<br>  .db %00000000, %00000000, %00000000, %00000000, %00000000, %10000000, %10100000, %00000000
<br>  .db %00000000, %0000001, %00000101, %00000001, %00000000, %00001000, %00001010, %00000011
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__12">
                                                        <div class="mdl-card__title"><strong>Kizul Emeraldfire</strong> posted on 
		
			
				
				Jul 8, 2008 at 5:20:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Huh. Bizzare. It&apos;s like I had the attribute bytes backwards. o.O
<br>
<br>Looking at the example pic, I thought SURE that they were right-to-left, bottom-to-top -- ah well. Thanks, Zzap -- that worked perfectly. <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-happy.gif" show-src="images/blank.gif">
<br>
<br>Now to figure out how to fill the whole screen with graphics... ^^
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__13">
                                                        <div class="mdl-card__title"><strong>albailey</strong> posted on 
		
			
				
				Jul 8, 2008 at 12:26:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The thing about loading the entire nametable (1024 bytes =   32x30 for the tiles, plus 64 for the entire OAM attributes) is that the X counter you are using can only go up to 256.  So how do you load in the 257th byte?
<br>The answer is to use a slightly more complicated syntax for the addressing mode.   I suspect bunnyboy has covered this (or is planning to) in one of his tutorials.
<br>
<br>If he hasnt, or you dont want to wait, you need to clone the LoadBackground method and give it different starting points, and make additional data tables (backgroundX<img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> and load each of those in 256 (or less) sized chunks.
<br>
<br>You should be able to leave the attribute stuff alone since its 64 bytes max.
<br>
<br>
<br>Al
<br>
<br>Al
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__14">
                                                        <div class="mdl-card__title"><strong>Kizul Emeraldfire</strong> posted on 
		
			
				
				Jul 8, 2008 at 4:06:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sweet! <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-happy.gif" show-src="images/blank.gif"> Thanks, Al!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__15">
                                                        <div class="mdl-card__title"><strong>Kizul Emeraldfire</strong> posted on 
		
			
				
				Jul 18, 2008 at 5:25:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hmmmmmmm... I still can&apos;t figure out how to create more than half a screen&apos;s-worth of background. &gt;.&lt;<br><br>Here is my entire background.asm file:
<a href="http://nintendoage.pastebin.com/m4f0e06ef" target="_blank" original-href="http://nintendoage.pastebin.com/m4f0e06ef">http://nintendoage.pastebin.com/m...</a><br><br>I&apos;d include a screenshot, but it&apos;s basically the same as the one I posted before, just with proper colors, and with four 16&#xD7;16-pixel rows of plain blue sky above what&apos;s already in my former screenshot. &gt;.&gt;<br><br>So -- anyway. What do I do to load a FULL background, instead of just half of it? \o_O/ Anyone? &gt;.&gt;?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__16">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Jul 19, 2008 at 3:55:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here&apos;s a version that loads a full background, using simple addressing, and note that I haven&apos;t really bothered setting the attributes up so that it looks pretty or anything (it just repeats the rows you had previously) <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> I also reset the scroll values after writing to the PPU so that it wasn&apos;t having issues there.
<br>
<br><a href="http://nintendoage.pastebin.com/f21f5696c" target="_blank" original-href="http://nintendoage.pastebin.com/f21f5696c">http://nintendoage.pastebin.com/f...</a>
<br>
<br>Also, here&apos;s a simpler version where I use both the X and Y registers to load the full nametable and attribute table in 1 loop:
<br>
<br><a href="http://nintendoage.pastebin.com/f12cef2c1" target="_blank" original-href="http://nintendoage.pastebin.com/f12cef2c1">http://nintendoage.pastebin.com/f...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__17">
                                                        <div class="mdl-card__title"><strong>Kizul Emeraldfire</strong> posted on 
		
			
				
				Jul 19, 2008 at 4:13:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sweet! <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-happy.gif" show-src="images/blank.gif"> Thanks, Zzap -- they work great!
<br>
<br>As for the first one you linked to, for some reason I could SWEAR I did something like that already. o.O I guess maybe it was &apos;cause I was using both the X and the Y registers when I should&apos;ve just been using X or something. Ah well -- thanks again! <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-happy.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__18">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				Aug 22, 2009 at 8:40:10 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m having some problems with my background.<div align="0"><br></div><div><img src original-src="http://www.NintendoAgeMedia.com/users/24/photobucket/420A0666-CF1D-7AA0-0B930B0EF10658E1.jpg" show-src="scraper/images/420A0666-CF1D-7AA0-0B930B0EF10658E1.jpg"></div><div><br></div><div>I made my background with the 2&apos;s from the background pallette. As you can see I have black and green two&apos;s. The green 2&apos;s are the one&apos;s that I want.&#xA0;</div><div>I checked my attributes and they are all set to %00000000 which should result in the green 2&apos;s.</div><div>For some reason, the black 2&apos;s uses a different pallete.&#xA0;</div><div><br></div><div>Here is my code:</div><div><br></div><div><a href="http://nintendoage.pastebin.com/f51725d69" target="_blank" original-href="http://nintendoage.pastebin.com/f51725d69">http://nintendoage.pastebin.com/f51725d69</a></div><div><br></div><div>I first used %00000000 for all my attributes. Then I changed them all to %11111111 to see if anything happens (it should change to all black 2&apos;s), but the result is the same.&#xA0;</div><div><br></div><div>My guess is that my attributes aren&apos;t getting loaded or somehting.&#xA0;</div><div>Anyone knows what I&apos;m doing wrong ?&#xA0;</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__19">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Aug 22, 2009 at 8:49:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You are loading too much background, which is extending into the attribute memory area.  You have 4 loops of 256 bytes which is 1024 bytes, but there&apos;s only 960 bytes of background tiles.  Need to change one of the loops to copy fewer bytes.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__20">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				Aug 22, 2009 at 9:14:38 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br>You are loading too much background, which is extending into the attribute memory area.  You have 4 loops of 256 bytes which is 1024 bytes, but there&apos;s only 960 bytes of background tiles.  Need to change one of the loops to copy fewer bytes.</div><br><br>Also got this working right....so again: Thx alot&#xA0;<img src style="display: none;" original-src="/i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__21">
                                                        <div class="mdl-card__title"><strong>resynthesize</strong> posted on 
		
			
				
				Oct 27, 2009 at 5:41:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Zzap</b></i><br><br>Here&apos;s a version that loads a full background, using simple addressing, and note that I haven&apos;t really bothered setting the attributes up so that it looks pretty or anything (it just repeats the rows you had previously) <img border="0" src style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> I also reset the scroll values after writing to the PPU so that it wasn&apos;t having issues there.
<br>
<br><a href="http://nintendoage.pastebin.com/f21f5696c" target="_blank" original-href="http://nintendoage.pastebin.com/f21f5696c">http://nintendoage.pastebin.com/f21f5696c</a>
<br>
<br>Also, here&apos;s a simpler version where I use both the X and Y registers to load the full nametable and attribute table in 1 loop:
<br>
<br><a href="http://nintendoage.pastebin.com/f12cef2c1" target="_blank" original-href="http://nintendoage.pastebin.com/f12cef2c1">http://nintendoage.pastebin.com/f12cef2c1</a></div><br><br>Hi Zzap, <br><br>Would you mind explaining the following block of code?<br><br>===============================<br>&#xA0; LDA #low(background)<br>&#xA0; STA AddrLow<br>&#xA0; LDA #high(background)<br>&#xA0; STA AddrHigh<br><br>&#xA0; LDX #$04&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Loop X 4 times<br>&#xA0; LDY #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Loop Y 256 times<br>LoadBackgroundsLoop:<br>&#xA0; LDA [AddrLow],y<br>&#xA0; STA $2007<br>&#xA0; INY<br>&#xA0; BNE LoadBackgroundsLoop<br>; Outer loop<br>&#xA0; INC AddrHigh&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; increment high byte of address backg to next 256 byte chunk<br>&#xA0; DEX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; one chunk done so X = X - 1.<br>&#xA0; BNE LoadBackgroundsLoop&#xA0;&#xA0; ; if X isn&apos;t zero, do again<br>===============================<br><br>I&apos;ve worked out the general idea of it but I&apos;m confused on the details.&#xA0; I don&apos;t understand the purpose of incrementing AddrHigh since that isn&apos;t referenced anywhere else.&#xA0; <br><br>Thanks!<br>Brandon<br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__22">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Oct 27, 2009 at 7:49:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You have to incriment AddrHigh cause:
<br>$2000 + $00 = $2100
<br>So on the second outer loop you want to start writing from $2100 not $2000.  If you didn&apos;t do this, you would just overwrite the top 1/4 of the screen 4 times.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__23">
                                                        <div class="mdl-card__title"><strong>resynthesize</strong> posted on 
		
			
				
				Oct 27, 2009 at 8:10:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br>You have to incriment AddrHigh cause:
<br>$2000 + $00 = $2100
<br>So on the second outer loop you want to start writing from $2100 not $2000.  If you didn&apos;t do this, you would just overwrite the top 1/4 of the screen 4 times.</div><br><br>I understand that AddrHigh is incremented to start processing the next chunk.&#xA0; What I am confused about is how incrementing it is automatically updating the loop to look at the correct address.&#xA0; <br><br>Here is my understanding of the loop: <br><br>* AddrHigh and AddrLow are both set to the high and low bytes of the background address<br>* X and Y registered are set with 4 and 0 respectively<br>* Loop starts<br>* The first byte of the background is loaded into the accumulator and stored in $2007.&#xA0; This is where I am confused.&#xA0; If the background tiles started at $3F00 for example, AddrHigh should contain $3F and AddrLow $00, right?&#xA0; The LDA is reading from  AddrLow ($00) + Y, which is 0 the first time around the loop.&#xA0; Wouldn&apos;t that load whatever was in $00 the first time around?&#xA0; I think there is some magic with the brackets where LDA [AddrLow], y is automatically calculating the correct offset from AddrHigh and AddrLow, but I don&apos;t see how that is done, and that is what I&apos;m confused about <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> <br><br>&#xA0;<br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__24">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Oct 27, 2009 at 8:53:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think I see what you&apos;re saying
<br>AddrHigh and AddrLow are just variables 
<br>
<br>AddrHigh .rs and AddrLow .rs.....They&apos;re not defined anywhere, so they are set to default $00
<br>
<br>I think the magic you&apos;re looking for has to do with the code snippet right before the loop
<br>
<br>  LDA $2002
<br>  LDA #$20
<br>  STA $2006             ; write the high byte of $2000 address
<br>  LDA #$00
<br>  STA $2006             ; write the low byte of $2000 address
<br>
<br>I don&apos;t understand it completely myself, but I&apos;m pretty sure this is setting the the the address for the variables.
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__25">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Oct 28, 2009 at 12:45:32 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>Whenever you copy some data from one place to another, by definition you have a source and a destination.&#xA0; In this case, your source is somewhere in ROM and your destination is the PPU (VRAM).&#xA0; Writes to $2006 will set your destination address, and then you write to the destination with sta $2007.&#xA0; The PPU takes care of incrementing the addresses for you, so you don&apos;t have to do anything.</p><p>The source is where you are having some problems.&#xA0; First, all addresses are 16-bit, which is why we need two variables (1 byte each) to represent one address.&#xA0; The 6502 is little endian, so addresses need to be stored low-byte first (high-byte last).&#xA0; So when we make a pointer variable in RAM, the low byte needs to come first, hence the order:</p><p>AddrLow .rs 1</p><p>AddrHigh .rs 1</p><p>Now as you suspected, the magic is in the brackets [].&#xA0; Putting brackets around a variable Z translates to &quot;the address located at Z and Z+1&quot;.&#xA0; So when we have an instruction like this:</p><p>lda [AddrLow], y</p><p>it translates into English as &quot;Go to the address stored in AddrLow and AddrLow+1.&#xA0; Add y to that address.&#xA0; Read the byte located there and stick it in the Accumulator.&quot;</p><p>If you look at our variable declarations above, you will see that AddrLow+1 is none other than AddrHigh.&#xA0; So in our case, the instruction translates to &quot;Go to the address stored in AddrLow and AddrHigh.&#xA0; Add y to that address.&#xA0; Read the byte located there and stick it in the Accumulator.&quot;</p><p>This is the piece you were missing I think.&#xA0; We only put one variable (AddrLow) in the brackets, but the 6502 extrapolates that to two variables (AddrLow and AddrHigh) and makes a 16-bit address out of them.<br></p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__26">
                                                        <div class="mdl-card__title"><strong>resynthesize</strong> posted on 
		
			
				
				Oct 28, 2009 at 1:13:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thomas, thanks!&#xA0; This is exactly what I was looking for and it makes perfect sense now.&#xA0; My only remaining question is whether this is a universal 6502 asm technique or something specific to NESASM.&#xA0; I didn&apos;t see the brackets listed on this 6502 addressing reference page anywhere: <a href="http://www.obelisk.demon.co.uk/6502/addressing.html" target="_blank" original-href="http://www.obelisk.demon.co.uk/6502/addressing.html">http://www.obelisk.demon.co.uk/65...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__27">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Oct 28, 2009 at 1:31:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It is indirect indexed addressing on that page.  Some people use the () notation and some use the brackets.  There is no real standard but the mode is in all 6502 processors.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__28">
                                                        <div class="mdl-card__title"><strong>resynthesize</strong> posted on 
		
			
				
				Oct 28, 2009 at 2:41:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					OK thanks.&#xA0; I googled &apos;indirect indexed&apos; to read more info about this since the explanation on the page I linked above wasn&apos;t very helpful.&#xA0; I found this page which explains it better I think: <br><br><a href="http://www.atariarchives.org/roots/chapter_6.php" target="_blank" original-href="http://www.atariarchives.org/roots/chapter_6.php">http://www.atariarchives.org/root...</a><br><br>I now understand what is going on.&#xA0; It is the declaration of AddrHigh and AddrLow as zero page variables that allows indirect indexing to work.&#xA0; Thanks everyone again for your help! &#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__29">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Feb 17, 2010 at 11:24:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br><div><span style="font-size: small;" class="Apple-style-span">You can see there are 8 grid squares horizontally, so there will be 8 attribute bytes horizontally. &#xA0;Then each one of those grid squares is split up into 2x2 tile sections to generate the attribute byte:</span></div><div align="baseline"><span style="font-size: 13px;" class="Apple-style-span"><br></span></div><div><span style="font-size: 13px;" class="Apple-style-span"><img src original-src="http://www.NintendoAgeMedia.com/users/142/photobucket/F8376193-9343-AF0D-B8DA7BD8B7DD9301.png" show-src="scraper/images/F8376193-9343-AF0D-B8DA7BD8B7DD9301.png"></span></div><div><span style="font-size: 13px;" class="Apple-style-span"><br></span></div><div style="background-color: rgb(153, 255, 0);"><span style="font-size: 13px;" class="Apple-style-span">No 16x16 area can use more than 4 colors, so the question mark and the block cannot use the greens from the palette.</span></div></div><br>Hey bunnyboy,<br><br>I&apos;m a noob at NES homebrew and am in the process of pulling things apart to see how they work.&#xA0; I&apos;ve really been enjoying your tutorials since finding them online a few days ago.<br><br>I was looking at different games just to verify the &quot;no more than 4 colors per attribute tile&quot; rule highlighted above, and got confused when I looked at this one from the character select screen on SMB2.&#xA0; (I&apos;m fairly certain my selection is an actual 16x16 attribute tile, but could be wrong.&#xA0; I might have over dragged by a few pixels when I was capturing, as well.)<br><img src original-src="http://www.NintendoAgeMedia.com/users/4254/photobucket/DCBAC68D-CF1D-7AA0-0236DBFA5728C896.JPG" show-src="scraper/images/DCBAC68D-CF1D-7AA0-0236DBFA5728C896.JPG"><br><br>Now I know it&apos;s probably something I&apos;m looking at wrong and/or misunderstanding, but I&apos;m counting at least five colors being used in this area: red, blue, white, dark red, yellow.&#xA0; Any idea what I&apos;m not getting?<br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__30">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 17, 2010 at 11:26:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>^^ That&apos;s a 32x32 tile. </p><p>i.e. 2x2 each, 16x16 tiles.</p><p>Top left is using white, dark red, and light red.</p><p>Bottom left is blue, dark blue, and white.</p><p>Top right is using dark and light red.</p><p>Bottom right is using black, light red, dark red, and yellowish.</p><p>
				</p></div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__31">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Feb 17, 2010 at 11:31:43 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ah, I see now.&#xA0; My math was way screwed up there.&#xA0; Thanks for the help! &#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__32">
                                                        <div class="mdl-card__title"><strong>Horv</strong> posted on 
		
			
				
				Jun 21, 2010 at 8:04:08 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi all! Thanks for the tut! Its helped! But I&apos;m having trouble with the background, &apos;cause it made its limit. :S<br>Here&apos;s this picture: <br><br><img src original-src="http://kunio.zapto.org/Horv/kep.jpg" show-src="images/missing/kep.jpg"><br><br>This don&apos;t want to display more lines.<br><br>Here&apos;s the code about the tiles:<br>loadbg:<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; lda background,x<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; sta $2007<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; inx<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; cmx #208<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bne loadbg<br>background:<br><br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>&#xA0; .db $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$24,$24,$24,$24,$24,$24&#xA0; ;;row 1<br>Thanks! Horv<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__33">
                                                        <div class="mdl-card__title"><strong>Dwedit</strong> posted on 
		
			
				
				Jun 21, 2010 at 10:25:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Of course it doesn&apos;t want to display any more lines, you&apos;re only copying 208 tiles. (6.5 rows, or less depending on what X is initialized to)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__34">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jun 21, 2010 at 11:17:48 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Horv</b></i><br><br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; cmx #208<br></div><br>typo!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__35">
                                                        <div class="mdl-card__title"><strong>Horv</strong> posted on 
		
			
				
				Jun 21, 2010 at 11:23:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oh, &apos;Cause I want to start the background at 80. Y. Is that possible?<br><br><div class="FTQUOTE"><i>Originally posted by: <b>Dwedit</b></i><br><br>Of
 course it doesn&apos;t want to display any more lines, you&apos;re only copying 
208 tiles. (6.5 rows, or less depending on what X is initialized to)</div><br><br>But the complier says error to me :S<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__36">
                                                        <div class="mdl-card__title"><strong>Horv</strong> posted on 
		
			
				
				Jun 22, 2010 at 3:06:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I made it! YEAH YEAH!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__37">
                                                        <div class="mdl-card__title"><strong>thebmxeur</strong> posted on 
		
			
				
				Jan 4, 2011 at 2:44:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi, I&apos;m new to NES programming and this tutorial really helps a lot.<br><br>But I&apos;ve got a few question : when I set a color in the first byte of the sprites palette, the fist bytes of each &quot;group&quot; of background palette changes. I tried with both the file I was working on and the file provided and it does the same. I&apos;m missing something ?<br><br>Also can someone explain a little the DMA part when loading sprites ? I&apos;m not sure why we don&apos;t use 2 STA $2003 (one with #$00 and one with #$02) and then &quot;call&quot; STA $4014. And is it ok to have that part (the DMA transfer) before checking the controllers states and moving the sprites (will the sprites move during the current or the next frame ?) ?<br><br>A last question : in the first part of the tutorial (making a bluish background), during the clrmen: part you put #$FE at $0300 ($03xx). Why ?<br><br>I hope I didn&apos;t ask too much question ^^<br>Thanks in advance<br>Bye<br><br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__38">
                                                        <div class="mdl-card__title"><strong>Herbalist</strong> posted on 
		
			
				
				Feb 2, 2011 at 4:39:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I downloaded the attached background2.zip and I noticed that after the attribute line of code there is a previous line of sky data repeated.<br><br>I dont think it belongs does it?<br>Why is it there? Filler Data?<br>
<br><br>[ QUOTE ]<br><br>attribute:
<br>  .db %00000000, %00010000, %01010000, %00010000, %00000000, %00000000, %00000000, %00110000
<br>
<br>  .db $24,$24,$24,$24, $47,$47,$24,$24 ,$47,$47,$47,$47, $47,$47,$24,$24 ,$24,$24,$24,$24 ,$24,$24,$24,$24, $24,$24,$24,$24, $55,$56,$24,$24  ;;brick bottoms
<br>
<br>
<br>
<br>  .org $FFFA     ;first of the three vectors starts here
<br>  .dw NMI        ;when an NMI happens (once per frame if enabled) the 
<br>                   ;processor will jump to the label NMI:
<br>  .dw RESET      ;when the processor first turns on or is reset, it will jump
<br>                   ;to the label RESET:
<br>  .dw 0          ;external interrupt IRQ is not used in this tutorial
<br>  
<br>  
<br>[ END QUOTE ]<br><br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__39">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Apr 26, 2011 at 4:12:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I seem to be having trouble with this. for some reason my code displays 4 pink blocks on a black background while BunnyBoy&apos;s will display mario with bricks and sky and whatnot. can someone point out to me where in my code it is incorrect. I&apos;m not asking for exact reason just where the problem is occurring in the code.  
<br>
<br>[Edit] <br><br>&#xA0;deleted all the code on the page since it was just taking up space on the thread.<br><br><br>[EDIT]<br>&#xA0;
I forgot to put this in the code which kept the sprites from loading. lol<br><br>&#xA0;&#xA0; .bank 2<br>
&#xA0; .org $0000<br>
&#xA0; .incbin &quot;mario.chr&quot;<br><br>I spent nearly 4 hours going over my code to realize that I was missing this little piece. lol<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__40">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 26, 2011 at 4:30:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Is this your whole program?  Do you ever include the CHR data?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__41">
                                                        <div class="mdl-card__title"><strong>LucasWeatherby</strong> posted on 
		
			
				
				May 14, 2011 at 1:37:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					ok i need some help... when i use fceuxd and open the ppu viewer, i can see that the &apos;? box&apos; begins and lotcast $53. and goes thru $56. however, if i open up the mario.chr file with yy-chr it says the &apos;? box&apos; begins at C3. how can you know that address gets changed?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__42">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 14, 2011 at 2:20:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It&apos;s at $53-$56. My CHR file from this zip is at the same place. Maybe download it again? Or you&apos;re not going all the way to the bottom when you scroll with the red bar on the left side.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__43">
                                                        <div class="mdl-card__title"><strong>LucasWeatherby</strong> posted on 
		
			
				
				May 14, 2011 at 4:36:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					ohh i see, you have to scroll all the way to the bottom to make it $53-$56(which also makes the numbers the first things on the screen in yy-chr). So I guess the numbers are where the background tiles knows to start. And i guess the assembler just knows this when it loads the background. Im still kind of confused on what i would do if i wanted more tiles then this mario.chr has tho. then how would it know where the background started?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__44">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 15, 2011 at 9:31:11 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well you can only have 8KB of tiles in total. 4K for the front and 4K for the back. To get more you use a mapper, you can mostly only use a 8KB bank at a time. Then basically you can just make each file 8KB and include them all in the program. But you&apos;ll have to have your game switch them to utilize them.
<br>
<br>To make a new file of the size you want (it should be an even number like 8K,16K,32K,64K,128K,256K etc.) and then start making the graphics. If you need the program to create a blank file, I have one just PM me. With eath 8KB bank, you can select which ones go on the background and which goes to the sprites.
<br>
<br>And the assembler doesn&apos;t care what the background grahics are, the games program does and &quot;knows&quot; all it needs to know. The assembler just shoves the graphics in after the program, it doesn&apos;t do anything to them. It doesn&apos;t need to know which tile is what, it just assembles your ROM. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__45">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Nov 2, 2011 at 6:09:56 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					New guy here, thought after 2 months of reading this stuff and doing well in the tutorials that I would make it all the way through to the last topic, but got stuck on a question I&apos;m not getting. So joined up the NA site so I could post my question and start participating. <br><br>Anyway, I&apos;m having difficulty determining what should be a &quot;sprite&quot;, and what should be in the &quot;background&quot;. Or what the real difference is anyway. <br><br>For example, in SMB, the clouds and bricks are both background (Pattern Table 1) correct? But Mario interacts (collision) with some background tiles like the bricks and some other background tiles not at all, like the clouds. So I&apos;m trying to see if there is a good definition for a sprite vs background tiles. The only thing I can tell really is that sprites have 4 attributes, only 2 of which differ it from a background tile (such as flipping it). Color palette and location are both set, etc....<br><br>Just trying to think ahead for certain situations like: <br>1. I may have more sprites than I can fit onto 1 Pattern Table of 1 .chr file. (Just make more chr files a solution?) <br>2. I may not have a background at all, so I would want both Pattern Tables for sprites (maybe Pac Man or Galaga has no background?) <br><br>Just thoughts, maybe I&apos;m way off, any kind words are welcome as this is my first post =) <br><br>OS <br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__46">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Nov 2, 2011 at 6:33:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The sprites can all move independently, and have pixel accuracy. You can have up to 64 8x8 or 8x16 sprites (max 8 per scanline).
<br>
<br>The background can only move as one whole background, while it is possible to update tiles in the background each frame, there is a limit to how many tiles you can replace per frame.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__47">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Nov 2, 2011 at 12:22:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Extending on what Zzap said: If it&apos;s one object like an item in the game that you can pick up, I&apos;d make it sprites. If it&apos;s an object often in the game, I&apos;d recommend making it a background tile. Animate it by taking it off the background is probably the best idea if you have the time to implement it. Super Mario Bros. 3 does this, look at FCEUX&apos;s nametable viewer and jump and hit a coin box and slow it down to see what it does. It&apos;ll remove it from the background and animate it via a sprite, and then put it back when it&apos;s done so that you can have many blocks in a row and still have animation to them when hit.
<div><br></div><div><br></div><div>As for no background, I dunno. A game simply done with all sprites would probably not be very good to look at, even if it played well, and if there&apos;s some decent amount of stuff on the screen, you may have to flicked a decent amount.</div><div><br></div><div>And then the NES usually does 8x8 pixel sprites. You can also do 8x16 sprites, which are actually 2 sprites built into one. You can use both the background graphics and sprite graphics for the whole graphics for the sprites in that mode. The background can only use the background sprites assigned to it even in that mode though, as it only does 8x8 graphics per tile on the background. If you have lots of characters in your game that are four 8x8 sprites made into a 16x16 object, I&apos;d use 8x16 spites so you can get more of them on the screen myself. You need to plan all this out before you start working on big projects. Although you&apos;re just learning, I&apos;d mess with both. Make a program that works with 8x8 sprites, and then use 8x16 and see the difference first hand. If you need help quick just PM me and I&apos;ll help you, I&apos;m always on line if I&apos;m at my house and will help you. <span class="sprites_emoticons absmiddle" id="emo_smile"></span></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__48">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Nov 3, 2011 at 4:32:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Did I mention that this site rocks because of the people here. I can tell this is definitely visited by true enthusiasts, and that alone is very exciting. Both of you seem pretty seasoned in this stuff, so thanks for the time to make the replies for us new guys. =) <br><br>Zzap, that makes sense, Guess I just needed to talk it out and hear it. <br><br>3GenGames, First sentence, got it. So if Mario hits the block (part of the background), it &quot;produces&quot; a sprite such as the mushroom via some code. Which is probably why the mushroom is in the sprite pattern table. Also, what I meant by no background was no attribute / colors just flat black $0F (like Galaga). The other reason I was asking&#xA0;and you already addressed with SMB3 comment. I&apos;m just thinking &quot;is it easier to have collision detection between a sprite and background, or sprite and sprite?&quot; So when Mario hits a block (background) there is collision detection obviously. And if a mushroom sprite is produced, and Mario grabs it, there is also collision detection. So which is easier sprite-to-sprite collision detection or sprite-to-background...or does it matter, they are the same? <br><br>Just planning ahead, as to which one I want to make. The bricks are obviously already part of the background, so its the more &quot;standard&quot; way of doing it. I just like to think outside the box and see what other options are there, and maybe understand a bit more on the &quot;why&quot; it is the standard. <br><br>Hope that makes sense. <br>Thanks for the PM offer, I&apos;ll probably take you up on it when I&apos;m &quot;stuck&quot; on an actual line of code, haha.&#xA0;Right now, I just have background of some SMB tiles and mario sprite that I can move around. <br><br>Still getting the feet wet. =) <br><br>OS <br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__49">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Nov 3, 2011 at 7:17:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ha, okay man. But sprite on sprite background detection is pretty easy, I&apos;d say the background is little harder, especially if you edit it at all. But I mean it&apos;s a good idea to me just not to mess with that out of the gate unless your project needs it, you can always work up to it later in the project or with another game. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__50">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Nov 4, 2011 at 4:20:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>Haha...only took a day. I&apos;m stuck. Well, not in code, but in understanding. The background colors...here goes. <br><br>Oh boy, I thought I had it all down, then I went to try and change colors to the cloud (background) and came to a unfortunate conclusion that I may be missing something fundamental in how the 4 colors are assigned to the pixels in the chr file as well. <br><br>So I&apos;m messing around with this, trying to understand the attribute table and coloring of the background pixels. so here goes. <br><br>According to bunnyboy in the first post, the first color in the 4bytes (of 16 total) is the &quot;transparent color&quot;. SO first question, what are the next 3 colors in the 4 bytes? For example, in my example.asm, the sprite palette has $21 in each of the 4 bytes (1st color) to ensure that the minimario sprite &quot;looks&quot; like minimario in the sky regardless of which set of colors is used by filling in the blank pixels with sky color($21) , okay, got it. Each of the colors changes a different part of mario as I go through the chr file palette selection and select a different set of 4 colors (same as assigning the sprite attribute to $00, $01, $02, or $03), okay, got it... <br><br>But I&apos;m not understanding how the assembler &quot;knows for any given set of 4 bytes of the color palette that is set to be used (see below example), which pixels will receive which of the four colors&quot;. In otherwords, how does it know that marios hat is all color $16, while his eyes are $18, skin $27, and area around him is the &quot;transparent area&quot; in this case color $21? <br><br>I&apos;m assuming as you make the chr file you assign &quot;sets of pixels&quot; to the first color, then the next &quot;set of pixels&quot; are assigned the second color, so on until all 4 colors are used and all pixels&#xA0;have been&#xA0;assigned to one of the 4 &quot;sets of pixels&quot;. <br><br>Once I understand this, I&apos;ll probably understand how the attributes apply to the background, but it is much different since 8 bytes of attributes are assigned to background vice 1 byte for a sprite. Just outta curiosity, why are there 8 bytes of attributes for colors for background, but only 1 byte for the attribute of a sprite? Not sure I&apos;m understanding the setting of background colors like I thought... <br><br>My hunch is there are 32 tiles total, so 8 tiles x 4 rows = 32 tiles. And 1 byte of background attribute dictates the colors of 4 tiles, so you need the 8 bytes for the 32 tiles total.... And even if thats right, how does 1 attribute dictate the color of 4 tiles, each with there &quot;4 sets of pixels&quot;? <br><br>--Sprite palette CODE <br><br>... <br><br>palette: ;first set, second, set, third set, fourth set <br><br>.db $22,$29,$1A,$0F, $22,$36,$17,$0F, $22,$30,$21,$0F, $22,$27,$17,$0F ;;background palette <br><br>.db $21,$16,$27,$18, $21,$02,$38,$3C, $21,$1C,$15,$14, $21,$02,$38,$3C ;;sprite palette data <br><br>.... <br><br>sprites: ;minimario <br><br>;vert tile attr horiz <br><br>.db $80, $32, $00, $80 ;sprite 0 Attr $00 means use the first set of 4 colors in sprite palette, $01 use second set, etc. <br><br>.db $80, $33, $00, $88 ;sprite 1 <br><br>.db $88, $34, $00, $80 ;sprite 2 <br><br>.db $88, $35, $00, $88 ;sprite 3 <br><br><br>... <br><br>--END sprite palette CODe <br><br><br><br>--START Background palette CODE <br>... <br><br>background: <br><br>.db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24 ;;row 1 (not visible) <br><br>.db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24 ;;all sky <br><br>.db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24 ;;row 2 <br><br>.db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24 ;;all sky <br><br>.db $24,$24,$24,$24,$45,$45,$24,$24,$45,$45,$45,$45,$45,$45,$24,$24 ;;row 3 <br><br>.db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$53,$54,$24,$24 ;;some brick tops <br><br>.db $24,$24,$24,$24,$47,$47,$24,$24,$47,$47,$47,$47,$47,$47,$24,$24 ;;row 4 <br><br>.db $24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$24,$55,$56,$24,$24 ;;brick bottoms <br><br><br>; why 8 bytes here? <br><br>attribute: <br><br>.db %00000000, %00010000, %01010000, %00010000, %00000000, %00000000, %00000000, %00110000 <br><br>... <br><br>--End Background palette CODE <br></p><p>And all this started cuz I wanted a grey cloud (which I still cant figure out)... well its raining now aint it? lol <br><br>OS </p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__51">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Nov 4, 2011 at 7:53:30 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					In before 3rd gen. 
<br>
<br>You need to open the chr file in tile molester. That will answer the chr ?.
<br>
<br>Each 16x16 bg block is only 2 bits, 1 2 3 4, just like sprites. You should revisit the picture.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__52">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Nov 4, 2011 at 12:19:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br>In before 3rd gen. 
<br>
<br>You need to open the chr file in tile molester. That will answer the chr ?.
<br>
<br>Each 16x16 bg block is only 2 bits, 1 2 3 4, just like sprites. You should revisit the picture.</div><br><br>That. Plus each pixel is 2 bits big, remember that. 3 colors+background since 00,01,10,11 is 4 combinations for the background. On sprites, the color with bits 00 is always see-through.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__53">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Nov 4, 2011 at 7:46:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br><strong><font size="4">In before 3rd gen.</font></strong> 
<br>
</div><br><br><br>
HAHAHAHAHAHAHAHAHAHAHHA
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__54">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 9, 2012 at 10:45:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m also having trouble with this like others before me and I think it&apos;s because I don&apos;t understand the nametable attributes. I&apos;m trying to load a full background of one specific tile repeated 960 times. This is what I have, and I&apos;m still getting a background of zeros:<br>
<br>
LoadBackground:<br>
LDA $2002 ; read PPU status to reset the high/low latch<br>
LDA #$20<br>
STA $2006 ; write the high byte of $2000 address<br>
LDA #$00<br>
STA $2006 ; write the low byte of $2000 address<br>
LDX #$00 ; index set to 0<br>
LDY #$00<br>
LoadBackgroundLoop:<br>
LDA #$24 ;<br>
STA $2007 ; write to PPU<br>
INY ;Background is 32x30 ($20 x $1E) sprites, so 960 bytes<br>
CPY #$20<br>
BNE LoadBackgroundLoop<br>
INX<br>
CPX #$1E&#xA0; ;This swaps with line below<br>
LDY #$00&#xA0;&#xA0; ;This swaps with line above<br>
BNE LoadBackgroundLoop<br>
<br>
EDIT: Figured it out.&#xA0; Had to swap the two lines as noted in the comments in the code above.&#xA0; I was constantly doing a compare, then the branch is referencing Y, not the result of the compare, so the loop never completed.&#xA0; The ordering of code in this language is so sensitive it can drive you nuts! haha <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__55">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 15, 2012 at 11:04:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Attribute tables are really confusing me, I have a question.
<br>
<br>You mention the following:
<br>
<br>Two bits of the attribute table byte are assigned to each 2x2 area.
<br>
<br>From your image example it seems that two bits of the byte are used per tile and not 2 per 2x2 tile area - that would be 8 bits from what I see?
<br>
<br>I must be looking at this completely wrong, any help would be greatly appreciated.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__56">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 15, 2012 at 11:11:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The tiles in SMB aren&apos;t 1 tile big, that&apos;s probably what is getting you. Each little square is 4 tiles made into a 2x2 square which is 1 block, which is why you probably can&apos;t &quot;see&quot; it. Does that make sense?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__57">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 15, 2012 at 11:13:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Each of those squares is made up of 4 tiles. <span class="sprites_emoticons absmiddle" id="emo_smile"></span> The question mark box is 4 tiles.<br>
<br>
edit: Not in before 3gen. <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__58">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 15, 2012 at 11:16:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	<br>
	edit: Not in before 3gen.</div>
<br>
<br>
<br>
HAHAHAHAHAHA!!<br>
<br>
(look familiar? <span class="sprites_emoticons absmiddle" id="emo_smile"></span>)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__59">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 15, 2012 at 11:17:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes that makes perfect sense, thanks guys <span class="sprites_emoticons absmiddle" id="emo_happy"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__60">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 16, 2012 at 11:08:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Whoops double post.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__61">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 16, 2012 at 11:13:08 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think I&apos;m having the same problem as Kenny B with overflow of nametable data going into attribute memory.&#xA0; My loops that copy the nametable data into memory copy 1024 bytes, but that should be okay because I have 960 bytes of nametable data and 64 bytes of attribute data which are contiguous in memory.&#xA0; I explicitly set them up in the data section so that I could copy it all in one go (yes, I know this is bad because it mixes logic with data...shame on me) so I&apos;m not sure why there seems to be some overflow.&#xA0; Do you really have to explicitly stop looping after 960 bytes, then write to $23CO through port $2007 just to prevent the overflow?&#xA0; That doesn&apos;t seem right to me since that memory is contiguous anyway.<br>
<br>
Code here:<br>
<br>
<a href="http://pastebin.com/N0tQQ1td" target="_blank" original-href="http://pastebin.com/N0tQQ1td">http://pastebin.com/N0tQQ1td...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__62">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 16, 2012 at 12:16:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I know you&apos;ve been through these (As stated on NESDev) but maybe you should look into making subroutines that upload 1KB of data to the PPU, especially before trying to implant a hack to make it work in a project right now. You don&apos;t have to stop writing to the nametable for the attributes or anything. You just have to make sure no NMI&apos;s happen and then make sure rendering is disabled to upload a whole nametable, that&apos;s it. Use the tool NESst to make nametables wth your graphics, and then save it as a .BIN file with attributes, then upload that. I&apos;d advise doing that in another project just to get a better idea of how to do it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__63">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 16, 2012 at 2:22:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>muffins</b></i><br>
	<br>
	I think I&apos;m having the same problem as Kenny B with overflow of nametable data going into attribute memory.&#xA0; My loops that copy the nametable data into memory copy 1024 bytes, but that should be okay because I have 960 bytes of nametable data and 64 bytes of attribute data which are contiguous in memory.&#xA0; I explicitly set them up in the data section so that I could copy it all in one go (yes, I know this is bad because it mixes logic with data...shame on me) so I&apos;m not sure why there seems to be some overflow.&#xA0; Do you really have to explicitly stop looping after 960 bytes, then write to $23CO through port $2007 just to prevent the overflow?&#xA0; That doesn&apos;t seem right to me since that memory is contiguous anyway.<br>
	<br>
	Code here:<br>
	<br>
	<a href="http://pastebin.com/N0tQQ1td" target="_blank" original-href="http://pastebin.com/N0tQQ1td">http://pastebin.com/N0tQQ1td</a></div>
<br>
When I changed your attribute data to normal looking attribute data it worked fine. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
&#xA0;&#xA0;&#xA0; titleattr:<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
<br>
&#xA0;&#xA0;&#xA0; attributes:<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
&#xA0; .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__64">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 16, 2012 at 11:12:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	When I changed your attribute data to normal looking attribute data it worked fine.<br>
	&#xA0;</div>
<br>
I can&apos;t begin to imagine what it is that makes it work when the attribute data is set to zero but not to anything else.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__65">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 16, 2012 at 11:16:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Nothing.
<br>
<br>(You should look at the NESASM command .incbin pleaseeee!)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__66">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 16, 2012 at 11:23:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Moving the data into another .asm file and then doing a .incbin &quot;data.asm&quot; at the same address the data was at just throws compiler errors at me.  I understand it cleans up my code but I&apos;m just trying to figure out what sort of sorcery is being invoked here.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__67">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 16, 2012 at 11:30:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No, wrong command, read harder here:<br>
<br>
<a href="scraper/files/usage.txt" target="_blank" original-href="http://www.nespowerpak.com/nesasm/usage.txt">http://www.nespowerpak.com/nesasm...</a><br>
<br>
So you can start using programs like this to make screens instead, it&apos;s 50x easier than how you&apos;re doing it now.<br>
<br>
<a href="http://nesdev.parodius.com/bbs/viewtopic.php?t=7237" target="_blank" original-href="http://nesdev.parodius.com/bbs/viewtopic.php?t=7237">http://nesdev.parodius.com/bbs/viewtopic.php?t=7237</a><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__68">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 16, 2012 at 11:42:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	No, wrong command, read harder here:<br>
	<br>
	<a href="scraper/files/usage.txt" target="_blank" original-href="http://www.nespowerpak.com/nesasm/usage.txt">http://www.nespowerpak.com/nesasm/usage.txt</a><br>
	<br>
	So you can start using programs like this to make screens instead, it&apos;s 50x easier than how you&apos;re doing it now.<br>
	<br>
	<a href="http://nesdev.parodius.com/bbs/viewtopic.php?t=7237" target="_blank" original-href="http://nesdev.parodius.com/bbs/viewtopic.php?t=7237">http://nesdev.parodius.com/bbs/viewtopic.php?t=7237</a></div>
That usage doc is super helpful.&#xA0; Thanks!<br>
<br>
I am using that program and basically just copying the block so that the program generates the ASM code and copies it to the clipboard.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__69">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 16, 2012 at 11:46:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	No, wrong command, read harder here:<br>
	<br>
	<a href="scraper/files/usage.txt" target="_blank" original-href="http://www.nespowerpak.com/nesasm/usage.txt">http://www.nespowerpak.com/nesasm/usage.txt</a><br>
	<br>
	So you can start using programs like this to make screens instead, it&apos;s 50x easier than how you&apos;re doing it now.<br>
	<br>
	<a href="http://nesdev.parodius.com/bbs/viewtopic.php?t=7237" target="_blank" original-href="http://nesdev.parodius.com/bbs/viewtopic.php?t=7237">http://nesdev.parodius.com/bbs/viewtopic.php?t=7237</a></div>
You&apos;re not really helping with his problem.&#xA0; You&apos;re constantly just trying to get his code to look better, which is great, but not really what he&apos;s asking for.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__70">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 16, 2012 at 11:55:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Teach them wrong and get it to do something or teach them right and get it to do something, which am I supposed to go with as the tutorial seems to go more of the way of the former. I&apos;m trying to get him to do this so I can help him because as the code stands right now it&apos;s very, very confusing to figure out. I&apos;m just trying to help, but Khan is more than qualified and will probably help more then. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__71">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 17, 2012 at 12:20:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I can certainly respect and appreciate the suggestions on restructuring my code, because if I expect any help my code should be well-organized and readable so that it&apos;s easier to spot bugs. I&apos;ve split my code up into 3 files: main game logic, subroutines, and data. I&apos;ve tried to comment my code as much as possible to make it evident what each block does. I guess what&apos;s really throwing me here is the issue that KHAN pointed out...if the attributes are set to zero, everything is fine. Even a switch to a non-zero value to change what palette set is being used will cause that overflow effect which I can&apos;t reconcile.<br>
<br>
pong1.asm: <a href="http://pastebin.com/rR4hJGRp" target="_blank" original-href="http://pastebin.com/rR4hJGRp">http://pastebin.com/rR4hJGRp...</a><br>
subroutines.asm: <a href="http://pastebin.com/jURvi5Na" target="_blank" original-href="http://pastebin.com/jURvi5Na">http://pastebin.com/jURvi5Na...</a><br>
data.asm: <a href="http://pastebin.com/DAxGJWky" target="_blank" original-href="http://pastebin.com/DAxGJWky">http://pastebin.com/DAxGJWky...</a><br>
<br>
EDIT: P.S. I promise I will simplify a LOT of the subroutine code tomorrow since I just learned in that Usage file for NESASM that you can create user-defined functions.&#xA0; I am giddy.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__72">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 17, 2012 at 12:34:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Much better! Lets see here...<br>
<br>
You enable the screen not waiting for NMI, which will cause a &quot;jump&quot; the first few frames instead of a clean image straight to the screen.<br>
<br>
You never recognize the NMI except with the intro code and when you go to upload a screen.<br>
<br>
As for the palette problem, I can&apos;t get it to do anything. Code doesn&apos;t look like it would break depending on what was written to the PPU, so good luck with that. <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__73">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 18, 2012 at 11:16:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yikes.  Guess I&apos;ll have to keep looking then. As for the NMI acknowledgement I&apos;m not sure what you mean. Do you mean turning off the screen and then re-enabling?  If so, where else is it helpful to do so?  In reference to the first comment that will be an easy fix. I know what bit does that every time a point is scored. I noticed the flashing myself and just hadn&apos;t fixed it yet.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__74">
                                                        <div class="mdl-card__title"><strong>Jero</strong> posted on 
		
			
				
				Feb 18, 2012 at 11:35:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you turn the screen on whilst the frame is basicly halfway down the screen for example (the nes keeps generating sync signals etc...and stil sends out some video data like the backround colour) it&apos;ll cause it to start rendering the first scanline right there and then. Causing the picture to &quot;jump&quot;. So what you do is you wait for nmi THEN turn the screen on so you don&apos;t get the jump.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__75">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 19, 2012 at 3:56:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Are you saying that changing any of your attributes to any non-zero values are causing problems?  I changed the title attribute to:
<br>
<br>    titleattr:
<br>  .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000
<br>  .db %00000000, %01010101, %01010101, %01010101, %01010101, %01010101, %01010101, %00000000
<br>  .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000
<br>  .db %00000000, %10101010, %10101010, %10101010, %10101010, %10101010, %10101010, %00000000
<br>  .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000
<br>  .db %00000000, %11111111, %11111111, %11111111, %11111111, %11111111, %11111111, %00000000
<br>  .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000
<br>  .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000
<br>
<br>And I didn&apos;t seem to get any errors.  What is your problem, exactly?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__76">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 20, 2012 at 11:12:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I studied this particular tutorial and it finally makes sense.  Basically I was reading the attribute byte like a sprite attribute, so only manipulating the last two bits.  I now understand that there are 8 bits, and split up into 4 2-bit chunks gives one byte control over one block (16x16 pixel section).  For some reason I didn&apos;t fully understand this before.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__77">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 20, 2012 at 11:26:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That &quot;Oh, that&apos;s how it works&quot; moment is always a good one. <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__78">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 21, 2012 at 2:24:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Better late than never!  I remember when the lightbulb came on for this lesson, too.  Welcome to the other side!  Haha.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__79">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Jul 1, 2012 at 3:56:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					alright so I&apos;m having a brain dead moment. I got the background to fully load (haven&apos;t tweeks the attributes as of yet but wil get there soon) but I can&apos;t figure out why at the top it goes halfway with sky, then the bricks start. based on what I&apos;ve read there should be some sky all the way across the top then the next row the bricks would start. can someone please explain to me why this is happening?<br>
<br>
(my basic plan is to encompass the border with bricks when all is said and done. I also realize I&apos;ve got my brick tops and bottoms reversed. will fix later)<br>
<br>
i&apos;ve atached a picture and the code<br>
<br>
--- edit----<br>
<br>
changed the attachment to the one I meant to upload
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__80">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jul 1, 2012 at 6:18:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Protip: Never compare to 0, it&apos;s never needed because there&apos;s a &quot;zero or not 0&quot; condition code. Whe you INX and it wraps to 0, it automagically sets the flag. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Another protip you can use later: Try to count down if it&apos;s to 0. You&apos;ll need to reverse your data but it saves bytes and CPU. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>&#xA0;<br>
<br>
Another normal tip: Stuf inbetween normal labels like:<br>
<br>
Label:<br>
&#xA0; LDA #$20<br>
&#xA0; LDA #$00<br>
LabelLoop:<br>
&#xA0; STA Somewhere<br>
&#xA0; DEX<br>
&#xA0; BPL LabelLoop<br>
AfterLabel:<br>
<br>
can use local labels. Local labels are names so that you can use generic label names like &quot;Loop&quot; everwhere. All you do it put a dot before the label and in between each global label with no period, it&apos;ll use the local one. You also need to put the . in the label name in your code too, but it&apos;s not hard. I&apos;ll give you some code of mine to check out if you need a detailed example.<br>
<br>
As for why the bricks aren&apos;t loading tight, I&apos;m not sure. You&apos;re starting it at the top left and writing it. They should just all be in the first 2 rows since you&apos;re doing 64 (2 rows) of tiles. I&apos;m not looking far into the code though. If you want to try to debug your code, ise FCEUX and open the debugger. On the top right do &quot;set breakpoint&quot; and make it for the PPU, make it memory location $2000 write, and then make it a write. It may catch a bug because of how it looks like it&apos;s writing the tiles, so you may be rewriting them later for some reason. Sorry I couldn&apos;t help too much, good luck. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__81">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Jul 1, 2012 at 6:52:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					thanks for the tips. I was tweaking with the code and ended up deleting it so i decided to DL the one I uploaded. turns out the code I attached was my code from last year that NA kept on file. lol I did realize that in my background 2,3,and 4 sections I had 1 too many .db in there. I had 9 instead of 8 So I think I might have been over loading the RAM or something.<br>
<br>
--------------EDIT--------------<br>
<br>
figured it out. I forgot to reset the high/low latch before engading the background loops.&#xA0; but the extra .db probably didn&apos;t help either. Now to get it to look the way I want.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__82">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Jul 6, 2012 at 8:30:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Alright so I have another question. for some reason all the sky background tiles are pulling from the sprite color palette instead of from the background palette. I can&apos;t seem to figure out why. could someone please go over the code i have and help me understand what&apos;s happening please?<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__83">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jul 6, 2012 at 10:18:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sprite color 0 is never used in any sprite palette and all the color entries that go into $3F00,$3F04,$3F08,$3F0C,$3F10,$3F14,$3F18,$3F1C have to be the same as the background color*, sprites only get 3 colors, it looks like you&apos;re trying to use 4.<br>
<br>
<span style="font-size:8px;">* They don&apos;t have to be unless you know more how the hardware works, but in these tutorials, keep them the same.</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__84">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Jul 6, 2012 at 10:45:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I understand that a sprite gets 3 colors + transparent, and that the colors in the background within a certain area all need to use the same palette. I have the attributes for the background all set to be the same. but for some reason instead of the background having a pale pink color it turns green. I only have green for sprites not the background. and when I change the sprite colors it changes the background. The bricks around the sky are the right color but the sky tile is not. and that&apos;s where I&apos;m getting confused.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__85">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jul 6, 2012 at 11:00:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The sprite palette 0 color isn&apos;t used ever, and you assgning it is screwing with your program because the PPU doesn&apos;t write to $3F10, it writes over $3F00. It has to match the background color as the sprite transparent color writes miror down to the 3F00-3F0F range.<br>
<br>
<div>
	palette:</div>
<div>
	&#xA0; .db $33,$34,$35,$0F, &#xA0;$33,$34,$35,$0F, &#xA0;$33,$34,$35,$0F, &#xA0;$33,$34,$35,$0F &#xA0; ;;background palette</div>
<div>
	&#xA0; .db $1A,$02,$21,$0F, &#xA0;$22,$02,$38,$3C, &#xA0;$22,$1C,$15,$14, &#xA0;$22,$02,$38,$3C &#xA0; ;;sprite palette<br>
	<br>
	Which is 1A and then when you look at a palette cheat sheet, is the color green you&apos;re describing.</div>
<br>
This shold work. Rename the file when including it too, the names not right. I didn&apos;t compile it but I&apos;m fairly confident that this will get the results your after.<br>
<br>
<a href="http://wiki.nesdev.com/w/index.php/Palette" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/Palette">http://wiki.nesdev.com/w/index.php/Palette</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__86">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 7, 2012 at 11:33:38 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It looks to me that you&apos;re telling $2000 to use the wrong palettes for the sprite/background (unless your comments are just wrong).  You should be doing LDA #%10001000 STA $2000, but currently you&apos;re doing LDA #%10010000 STA $2000.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__87">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Jul 7, 2012 at 1:57:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					alright 3Gen, so what you are saying is that the first color in each palette entry needs to match respectively?<br>
<br>
palette:<br>
.db $33,$34,$35,$0F, $33,$34,$35,$0F, $33,$34,$35,$0F, $33,$34,$35,$0F ;;background palette<br>
............^ ............................^................................ ^.............................. ^<br>
............| ..............................|................................ |............................... |<br>
............v ............................v................................ v............................... v<br>
.db $1A,$02,$21,$0F, $22,$02,$38,$3C, $22,$1C,$15,$14, $22,$02,$38,$3C ;;sprite palette<br>
<br>
and KHAN, I Switched those around but it pulled the tile data from the wrong area when that happened. What I have is what was in the example from BB.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__88">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jul 7, 2012 at 2:00:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, basically, that&apos;s the best way to do it. At least the ones at 3F00 and then 3F10 need to, as the 3F10 gets written to 3F00 because 3F10 doesn&apos;t exist basically.
<br>
<br>And if you upload a full zip file of your code that&apos;s not working I&apos;ll fix it up and compile it to make sure it&apos;s right, and tell you what the problems are.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__89">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Jul 7, 2012 at 2:06:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					alright thanks. this was just bugging me. actually my original problem was in the starting pong section but I figured it was because I missed something important in this section. I expanded on it and discovered this problem. So I wanted to make sure i got this understood first. I had to read what you said like 20 times to understand it. but after some sleep it made sense this morning. Thanks for the help. I&apos;ll probably be asking for more help in the next section later today if I can&apos;t figure it out.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__90">
                                                        <div class="mdl-card__title"><strong>y(oYo)</strong> posted on 
		
			
				
				Jul 26, 2013 at 8:01:11 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hello!
<br>
<br>After carefuly reading all this topic&apos;s posts, there is still one thing that confuses me.
<br>I understood that one attribute byte rules a 32*32 pixels square (i.e. 4*4 tiles).
<br>The screen is 32 tiles width, so 256 pixels, which is a multiple of 32 and is fine.
<br>The screen is 30 tiles height, so 240 pixels, which is not a 32 multiple.
<br>So the last 8 bytes of the attribute table would have a part of them that are useless?
<br>
<br>For instance, if my last 8 attributes bytes are :
<br>  .db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000
<br>
<br>Can you confirm those represented by &quot;X&quot; could take either 0 or 1 without consequence ?
<br>  .db %XXXX0000, %XXXX0000, %XXXX0000, %XXXX0000, %XXXX0000, %XXXX0000, %XXXX0000, %XXXX0000
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__91">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jul 26, 2013 at 8:53:24 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>y(oYo)</b></i><br>
	<br>
	For instance, if my last 8 attributes bytes are :<br>
	.db %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000, %00000000<br>
	<br>
	Can you confirm those represented by &quot;X&quot; could take either 0 or 1 without consequence ?<br>
	.db %XXXX0000, %XXXX0000, %XXXX0000, %XXXX0000, %XXXX0000, %XXXX0000, %XXXX0000, %XXXX0000</div>
That&apos;s correct.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__92">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 26, 2013 at 12:09:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I never stopped to think about that.  Fantastic point. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__93">
                                                        <div class="mdl-card__title"><strong>y(oYo)</strong> posted on 
		
			
				
				Jul 27, 2013 at 6:22:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank you very much, it was just something I was wondering before going further in tutorials <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__94">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Oct 15, 2013 at 1:47:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This one was nice and easy. The only thing that gave me problems were the BIN attributes, because I am used to fix them on FCEUX&apos;s hex editor because of my ROM-Hacking knowledge, just like I did there. Load up incorrect tables in the ASM file, fire the .nes file up in FCEUX, fix it with the Hex Editor and voil&#xE0;, you have a road for my little dude. Now to learn quick so I can make pedestrians *makes evil grin, thinks about Death Race*
<br>
<br><a href="http://s1074.photobucket.com/user/KilleRotom/media/softie001_zps59d2ce31.png.html" target="_blank" original-href="http://s1074.photobucket.com/user/KilleRotom/media/softie001_zps59d2ce31.png.html"><img src original-src="http://i1074.photobucket.com/albums/w408/KilleRotom/softie001_zps59d2ce31.png" show-src="scraper/images/softie001_zps59d2ce31.png"></a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__95">
                                                        <div class="mdl-card__title"><strong>Bullseye29</strong> posted on 
		
			
				
				Apr 16, 2015 at 7:11:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi, it&apos;s been a couple of week since I&apos;m following those tutorial, there so great and make me feel close to my dream of making my own NES game week after week. 
<br>
<br>I have a couple of questions, I know that this tutorial is showing how do to generate background/ nametables manually but, you mention that there &apos;&apos;is  Some graphics tools [that] will generate this data&apos;&apos;. I would like to know:
<br>1) do you really do that method manually everytime you make a game or are you actually using a graphics tools like you mention that help you generate your nametable? the point is that I consider myself more an artist than a hard programmer. if you just could show me a program that could help me saving effort of hard coding something that I litteraly don&apos;t see. 
<br>2) If you use that kind of program, does it run on Window 8? or is there any that run on Window 8?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__96">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Apr 16, 2015 at 7:41:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Bullseye29</b></i><br>
	<br>
	Hi, it&apos;s been a couple of week since I&apos;m following those tutorial, there so great and make me feel close to my dream of making my own NES game week after week.<br>
	<br>
	I have a couple of questions, I know that this tutorial is showing how do to generate background/ nametables manually but, you mention that there &apos;&apos;is Some graphics tools [that] will generate this data&apos;&apos;. I would like to know:<br>
	1) do you really do that method manually everytime you make a game or are you actually using a graphics tools like you mention that help you generate your nametable? the point is that I consider myself more an artist than a hard programmer. if you just could show me a program that could help me saving effort of hard coding something that I litteraly don&apos;t see.<br>
	2) If you use that kind of program, does it run on Window 8? or is there any that run on Window 8?</div>
<br>
Unfortunately, you have to program everything yourself. However, you can program tools that help you with that, like compression routines (Metatile-based, AKA 16x16 tiles for example).<br>
I even programmed a program for the NES that makes it easier to make screens, but it involves a lot of programming knowledge to use it unfortunately<br>
<br>
EDIT: Oh lookie! It&apos;s an old thing by me when I did the NN for the first time. Time flies by so fast <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__97">
                                                        <div class="mdl-card__title"><strong>Bullseye29</strong> posted on 
		
			
				
				Apr 16, 2015 at 11:06:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					then, I need know now before going any further, with the knowledge that I can get on the nerdy nights and the rest of programming ressource on Nintendo Age (<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33287" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33287">http://nintendoage.com/forum/mess...</a>) his there any chance that I could done a reel good side scroller on my own?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__98">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 16, 2015 at 11:52:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Bullseye29</b></i><br>
	<br>
	then, I need know now before going any further, with the knowledge that I can get on the nerdy nights and the rest of programming ressource on Nintendo Age (<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33287" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33287">http://nintendoage.com/forum/messageview.cfm?catid=22&amp;th...</a> ) his there any chance that I could done a reel good side scroller on my own?</div>
<br>
As a first game?&#xA0; Definitely not.&#xA0; But the tools are there to get you to the point where you can, if you put forth the effort.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__99">
                                                        <div class="mdl-card__title"><strong>Bullseye29</strong> posted on 
		
			
				
				Apr 17, 2015 at 12:26:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Seriously! thank you both for your answer, I&apos;ll try to go as far as I can! And I won&apos;t let myself being stop if I don&apos;t understand something. I&apos;ve just started posting questions And already got answers, I think I&apos;ll have nice support in here. 
<br>
<br>Thank again KHAN Games and Vectrex280996
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__100">
                                                        <div class="mdl-card__title"><strong>Bullseye29</strong> posted on 
		
			
				
				Apr 22, 2015 at 9:31:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					A last question! is there any way that I could use the patern tables tiles in a image format? 
<br>
<br>I mean, now I fully understand this tutorial, but to proove myself that I really understand it, I want to make a custom background with the tiles of Mario Bros background pattern table/tiles. As a visual support I would like to do something that I see to be accurate. Does some one understand what I mean? 
<br>
<br>I&apos;m not sure if I express really well what I want but I hope some one will.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__101">
                                                        <div class="mdl-card__title"><strong>Bullseye29</strong> posted on 
		
			
				
				Apr 22, 2015 at 9:47:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi, thanks again for all the answer, they were really helpful! 
<br>
<br>I got a very last question. I finally menage to understand very well this tutorial. But as a challenge to myself, I want to make a background out of my imagination with the background tiles of the Mario bros. file. 
<br>
<br>My question is, Is there a way that I could use the tiles/background patern table from the Mario bros file, and make a visual support with it. The goal is to make a visal reference that help me to be more accurate, like a image(jpeg or something like that). I know its a lot of trouble but I think it could be very helpful to me.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__102">
                                                        <div class="mdl-card__title"><strong>Bullseye29</strong> posted on 
		
			
				
				Apr 22, 2015 at 9:48:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Gosh sorry for double post, I thaught it didn&apos;t appear so I make another post. sorry again
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__103">
                                                        <div class="mdl-card__title"><strong>Mog</strong> posted on 
		
			
				
				Apr 22, 2015 at 10:47:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Bullseye29</b></i><br>
	<br>
	My question is, Is there a way that I could use the tiles/background patern table from the Mario bros file, and make a visual support with it. The goal is to make a visal reference that help me to be more accurate, like a image(jpeg or something like that). I know its a lot of trouble but I think it could be very helpful to me.</div>
<br>
<br>
What do you mean by visual support?&#xA0; What are you trying to be more accurate in/with or what exactly are you having trouble with? What are you trying to accomplish overall with this?<br>
<br>
The way I understand your question, the program YY-chr does what I think you are asking about.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__104">
                                                        <div class="mdl-card__title"><strong>Bullseye29</strong> posted on 
		
			
				
				Apr 22, 2015 at 10:59:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mog</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Bullseye29</b></i><br>
		<br>
		My question is, Is there a way that I could use the tiles/background patern table from the Mario bros file, and make a visual support with it. The goal is to make a visal reference that help me to be more accurate, like a image(jpeg or something like that). I know its a lot of trouble but I think it could be very helpful to me.</div>
	<br>
	<br>
	What do you mean by visual support?&#xA0; What are you trying to be more accurate in or what exactly are you having trouble with? What are you trying to accomplish overall with this?<br>
	<br>
	The way I understand your question, the program YY-chr does what I think you are asking about.</div>
I mean, instead of memories every tiles number, I&apos;ll make a complete picture (like a puzzle) of what I would like my background to look alike. Best exemple of what I&apos;m looking for is Pyxel Edit&#xA0; <a href="http://pyxeledit.com/images/tileExplanation.png" target="_blank" original-href="http://pyxeledit.com/images/tileExplanation.png">http://pyxeledit.com/images/tileE...</a><br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__105">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Apr 22, 2015 at 11:04:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					^___ I&apos;m not too sure I understood you question, and my English is rather poor; however I try (@all if my answer is not good, just correct it with the correct answer, there is no need to mock me, I&apos;m just trying to help):
<br>
<br>- if you will make a background of 16x16px areas (ie. 2x2 tiles) then you might be interested in the MRN article on metatiles, look for it in the sticky thread of The Brewery.
<br>
<br>- I don&apos;t think the tool you ask for exists (by the way: IMO jpg would definitely be a wrong format, since it is not loseless compression: bmp, gif or png would be definitely more correct), but Shiru made a tool you can found in NESDev forum (I think it must be a great tool, but I have hard time to fully understand how it work exactly, so I basically used it once to see how many tiles a third party image which was given to me to include in a game would take, and I used something like Tile Layer Pro to actually import the image in the CHR).
<br>
<br>- If you make the background of 8x8px areas, this is a way you can do it without using other tools: make a big data table of the background on your file to load, like:
<br>
<br>00 00 00 00 00 00 00 00 00 00 00 ...
<br>
<br>long 32 tiles repeated x 30 lines. This are the 960 Bytes to load your background. Then you edit it tile by tile, or row by row, reassemble the code, and verify in an emulator that it looks correct so far; you can take screen shots of the previous &quot;version&quot;, to help you editing the file for the next version. It is quickly boring and highly time consuming, however, it works I guess.
<br>
<br>Again, I&apos;m not even sure I understood the question. I&apos;m confident other members will provide you better feedback.
<br>
<br>Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__106">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 23, 2015 at 12:03:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Download NES Screen Tool, found here:
<br>
<br><a href="scraper/files/nesst.zip" target="_blank" original-href="https://shiru.untergrund.net/files/nesst.zip">https://shiru.untergrund.net/file...</a>
<br>
<br>Open the CHR file you want to use and then click on the tile you want to use, then click on the position you&apos;d like to use it.  When you&apos;re done, you can export the nametable and attribute data and import them into your assembly file with the use of &quot;.incbin &quot;filename&quot;.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__107">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Apr 23, 2015 at 5:08:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	When you&apos;re done,<strong> you can export the nametable and attribute data and import them into your assembly file</strong> with the use of &quot;.incbin &quot;filename&quot;.</div>
<br>
Which explains why I hardly feel the need for such features, and brings an interesting question:<br>
<br>
<strong>How many NES homebrewers actually save a full nametable in the ROM for each background in the game?</strong><br>
<br>
I mean, in my ROMs <u>I describe the nametables, I don&apos;t save them Byte by Byte</u>.<br>
<br>
For instance, let say a game has the backgrounds sharing few identical lines. In this case I store a compressed array of bytes (fi. 32 00 for an empty line, if the whole 00 tile is &quot;transparent color&quot;) and give each line an ID number (fi. 00), then describe the background as a compressed array of 30 lines IDs (fi. 30 00 for an all empty background made of 30 all &quot;transparent color&quot; lines made each of 32 &quot;transparent color&quot; tiles). If instead the backgrounds share areas different than lines, then I code a compressing / decompressing routine handling these &quot;screen areas&quot; instead of lines. And so on. And this also for attributes, of course. This also because often little portions of the backgrounds change during game.<br>
<br>
I never find myself storing a whole nametable in a ROMs, and I never used in different games the same compressing / decompressing routine to describe backgrounds. I always adapt the compression method to the game structure and needs, with the goal of avoiding redundancy in the ROM and to save space. The method used depends on the game.<br>
<br>
<strong>@all </strong><br>
So now I wonder: it is this common, or it is just me to prefer store the backgrounds data in some fractioned and compressed way rather than have, for each single background, a full nametable of 960 Bytes + attributes Bytes?<br>
<br>
<u>I&apos;m really curious on the subject now!</u><br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__108">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Apr 23, 2015 at 7:54:34 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I store everything as full backgrounds, using what I learned in MRN&apos;s compression tutorials (though I took out the repeat function since the costs outweighed the benefits at this time; meaning I like to see all of the tiles at once). Except for the status bar, which is loaded separately, and therefore saves six (three compressed) lines of data in memory per room. However, for the 64 rooms that I have up and running it only took a couple of days to program them in, and I enjoyed having the level of control that I did. But that&apos;s just me, and I&apos;m sure things will change in the future as I continue to learn.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__109">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 23, 2015 at 9:52:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	<strong>How many NES homebrewers actually save a full nametable in the ROM for each background in the game?</strong><br>
	&#xA0;</div>
<br>
The compression method you&apos;re describing is definitely the better way to go, and I use this method for gameplay background data and other areas.&#xA0; But for things like Title screens, credit screens, etc, I use the method I described.&#xA0; It&apos;s super easy to go back, open the nametable in NES Screen Tool, make a change, and export the new background.&#xA0; Then I never even have to go into my code to update it.&#xA0; It&apos;s already changed automatically.<br>
<br>
And it makes a lot more sense to try to explain this method to a beginner.&#xA0; Someone who is just trying to figure things out would have a hard time trying to grasp background compression.&#xA0; That&apos;s something that is adapted later.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__110">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Apr 23, 2015 at 11:39:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The nice thing about NES Screen Tool is that it actually supports RLE compression out of the box. Create the nametable as you normally would, but when saving it select &quot;RLE packed&quot; from the file type list. This will produce a .RLE file, which you can .incbin in to your project, and use the routine from rle.asm (also included with NES Screen Tool) to decompress the data. RLE compression gets rid of most of the redundancy in a nametable.
<br>
<br>The .RLE files can also be opened in NES Screen Tool as nametables just like normal uncompressed nametables.
<br>
<br>user: You have to weigh whether making a custom compression/decompression routine for each scenario is beneficial. It may make your data smaller than e.g. RLE could, but by how much, and is it worth the extra time it takes to develop the data format and the algorithm (and possibly to layout the compressed data by hand)?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__111">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Apr 23, 2015 at 12:28:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
<br>
<strong>How many NES homebrewers actually save a full nametable in the ROM for each background in the game?</strong></div>
If you are not targetting cart production, then ROM space is completely free so I don&apos;t bother with compression.<br>
<br>
If you are targetting carts, then I only use compression to hit important ROM sizes like 128KB and 512KB. &#xA0;The same chip is used for 80KB and 128KB so smaller data frequently doesn&apos;t matter. &#xA0;I have done compression for CHR (8KB-&gt;3-5KB) and RLE for dragon warrior type maps, but I don&apos;t think I have done it for nametables.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__112">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Apr 23, 2015 at 12:47:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					@Kevin, bunnyboy, Kalle, Beau
<br>Thank you, really interesting reading from some more experienced homebrewers. Exactly what I was looking for as answers to that questions. I consider myself way more talented as a game designer (game concepts, mechanics, and such things) rather than as a good programmer (I learned to program because is needed to develop an idea I have for a game), so when more experienced programmers talk, I am always interested into it, no matter that I&apos;m already skilled enough to understand, or I still need to chew on what I am explained a bit more to fully understand what I am told.
<br>
<br>So, thank you for your detailed opinions and proposed alternatives, I&apos;ll surely care about read them more then once and understand further the advantages/disadvantages of each. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>Nice to know that anyways there is not a &quot;correct way&quot;: it seems, from these first replies, that it is more like &quot;it depends&quot; on various factors, as often is in many creative fields.
<br>
<br>@Kevin
<br>&quot;&quot;&quot; And it makes a lot more sense to try to explain this method to a beginner.  Someone who is just trying to figure things out would have a hard time trying to grasp background compression.  That&apos;s something that is adapted later. &quot;&quot;&quot;
<br>
<br>Indeed. I was talking now on a right next level, for my own interest, giving as done that your previous link fully solved Bullseye needs (which is what I guess). <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>Thanks All! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>- Jack
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__113">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Apr 23, 2015 at 1:47:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I use a home made RLE compression routine to compress my screens. I use it in all my games.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__114">
                                                        <div class="mdl-card__title"><strong>Bullseye29</strong> posted on 
		
			
				
				Apr 24, 2015 at 11:13:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					@KHANS games @USER thanks to both of you! I&apos;m very pleased by all the supports I get here! Thanks again!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__115">
                                                        <div class="mdl-card__title"><strong>sempressimo</strong> posted on 
		
			
				
				Nov 3, 2015 at 1:54:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am using the code in these tutorials to load a full screen background. It works nicely, now I wan to load another &quot;room&quot;, (i.e. load the tiles again into the nametable). I repurposed the routine into a subrotine, but the second time I call it, the new &quot;room&quot; won&apos;t load properly, instead I get a garbage version of the room;<br>
<br>
LoadBackground:<br>
<br>
&#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; read PPU status to reset the high/low latch<br>
&#xA0; LDA #$20<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $2000 address<br>
&#xA0; LDA #$00<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $2000 address<br>
<br>
&#xA0; ;LDX room_number&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; grab the actual room pointer<br>
&#xA0;<br>
&#xA0; LDA #$00<br>
&#xA0; STA pointerLo&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; put the low byte of the address of background into pointer<br>
&#xA0; LDA #HIGH(Room1)<br>
&#xA0; STA pointerHi&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; put the high byte of the address into pointer<br>
&#xA0;<br>
&#xA0; LDX #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start at pointer + 0<br>
&#xA0; LDY #$00<br>
OutsideLoop:<br>
&#xA0;<br>
InsideLoop:<br>
&#xA0; LDA [pointerLo], y&#xA0; ; copy one background byte from address in pointer plus Y<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; this runs 256 * 4 times<br>
&#xA0;<br>
&#xA0; INY&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; inside loop counter<br>
&#xA0; CPY #$00<br>
&#xA0; BNE InsideLoop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; run the inside loop 256 times before continuing down<br>
&#xA0;<br>
&#xA0; INC pointerHi&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; low byte went 0 to 256, so high byte needs to be changed now<br>
&#xA0;<br>
&#xA0; INX<br>
&#xA0; CPX #$04<br>
&#xA0; BNE OutsideLoop&#xA0;&#xA0;&#xA0;&#xA0; ; run the outside loop 256 times before continuing down&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
<br>
&#xA0; LDA #%10010000&#xA0;&#xA0; ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1<br>
&#xA0; STA $2000<br>
<br>
&#xA0; LDA #%00011110&#xA0;&#xA0; ; enable sprites, enable background, no clipping on left side<br>
&#xA0; STA $2001<br>
&#xA0;<br>
&#xA0; RTS<br>
<br>
Can this code be used to re-load the background or I am missing something?<br>
<br>
Also can anyone point me to a tutorial on how to show a main screen, and the load the game level, as it should be the same concept I am trying to get working.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__116">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 3, 2015 at 2:31:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>sempressimo</b></i><br>
<br>
I am using the code in these tutorials to load a full screen background. It works nicely, now I wan to load another &quot;room&quot;, (i.e. load the tiles again into the nametable). I repurposed the routine into a subrotine, but the second time I call it, the new &quot;room&quot; won&apos;t load properly, instead I get a garbage version of the room;<br>
<br>
LoadBackground:<br>
<br>
&#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; read PPU status to reset the high/low latch<br>
&#xA0; LDA #$20<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $2000 address<br>
&#xA0; LDA #$00<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $2000 address<br>
<br>
&#xA0; ;LDX room_number&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; grab the actual room pointer<br>
&#xA0;<br>
&#xA0; LDA #$00<br>
&#xA0; STA pointerLo&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; put the low byte of the address of background into pointer<br>
&#xA0; LDA #HIGH(Room1)<br>
&#xA0; STA pointerHi&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; put the high byte of the address into pointer<br>
&#xA0;<br>
&#xA0; LDX #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start at pointer + 0<br>
&#xA0; LDY #$00<br>
OutsideLoop:<br>
&#xA0;<br>
InsideLoop:<br>
&#xA0; LDA [pointerLo], y&#xA0; ; copy one background byte from address in pointer plus Y<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; this runs 256 * 4 times<br>
&#xA0;<br>
&#xA0; INY&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; inside loop counter<br>
&#xA0; CPY #$00<br>
&#xA0; BNE InsideLoop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; run the inside loop 256 times before continuing down<br>
&#xA0;<br>
&#xA0; INC pointerHi&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; low byte went 0 to 256, so high byte needs to be changed now<br>
&#xA0;<br>
&#xA0; INX<br>
&#xA0; CPX #$04<br>
&#xA0; BNE OutsideLoop&#xA0;&#xA0;&#xA0;&#xA0; ; run the outside loop 256 times before continuing down&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
<br>
&#xA0;<s> LDA #%10010000&#xA0;&#xA0; ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1<br>
&#xA0; STA $2000</s><br>
<br>
&#xA0;<strong> LDA #%00011110&#xA0;&#xA0; ; enable sprites, enable background, no clipping on left side<br>
&#xA0; STA $2001</strong><br>
&#xA0;<br>
&#xA0; RTS<br>
<br>
Can this code be used to re-load the background or I am missing something?<br>
<br>
Also can anyone point me to a tutorial on how to show a main screen, and the load the game level, as it should be the same concept I am trying to get working.</div>
Let your NMI enable your PPU. Don&apos;t do this in the main code. Doing it in the main code will make it look like garbage (what you are seeing).<br>
&#xA0;&#xA0; LDA #%00011110&#xA0;&#xA0; ; enable sprites, enable background, no clipping on left side<br>
&#xA0;&#xA0; STA $2001<br>
<br>
Here is what my NMI looks like:<br>
<strong>LDA #%10010000&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1<br>
&#xA0;STA $2000<br>
&#xA0;<br>
LDA EnablePPUFlag&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Only Enable the PPU when this flag is enabled in the code.<br>
BEQ .SKIP<br>
&#xA0;&#xA0;&#xA0; LDA #%00011110&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;enable sprites, enable background, no clipping on left side<br>
&#xA0;&#xA0;&#xA0; STA $2001<br>
&#xA0;&#xA0;&#xA0; DEC EnablePPUFlag<br>
&#xA0; .SKIP:<br>
<br>
(This is a Subroutine in my main code. The NMI calls this when I tell it to with the EnablePPUFlag)</strong><br>
<strong>EnablePPU:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&lt;--------------------***********Subroutine called by the NMI to turn on the PPU<br>
&#xA0; LDA #%00011110&#xA0;&#xA0; ; enable sprites, enable background, no clipping on left side<br>
&#xA0; STA $2001<br>
&#xA0; RTS</strong><br>
<br>
<br>
-----------<br>
This is what my code looks like.<br>
<br>
<strong>LDA #$00&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;&lt;-------------------------**********Turn off the PPU in the Main Code First<br>
STA $2001<br>
<br>
&#xA0; LDA #LOW(PlayingBackground)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&lt;-----------------**********Load background routine*************<br>
&#xA0; STA BackgroundAddr<br>
&#xA0; LDA #HIGH(PlayingBackground)<br>
&#xA0; STA BackgroundAddr+1<br>
&#xA0; JSR LoadBackground<br>
&#xA0;<br>
&#xA0; LoadBackground:<br>
&#xA0; LDA $2002<br>
&#xA0; LDA #$20<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $2000 address<br>
&#xA0; LDA #$00<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $2000 address<br>
&#xA0;<br>
&#xA0; LDX #$04&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Loop X 4 times<br>
&#xA0; LDY #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Loop Y 256 times<br>
LoadBackgroundsLoop:<br>
&#xA0; LDA [BackgroundAddr],y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Load background from table in the pointer<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Write to screen<br>
&#xA0; INY<br>
&#xA0; BNE LoadBackgroundsLoop<br>
; Outer loop<br>
&#xA0; INC BackgroundAddr+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; increment high byte of address backg to next 256 byte chunk<br>
&#xA0; DEX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; one chunk done so X = X - 1.<br>
&#xA0; BNE LoadBackgroundsLoop&#xA0;&#xA0; ; if X isn&apos;t zero, do again<br>
&#xA0; LoadBackGroundDone: &#xA0;<br>
&#xA0; RTS<br>
&#xA0;<br>
&#xA0; INC EnablePPUFlag&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&lt;--------------********This flag will tell the NMI to turn PPU back on*******<br>
<br>
<br>
<br>
---------------------------------------------------------</strong><br>
SIDE NOTE: You don&apos;t have to do anything with this code when turning the PPU on and off. That code only belongs in the PPU<br>
&#xA0; LDA #%10010000&#xA0;&#xA0; ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1<br>
&#xA0; STA $2000<br>
<br>
<br>
<br>
Hope that made sense. Good luck
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__117">
                                                        <div class="mdl-card__title"><strong>sempressimo</strong> posted on 
		
			
				
				Nov 3, 2015 at 3:28:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks, I will work on this <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__118">
                                                        <div class="mdl-card__title"><strong>sempressimo</strong> posted on 
		
			
				
				Nov 6, 2015 at 8:58:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>sempressimo</b></i><br>
<br>
I am using the code in these tutorials to load a full screen background. It works nicely, now I wan to load another &quot;room&quot;, (i.e. load the tiles again into the nametable). I repurposed the routine into a subrotine, but the second time I call it, the new &quot;room&quot; won&apos;t load properly, instead I get a garbage version of the room;<br>
<br>
LoadBackground:<br>
<br>
&#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; read PPU status to reset the high/low latch<br>
&#xA0; LDA #$20<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $2000 address<br>
&#xA0; LDA #$00<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $2000 address<br>
<br>
&#xA0; ;LDX room_number&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; grab the actual room pointer<br>
&#xA0;<br>
&#xA0; LDA #$00<br>
&#xA0; STA pointerLo&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; put the low byte of the address of background into pointer<br>
&#xA0; LDA #HIGH(Room1)<br>
&#xA0; STA pointerHi&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; put the high byte of the address into pointer<br>
&#xA0;<br>
&#xA0; LDX #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start at pointer + 0<br>
&#xA0; LDY #$00<br>
OutsideLoop:<br>
&#xA0;<br>
InsideLoop:<br>
&#xA0; LDA [pointerLo], y&#xA0; ; copy one background byte from address in pointer plus Y<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; this runs 256 * 4 times<br>
&#xA0;<br>
&#xA0; INY&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; inside loop counter<br>
&#xA0; CPY #$00<br>
&#xA0; BNE InsideLoop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; run the inside loop 256 times before continuing down<br>
&#xA0;<br>
&#xA0; INC pointerHi&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; low byte went 0 to 256, so high byte needs to be changed now<br>
&#xA0;<br>
&#xA0; INX<br>
&#xA0; CPX #$04<br>
&#xA0; BNE OutsideLoop&#xA0;&#xA0;&#xA0;&#xA0; ; run the outside loop 256 times before continuing down&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
<br>
&#xA0;<s> LDA #%10010000&#xA0;&#xA0; ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1<br>
&#xA0; STA $2000</s><br>
<br>
&#xA0;<strong> LDA #%00011110&#xA0;&#xA0; ; enable sprites, enable background, no clipping on left side<br>
&#xA0; STA $2001</strong><br>
&#xA0;<br>
&#xA0; RTS<br>
<br>
Can this code be used to re-load the background or I am missing something?<br>
<br>
Also can anyone point me to a tutorial on how to show a main screen, and the load the game level, as it should be the same concept I am trying to get working.</div>
Let your NMI enable your PPU. Don&apos;t do this in the main code. Doing it in the main code will make it look like garbage (what you are seeing).<br>
&#xA0;&#xA0; LDA #%00011110&#xA0;&#xA0; ; enable sprites, enable background, no clipping on left side<br>
&#xA0;&#xA0; STA $2001<br>
<br>
Here is what my NMI looks like:<br>
<strong>LDA #%10010000&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1<br>
&#xA0;STA $2000<br>
&#xA0;<br>
LDA EnablePPUFlag&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Only Enable the PPU when this flag is enabled in the code.<br>
BEQ .SKIP<br>
&#xA0;&#xA0;&#xA0; LDA #%00011110&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;enable sprites, enable background, no clipping on left side<br>
&#xA0;&#xA0;&#xA0; STA $2001<br>
&#xA0;&#xA0;&#xA0; DEC EnablePPUFlag<br>
&#xA0; .SKIP:<br>
<br>
(This is a Subroutine in my main code. The NMI calls this when I tell it to with the EnablePPUFlag)</strong><br>
<strong>EnablePPU:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&lt;--------------------***********Subroutine called by the NMI to turn on the PPU<br>
&#xA0; LDA #%00011110&#xA0;&#xA0; ; enable sprites, enable background, no clipping on left side<br>
&#xA0; STA $2001<br>
&#xA0; RTS</strong><br>
<br>
<br>
-----------<br>
This is what my code looks like.<br>
<br>
<strong>LDA #$00&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;&lt;-------------------------**********Turn off the PPU in the Main Code First<br>
STA $2001<br>
<br>
&#xA0; LDA #LOW(PlayingBackground)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&lt;-----------------**********Load background routine*************<br>
&#xA0; STA BackgroundAddr<br>
&#xA0; LDA #HIGH(PlayingBackground)<br>
&#xA0; STA BackgroundAddr+1<br>
&#xA0; JSR LoadBackground<br>
&#xA0;<br>
&#xA0; LoadBackground:<br>
&#xA0; LDA $2002<br>
&#xA0; LDA #$20<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $2000 address<br>
&#xA0; LDA #$00<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $2000 address<br>
&#xA0;<br>
&#xA0; LDX #$04&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Loop X 4 times<br>
&#xA0; LDY #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Loop Y 256 times<br>
LoadBackgroundsLoop:<br>
&#xA0; LDA [BackgroundAddr],y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Load background from table in the pointer<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Write to screen<br>
&#xA0; INY<br>
&#xA0; BNE LoadBackgroundsLoop<br>
; Outer loop<br>
&#xA0; INC BackgroundAddr+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; increment high byte of address backg to next 256 byte chunk<br>
&#xA0; DEX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; one chunk done so X = X - 1.<br>
&#xA0; BNE LoadBackgroundsLoop&#xA0;&#xA0; ; if X isn&apos;t zero, do again<br>
&#xA0; LoadBackGroundDone: &#xA0;<br>
&#xA0; RTS<br>
&#xA0;<br>
&#xA0; INC EnablePPUFlag&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&lt;--------------********This flag will tell the NMI to turn PPU back on*******<br>
<br>
<br>
<br>
---------------------------------------------------------</strong><br>
SIDE NOTE: You don&apos;t have to do anything with this code when turning the PPU on and off. That code only belongs in the PPU<br>
&#xA0; LDA #%10010000&#xA0;&#xA0; ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1<br>
&#xA0; STA $2000<br>
<br>
<br>
<br>
Hope that made sense. Good luck</div>
Thanks Mega Mario Man, now I have room switching working. I do get a quick black flash when switching, I know is because I am turning on and off the PPU, just wondering if this is the standard way or if there is a way around this?<br>
<br>
Also, if I want to update just some background tiles, like the score for example, can I just update the value in my backgrounds .db(s)&#xA0;directly and that is it? Or does the PPU has to be turned off for this also?<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-6__119">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 6, 2015 at 9:57:48 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>sempressimo</b></i><br>
<br>
Thanks Mega Mario Man, now I have room switching working. I do get a quick black flash when switching, I know is because I am turning on and off the PPU, just wondering if this is the standard way or if there is a way around this?<br>
<br>
Also, if I want to update just some background tiles, like the score for example, can I just update the value in my backgrounds .db(s)&#xA0;directly and that is it? Or does the PPU has to be turned off for this also?<br>
<br>
&#xA0;</div>
<br>
Unfortunately, you are going to get the slight moment of black as the PPU is off at that time. When trying to render that many background tiles at one time, you have to disable the PPU.<br>
<br>
For shorter lengths, the PPU does not need to be disabled, however, you still have to load the tiles during the NMI. I do this all of the time, especially in my current game I&apos;m writing. These is only 1 8x8 sprite in the game, and its just an arrow to point to who&apos;s turn it is.<br>
<br>
There is a spot in the game where I write 256 tiles to the background (1/4 of the screen) and I do turn off the PPU for that.<br>
<br>
Here is some code from my current game, I never disable the PPU for any of those .db tables:<br>
<br>
&#xA0;LDA #$05<br>
&#xA0; STA TEXTLENGTH&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;The length of the text being written to the screen (number of characters being written)<br>
&#xA0;<br>
&#xA0; LDA #$0E<br>
&#xA0; STA TEXTLOWBYTE &#xA0;<br>
&#xA0; LDA #$21<br>
&#xA0; STA TEXTHIGBYTE<br>
&#xA0;<br>
&#xA0; LDA #LOW(PauseText)<br>
&#xA0; STA TextPointer<br>
&#xA0; LDA #HIGH(PauseText)<br>
&#xA0; STA TextPointer+1<br>
&#xA0;<br>
&#xA0; JSR LoadText<br>
--------------------------------------------------------------------------------------------<br>
LoadText:<br>
&#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; read PPU status to reset the high/low latch<br>
&#xA0; LDA TEXTHIGBYTE<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte<br>
&#xA0; LDA TEXTLOWBYTE<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte<br>
&#xA0; LDY #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start y out at 0<br>
<br>
LoadTextLoop:<br>
&#xA0; LDA [TextPointer], y&#xA0;&#xA0;&#xA0;&#xA0; ; load data from address (background + the value in y)<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write to PPU<br>
&#xA0; INY&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ; y = y + 1<br>
&#xA0; CPY TEXTLENGTH&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare Y to TEXTLENGTH<br>
&#xA0; BNE LoadTextLoop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Branch to LoadTextLoop if compare was Not Equal to zero<br>
&#xA0; RTS<br>
&#xA0;<br>
PauseText:<br>
&#xA0; .db $19,$0A,$1E,$1C,$0E&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;PAUSE<br>
UnDrawPauseText:<br>
&#xA0; .db $24,$24,$24,$24,$24,$24,$24,$24&#xA0;&#xA0;&#xA0;&#xA0; ;Undraw Pause<br>
MissText:<br>
&#xA0; .db $16,$12,$1C,$1C&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;MISS<br>
Hit1Text:<br>
&#xA0; .db $11,$12,$1D,$24,$01&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;HIT 1<br>
Hit2Text:<br>
&#xA0; .db $11,$12,$1D,$24,$02&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;HIT 2<br>
Hit3Text:<br>
&#xA0; .db $11,$12,$1D,$24,$03&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;HIT 3
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>


                <div class="spacer"></div>

                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="main_tutorial-7">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">7: 子程序，游戏布局，Pong游戏</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8172" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8172">Previous Week</a> - Backgrounds<div><br></div><div><span class="Apple-style-span" style="font-weight: bold; ">This Week:</span> &#xA0;Most of this lesson is about how to organize and structure your game. &#xA0;Subroutines and game states help arrange the code for easier reading and reuse of code. &#xA0;</div><div><br></div><div><br></div><div><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; "><b><span class="Apple-style-span" style="font-size: medium; ">Variables</span></b></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">As covered in week 1, variables are data stored in RAM that you can change any time.&#xA0; The sprite data in RAM is all variables.&#xA0; You will need more variables for keeping track of things like the score in the game.&#xA0; To do that you first need to tell NESASM where in RAM to put the variable.&#xA0; This is done using the .rsset and .rs directives.&#xA0; First .rsset is used to set the starting address of the variable.&#xA0; Then .rs is used to reserve space.&#xA0; Usually just 1 byte is reserved, but you can have as much as you want.&#xA0; Each time you do a .rs the address gets incremented so you don&apos;t need to do .rsset again.</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; .rsset $0000&#xA0; &#xA0; ;put variables starting at 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; score1 &#xA0; .rs 1&#xA0; ;put score for player 1 at $0000</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; score2 &#xA0; .rs 1&#xA0; ;put score for player 2 at $0001</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; buttons1 .rs 1&#xA0; ;put controller data for player 1 at $0002</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; buttons2 .rs 1&#xA0; ;put controller data for player 2 at $0003</span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">Once you set the address for the variable, you do not need to know the address anymore.&#xA0; You can just reference it using the variable name you created.&#xA0; You can insert more variables above the current ones and the assembler will automatically recalculate the addresses.</span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><br></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><span class="Apple-style-span" style="font-size: 16px; font-weight: bold; ">Constants</span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><span class="Apple-style-span" style="font-size: 16px; font-weight: bold; "><span class="Apple-style-span" style="font-size: 12px; font-weight: normal; ">Constants are numbers that you do not change.&#xA0; They are just used to make your code easier to read.&#xA0; In Pong an example of a constant would be the position of the outer walls.&#xA0; You will need to compare the ball position to the walls to make the ball bounce, but the walls do not change so they are good constants.&#xA0; Doing a compare to LEFTWALL is easier to read and understand than a comparison to $F6.</span></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">To declare constants you use the = sign:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; color: rgb(0, 116, 0); "><span>&#xA0; RIGHTWALL&#xA0; &#xA0; &#xA0; = $</span><span>02</span><span>&#xA0;</span><span style="letter-spacing: 0px; ">; when ball reaches one of these, do something</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; TOPWALL&#xA0; &#xA0; &#xA0; &#xA0; = $</span><span>20</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; BOTTOMWALL &#xA0; &#xA0; = $D8</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LEFTWALL &#xA0; &#xA0; &#xA0; = $F6</span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">The assembler will then do a find/replace when building your code.</span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><br><span style="letter-spacing: 0px; "></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; "><b><span class="Apple-style-span" style="font-size: medium; ">Subroutines</span></b></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">As your program gets larger, you will want subroutines for organization and to reuse code.&#xA0; Instead of progressing linearly down your code, a subroutine is a block of code located somewhere else that you jump to, then return from.&#xA0; The subroutine can be called at any time, and used as many times as you want.&#xA0; Here is what some code looks like without subroutines:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">RESET:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; SEI&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; disable IRQs</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; CLD&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; disable decimal mode</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">vblankwait1: &#xA0; &#xA0; &#xA0; ; First wait for vblank to make sure PPU is ready</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; BIT $2002</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; BPL vblankwait1</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">clrmem:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA #$FE</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; STA $0200, x</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; INX</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; BNE clrmem</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; ">&#xA0;</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">vblankwait2:&#xA0; &#xA0; &#xA0; ; Second wait for vblank, PPU is ready after this</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; BIT $2002</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; BPL vblankwait2</span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">Notice that the vblankwait is done twice, so it is a good choice to turn into a subroutine.&#xA0; First the vblankwait code is moved outside the normal linear flow:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">vblankwait:&#xA0; &#xA0; &#xA0; ; wait for vblank</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; BIT $2002</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; BPL vblankwait</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">RESET:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; SEI&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; disable IRQs</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; CLD&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; disable decimal mode</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">clrmem:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA #$FE</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; STA $0200, x</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; INX</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; BNE clrmem</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">Then that code needs to be called, so the JSR (Jump to SubRoutine) instruction is where the vblankwait code used to be:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">RESET:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; SEI&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; disable IRQs</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; CLD&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; disable decimal mode</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; JSR vblankwait&#xA0; ;;jump to vblank wait #1</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">clrmem:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA #$FE</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; STA $0200, x</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; INX</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; BNE clrmem</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; JSR vblankwait&#xA0; ;; jump to vblank wait again</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">And then when the subroutine has finished, it needs to return back to the spot it was called from.&#xA0; This is done with the RTS (ReTurn from Subroutine) instruction.&#xA0; The RTS will jump back to the next instruction after the JSR:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0; &#xA0; vblankwait:&#xA0; &#xA0; &#xA0; ; wait for vblank&#xA0; &lt;--------</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0; &#xA0; &#xA0; BIT $2002&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; \</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0; &#xA0; &#xA0; BPL vblankwait&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; |</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;----- RTS &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; |</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">/&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; |</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">|&#xA0; &#xA0; RESET:&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; |</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">|&#xA0; &#xA0; &#xA0; SEI&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; disable IRQs &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; |</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">|&#xA0; &#xA0; &#xA0; CLD&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; disable decimal mode &#xA0; &#xA0; &#xA0; &#xA0; |</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">|&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; |</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">|&#xA0; &#xA0; &#xA0; JSR vblankwait&#xA0; ;;jump to vblank wait #1 --/</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">|</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">\--&gt; clrmem:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; LDA #$FE</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; STA $0200, x</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; INX</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; BNE clrmem</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; JSR vblankwait&#xA0; ;; jump to vblank wait again, returns here</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; "><b><span class="Apple-style-span" style="font-size: medium; ">Better Controller Reading</span></b></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">Now that you can set up subroutines, you can do much better controller reading.&#xA0; Previously the controller was read as it was processed.&#xA0; With multiple game states, that would mean many copies of the same controller reading code.&#xA0; This is replaced with one controller reading subroutine that saves the button data into a variable.&#xA0; That variable can then be checked in many places without having to read the whole controller again.</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">ReadController:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA #$01</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; STA $4016</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA #$00</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; STA $4016</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDX #$08</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">ReadControllerLoop:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LDA $4016</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; LSR A &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; bit0 -&gt; Carry</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; ROL buttons &#xA0; &#xA0; ; bit0 &lt;- Carry</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; DEX</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; BNE ReadControllerLoop</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; RTS</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 11px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">This code uses two new instructions.&#xA0; The first is LSR (Logical Shift Right).&#xA0; This takes each bit in A and shifts them over 1 position to the right.&#xA0; Bit 7 is filled with a 0, and bit 0 is shifted into the Carry flag.</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">bit number&#xA0; &#xA0; &#xA0; 7 6 5 4 3 2 1 0&#xA0; carry</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">original data &#xA0; 1 0 0 1 1 0 1 1&#xA0; 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; \ \ \ \ \ \ \&#xA0; \</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; \ \ \ \ \ \ \&#xA0; \&#xA0;</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">shifted data&#xA0; &#xA0; 0 1 0 0 1 1 0 1&#xA0; 1</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">Each bit position is a power of 2, so LSR is the same thing as divide by 2.</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">The next new instruction is ROL (ROtate Left) which is the opposite of LSR.&#xA0; Each bit is shifted to the left by one position.&#xA0; The Carry flag is put into bit 0.&#xA0; This is the same as a multiply by 2.</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">These instructions are used together in a clever way for controller reading.&#xA0; When each button is read, the button data is in bit 0.&#xA0; Doing the LSR puts the button data into Carry.&#xA0; Then the ROL shifts the previous button data over and puts Carry back to bit 0.&#xA0; The following diagram shows the values of Accumulator and buttons data at each step of reading the controller:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; Accumulator &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; buttons data</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">bit: &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 7&#xA0; 6&#xA0; 5&#xA0; 4&#xA0; 3&#xA0; 2&#xA0; 1&#xA0; 0&#xA0; Carry &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 7&#xA0; 6&#xA0; 5&#xA0; 4&#xA0; 3&#xA0; 2&#xA0; 1&#xA0; 0&#xA0; Carry&#xA0;</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">read button A&#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A&#xA0; 0 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">LSR A&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">ROL buttons&#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A&#xA0; 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; ">&#xA0;</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">read button B&#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; B&#xA0; 0 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A&#xA0; 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">LSR A&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; B &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A&#xA0; B</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">ROL buttons&#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A&#xA0; B&#xA0; 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; ">&#xA0;</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">read button SEL&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0 SEL 0 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A&#xA0; 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">LSR A&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0 SEL&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A SEL</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">ROL buttons&#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A&#xA0; B SEL 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">read button STA&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0 STA 0 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A&#xA0; 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">LSR A&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0 STA&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A STA</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">ROL buttons&#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 0&#xA0; 0&#xA0; 0&#xA0; 0&#xA0; A&#xA0; B SEL STA 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 11px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 11px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">The loop continues for a total of 8 times to read all buttons.&#xA0; When it is done there is one button in each bit:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">bit: &#xA0; &#xA0; &#xA0; 7 &#xA0; &#xA0; 6 &#xA0; &#xA0; 5 &#xA0; &#xA0; 4 &#xA0; &#xA0; 3 &#xA0; &#xA0; 2 &#xA0; &#xA0; 1 &#xA0; &#xA0; 0</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">button:&#xA0; &#xA0; A &#xA0; &#xA0; B &#xA0; select start&#xA0; up &#xA0; down&#xA0; left right</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">If the bit is 1, that button is pressed.</span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><br><span style="letter-spacing: 0px; "></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; "><b><span class="Apple-style-span" style="font-size: medium; ">Game Layout<span class="Apple-style-span" style="font-size: 12px; font-weight: normal; "></span></span></b></span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; "><b><span class="Apple-style-span" style="font-size: medium; "><span class="Apple-style-span" style="font-size: 12px; font-weight: normal; ">The Pong game engine will use the typical simple NES game layout.&#xA0; First all the initialization is done.&#xA0; This includes clearing out RAM, setting up the PPU, and loading in the title screen graphics.&#xA0; Then it enters an infinite loop, waiting for the NMI to happen.&#xA0; When the NMI hits the PPU is ready to accept all graphics updates.&#xA0; There is a short time to do these so code like sprite DMA is done first.&#xA0; When all graphics are done the actual game engine starts.&#xA0; The controllers are read, then game processing is done.&#xA0; The sprite position is updated in RAM, but does not get updated until the next NMI.&#xA0; Once the game engine has finished it goes back to the infinite loop.</span></span></b></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">Init Code -&gt; Infinite Loop -&gt; NMI -&gt; Graphics Updates -&gt; Read Buttons -&gt; Game Engine --\</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ^&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; |</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; \------------------------------------------------------------------/</span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><br><span style="letter-spacing: 0px; "></span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><span style="letter-spacing: 0px; "></span></p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; min-height: 14px; "><span class="Apple-style-span" style="font-size: 16px; font-weight: bold; ">Game State</span><span style="letter-spacing: 0px; "></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">The use of a &quot;game state&quot; variable is a common way to arrange code.&#xA0; The game state just specifies what code should be run in the game engine each frame.&#xA0; If the game is in the title screen state, then none of the ball movement code needs to be run.&#xA0; A flow chart can be created that includes what each state should do, and the next state that should be set when it is done.&#xA0; For Pong there are just 3 basic states.</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;-&gt;Title State&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; /--&gt; Playing State&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; /--&gt;&#xA0; Game Over State</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">/ &#xA0;wait for start button --/ &#xA0; &#xA0; move ball &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; /&#xA0; &#xA0; &#xA0; wait for start button -\</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">|&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; move paddles &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; | &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; \</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">|&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; check for collisions &#xA0; / &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; |</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">|&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; check for score = 15 -/&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; |</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;\ &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; /</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; \-----------------------------------------------------------------------------------/&#xA0;</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><br><span style="letter-spacing: 0px; "></span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">The next step is to add much more detail to each state to figure out exactly what is needed.&#xA0; These layouts are done before any significant coding starts.&#xA0; Some of the game engine like the second player and the score will be added later.&#xA0; Without the score there is no way to get to the Game Over State yet.</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">Title State:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; if start button pressed</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; turn screen off</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; load game screen</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; set paddle/ball position</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; go to Playing State</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; turn screen on</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">Playing State:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; move ball</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; if ball moving right</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; add ball speed x to ball position x</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; if ball x &gt; right wall</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; &#xA0; bounce, ball now moving left</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; if ball moving left</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; subtract ball speed x from ball position x</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; if ball x &lt; left wall</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; &#xA0; bounce, ball now moving right</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; if ball moving up</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0; &#xA0; subtract ball speed y from ball position y</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; if ball y &lt; top wall</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; &#xA0; bounce, ball now moving down</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; if ball moving down</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; add ball speed y to ball position y</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0; &#xA0; &#xA0; if ball y &gt; bottom wall</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; bounce, ball now moving up</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; if up button pressed</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; if paddle top &gt; top wall</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; move paddle top and bottom up</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; if down button pressed</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; if paddle bottom &lt; bottom wall</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; move paddle top and bottom down</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; ">&#xA0;</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; if ball x &lt; paddle1x</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; if ball y &gt; paddle y top</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; if ball y &lt; paddle y bottom</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; &#xA0; &#xA0; bounce, ball now moving left</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">Game Over State:</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; if start button pressed</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; turn screen off</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; load title screen</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; go to Title State</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; "><span style="letter-spacing: 0px; ">&#xA0; &#xA0; turn screen on</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; ">&#xA0;</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span style="letter-spacing: 0px; "></span><br></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 11px; font: normal normal normal 10px/normal Monaco; min-height: 14px; "><span class="Apple-style-span" style="font-family: Helvetica; font-size: 16px; font-weight: bold; ">Putting It All Together</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">Download and unzip the <a href="scraper/files/pong1.zip" target="_blank" original-href="http://www.nespowerpak.com/nesasm/pong1.zip">pong1.zip</a> sample files.&#xA0; The playing game state and ball movement code is in the pong1.asm file. Make sure that file, mario.chr, and pong1.bat is in the same folder as NESASM3, then double click on pong1.bat. That will run NESASM3 and should produce pong1.nes. Run that NES file in FCEUXD SP to see the ball moving!</span></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 12px; margin-left: 0px; font: normal normal normal 12px/normal Helvetica; "><span style="letter-spacing: 0px; ">Other code segments have been set up but not yet completed.&#xA0; See how many of those you can program yourself.&#xA0; The main parts missing are the paddle movements and paddle/ball collisions.&#xA0;&#xA0;You can also add the intro state and the intro screen, and the playing screen using the background information from the previous week.</span></p></div><div><br></div>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#main_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;main_tutorial-7__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8747" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>

                <div class="comments" style="display: none;" id="main_tutorial-7__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__1">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				Jun 9, 2008 at 12:56:11 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve really been looking forward to this post. Awesome &lt;3! I&apos;ll be looking over it this week. Thank you x100, bunnyboy.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__2">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				Jun 9, 2008 at 6:36:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have a question about this portion of the tut. I wonder if someone wouldn&apos;t mind answering it.<br><br>
<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br><a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8172" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8172"></a><div><p style="margin: 0px 0px 12px; font-family: Helvetica; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">Notice that the vblankwait is done twice, so it is a good choice to turn into a subroutine.  First the vblankwait code is moved outside the normal linear flow:</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">vblankwait:      ; wait for vblank</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">  BIT $2002</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">  BPL vblankwait</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal; min-height: 14px;"><span style="letter-spacing: 0px;"></span><br></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">RESET:</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">  SEI          ; disable IRQs</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">  CLD          ; disable decimal mode</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal; min-height: 14px;"><span style="letter-spacing: 0px;"></span><br></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">clrmem:</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">  LDA #$FE</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">  STA $0200, x</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">  INX</span></p>
<p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal;"><span style="letter-spacing: 0px;">  BNE clrmem</span></p>
</div></div><br>I&apos;m wondering why the vblankwait, or, in general, a subroutine, has to be moved outside the &quot;normal linear flow.&quot; Why can&apos;t you put the code in the first place you want the vblank wait to run and then JSR to it every time after? Also, how would you know when something is sufficiently out of the &quot;normal linear flow?&quot; <br>Thanks!<br>R<br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__3">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Jun 9, 2008 at 7:17:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you make that a subroutine where it first appears, here&apos;s what it will look like:
<br>
<br>vblankwait: ; wait for vblank
<br>BIT $2002
<br>BPL vblankwait
<br>RTS
<br>
<br>RESET:
<br>SEI ; disable IRQs
<br>CLD ; disable decimal mode
<br>
<br>See that RTS in there after the test for branch? That&apos;s the ReTurn from Subroutine(RTS) that was mentioned by bunnyboy. If you first encounter that without having a Jump to SubRoutine (JSR), what will happen? Who knows! There is nowhere for the routine that was supposedly called to return to.
<br>
<br>The RTS will get hit because the code goes in order. If you stick a subroutine out of the regular linear order (i.e. somewhere after your main game loop), that portion of code will be jumped to, code executed, then when it hits RTS, return to where it left off in the main loop of the program.
<br>
<br>I&apos;m really bad at explaining things. I hope you understand what I mean. RTS will get hit because of the linear layout of the language, but the results will be nothing like what you want if there was no Jump to SubRoutine beforehand.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__4">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				Jun 9, 2008 at 7:25:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yup, makes sense. For some reason I had it in my head that if there were an RTS with no JSR before it that it would just kind of ignore the RTS... not sure why I thought that...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__5">
                                                        <div class="mdl-card__title"><strong>Zzap</strong> posted on 
		
			
				
				Jun 9, 2008 at 7:54:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Technically, the JSR will push the program counter (the pointer to where the program is currently running) onto the stack before moving the program counter to the subroutine location, and the RTS pops it back off the stack. So an RTS without a JSR would try to pop a number off the stack and start running from there (probably result in a crash).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__6">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				Jun 24, 2008 at 1:34:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					(Sorry to make this the &quot;Rachel&apos;s questions&quot; thread...)
<br>It looks like all of this game is done within the NMI, correct? Couldn&apos;t you &quot;run out of room,&quot; so to speak, within the NMI time? It seems like if you had lots of graphics and/or a number of jumps from one game state to another before the completion of any game state that you would run out of NMI time.
<br>I hope that question makes sense. Even if it doesn&apos;t, asking nonsense questions is still helpful in my learning <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">. Thanks in advance!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__7">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jun 24, 2008 at 1:49:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Your NMI just has to finish (RTI) before the next NMI triggers, one full frame later.
<br>
<br>What you have to worry about is running out of vblank time, which is why all the graphics updates are done at the beginning of NMI.  Once vblank is done you can&apos;t do more graphics updates, but you can still run the rest of your engine.  If you see a game slow down during high action, that is usually the engine time going too long so the graphics updates for that frame arent done.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__8">
                                                        <div class="mdl-card__title"><strong>NewUser123456789</strong> posted on 
		
			
				
				Jun 24, 2008 at 2:01:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Rachel,
<br>
<br>I don&apos;t think anyone minds all of the questions, I&apos;m sure Bunnyboy doesn&apos;t mind, at least you have intelligent questions about NES programming, I couldn&apos;t even get past week 2 without being confused.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__9">
                                                        <div class="mdl-card__title"><strong>Sivak</strong> posted on 
		
			
				
				Jun 24, 2008 at 2:35:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, you need to do graphical updates quickly in one frame of NMI, but you also need to do other things as well.  I recall running into problems with Pillars.  I used a bad multiplication routine that worked, but whenever huge numbers were in the mix, it would cause the game to freeze.  I made a much better routine that only needs do do a loop 8 times.
<br>
<br>Another similar thing was when you get 3 in a row, it redraws the entire background of the play area, but the process is done across 4 frames.  That routine was very hard to get right.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__10">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				Jun 28, 2008 at 3:21:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, I was wondering about huge mid-game background redraws. I&apos;m not sure how that works just yet. 
<br>Of course, instead of working through tutorials like a good girl should, I&apos;m trying to simultaneously learn from them AND create the game I want to make. (I can&apos;t help myself.)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__11">
                                                        <div class="mdl-card__title"><strong>Dain</strong> posted on 
		
			
				
				Jun 28, 2008 at 4:08:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Rachel</b></i><br><br>Yeah, I was wondering about huge mid-game background redraws. I&apos;m not sure how that works just yet. 
<br>Of course, instead of working through tutorials like a good girl should, I&apos;m trying to simultaneously learn from them AND create the game I want to make. (I can&apos;t help myself.)</div><br>We call that being an over-achiever <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"><br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__12">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jun 28, 2008 at 4:30:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Huge mid game redraws are either done with the screen turned off (fade out, then back in), or are done off screen then scrolled on screen (won&apos;t be covered for a long time).  Without doing more tricks there isn&apos;t enough time to draw more than ~3 rows or columns per frame.  If you are updating non contiguous tiles then you can&apos;t do that much because resetting the ppu address sucks up time.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__13">
                                                        <div class="mdl-card__title"><strong>Kizul Emeraldfire</strong> posted on 
		
			
				
				Jul 15, 2008 at 5:47:29 PM 
			
			
			
			
		
	
		
			
				
				Jul 20, 2008 at 11:59:57 AM 
			
			
			
			
		
	
		
			
				
				Jul 21, 2008 at 7:47:24 AM 
			
			
			
			
		
	
		
			
				
				Aug 21, 2009 at 11:14:57 AM 
			
			
			
			
		
	
		
			
				
				Aug 21, 2009 at 12:47:28 PM 
			
			
			
			
		
	
		
			
				
				Aug 22, 2009 at 8:13:42 AM 
			
			
			
			
		
	
		
			
				
				Aug 22, 2009 at 8:50:53 AM 
			
			
			
			
		
	
		
			
				
				Aug 22, 2009 at 9:13:24 AM 
			
			
			
			
		
	
		
			
				
				Aug 23, 2009 at 2:59:11 PM 
			
			
			
			
		
	
		
			
				
				Aug 23, 2009 at 4:14:28 PM 
			
			
			
			
		
	
		
			
				
				Aug 30, 2009 at 10:41:43 AM 
			
			
			
			
		
	
		
			
				
				Dec 17, 2009 at 12:41:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sooo... when&apos;s the next week coming up? &lt;.<!--? I'm eager (and probably a tad impatient) to learn! xD
				</div-->
				

				<div class>
					
						<br clear="all">-------------------------<br>
						&#xA0; 
				</div>

				
				
			</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__14">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				Jul 20, 2008 at 11:59:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think the lesson is missing some stuff at the end ?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__15">
                                                        <div class="mdl-card__title"><strong>dutch</strong> posted on 
		
			
				
				Jul 21, 2008 at 7:47:24 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There is a lot of stuff missing!
<br>
<br>What i did is this: comparing the controller/background asmfile with the pong asm file and check for differences. And try to make sense of it.
<br>
<br>From the top only the ines header is the same,then you get 
<br>* rsset/gamestate.rs 1/and state
<br>&gt; i believe this is the setup for variables(things that move and change) and constants (thing that don&apos;t change
<br>
<br>Then you get the usual setup like reset,vblank,clrmem etc...
<br>
<br>Then you get ball stats and stateplaying
<br>&gt; i believe this is a setup just like the palette/sprites/background/attribute needed for the ball movement( because i coundn&apos;t change the ball sprite)
<br>I did change the code a bit for paddle sprites (pic added)you could also ad background because thats missing.
<br>
<br>&gt; JSR drawscore for adding score points?
<br>&gt; cleaun up? clean up your mess
<br>
<br>&gt; Gameengine &gt;engine that needs to be added for tittle/game over and playing screen
<br>
<br>&gt;engineplaying here is a lot of information
<br>i think this is what the ball(mario&apos;s backhead) makes it moving all over screen
<br>
<br>BUT.........this is all guessing i have no idea if this is correct or how it works
<br>Just have to waith for bunny lessons
<br>
<br><a href="http://img329.imageshack.us/img329/2659/as002hd4.jpg" target="_blank" original-href="http://img329.imageshack.us/img329/2659/as002hd4.jpg">http://img329.imageshack.us/img32...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__16">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				Aug 21, 2009 at 11:14:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div>So I made myself a nice big ball sprite with YY-Chr and have been able to make it bounce around the screen.&#xA0;</div><div>My code works but before I continue I would like to check if it is good (or if someone has a better way).</div><div>here&apos;s the code I made to move my ball around:</div><div><br></div><div><br></div><div><br></div><div><div><div>UpdateSprites:</div><div>&#xA0;&#xA0;LDA bally <span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>;;update all ball sprite info</div><div>&#xA0;&#xA0;STA $0200 <span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; store Y position in Y value sprite 1</div><div>&#xA0;&#xA0;STA $0204 <span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; store Y position in Y value sprite 2</div><div>&#xA0;&#xA0;CLC<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; clear carry</div><div>&#xA0;&#xA0;ADC #$08<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; add 8 to move the sprite</div><div>&#xA0;&#xA0;STA $0208<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; store (Y positon+8) in Y value sprite 3</div><div>&#xA0;&#xA0;STA $020C<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; store (Y positon+8) in Y value sprite 4</div><div>&#xA0;</div><div>&#xA0;&#xA0;LDA #$00<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; load 00 in A</div><div>&#xA0;&#xA0;STA $0201<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; Store tile number 00 as first sprite&#xA0;</div><div>&#xA0;&#xA0;LDA #$01<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; load 01 in A</div><div>&#xA0;&#xA0;STA $0205<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; store tile number 01 as second sprite</div><div>&#xA0;&#xA0;LDA #$10<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; load 10 in A</div><div>&#xA0;&#xA0;STA $0209<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; store tile number 10 as third sprite</div><div>&#xA0;&#xA0;LDA #$11<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; load 11 in A</div><div>&#xA0;&#xA0;STA $020D<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>; store tile number 01 as fourth sprite</div><div>&#xA0;</div><div>&#xA0;&#xA0;LDA #$00 ; attributes</div><div>&#xA0;&#xA0;STA $0202&#xA0;</div><div>&#xA0;&#xA0;STA $0206&#xA0;</div><div>&#xA0;&#xA0;STA $020A</div><div>&#xA0;&#xA0;STA $020E</div><div><br></div><div>&#xA0;&#xA0;LDA ballx ;&#xA0;</div><div>&#xA0;&#xA0;STA $0203 &#xA0;; store X position in X value sprite 1</div><div>&#xA0;&#xA0;STA $020B &#xA0;; store X position in X value sprite 3</div><div>&#xA0;&#xA0;CLC</div><div>&#xA0;&#xA0;ADC #$08 &#xA0;</div><div>&#xA0;&#xA0;STA $0207 &#xA0;; store (X position+8) in X value sprite 2</div><div>&#xA0;&#xA0;STA $020F &#xA0;; store (X position+8) in X value sprite 4</div><div><br></div><div><br></div><div><br></div><div><br></div></div></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__17">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Aug 21, 2009 at 12:47:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Looks good.  If it won&apos;t be changing, you do not need to update the tile number and attributes every time.  The old value will still be there.  It isn&apos;t bad, just uses up cpu time that you may need in advanced games.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__18">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				Aug 22, 2009 at 8:13:42 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br>Looks good.  If it won&apos;t be changing, you do not need to update the tile number and attributes every time.  The old value will still be there.  It isn&apos;t bad, just uses up cpu time that you may need in advanced games.</div><br><br>I removed the updating for the tile number and the attributes, but now my sprite isn&apos;t the one I wanted.
<div><br></div><div>The tile number in the sprites .db is set to the one I want. Do I need to change something else ?&#xA0;</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__19">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Aug 22, 2009 at 8:50:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You need to set it at least once, just not every time you want the ball to move.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__20">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				Aug 22, 2009 at 9:13:24 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br>You need to set it at least once, just not every time you want the ball to move.</div><br><br>Indeed, It works ! Thx&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__21">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				Aug 23, 2009 at 2:59:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					New problem&#xA0;<img src style="display: none;" original-src="/i/expressions/face-icon-small-happy.gif" show-src="images/blank.gif"><div><br></div><div>Can anyone put me in the right direction for changing a background tile according to a value from the game (like the score)</div><div><br></div><div>I programmed my ball to have various speeds (1 to 6) by using the UP button (I don&apos;t have paddles&#xA0;<img src style="display: none;" original-src="/i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> )&#xA0;</div><div>Now I wanted to display the current level of speed.&#xA0;</div><div><br></div><div>I did the next:&#xA0;</div><div><br></div><div>- &#xA0;load the ball speed&#xA0;</div><div>- compare with 6 (is the max speed)</div><div>- not equal: skip (BNE)</div><div>- if equal ==&gt; store tile XX in a variable (speedlevel)</div><div>- .....</div><div>-...... do the same thing for values 5 till 1</div><div>-......</div><div>-......</div><div>- and I added &#xA0;&quot;speedlevel&quot; to my .db for the background&#xA0;</div><div><br></div><div>Offcourse, this didn&apos;t work&#xA0;<span class="sprites_emoticons absmiddle" id="emo_frown">&#xA0;</span></div><div>Where I should see the speed level (numbers 1 to 6) , I get the tile $0F.&#xA0;</div><div>This is the adress where my variable &quot;speedlevel&quot; is written.&#xA0;</div><div>Is it possible what I&apos;m trying to do ?&#xA0;</div><div>Or is there a better way to change 1 tile of my background ?&#xA0;</div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__22">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Aug 23, 2009 at 4:14:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You have to change background tiles in nmi.  Instead of trying to write directly to the background, instead set a flag and then look for that flag in nmi.  Then make the background change if that flag is set.  It will look for the flag every frame.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__23">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				Aug 30, 2009 at 10:41:43 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>mewithoutYou52</b></i><br><br>You have to change background tiles in nmi.  Instead of trying to write directly to the background, instead set a flag and then look for that flag in nmi.  Then make the background change if that flag is set.  It will look for the flag every frame.</div><br><br>Do you mean something like this ? &#xA0;Or am I completely missing the point ? The &quot;Drawscore&quot; get&apos;s called when the NMI happens.&#xA0;<div><br></div><div><a href="http://nintendoage.pastebin.com/f61fb15b5" target="_blank" original-href="http://nintendoage.pastebin.com/f61fb15b5">http://nintendoage.pastebin.com/f61fb15b5</a></div><div align="0"><br></div><div>It semi-works now. However, before I change the speed (up or down), it displays 1.&#xA0;</div><div>After I change the speed, it shoves the &quot;1&quot; one place to the right and displays the actual speed (1 to 6).</div><div>But I cant seem to find the solution for this.</div><div><br></div><div><br></div><div><img src original-src="http://www.NintendoAgeMedia.com/users/24/photobucket/6BAC9196-CF1D-7AA0-099B9F96E7655869.jpg" show-src="scraper/images/6BAC9196-CF1D-7AA0-099B9F96E7655869.jpg"></div><div><br></div><div>Also, would it be better if I removed the highlighted pieces of codes (in the pastebin) and add a Jump after a compare (if the compare = 1) ?&#xA0;</div><div>In the below example, first it would load A with the ball speed. If it&apos;s not equal to six, it will jump to the next value (NotSix). A is still loaded with the ball speed, so there is no need to load it again ?&#xA0;</div><div><br></div><div>If the value is equal to six, the Jump is then used to skip&#xA0;unnecessary code and to prevent that the tile number stored in A get&apos;s compared with other speeds (5-1)</div><div><br></div><div>So you would get:&#xA0;</div><div><br></div><div>Drawscore:</div><div><div><ul><li>LDA ballspeedx<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span></li><ul><li>&#xA0;&#xA0;CMP #$06 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;</li><li>&#xA0;&#xA0;BNE NotSix &#xA0; &#xA0;<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>&#xA0;&#xA0;&#xA0;<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span></li><li>&#xA0;&#xA0;LDA #$42 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;</li><li>&#xA0;&#xA0;STA $2007 &#xA0; &#xA0; &#xA0; &#xA0;</li><li>&#xA0;&#xA0;JMP DrawScoreDone<span class="Apple-tab-span" style="white-space: pre; ">&#xA0;</span>;if the speed of the ball is six =&gt; no need to do 5-1, jump to bottom</li></ul><li>NotSix: &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0;</li><ul><li>&#xA0;<font class="Apple-style-span" color="#FF0000">&#xA0;LDA ballspeedx</font><span class="Apple-tab-span" style="white-space: pre; "><font class="Apple-style-span" color="#FF0000">&#xA0;</font></span><font class="Apple-style-span" color="#FF0000">&#xA0;&#xA0; &#xA0;; this rule gets deleted, because if it&apos;s not 6, no other value was stored in A</font></li><li>&#xA0;&#xA0;CMP #$05</li><li>&#xA0;&#xA0;BNE NotFive</li><li>&#xA0;&#xA0;LDA #$51</li><li>&#xA0;&#xA0;STA $2007</li><li>&#xA0;JMP DrawScoreDone</li></ul><li>NotFive:<br>.....</li><li>.....</li></ul><div>DrawScoreDone:</div></div></div><div><br></div><div><br></div><div><font class="Apple-style-span" color="#00CC00">EDIT: Problem Solved&#xA0;</font></div><div><br></div><div>I also posted my problem over at nesdev and they found the bug in my code:</div><div><br></div><div>If the speed of my ball was anything else then 1, it would load that tile (for that speed) and write it to #$2353 using $2007</div><div>Because I didn&apos;t have a CMP and BNE for the speed 1, it would load the tile for number 1, and do another write at $2007 causing the tile for &quot;1&quot; getting stored into #$2354.</div><div><br></div><div>Adding a CMP and BNE solved my problem. However they also suggested a better code to use, which I have implemented (8 lines of code instead of my 38&#xA0;<img src style="display: none;" original-src="/i/expressions/face-icon-small-happy.gif" show-src="images/blank.gif">)</div><div><br></div><div>Thx Kevin and Brian &#xA0;for you&apos;re aid !&#xA0;</div><div><br></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__24">
                                                        <div class="mdl-card__title"><strong>themaincamarojoe</strong> posted on 
		
			
				
				Dec 17, 2009 at 12:41:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>How do you add the paddles?&#xA0; In previous post we used a loop to add more than one sprite:</p><p><font size="1">SpriteLoop:<br>&#xA0;LDA Sprites, x<br>&#xA0;STA $0200, x<br>&#xA0;INX<br>&#xA0;CPX #$10<br>&#xA0;BNE SpriteLoop</font></p><p>However, in this one asm file, we used this way:</p><p></p><p><font size="1">UpdateSprites:<br>&#xA0;LDA bally<br>&#xA0;STA $0200<br>&#xA0;<br>&#xA0;LDA #$75&#xA0; <font color="#00cc00">;i changed the the tile from 00 to 75 which is a ball looking&#xA0;tile</font><br>&#xA0;STA $0201<br>&#xA0;<br>&#xA0;LDA #$00<br>&#xA0;STA $0202<br>&#xA0;<br>&#xA0;LDA ballx<br>&#xA0;STA $0203<br>&#xA0;<br>&#xA0;RTS</font></p><p></p><p>When having more than one sprite, they were written to $0200.&#xA0; But when this one, and the first tutorial that uses sprite, when write to $0201.&#xA0; I guessed that any extra ones I would write to the next location, being $0204, but that did not work.&#xA0; Any ideas?</p><p>By the way, I&apos;m not new to programming (but i&apos;m not good at it), but I am new to nintentdo programming and the 6502.&#xA0; I do know a little bit about Intel assembly.</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__25">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Dec 17, 2009 at 12:51:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					yup write to the next loaction
<br>
<br>LDA (Ball sprite y potision)
<br>STA $0200
<br>LDA (Ball sprite tile number)
<br>STA $0201
<br>LDA (ball palette number)
<br>STA $0202
<br>LDA (ball x position)
<br>STA $0203
<br>then you can add paddles next. depends on how big you want your paddles, probably atleast 2 sprites a paddle
<br>
<br>LDA (paddle1 top y postion
)<br>STA $0204
<br>LDA (paddle sprite. You can use the same sprite for both sections)
<br>STA $0205
<br>LDA (paddle sprite palette number)
<br>STA $0206
<br>LDA (paddle1 top x position)
<br>STA $0207
<br>
<br>etc
<br>etc
<br>etc 
<br>
<br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__26">
                                                        <div class="mdl-card__title"><strong>themaincamarojoe</strong> posted on 
		
			
				
				Dec 17, 2009 at 3:25:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>How do we use the ReadController and the ReadControllerLoop to read the controller.&#xA0; According to the post, we need to write to the appropiate bit.&#xA0; So, for example, if I want one of my tiles to move up, I kow that I need to write to bit 3, or %00001000.&#xA0; </p><p style="MARGIN: 0px; FONT: 10px Monaco"><span style="LETTER-SPACING: 0px">bit:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 7 &#xA0; &#xA0; 6 &#xA0; &#xA0; 5 &#xA0; &#xA0; 4 &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0;&#xA0; 0</span></p><p style="MARGIN: 0px; FONT: 10px Monaco"><span style="LETTER-SPACING: 0px">button: A &#xA0; &#xA0; B &#xA0; select start&#xA0; up &#xA0; down&#xA0; left right</span></p><p>I guess that if I wanted to read up I would use the following instruction.</p><p><font size="1">LDA #%00001000<br>STA button1</font></p><p>What I&apos;m confused about is where to write this?&#xA0; Do&#xA0;I use a JSR to hop to ReadControllerLoop and then write to button one?&#xA0; Before we used an instruction like this:</p><p><font size="1">ReadUp:<br>&#xA0;&#xA0; LDA $4016<br>&#xA0;&#xA0; AND #%00000001 <br>&#xA0;&#xA0; BEQ ReadUpDone<br>&#xA0;&#xA0; LDA $0200<br>&#xA0;&#xA0; SEC<br>&#xA0;&#xA0; SBC #$01<br>&#xA0;&#xA0; STA $0200<br>ReadUpDone:</font></p><p><font size="2">How do I combine these instructions to write to up?</font></p><p></p><p style="MARGIN: 0px; FONT: 10px Monaco"><span style="LETTER-SPACING: 0px"></span></p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__27">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 17, 2009 at 3:25:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					In the first loop, you are loading all the sprites when the screen is drawn.  The second way just looks like a subroutine that is used to change the way a sprite looks when it&apos;s already on the screen.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__28">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 17, 2009 at 3:31:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The previous post was for the previous sprite question.  Sorry, hard to keep up on the iPhone.
<br>
<br>Basically to move the paddle up, you need to look at the las thing you just typed.  That subroutine is looking to see if the button is pressed, and if so, running the instructions under it.  You&apos;d just replace that stuff with:
<br>
<br>lda $0300
<br>sec
<br>sbc $#01
<br>sta $0300
<br>
<br>that will move the sprite up one pixel per frame if the button is pressed.  Make sure you&apos;re putting it after the bne pressdowndone or whatever it&apos;s called though.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__29">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 17, 2009 at 3:32:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry, beq... Not bne.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__30">
                                                        <div class="mdl-card__title"><strong>themaincamarojoe</strong> posted on 
		
			
				
				Dec 17, 2009 at 4:38:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m still confused. Where exactly do I put this.&#xA0; Can it before or after RTI?&#xA0; What&apos;s at $0300?&#xA0; Would I create a ReadA, ReadB, etc section like in earlier post, or would this be done differently?&#xA0; I got the controller to work before, but I&apos;m trying to use the new savy way.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__31">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Dec 17, 2009 at 5:22:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You can put this anywhere after NMI. To save space, you would probably want to put it outside your game engine loop and call it when needed.<br><br>code <br>code <br>code<br>JSR ReadUp (call the routine when you wanna see if you should move the paddle up<br>JSR ReadDown(same thing to check down)<br>code <br>code<br>code<br><br><br>;;;;;;;;;;;;;;;;;;;Outside routine;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br><font size="1">ReadUp:<br>&#xA0;&#xA0; LDA $4016<br>&#xA0;&#xA0; AND #%00000001 <br>&#xA0;&#xA0; BEQ ReadUpDone<br>&#xA0;&#xA0; LDA $0200(paddle sprite Y position)<br>&#xA0;&#xA0; SEC<br>&#xA0;&#xA0; SBC #$01<br>&#xA0;&#xA0; STA $0200(paddle sprite Y position)<br>ReadUpDone:</font><br>RTS<br><br>ReadDown:<br>code <br>code<br>code<br>ReadDownDone:<br>RTS<br><br><br><br><br>The way I did it is like this. This is my Playing engine for a 1 player game. Each one of these JSR jumps to the routine outside the engine loop then returns. My MovePaddleUp sub routine is pretty much the same as yours except I do a few more things there before returning. This routine here runs once ever NMI, so 60 times a sec.<br><br>EnginePlaying1P:<br>&#xA0; <br>&#xA0; JSR MoveBall<br>&#xA0; JSR movephan11<br>&#xA0; JSR movephan12<br>&#xA0; JSR movephan21<br>&#xA0; JSR movephan22<br>&#xA0; JSR MovePaddleUp <br>&#xA0; JSR MovePaddleDown<br>&#xA0; JSR MoveCPU<br>&#xA0; JSR CheckPaddleCollision<br>&#xA0; JSR check1ppower<br>&#xA0; JSR Startgame1p<br><br>&#xA0; JMP GameEngineDone<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__32">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Dec 18, 2009 at 2:25:05 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>themaincamarojoe</b></i><br><br><p>How do we use the ReadController and the ReadControllerLoop to read the controller.&#xA0; According to the post, we need to write to the appropiate bit.&#xA0; So, for example, if I want one of my tiles to move up, I kow that I need to write to bit 3, or %00001000.&#xA0; </p><p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none;"><span style="letter-spacing: 0px;">bit:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 7 &#xA0; &#xA0; 6 &#xA0; &#xA0; 5 &#xA0; &#xA0; 4 &#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 1&#xA0;&#xA0;&#xA0;&#xA0; 0</span></p><p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none;"><span style="letter-spacing: 0px;">button: A &#xA0; &#xA0; B &#xA0; select start&#xA0; up &#xA0; down&#xA0; left right</span></p><p>I guess that if I wanted to read up I would use the following instruction.</p><p><font size="1">LDA #%00001000<br>STA button1</font></p><p>What I&apos;m confused about is where to write this?&#xA0; Do&#xA0;I use a JSR to hop to ReadControllerLoop and then write to button one?&#xA0; Before we used an instruction like this:</p><p><font size="1">ReadUp:<br>&#xA0;&#xA0; LDA $4016<br>&#xA0;&#xA0; AND #%00000001 <br>&#xA0;&#xA0; BEQ ReadUpDone<br>&#xA0;&#xA0; LDA $0200<br>&#xA0;&#xA0; SEC<br>&#xA0;&#xA0; SBC #$01<br>&#xA0;&#xA0; STA $0200<br>ReadUpDone:</font></p><p><font size="2">How do I combine these instructions to write to up?</font></p><p></p><p style="margin: 0px; font-family: Monaco; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none;"><span style="letter-spacing: 0px;"></span></p></div><br>With the new ReadController routine you don&apos;t need to mess with ReadUp or ReadDown or anything like that ever again.<br><br>The new ReadController should be called once per frame.&#xA0; It reads the button states for you and stores them in a zero page variable called &quot;buttons1&quot;.&#xA0; This variable is then available for you to peek at and see which buttons were pressed.&#xA0; This is done by reading the variable, not writing.&#xA0; Any time you want to check if up is pressed, you just need to check the appropriate bit in your &quot;buttons1&quot; variable:<br><br>;check to see if up was pressed.<br>&#xA0;&#xA0;&#xA0; lda buttons1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;load the current button state for controller1<br>&#xA0;&#xA0;&#xA0; and #%00001000&#xA0;&#xA0; ;isolate the bit representing &quot;up&quot;, by clearing all the other bits<br>&#xA0;&#xA0;&#xA0; beq .skip&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if the result was 0, then the &quot;up&quot; bit was clear (thus not pressed), so skip the following code<br>&#xA0;&#xA0;&#xA0; ;...<br>&#xA0;&#xA0;&#xA0; ;code for moving paddle position up here<br>.skip:<br>&#xA0;&#xA0;&#xA0; ;code continues here.<br><br>Did that help?&#xA0; If anything is still unclear, please ask!<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__33">
                                                        <div class="mdl-card__title"><strong>themaincamarojoe</strong> posted on 
		
			
				
				Dec 22, 2009 at 1:21:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Where should I put this?&#xA0; Should it be a subroutine and if so, when should it be called?&#xA0; You said that this needed to be done once per frame, does that mean that I need to do it after VBlank?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__34">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				Dec 22, 2009 at 1:55:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					make it a subroutine and have a JSR to it at the end of NMI
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__35">
                                                        <div class="mdl-card__title"><strong>themaincamarojoe</strong> posted on 
		
			
				
				Jan 6, 2010 at 1:55:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>So I&apos;ve created a paddle using a tile from Mario.chr.&#xA0; I&apos;m sure there&apos;s an easier way to do it, but I&apos;ll worry about that later.&#xA0; I&apos;ve successfully been able to make the paddle move up and down using the older routing.&#xA0; This can be seen in the below link:</p><p><a href="http://www.acsalaska.net/~themaincamarojoe/Pong_with_old_control_routine.asm" target="_blank" original-href="http://www.acsalaska.net/~themaincamarojoe/Pong_with_old_control_routine.asm">http://www.acsalaska.net/~themaincamarojoe/Pong_with_old_con...</a> </p><p>This works fine, but I&apos;d like to use the newer routing.&#xA0; The below link shows this attempt.</p><p><a href="http://www.acsalaska.net/~themaincamarojoe/Pong_with_new_Control_Routine.asm" target="_blank" original-href="http://www.acsalaska.net/~themaincamarojoe/Pong_with_new_Control_Routine.asm">http://www.acsalaska.net/~themaincamarojoe/Pong_with_new_Con...</a> </p><p>Now, I know I&apos;m doing something wrong here.</p><p>On line 204 and 205 I jump to the routine which handles ReadUp and ReadDown, which is called after ReadController1 and ReadController2.&#xA0; Lines 381 through 515 are the actual subroutines.&#xA0; I thought I new a decent amount about assembly, but it seems as if the 6502 and the NES archeticture is more challenging that I anticipated.</p><p>Can you all please assist in pointing out my mistake.&#xA0; Thank you everyone for being so helpful.</p><p>By the way, if you all know of a better way for me to show my code, let me know.</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__36">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jan 6, 2010 at 2:10:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>Well, assuming that all the formatting issues came from the file transfer, I found the following. Your ReadUpDone: and ReadDownDone: are outside of your &quot;RTS&quot; commands. <br><br>And I would say that you need to change the controller reading routine back to the old way. I&apos;ve never seen it done the way you are trying to do it, that doesn&apos;t mean it won&apos;t work, it just looks confusing to me. Why change what works? </p><p>Also, why do you have&#xA0;so many sprites on your up and down routines?</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__37">
                                                        <div class="mdl-card__title"><strong>Jero</strong> posted on 
		
			
				
				Jan 6, 2010 at 2:18:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think I once did it that way. Don&apos;t do it that way, it causes problems on pal consoles.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__38">
                                                        <div class="mdl-card__title"><strong>themaincamarojoe</strong> posted on 
		
			
				
				Jan 6, 2010 at 2:28:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>I&apos;d like to my code to be efficent and clean as possible.&#xA0; Plus, I&apos;d like to follow BunnyBoy&apos;s advice as layed out in this tutorial.&#xA0; This is why I&apos;d like to change my old ways and adopt new better ways.</p><p>I moved the ReadUpDone: and ReadDownDone: inside RTS and it still is not working.</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__39">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 6, 2010 at 3:04:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					In the 2nd link, you have no code after ReadDownDone.  Should have an RTS there to get back to your JSR.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__40">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 6, 2010 at 3:07:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					And the real problem, there is no way to get to Player1Engine.  That means controllers are never read, sprites are never moved, etc.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__41">
                                                        <div class="mdl-card__title"><strong>themaincamarojoe</strong> posted on 
		
			
				
				Jan 6, 2010 at 6:00:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>Thanks a lot everyone.&#xA0; I&apos;m still having problems.&#xA0; I did notice that my sprite wasn&apos;t bouncing around.&#xA0; I got rid of the Player1Engine and moved the JSR ReadController1&#xA0;back to where it was in the original tutorial.&#xA0; I also placed my JSR ReadUp and JSR ReadDown to the same section (lines176 to 179).&#xA0; However, my paddle still does not move.&#xA0; </p><p>Below is the link for my souce code.&#xA0; I recommend saving it and opening it in a notepad++ (my text editor of choice).</p><p><a href="http://www.acsalaska.net/~themaincamarojoe/post/Pong_with_new_Control_Routine_V2.asm" target="_blank" original-href="http://www.acsalaska.net/~themaincamarojoe/post/Pong_with_new_Control_Routine_V2.asm">http://www.acsalaska.net/~themaincamarojoe/post/Pong_with_ne...</a> </p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__42">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 6, 2010 at 6:12:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Before your controller loops, you want LDX #$08 instead of LDA #$08.  Otherwise who knows how many times that loop is running, erasing the button data.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__43">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Feb 18, 2010 at 3:33:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Is there a further tut somewhere covering &quot;NEXT WEEK: Drawing graphics, more Pong&quot; and beyond?  I can&apos;t seem to find it anywhere.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__44">
                                                        <div class="mdl-card__title"><strong>rizz</strong> posted on 
		
			
				
				Mar 2, 2010 at 5:55:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m trying to compile a list of the various IRQ&apos;s generated during game execution.  I haven&apos;t begun learning sound programming yet, so there might be various IRQ&apos;s in that section.
<br>
<br>This is what I know so far:
<br>SEI and CLI disables and enables ALL IRQ&apos;s
<br>frame counter IRQ&apos;s (see $4017)
<br>DMC IRQ&apos;s (see $4010)
<br>MMC3 IRQ&apos;s (see $C000, C001, E000, E001)
<br>using BRK will generate your own IRQ
<br>
<br>Which other things will trigger an IRQ?  When/how exactly is that DMC IRQ triggered?
<br>
<br>Thanks
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__45">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Jan 12, 2012 at 7:51:42 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey, I have a question.
<br>What are the constant values? Is it tiles from the .chr files or have I missed something?
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__46">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jan 12, 2012 at 9:20:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Constants are there so that you can use the number in multiple places and only have to change it in one...if you need to change it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__47">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Jan 12, 2012 at 1:40:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oh, sorry if I was unclear, I meant the constants in the pong1.asm file and the significance of those values.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__48">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jan 12, 2012 at 4:18:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Basically he&apos;s setting a specific value to each state the game is in, so you don&apos;t have to keep track of which state is which number.
<br>
<br>It&apos;s a lot easier to program for months on end and tell the game:
<br>
<br>&quot;LOAD STATEGAMEOVER
&quot;<br>
<br>Than try to remember which value STATEGAMEOVER is.<br><br>edit: and it looks like he&apos;s doing more constants than just the game states.<br><br>The top wall of his pong game will always be at the value $20, so when he tells the game:<br><br>&quot;Stop the ball when it goes up on the screen to the $20 value&quot;<br><br>He can just say:<br><br>&quot;When ball hits TOPWALL, stop and go the other direction.&quot;<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__49">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Jan 12, 2012 at 4:28:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes, it was the TOPWALL, e.t.c. constants I was wondering about, thank you! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br><br>Edit:<br>Hey, another question, about the controller reading function. I understand everything except how<br>the A button bit ends up in the buttons carry and not only the accumulators carry.<br>How does the LSR A line of code transfer data into the buttons variable?<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__50">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Jan 22, 2012 at 6:16:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey hey, again. Sorry for the double post,<br>but the edit in the last post didn&apos;t seem to get any answer, nevermind that.
I&apos;m working on a pong game, and I get the background to show up in the title screen,<br>but the text tiles are in the wrong place. If I press the start button,<br>the tiles end up in their right spot, but I can&apos;t figure out what&apos;s wrong.
Here is the NMI and title screen code:<br><br><br>Nmi:<br>
&#xA0;&#xA0;LDA #$00<br>
&#xA0;&#xA0;STA $2003<br>
&#xA0;&#xA0;LDA #$02<br>
&#xA0;&#xA0;STA $4014<br><br><br>&#xA0;&#xA0;LDA #%10010000<br>
&#xA0;&#xA0;STA $2000<br>
&#xA0;&#xA0;LDA #%00011110<br>
&#xA0;&#xA0;STA $2001<br>
&#xA0;&#xA0;LDA #$00<br>
&#xA0;&#xA0;STA $2005<br>
&#xA0;&#xA0;STA $2005<br>
	
&#xA0;&#xA0;JSR ReadController1<br>
&#xA0;&#xA0;JSR ReadController2<br>
	
GameStates:<br>
&#xA0;&#xA0;LDA gameState<br>
&#xA0;&#xA0;CMP #GSTITLE<br>
&#xA0;&#xA0;BEQ TitleScreen<br>
	
&#xA0;&#xA0;LDA gameState<br>
&#xA0;&#xA0;CMP #GSPLAYING<br>
&#xA0;&#xA0;BEQ PlayScreen<br>
	
&#xA0;&#xA0;LDA gameState<br>
&#xA0;&#xA0;CMP #GSGAMEOVER<br>
&#xA0;&#xA0;BEQ GameOverScreen<br>
GameStatesDone:<br>
	
&#xA0;&#xA0;RTI<br>
	
TitleScreen:<br>
&#xA0;&#xA0;LDA #$00<br>
&#xA0;&#xA0;STA $2000<br>
&#xA0;&#xA0;STA $2001<br>
	
&#xA0;&#xA0;LDX #LOW(TitleBG)<br>
&#xA0;&#xA0;LDY #HIGH(TitleBG)<br>
&#xA0;&#xA0;JSR SetBGPointer<br>
&#xA0;&#xA0;JSR LoadBG<br>
	
&#xA0;&#xA0;LDA #%10010000<br>
&#xA0;&#xA0;STA $2000<br>
&#xA0;&#xA0;LDA #%00011110<br>
&#xA0;&#xA0;STA $2001<br>
&#xA0;&#xA0;LDA #$00<br>
&#xA0;&#xA0;STA $2005<br>
&#xA0;&#xA0;STA $2005<br>
	
&#xA0;&#xA0;LDA controller1<br>
&#xA0;&#xA0;AND #%00010000<br>
&#xA0;&#xA0;BEQ DontStartGameYet<br><br><br>&#xA0;&#xA0;LDA #GSPLAYING<br>
&#xA0;&#xA0;STA gameState<br>
DontStartGameYet:<br>
&#xA0;&#xA0;JMP GameStatesDone
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__51">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jan 22, 2012 at 6:28:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Try adding a LDA $2002 to the beginning, as you NEED to read that to tell the PPU that you know a NMI happened. When you do the STA $2000 with the NMI enabled, you are causing another one to occur most likely. You should also look into cleaning up your program flow and take everything out of the NMI and make it it&apos;s own real program. <span class="sprites_emoticons absmiddle" id="emo_smile"></span> Good luck, hope that&apos;s the problem.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__52">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				Jan 22, 2012 at 10:52:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>
	Yea, I&apos;m seeing a lot of red flags in that code. &#xA0;Check out this NMI document by DISCH. &#xA0;It has a lot of good stuff in it.</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__53">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Jan 23, 2012 at 4:17:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks guys, that sure clears up a lot. <span class="sprites_emoticons absmiddle" id="emo_happy"></span><br>
I&apos;ll make sure to read that document and try to fix this before<br>bugging you again. <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__54">
                                                        <div class="mdl-card__title"><strong>Dennis Fleaman</strong> posted on 
		
			
				
				Jan 23, 2012 at 8:32:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<a href="http://nesdev.parodius.com/bbs/viewtopic.php?t=7503&amp;highlight=disch" target="_blank" original-href="http://nesdev.parodius.com/bbs/viewtopic.php?t=7503&amp;highlight=disch">http://nesdev.parodius.com/bbs/vi...</a>
<br>
<br>check this out
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__55">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Jan 23, 2012 at 1:43:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That is also very helpful, thank you. <span class="sprites_emoticons absmiddle" id="emo_happy"></span><br>
I&apos;m having a little trouble understanding buffering, but I will just read the NMI doc again a couple of times.<br>
One question that arose after reading it the first time tho. In bunnyboys pong files, he have the game state<br> machine in the NMI, but wouldn&apos;t this code count as logic? Shouldn&apos;t it be in the infinite loop or at least<br> somewhere outside of the NMI?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__56">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jan 23, 2012 at 1:53:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>
	DP</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__57">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jan 23, 2012 at 1:53:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you have problems you needed answered in depth you can mail me, but yes the logic is in the NMI and that isn&apos;t always terrible. But once you try to put different &quot;engines&quot; in programs, you&apos;ll need different NMI&apos;s to handle stuff, so some programs (All of mine, many others) just do something like this:
<br>
<br>NMI:
<br>BIT $2002 ;Tell PPU you acknowledged the NMI
<br>INC Frame ;Just a frame counter variable to tell the rest of the computer it&apos;s a new frame.
<br>RTI ;Return, hopefully the program was already waiting for the NMI to happen so it won&apos;t slow down.
<br>
<br>And then in their programs, they just do a JSR WaitForNMI that waits for the Frame variable to be change, and when changed, then runs some logic after the JSR to the vblank wait. One bad thing is that if your calculations spill over your music will also slow down by half too, which isn&apos;t that good, but the method is still the simplest to use in the long run.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__58">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Jan 23, 2012 at 4:00:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the offer, and thanks for the tip, will definitely see what I can do with that. <span class="sprites_emoticons absmiddle" id="emo_happy"></span><br>
Found something interesting here too:<br>
<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=24885" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=24885">http://www.nintendoage.com/forum/...</a><br>
For the buffering, so if I can&apos;t fix this now, I probably should go and read a book on<br>
computer science first. One thing tho, just to make sure I got it right. I can see in some files, like in<br>
the sound engine(from the link), that you save the registers at the beginning of NMI and restore at the end.<br>
This is so the code outside the NMI won&apos;t be disrupted, right?<br><br>Thanks for all the help!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__59">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jan 23, 2012 at 4:16:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					On the IRQ/NMI, I believe the status is saved so that doesn&apos;t need pushed, but not the registers, so yes you will have to save all registers you use if you do not use the simple BIT/INC NMI routine. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__60">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Jan 24, 2012 at 6:41:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry, but the more I read, the more confused I get, so I guess I will have to spend more (of your)time<br>
here than I thought at first. x_x<br>
Your way to do it seems to be the simplest one, so perfect for a simplteton like me, but I still just sort of get it, which isn&apos;t much at all. <span class="sprites_emoticons absmiddle" id="emo_sad"></span><br>
I have found some source code with different ways to handle the NMI, but none that do it the way you do it,<br>
just stuff that at the moment is way over my head.
Where would I put the drawing code if not in the NMI? In the main loop? A separate sub? What about the game states?<br>
I&apos;m having a lot of trouble figuring out where to put what in the program, and even tho I have been following along<br>the NN tutorials, some of this stuff still seems like black magic to me.<br> For instance, bunnyboy&apos;s pong code have the game states and the controller reading in the NMI, but I have seen some people say this is verry
bad, and that that code should go in the main loop. This is all verry confusing to say the least.<br>
Have I completely missed something here, or should I just go and get a 6502 for dummies or something? <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__61">
                                                        <div class="mdl-card__title"><strong>Jero</strong> posted on 
		
			
				
				Jan 24, 2012 at 6:44:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It all depends on what you are comfortable with vs some optimization. Technicly you could put all your game logic in the nmi as long as you make sure to update the screen first. What most people do in my experience is either tie their main logic to nmi or have a little &quot;flag&quot; in ram that tells the main code nmi happend and that another frame has to be processed.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__62">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jan 24, 2012 at 7:23:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Nah, just don&apos;t worry about those things and just go with that NN says, you&apos;ll get it later when you need to make multiple NMI&apos;s later. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__63">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Jan 24, 2012 at 1:15:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey, I got the background to show up properly now, but now the controller input won&apos;t work, and I have<br>
no idea why. <a href="http://pastebin.com/m15iLpnT" target="_blank" original-href="http://pastebin.com/m15iLpnT">http://pastebin.com/m15iLpnT...</a><br>
Would be cool if anyone could take a gander at this. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
Would that at least be a good way to handle the NMI? Or am I completely screwing up something else now?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__64">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jan 24, 2012 at 1:28:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The NMI might be a ticker, but don&apos;t keep relying on it for every part of your program. But yes, that will work for now. It seemed okay to me for P1, try looking at FCEUX&apos;s hex editor at the variables or maybe even the debugger and try to find it with those and get to know those tools well. <span class="sprites_emoticons absmiddle" id="emo_happy"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__65">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Jan 24, 2012 at 1:54:13 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hmm, debugging C++ code with VC++ express is no problem, so I&apos;ll figure that out.<br>
But when I checked the hex editor my eyes went T_T and my brain went X_X.<br>
Care to give me a hint on how it works?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__66">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jan 24, 2012 at 1:57:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Look at the .fns file NESASM3 makes, and find the RAM label that the controller is going to to debug it via looking at the hex editor. Then look for that piece of RAM in the hex editor. You can also set breakpoints in the debugger to reads/writes/exectues to memory, including all RAM. Use all those to find/debug problems. And don&apos;t be intimidated by the hex editor, you wrote the program to use all the bytes, that&apos;s harder than reading it. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__67">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Jan 31, 2012 at 10:03:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is probably a bad question at this point in the game, but I&apos;m having trouble figuring out how the background is becoming a bunch of zeroes. It appears that it is happening in this block of code:<br>
<br>
<br>
;;This is the PPU clean up section, so rendering the next frame starts properly.<br>
LDA #%10010000 ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1<br>
STA $2000<br>
LDA #%00011110 ; enable sprites, enable background, no clipping on left side<br>
STA $2001<br>
<br>
<br>
Though I&apos;m not sure why it is defaulting to those zeroes. Could someone shed some light on this?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__68">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jan 31, 2012 at 10:38:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The background is becoming a bunch of zeroes because it&apos;s pulling the background from pattern table 1.  The first tile of pattern table 1 is a 0, so it&apos;s placing that same tile over and over until the screen is full.  He doesn&apos;t have a routine that is drawing any sort of special background.  If you edit the CHR file with tile layer pro, you could change that to anything you wanted.
<br>
<br>In later lessons you learn how to display a proper full nametable.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__69">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Jan 31, 2012 at 10:44:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I see, so this is a default behavior when you choose a pattern table for a background.  So as an alternative right now, I could hard code a background as he did from the Background tutorial.  Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__70">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Feb 5, 2012 at 2:45:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m really sorry that I&apos;m raping this thread with questions, but I want to finish this pong clone<br>
so I can go on and start coding for real. <span class="sprites_emoticons absmiddle" id="emo_tongue"></span><br>
The problem I&apos;m having is with the paddle collisions. Here is my code for it.<br>
Player1Collisions:<br>
	LDA player1<br>
	CMP ballPos+1<br>
	BNE .return<br><br>
	
	LDA player1+3<br>
	CMP ballPos<br>
	BNE .return<br>
	LDA #$01<br>
	STA ballDirection+1<br>
	STA ballDirection+2<br>
	LDA #$00<br>
	STA ballDirection<br>
	LDA ballDirection+3<br>
.return:<br>
	RTS<br><br>
And this subroutine is called in the main loop at the end, after the input is handled<br>
and the sprites are updated. Everything I have done so far seems to work fine EXCEPT the paddle collisions.<br>
Here is all the code, if it make things easier. <a href="http://pastebin.com/eTVKQgGx" target="_blank" original-href="http://pastebin.com/eTVKQgGx">http://pastebin.com/eTVKQgGx...</a><br>
ballPos is x, ballPos+1 is y, player1 is y and player1+3 is x.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__71">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 5, 2012 at 8:09:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I won&apos;t be much help without your ROM.  Maybe someone else can pipe up.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__72">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 6, 2012 at 11:10:34 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					At first glance, you should be using BCC and BCS instead of BNE.  But I could be wrong.  BNE would only work if they are exactly on the same pixel, the others would give you a collision range.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__73">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Feb 6, 2012 at 3:00:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	At first glance, you should be using BCC and BCS instead of BNE. But I could be wrong. BNE would only work if they are exactly on the same pixel, the others would give you a collision range.</div>
Seems to work now. Thank you! <span class="sprites_emoticons absmiddle" id="emo_happy"></span><br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__74">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 6, 2012 at 11:23:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have one other question which involves loading the paddle sprites using a loop.  What I would like is 4 of the same tiles stacked vertically to create a paddle.  My current &quot;loop&quot; is this:
<br>
<br>  LDX #$00
<br>
<br>loop:
<br>  LDA paddle1ytop, x  ;;update paddle sprites
<br>  STA $0204, x
<br>
<br>  LDA #$5B
<br>  STA $0205, x
<br>  
<br>  LDA #$01
<br>  STA $0206, x
<br>  
<br>  LDA #PADDLE1X
<br>  STA $0207, x
<br>
<br>  INX
<br>  CPX #$01
<br>  BNE loop
<br>
<br>Where it&apos;s not really a loop because it just runs through once to display the top tile.  I am not sure how to then shift everything up to the next set of addresses (which in my code would be multiplying the &quot;x&quot; value by 4 in each place, in addition to having to increase the paddle1ytop variable by 8 each run through the loop.  Is what I&apos;m thinking possible or do I need to restructure my loop?  I&apos;d rather not have to hard code this with no loops if possible.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__75">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 7, 2012 at 2:30:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
		<br>
		At first glance, you should be using BCC and BCS instead of BNE. But I could be wrong. BNE would only work if they are exactly on the same pixel, the others would give you a collision range.</div>
	Seems to work now. Thank you!<br>
	<br>
	&#xA0;</div>
<br>
I didn&apos;t think it was this because his speed is always no more than 1, from what I could see in his code.&#xA0; But if that fixed it, awesome.&#xA0; Nice job!<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__76">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Feb 7, 2012 at 1:20:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>DoNotWant</b></i><br>
		<br>
		<div class="FTQUOTE">
			<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
			<br>
			At first glance, you should be using BCC and BCS instead of BNE. But I could be wrong. BNE would only work if they are exactly on the same pixel, the others would give you a collision range.</div>
		Seems to work now. Thank you!<br>
		<br>
		&#xA0;</div>
	<br>
	I didn&apos;t think it was this because his speed is always no more than 1, from what I could see in his code.&#xA0; But if that fixed it, awesome.&#xA0; Nice job!<br>
	&#xA0;</div>
<br>
Yeah, I had it at 2 first but changed it to 1, so I still think it&apos;s strange that it won&apos;t work with BEQ and BNE. :S<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__77">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 7, 2012 at 2:28:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>muffins</b></i><br>
	<br>
	I have one other question which involves loading the paddle sprites using a loop. What I would like is 4 of the same tiles stacked vertically to create a paddle. My current &quot;loop&quot; is this:<br>
	<br>
	Vertical_Offsets:<br>
	&#xA0; .db 0,8,16,24<br>
	&#xA0;<br>
	routine:<br>
	LDX #$00<br>
	LDY #0<br>
	<br>
	loop:<br>
	LDA paddle1ytop<br>
	CLC<br>
	ADC Vertical_Offsets,&#xA0;y ;;update paddle sprites<br>
	STA $0204, x<br>
	<br>
	LDA #$5B<br>
	STA $0205, x<br>
	<br>
	LDA #$01<br>
	STA $0206, x<br>
	<br>
	LDA #PADDLE1X<br>
	STA $0207, x<br>
	<br>
	INX<br>
	INX<br>
	INX<br>
	INX<br>
	<br>
	INY<br>
	CPY #$04<br>
	BNE loop<br>
	<br>
	RTS<br>
	<br>
	Where it&apos;s not really a loop because it just runs through once to display the top tile. I am not sure how to then shift everything up to the next set of addresses (which in my code would be multiplying the &quot;x&quot; value by 4 in each place, in addition to having to increase the paddle1ytop variable by 8 each run through the loop. Is what I&apos;m thinking possible or do I need to restructure my loop? I&apos;d rather not have to hard code this with no loops if possible.</div>
<br>
This isn&apos;t exactly pretty, but it should work.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__78">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Feb 8, 2012 at 5:19:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Seems like I still have some bugs with my paddles, how would I do<br> to check for a range of values in assembly? It&apos;s all<br>new to me, and I only know how to compare to one value<br>at a time, which I guess isn&apos;t very efficient. :/
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__79">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 8, 2012 at 12:53:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Basically:
<br>
<br>Routine:
<br>  LDA #$(lowest possible correct value)
<br>  BCC .End
<br>  LDA #$(highest possible correct value)
<br>  BCS .End
<br>;;do stuff
<br>.End:
<br>  RTS
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__80">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Feb 8, 2012 at 3:01:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks!<br><br>
Each paddle is 2 sprites, and they are stored in a variable like this:<br>
player1 .rs 2<br>
player2 .rs 2<br>
So for each player I want to check the values player(sprite 1 y value) and player+4(sprite 2 y value)+8.<br>
I tried with LDA player1+4+#$08, but obviously that didn&apos;t work. <span class="sprites_emoticons absmiddle" id="emo_tongue"></span><br>All stuff that is easy in say C++ is really weird in assembly if you are not used to it.<br>
Any good resource for learning that kind of essential stuff in assembly?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__81">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 8, 2012 at 5:03:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Add them all separately, then do the calculations. You can&apos;t find the difference between a memory location and a constant or two memory locations in one instruction. Load the width and constants, then do the memory additions. Remember (S)UB and Clear for addition.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__82">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 8, 2012 at 10:42:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	This isn&apos;t exactly pretty, but it should work.<br>
	&#xA0;</div>
<br>
Makes sense, I hadn&apos;t thought to store the offsets as data and refer to them.&#xA0; And you&apos;re right, definitely not pretty as far as doing 4 INXs haha.&#xA0; But, I think I can safely clean some of it up because I won&apos;t need to set tile number/attributes/x-pos every loop through NMI so I can move those out of that.&#xA0; Thanks! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__83">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 9, 2012 at 1:14:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Having some difficulty understanding why this collision code doesn&apos;t work:<br>
<br>
CheckPaddle1Collision:<br>
&#xA0; ;;if ball x &lt; paddle1x<br>
&#xA0; LDA ballx<br>
&#xA0; CMP #PADDLE1X<br>
&#xA0; BCS CheckPaddle1CollisionDone<br>
&#xA0; ;;&#xA0; if ball y &gt; paddle y top<br>
&#xA0; LDA bally<br>
&#xA0; CMP paddle1ytop<br>
&#xA0; BCC CheckPaddle1CollisionDone<br>
&#xA0; ;;&#xA0;&#xA0;&#xA0; if ball y &lt; paddle y bottom<br>
&#xA0; LDA bally<br>
&#xA0; CMP paddle1ybot<br>
&#xA0; BCS CheckPaddle1CollisionDone<br>
&#xA0; ;;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bounce, ball now moving right<br>
&#xA0; LDA #$01<br>
&#xA0; STA ballright<br>
&#xA0; LDA #$00<br>
&#xA0; STA ballleft<br>
CheckPaddle1CollisionDone:
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__84">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 9, 2012 at 2:23:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>muffins</b></i><br>
	<br>
	Having some difficulty understanding why this collision code doesn&apos;t work:<br>
	<br>
	CheckPaddle1Collision:<br>
	&#xA0; ;;if ball x &lt; paddle1x<br>
	&#xA0; LDA ballx<br>
	&#xA0; CMP #PADDLE1X<br>
	&#xA0; BCS CheckPaddle1CollisionDone<br>
	&#xA0; ;;&#xA0; if ball y &gt; paddle y top<br>
	&#xA0; LDA bally<br>
	&#xA0; CMP paddle1ytop<br>
	&#xA0; BCC CheckPaddle1CollisionDone<br>
	&#xA0; ;;&#xA0;&#xA0;&#xA0; if ball y &lt; paddle y bottom<br>
	&#xA0; LDA bally<br>
	&#xA0; CMP paddle1ybot<br>
	&#xA0; BCS CheckPaddle1CollisionDone<br>
	&#xA0; ;;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bounce, ball now moving right<br>
	&#xA0; LDA #$01<br>
	&#xA0; STA ballright<br>
	&#xA0; LDA #$00<br>
	&#xA0; STA ballleft<br>
	CheckPaddle1CollisionDone:</div>
Try doing one pixel more/less and see.&#xA0; Sometimes that seems to work for me. <span class="sprites_emoticons absmiddle" id="emo_smile"></span> (if this doesn&apos;t work, pretend I didn&apos;t suggest it.<br>
<br>
CheckPaddle1Collision:<br>
&#xA0; ;;if ball x &lt; paddle1x<br>
&#xA0; LDA ballx<br>
&#xA0; CLC<br>
&#xA0; ADC #$01<br>
&#xA0; CMP #PADDLE1X<br>
&#xA0; BCS CheckPaddle1CollisionDone<br>
&#xA0; ;;&#xA0; if ball y &gt; paddle y top<br>
&#xA0; LDA bally<br>
&#xA0; SEC<br>
&#xA0; SBC #$01<br>
&#xA0; CMP paddle1ytop<br>
&#xA0; BCC CheckPaddle1CollisionDone<br>
&#xA0; ;;&#xA0;&#xA0;&#xA0; if ball y &lt; paddle y bottom<br>
&#xA0; LDA bally<br>
&#xA0; CMP paddle1ybot<br>
&#xA0; BCS CheckPaddle1CollisionDone<br>
&#xA0; ;;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bounce, ball now moving right<br>
&#xA0; LDA #$01<br>
&#xA0; STA ballright<br>
&#xA0; LDA #$00<br>
&#xA0; STA ballleft<br>
CheckPaddle1CollisionDone:<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__85">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Feb 9, 2012 at 5:48:05 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>muffins</b></i><br>
	<br>
	Having some difficulty understanding why this collision code doesn&apos;t work:<br>
	<br>
	CheckPaddle1Collision:<br>
	&#xA0; ;;if ball x &lt; paddle1x<br>
	&#xA0; LDA ballx<br>
	&#xA0; CMP #PADDLE1X<br>
	&#xA0; BCS CheckPaddle1CollisionDone<br>
	&#xA0; ;;&#xA0; if ball y &gt; paddle y top<br>
	&#xA0; LDA bally<br>
	&#xA0; CMP paddle1ytop<br>
	&#xA0; BCC CheckPaddle1CollisionDone<br>
	&#xA0; ;;&#xA0;&#xA0;&#xA0; if ball y &lt; paddle y bottom<br>
	&#xA0; LDA bally<br>
	&#xA0; CMP paddle1ybot<br>
	&#xA0; BCS CheckPaddle1CollisionDone<br>
	&#xA0; ;;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bounce, ball now moving right<br>
	&#xA0; LDA #$01<br>
	&#xA0; STA ballright<br>
	&#xA0; LDA #$00<br>
	&#xA0; STA ballleft<br>
	CheckPaddle1CollisionDone:</div>
This is what I have at the moment, kinda buggy, but still my best attempt yet.&lt;br&gt;<br>
Player1Collisions:&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;LDA player1 ; paddle1 y position&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;CLC&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;ADC #$10 ; 2 sprites for every paddle, so add 16&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;STA ballCollY ; bottom of paddle &lt;br&gt;&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0;&#xA0; &#xA0;LDA player1&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;CMP ballPos+1 ; ball y position&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;BCS .return&lt;br&gt;&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0;&#xA0; &#xA0;LDA ballCollY&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;CMP ballPos+1&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;BCC .return&lt;br&gt;&lt;br&gt;<br>
<br>
&#xA0;&#xA0; &#xA0;LDA player1+3 ; paddle 1 x position&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;CMP ballPos ; ball x position&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;BCC .return&lt;br&gt;&lt;br&gt;<br>
<br>
&#xA0;&#xA0; &#xA0;LDA&#xA0; #$01&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;STA ballDirection+1 ; bD = up, bD+1 = down, bD+2 = left, bD+3 = right, 1 is off, 0 is on&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;STA ballDirection+2&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;LDA #$00&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;STA ballDirection&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;STA ballDirection+3&lt;br&gt;&lt;br&gt;<br>
<br>
.return:&lt;br&gt;<br>
&#xA0;&#xA0; &#xA0;RTS
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__86">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 9, 2012 at 11:00:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks guys! KHAN, I ended up tweaking your suggestion a bit and it worked. Due to the sprite&apos;s width I used 8 pixels instead of one. Also had to swap the additions with subtractions. Here&apos;s the final code which works perfectly:<br>
<br>
CheckPaddle1Collision:<br>
&#xA0; ;;if ball x &lt; paddle1x<br>
&#xA0; LDA ballx<br>
&#xA0; SEC<br>
&#xA0; SBC #$08<br>
&#xA0; CMP #PADDLE1X<br>
&#xA0; BCS CheckPaddle1CollisionDone<br>
&#xA0; ;;&#xA0; if ball y &gt; paddle y top<br>
&#xA0; LDA bally<br>
&#xA0; CLC<br>
&#xA0; ADC #$08<br>
&#xA0; CMP paddle1ytop<br>
&#xA0; BCC CheckPaddle1CollisionDone<br>
&#xA0; ;;&#xA0;&#xA0;&#xA0; if ball y &lt; paddle y bottom<br>
&#xA0; LDA bally<br>
&#xA0; SEC<br>
&#xA0; SBC #$08<br>
&#xA0; CMP paddle1ybot<br>
&#xA0; BCS CheckPaddle1CollisionDone<br>
&#xA0; ;;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; bounce, ball now moving right<br>
&#xA0; LDA #$01<br>
&#xA0; STA ballright<br>
&#xA0; LDA #$00<br>
&#xA0; STA ballleft<br>
CheckPaddle1CollisionDone:
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__87">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 9, 2012 at 12:38:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Haha, that&apos;s great.  I&apos;m glad you understood it enough to make it work with your game. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__88">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Feb 9, 2012 at 1:29:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Shit, thank you KHAN and muffins, I totally forgot to take the sprite width into account. &gt;-&lt;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__89">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 9, 2012 at 3:24:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah it&apos;s definitely something to look out for.  Different graphics systems use different graphics handles.  The NES PPU appears to place the coordinate of the sprite in the middle, which is the easiest in my opinion.  I&apos;ve seen certain systems use a handle in the upper left hand corner of the graphic which is a nightmare to code for.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__90">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Feb 9, 2012 at 3:32:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I thought the NES put the coordinates in the upper left corner. O_o<br>
Hmm, maybe that is why it still is acting a little strange from time to time for me, wrong calculations. <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__91">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 10, 2012 at 5:15:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	I thought the NES put the coordinates in the upper left corner. O_o<br>
	Hmm, maybe that is why it still is acting a little strange from time to time for me, wrong calculations.</div>
<br>
Nope.&#xA0; It is upper left.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__92">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 12, 2012 at 2:26:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>DoNotWant</b></i><br>
		<br>
		I thought the NES put the coordinates in the upper left corner. O_o<br>
		Hmm, maybe that is why it still is acting a little strange from time to time for me, wrong calculations.</div>
	<br>
	Nope.&#xA0; It is upper left.<br>
	&#xA0;</div>
<br>
My mistake! &#xA0;I&apos;m sure I would have figured it out soon enough when things started going haywire but I was thinking of it being in the middle all along. Probably would have come out in the wash in future, more complex collisions. I guess for pong it wasn&apos;t even noticeable <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__93">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 13, 2012 at 12:30:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve completed a functional pong game, and going through my code I can&apos;t help but feel like there&apos;s a more efficient way to code certain sections.  For example, I am very much wanting for reusable functions that I can pass variables to, like in the case of reading controllers.  When I press up, I want my paddle to go up.  If there are two paddles, I want to pass the function a variable that identifies what controller is receiving the input, and therefore which paddle gets moved as a result.  Is there a way to do this to avoid hard coding a lot of this stuff, or is what I&apos;m asking for simply one of the reasons modern languages exist?
<br>
<br>Here&apos;s an example of code specific for player 1 that cannot be reused for player 2 without copying the block of code and replacing all &quot;player 1&quot; variables with &quot;player 2&quot; variables:
<br>
<br>MovePaddle1Up:
<br>  LDA buttons1
<br>  AND #%00001000
<br>  BEQ MovePaddle1UpDone ; Use BEQ because zero flag will be set if result of AND operation is false
<br>  
<br>  ;;if up button pressed, move paddle up
<br>  LDA paddle1ytop
<br>  SEC
<br>  SBC paddle1speed
<br>  STA paddle1ytop
<br>  LDA paddle1ybot
<br>  SEC
<br>  SBC paddle1speed
<br>  STA paddle1ybot
<br>  
<br>  ;;  if paddle top &gt; top wall
<br>  LDA paddle1ytop
<br>  CMP #TOPWALL
<br>  BCS MovePaddle1UpDone
<br>  LDA #TOPWALL
<br>  STA paddle1ytop      ;set top tile y-coordinate to TOPWALL
<br>  CLC
<br>  ADC #$20             ;bottom of paddle is 32 pixels below TOPWALL, so have to keep it set there
<br>  STA paddle1ybot      ;otherwise, bottom y-coordinate will decrease when up is pushed
<br>MovePaddle1UpDone:
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__94">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 19, 2012 at 4:38:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Why do we enable NMI, sprites, background etc every time we enter another NMI frame? isn&apos;t it set once and stays set i.e. the bits are always a 1?
<br>How does this clean up the PPU section?
<br>
<br>;;:Set starting game state
<br>  LDA #STATEPLAYING
<br>  STA gamestate
<br>
<br>
<br>              
<br>  LDA #%10010000   ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1
<br>  STA $2000
<br>
<br>  LDA #%00011110   ; enable sprites, enable background, no clipping on left side
<br>  STA $2001
<br>
<br>Forever:
<br>  JMP Forever     ;jump back to Forever, infinite loop, waiting for NMI
<br>  
<br> 
<br>
<br>NMI:
<br>  LDA #$00
<br>  STA $2003       ; set the low byte (00) of the RAM address
<br>  LDA #$02
<br>  STA $4014       ; set the high byte (02) of the RAM address, start the transfer
<br>
<br>  JSR DrawScore
<br>
<br>  ;;This is the PPU clean up section, so rendering the next frame starts properly.
<br>  LDA #%10010000   ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1
<br>  STA $2000
<br>  LDA #%00011110   ; enable sprites, enable background, no clipping on left side
<br>  STA $2001
<br>  LDA #$00        ;;tell the ppu there is no background scrolling
<br>  STA $2005
<br>  STA $2005
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__95">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 19, 2012 at 9:57:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No, you can turn NMI and everything off when needed by just writing to $2000,$2001 again.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__96">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 19, 2012 at 1:02:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Basically if you turn off the screen anywhere in your game, to update the nametable or anything like that, it will turn everything back on in the NMI section, after everything is redrawn (hopefully).  So that&apos;s why he says it&apos;s a cleanup.
<br>
<br>If you turn the screen back on anywhere else, you&apos;d get lots of flickering.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__97">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 19, 2012 at 1:22:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Is this really only necessary with background updates and not sprites?  So far it&apos;s only been a noticeable help with background updates.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__98">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 19, 2012 at 1:29:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You need to set the scroll after you write to the PPU&apos;s address ($2006) register I believe. Other than that I don&apos;t believe anything else needs done.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__99">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 19, 2012 at 1:55:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					As far as sprites are concerned, I basically either move them off screen or reposition them between screens, depending on what I&apos;m trying to do.  You could probably turn sprites off and back on, but I don&apos;t really see a purpose in that.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__100">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 21, 2012 at 2:48:48 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m trying to compress my code for loading/moving paddle sprites. I&apos;m using 6 tiles for each paddle.<br>
In my code to move the paddles, I&apos;ve made it so I run a subroutine to take care of the middle paddle sprites.<br>
I&apos;m using a 4 byte variable for the middle sprites, I have 2 separate variables for the top and bottom sprites which I use for collision detection with the border.<br>
This is my current move paddle up code:<br>
<br>
MovePaddleUp:<br>
&#xA0;&#xA0;&#xA0; LDX #$00<br>
;;if up button pressed<br>
&#xA0;&#xA0;&#xA0; LDA buttons1 ; 3rd bit is up. Don&apos;t care about other bits.<br>
&#xA0;&#xA0;&#xA0; AND #%00001000 ; if it isn&apos;t pressed the zero flag is set so we skip.<br>
&#xA0;&#xA0;&#xA0; BEQ MovePaddleUpDone ; Up button wasn&apos;t pressed skip code.<br>
TopPaddle<br>
&#xA0;&#xA0;&#xA0; LDA paddle1ytop<br>
&#xA0;&#xA0;&#xA0; SEC<br>
&#xA0;&#xA0;&#xA0; SBC #$01<br>
&#xA0;&#xA0;&#xA0; STA paddle1ytop<br>
<br>
&#xA0;&#xA0;&#xA0; JSR UpPaddleNext ; jump to subroutine for the inbetween paddles.<br>
<br>
&#xA0;&#xA0;&#xA0; LDA paddle1ybot<br>
&#xA0;&#xA0;&#xA0; SEC<br>
&#xA0;&#xA0;&#xA0; SBC #$01<br>
&#xA0;&#xA0;&#xA0; STA paddle1ybot<br>
BottomPaddle<br>
;; if paddle top &gt; top wall<br>
;; move paddle top and bottom up<br>
MovePaddleUpDone:<br>
<br>
Here is the subroutine:<br>
&#xA0;&#xA0;&#xA0; LDX #$00<br>
UpPaddleNext:<br>
&#xA0;&#xA0;&#xA0; LDA paddle1ynext,x<br>
&#xA0;&#xA0;&#xA0; SEC<br>
&#xA0;&#xA0;&#xA0; SBC #$01<br>
&#xA0;&#xA0;&#xA0; STA paddle1ynext,x<br>
&#xA0;&#xA0;&#xA0; INX ; go to next byte in paddle1ynext?<br>
&#xA0;&#xA0;&#xA0; CPX $03<br>
&#xA0;&#xA0;&#xA0; BNE UpPaddleNext<br>
RTS<br>
I think the problem lies in my subroutine or my initialising of variables which is below, is it possible to access the next byte of memory stored in my variable with the above syntax?<br>
<br>
I initialise the variables in the 4 byte variable as follows:<br>
<br>
&#xA0; LDA #$68<br>
&#xA0; STA paddle1ynext<br>
<br>
&#xA0; LDA #$70<br>
&#xA0; STA paddle1ynext+1<br>
<br>
&#xA0; LDA #$78<br>
&#xA0; STA paddle1ynext+2<br>
<br>
&#xA0; LDA #$80<br>
&#xA0; STA paddle1ynext+3<br>
<br>
Is that correct syntax? I thought I&apos;ve seen it somewhere.<br>
<br>
Basically what is happening on screen is that some of the paddle sprite appears at the top and bottom of the screen, not a full tile just a small section. Then it goes completely offscreen, then the full paddle comes together for a second and I can move it together as I intend. But if I keep moving it up the top sprite of the paddle goes above all the rest creating a gap. Could this be related to Vblank time?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__101">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 21, 2012 at 7:34:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					A few things:  What are &quot;TopPaddle&quot; and &quot;BottomPaddle&quot;?  Variables, labels?  Nothing seems to be happening with them, no reference elsewhere.  Maybe I don&apos;t know of an alternate syntax for what you use them for because I would think those would throw compiler errors.
<br>
<br>Secondly, I assume you have a block of code that takes the values stored in paddle1ytop, paddle1ybot, paddle1ynext, +1, +2, +3 and then puts them into the sprite memory (i.e. at $0204, $0208, etc.) otherwise changing these variables wouldn&apos;t be helping change what is on the screen.
<br>
<br>Lastly, and I think this is the issue - LDX #$00 should come after the UpPaddleNext: label in your subroutine.  Otherwise it never clears the X register out because the JSR goes right to the label, and whatever happens to be in X is whatever you use as your starting index from there onward.  I think that is what is causing the weird behavior.
<br>
<br>Dan
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__102">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 21, 2012 at 1:12:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There&apos;s something very wrong with your sprites page writes it looks like, look at it in the hex editor. Good luck finding it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__103">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 21, 2012 at 1:36:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Should it be CPX #$03 and not CPX $03?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__104">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 21, 2012 at 4:06:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Good call KHAN.  Also I was wrong about the LDX comment.  It does need to be cleared before looping but shouldn&apos;t be under the label you have. Rather you should be jumping to a label above the LDX #$00 instruction, then once the loop is started you loop to the label you currently have in your code.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__105">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 21, 2012 at 6:58:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You guys are so awesome <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>TopPaddle and BottomPaddle were just old labels I had, I&apos;ve gotten rid of them now.
<br>
<br>I update all the sprites elsewhere in my code, exactly how you mentioned.
<br>
<br>Good point about LDX, I&apos;m lucky that works because X is put to #$00 before I enter that subroutine, so the way I wrote it above the label serves no purpose as you mentioned. I&apos;ll make another label there for more defensive programming, thanks for pointing that out.
<br>
<br>Changing the compare fixed it straight away!, awesome spot! I&apos;ve been caught out with that before, I&apos;ll be much more careful in the future. Thanks again guys!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__106">
                                                        <div class="mdl-card__title"><strong>Drakon</strong> posted on 
		
			
				
				Feb 21, 2012 at 7:24:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					go glenn gooo!  Make awesome pong and then....something even more awesome!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__107">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 21, 2012 at 9:35:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hmm, now I have a collision issue,I&apos;m certain this time it&apos;s just a syntax thing. Am I using CMP correctly with variables? I&apos;m sure my logic is right, because if ballx <paddle1x and as ball checkpaddlecollision: code for functions i idea if m my others. same the then using x>&lt; paddle1x in my first check, the code executes as I want.</paddle1x><br>
<br>
CheckPaddleCollision:<br>
&#xA0; ;;if ball x &lt; paddle1x<br>
&#xA0; LDA ballx&#xA0;&#xA0;&#xA0;<br>
&#xA0; CMP #PADDLE1X<br>
&#xA0; BCS CheckPaddleCollisionDone ; PADDLE1X=PADDLE1X-ballx, if ballx<paddle1x carry code. execute no so><br>
&#xA0; ;;if bally &gt; paddleytop<br>
&#xA0; LDA bally<br>
&#xA0; CMP #paddle1ytop<br>
&#xA0; BCC CheckPaddleCollisionDone ; paddle1ytop=paddle1ytop-bally, if bally&gt;paddletop then carry so execute code. If bally<paddleytop code. skip><br>
&#xA0; ;;if bally &lt; paddleybot<br>
&#xA0; LDA bally<br>
&#xA0; CMP #paddle1ybot&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; BCS CheckPaddleCollisionDone ; paddleybot=paddleybot-bally, if bally<paddlebot carry code. execute no so><br>
&#xA0; ;;Bounce ball now.<br>
&#xA0; LDA #$01<br>
&#xA0; STA ballright&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; ball now moves right on next NMI.<br>
&#xA0; LDA #$00<br>
&#xA0; STA ballleft&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;;bounce, ball now moving right<br>
CheckPaddleCollisionDone:<paddle1x and as ball checkpaddlecollision: code for functions i idea if m my others. same the then using x></paddle1x></paddlebot></paddleytop></paddle1x><br>
<br>
*EDIT*<br>
I think I&apos;ve got my subtracts around the wrong way in my comments, CMP performs a SUB the same way except it isn&apos;t stored in memory, I&apos;ve thought of it back-to-front that may be the problem.<br>
<br>
*EDIT*<br>
Fixed!! That damn CMP got me again! I should be using CMP &quot;varname&quot; not CMP # &quot;varname&quot;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__108">
                                                        <div class="mdl-card__title"><strong>muffins</strong> posted on 
		
			
				
				Feb 21, 2012 at 10:21:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Remove the # sign and you&apos;ll be all set.  It will substitute the value at that memory address for the variable, not the address of the variable itself.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__109">
                                                        <div class="mdl-card__title"><strong>glenn101</strong> posted on 
		
			
				
				Feb 21, 2012 at 10:30:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Your exactly right muffins, I just realised that around a minute ago!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__110">
                                                        <div class="mdl-card__title"><strong>DomNes</strong> posted on 
		
			
				
				Mar 2, 2012 at 10:45:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sup all just want to say first that those tutorials are amazing!! thanks alot!
<br>
<br>Now i have a couple of questions so far..
<br>
<br>1. How can you clear the sprites?? when i come back to the title screen after any players have 15 points, the sprites are still on the screen with the title screen since i only updated the title background...
<br>
<br>2. Now when players have 15 points, i enter the gameover state in which i just stop moving the sprites and wait for a player the press A, and in the title screen waiting to press START. The problem is if i put both Gameover and Title state to press Start.. even if you press quickly (lol) it will pass both state.. is there a way to keep START button for both screen but not passing over the title screen. Something like making sur the buttons are unpressed before you pressed START again.
<br>
<br>Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__111">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Mar 2, 2012 at 11:03:32 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Question 1: Use 2 kinds of game states, one for the logic in the infinite loop, and one for the NMI, say you call them TitleLogic/TitleNMI, PlayingLogic/PlayingNMI e.t.c.
<br>Then you just don&apos;t transfer the sprites with DMA in the game states you don&apos;t want sprites in.
<br>
<br>Question 2: <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22776" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=22776">http://www.nintendoage.com/forum/...</a>
<br>Nothing about it in the tutorial, but look in the source code how he handle input there.
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__112">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Mar 2, 2012 at 11:42:05 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					1:<br>
LDX #$00<br>
Loop:<br>
LDA #$FF<br>
STA $0300,x (or wherever your sprites are)<br>
INX<br>
CPX #$FF (or however many sprites you&apos;re using)<br>
BNE Loop<br>
RTS<br>
<br>
2. Just create a flag in the zero page and set it to 1 when a button is pressed. If the flag is still 1, skip the controller reading routine. When you release the button, set the flag to 0.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__113">
                                                        <div class="mdl-card__title"><strong>DomNes</strong> posted on 
		
			
				
				Mar 2, 2012 at 2:44:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					1: if i understand well... putting the four settings of a sprites at $0200, x    to $FF will &quot;clear/delete&quot; the sprites?
<br>
<br>2: i havent looked yet at the code but i will soon.
<br>   Even with a fully working pong i dont know what is a flag :S 
<br>
<br>ty for quick reply
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__114">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Mar 2, 2012 at 3:40:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DomNes</b></i><br>
	<br>
	1: if i understand well... putting the four settings of a sprites at $0200, x to $FF will &quot;clear/delete&quot; the sprites?<br>
	&#xA0;</div>
<br>
Yes. &#xA0;Actually, technically you only need to set the sprites&apos; Y coordinate values to a high value so they will be offscreen. &#xA0;But it&apos;s common to write #$FE or whatever to all sprite attributes because it&apos;s not worth the trouble to isolate every 4th index.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__115">
                                                        <div class="mdl-card__title"><strong>DomNes</strong> posted on 
		
			
				
				Mar 3, 2012 at 12:41:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					ohhh great to know!!
<br> 
<br>and i have looked at the code for the joypad and basicly you just skip the instruction if you are pressing the same button as the previous frame.
<br>
<br>Ive got an other question!
<br>Let&apos;s say i want to make a game with a gun, the gun would shoot 1 bullet (sprite) every half second if i hold the A button... how do i do that?
<br>I&apos;ve read that their is 60 frame per second so basicly it reads the code 60 times per second??
<br>So could i do a counter and just fire everytime the counter hit 30 then reset the count blablabla.
<br>Or am I completly misunderstanding the situation here lol
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__116">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Mar 3, 2012 at 3:53:11 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No, you&apos;re right on.
<br>
<br>;;A Held? JSR Routine
<br>
<br>Routine:
<br>LDA Timer
<br>CMP #$30
<br>BCS .Shoot
<br>INC Timer
<br>RTS
<br>.Shoot:
<br>;;shoot code
<br>LDA #$00
<br>STA Timer
<br>RTS
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__117">
                                                        <div class="mdl-card__title"><strong>JC-Dragon</strong> posted on 
		
			
				
				Jul 7, 2012 at 8:32:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					it was inevitable but here I am asking for help again. I&apos;m trying to map my controller to move sprites for the paddles. I can get a sprite to move but with the wrong button.<br>
MovePaddleUp:<br>
LDA buttons1<br>
AND #$00001000 &lt;--------- this is supposed to be the up button but NESASM throws an error at me when I do this<br>
BEQ MovePaddleUpDone ; but if I change it to #$00000010, or #$00000001 it works but with start<br>
LDA $0204 ; and right respectively is there something else I need to do to get this to work correctly before hand?<br>
SEC<br>
SBC #$01 ; if up button pressed<br>
CMP #TOPWALL<br>
STA $0204 ; if paddle top &gt; top wall ; move paddle top and bottom up<br>
<br>
-----EDIT----<br>
<br>
figured it out&#xA0; #$00001000 is supposed to be #%00001000. got the $ and the % mixed up.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__118">
                                                        <div class="mdl-card__title"><strong>DC</strong> posted on 
		
			
				
				Aug 2, 2012 at 7:59:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					After a game over the game shortly plays and crashes. I can&apos;t get the collision date to work either.
<br>
<br><a href="http://pastebin.com/5X1Us01D" target="_blank" original-href="http://pastebin.com/5X1Us01D">http://pastebin.com/5X1Us01D...</a>
<br>
<br>Help please.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__119">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Aug 3, 2012 at 10:29:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It would really help if you provided a ROM just so we could see what is going on rather than trying to figure out what &quot;after a game over the game shortly plays and crashes&quot; means. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__120">
                                                        <div class="mdl-card__title"><strong>DC</strong> posted on 
		
			
				
				Aug 3, 2012 at 2:21:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok<br>
<br>
<a href="http://depositfiles.com/files/7gv4xpdfw" target="_blank" original-href="http://depositfiles.com/files/7gv4xpdfw">http://depositfiles.com/files/7gv...</a><br>
<br>
Another person caught the freezing problem. The Nmi was filling up the stack. New code:<br>
<br>
<a href="http://pastebin.com/uL1vFmDL" target="_blank" original-href="http://pastebin.com/uL1vFmDL">http://pastebin.com/uL1vFmDL</a>
<br>
The collision data fails to work I can&apos;t figure out why :/.The code to make the ball bounce seems to work.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__121">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Aug 3, 2012 at 3:39:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I suck at fixing other people&apos;s code.  Typically it doesn&apos;t work because you mess up a BCS or BCC.  Like get them backwards.  It helps to draw it out.
<br>
<br>If NMI fills up the stack, you have an open JSR/RTS loop somewhere.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__122">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Aug 3, 2012 at 4:33:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					One thing that&apos;s jumping out at me is at the end of your gamestates, you&apos;re doing a JMP straight back to your GameEngine, where you should be doing a JMP to GameEngineDone.  I don&apos;t think your code is even getting to any of your other subroutines.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__123">
                                                        <div class="mdl-card__title"><strong>DC</strong> posted on 
		
			
				
				Aug 3, 2012 at 5:21:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I got a JMP GameEngineDone at the end of EnginePlaying.<br>
<br>
The code:<br>
<br>
CheckPaddleCollision:<br>
LDA ballx<br>
CMP #PADDLE1X+8<br>
BCS CheckPaddleCollisionDone ;;if ball x &gt; left wall, still on screen, skip next section<br>
LDA bally<br>
CMP paddle1y+2<br>
BCS CheckPaddleCollisionDone ;;if ball y &gt; top wall, still on screen, skip next section<br>
LDA bally<br>
CMP paddle1y2+2<br>
BCC CheckPaddleCollisionDone ;;if ball y &lt; bottom wall, still on screen, skip next section<br>
LDA #$01<br>
STA ballright<br>
LDA #$00<br>
STA ballleft ;;bounce, ball now moving right<br>
JMP CheckPaddleCollisionDone<br>
CheckPaddleCollisionDone:<br>
RTS<br>
<br>
Seems right to me.<br>
<br>
Finished:<br>
<br>
<a href="http://pastebin.com/cZAUUTfH" target="_blank" original-href="http://pastebin.com/cZAUUTfH">http://pastebin.com/cZAUUTfH</a>
<br>
Any tips for optimization?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__124">
                                                        <div class="mdl-card__title"><strong>Beep Boop!</strong> posted on 
		
			
				
				Sep 28, 2012 at 7:03:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m at a loss... I need to display a number using a background tile on the title screen... but graphics are only uploaded to the PPU memory once on the init code (before the JMP Forever loop). Can someone help me? Do I need to reupload BG data frame-by-frame?<br>
<br>
Edit: ooh never mind, didn&apos;t notice that you could set the PPU writing address to anywhere you wanted to. Cool <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__125">
                                                        <div class="mdl-card__title"><strong>JKeefe56</strong> posted on 
		
			
				
				Dec 23, 2012 at 11:54:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry, I&apos;ve been stuck here for almost a week.  
<br>
<br>&quot;Title State:
<br>  if start button pressed
<br>    turn screen off
<br>    load game screen
<br>    set paddle/ball position
<br>    go to Playing State
<br>    turn screen on&quot;
<br>
<br>I can&apos;t figure out this one.  How does one turn the screen off?  And, back on again?
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__126">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Dec 23, 2012 at 11:57:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You use the PPUMask ($2001) register. You disable rendering in vblank. (Outside of vblank will cause cheap and shitty looking screen tearing) (NOTE: You must stop background AND sprite rendering, not one or the other) But then you upload the other screen (the nametable) and then wait for vblank and turn on the screen again with PPUMask. Make sense? <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__127">
                                                        <div class="mdl-card__title"><strong>JKeefe56</strong> posted on 
		
			
				
				Dec 24, 2012 at 12:05:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hahahaha not entirely, but if I look at the examples, they must all be turning the screen on to start? so I have a general idea of where to go...I think!  Thank you.
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__128">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Dec 24, 2012 at 12:09:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					WHat don&apos;t you get? The reason you have to shut off the screen, though, is because write to $2007 during rendering get trashed, so you can&apos;t do it. So you have to turn the screen off. : And to start, yeah, they do I believe. Just look at it I guess. <span class="sprites_emoticons absmiddle" id="emo_smile"></span> Need any help just post.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__129">
                                                        <div class="mdl-card__title"><strong>JKeefe56</strong> posted on 
		
			
				
				Dec 24, 2012 at 12:18:06 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, so, I&apos;m thinking it would be:
<br>
<br>LDA #%00000000
<br>STA $2001
<br>
<br>To turn it off?  Or is that just &quot;changing the settings&quot; for lack of knowing a better term?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__130">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Dec 24, 2012 at 12:25:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, that&apos;s all ya do. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__131">
                                                        <div class="mdl-card__title"><strong>JKeefe56</strong> posted on 
		
			
				
				Dec 24, 2012 at 12:26:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks! appreciate the help!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__132">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				Dec 27, 2012 at 3:33:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Can anyone help me (or point me in the right direction):<br>
<br>
I changed the ball speed to 2/3/4/5/6 to make it go faster.<br>
But at these higher speeds, the ball will change direction before or after the &quot;walls&quot; I programmed.<br>
They seem to have an offset. For the right and top wall it will change direction before it should hit the wall. And for the left and bottom wall it will change direction after it should hit the wall.<br>
<br>
(I think) I know why it does this ==&gt; If the ball is, for example, 1 pixel before the wall ==&gt; No collision ==&gt; Increase the position of the ball with 5 (speed of the ball).<br>
This means that the ball will be bounced and shown 4 pixels beyond the wall. But I don&apos;t know why the ball will change direction before hitting the right and top wall, but it will most likely have something to do with the difference in subtracting (right/top wall) and adding (left and bottom wall) the speed ?<br>
<br>
<br>
My first thought (and attempt to fix it) was to create a loop for the movement + collision checking and have it repeat X amount of times.<br>
<br>
Pseudo code:<br>
While x not equal to speed<br>
Move by 1 pixel (left/right/up/down)<br>
Check collision (if wall is hit ==&gt; reverse directions)<br>
Increase X<br>
<br>
This code would make the sprite move by 1 pixel a time and check every time if it hit&apos;s a wall and change direction.<br>
So I tried to code it but it didn&apos;t seem to work (or I implemented it wrong)<br>
<br>
Is this the correct way to solve my problem ? (before I put a lot of time figuring out how to implement the code correctly)&#xA0;<br>
Also; at which frequency will my game run ? At 50/60 fps (when the NMI resets) ? Is it then usefull to create the loop ?&#xA0;<br>
<br>
<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__133">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Dec 27, 2012 at 4:50:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Games will run at 50Hz on a PAL NES, and 60HZ on a NTSC NES.
<br>
<br>As for it being after the wall, make sure you&apos;re doing your compares right. It&apos;s possible it&apos;s doing it because at 6 pixels, it&apos;s a far distance to cover each frame so it won&apos;t actually be seen hitting the wall when it goes past it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__134">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 27, 2012 at 7:01:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you&apos;re moving the ball 5 pixels per frame, it may miss your compare completely if you&apos;re doing a branch if equal.  Make sure you&apos;re doing a branch if greater/less than!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__135">
                                                        <div class="mdl-card__title"><strong>KennyB</strong> posted on 
		
			
				
				Dec 28, 2012 at 6:24:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	Games will run at 50Hz on a PAL NES, and 60HZ on a NTSC NES.<br>
	<br>
	As for it being after the wall, make sure you&apos;re doing your compares right. It&apos;s possible it&apos;s doing it because at 6 pixels, it&apos;s a far distance to cover each frame so it won&apos;t actually be seen hitting the wall when it goes past it.</div>
<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	If you&apos;re moving the ball 5 pixels per frame, it may miss your compare completely if you&apos;re doing a branch if equal. Make sure you&apos;re doing a branch if greater/less than!</div>
<br>
I used the BCC and BCS instructions after a CMP. So they will branch if greater/less than.&#xA0;<br>
<br>
&#xA0;CheckCollisionRight:<br>
<div>
	&#xA0; LDA boxRightX<span class="Apple-tab-span" style="white-space&lt;span class=" sprites_emoticons absmiddle" id="emo_tongue"></span>re&quot;&gt; </div>
<div>
	&#xA0; CMP #RIGHTWALL</div>
<div>
	&#xA0; BCC CheckCollisionRightSkipper <span style="color:#008000;">; </span><span style="color:#ff0000;">if A &lt; RIGHTWALL ==&gt; Carry is set to 0 ==&gt;jump to label and skip over the direction change. If A &gt;= RIGHTWALL ==&gt; Carry = 1 ==&gt; No jump to label and run change direction code</span></div>
<div>
	&#xA0; LDA #$00</div>
<div>
	&#xA0; STA ballright</div>
<div>
	&#xA0; LDA #$01</div>
<div>
	&#xA0; STA ballleft &#xA0;&#xA0;</div>
<div>
	&#xA0; CheckCollisionRightSkipper:</div>
<div>
	&#xA0; JMP CheckCollisionRightDone<span class="Apple-tab-span" style="white-space&lt;span class=" sprites_emoticons absmiddle" id="emo_tongue"></span>re&quot;&gt; </div>
<div>
	&#xA0;&#xA0;</div>
<div>
	CheckCollisionLeft:</div>
<div>
	&#xA0; LDA boxLeftX</div>
<div>
	&#xA0; CMP #LEFTWALL</div>
<div>
	&#xA0; BCS CheckCollisionLeftSkipper &#xA0; &#xA0;<span style="color: rgb(0, 128, 0);">;&#xA0;</span><span style="color: rgb(255, 0, 0);">if A &gt;= &#xA0;RIGHTWALL ==&gt; Carry is set to 1 ==&gt;jump to label and skip over the direction change. If A &lt; RIGHTWALL ==&gt; Carry = 0&#xA0;</span><span style="color: rgb(255, 0, 0);">==&gt; No jump to label and run change direction code</span></div>
<div>
	&#xA0; LDA #$01</div>
<div>
	&#xA0; STA ballright</div>
<div>
	&#xA0; LDA #$00</div>
<div>
	&#xA0; STA ballleft&#xA0;</div>
<div>
	&#xA0; CheckCollisionLeftSkipper:</div>
<div>
	&#xA0; JMP CheckCollisionLeftDone<span class="Apple-tab-span" style="white-space&lt;span class=" sprites_emoticons absmiddle" id="emo_tongue"></span>re&quot;&gt;<br>
	<br>
	<br>
	So the ball always bounces. But at the higher speeds, it often bounces to soon or to late. I&apos;m thinking that it&apos;s impossible to eliminate this problem as it only updates at 50/60 Hz.<br>
	If the ball is 1 pixel before the wall in frame 1 ==&gt; no hit ==&gt; no change of direction.<br>
	In the next frame the ball will be 4 pixels behind the wall ==&gt; it will branch ==&gt; change direction. But it will still update the sprite for that frame and it will show it 4 pixels behind the wall.&#xA0;<br>
	<br>
	And If I create a loop which will update the location of the ball one pixel a time, it will slow down my ball :<br>
	==&gt; frame 1 ==&gt; loop 1 ==&gt; 1 pixel moved&#xA0;<br>
	==&gt; frame 2 ==&gt; loop 2 ==&gt; 1 pixel moved<br>
	==&gt; frame 3 ==&gt; loop 3 ==&gt; 1 pixel moved<br>
	==&gt; frame 4 ==&gt; loop 4 ==&gt; 1 pixel moved<br>
	==&gt; frame 5 ==&gt; loop 5 ==&gt; 1 pixel moved<br>
	<br>
	So in the end we still need 5 frames to perform 5 loops and we move only 5 pixels ==&gt; which is exactly the same as moving 1 pixel a frame (or at a speed of 1 instead of 5).<br>
	<br>
	<br>
	<br>
	&#xA0;</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__136">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Dec 28, 2012 at 1:06:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, it&apos;s happening because the movement is so great that you don&apos;t see it hit, but it hit anyway because it went past the paddle anyway.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__137">
                                                        <div class="mdl-card__title"><strong>LucasWeatherby</strong> posted on 
		
			
				
				Jan 3, 2013 at 11:45:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					After a very long hiatus, I am back again to take another stab at programming. I have control of the paddles and the collision detection working. I am really struggling here with drawing the score to the background. After my UpdateSprites routine I have:
<br>
<br>DrawScore:
<br>  
<br>  LDX #$01       
<br>  LDA palette, x        
<br>  STA $2007 
<br>  RTS
<br>
<br>
<br>where the palette looks like this:
<br>
<br>palette:
<br>  .db $00,$01,$02,$03,  $22,$36,$17,$0F,  $22,$30,$21,$0F,  $22,$27,$17,$0F   ;;background palette
<br>  .db $22,$1C,$15,$14,  $22,$02,$38,$3C,  $22,$1C,$15,$14,  $22,$02,$38,$3C   ;;sprite palette
<br>
<br>
<br>It draws the number 1 to the background like I wanted. (eventually ill add the logic for the score instead of statically loading it) but right now I am struggling with the location of the score. For some reason it ends up in the bottom left corner. I cant figure out how to specify the location of a tile for the background. In the previous tutorial, you could specify the background locations by how the palettes were arranged but it was like a one time load and it wasnt changing. This is why I am confused
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__138">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jan 3, 2013 at 11:59:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Are you properly setting the location to PPU RAM/Screen RAM that you want it to display at? Plus that could be written as palette+1 since there&apos;s no loop, you don&apos;t need X. I don&apos;t exactly get what the palette means, though, as...it should be written to 3F00 inside PPU RAM, and then that&apos;s it. You don&apos;t need to touch the palette data after that. You need to display tiles, not colors. To put a score to a where it&apos;s just a single digit in two places where Score is an array of 2 bytes in RAM,byte 0 being the left player:<br>
<br>
PPUAddr=$2006;<br>
PPUData=$2007<br>
LDA #$20;Screen location for first digit of score<br>
STA PPUAddr<br>
LDA #$4E;Location. Locations $204F and $2050 are both going to be either blank, or a DASH to seperate the digits<br>
LDX Score<br>
LDA ScoreDigitTiles,X<br>
STA PPUData ;Store to 1st character to screen.<br>
LDA PPUData&#xA0;<br>
LDA PPUData;Move 2 bytes of the screen location.<br>
LDA Score+1<br>
LDA ScoreDigitTiles,X<br>
STA PPUData ;Store 2nd character to screen.<br>
(RTS,JMP,Other code, anything to keep it seperate)&#xA0;<br>
<br>
(Code data)<br>
ScoreDigitTIles:<br>
&#xA0; .db $ZeroTileNumber,$OneTileNumber ;Etc. You&apos;d need to fill this out.<br>
<br>
Or if you have the tiles in ROM that start at a number and go from 0 to 9, then you could also do this:<br>
<br>
LDA Score<br>
CLC<br>
ADC #$00 ;TIle start number here.<br>
<br>
which will produce the right digit.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__139">
                                                        <div class="mdl-card__title"><strong>LucasWeatherby</strong> posted on 
		
			
				
				Jan 4, 2013 at 1:11:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/6866/photobucket/29BE2812-0764-A1D8-8C7090A473F7FB11.jpg" show-src="scraper/images/29BE2812-0764-A1D8-8C7090A473F7FB11.jpg"><br>
<br>
I definitely understand for the most part what your code is trying to accomplish. I was easily able to add it to my code. However, it still puts that score in the bottom left corner. Thats exactly where I was writing the numbers to before. I see how &apos;LDA PPUData&apos; allows for horizontal adjustment. But I&apos;m really trying to get this score to the top of the screen. Is there more information on the vertical adjustment somewhere.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__140">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jan 4, 2013 at 1:13:02 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					How about upload a clear background with a border. Make sure that your scrolling is correct. check fceux in windows, because if that code doesn&apos;t put it on the top of your screen after you modify it but keep the location, then your scroll is off.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__141">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jan 4, 2013 at 11:22:32 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You would have to be writing to like $2300 for your score to be writing way down there.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__142">
                                                        <div class="mdl-card__title"><strong>m308gunner</strong> posted on 
		
			
				
				Feb 5, 2013 at 12:50:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Would some kind soul be able to send me an asm file with all the missing sections of code filled in for the first pong program? I&apos;m hoping to kind of &quot;reverse engineer&quot; the completed file to see how it is supposed to work.<br>
<br>
&#xA0; EDIT: Never mind! Good thing no one gave me what I wanted or I would have missed out on some hard earned know-how!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__143">
                                                        <div class="mdl-card__title"><strong>LucasWeatherby</strong> posted on 
		
			
				
				Apr 2, 2013 at 12:42:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div>
	Ok, I know I&apos;m the most sporatic visitor to this page but whatever. &#xA0;I still do try when I have the time.<br>
	<br>
	<div class="FTQUOTE" style="width: 1011.21533203125px; font-size: 12.222222328186035px;">
		<i>Originally sent by:&#xA0;<b>3GenGames</b></i><br>
		<br>
		Yeah, you have to set $2000 and $2005 each frame. Writing to $2006 basically rewrites the scroll because of how the PPU reuses some bits, so after you do $2006 write, you HAVE to rewrite $2000 (Nametable selection/NMI enable) and then the 2x $2005 writes, or else the scroll will be wrong.</div>
	3Gen gave me some advice, but I am pretty sure I have done this as you can see in the code snippets below:<br style="font-size: 12.222222328186035px;">
	<br>
	Hmmm...Ive tried uploading my code in an attached file but NA seems to be having some problems with that. So I will paste the important parts:</div>
<div>
	<br>
	<br>
	[This is the NMI Section]<br>
	<div class="FTQUOTE" style="width: 1011.21533203125px; font-size: 12.222222328186035px;">
		<div>
			NMI:</div>
		<div>
			&#xA0; LDA #$00</div>
		<div>
			&#xA0; STA $2003 &#xA0; &#xA0; &#xA0; ; set the low byte (00) of the RAM address</div>
		<div>
			&#xA0; LDA #$02</div>
		<div>
			&#xA0; STA $4014 &#xA0; &#xA0; &#xA0; ; set the high byte (02) of the RAM address, start the transfer</div>
		<div>
			&#xA0;</div>
		<div>
			&#xA0; JSR DrawScore</div>
		<div>
			&#xA0;</div>
		<div>
			&#xA0; ;;This is the PPU clean up section, so rendering the next frame starts properly.</div>
		<div>
			&#xA0; LDA #%10010000 &#xA0; ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1</div>
		<div>
			&#xA0; STA $2000</div>
		<div>
			&#xA0; LDA #%00011110 &#xA0; ; enable sprites, enable background, no clipping on left side</div>
		<div>
			&#xA0; STA $2001</div>
		<div>
			&#xA0; LDA #$00 &#xA0; &#xA0; &#xA0; &#xA0;;;tell the ppu there is no background scrolling</div>
		<div>
			&#xA0; STA $2005</div>
		<div>
			&#xA0; STA $2005</div>
		<div>
			&#xA0; &#xA0;&#xA0;</div>
		<div>
			&#xA0; ;;;all graphics updates done by here, run game engine</div>
		<div>
			&#xA0;</div>
		<div>
			&#xA0;</div>
		<div>
			&#xA0; JSR ReadController1 &#xA0;;;get the current button data for player 1</div>
		<div>
			&#xA0; JSR ReadController2 &#xA0;;;get the current button data for player 2</div>
		<div>
			&#xA0;&#xA0;</div>
		<div>
			GameEngine: &#xA0;</div>
		<div>
			&#xA0; LDA gamestate</div>
		<div>
			&#xA0; CMP #STATETITLE</div>
		<div>
			&#xA0; BEQ EngineTitle &#xA0; &#xA0;;;game is displaying title screen</div>
		<div>
			&#xA0; &#xA0;&#xA0;</div>
		<div>
			&#xA0; LDA gamestate</div>
		<div>
			&#xA0; CMP #STATEGAMEOVER</div>
		<div>
			&#xA0; BEQ EngineGameOver &#xA0;;;game is displaying ending screen</div>
		<div>
			&#xA0;&#xA0;</div>
		<div>
			&#xA0; LDA gamestate</div>
		<div>
			&#xA0; CMP #STATEPLAYING</div>
		<div>
			&#xA0; BEQ EnginePlaying &#xA0; ;;game is playing</div>
		<div>
			GameEngineDone: &#xA0;</div>
		<div>
			&#xA0;&#xA0;</div>
		<div>
			&#xA0; JSR UpdateSprites &#xA0;;;set ball/paddle sprites from positions</div>
		<div>
			&#xA0; RTI &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; return from interrupt</div>
	</div>
</div>
<br>
[Now Here is the DrawScore Subroutine]<br>
<br>
<br>
<div>
	<div class="FTQUOTE" style="width: 1011.21533203125px; font-size: 12.222222328186035px;">
		<div>
			DrawScore:</div>
		<div>
			&#xA0; ;;;;;;;;;;;What I originally tried</div>
		<div>
			&#xA0; ;LDX #$01 &#xA0; &#xA0; &#xA0;&#xA0;</div>
		<div>
			&#xA0; ;LDA ScoreDigitTiles, x &#xA0; &#xA0; &#xA0; &#xA0;; load data from address (palette + the value in x)</div>
		<div>
			&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; 1st time through loop it will load palette+0</div>
		<div>
			&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; 2nd time through loop it will load palette+1</div>
		<div>
			&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; 3rd time through loop it will load palette+2</div>
		<div>
			&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; etc</div>
		<div>
			&#xA0; ;STA $2007 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; write to PPU</div>
		<div>
			&#xA0;&#xA0;</div>
		<div>
			&#xA0; ;;;;;;;;;;;END OF What I originally tried</div>
		<div>
			&#xA0;&#xA0;</div>
		<div>
			&#xA0;&#xA0;</div>
		<div>
			&#xA0;&#xA0;</div>
		<div>
			&#xA0; ;hardcode to set the scores</div>
		<div>
			&#xA0; LDA #$01</div>
		<div>
			&#xA0; STA score1;set player 1 score to 1</div>
		<div>
			&#xA0; STA score2;set player 2 score to 1</div>
		<div>
			&#xA0;&#xA0;</div>
		<div>
			&#xA0; ;3gengames method</div>
		<div>
			&#xA0; LDA #$20;Screen location for first digit of score</div>
		<div>
			&#xA0; STA $2006</div>
		<div>
			&#xA0; LDA #$4E;Location. Locations $204F and $2050 are both going to be either blank, or a DASH to seperate the digits</div>
		<div>
			&#xA0; LDX score1</div>
		<div>
			&#xA0; LDA ScoreDigitTiles,X</div>
		<div>
			&#xA0; STA $2007 ;Store to 1st character to screen.</div>
		<div>
			&#xA0; LDA $2007&#xA0;</div>
		<div>
			&#xA0; LDA $2007;Move 2 bytes of the screen location.</div>
		<div>
			&#xA0; LDX score2</div>
		<div>
			&#xA0; LDA ScoreDigitTiles,X</div>
		<div>
			&#xA0; STA $2007 ;Store 2nd character to screen.</div>
		<div>
			&#xA0;&#xA0;</div>
		<div>
			&#xA0; RTS</div>
	</div>
</div>
<br>
<br>
<div>
	&#xA0;</div>
<div>
	<br>
	[Finally, here is the tile loading stuff]<br>
	<br>
	<br>
	<div>
		<div class="FTQUOTE" style="width: 1011.21533203125px; font-size: 12.222222328186035px;">
			<br>
			<div>
				<div>
					ScoreDigitTiles:</div>
				<div>
					&#xA0; .db $00,$01,$02,$03,<span class="Apple-tab-span" style="white-space: pre;"> </span>$22,$36,$17,$0F, &#xA0;$22,$30,$21,$0F, &#xA0;$22,$27,$17,$0F &#xA0; ;</div>
			</div>
			<div>
				&#xA0;</div>
		</div>
	</div>
	<div>
		&#xA0;</div>
</div>
I am at a loss for why my score still shows up in the same place as the picture I posted above. I feel like I&apos;ve reset the scrolling correctly. If anyone has any idea please let me know.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__144">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 2, 2013 at 10:30:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					To me it doesn&apos;t look like you&apos;re writing correctly.<br>
<br>
It should be:<br>
<br>
LDX score1<br>
LDA $2002<br>
LDA #$20 ;hi bit of place you&apos;re writing<br>
STA $2006<br>
LDA ScoreDigitTiles,x ;low bit of place you&apos;re writing<br>
STA $2006<br>
LDA NewTileNumber<br>
STA $2007<br>
<br>
LDX score2<br>
LDA $2002<br>
LDA #$20 ;hi bit of place you&apos;re writing<br>
STA $2006<br>
LDA ScoreDigitTiles,x ;low bit of place you&apos;re writing<br>
STA $2006<br>
LDA NewTileNumber ;tile of the new information you&apos;re writing<br>
STA $2007<br>
RTS<br>
<br>
Now that I can kind of make sense of your code, try this:<br>
<br>
&#xA0; LDA $2002 ;YOU WERE FORGETTING THIS<br>
&#xA0; LDA #$20;Screen location for first digit of score
<div>
	&#xA0; STA $2006</div>
<div>
	&#xA0; LDA #$4E;Location. Locations $204F and $2050 are both going to be either blank, or a DASH to seperate the digits<br>
	&#xA0; STA $2006 ;YOU WERE FORGETTING THIS</div>
<div>
	&#xA0; LDX score1</div>
<div>
	&#xA0; LDA ScoreDigitTiles,X</div>
<div>
	&#xA0; STA $2007 ;Store to 1st character to screen.</div>
<div>
	&#xA0; LDA $2007&#xA0;</div>
<div>
	&#xA0; LDA $2007;Move 2 bytes of the screen location. ;I HAD NO IDEA YOU COULD DO THIS.&#xA0; IF IT STILL DOESNT WORK, THIS IS YOUR CULPRIT</div>
<div>
	&#xA0; LDX score2</div>
<div>
	&#xA0; LDA ScoreDigitTiles,X</div>
<div>
	&#xA0; STA $2007 ;Store 2nd character to screen.</div>
<div>
	&#xA0;&#xA0;</div>
<div>
	&#xA0; RTS</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__145">
                                                        <div class="mdl-card__title"><strong>LucasWeatherby</strong> posted on 
		
			
				
				Apr 2, 2013 at 1:18:13 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Khan, you solved my problem. I am forever in your debt.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__146">
                                                        <div class="mdl-card__title"><strong>Cowpar2</strong> posted on 
		
			
				
				Sep 4, 2013 at 8:07:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Can someone please help me?
<br>I can&apos;t for the life of me figure out how to display a score.
<br>
<br>So I got how to make the paddle, and I can make the ball collide with it.
<br>I added a pleasant looking background, fixed the colors just right, and even changed the sprites to look more like what they&apos;re supposed to represent.
<br>I have the looping background loader, which gets its hex values from a .db .
<br>I know that the digits have to be in the background, so how do I change the background tiles to be the digits I want them to be?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__147">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Sep 4, 2013 at 8:11:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You find out the score in decimal, you save that somewhere, you then add a background changing routine to the NMI, and you write the score on the screen, probably in the $2042-$205E area of the background, if you&apos;re using NT1. How can you get a whole background to display, but not do that? That&apos;s simple compared to understanding how to load a whole background.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__148">
                                                        <div class="mdl-card__title"><strong>Cowpar2</strong> posted on 
		
			
				
				Sep 4, 2013 at 10:47:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok, I&apos;m still not exactly sure what I&apos;m doing, but &quot;JSR Drawscore&quot; is already in the NMI.
<br>So if I add the following into the code (after &quot;UpdateSprites&quot;), it DOES make the score appear, but ONLY in the top left-hand corner:
<br>
<br>DrawScore:
<br>  LDA $2002 ;read PPU to reset the latch
<br>  LDA #$20
<br>  STA $2006 ;set the high part
<br>  LDA #$20
<br>  STA $2006 ;then the low part
<br>  LDA score1
<br>  STA $2007 ;store the score (after 15 it will start to do letters)
<br>  RTS
<br>
<br>If I change the low part of the latch to anything past #$40 it will mess with the screen, but anything less then #$20 the score doesn&apos;t even appear.
<br>How do I get it to appear, say, 16 px down and all the way to the right?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__149">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Sep 4, 2013 at 10:51:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Uhhh, add one at a time to the hex number instead of 32 each time? The low part can change in 1 step pieces, this is how you set each block, just increment it what you need, which isn&apos;t by 32 like you said you did above. ($20-&gt;$40=32 steps.) Remember TV safe zones,you should put the score in the $2040 area to be super safe it&apos;ll show. Top and bottom 16px, and then left and right 8px are not safe to rely for information to appear on.<br>
<br>
And after 0x09 on the score, it will display crap, you have to have a program that turns the hex value to the right text numbers.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__150">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Sep 4, 2013 at 11:01:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Cowpar2</b></i><br>
	<br>
	If I change the low part of the latch to anything past #$40 it will mess with the screen, but anything less then #$20 the score doesn&apos;t even appear.<br>
	How do I get it to appear, say, 16 px down and all the way to the right?</div>
In fceux run your game then open the &quot;Name Table Viewer&quot;. &#xA0;Put the mouse over where you want the score to appear in that window and the &quot;PPU Address&quot; will tell you the address to use. &#xA0;It will be something like $205F.<br>
<br>
Rows are $20 tiles long, so down 2 rows is $2000 + (2 * $20) = $2040. &#xA0;All the way to the right is 1 less than a full row, so $2040 + ($20 - 1) = $205F.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__151">
                                                        <div class="mdl-card__title"><strong>Cowpar2</strong> posted on 
		
			
				
				Sep 5, 2013 at 1:20:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If I do this:<br>
<br>
<div>
	DrawScore:</div>
<div>
	&#xA0; LDA $2002</div>
<div>
	&#xA0; LDA #$20</div>
<div>
	&#xA0; STA $2006</div>
<div>
	&#xA0; LDA #$5F</div>
<div>
	&#xA0; STA $2006</div>
<div>
	&#xA0; LDA score1</div>
<div>
	&#xA0; STA $2007</div>
<div>
	&#xA0; RTS<br>
	<br>
	This happens:<br>
	<br>
	<img alt src style="width: 256px; height: 224px;" original-src="http://s12.postimg.org/tc0y4bht9/snap0002.png" show-src="images/missing/snap0002.png"><br>
	<br>
	3GenGames, I already have the background loaded, I just want to replace one tile.</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__152">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Sep 5, 2013 at 1:37:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Looks like scrolling is off, so your PPU clean up section at the end of NMI isn&apos;t right or you are changing the PPU address after cleanup.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__153">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Sep 5, 2013 at 1:45:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Also make sure you&apos;re doing that during vblank (inside your nmi code!)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__154">
                                                        <div class="mdl-card__title"><strong>Cowpar2</strong> posted on 
		
			
				
				Sep 5, 2013 at 2:44:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					My NMI code remains unchanged:
<br>
<br>NMI:
<br>  LDA #$00
<br>  STA $2003       ; set the low byte (00) of the RAM address
<br>  LDA #$02
<br>  STA $4014       ; set the high byte (02) of the RAM address, start the transfer
<br>
<br>  JSR DrawScore
<br>
<br>  ;;This is the PPU clean up section, so rendering the next frame starts properly.
<br>  LDA #%10010000   ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1
<br>  STA $2000
<br>  LDA #%00011110   ; enable sprites, enable background, no clipping on left side
<br>  STA $2001
<br>  LDA #$00        ;;tell the ppu there is no background scrolling
<br>  STA $2005
<br>  STA $2005
<br>
<br>So, it should be jumping to my code during vblank.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__155">
                                                        <div class="mdl-card__title"><strong>Cowpar2</strong> posted on 
		
			
				
				Sep 5, 2013 at 4:45:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Mystery solved!
<br>At the end of &quot;UpdateSprites&quot; (which comes just before DrawScore), I forgot to put two spaces before &quot;RTS&quot;, which caused it to skip over the RTS and go on to the &quot;DrawScore&quot; routine nonstop
<br>But I fixed it and now it works perfectly.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__156">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Sep 5, 2013 at 7:27:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					As a tip, the scroll should be 100% updated at the end of your NMI! The LAST thing done, ALWAYS. 100% updated means writing $2000, too. You need to do this because $2006 and the scroll registers actually use the same values. It&apos;s complex to explain, it&apos;s not needed without mid-screen scrolling, so basically just set the scroll last and you&apos;ll never have to worry about it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__157">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jan 19, 2014 at 12:25:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, I just went back to these tutos and I finally got something that&apos;s starting to look like a game <span class="sprites_emoticons absmiddle" id="emo_smile"></span> Thanks for these tutos bunnyboy! Now to figure out the scoring <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__158">
                                                        <div class="mdl-card__title"><strong>lazerbeat</strong> posted on 
		
			
				
				Oct 6, 2014 at 12:51:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry for the huger necrobump but this seems like the best place for the question. I have been working through weeks 1 to 6 with asm6 without any major problem but I hit 2 with weeks 7.
<br>
<br>1 - When I try to compile pong1.asm I get the following error
<br>
<br>pong1.asm(401): Missing ENDE
<br>
<br>Line 401 refers to   
<br>
<br>.incbin &quot;mario.chr&quot;   ;includes 8KB graphics file from SMB1
<br>
<br>This hasnt been an issue in any of the other tutorials. I was wondering if anyone has any ideas?
<br>
<br>
<br>2 - ASM6 doesnt seem to have and rsset / .rs1 function I have been using enum / .dsb 1 instead. Is this ok?
<br>
<br>Thanks everyone!
<br>
<br>
<br>
<br>
<br>
<br>  .rsset $0000    ;put variables starting at 0
<br>
<br>  score1   .rs 1  ;put score for player 1 at $0000
<br>
<br>Secondly
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__159">
                                                        <div class="mdl-card__title"><strong>lazerbeat</strong> posted on 
		
			
				
				Oct 6, 2014 at 2:03:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Whoops, looks like these issues are pretty closely linked.
<br>
<br>I was missing the &quot;.ende&quot; after my ,dsb1&apos;s!
<br>
<br>Still curious of there are any big differences between enum / rsset though.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__160">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Oct 6, 2014 at 9:35:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Curious why you chose to go with ASM6.  I can&apos;t answer your questions because I have no idea how to use that one.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__161">
                                                        <div class="mdl-card__title"><strong>lazerbeat</strong> posted on 
		
			
				
				Oct 6, 2014 at 10:44:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Nothing major, just it was the first compiler I found which worked &quot;out of the box&quot; with linux.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__162">
                                                        <div class="mdl-card__title"><strong>Farid</strong> posted on 
		
			
				
				Mar 1, 2015 at 1:15:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There are some mistakes in Controller Reading trace, the final result of trace is correct so it is not critical :<br>
<br>
<a href="http://8pic.ir/viewer.php?file=91try2348naegxl5cjbp.png" target="_blank" original-href="http://8pic.ir/viewer.php?file=91try2348naegxl5cjbp.png"><img src original-src="http://8pic.ir/images/91try2348naegxl5cjbp_thumb.png" show-src="images/missing/91try2348naegxl5cjbp_thumb.png"></a><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__163">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Mar 1, 2015 at 1:52:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>lazerbeat</b></i><br>
	<br>
	Still curious of there are any big differences between enum / rsset though.</div>
No, they are quite similar.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__164">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Aug 22, 2017 at 11:06:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok so this is an old thread I know, I have been going through the tutorials and have everything working except updating the score.  I didn&apos;t see this explained anywhere but the comments say to update using background tiles or lots of sprites.  I would figure updating using background tiles is best since the background tile numbers correspond to the numbers so &apos;0&apos; = $00 &apos;1&apos; = $01 and so on.  The problem I am having is updating the background sprites.  I can t seem to figure out how to do it and searching google I cant find an answer.  Anyone have an example?  I would figure I would need to update the background table which I can do (I think) but how to push it to the ppu correctly.  Any help would be greatly appreciated.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__165">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Aug 22, 2017 at 11:13:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>brilliancenp</b></i><br>
<br>
Ok so this is an old thread I know, I have been going through the tutorials and have everything working except updating the score. I didn&apos;t see this explained anywhere but the comments say to update using background tiles or lots of sprites. I would figure updating using background tiles is best since the background tile numbers correspond to the numbers so &apos;0&apos; = $00 &apos;1&apos; = $01 and so on. The problem I am having is updating the background sprites. I can t seem to figure out how to do it and searching google I cant find an answer. Anyone have an example? I would figure I would need to update the background table which I can do (I think) but how to push it to the ppu correctly. Any help would be greatly appreciated.</div>
<br>
The best way is to write it to a buffer to where it writes all your background updates in a single frame, but I won&apos;t confuse you with that just yet until you get your bearings a little more.<br>
<br>
Basically, somewhere in the vblank (which is typically at the beginning of NMI), you have to update the background tiles. The code will look something like this:<br>
<br>
UpdateBackgroundTile:<br>
&#xA0; LDA $2002 ;wake up PPU and let it know we are about to update stuff<br>
&#xA0; LDA #$20 ;this is the hi byte of the address you&apos;re writing to. so if the nametable tile you&apos;re updating is located at $2084, $20 is the hi byte.<br>
&#xA0; STA $2006<br>
&#xA0; LDA #$84 ;this is the low byte of the address you&apos;re writing to. I kept the same address example that I used above.<br>
&#xA0; STA $2006<br>
&#xA0; LDA #$xx ;this is the tile number of the new tile you are writing to the address you described above.<br>
&#xA0; STA $2007 ;write the tile<br>
&#xA0; RTS<br>
<br>
Now, doing it this way is fine, but you have to understand that unless you have a flag telling it to only do it once, it&apos;s going to re-draw this tile every single frame until you tell it otherwise. And when you start developing a bigger game, you won&apos;t get far before updates like this prevent you from expanding, because vblank is a treasured commodity.<br>
<br>
Let us know if you need further clarification, or when you&apos;re ready for more advanced solutions.<br>
<br>
Homework is to read this: <a href="https://wiki.nesdev.com/w/index.php/The_frame_and_NMIs" target="_blank" original-href="https://wiki.nesdev.com/w/index.php/The_frame_and_NMIs">https://wiki.nesdev.com/w/index.p...</a><br>
<br>
You don&apos;t need to understand the technical details of what it&apos;s doing, but at least try to give it a read and understand the concepts. We&apos;ll get there. One step at a time!<br>
<br>
Also, welcome to NintendoAge!<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__166">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Aug 22, 2017 at 11:40:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank you so much!  And what a quick response.  I did read up on buffers while I was away.  I am a c# developer so I have programming down but this is a whole new world lol.  I am grasping the concepts and the awesome tutorials.  And yes updating the same thing every frame is a definite waste lol  but at least this example allows me to grasp HOW to do a simple thing like updating a background tile.  I have been stuck the last couple of days until I realized I might just try asking <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>  Thanks again and yes I am glad to be here.  I will read my homework!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__167">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 23, 2017 at 5:34:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It&apos;s not always a waste to do things every frame though, you can certainly lose some ease of use by over flagging stuff. Palettes have been my key example lately, thanks to some advice from Memblers. I used to do them with a complex system of flags, now I just update them every frame and skip all of the hassle of setting flag routines. It makes changing colors a breeze, and not much is lost in NMI. I think that I&apos;d do the same with scoring BG tiles at this point too, at least for a smaller game. Drawing a few tiles every frame is well within the scope of using that time well (figure that scrolling changes at least 32 and there is still time for other things).<br>
<br>
Just something to keep in mind perhaps as you continue on your journey; that constant trade between what you can do and what you need to do. What&apos;s that saying, beginning coders hardcode everything and so do veteran ones? Something like that.<br>
<br>
And of course, welcome to the forums!<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__168">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Aug 25, 2017 at 8:39:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I understand the concept of buffers as explained in <a href="https://wiki.nesdev.com/w/index.php/The_frame_and_NMIs" target="_blank" original-href="https://wiki.nesdev.com/w/index.php/The_frame_and_NMIs">https://wiki.nesdev.com/w/index.p...</a> but I dont understand how to set it up.  It seems like it takes the place of setting a variable for each thing you want to keep track of, which I like, but coming from a background of higher languages it seems you would want to use an array, but in this case a collection of bytes.  Just not sure how to set this up in NESASM.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__169">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Aug 25, 2017 at 8:49:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oh wait!  Do you set it up using the .db command?  Im going to try that
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__170">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Aug 26, 2017 at 12:58:20 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>brilliancenp</b></i><br><br>Oh wait!  Do you set it up using the .db command?  Im going to try that</div><br><br><br><br><br>No. You would section off a part of ram. Such as:<br><br>
BufferRAM           .rs 64     <br><br>
That would reserve 64 bytes in ram just for buffering. I have never done it, but you could adjust that number according to what is needed thr most in any given frame in the game.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__171">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 26, 2017 at 6:23:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Just like MMM said you need to reserve bytes. Buffering just means that you&apos;re to pre-loading all of the data you need. A .db table would still involve the step of finding it, and not being able to quickly blast it to the PPU when you need it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__172">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Aug 26, 2017 at 10:38:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m one of those people who needs to see something done to really understand it, so I&apos;m going to give you an example of the way I do things. I&apos;m definitely not claiming to be any sort of expert in NES programming, because I do many things the wrong way, but this will at least give you a physical example of a way it can be done.
<br>
<br>Anytime I have a tile to update, I&apos;ll write it to the $0400 page. First I check to see if anything is written to $0400 (if so, that means I&apos;ve already told it to update tile(s) this frame, so I need to skip ahead and go to the first free bytes in that page.)
<br>
<br>In this example, let&apos;s say I want to change four background tiles beginning at $2165. The tiles will be $23, $91, $46, and $90. But earlier in the frame I decided I wanted to change background tile $2310 to tile $12.
<br>
<br>Like the website I gave you to did, I have my buffer set up like this.
<br>
<br>Byte 0 - Number of tiles I&apos;m updating.
<br>Byte.1 - Hi byte of nametable I&apos;m updating.
<br>Byte 2 - Lo byte of nametable I&apos;m updating.
<br>Bytes 3 - ? - The tiles I&apos;m updating to that address.
<br>
<br>Zero page variables:
<br>NumBuffer: .rs 1
<br>HiBuffer: .rs 1
<br>LoBuffer: .rs 1
<br>BufferTiles: .rs xx (however many bytes you want to set aside for buffer updates)
<br>
<br>Current state of $0400 page (from previous routine that wants to update background tile $2310 to tile $12:
<br>
<br>$01,$23,$10,$12
<br>
<br>I have a subroutine somewhere that you will jump to anytime you want to load stuff into the buffer, it will look liks this:
<br>
<br>LoadBuffer:
<br>  LDX #$00
<br>  LDY #$00
<br>.PreLoad:
<br>  LDA $0400,x ;check to see if this is an open spot in the $0400 page
<br>  CMP #$00 ;if it is, go straight to Load.
<br>  BEQ .Load
<br>  TAY ;move the current number of bytes that this bkgd update is doing into Y so we can move ahead that many to check next open spot
<br>.Loop:
<br>  DEY
<br>  INX
<br>  CPY #$00
<br>  BEQ .PreLoad ;we have successfully moved ahead past the current update. check next spot by jumping back to PreLoad
<br>  JMP .Loop
<br>.Load: ;it is now safe to put our updates into this spot of $0400 page
<br>  LDA NumBuffer
<br>  STA $0400,x
<br>  LDA HiBuffer
<br>  STA $0401,x
<br>  LDA LoBuffer
<br>  STA $0402,x
<br>  LDY #$00
<br>.ExitLoop:
<br>  LDA BufferTiles,y
<br>  STA $0403,x
<br>  INX
<br>  INY
<br>  DEC NumBuffer
<br>  LDA NumBuffer
<br>  CMP #$00
<br>  BNE .ExitLoop
<br>  RTS
<br>
<br>Then I have a routine that happens at the beginning of NMI (and we know this is vblank time) that goes something like this. It actually loads your buffer and makes the changes you want:
<br>
<br>RunBuffer:
<br>  LDX #$00
<br>.Loop:
<br>  LDA $0400,x ;see if anything is set to update
<br>  CMP #$00
<br>  BEQ .End ;nothing is set to update, go to end
<br>  LDA $0400,x
<br>  TAY
<br>  LDA $0401,x
<br>  STA $2006
<br>  LDA $0402,x
<br>  STA $2006
<br>.OutroLoop:
<br>  LDA $0403,x
<br>  STA $2007
<br>  INX
<br>  DEY
<br>  CPY #$00
<br>  BNE .OutroLoop
<br>  JMP .Loop
<br>.End:
<br>  RTS
<br>
<br>Now that you have your two routines down, at any point in your code to update the tiles we previously mentioned, you can just do this:
<br>
<br>;;anywhere in game
<br>  LDA #$04 ;we are updating four tiles, like we mentioned
<br>  STA NumBuffer
<br>  LDA #$21 ;hi byte we are updating
<br>  STA HiBuffer
<br>  LDA #$65 ;lo byte we are updating
<br>  STA LoBuffer
<br>  LDA #$23 ;first of four tiles we are updating
<br>  STA BufferTiles
<br>  LDA #$91
<br>  STA BufferTiles+1
<br>  LDA #$46
<br>  STA BufferTiles+2
<br>  LDA #$90
<br>  STA BufferTiles+3
<br>  JSR LoadBuffer ;take these values and load them into our buffer
<br>;;any code
<br>
<br>Then when your updates are done for the frame, you probably need to figure out a way to set $0400 to #$00 so that the game knows not to run the updates the next frame. But I&apos;ll let you figure that out. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__173">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Aug 26, 2017 at 11:12:33 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Also, I wrote all of this in one sitting while my nephews were talking my ear off, so they may need tweaking!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-7__174">
                                                        <div class="mdl-card__title"><strong>snitty</strong> posted on 
		
			
				
				Mar 26 at 8:33:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m having a delightfully weird issue where, when starting a new game I can move paddle 1 up or down, but once I start moving it one direction I can&apos;t move it the other. I can move it all the way up to the top stop, or all the way down to the bottom. 
<br>
<br>I&apos;m sure I&apos;m missing something dumb, but what is it? 
<br>
<br>MovePaddleUp:
<br>  ;;if up button pressed
<br>
<br>  LDA buttons1
<br>  AND #$08
<br>  BEQ MovePaddleUpDone
<br>  ;;  if paddle top &gt; top wall
<br>  LDA #$20
<br>  SEC
<br>  SBC paddle1ytop
<br>  BPL MovePaddleUpDone
<br>  DEC paddle1ytop
<br>  DEC paddle2ybot
<br>
<br>  ;;    move paddle top and bottom up
<br>MovePaddleUpDone:
<br>
<br>MovePaddleDown:
<br>  LDA buttons1
<br>  AND #$04
<br>  BEQ MovePaddleDownDone
<br>  ;;  if paddle top &gt; top wall
<br>  LDA #$E0
<br>  SEC
<br>  SBC paddle1ytop
<br>  BMI MovePaddleDownDone
<br>  INC paddle1ytop
<br>  INC paddle2ybot
<br>MovePaddleDownDone:
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>


                <div class="spacer"></div>

                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="main_tutorial-8">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">8: 16进制，指针，循环嵌套</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b>This Week:</b> The NES is an 8 bit machine, but sometimes you need more!  Learn to handle 16+ bit numbers, and use them for bigger loops.<br>
<br>
<span class="Apple-style-span" style="font-size: medium; "><b>16 Bit Math</b></span><br>
Doing 16 bit addition and subtraction is fairly simple because of the carry flag that we had previously been clearing.  First the normal add is done using the clc/adc pair.  This add is for the lower 8 bits of the 16 bit number.  For the upper 8 bits the adc instruction is used again, but without the clc.  You want to keep the carry from the first add, in case it overflowed.  To only add in the carry the second adc value is just 0.<br>
<br>
Here are some examples in decimal.  One digit column is added at a time.  The carry (1) is added to the next column as needed.  <br>
<pre>    0 3
+   0 4
    0 7  (no carry needed, top digit = 0)
</pre>
<br>
<pre>    0 4
+   0 8
    1 2  (carry only, top digit = 1)
</pre>
<br>
<pre>    2 2
+   1 9
    4 1  (carry plus 2 plus 1, top digit = 4)
</pre>
<br>
And the code to do it on the NES, adding 1 to a 16 bit number:<br>
<pre>  LDA lowbyte      ; load low 8 bits of 16 bit value
  CLC              ; clear carry
  ADC #$01         ; add 1
  STA lowbyte      ; done with low bits, save back
  LDA highbyte     ; load upper 8 bits
  ADC #$00         ; add 0 and carry from previous add
  STA highbyte     ; save back</pre>
<br>
The same process of adding 0 without clearing the carry can be continued to do 24 bit, 32 bit, or higher numbers.  It is also the same process to do 16 bit subtraction:<br>
<pre>  LDA lowbyte      ; load low 8 bits of 16 bit value
  SEC              ; set carry
  SBC #$01         ; subtract 1
  STA lowbyte      ; done with low bits, save back
  LDA highbyte     ; load upper 8 bits
  SBC #$00         ; subtract 0 and carry from previous sub
  STA highbyte     ; save back</pre>
<br>
<br><span class="Apple-style-span" style="font-size: medium; "><b>
Pointers and Indirect Indexed Mode</b></span><br>
Previously when loading background tiles the x register was used as an 8 bit offset.  Now that we can handle 16 bit numbers a different addressing mode can be used.  The 16 bit address is saved into two 8 bit variables, which are then used as a &quot;<b>pointer</b>&quot; which points to the background data we want.  The LDA instruction then uses the &quot;<b>Indirect Indexed</b>&quot; addressing mode.  This takes the 16 bit variable inside the brackets and uses it as an address.  For the address to be correct, the low byte must be first and the high byte must come immediately after.  Then the value in the Y register is added to the address.  This forms the final address to load from.  Both variables must also be in the first 256 bytes of RAM, called &quot;<b>Zero Page</b>&quot;, and the X register cannot be used with this addressing mode.<br>
<pre>  .rsset $0000       ; put pointers in zero page
pointerLo  .rs 1   ; pointer variables are declared in RAM
pointerHi  .rs 1   ; low byte first, high byte immediately after
</pre>
<pre>  LDA #$D0
  STA pointerHi
  LDA #$12
  STA pointerLo       ; pointer now says $D012
</pre>
<pre>  LDY #$00            ; no offset from Y
  LDA [pointerLo], y  ; load data from the address pointed to by the 16 bit pointer variable plus the value in the Y register
</pre>
<br>
  That last line is the same as <pre>LDA $D012, y</pre>Because we kept Y = 0, that is the same as <pre>LDA $D012</pre>
<br><b><span class="Apple-style-span" style="font-size: medium; ">  
Copy Loops  </span></b><br>
Now using your 16 bit math the pointer address can be incremented.  Instead of being limited to 256 background tiles like when using the x offset, the whole background can be copied in one loop.  First the address of the background data is put into the pointer variable.  The high and low bytes of the address are each copied individually.  Then the number of tiles to copy is put into the loop counter, which will count down to 0.  Each time through the loop one byte will be copied, the 16 bit pointer address will be incremented, and the 16 bit loop counter will be decremented.  The Y offset is always kept at 0, because the pointer always points to the correct byte.  When the loop counter reaches 0 everything is done.  <br>
 <pre>  LDA #LOW(background)
  STA pointerLo       ; put the low byte of the address of background into pointer
  LDA #HIGH(background)
  STA pointerHi       ; put the high byte of the address into pointer
</pre>
<pre>  LDA #$00
  sta counterLo       ; put the loop counter into 16 bit variable
  LDA #$04
  sta counterHi       ; count = $0400 = 1KB, the whole screen at once including attributes
</pre>
<pre>  
  LDY #$00            ; put y to 0 and don&apos;t change it
LoadBackgroundLoop:
  LDA [pointerLo], y
  STA $2007           ; copy one background byte
</pre>
<pre>  LDA pointerLo
  CLC
  ADC #$01
  STA pointerLo
  LDA pointerHi
  ADC #$00
  STA pointerHi       ; increment the pointer to the next byte
</pre>
<pre>  
  LDA counterLo
  SEC
  SBC #$01
  STA counterLo
  LDA counterHi
  SBC #$00
  STA counterHi       ; decrement the loop counter
</pre>
<pre>  
  LDA counterLo
  CMP #$00
  BNE LoadBackgroundLoop
  LDA counterHi
  CMP #$00
  BNE LoadBackgroundLoop  ; if the loop counter isn&apos;t 0000, keep copying
&#xA0;</pre>That is a lot of code to copy just one byte!
<br>
<br><span class="Apple-style-span" style="font-size: medium; "><b>
Nested Loops</b></span><br>
To avoid using so much code, we can use both the X and Y registers as loop counters.  By putting one loop inside another loop we create a &quot;nested loop&quot;.  First the inside loop counts all the way up.  Then the outside loop counts up once, and the inside loop counts all the way again.  Normally using only X or Y would only give a maximum of 256 times through a loop like we have previously done.  With nested loops using both X and Y the maximum is the inside counter multiplied by the outside counter, or 256*256 = 65536.
<br>
<pre>  LDX #$00
  LDY #$00
OutsideLoop:
  
InsideLoop:
  ;
  ; this section runs 256 x 256 times
  ;
  
  INY                 ; inside loop counter
  CPY #$00
  BNE InsideLoop      ; run the inside loop 256 times before continuing down
  
  INX
  CPX #$00
  BNE OutsideLoop     ; run the outside loop 256 times before continuing down
</pre><div><br></div>
First the Inside Loop runs and Y will count from 0 to 256.  When that finishes X will count 0 to 1, and branch back to the beginning of the loops.  Then the Inside Loop runs again, Y 0 -&gt; 256.  X now goes 1 -&gt; 2 and the process continues.  Everything ends when both X and Y have each counted to 256.
<br>
<br>
When we are using nested loops to copy entire backgrounds we want 256 x 4 = 1KB.  The Y code from above can be unchanged, but the X code is changed to CPX #$04.
<br><br>
Because we are changing the Y register our previous pointer copying code also needs to be modified.  Instead of incrementing the pointer every time, the incrementing Y register is doing the same thing.  The low byte of the pointer will be kept at 0.  This means your background data needs to be aligned to where the low byte of the address is $00.   However the high byte of the pointer still needs to change.  By always making the inside loop count 256 times, that will end at the same time that the high byte needs to change.  This time 16 bit math isn&apos;t needed because only the high byte is incremented.
<br><br>
No loop counter is used because X and Y are used instead.  If you cannot align your data so the low byte of the address is $00, you will have to use the CopyLoop above.<br>
<pre>  LDA #$00
  STA pointerLo       ; put the low byte of the address of background into pointer
  LDA #HIGH(background)
  STA pointerHi       ; put the high byte of the address into pointer
  
  LDX #$00            ; start at pointer + 0
  LDY #$00
OutsideLoop:
  
InsideLoop:
  LDA [pointerLo], y  ; copy one background byte from address in pointer plus Y
  STA $2007           ; this runs 256 * 4 times
  
  INY                 ; inside loop counter
  CPY #$00
  BNE InsideLoop      ; run the inside loop 256 times before continuing down
  
  INC pointerHi       ; low byte went 0 to 256, so high byte needs to be changed now
  
  INX
  CPX #$04
  BNE OutsideLoop     ; run the outside loop 256 times before continuing down
</pre>
  <br><span class="Apple-style-span" style="font-size: medium; "><b>
Putting It All Together</b></span><br>
Download and unzip the <a href="scraper/files/background3.zip" target="_blank" original-href="http://www.nespowerpak.com/nesasm/background3.zip">background3.zip</a> sample files.  All the code is in the background.asm file.  Make sure that file, mario.chr, and background.bat is in the same folder as NESASM, then double click on background.bat.  That will run NESASM and should produce background3.nes.  Run that NES file in FCEUXD SP to see the full background.
<br><br>
The new nested loop is used to copy a whole background to the screen instead of only 128 bytes. &#xA0;The background is aligned using the .org directive so the low address byte is $00. &#xA0;The attributes are also placed directly after the background data so it is are copied at the same time.<div><br></div><div>Your task is to separate out the code that sets the pointer variables from the code that copies the loop.  That way you can have multiple backgrounds that use different pointer loading code, but the same copy code.
<br><br>
If you are using a different assembler, the Indirect Indexed mode may use () instead of [].  The LOW() and HIGH() syntax may also be different.<br><br></div>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#main_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;main_tutorial-8__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33274" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>

                <div class="comments" style="display: none;" id="main_tutorial-8__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__1">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 16, 2010 at 12:20:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This carry stuff is pretty neat.  I saw the ADC used in MetalSlime&apos;s tutorials.  I have a couple questions, if you have a second.
<br>
<br>-You say that all pointer variables must come from the first 256 Bytes in RAM.  Why is this?  I&apos;m sure I&apos;m mistaken, but I thought that the music stuff was all kept in the $0300 block. 
<br>
<br>-Wouldn&apos;t it be better to set your inside loop to CPY #$F0 rather than $00?  When you leave it at $00 aren&apos;t you just overwriting your attributes anyway?  If attributes are kept in a seperate loop, you would be running the loop like $40 extra times.  Or are you planning on putting attributes in the loop eventually?
<br>
<br>-Might just note that you can use just &quot;pointer  .rs 2&quot; and then use the variables &quot;pointer&quot; and &quot;pointer+1&quot;.  This makes it simpler to keep track of variables when you have like 20 pointers. 
<br>
<br>I thought that I had another ? but now I can&apos;t remember what it was.  But I&apos;m having the same paragraph issue I was having in your MMC1 thread.
<br>
<br>Thanks for this.  Keep &apos;em comming!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__2">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 16, 2010 at 1:02:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
<br>-You say that all pointer variables must come from the first 256 Bytes in RAM.  Why is this?  I&apos;m sure I&apos;m mistaken, but I thought that the music stuff was all kept in the $0300 block.&#xA0;</div><div><br></div>To use the Indirect Indexed mode, only the low byte of the location in the brackets is used, so your pointer location needs to have the high byte be zero. &#xA0;The high byte is just thrown away:<pre>  .rsset $0004
pointer .rs 2
  lda [pointer], y   ; this is the same as lda [$04], y
</pre>
<pre>  .rsset $0304
pointer .rs 2
  lda [pointer], y   ; this is also the same as lda [$04], y
</pre>
<br>MetalSlime uses $0300 for some variables like sound_disable_flag, but also uses zero page for pointers like the sound_ptr and jmp_ptr.<div><br><br><br><br><div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br>-Wouldn&apos;t it be better to set your inside loop to CPY #$F0 rather than $00?  When you leave it at $00 aren&apos;t you just overwriting your attributes anyway?  If attributes are kept in a seperate loop, you would be running the loop like $40 extra times.  Or are you planning on putting attributes in the loop eventually?
<br></div><div><br></div>For that example I have the attribute data right after the background data, so both are copied in one loop. &#xA0;That also means the next set of background/attributes will be aligned with the address low byte = $00.<div><br></div><div>But for a real game yes separating out the bg and attributes is usually a good idea.<br></div><div><br><br><br><br><div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br>-Might just note that you can use just &quot;pointer  .rs 2&quot; and then use the variables &quot;pointer&quot; and &quot;pointer+1&quot;.  This makes it simpler to keep track of variables when you have like 20 pointers. <br></div><br>Yup! &#xA0;But for beginners remembering the Lo then Hi part is important. &#xA0;You could also do pointerLo .rs 2 and use pointerLo and pointerLo+1. &#xA0;
</div></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__3">
                                                        <div class="mdl-card__title"><strong>LucasWeatherby</strong> posted on 
		
			
				
				Apr 11, 2013 at 9:09:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	Your task is to separate out the code that sets the pointer variables from the code that copies the loop. That way you can have multiple backgrounds that use different pointer loading code, but the same copy code.<br>
	<div>
		&#xA0;</div>
</div>
<br>
Ok, question on this. I made a subroutine that is called from within in the &quot;LoadBackground&quot; section that will read Accumulator A and draw a background based off of the Accumulators value. It works fine and dandy if I hardcode the value of the Accumulator right before calling the subroutine.<br>
<br>
I then made my &quot;ReadA&quot; section(functions, whatever you call these bad boys) change the value of the Accumulator when pressed. But the background never changes.<br>
<br>
This leads me to believe that this is because the call is from within the Reset section of code and only called on startup. Therefore to solve my problem (and the question I am really asking is) I need to make my LoadBackground and Subroutine call from the NMI? Does that sound right? This is probably a dumb question, just want to make sure(I am away from my personal computer to try this method out. This was the idea that came to me in my dreams last night, though I would ask you guys about it).<br>
<br>
And is it ok to redraw the background from within the NMI?<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__4">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Apr 11, 2013 at 10:02:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>LucasWeatherby</b></i><br>
	<br>
	<div class="FTQUOTE">
		Your task is to separate out the code that sets the pointer variables from the code that copies the loop. That way you can have multiple backgrounds that use different pointer loading code, but the same copy code.<br>
		<div>
			&#xA0;</div>
	</div>
	<br>
	Ok, question on this. I made a subroutine that is called from within in the &quot;LoadBackground&quot; section that will read Accumulator A and draw a background based off of the Accumulators value. It works fine and dandy if I hardcode the value of the Accumulator right before calling the subroutine.<br>
	<br>
	I then made my &quot;ReadA&quot; section(functions, whatever you call these bad boys) change the value of the Accumulator when pressed. But the background never changes.<br>
	<br>
	This leads me to believe that this is because the call is from within the Reset section of code and only called on startup. Therefore to solve my problem (and the question I am really asking is) I need to make my LoadBackground and Subroutine call from the NMI? Does that sound right? This is probably a dumb question, just want to make sure(I am away from my personal computer to try this method out. This was the idea that came to me in my dreams last night, though I would ask you guys about it).<br>
	<br>
	And is it ok to redraw the background from within the NMI?<br>
	&#xA0;</div>
Not a dumb question at all. &#xA0;And good job diagnosing your problem! &#xA0;That&apos;s exactly right. &#xA0;The LoadBackground section is only run on reset, and that is before the controller is ever read.<br>
<br>
The NMI isn&apos;t long enough to do a full background rewrite, but you can definitely draw some tiles and then continue drawing more the next NMI. &#xA0;So your idea is on the right track, just don&apos;t expect to be able to copy a whole background&apos;s worth of tiles in one NMI. &#xA0;Try writing a new subroutine called &apos;DrawTwoRows&apos; or something and call that in your NMI after the controller read.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__5">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jul 3, 2013 at 8:26:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					After the concrete goals of Lesson 7 (finally worked through most of them!), the assignment for this lesson baffles me. Primarily, what exactly is the task in lesson 8? The assignment is given of &quot;separating the code that sets the pointer variables from the code that copies the loop,&quot; with the goal being to devise a way to &quot;have multiple backgrounds that use different pointer loading code, but the same copy code.&quot; One respondent in the thread seemed to give indication that this was primarily asking one to turn part of the code into a subroutine, which would minimize the need to rewrite the copy code each time. Is this what is being asked for? A nudge in the right direction, or even a different phrasing for the task would be greatly appreciated. I am a bit unclear on the whole lesson to be honest, despite reading through it many times, so that may have something to do with my inability to figure out what is being asked.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__6">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jul 3, 2013 at 8:37:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Basically the idea is that. Using a look up table pointing to data and then using on program to handle the multiple datum and do stuff with it. And obviously 16-bit math with the carry stuff. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__7">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jul 14, 2013 at 10:15:54 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry to post on this one again, but I still cannot seem to get what is going on with the lesson. I moved onto lesson 9 and finished that with minimal problems (other than forgetting to JSR a subroutine, that took way too long to track down!), so I am anxious to get moving onto something else besides Pong.
<br>
<br>For this lesson, even basic things, such as why we are doing 16-bit math in the first place would be helpful, not to mention 32, 64, and higher math.
<br>
<br>Regarding the &quot;pointing&quot; to background data I am a bit too lost to even ask a good question. I have tried various ways of separating the background code from the pointer variables all to no avail. If anybody would be willing to dumb it down a shade I would greatly appreciate it. Perhaps part of the problem lies in the following questions, though perhaps not: in the way the lesson&apos;s code is structured, where exactly would the initialization for further backgrounds be inserted? I understand that the nametables come at the end, but the initialization code for the background itself occurs before the NMI. This probably leads into further questions about how to structure code, where NMI&apos;s are placed, what needs to be repeated for each game state and or room, etc. I am guessing that most of my problems surrounding switching game states and backgrounds are to be found in this lesson. Oh, and I have read and reread the article over at NESDEV regarding Frames and NMI&apos;s, and while interesting I could not find a way to implement it. Any help would be greatly appreciated.
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__8">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Jul 14, 2013 at 11:00:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>NESHERO27</b></i><br>
	<br>
	Sorry to post on this one again, but I still cannot seem to get what is going on with the lesson. I moved onto lesson 9 and finished that with minimal problems (other than forgetting to JSR a subroutine, that took way too long to track down!), so I am anxious to get moving onto something else besides Pong.<br>
	<br>
	For this lesson, even basic things, such as why we are doing 16-bit math in the first place would be helpful, not to mention 32, 64, and higher math.<br>
	<br>
	Regarding the &quot;pointing&quot; to background data I am a bit too lost to even ask a good question. I have tried various ways of separating the background code from the pointer variables all to no avail. If anybody would be willing to dumb it down a shade I would greatly appreciate it. Perhaps part of the problem lies in the following questions, though perhaps not: in the way the lesson&apos;s code is structured, where exactly would the initialization for further backgrounds be inserted? I understand that the nametables come at the end, but the initialization code for the background itself occurs before the NMI. This probably leads into further questions about how to structure code, where NMI&apos;s are placed, what needs to be repeated for each game state and or room, etc. I am guessing that most of my problems surrounding switching game states and backgrounds are to be found in this lesson. Oh, and I have read and reread the article over at NESDEV regarding Frames and NMI&apos;s, and while interesting I could not find a way to implement it. Any help would be greatly appreciated.</div>
<br>
Have you read MRN&apos;s tutorials?<br>
<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33287" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33287">http://nintendoage.com/forum/mess...</a><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__9">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 14, 2013 at 11:59:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>NESHERO27</b></i><br>
	<br>
	Sorry to post on this one again, but I still cannot seem to get what is going on with the lesson. I moved onto lesson 9 and finished that with minimal problems (other than forgetting to JSR a subroutine, that took way too long to track down!), so I am anxious to get moving onto something else besides Pong.<br>
	<br>
	For this lesson, even basic things, such as why we are doing 16-bit math in the first place would be helpful, not to mention 32, 64, and higher math.<br>
	<br>
	Regarding the &quot;pointing&quot; to background data I am a bit too lost to even ask a good question. I have tried various ways of separating the background code from the pointer variables all to no avail. If anybody would be willing to dumb it down a shade I would greatly appreciate it. Perhaps part of the problem lies in the following questions, though perhaps not: in the way the lesson&apos;s code is structured, where exactly would the initialization for further backgrounds be inserted? I understand that the nametables come at the end, but the initialization code for the background itself occurs before the NMI. This probably leads into further questions about how to structure code, where NMI&apos;s are placed, what needs to be repeated for each game state and or room, etc. I am guessing that most of my problems surrounding switching game states and backgrounds are to be found in this lesson. Oh, and I have read and reread the article over at NESDEV regarding Frames and NMI&apos;s, and while interesting I could not find a way to implement it. Any help would be greatly appreciated.</div>
<br>
There&apos;s not necessarily any reason he&apos;s using 16-bit math other than to show you how it&apos;s done.&#xA0; I&apos;ve still yet to use it in any of my projects, mostly because I haven&apos;t needed anything even remotely complicated for the simple stuff I&apos;ve done.<br>
<br>
What do you mean by this:<br>
<br>
&quot;Regarding the &quot;pointing&quot; to background data I am a bit too lost to even ask a good question. I have tried various ways of separating the background code from the pointer variables all to no avail.&quot;<br>
<br>
How (in what way) are you trying to separate it?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__10">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jul 14, 2013 at 12:49:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok, I will not worry too much about the math thing until I need it. Regarding the separation of code, BunnyBoy&apos;s assignment was to:
<br>
<br>&quot;Your task is to separate out the code that sets the pointer variables from the code that copies the loop. That way you can have multiple backgrounds that use different pointer loading code, but the same copy code.&quot;
<br>
<br>I have tried to separate it out several different ways, in order to create some sort of subroutine (per 3Gens advice), but it never seems to load properly (lots of random tiles, flashing, etc.). I would not be so hung up on finishing it, but when I try to do a multi screen Pong (title, playing field, game over), I am unable to isolate the reusable portion of code and have to fully re-label each individual section in order to avoid assembler errors.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__11">
                                                        <div class="mdl-card__title"><strong>LucasWeatherby</strong> posted on 
		
			
				
				Aug 15, 2013 at 9:30:39 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>MetalSlime</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>LucasWeatherby</b></i><br>
		<br>
		<div class="FTQUOTE">
			Your task is to separate out the code that sets the pointer variables from the code that copies the loop. That way you can have multiple backgrounds that use different pointer loading code, but the same copy code.<br>
			<div>
				&#xA0;</div>
		</div>
		<br>
		Ok, question on this. I made a subroutine that is called from within in the &quot;LoadBackground&quot; section that will read Accumulator A and draw a background based off of the Accumulators value. It works fine and dandy if I hardcode the value of the Accumulator right before calling the subroutine.<br>
		<br>
		I then made my &quot;ReadA&quot; section(functions, whatever you call these bad boys) change the value of the Accumulator when pressed. But the background never changes.<br>
		<br>
		This leads me to believe that this is because the call is from within the Reset section of code and only called on startup. Therefore to solve my problem (and the question I am really asking is) I need to make my LoadBackground and Subroutine call from the NMI? Does that sound right? This is probably a dumb question, just want to make sure(I am away from my personal computer to try this method out. This was the idea that came to me in my dreams last night, though I would ask you guys about it).<br>
		<br>
		And is it ok to redraw the background from within the NMI?<br>
		&#xA0;</div>
	Not a dumb question at all. &#xA0;And good job diagnosing your problem! &#xA0;That&apos;s exactly right. &#xA0;The LoadBackground section is only run on reset, and that is before the controller is ever read.<br>
	<br>
	The NMI isn&apos;t long enough to do a full background rewrite, but you can definitely draw some tiles and then continue drawing more the next NMI. &#xA0;So your idea is on the right track, just don&apos;t expect to be able to copy a whole background&apos;s worth of tiles in one NMI. &#xA0;Try writing a new subroutine called &apos;DrawTwoRows&apos; or something and call that in your NMI after the controller read.<br>
	<br>
	&#xA0;</div>
<br>
<br>
Ok, back from my hiatus and ready to pick up where I left off. I had the same problems NESHERO27 is having until I tried your 2 row method. That seemed to fix the glitchy looking mess of a screen. I have attempted to make my screen change between two backgrounds when either A or B is pressed. I have sucessfully made the first 2 rows switch correctly. But I am struggling with picking up where I left off during the last NMI. I was hoping someone could help me pointerLo variable setup to the right value.<br>
<br>
<br>
Here is an overview of my NMI:<br>
<br>
<div class="FTQUOTE">
	<div>
		NMI:</div>
	<div>
		&#xA0; LDA #$00</div>
	<div>
		&#xA0; STA $2003 &#xA0; &#xA0; &#xA0; ; set the low byte (00) of the RAM address</div>
	<div>
		&#xA0; LDA #$02</div>
	<div>
		&#xA0; STA $4014 &#xA0; &#xA0; &#xA0; ; set the high byte (02) of the RAM address, start the transfer</div>
	<div>
		&#xA0;&#xA0;</div>
	<div>
		;;Background Control<br>
		<br>
		;;LatchController<br>
		<br>
		;;ReadA:<br>
		<br>
		;;ReadB:&#xA0;<br>
		<div>
			&#xA0;<br>
			<br>
			;;This is the PPU clean up section, so rendering the next frame starts properly.</div>
		<div>
			&#xA0; LDA #%10010000 &#xA0; ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1</div>
		<div>
			&#xA0; STA $2000</div>
		<div>
			&#xA0; LDA #%00011110 &#xA0; ; enable sprites, enable background, no clipping on left side</div>
		<div>
			&#xA0; STA $2001</div>
		<div>
			&#xA0; LDA #$00 &#xA0; &#xA0; &#xA0; &#xA0;;;tell the ppu there is no background scrolling</div>
		<div>
			&#xA0; STA $2005</div>
		<div>
			&#xA0; STA $2005</div>
		<div>
			&#xA0;&#xA0;</div>
		<div>
			&#xA0; RTI &#xA0; &#xA0; &#xA0;</div>
	</div>
</div>
<br>
In the Background Control I have the following:<br>
<br>
<br>
<div class="FTQUOTE">
	<div>
		;;Background Control</div>
	<div>
		LoadBackgroundNMI: &#xA0;</div>
	<div>
		&#xA0; LDA changeBG ;;load A with changeBackground boolean to see if a background change is needed</div>
	<div>
		&#xA0; AND #$01 ;;AND with 1 to see if boolean is set</div>
	<div>
		&#xA0; BEQ LoadBackgroundNMIDone ;;if not, branch to the end of NMI Background Load</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; JSR SetBackGroundPointer &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;Jump to subroutine that establishes background to load</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; LDA $2002 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; read PPU status to reset the high/low latch</div>
	<div>
		&#xA0; LDA #$20</div>
	<div>
		&#xA0; STA $2006 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; write the high byte of $2000 address</div>
	<div>
		&#xA0; LDA #$00</div>
	<div>
		&#xA0; STA $2006 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; write the low byte of $2000 address</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; LDA pointerY;Attempting to load where I left off with previous NMI</div>
	<div>
		&#xA0; STA pointerLo ; put the low byte of the address of background into pointer</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; LDY #$00;initializing y offset at 0</div>
	<div>
		&#xA0;&#xA0;</div>
	<div>
		InsideLoopNMI:</div>
	<div>
		&#xA0; LDA [pointerLo], y &#xA0;; copy one background byte from address in pointer plus Y</div>
	<div>
		&#xA0; STA $2007 ; this runs 256 * 4 times (What the code used to do on this line)</div>
	<div>
		&#xA0;&#xA0;</div>
	<div>
		&#xA0; INY &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; inside loop counter</div>
	<div>
		&#xA0; CPY #$80</div>
	<div>
		&#xA0; BNE InsideLoopNMI &#xA0; &#xA0; &#xA0;; run the inside loop 256 times before continuing down&#xA0;(What the code used to do on this line)</div>
	<div>
		&#xA0;&#xA0;</div>
	<div>
		&#xA0; TYA;Transfering y to Accumulator A</div>
	<div>
		&#xA0; STA pointerY;Attempting to store where I left off in pointerY for next NMI loop</div>
	<div>
		&#xA0;&#xA0;</div>
	<div>
		&#xA0; INC pointerHi &#xA0; &#xA0; &#xA0; ; low byte went 0 to 256, so high byte needs to be changed now&#xA0;(What the code used to do on this line)</div>
	<div>
		&#xA0;&#xA0;</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; ;;IF(Background is completely loaded){changeBG=FALSE;}</div>
	<div>
		&#xA0; ;LDA #$01</div>
	<div>
		&#xA0; ;STA changeBG</div>
	<div>
		LoadBackgroundNMIDone:</div>
	<div>
		;;End Background Control</div>
</div>
<br>
And Finally, my setbackgroundpointer Function:<br>
<br>
<br>
<div class="FTQUOTE">
	<div>
		SetBackGroundPointer:</div>
	<div>
		&#xA0; LDA screenNumber</div>
	<div>
		&#xA0; and #$01 &#xA0; ;isolate the bit representing &quot;up&quot;, by clearing all the other bits</div>
	<div>
		&#xA0; beq LoadScreen1Done &#xA0;&#xA0;</div>
	<div>
		LoadScreen1: &#xA0;</div>
	<div>
		&#xA0; LDA #HIGH(background)</div>
	<div>
		&#xA0; STA pointerHi &#xA0; &#xA0; &#xA0; ; put the high byte of the address into pointer</div>
	<div>
		LoadScreen1Done:</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; LDA screenNumber</div>
	<div>
		&#xA0; and #$02 &#xA0; ;isolate the bit representing &quot;up&quot;, by clearing all the other bits</div>
	<div>
		&#xA0; beq LoadScreen2Done &#xA0;&#xA0;</div>
	<div>
		LoadScreen2: &#xA0;</div>
	<div>
		&#xA0; LDA #HIGH(backgroundtwo)</div>
	<div>
		&#xA0; STA pointerHi &#xA0; &#xA0; &#xA0; ; put the high byte of the address into pointer</div>
	<div>
		LoadScreen2Done:</div>
	<div>
		&#xA0;&#xA0;</div>
	<div>
		&#xA0; RTS &#xA0;</div>
</div>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__12">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Aug 15, 2013 at 9:44:36 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You&apos;re not pointing to the right place in $2006 in the different times through the loop.  If you&apos;re going to do it this way, the LDA #$20 and LDA #$00 will have to be variables linked to the time you are within that loading loop.
<br>
<br>Or, simply switch off the background and do it all at once.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__13">
                                                        <div class="mdl-card__title"><strong>LucasWeatherby</strong> posted on 
		
			
				
				Aug 15, 2013 at 10:33:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	Or, simply switch off the background and do it all at once.</div>
<br>
<br>
I was under the impression you couldnt change the entire background in one NMI?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__14">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Aug 15, 2013 at 10:37:36 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>LucasWeatherby</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
		<br>
		Or, simply switch off the background and do it all at once.</div>
	<br>
	<br>
	I was under the impression you couldnt change the entire background in one NMI?</div>
Not in NMI, but if you turn off the background, you can do whatever you want.&#xA0;<br>
<br>
It&apos;s buried in here or one of my other tutorials somewhere.<br>
<br>
<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=38605" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=38605">http://nintendoage.com/forum/messageview.cfm?catid=22&amp;th...</a> <br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__15">
                                                        <div class="mdl-card__title"><strong>LucasWeatherby</strong> posted on 
		
			
				
				Aug 15, 2013 at 11:36:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>LucasWeatherby</b></i><br>
		<br>
		<div class="FTQUOTE">
			<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
			<br>
			Or, simply switch off the background and do it all at once.</div>
		<br>
		<br>
		I was under the impression you couldnt change the entire background in one NMI?</div>
	Not in NMI, but if you turn off the background, you can do whatever you want.&#xA0;<br>
	<br>
	It&apos;s buried in here or one of my other tutorials somewhere.<br>
	<br>
	<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=38605" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=38605">http://nintendoage.com/forum/messageview.cfm?catid=22&amp;th...</a> <br>
	&#xA0;</div>
<br>
Hmm... I have yet to go thru your tutorials. I was hoping to finish with this tutorial 8 and then start fresh with yours. It appears that they build onto eachother. Should I just save my question until I make it through all of your tutorials? I have the pong game almost completely finished besides having a title screen and a game over screen...<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__16">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Aug 15, 2013 at 2:48:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you are changing to a completely different screen, just turn the screen off and load the entire new nametable.  That way you won&apos;t have to worry about nmi or vblank or anything like that.
<br>
<br>Updating background tiles with the screen on (during vblank) is only needed if you&apos;re updating some sort of gameplay background graphics while one is playing the game.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__17">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Mar 31, 2014 at 5:18:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Questions in the code below. Actaully, more like clarification.
<br>
<br>Question(s) 1: In the line of &quot;LDA #HIGH(background)&quot;, can I assume that #HIGH and (background) is understood by the system? Did we tell the system to understand this in our code somewhere or does it just know? Is there a correct time to use #LOW(background) instead of #$00, or are they the same?
<br>
<br>Question 2: The brackets [] are confusing me around the pointerLo. Why does that pointer get brackets and pointerHi not? I keep reading the Indirect Indexed Mode, but I get more confused each time.
<br>
<br>  LDA #$00
<br>  STA pointerLo       ; put the low byte of the address of background into pointer
<br>  LDA #HIGH(background)
<br>  STA pointerHi       ; put the high byte of the address into pointer
<br>  
<br>  LDX #$00            ; start at pointer + 0
<br>  LDY #$00
<br>OutsideLoop:
<br>  
<br>InsideLoop:
<br>  LDA [pointerLo], y  ; copy one background byte from address in pointer plus Y
<br>  STA $2007           ; this runs 256 * 4 times
<br>  
<br>  INY                 ; inside loop counter
<br>  CPY #$00
<br>  BNE InsideLoop      ; run the inside loop 256 times before continuing down
<br>  
<br>  INC pointerHi       ; low byte went 0 to 256, so high byte needs to be changed now
<br>  
<br>  INX
<br>  CPX #$04
<br>  BNE OutsideLoop     ; run the outside loop 256 times before continuing down
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__18">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Mar 31, 2014 at 5:22:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					1: They are not the same. HIGH() is an ASSEMBLER FUNCTION and goes to the label we used, and pulls the high and low bytes with the function to get them so in our code we don&apos;t have to use random numbers, when it moves our code is automatically right.
<br>
<br>2: [] addressing mode means &quot;Look at where zeropage (variable name in []) points to and adds Y to it. The INC doesn&apos;t need brackets because we don&apos;t care wtf it points to, it just need to be incremented so our data is pulled right from the pointer location. Pointer is a 2 byte variable. low and high attached just say which byte it is we are accessing, with the low byte being the pointer it&apos;s self.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__19">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Apr 1, 2014 at 8:12:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	Is there a correct time to use #LOW(background) instead of #$00, or are they the same?</div>
In this case it doesn&apos;t matter much, because the code expects the lowbyte to be $00, otherwise it doesn&apos;t work. But it would be preferable to use LOW(background) for clarity. In some assemblers you can define an ASSERT, so that if &quot;background&quot; is moved to some other place and is no more aligned to a 256-byte page, the code would no longer compile (which lets you know that there&apos;s a problem and you have to fix it).<br>
<br>
LOW() and HIGH() are NESASM specific operations, other assemblers most often use &lt;background and &gt;background for the same purpose (&quot;&lt;&quot; = low, &quot;&gt;&quot; = high).<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__20">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 1, 2014 at 9:18:48 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks 3GenGames and thefox! It makes a bit more sense now. Don&apos;t have the full grasp of the [] yet, but what 3Gen mentions make sense to me. Adding a value to an address requires brackets, incrementing does not. IT&apos;s kind of like how Excel distinguishes a string from a value with quotes &quot;&quot;. Obviously, it not exactly the same, but the theory is the same and it&apos;s something I can relate the code to so it makes sense to me.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__21">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Apr 2, 2014 at 1:05:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	Thanks 3GenGames and thefox! It makes a bit more sense now. Don&apos;t have the full grasp of the [] yet, but what 3Gen mentions make sense to me.</div>
Here&apos;s an example:<br>
<br>
Let&apos;s say the memory (RAM) is laid out as follows:<br>
<pre>Address    Value
-------    -----
$0010      $12
$0011      $34
$0066      $78
$3468      $9A</pre>
Let&apos;s also start with <strong>Y = $56</strong> for the sake of the example.<br>
<br>
Now, <strong>LDA $10,Y</strong>&#xA0;would load A from the address <strong>$10+Y = $10+$56 = $66</strong>, so <strong>A = $78</strong>.<br>
<br>
If you do <strong>LDA [$10],Y</strong>, 6502 first fetches a 16-bit address from memory at <strong>$10</strong> and <strong>$11</strong>. The address, in this case, is <strong>$3412</strong> (6502 is little-endian, meaning the low byte of address is stored first in memory). It then takes that address and adds Y to it. Result is <strong>$3412 + Y = $3412 + $56 = $3468</strong>. Finally, it fetches the byte from this address, so in this case, <strong>A = $9A</strong>.<br>
<br>
Note that even though you can use a 16-bit address with the&#xA0;<strong>LDA aaaa,Y</strong> addressing mode, <strong>LDA (aa),Y</strong>&#xA0;only accepts 8-bit addresses (in other words, the address must be on the zero page).<br>
<br>
Also note that many other assemblers use the notation <strong>LDA ($10),Y</strong> for the exact same thing that is&#xA0;<strong>LDA [$10],Y</strong>&#xA0;in NESASM.<br>
<br>
Finally note that names like <strong>pointerLo</strong>, <strong>pointerHi</strong>, <strong>background</strong>, etc. are just fancy names for memory addresses to make the code easier to write and understand. In this case, you could create symbols like&#xA0;<strong>pointerLo=$10</strong> and <strong>pointerHi=$11</strong>, but I left them out to make the example easier to grasp.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__22">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 2, 2014 at 1:51:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Mega Mario Man</b></i><br>
		<br>
		Thanks 3GenGames and thefox! It makes a bit more sense now. Don&apos;t have the full grasp of the [] yet, but what 3Gen mentions make sense to me.</div>
	Here&apos;s an example:<br>
	<br>
	Let&apos;s say the memory (RAM) is laid out as follows:<br>
	<pre>Address    Value
-------    -----
$0010      $12
$0011      $34
$0066      $78
$3468      $9A</pre>
	Let&apos;s also start with <strong>Y = $56</strong> for the sake of the example.<br>
	<br>
	Now, <strong>LDA $10,Y</strong>&#xA0;would load A from the address <strong>$10+Y = $10+$56 = $66</strong>, so <strong>A = $78</strong>.<br>
	<br>
	If you do <strong>LDA [$10],Y</strong>, 6502 first fetches a 16-bit address from memory at <strong>$10</strong> and <strong>$11</strong>. The address, in this case, is <strong>$3412</strong> (6502 is little-endian, meaning the low byte of address is stored first in memory). It then takes that address and adds Y to it. Result is <strong>$3412 + Y = $3412 + $56 = $3468</strong>. Finally, it fetches the byte from this address, so in this case, <strong>A = $9A</strong>.<br>
	<br>
	Note that even though you can use a 16-bit address with the&#xA0;<strong>LDA aaaa,Y</strong> addressing mode, <strong>LDA (aa),Y</strong>&#xA0;only accepts 8-bit addresses (in other words, the address must be on the zero page).<br>
	<br>
	Also note that many other assemblers use the notation <strong>LDA ($10),Y</strong> for the exact same thing that is&#xA0;<strong>LDA [$10],Y</strong>&#xA0;in NESASM.<br>
	<br>
	Finally note that names like <strong>pointerLo</strong>, <strong>pointerHi</strong>, <strong>background</strong>, etc. are just fancy names for memory addresses to make the code easier to write and understand. In this case, you could create symbols like&#xA0;<strong>pointerLo=$10</strong> and <strong>pointerHi=$11</strong>, but I left them out to make the example easier to grasp.</div>
The pointers I get, I have used them in other languages. In the case of #HIGH(background), I wasn&apos;t for sure if background was a term that NES 6502 knew itself or was it actually refering to the subroutine holding the background data.<br>
<br>
I like your example showing the difference betweem LDA [$10],Y and LDA $10,Y. Visualizing the results is a perfect way to explain this. In fact, I really don&apos;t understand a lot of the tutorials until I dig into the source code from the tutorial and change values. Then I can see the results of what I just changed in the emulator. That&apos;s when the light bulb turns on!<br>
<br>
&apos;m very much a visual learner as opposed to reading. Seeing the code on screen and reading the explanations of what it does confuses me. Actually tinkering with the code and checking the results is where I learn the most.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-8__23">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 2, 2014 at 6:40:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					background is generally a data map with a bunch of values of tile numbers that make up the nametable.  It isn&apos;t anything that the assembler knows natively. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>


                <div class="spacer"></div>

                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="main_tutorial-9">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">9: 数字转换，BIN - DEC 二进制 十进制</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        
					<b>This Week</b>: NES uses binary and hex, but your gamers want to read in decimal?  Here are two solutions for displaying scores and other numbers in a readable way.<br>
<br><span class="Apple-style-span" style="font-size: medium; "><b>
BCD Mode</b></span><br>
The 6502 processor has a mode called BCD, or Binary Coded Decimal, where the adc/sbc instructions properly handle decimal numbers instead of binary numbers.  The NES is not a full 6502 processor and does not include this mode.  Be careful when you are searching for code to not copy any that uses that mode, or you will get incorrect results.  If the code is doing a SED instruction, it is enabling the decimal mode and you should not use it.  Instead you get to do all the decimal handling yourself!
<br>
<br><b><span class="Apple-style-span" style="font-size: medium; ">
Storing Digits</span></b><br>
The first method uses more code, but may be easier to understand.  Say your score is a 5 digit number.  You will make 5 variables, one for each digit.  Those variables will only count from 0 to 9 so you need to write code to handle addition and subtraction.  Super Mario uses this method.  It&apos;s lowest digit is always 0, so that isn&apos;t actually stored in a variable.  Instead it is just a permanent part of the background.
<br><br>
We will start with just incrementing a 3 digit number to see how its done:<br>
<pre>IncOnes:
  LDA onesDigit     ; load the lowest digit of the number
  CLC 
  ADC #$01          ; add one
  STA onesDigit
  CMP #$0A          ; check if it overflowed, now equals 10
  BNE IncDone       ; if there was no overflow, all done
IncTens:
  LDA #$00
  STA onesDigit     ; wrap digit to 0
  LDA tensDigit     ; load the next digit
  CLC 
  ADC #$01          ; add one, the carry from previous digit
  STA tensDigit
  CMP #$0A          ; check if it overflowed, now equals 10
  BNE IncDone       ; if there was no overflow, all done
IncHundreds:
  LDA #$00
  STA tensDigit     ; wrap digit to 0
  LDA hundredsDigit ; load the next digit
  CLC 
  ADC #$01          ; add one, the carry from previous digit
  STA hundredsDigit
IncDone:
</pre><br>
When the subroutine starts, the ones digit is incremented.  Then it is checked if it equals $0A which is decimal 10. That number doesn&apos;t fit in just one digit, so the ones digit is set to 0 and the tens digit is incremented.  The tens digit is then checked in the same way, and the chain continues for as many digits as you want.<br>
<br>
The same process is used for decrementing, except you check for underflow (digit=$FF) and wrap the digit to $09.<br>
<br>
Adding two numbers is the same idea, except other than checking if each digit equals $0A you need to check if the digit is $0A or above.  So instead of BEQ the opcode will be BCC.<br>
<pre>AddOnes:
  LDA onesDigit      ; load the lowest digit of the number
  CLC 
  ADC onesAdd        ; add new number, no carry
  STA onesDigit
  CMP #$0A           ; check if digit went above 9. If accumulator &gt;= $0A, carry is set
  BCC AddTens        ; if carry is clear, all done with ones digit
                     ; carry was set, so we need to handle wrapping
  LDA onesDigit
  SEC
  SBC #$0A           ; subtract off what doesnt fit in 1 digit
  STA onesDigit      ; then store the rest
  INC tensDigit      ; increment the tens digit
AddTens:
  LDA tensDigit      ; load the next digit
  CLC
  ADC tensAdd        ; add new number
  STA tensDigit
  CMP #$0A           ; check if digit went above 9
  BCC AddHundreds    ; no carry, digit done
  LDA tensDigit
  SEC
  SBC #$0A           ; subtract off what doesnt fit in 1 digit
  STA tensDigit      ; then store the rest
  INC hundredsDigit  ; increment the hundreds digit
AddHundreds:
  LDA hundredsDigit  ; load the next digit
  CLC
  ADC hundredsAdd    ; add new number
  STA hundredsDigit
AddDone:
</pre><br>
When that code is all done, the ones/tens/hundreds digits will hold the new value.  With both code samples there is no check at the end of the hundreds digit.  That means when the full number is 999 and you add one more, the result will be wrong!  In your code you can either wrap around all the digits to 0, or set all the digits to 999 again for a maximum value.  Of course if your players are hitting the max they likely want more digits!<div><br>
<br><span class="Apple-style-span" style="font-size: medium; "><b>
Binary to Decimal Conversion</b></span><br>
The second method of handling number displays uses less code, but could use much more CPU time.  The idea is to keep you numbers in plain binary form (8 or 16 bit variables) for the math, then convert them to decimal for displaying only.  An 8 bit binary value will give you 3 decimal digits, and a 16 bit binary will give 5 decimal digits.<br>
<br>
This first example is coded to be understandable, not fast or small.  Each step compares the binary value to a significant decimal value (100 and then 10).  If the binary is larger, that value is subtracted from the binary and the final decimal digit is incremented.  So for a text example:
<br><pre>initial binary: 124
initial decimal: 000
</pre><pre>1: compare to 100
2: 124 greater than 100, so subtract 100 and increment the decimal hundreds digit
3: repeat hundreds again
</pre><pre>current binary: 024
current decimal: 100
</pre><pre>1: compare to 100
2: 024 less than 100, so all done with hundreds digit
</pre><pre>current binary: 024
current decimal: 100
</pre><pre>1: compare to 10
2: 024 greater than 10, so subtract 10 and increment the decimal tens digit
3 repeat tens again
</pre><pre>current binary: 014
current decimal: 110
</pre><pre>1: compare to 10
2: 014 greater than 10, so subtract 10 and increment the decimal tens digit
3 repeat tens again
</pre><pre>current binary: 004
current decimal: 120
</pre><pre>etc for ones digit
</pre>
<br>
You can see this will transfer the binary to decimal one digit at a time.  For numbers with large digits (like 249) this will take longer than numbers with small digits (like 112).  Here is the code:
<br>
<pre>HundredsLoop:
  LDA binary
  CMP #100             ; compare binary to 100
  BCC TensLoop         ; if binary &lt; 100, all done with hundreds digit
  LDA binary
  SEC
  SBC #100
  STA binary           ; subtract 100, store whats left
  INC hundredsDigit    ; increment the digital result
  JMP HundredsLoop     ; run the hundreds loop again
</pre><pre>TensLoop:
  LDA binary
  CMP #10              ; compare binary to 10
  BCC OnesLoop         ; if binary &lt; 10, all done with hundreds digit
  LDA binary
  SEC
  SBC #10
  STA binary           ; subtract 10, store whats left
  INC tensDigit        ; increment the digital result
  JMP TensLoop         ; run the tens loop again
</pre><pre>OnesLoop:
  LDA binary
  STA onesDigit        ; result is already under 10, can copy directly to result
</pre>
<br>
This code can be expanded to 16 bit numbers, but the compares become harder.  Instead a more complex series of loops and shifts with a table is used.  This code does shifting of the binary value into the carry bit to tell when to add numbers to the final decimal result.  I did not write this code, it came from a post by Tokumaru at <a href="http://nesdev.parodius.com/bbs/viewtopic.php?p=10824&amp;sid=55359b42282d1e02b91bebcf1caf56ef#10824" target="_blank" original-href="http://nesdev.parodius.com/bbs/viewtopic.php?p=10824&amp;sid=55359b42282d1e02b91bebcf1caf56ef#10824">http://nesdev.parodius.com/bbs/vi...</a>  There are many more examples of different conversion styles at that forum thread.
<br><br>
Notice there are no branches other than the loop running 16 times (one for each binary input bit), so the conversion always takes the same number of cycles.
<br>
<pre>  tempBinary - 16 bits input binary value
  decimalResult - 5 bytes for the decimal result
</pre><pre>BinaryToDecimal:
   lda #$00 
   sta decimalResult+0
   sta decimalResult+1
   sta decimalResult+2
   sta decimalResult+3
   sta decimalResult+4
   ldx #$10 
BitLoop: 
   asl tempBinary+0 
   rol tempBinary+1
   ldy decimalResult+0
   lda BinTable, y 
   rol a
   sta decimalResult+0
   ldy decimalResult+1
   lda BinTable, y 
   rol a
   sta decimalResult+1
   ldy decimalResult+2
   lda BinTable, y 
   rol a
   sta decimalResult+2
   ldy decimalResult+3
   lda BinTable, y 
   rol a
   sta decimalResult+3
   rol decimalResult+4
   dex 
   bne BitLoop 
   rts 
BinTable:
   .db $00, $01, $02, $03, $04, $80, $81, $82, $83, $84
</pre>
<br>
<br><b><span class="Apple-style-span" style="font-size: medium; ">
Displaying Numbers</span></b><br>
Once you have your numbers in decimal format you need to display them on the screen.  With the code above all the results have 00000 = $00 $00 $00 $00 $00.  If your background tiles for digits start at tile 0 then that will work fine.  However if you are using ASCII you will need to add an offset to each digit.  The ASCII code for the digit 0 is $30, so you just add $30 to each digit before writing it to the background.  If your code uses the first method of compare/wrapping digits, then you could compare to $3A and wrap to $30 to automatically handle this.  You would just need to make sure you set each digit to $30 instead of $00 when clearing the number to 00000.  You have control over where background tiles are located, so the offset for the digit tiles can be whatever you choose.
<br>
<br><b><span class="Apple-style-span" style="font-size: medium; ">
Putting It All Together</span></b><br>
Download and unzip the <a href="scraper/files/pong2.zip" target="_blank" original-href="http://www.nespowerpak.com/nesasm/pong2.zip">pong2.zip</a> sample files.  The playing game state and ball movement code is in the pong2.asm file. Make sure that file, mario.chr, and pong2.bat is in the same folder as NESASM3, then double click on pong1.bat. That will run NESASM3 and should produce pong2.nes. Run that NES file in FCEUXD SP to see the score!  Right now the score just increments every time the ball bounces off a side wall.<br>
<br>
Try making two scoring variables and drawing them both.  You can also use the other binary to decimal converters to add more than 1 to the score each time.  In the DrawScore you can also check the score digits and not draw any leading zeros.  Instead replace them with spaces when you are drawing to the background.
</div>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#main_tutorial-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;main_tutorial-9__comments&apos;);">
                            是否显示评论内容
                        </a>
                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33308" target="_blank">
                                来源网页
                            </a>
                        </div>
                    </div>
                </div>

                <div class="comments" style="display: none;" id="main_tutorial-9__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__1">
                                                        <div class="mdl-card__title"><strong>Dain</strong> posted on 
		
			
				
				May 16, 2010 at 8:50:03 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That bored in Hawaii? <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__2">
                                                        <div class="mdl-card__title"><strong>arch_8ngel</strong> posted on 
		
			
				
				May 16, 2010 at 9:12:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Dain</b></i><br><br>That bored in Hawaii? <img border="0" src style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"></div><br><br>A few years back when I took a vacation to Hawaii, I had my best game of Tetris DX ever <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-tongue.gif" show-src="images/blank.gif"><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__3">
                                                        <div class="mdl-card__title"><strong>albailey</strong> posted on 
		
			
				
				May 16, 2010 at 10:19:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I should point out that this particular activity is extremely useful for homebrewers, and not just beginners.
<br>
<br>When I did sudoku I was storing my score values as hex.  When I wanted to display them on the screen as decimal, I figured it would be a simple activity.  Not so much.  Every snippet of 6502 source code on the web for doing the conversion assumes you are using a NORMAL 6502 with decimal mode, instead of the NES 6502 where it has been removed.  
<br>As a result I ended up redesigning my scoring system to do what Bunny shows in the first algorithm, which is to store each digit in a separate variable.
<br>
<br>Nowadays I use the exact same BCD algorithm that bunny has shown here. It&apos;s definitely one you want to add to your code library.
<br>
<br>Thanks B,
<br>Al
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__4">
                                                        <div class="mdl-card__title"><strong>udisi</strong> posted on 
		
			
				
				May 16, 2010 at 11:23:48 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is awesomo 5000. Not that I had a lot of time lately, but this will be helpful
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__5">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 16, 2010 at 12:30:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes, this is very helpful.  I posted a variant of the first method in my dev blog sometime back.  It took me a VERY long time to make it work correctly, and after that, make it work as a loop for all the different counters visable on screen...then add stuff to make it maximum and minimum out.  I never thought to look on nesdev for it.  <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-tongue.gif" show-src="images/blank.gif">  I&apos;ll have to experiment with the second one.  Looks nifty.  Thanks again!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__6">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 8, 2011 at 9:40:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>I modified this to convert a 24-bit number to an 8 bit decimal.&#xA0; But it takes like 2200 cycles or 18 scan lines.&#xA0; Surely there&apos;s a faster way.&#xA0; Can anyone point me in the right direction?</p><p>;-----------------------------------------------------------------------------------------------------</p><p>;&#xA0; tempBinary - 16 bits input binary value<br>;&#xA0; decimalResult - 5 bytes for the decimal result<br>BinaryToDecimal:<br>&#xA0;&#xA0; lda #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;;2<br>&#xA0;&#xA0; sta decimalResult+0&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; sta decimalResult+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; sta decimalResult+2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; sta decimalResult+3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; sta decimalResult+4&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; sta decimalResult+5&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; sta decimalResult+6&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; sta decimalResult+7&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; ldx #$18&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0; ;2<br>BitLoop: <br>&#xA0;&#xA0; asl tempBinary+0&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0; ;6<br>&#xA0;&#xA0; rol tempBinary+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; ;6<br>&#xA0;&#xA0; rol tempBinary+2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; ;6<br>&#xA0;&#xA0; ldy decimalResult+0&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;4<br>&#xA0;&#xA0; lda BinTable, y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;4<br>&#xA0;&#xA0; rol a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; ;2<br>&#xA0;&#xA0; sta decimalResult+0&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; ldy decimalResult+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; lda BinTable, y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4 <br>&#xA0;&#xA0; rol a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; ;2<br>&#xA0;&#xA0; sta decimalResult+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; ldy decimalResult+2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; lda BinTable, y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4 <br>&#xA0;&#xA0; rol a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; ;2<br>&#xA0;&#xA0; sta decimalResult+2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; ldy decimalResult+3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; lda BinTable, y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;4 <br>&#xA0;&#xA0; rol a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;;2<br>&#xA0;&#xA0; sta decimalResult+3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; ldy decimalResult+4&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; lda BinTable, y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4 <br>&#xA0;&#xA0; rol a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;2<br>&#xA0;&#xA0; sta decimalResult+4&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; ldy decimalResult+5&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; lda BinTable, y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4 <br>&#xA0;&#xA0; rol a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;2<br>&#xA0;&#xA0; sta decimalResult+5&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; ldy decimalResult+6&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; lda BinTable, y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4 <br>&#xA0;&#xA0; rol a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;2<br>&#xA0;&#xA0; sta decimalResult+6&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;4<br>&#xA0;&#xA0; rol decimalResult+7&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;6<br>&#xA0;&#xA0; dex&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; ;2<br>&#xA0;&#xA0; bne BitLoop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;2<br>&#xA0;&#xA0; rts </p><p>BinTable:<br>&#xA0;&#xA0; .db $00, $01, $02, $03, $04, $80, $81, $82, $83, $84</p><p>;-----------------------------------------------------------------------------------------------------</p><p>&#xA0;</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__7">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				May 13, 2013 at 3:54:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, this was helpful for me too! I found a need to modify it to do multiple stats for characters, so I went ahead and made a pastebin of it. Here&apos;s the link for any that want to check it out. It&apos;s a modification of the second example:
<br>
<br><a href="http://pastebin.com/u8gzgPCN" target="_blank" original-href="http://pastebin.com/u8gzgPCN">http://pastebin.com/u8gzgPCN...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__8">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jan 19, 2014 at 3:45:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Finally got a score system working. For now, it only increments by 25, but I added a little part that keeps track of an eventual Hi Score <span class="sprites_emoticons absmiddle" id="emo_tongue"></span><br>
Yes, it&apos;s from what I&apos;m trying to program, so there are some weird values that refer to the score sprites I&apos;ve used.<br>
<br>
UpdateScore:<br>
<br>
AddOnes:<br>
LDA score1 ; load the lowest digit of the number<br>
CLC<br>
ADC #$05 ; add new number, no carry<br>
STA score1<br>
STA $0285<br>
CMP #$2A ; check if digit went above 9. If accumulator &gt;= $0A, carry is set<br>
BCC AddTens ; if carry is clear, all done with ones digit<br>
; carry was set, so we need to handle wrapping<br>
LDA score1<br>
SEC<br>
SBC #$0A ; subtract off what doesnt fit in 1 digit<br>
STA score1<br>
STA $0285 ; then store the rest<br>
INC score10<br>
INC $0281 ; increment the tens digit<br>
AddTens:<br>
LDA score10 ; load the tens digit of the number<br>
CLC<br>
ADC #$02 ; add new number, no carry<br>
STA score10<br>
STA $0281<br>
CMP #$2A ; check if digit went above 9. If accumulator &gt;= $0A, carry is set<br>
BCC AddHundreds ; if carry is clear, all done with tens digit<br>
; carry was set, so we need to handle wrapping<br>
LDA score10<br>
SEC<br>
SBC #$0A ; subtract off what doesnt fit in 1 digit<br>
STA score10<br>
STA $0281 ; then store the rest<br>
INC score100<br>
INC $027D ; increment the hundreds digit<br>
AddHundreds:<br>
LDA score100 ; load the hundreds digit of the number<br>
CMP #$2A ; check if digit went above 9. If accumulator &gt;= $0A, carry is set<br>
BCC AddThousands ; if carry is clear, all done with ones digit<br>
; carry was set, so we need to handle wrapping<br>
LDA score100<br>
SEC<br>
SBC #$0A ; subtract off what doesnt fit in 1 digit<br>
STA score100<br>
STA $027D ; then store the rest<br>
INC score1000<br>
INC $0279 ; increment the thousands digit<br>
AddThousands:<br>
LDA score1000 ; load the thousands digit of the number<br>
CMP #$2A ; check if digit went above 9. If accumulator &gt;= $0A, carry is set<br>
BCC AddTThousands ; if carry is clear, all done with T digit<br>
; carry was set, so we need to handle wrapping<br>
LDA score1000<br>
SEC<br>
SBC #$0A ; subtract off what doesnt fit in 1 digit<br>
STA score1000<br>
STA $0279 ; then store the rest<br>
INC score10000<br>
INC $0275 ; increment the ten thousands digit<br>
AddTThousands:<br>
LDA score10000 ; load the ten thousands digit of the number<br>
CMP #$2A ; check if digit went above 9. If accumulator &gt;= $0A, carry is set<br>
BCC EndScore ; if carry is clear, all done with TT digit<br>
; carry was set, so we need to handle wrapping<br>
LDA score10000<br>
SEC<br>
SBC #$0A ; subtract off what doesnt fit in 1 digit<br>
STA score10000<br>
STA $0275 ; then store the rest<br>
INC score100000<br>
INC $0271 ; increment the Hundred Thousands digit<br>
EndScore:<br>
<br>
<br>
HiScoreCheck:<br>
LDA score100000<br>
CMP hiscore100000<br>
BEQ TenThousandsCheck<br>
BCS WriteHi<br>
JMP EndHi<br>
TenThousandsCheck:<br>
LDA score10000<br>
CMP hiscore10000<br>
BEQ ThousandsCheck<br>
BCS WriteHi<br>
JMP EndHi<br>
ThousandsCheck:<br>
LDA score1000<br>
CMP hiscore1000<br>
BEQ HundredsCheck<br>
BCS WriteHi<br>
JMP EndHi<br>
HundredsCheck:<br>
LDA score100<br>
CMP hiscore100<br>
BEQ TensCheck<br>
BCS WriteHi<br>
JMP EndHi<br>
TensCheck:<br>
LDA score10<br>
CMP hiscore10<br>
BEQ OnesCheck<br>
BCS WriteHi<br>
JMP EndHi<br>
OnesCheck:<br>
LDA score1<br>
CMP hiscore1<br>
BEQ EndHi<br>
BCS WriteHi<br>
JMP EndHi<br>
WriteHi:<br>
<br>
LDA $0285<br>
STA $02A5<br>
LDA $0281<br>
STA $02A1<br>
LDA $027D<br>
STA $029D<br>
LDA $0279<br>
STA $0299<br>
LDA $0275<br>
STA $0295<br>
LDA $0271<br>
STA $0291<br>
LDA $0285<br>
STA hiscore1<br>
LDA $0281<br>
STA hiscore10<br>
LDA $027D<br>
STA hiscore100<br>
LDA $0279<br>
STA hiscore1000<br>
LDA $0275<br>
STA hiscore10000<br>
LDA $0271<br>
STA hiscore100000<br>
EndHi:
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__9">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jan 20, 2014 at 3:38:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Was there a question in here or just posting code? <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__10">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jan 20, 2014 at 5:31:39 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br><br>Was there a question in here or just posting code? <span class="sprites_emoticons absmiddle" id="emo_smile"></span></div><br><br><br>
That was a code post <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__11">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				May 4, 2014 at 11:27:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					A few months later, I finally came back to this thread with a new, updated scoring routine that puts the old one to shame. It does the same thing as the old one, except it is much more compact and the score loops at 999990. This time, you have to do .rs 5 when declaring the &quot;score&quot; and &quot;hiscore&quot; variables. All other variables are &quot;normal&quot; .rs 1 variables<br>
<br>
CheckScores:<br>
&#xA0; LDX #$04&#xA0; ;Lowest digit in score RAM is score+4<br>
CheckScoresX:<br>
&#xA0; CPX #$FF&#xA0; ;If all 5 digits have been done (If the game has 6 digits, the 6th is in the BG)<br>
&#xA0; BEQ ScoreCheckDone ;Go to the end of the subroutine<br>
&#xA0; LDA score,x&#xA0; ;Loads a score digit in the accumulator<br>
&#xA0; CMP #$0B&#xA0; ;Compares it to 0B (A in CHR)<br>
&#xA0; BCC ScoreOK&#xA0; ;And goes to ScoreOK if it&apos;s smaller than 0A<br>
&#xA0; SEC&#xA0;&#xA0; ;If not, substract 10 to the score<br>
&#xA0; SBC #$0A<br>
&#xA0; STA score,x<br>
&#xA0; DEX<br>
&#xA0; INC score,x&#xA0; ;And increments the next digit<br>
&#xA0; JMP CheckScoresX<br>
ScoreOK:<br>
&#xA0; DEX<br>
&#xA0; JMP CheckScoresX<br>
ScoreCheckDone:<br>
&#xA0; LDX #$00&#xA0; ;This time, we start at the highest digit<br>
HiScoreCheck:<br>
&#xA0; LDA score,x&#xA0; ;Load the score and compare it to the HiScore (first 10K, then 1K, etc.)<br>
&#xA0; CMP hiscore,x<br>
&#xA0; BEQ NextHiDigit ;If it&apos;s equal, check the next digit<br>
&#xA0; BCS WriteHi&#xA0; ;If it&apos;s higher, it&apos;s higher than our hiscore! Write it then <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
&#xA0; JMP HiScoreCheckDone ;If not, check the next digit<br>
NextHiDigit:<br>
&#xA0; INX<br>
&#xA0; JMP HiScoreCheck<br>
WriteHi:<br>
&#xA0; LDX #$00<br>
WriteHiX:<br>
&#xA0; LDA score,x&#xA0; ;Takes the score variable<br>
&#xA0; STA hiscore,x&#xA0; ;And rams them in the HiScore variables<br>
&#xA0; INX<br>
&#xA0; CPX #$05<br>
&#xA0; BNE WriteHiX<br>
HiScoreCheckDone:<br>
&#xA0; RTS
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__12">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Oct 11, 2015 at 8:49:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So I have the 16-bit example working (the last one), but it is doing some screwy things. Like, when a button changes the values, it resets to zero (once) before adding/subtracting at the correct rate. Unless I run the routine twice when loading the game state, then the desired number is preserved, and the addition/subtraction adds or subtracts from that value. So I guess my question is, using the last example, how does one modify the values correctly? I could keep making it work the way that I have it, but frankly it bothers me that I cannot figure out why it is doing this. It (or something else) is also messing with my subtraction routines some, I think.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__13">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Oct 11, 2015 at 9:36:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br>
<br>
So I have the 16-bit example working (the last one), but it is doing some screwy things. Like, when a button changes the values, it resets to zero (once) before adding/subtracting at the correct rate. Unless I run the routine twice when loading the game state, then the desired number is preserved, and the addition/subtraction adds or subtracts from that value. So I guess my question is, using the last example, how does one modify the values correctly? I could keep making it work the way that I have it, but frankly it bothers me that I cannot figure out why it is doing this. It (or something else) is also messing with my subtraction routines some, I think.</div>
<br>
I&apos;ll be happy to help, but without seeing the code it is hard to tell what is wrong with it.<br>
Also, by &quot;the last one&quot;, do you mean the last (second) one bunnyboy posted in the first post of this thread, or the one Vec posted just above your post?<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__14">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Oct 11, 2015 at 9:53:56 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The 16-bit one in the OP. I guess I am also curious why I cannot add to the TempBinary variables directly, but have to buffer them through another variable instead (i.e. load a value into a variable, and then add this to TempBinary).<br>
<br>
EDIT: regardless, what I am curious about is how to modify these values correctly, and not necessarily how to correct my own code.<br>
<br>
Double Edit: took a break and figured it out. Well, re-figured it out since I had it figured out a couple weeks ago, but I lost it due to not being able to work on it. The TempBinary is not the value itself (duh!), therefore it does not matter what I do to it. Though I still feel as though there should be a way to alter it directly. Anyways...<br>
<br>
So the only question that I have left is: why does the value have to be added to TempBinary? Why cannot it simply be stored? In other words, this does not work:<br>
<br>
LDA HexValue<br>
STA TempBinary<br>
LDA HexValue+1<br>
STA TempBinary+1<br>
<br>
But this does:<br>
<br>
LDA TempBinary<br>
CLC<br>
ADC HexValue<br>
STA TempBinary<br>
<br>
LDA TempBinary+1<br>
CLC<br>
ADC HexValue+1<br>
STA TempBinary+1<br>
<br>
I&apos;m bracing for a lesson in the Carry...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__15">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Oct 11, 2015 at 11:55:54 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br>
<br>
But this does:<br>
<br>
LDA TempBinary<br>
CLC<br>
ADC HexValue<br>
STA TempBinary<br>
<br>
LDA TempBinary+1<br>
CLC&#xA0; ;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &lt;-- WHY?<br>
ADC HexValue+1<br>
STA TempBinary+1</div>
I admit that I&apos;m not too sure about what you are trying to achieve here, but if in your code in case of overflow of the first ADC the second ADC must be increased by an extra 01, then I think you should not clear the carry before the second ADC. Again, probably I misunderstood your goals here, I see no references to this snippet of code in bunnyboy post.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__16">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Oct 12, 2015 at 2:58:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br>
<br>
The 16-bit one in the OP. I guess I am also curious why I cannot add to the TempBinary variables directly, but have to buffer them through another variable instead (i.e. load a value into a variable, and then add this to TempBinary).<br>
<br>
EDIT: regardless, what I am curious about is how to modify these values correctly, and not necessarily how to correct my own code.<br>
<br>
Double Edit: took a break and figured it out. Well, re-figured it out since I had it figured out a couple weeks ago, but I lost it due to not being able to work on it. The TempBinary is not the value itself (duh!), therefore it does not matter what I do to it. Though I still feel as though there should be a way to alter it directly. Anyways...<br>
<br>
So the only question that I have left is: why does the value have to be added to TempBinary? Why cannot it simply be stored? In other words, this does not work:<br>
<br>
<strong>LDA HexValue<br>
STA TempBinary<br>
LDA HexValue+1<br>
STA TempBinary+1</strong><br>
<br>
But this does:<br>
<br>
<strong>LDA TempBinary<br>
CLC<br>
ADC HexValue<br>
STA TempBinary<br>
<br>
LDA TempBinary+1<br>
CLC<br>
ADC HexValue+1<br>
STA TempBinary+1</strong><br>
<br>
I&apos;m bracing for a lesson in the Carry...</div>
Assume for this example<br>
HexValue = 2<br>
TempBinary = 1<br>
<br>
<br>
<strong>LDA HexValue<br>
STA TempBinary<br>
LDA HexValue+1<br>
STA TempBinary+1</strong><br>
<br>
This would replace the values in TempBinary and TempBinary+1 with the values in HexValue and HexValue+1. So, HexValue = TempBinary. or 2=2<br>
=======================================================================<br>
<br>
<strong>LDA TempBinary<br>
CLC<br>
ADC HexValue<br>
STA TempBinary<br>
<br>
LDA TempBinary+1<br>
CLC<br>
ADC HexValue+1<br>
STA TempBinary+1</strong><br>
<br>
This would Load the value of TempBinary, add HexValue, and then write the sum value to TempBinary. So, TempBinary+HexValue = TempBinary.&#xA0; 1+2=3<br>
<br>
Hope that is what you were asking.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__17">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Oct 12, 2015 at 4:06:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					To be honest, I&apos;m not sure at this point <span class="sprites_emoticons absmiddle" id="emo_smile"></span>. Sadly, all I know is that my addition and subtraction routines work flawlessly, so far as I&apos;ve been able to test them. Can&apos;t really argue with results, but I&apos;m still curious about the transfer of values (or why a simple transfer won&apos;t work, but an addition is required).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__18">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Oct 12, 2015 at 5:42:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;d like to see a real life example, since you already caught your mistake on why your previous example didn&apos;t make any sense.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__19">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Oct 12, 2015 at 6:19:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br>
<br>
To be honest, I&apos;m not sure at this point . Sadly, all I know is that my addition and subtraction routines work flawlessly, so far as I&apos;ve been able to test them. Can&apos;t really argue with results, but I&apos;m still curious about the transfer of values (or why a simple transfer won&apos;t work, but an addition is required).</div>
The way I see it, there are 3 values:<br>
<strong>- HexValue<br>
- TempBinary<br>
- carry</strong><br>
<br>
The Carry flag can be either 1 (if the flag is set) or 0 (if the flag is not set, or reset).<br>
<br>
CLC means that you reset the carry flag to 00, so when you sum the value in the accumulator with the value after the opcode ADC, you will not add also +01.<br>
Since there is not an instruction ADD WITHOUT CARRY, when you use ADC and you don&apos;t want the carry flag to influence the result, you just set the carry to 0.<br>
In the example you posted above, you CLC twice, which is ok if it is what you need. Instead if you wish that an overflow in the first ADC adds +01 to the result of the second ADC, then you avoid that second CLC instruction.<br>
<br>
As MegaMarioMan pointed out, this code:
<pre>  LDA HexValue
  STA TempBinary</pre>
is different than this code:<br><br><pre>  LDA TempBinary
  CLC
  ADC HexValue
  STA TempBinary</pre>
Let say HexValue is == &quot;x&quot;, TempBinary is == &quot;y&quot;.<br>
(&quot;x&quot; and &quot;y&quot; are two values)<br>
<br>
In the first case, after running your code, TempBinary will be == &quot;x&quot;, because that is what you store into it with such code.<br>
<br>
In the second case, after running your code TempBinary will be == &quot;y&quot;+Hex00+&quot;x&quot;, since you load the old value, then you add the carry, and you add HexValue. In the socond case you are not moving a value from a variable to another, but you are summing, adding also the carry, the two values, and you are storing that result into TempBinary.<br>
<br>
I feel like likely I am missing something you are trying to explain, but I think that if you look at your own two snippets of code for like 20 seconds, you will immediately realize that they don&apos;t do the same thing at all, math wise. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Hope this helps. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__20">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Oct 12, 2015 at 6:33:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					He already realized that, Jack. That&apos;s why I asked for another actual example that contains the problem that he has questions with.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__21">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Oct 12, 2015 at 6:46:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
He already realized that, Jack. That&apos;s why I asked for another actual example that contains the problem that he has questions with.</div>
<br>
That&apos;s what I was thinking too. That&apos;s why I said in my post above there is something I likely still miss about his question. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
I&apos;ve been reading the bunnyboy examples in the first post, and none match this snippet of code he posted, but probably is just me not understanding exactely what this snippet of code he posted is for. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
HexValue and TempBinary are names that suggest me nothing pratical: there are two values, which seems have to be added. If I knew what they refer to I could understand (and hopefully help) better.<br>
However, I was just trying to help, hope my post didn&apos;t sound redundant, that was not the intention. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="main_tutorial-9__22">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Oct 13, 2015 at 12:50:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br>
<br>
To be honest, I&apos;m not sure at this point . Sadly, all I know is that my addition and subtraction routines work flawlessly, so far as I&apos;ve been able to test them. Can&apos;t really argue with results, but I&apos;m still curious about the transfer of values (or why a simple transfer won&apos;t work, but an addition is required).</div>
<br>
I would need to see the bad code and the rom in action so I can watch the hex values change. Otherwise, I&apos;m just blindly shooting answers from the hip.<br>
<br>
If you don&apos;t want to post it here, hit me with a pm and we can email or something.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>


                <div class="spacer"></div>

            
        </div>
    </section>
</div>
<div class="mdl-layout__tab-panel" id="misc">
    <section class="section--center mdl-grid mdl-grid--no-spacing">
        <div class="mdl-cell mdl-cell--12-col">
            <h4>Miscellaneous Information</h4>

            <h5>Articles</h5>
            <ul class="toc" id="misc-toc">

                                    <a href="#misc-0">HEX编程</a>
                                    <a href="#misc-1">6502 Killer hacks</a>
                                    <a href="#misc-2">编程相关文件汇总!(啥都没有...)</a>
                                    <a href="#misc-3">MMC1 Memory Mapping: MMC1控制芯片</a>
                                    <a href="#misc-4">World Building with SGP 0: 简介</a>
                                    <a href="#misc-5">World Building with SGP 1: NES图形基础</a>
                                    <a href="#misc-6">World Building with SGP 2: NES图形编辑器</a>
                                    <a href="#misc-7">顶部状态栏和手柄控制器</a>
                                    <a href="#misc-8">背景水平滚动缓冲区</a>
                            </ul>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="misc-0">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">HEX编程</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <h6 class="cardSubtitle">Written by bunnyboy</h6>

                        
					This lesson is largely unrelated to programming, but instead focuses on ROM editing.  Using the recently released <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=5&amp;threadid=19704" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=5&amp;threadid=19704">Exerion 2 ROM</a> we will edit the title screen text to show your own message.  The instructions here will work for many games but not all.  Some use text/graphics compression or do not have all the letters available for use.<div><br>
<br><span class="Apple-style-span" style="font-weight: bold; ">
You will need:</span><br>
  <li><a href="http://www.the-interweb.com/serendipity/index.php?/archives/90-Release-of-FCEUXD-SP-1.07.html" target="_blank" original-href="http://www.the-interweb.com/serendipity/index.php?/archives/90-Release-of-FCEUXD-SP-1.07.html">FCEUXDSP emulator</a> with graphics viewer.  Sorry Mac/Linux users, the best development emulators are Windows only.
  </li><li>Hex editor application</li>
  <li>Text editor application</li>
  <li>10 minutes</li><br><br>
<br><span class="Apple-style-span" style="font-weight: bold; "><br>
</span><div><span class="Apple-style-span" style="font-weight: bold; ">Step 1: Backup!</span><br>
  Make a copy of the ROM.  Work with this copy.  In case you mess up you can go back to the original.<br>
  <br><div><br><span class="Apple-style-span" style="font-weight: bold; ">
Step 2: Finding the graphics</span><br>
  Load up the game in FCEUXDSP and go to the screen you want to edit.  When you are there choose the Debug... menu option and hit the Step Into button in the window that opens.  That will tell the emulator to pause so you can keep working without it changing.<br>
  <br>
  Next choose the PPU Viewer... menu option.  On one side will be the sprite graphics, and on the other the background graphics.  The text is made of background graphics tiles.  <br>
  <br><img src original-src="http://www.NintendoAgeMedia.com/users/142/photobucket/836A6B57-CF2F-A78B-80322DE23B40799B.jpg" show-src="scraper/images/836A6B57-CF2F-A78B-80322DE23B40799B.jpg"><br>
  <br>
  If you put your mouse over one of the letter graphics the tile number will update.  Use those tile numbers to make a chart of which number corresponds to which tile number.  For Exerion 2, that chart will start like:<br>
  <br>
<tt>
  A = 0A<br>
  B = 0B<br>
  C = 0C<br>
  D = 0D<br>
  E = 0E<br>
  F = 0F<br>
  G = 10<br>
  H = 11<br>
  I = 12<br>
  etc<br></tt>
  <br>
  
  <br><span class="Apple-style-span" style="font-weight: bold; ">
Step 3: Finding the text</span><br>
  Use that chart to write out what text you are looking for.  For Exerion 2 we are going to edit the &quot;PLAYERS&quot; text for the 2 players option.  The hex characters we will be looking for are:<br><pre>  TEXT  P  L  A  Y  E  R  S
  HEX   19 15 0A 22 0E 1B 1C</pre>
  Now that you know what to look for, open up the ROM in your hex editor application.  Do a hex search for the string you just figured out.  Hopefully it will appear just once in the ROM.  In Exerion 2 the 2 PLAYERS text is around hex address 2F40.<br>
  <br><img src original-src="http://www.NintendoAgeMedia.com/users/142/photobucket/83649C28-DD7A-6645-5AE624F6D84884CA.png" show-src="scraper/images/83649C28-DD7A-6645-5AE624F6D84884CA.png"><br>
  
  <br>
<br><span class="Apple-style-span" style="font-weight: bold; ">
Step 4: Replacing the text</span><br>
  Use your chart again to make a new string, the same length as the previous text.  This is very important.  The size of the ROM must stay exactly the same size so you cannot add extra characters.  If your new string is shorter than the old one then you must add space characters to make it the same length.<br>
<br>
  For Exerion 2 I want to add a message longer than just the PLAYERS text.  Looking before the P in players there is a space, a 2, and lots more spaces.  I can safely replace some of those too, as long as I don&apos;t add or subtract from the ROM size.<br><pre>  OLD TEXT      2     P  L  A  Y  E  R  S
  OLD HEX    30 02 30 19 15 0A 22 0E 1B 1C
  NEW TEXT   M  R  M  A  R  K     S  U  X
  NEW HEX    16 1B 16 0A 1B 14 30 1C 1E 21</pre>
  Just select the old hex and delete it, then paste in the new hex.  Save your ROM and load it up in the emulator to make sure it worked.  If the game doesn&apos;t load in the emulator then you likely changed the size of the ROM.<br>
  <br>
<img src original-src="http://www.NintendoAgeMedia.com/users/142/photobucket/83649A15-EED7-09A5-8FE2B306803D871E.png" show-src="scraper/images/83649A15-EED7-09A5-8FE2B306803D871E.png"></div><div><br>
<br>
  Now that your game is done, test it on real hardware with your PowerPak or make a physical copy with the ReproPak at <a href="http://www.retrousb.com" target="_blank" original-href="http://www.retrousb.com">http://www.retrousb.com...</a></div></div></div>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#misc-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;misc-0__comments&apos;);">
                            Toggle Responses
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=19733" target="_blank">
                                Original Thread
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="misc-0__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__1">
                                                        <div class="mdl-card__title"><strong>MrMark0673</strong> posted on 
		
			
				
				May 27, 2009 at 3:07:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					HAHAHAHAHAHAHAHAHAHAHAHAHAHAHAHA!!!!!!
<br>
<br>Dude, you win.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__2">
                                                        <div class="mdl-card__title"><strong>qixmaster</strong> posted on 
		
			
				
				May 27, 2009 at 4:53:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					wow... good stuff.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__3">
                                                        <div class="mdl-card__title"><strong>marvelus10</strong> posted on 
		
			
				
				May 27, 2009 at 10:10:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok cool, so how do we make it a multicart then.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__4">
                                                        <div class="mdl-card__title"><strong>frantik</strong> posted on 
		
			
				
				May 28, 2009 at 6:32:56 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>marvelus10</b></i><br><br>Ok cool, so how do we make it a multicart then.</div><br><br>thats a bit more involved than editing a few values... like.. a lot more<br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__5">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 28, 2009 at 8:57:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Other than using the debugger to find the bankswitching location, all you need to know to make it a multicart is covered in previous lessons  <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__6">
                                                        <div class="mdl-card__title"><strong>Cthulhu32</strong> posted on 
		
			
				
				May 28, 2009 at 11:07:54 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br>Other than using the debugger to find the bankswitching location, all you need to know to make it a multicart is covered in previous lessons  <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"></div><br><br>So all you&apos;d have to do is put a game&apos;s code/sprites in PRG/CHR banks and switch when you want to load a cart? (is this what you did for Pirate Booty?) Those hong-kong multi-carts aren&apos;t this simple are they? Like those 100-in-1s?
<div><br></div><div>Btw very cool article, I&apos;ve been reading a bit about rom hacks, and there are some pretty slick ways to find characters inside of roms. I was looking at Sliver X&apos;s doc in particular:&#xA0;<a href="http://www.nesplayer.com/database/info/emulation/doc/romdoc.html#TEXT" target="_blank" original-href="http://www.nesplayer.com/database/info/emulation/doc/romdoc.html#TEXT">http://www.nesplayer.com/database/info/emulation/doc/romdoc....</a> &#xA0;&#xA0;Using a hex to char table to get full read outs of what the text says for bigger text hacks.</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__7">
                                                        <div class="mdl-card__title"><strong>The Bear</strong> posted on 
		
			
				
				Jun 2, 2009 at 1:28:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I remember I was going to hex edit NHL &apos;94... thank god I found an easy program a month later.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__8">
                                                        <div class="mdl-card__title"><strong>mb7241</strong> posted on 
		
			
				
				Jun 2, 2009 at 1:45:24 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hm...this sounds interesting.  I clicked your FCEUXDSP link, and it mentioned something about a RAM filter, and how it works in conjunction with the hex editor for the explicit purpose of hacking games.  So I decided I&apos;d try and use it on a ROM of my favorite NES RPG (Dragon Warrior IV), and before I knew it (literally 5 minutes), I had Ragnar up to nearly 800 HP <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-tongue.gif" show-src="images/blank.gif"> .
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__9">
                                                        <div class="mdl-card__title"><strong>frantik</strong> posted on 
		
			
				
				Jun 2, 2009 at 4:32:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					yeah that ram filter is great for finding memory locations
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__10">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 20, 2010 at 11:48:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Another good thing to check out (though it sounds like you already might have) is the drawing buffer in Metalslime&apos;s skeleton.asm file.  It took me awhile to get it, but it&apos;s a really good, easy-to-read implementation of what Disch discusses in his &quot;Frame and NMI&quot; document about preparing a string of data during rendering and then loading it in once NMI fires.
<br>
<br>Anymore I don&apos;t put anything in NMI unless it&apos;s strictly a drawing load/store function or something I&apos;m told is absolutely necessary to be there.  There are some healthy debates on nesdev over the whether or not you really need to strip down your NMI code like that, but from what I&apos;ve read I just don&apos;t see the need to put anything there that isn&apos;t a write to the PPU.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__11">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Apr 22, 2010 at 1:06:31 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Pretty cool!&#xA0; I saw this thread a few days ago but didn&apos;t have time to look through the code until today.&#xA0; Now that I&apos;ve looked through it I want to throw some ideas your way.&#xA0; BTW, what you wrote is just fine and you don&apos;t have to change anything.&#xA0; These are just ideas so feel free to ignore them if they don&apos;t work for you <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">.&#xA0; Just some tips that could improve performance:<br><br>1) You can save some more bytes on your background data by removing the $FF terminator on all columns.&#xA0; Usually terminators are used when you have data of variable length, where you don&apos;t have any idea when it&apos;s going to end (dialogue text, for example).&#xA0; Since all your columns are the same size, you can know when you reach the end by keeping a count of how many tiles you&apos;ve processed.&#xA0; I&apos;d load the column size into an index register (or a temp variable if X and Y are both being used) and then decrement it every time you write a tile to the buffer.&#xA0; Column is finished when your counter reaches 0.&#xA0; Cutting the terminator will save you 16 bytes per screen, which makes a significant difference if you have a bunch of screens.<br><br>2) Not quite sure why you have a special case for the sky metatile.&#xA0;&#xA0; My guess is that you were trying to save a byte by not having to declare the sky metatile id in the case of a normal RLE, ie for a run of 8 you save a byte like this: $FE, sky_metatile_id, $08 -&gt; $FD, $08.<br><br>It makes some sense since sky is used a lot, but you use a lot of bytes hardcoding the subroutine to handle the special sky case and if you change the ordering of your tiles in the pattern tables, you have to hunt down the hardcoded special cases and change the codes manually.<br><br>Another way to do RLE is to have a bit (say, bit7) signify RLE mode instead of a whole byte.&#xA0; Then you can pack the RLE indicator in with the metatile ids.&#xA0; So instead of:<br><br>.byte $01, $02&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;2 metatiles<br>.byte $FE, $10, $04,&#xA0;&#xA0; ;a run of 4 metatiles<br>.byte $FE, $07, $06&#xA0;&#xA0; ;a run of 6 metatiles<br><br>you could have:<br><br>.byte $01, $02&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;2 metatiles<br>.byte $90, $04&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;a run of 4 (metatile id $10, with the RLE bit set)<br>.byte $87, $06&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;a run of 6 (metatile id $07, with the RLE bit set)<br><br>This way every run is 2 bytes and its generic so nothing needs to be hardcoded.<br><br>3) Your drawing buffer appears to draw every frame, even if there is no movement/change.&#xA0; In other words, when the player isn&apos;t moving, you keep drawing the same offscreen columns over and over again.&#xA0; This is ok for a demo, but in a game it wastes some drawing time that you might need to do other PPU updates.&#xA0; One way to solve this is to put a cap on the drawing buffer (say a $00).&#xA0; After you draw a column, put the cap at the beginning of your buffer.&#xA0; Then in your buffer-&gt;ppu subroutine, skip to RTS if the first byte is $00.<br><br>4) Your drawing buffer could be set up to draw strings of bytes instead of just individual bytes.&#xA0; Right now, you set the target PPU address via $2006 for each byte.&#xA0; But really you only need to write an address to $2006 once per column.&#xA0; The PPU supports column drawing (bit2 of $2000 toggles row/column drawing).&#xA0; So instead of your drawing buffer looking like this:<br><br>hi_address, lo_address, tile, hi_address, lo_address, tile, hi_address, lo_address, tile, etc ;3 PPU writes per tile!<br><br>you could have:<br><br>count, hi_address, lo_address, tile, tile, tile, tile, tile, tile ;set address once, and then 1 PPU write per tile<br><br>The key is to set the PPU to increment by 32 via bit2 in $2000 so that consecutive writes draws a column instead of a row (see <a href="http://wiki.nesdev.com/w/index.php/PPU_registers#Controller_.28.242000.29_.3E_write" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_registers#Controller_.28.242000.29_.3E_write">http://wiki.nesdev.com/w/index.ph...</a> ).<br><br>Oops, gotta go to class.&#xA0; No time to edit.&#xA0; Hope that made some sense <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">&#xA0; Good job, btw.&#xA0; Your code is starting to look slick! <br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__12">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 22, 2010 at 12:19:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Metalslime, as always, you sir are the man!  Thanks for the suggestions, especially number 3.  I noticed in skeleton.asm and a lot of other stuff I&apos;ve been looking at that drawing buffers are typically turned on and off in case there&apos;s other stuff that needs to be drawn.&#xA0; I was wondering how to do that.  Now I know, so thanks!
<br>
<br>I didn&apos;t even consider number one, but now I get exactly what terminators are to be used for.  Very nifty!  Number two took me a minute but I started plugging in the numbers to my programming calc and see how it works now.  I haven&apos;t played around too much yet with using flag bits instead of flag bytes, but am gradually seeing how they work.  Basically what it seems I need to do is add a BIT test in the part where it&apos;s reading from background.i and use an AND to read from bit 7.  If bit 7 is one, jump to RLE, if it&apos;s 0, write the matatile into RAM and jump to next byte.  That&apos;s pretty cool!  Obviously this means you can&apos;t have any more than 128 metatiles on any one list, because after $7F (decimal 127) the test bit for RLE would always be set and you&apos;d always jump to RLE.  How do you usually get around this?  Actually, have you ever needed to in the first place?  Upon thinking about it it seems that&apos;s a lot of metatiles, but then this demo is pretty simple and it uses 25, so I&apos;m guessing the number can add up pretty quick.  Do you simply jump to different metatile indexes if the number gets too high?
<br>
<br>And OMG, number 4!  I&apos;m slamming my head into my desk right now!  You know I actually spent time writing a block of code to increment by 32 for the addresses?  It didn&apos;t work, so I came up with that hi_address, lo_address etc scheme.  If I&apos;d just looked at Deskin&apos;s technical doc and realized what you said here earlier I would have saved myself so much time.  It&apos;s right there in Appendix B in the table for register $2000 &quot;Bit 2 - Specifies amount to increment address by, either 1 if this is 0 or 32 if this is 1.&quot;  It&apos;s undoubtedly been written in the other tuts too but I foolishly ignored it.  Raarrggghh!!!  Oh well, painful lesson learned.  :-)
<br>
<br>So anyway, yeah, I&apos;m going to work these suggestions in.&#xA0; Thanks again for the help!&#xA0; As always, it&apos;s much appreciated.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__13">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 22, 2010 at 1:08:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m not sure how you have it set up, but I don&apos;t think you can have more than 128 metatiles in a tileset cause you have to multiply it by two to use a look up table.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__14">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 22, 2010 at 3:22:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, you&apos;re right.  I didn&apos;t think about that.  So moot point on my part.  You couldn&apos;t list any higher than $7F anyway because anymore would spill over into another byte when multiplying by two.  I guess I&apos;ll cross that bridge if I ever come to it where I need more than 128 entries.  For now I&apos;m guessing you&apos;d just need to use different metatile indexes for the different levels and whatnot.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__15">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 22, 2010 at 4:06:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					if you put your high bit on the repeat number rather than the tile number, that might help. Then you could use bit 6 for the metatile set flag and have the other bits for other info.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__16">
                                                        <div class="mdl-card__title"><strong>ProgrammingAce</strong> posted on 
		
			
				
				Apr 22, 2010 at 4:40:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Don&apos;t feel too bad about how you have the meta-tiles setup. My first implementation was *awful*. I would draw a tile, jump ahead 32 tiles to draw the second, jump back 31 tiles to draw the 3rd, then jump ahead another 32 to draw the 4th. The only reason it didn&apos;t bring the game to a screeching halt is because buffered the writes into ram...
<br>
<br>Your code is looking pretty good.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__17">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Apr 23, 2010 at 2:48:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bigjt_2</b></i><br><br>Number two took me a minute but I started plugging in the numbers to my programming calc and see how it works now.  I haven&apos;t played around too much yet with using flag bits instead of flag bytes, but am gradually seeing how they work.  Basically what it seems I need to do is add a BIT test in the part where it&apos;s reading from background.i and use an AND to read from bit 7.  If bit 7 is one, jump to RLE, if it&apos;s 0, write the matatile into RAM and jump to next byte.  That&apos;s pretty cool!  Obviously this means you can&apos;t have any more than 128 metatiles on any one list, because after $7F (decimal 127) the test bit for RLE would always be set and you&apos;d always jump to RLE.  How do you usually get around this?  Actually, have you ever needed to in the first place?  Upon thinking about it it seems that&apos;s a lot of metatiles, but then this demo is pretty simple and it uses 25, so I&apos;m guessing the number can add up pretty quick.  Do you simply jump to different metatile indexes if the number gets too high?
<br></div><br>It&apos;s worthwhile to learn bit testing. It can save you a lot of space.&#xA0; To do it, you use AND.&#xA0; AND works like this on a bit level:<br><br>0 AND 0 = 0<br>1 AND 0 = 0<br>0 AND 1 = 0<br>1 AND 1 = 1<br><br>To bit test, you use AND to clear all of the bits except the one you are checking.&#xA0; If the result is 0, your bit was off.&#xA0; If the result is non-zero, your bit is on.&#xA0; To check bit7 you&apos;d AND with #%10000000.&#xA0; To check bit0 you&apos;d AND with #%00000001.&#xA0; For bit4:<br><br>lda some_number<br>and #%00010000&#xA0; ;check bit4<br>bne bit_was_on&#xA0;&#xA0;&#xA0; ;if non-zero, the bit was on (1 AND 1 gives you a 1, everything else is 0&apos;ed)<br><br>so if you had an RLE flag in bit 7:<br><br>&#xA0; &#xA0; lda [ptr], y&#xA0;&#xA0; ;read a byte from buffer<br>&#xA0;&#xA0;&#xA0; and #%10000000&#xA0; ;check bit7<br>&#xA0;&#xA0;&#xA0; bne @rle&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if non-zero, we have rle<br>...;snip<br>@rle:<br>&#xA0;&#xA0; lda [ptr], y&#xA0; ;re-read byte<br>&#xA0;&#xA0; and #%01111111 ;cut off the rle bit to get the metatile #.<br><br>And yes, stealing a bit would limit you to 127 (128?) metatiles.&#xA0; You could have different sets for different levels to get around this though.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__18">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 23, 2010 at 7:38:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I agree, bit testing rocks. For each room in my overworld there are four possibilities for the location of doors and I need 4 bit bank info for each room. So I used bits 7654 for the doors (yes/no in each direction) and then 3210 for the bank number. From 5 bytes to 1 for each room. Poweryay.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__19">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 23, 2010 at 11:35:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Cool, thanks guys.  I&apos;m working on this right now, actually.  Got the code re-written to jump 32 tiles by setting bit 2 of $2000 to one.  Just got that part done.  Now I&apos;ll start re-writing it by incorporating the bit tests.  Hopefully work stays nice and slow all day (knock on wood) so I can make some good progress.  You never know when my company and its clients will get annoying and actually expect me to be productive, though.  ;-)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__20">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 23, 2010 at 12:23:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bigjt_2</b></i><br><br>You never know when my company and its clients will get annoying and actually expect me to be productive, though. ;-)</div>I know how you feel.&#xA0; What a bunch of bastards.&#xA0; <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-sad.gif" show-src="images/blank.gif"><br><br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__21">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 27, 2010 at 12:56:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey folks, here&apos;s the latest iteration, new and improved (as opposed to old and shitty).&#xA0; It incorporates most of Metalslime&apos;s suggestions.&#xA0; Thanks again, sir!<br><br>For whatever reason I couldn&apos;t implement the concept of capping the buffer to keep it from drawing every frame.&#xA0; At first I thought I got it, but then when I started trying to do it in code I just couldn&apos;t get it.&#xA0; What I settled on was a quick test in the main asm called drawTest that basically tests if the player moves and then sets a flag so that the code in the game loop loads up the buffer and the appropriate loading subs in the NMI section run.&#xA0; I&apos;m not sure if that&apos;s a huge improvement.&#xA0; Now it only draws if the player moves, but it&apos;s still drawing quite a bit.&#xA0; Tried working with it so it only drew if the player moved more than eight pixels right or left, but that led to some bugs.<br><br>Still, a lot of fat was trimmed thanks to everyone&apos;s input, so I appreciate it.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__22">
                                                        <div class="mdl-card__title"><strong>GreenMonkey</strong> posted on 
		
			
				
				May 20, 2015 at 8:03:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Could someone explain the Offscreen_buffer_tables.i to me? When I try and implement my own metatiles, and leave the file alone, it causes the assembler to freak out and throw a bunch of errors.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__23">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				May 20, 2015 at 8:08:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>GreenMonkey</b></i><br>
	<br>
	Could someone explain the Offscreen_buffer_tables.i to me? When I try and implement my own metatiles, and leave the file alone, it causes the assembler to freak out and throw a bunch of errors.</div>
<br>
Not sure this is what you are looking for, but maybe this could help:<br>
<br>
&#xA0;<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36958" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36958">http://www.nintendoage.com/forum/...</a><br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__24">
                                                        <div class="mdl-card__title"><strong>GreenMonkey</strong> posted on 
		
			
				
				May 21, 2015 at 9:53:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br><br><div class="FTQUOTE">
	<i>Originally posted by: <b>GreenMonkey</b></i><br>
	<br>
	Could someone explain the Offscreen_buffer_tables.i to me? When I try and implement my own metatiles, and leave the file alone, it causes the assembler to freak out and throw a bunch of errors.</div>
<br>
Not sure this is what you are looking for, but maybe this could help:<br>
<br>
&#xA0;<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36958" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36958">http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;th...</a> <br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span></div><br><br><br>
It may not have anything to do with the buffer file, but I&apos;ve been attempting to modify the engine to work with my graphics. I replaced the Mario chr file with my own chr file, and reprogrammed my own metatiles and levels, but when I assemble the program it says it doesn&apos;t recognize any of the variables (leftright, sleeping, soft_2000, etc. And even all the .word&apos;s and .db&apos;s, they all say something like &quot;UNDEFINED&quot;. I don&apos;t know why this is but I thought it may have something to do with the buffer file since that&apos;s the only thing I didn&apos;t change, and I don&apos;t really know how it works.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-0__25">
                                                        <div class="mdl-card__title"><strong>GreenMonkey</strong> posted on 
		
			
				
				May 22, 2015 at 4:25:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Alright so the errors were my own fault. I&apos;ve corrected them but the game seems to freeze upon reading
<br>
<br>     .Sprite0_testtwo
<br>	     bit $2002
<br>	     bvc .Sprite0_testtwo
<br>
<br>I can&apos;t move the screen, the level loads but the first tile in the metatile isn&apos;t displayed, and random garbage keeps going into the stack.
<br>
<br>I re-wrote the engine so that it was formatted in a way I like. I&apos;ve thoroughly compared my code to the original code several times and I didn&apos;t find any mistakes on my part so I&apos;m either doing something wrong with the sprite0hit, or the offscreen_buffer_tables.i needs to be changed. If someone could help me, I&apos;d greatly appreciate it. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="misc-1">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">AtariAge: 6502 Killer hacks</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <h6 class="cardSubtitle">Written by djmips</h6>

                        
<p>As I was growing up, I kept a notebook full of cool code snippets and ideas. My notebook had been misplaced but I ran across it recently and here is one of the pages which is from a 1987 Dr. Dobbs article by Mark S. Ackerman. &quot;6502 Killer Hacks&quot;.<br><br><span style="color:#FF0000;">Post your own 6502 Killer Hacks and share them with the rest of us!</span><br><br>I also checked into Mark S. Ackerman with our trusty tool Google and found his <a href="downloads/missing/vita.pdf" rel="external nofollow" original-href="https://www.eecs.umich.edu/~ackerm/vita.pdf">&apos;vita&apos;</a> -<br><br>Pretty sure it&apos;s the same guy as he worked at GCC from 1982 - 1984 and was the lead on Ms. PacMan, Galaxian and Moon Patrol - time to update AtariAge database as these games are empty when it comes to staff<br><br>He has a patent on the Galaxian kernel.<br><br>Well here is the killer hack. This one is to scrimp on RAM.<br><br>Incrementing only the lower 4 bits of a byte (with wrap)<br><br></p>
<pre class="ipsCode prettyprint">...
   lda word      ; original byte
   and #$0f      ; retrieve lower nybble
   tay            ; index
   lda word
   clc            ; might not be needed
   adc nextinc,y  ; could be ora or sbc
   sta word
...

nextinc .byte 1,2,3,4,5,6,7,8
        .byte 9,10,11,12,13,14,15,0</pre>
<br>Well, funny thing is - maybe I didn&apos;t transcribe it properly back in &apos;87 - because it doesn&apos;t seem like it would work.<br><br>Seems like it needs an AND #$F0 after the second LDA word<br><br><br>So I thought I&apos;d take a shot at a working version...<br><br><pre class="ipsCode prettyprint">...
   lda word      ; original byte
   and #$0f      ; retrieve lower nybble
   tay            ; index
   lda word
   clc
   adc nextinc,y
   sta word
...

nextinc .byte 1,1,1,1,1,1,1,1
        .byte 1,1,1,1,1,1,1,-15</pre>
<br>who knows if that one works either. :-)<br><br>If someone has the original article from Feb 1987 Dr. Dobbs Journal, I&apos;d be curious to see the code.<br><br><span style="color:#FF0000;">Also, post your own 6502 Killer Hacks and share them with the rest of us!</span><br><br>- David<br><br>Updated 2017: Just came across the original PDF of the article by Mark S. Ackerman and confirmed that I did transcribe it incorrectly but my fixed version is the same as the published version.<br><br><a href="scraper/files/6502_hacks.pdf" rel="external nofollow" original-href="http://archive.6502.org/publications/dr_dobbs_journal_selected_articles/6502_hacks.pdf">http://archive.6502.org/publications/dr_dobbs_journal_selected_articles/6502_hacks.pdf</a>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2017-04-01T19:21:52Z" title="04/01/2017 07:21  PM" data-short="2 yr">April 1, 2017</time> by djmips</strong>
</span>
                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#misc-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;misc-1__comments&apos;);">
                            Toggle Responses
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="https://atariage.com/forums/topic/71120-6502-killer-hacks/" target="_blank">
                                Original Thread
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="misc-1__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__1">
                                                        <div class="mdl-card__title"><strong>CybergothCybergoth</strong> posted on June 12, 2005</div><div class="mdl-card__supporting-text">
<p>Hi there!</p>
<p>&#xA0;</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<pre class="ipsCode">...
&#xA0; &#xA0;lda word &#xA0; &#xA0; &#xA0;; original byte
&#xA0; &#xA0;and #$0f &#xA0; &#xA0; &#xA0;; retrieve lower nybble
&#xA0; &#xA0;tay &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;; index
&#xA0; &#xA0;lda word
&#xA0; &#xA0;clc
&#xA0; &#xA0;adc nextinc,y
&#xA0; &#xA0;sta word
...

nextinc .byte 1,1,1,1,1,1,1,1
&#xA0; &#xA0; &#xA0; &#xA0; .byte 1,1,1,1,1,1,1,-15

</pre>
<div></div>
<p></p>
<p></p>
<div style="text-align:right"><p><a rel></a>872906[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Yours should work a lot better than the other version. So you&apos;re going for speed here? A version without table would certainly waste less ROM space:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">&#xA0; &#xA0;LAX word
&#xA0; &#xA0;INX
&#xA0; &#xA0;AND #$F0
&#xA0; &#xA0;STA temp
&#xA0; &#xA0;TXA
&#xA0; &#xA0;AND #$0F
&#xA0; &#xA0;ORA temp
&#xA0; &#xA0;STA word
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>As many cycles, but 14 bytes saved...</p>
<p>(Also this can count n bits, it&apos;s not fixed to 4)</p>
<p>&#xA0;</p>
<p>Greetings,</p>
<p>Manuel</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__2">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on June 12, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="Cybergoth" data-cite="Cybergoth" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Hi there!<p>&#xA0;</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<pre class="ipsCode">...
&#xA0; &#xA0;lda word &#xA0; &#xA0; ; original byte
&#xA0; &#xA0;and #$0f &#xA0; &#xA0; ; retrieve lower nybble
&#xA0; &#xA0;tay &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; index
&#xA0; &#xA0;lda word
&#xA0; &#xA0;clc
&#xA0; &#xA0;adc nextinc,y
&#xA0; &#xA0;sta word
...

nextinc .byte 1,1,1,1,1,1,1,1
&#xA0; &#xA0; &#xA0; &#xA0; .byte 1,1,1,1,1,1,1,-15

</pre>
<div></div>
<p></p>
<p></p>
<div style="text-align:right;"><p><a rel></a>872906[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Yours should work a lot better than the other version. So you&apos;re going for speed here? A version without table would certainly waste less ROM space:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">&#xA0; &#xA0;LAX word
&#xA0; &#xA0;INX
&#xA0; &#xA0;AND #$F0
&#xA0; &#xA0;STA temp
&#xA0; &#xA0;TXA
&#xA0; &#xA0;AND #$0F
&#xA0; &#xA0;ORA temp
&#xA0; &#xA0;STA word
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>As many cycles, but 14 bytes saved...</p>
<p>(Also this can count n bits, it&apos;s not fixed to 4)</p>
<p>&#xA0;</p>
<p>Greetings,</p>
<p>Manuel</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>872915[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>I like that version, nice use of LAX, but you gotta be brave and not use the temp <img alt=";)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_wink.gif" show-src="scraper/images/atariage_icon_wink.gif"> </p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">&#xA0; &#xA0;LAX word
&#xA0; &#xA0;INX
&#xA0; &#xA0;AND #$F0
&#xA0; &#xA0;STA word
&#xA0; &#xA0;TXA
&#xA0; &#xA0;AND #$0F
&#xA0; &#xA0;ORA word
&#xA0; &#xA0;STA word
</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__3">
                                                        <div class="mdl-card__title"><strong>CybergothCybergoth</strong> posted on June 12, 2005</div><div class="mdl-card__supporting-text">
<p>Hi there!</p>
<p>&#xA0;</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>I like that version, nice use of LAX, but you gotta be brave and not use the temp&#xA0; <img alt=";)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_wink.gif" show-src="scraper/images/atariage_icon_wink.gif"> <p></p>
<div style="text-align:right"><p><a rel></a>872999[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Uihjah... so my kung fu is ok, just needs some work on the finishing move... <img alt=":lolblue:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_laughingblue.gif" show-src="scraper/images/atariage_icon_laughingblue.gif"></p>
<p>&#xA0;</p>
<p>Greetings,</p>
<p>Manuel</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__4">
                                                        <div class="mdl-card__title"><strong>Alex HAlex H</strong> posted on June 12, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div><span style="color:#FF0000;">Post your own 6502 Killer Hacks and share them with the rest of us!</span></div></blockquote>
<p>Here&apos;s one I like:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">; unsigned divide by 3

&#xA0; &#xA0;sta &#xA0; &#xA0;temp
&#xA0; &#xA0;lsr
&#xA0; &#xA0;lsr
&#xA0; &#xA0;clc
&#xA0; &#xA0;adc &#xA0; &#xA0;temp
&#xA0; &#xA0;ror
&#xA0; &#xA0;lsr
&#xA0; &#xA0;clc
&#xA0; &#xA0;adc &#xA0; &#xA0;temp
&#xA0; &#xA0;ror
&#xA0; &#xA0;lsr
&#xA0; &#xA0;clc
&#xA0; &#xA0;adc &#xA0; &#xA0;temp
&#xA0; &#xA0;ror
&#xA0; &#xA0;lsr
&#xA0; &#xA0;clc
&#xA0; &#xA0;adc &#xA0; &#xA0;temp
&#xA0; &#xA0;ror
&#xA0; &#xA0;lsr
</pre>
<div></div>
<p></p>
<p><img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__5">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on June 12, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<pre class="ipsCode">[code]
&#xA0; &#xA0;LAX word
&#xA0; &#xA0;INX
&#xA0; &#xA0;AND #$F0
&#xA0; &#xA0;STA word
&#xA0; &#xA0;TXA
&#xA0; &#xA0;AND #$0F
&#xA0; &#xA0;ORA word
&#xA0; &#xA0;STA word
</pre>
<div></div>
<p></p>
<p></p>
<div style="text-align:right;"><p><a rel></a>872999[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>I think I can save a byte... I am not totally sure if this will work though, I&apos;ve been wrong before.</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">&#xA0; &#xA0;inc word
&#xA0; &#xA0;lax word
&#xA0; &#xA0;and #$0f
&#xA0; &#xA0;bne no
&#xA0; &#xA0;txa
&#xA0; &#xA0;sbx #$10
&#xA0; &#xA0;stx word
no
</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__6">
                                                        <div class="mdl-card__title"><strong>CybergothCybergoth</strong> posted on June 13, 2005</div><div class="mdl-card__supporting-text">
<p>Hi there!</p>
<p>&#xA0;</p>
<p>The last 2 instructions should rather be SBC and STA I think <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<p>&#xA0;</p>
<p>And, to make it totally failproof, you&apos;d probably need to add a SEC before the subtraction.</p>
<p>&#xA0;</p>
<p>Greetings,</p>
<p>Manuel</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__7">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on June 13, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="Cybergoth" data-cite="Cybergoth" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Hi there!<p>&#xA0;</p>
<p>The last 2 instructions should rather be SBC and STA I think <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<p>&#xA0;</p>
<p>And, to make it totally failproof, you&apos;d probably need to add a SEC before the subtraction.</p>
<p>&#xA0;</p>
<p>Greetings,</p>
<p>Manuel</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>873284[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>Actually, SBX is an illegal opcode that stores to X the result of (A&amp;X)-Immediate (and it ignores the carry!) For this reason I&apos;ve found it useful to save a byte here and there.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__8">
                                                        <div class="mdl-card__title"><strong>CybergothCybergoth</strong> posted on June 13, 2005</div><div class="mdl-card__supporting-text">
<p>Hi there!</p>
<p>&#xA0;</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Actually, SBX is an illegal opcode that stores to X the result of (A&amp;X)-Immediate (and it ignores the carry!)<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Oh... I thought that opcode was called AXS <img alt=":?" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_confused.gif" show-src="scraper/images/atariage_icon_confused.gif"></p>
<p>&#xA0;</p>
<p>Anyway, clever usage! <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<p>&#xA0;</p>
<p>Greetings,</p>
<p>Manuel</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__9">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on June 13, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="Cybergoth" data-cite="Cybergoth" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Hi there!<p>&#xA0;</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Actually, SBX is an illegal opcode that stores to X the result of (A&amp;X)-Immediate (and it ignores the carry!)<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Oh... I thought that opcode was called AXS <img alt=":?" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_confused.gif" show-src="scraper/images/atariage_icon_confused.gif"></p>
<p>&#xA0;</p>
<p>Anyway, clever usage! <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<p>&#xA0;</p>
<p>Greetings,</p>
<p>Manuel</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>873290[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>I&apos;ve noticed that different documents use different mnemonics for the illegals, so maybe SBX=AXS. Though SBX works in dasm, maybe AXS does too <img alt=":?" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_confused.gif" show-src="scraper/images/atariage_icon_confused.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__10">
                                                        <div class="mdl-card__title"><strong>CybergothCybergoth</strong> posted on June 13, 2005</div><div class="mdl-card__supporting-text">
<p>Hi there!</p>
<p>&#xA0;</p>
<p>To contribute something myself, here&apos;s an IMO very usefull bit I wrote for Gunfight back then and which I&apos;m using one way or another in Star Fire and Crazy Balloon as well.</p>
<p>&#xA0;</p>
<p>It checks wether a point is within a rectangle (software collision detection!):</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">&#xA0; LDA rect.right
&#xA0; SBC point.x
&#xA0; BMI NoHit
&#xA0; SBC rect.width
&#xA0; BPL NoHit
&#xA0; LDA rect.top
&#xA0; SBC point.y
&#xA0; BMI NoHit
&#xA0; SBC rect.height
&#xA0; BPL NoHit
&#xA0;&#xA0;;BANG!
NoHit
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Greetings,</p>
<p>Manuel</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__11">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on June 13, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="Cybergoth" data-cite="Cybergoth" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Hi there!<p>&#xA0;</p>
<p>To contribute something myself, here&apos;s an IMO very usefull bit I wrote for Gunfight back then and which I&apos;m using one way or another in Star Fire and Crazy Balloon as well.</p>
<p>&#xA0;</p>
<p>It checks wether a point is within a rectangle (software collision detection!):</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">&#xA0; LDA rect.right
&#xA0; SBC point.x
&#xA0; BMI NoHit
&#xA0; SBC rect.width
&#xA0; BPL NoHit
&#xA0; LDA rect.top
&#xA0; SBC point.y
&#xA0; BMI NoHit
&#xA0; SBC rect.height
&#xA0; BPL NoHit
&#xA0;;BANG!
NoHit
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Greetings,</p>
<p>Manuel</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>873320[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>Here&apos;s the software collision routine I worked up for Go Fish!</p>
<p>A little different - I use it to check if two boxes overlap. Call it once for X values, then call it again with Y values.</p>
<p></p>
<pre class="ipsCode">CheckBoundaries
&#xA0; &#xA0; &#xA0; &#xA0;lda rect1.leftortop
&#xA0; &#xA0; &#xA0; &#xA0;cmp rect2.leftortop
&#xA0; &#xA0; &#xA0; &#xA0;bmi Check2
&#xA0; &#xA0; &#xA0; &#xA0;cmp rect2.rightorbottom
&#xA0; &#xA0; &#xA0; &#xA0;bmi InsideBoundingBox
Check2
&#xA0; &#xA0; &#xA0; &#xA0;lda rect2.leftortop
&#xA0; &#xA0; &#xA0; &#xA0;cmp rect1.leftortop
&#xA0; &#xA0; &#xA0; &#xA0;bmi NotInsideBoundingBox
&#xA0; &#xA0; &#xA0; &#xA0;cmp rect1.rightorbottom
&#xA0; &#xA0; &#xA0; &#xA0;bpl NotInsideBoundingBox
InsideBoundingBox
&#xA0; &#xA0; &#xA0; &#xA0;sec
&#xA0; &#xA0; &#xA0; &#xA0;rts
NotInsideBoundingBox
&#xA0; &#xA0; &#xA0; &#xA0;clc
&#xA0; &#xA0; &#xA0; &#xA0;rts</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__12">
                                                        <div class="mdl-card__title"><strong>CybergothCybergoth</strong> posted on June 13, 2005</div><div class="mdl-card__supporting-text">
<p>Hi there!</p>
<p>&#xA0;</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Here&apos;s the software collision routine I worked up for Go Fish!<p>A little different - I use it to check if two boxes overlap.&#xA0; Call it once for X values, then call it again with Y values.</p>
<p></p>
<div style="text-align:right"><p><a rel></a>873438[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Do you use it for fish:fish collisions? Probably not, as the hardware detection should be good enough for that, or?</p>
<p>&#xA0;</p>
<p>Greetings,</p>
<p>Manuel</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__13">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on June 13, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="Cybergoth" data-cite="Cybergoth" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Hi there!<p>&#xA0;</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Here&apos;s the software collision routine I worked up for Go Fish!<p>A little different - I use it to check if two boxes overlap.&#xA0; Call it once for X values, then call it again with Y values.</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>873438[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Do you use it for fish:fish collisions? Probably not, as the hardware detection should be good enough for that, or?</p>
<p>&#xA0;</p>
<p>Greetings,</p>
<p>Manuel</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>873446[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>Use it for playerLEFT-controlled-fish to playerRIGHT-controlled-fish collisions in two-player game. Flicker. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__14">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on June 13, 2005June 13, 2005</div><div class="mdl-card__supporting-text">
<p>What this does is set a number of random bits in a memory location. X is defined before calling this routine. Actually, it&apos;s not &quot;killer&quot; yet - I think this can be improved for cycles as well as space... but I&apos;m at a loss for ideas... Anyone?</p>
<p>&#xA0;</p>
<p>EDIT: oops, &quot;bits&quot; should be zero page, not immediate.</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">makemines
&#xA0; &#xA0; &#xA0; &#xA0;lda bits
&#xA0; &#xA0; &#xA0; &#xA0;sta TEMPVAR
loop &#xA0; &#xA0;JSR randomize; returns random value in accumulator
&#xA0; &#xA0; &#xA0; &#xA0;AND #7
&#xA0; &#xA0; &#xA0; &#xA0;TAY
&#xA0; &#xA0; &#xA0; &#xA0;LDA maskbit,y
&#xA0; &#xA0; &#xA0; &#xA0;ORA minefield-1,x; x is defined outside this routine
&#xA0; &#xA0; &#xA0; &#xA0;STA minefield-1,x
&#xA0; &#xA0; &#xA0; &#xA0;dec TEMPVAR
&#xA0; &#xA0; &#xA0; &#xA0;BPL loop
&#xA0; &#xA0; &#xA0; &#xA0;rts

maskbit
&#xA0; &#xA0; &#xA0; &#xA0;.byte %00000001
&#xA0; &#xA0; &#xA0; &#xA0;.byte %00000010
&#xA0; &#xA0; &#xA0; &#xA0;.byte %00000100
&#xA0; &#xA0; &#xA0; &#xA0;.byte %00001000
&#xA0; &#xA0; &#xA0; &#xA0;.byte %00010000
&#xA0; &#xA0; &#xA0; &#xA0;.byte %00100000
&#xA0; &#xA0; &#xA0; &#xA0;.byte %01000000
&#xA0; &#xA0; &#xA0; &#xA0;.byte %10000000
</pre>
<div></div>
<p></p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2005-06-13T23:12:31Z" title="06/13/2005 11:12  PM" data-short="14 yr">June 13, 2005</time> by batari</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__15">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on June 14, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>What this does is set a number of random bits in a memory location.&#xA0; X is defined before calling this routine.&#xA0; Actually, it&apos;s not &quot;killer&quot; yet - I think this can be improved for cycles as well as space... but I&apos;m at a loss for ideas...&#xA0; Anyone?<p>&#xA0;</p>
<p>EDIT: oops, &quot;bits&quot; should be zero page, not immediate.</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">makemines
&#xA0; &#xA0; &#xA0; &#xA0;lda bits
&#xA0; &#xA0; &#xA0; &#xA0;sta TEMPVAR
loop &#xA0; &#xA0;JSR randomize; returns random value in accumulator
&#xA0; &#xA0; &#xA0; &#xA0;AND #7
&#xA0; &#xA0; &#xA0; &#xA0;TAY
&#xA0; &#xA0; &#xA0; &#xA0;LDA maskbit,y
&#xA0; &#xA0; &#xA0; &#xA0;ORA minefield-1,x; x is defined outside this routine
&#xA0; &#xA0; &#xA0; &#xA0;STA minefield-1,x
&#xA0; &#xA0; &#xA0; &#xA0;dec TEMPVAR
&#xA0; &#xA0; &#xA0; &#xA0;BPL loop
&#xA0; &#xA0; &#xA0; &#xA0;rts

maskbit
&#xA0; &#xA0; &#xA0; &#xA0;.byte %00000001
&#xA0; &#xA0; &#xA0; &#xA0;.byte %00000010
&#xA0; &#xA0; &#xA0; &#xA0;.byte %00000100
&#xA0; &#xA0; &#xA0; &#xA0;.byte %00001000
&#xA0; &#xA0; &#xA0; &#xA0;.byte %00010000
&#xA0; &#xA0; &#xA0; &#xA0;.byte %00100000
&#xA0; &#xA0; &#xA0; &#xA0;.byte %01000000
&#xA0; &#xA0; &#xA0; &#xA0;.byte %10000000
</pre>
<div></div>
<p></p>
<p></p>
<div style="text-align:right;"><p><a rel></a>873707[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>hmmm. So let me see, so bits + 1 is the maximum number of bits you want set. So if bitsis 2 for example, some legitimate output has 1 to 3 bits set because your random routine could return the same result each time for instance. Is that what you really want or does it matter if the routine always returned the number of bits </p>
<p>&#xA0;</p>
<p>I thought about something where you generate a bit per loop and the following is an idea for the inner loop.</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">loop:	jsr random
&#xA0;cmp threshold
&#xA0;rol temp
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>I don&apos;t think this approach will result in an improvement over your version but maybe it sparks an idea.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__16">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on June 15, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<pre class="ipsCode">loop:	jsr random
&#xA0;cmp threshold
&#xA0;rol temp
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>I don&apos;t think this approach will result in an improvement over your version but maybe it sparks an idea.</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>873984[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>I though of doing something similar, it would save bytes but add cycles... But it does spark an idea. This routine is only called every 12 frames, so I should use something like the above and spread it out over several frames, then I&apos;ll have cycles to spare.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__17">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on June 15, 2005June 15, 2005</div><div class="mdl-card__supporting-text">
<p>I like little code snippets like the ones posted here... I don&apos;t want this thread to die, so I&apos;ll post another one of my hacks that saved a few bytes.</p>
<p>&#xA0;</p>
<p>In 2600 games, there&apos;s often tons of STA WSYNCs, so I wondered if there was a way to get basically the same effect while saving space. So I came up with this, which works in cases where you have some kernel timing to spare, and the stack pointer is constant (let&apos;s assume $FF). Basically you replace all STA WSYNCs with BRK, but don&apos;t add the extra byte after the BRK, by using this short BRK routine:</p>
<p></p>
<pre class="ipsCode">brkroutine
DEC $FE; correct return address to eliminate the byte after the BRK
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;; ONLY works when low byte of return address is not zero!
STA WSYNC
RTI
</pre>
<div></div>
<p></p>
<p>If you replace 6 or more STA WSYNCs, you start saving space...</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2005-06-15T23:20:29Z" title="06/15/2005 11:20  PM" data-short="14 yr">June 15, 2005</time> by batari</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__18">
                                                        <div class="mdl-card__title"><strong>Bruce TomlinBruce Tomlin</strong> posted on June 15, 2005</div><div class="mdl-card__supporting-text">
<p>...but you better not be tight for cycles!</p>
<p>&#xA0;</p>
<p>That adds 6 cycles after the STA WSYNC, and 10 before it.</p>
<p>&#xA0;</p>
<p>In Red Box/Blue Box there were only a few places that I could JSR to a copy of my DoSound macro, and it saved a LOT of bytes when I did. There were only a few places because I only had 15 cycles to spare on each scan line after the DoSound macro. It would have only been 11 except that I saved 4 cycles from using LAX.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__19">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on June 15, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="Bruce Tomlin" data-cite="Bruce Tomlin" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>...but you better not be tight for cycles!<p>&#xA0;</p>
<p>That adds 6 cycles after the STA WSYNC, and 10 before it.</p>
<p>&#xA0;</p>
<p>In Red Box/Blue Box there were only a few places that I could JSR to a copy of my DoSound macro, and it saved a LOT of bytes when I did.&#xA0; There were only a few places because I only had 15 cycles to spare on each scan line after the DoSound macro.&#xA0; It would have only been 11 except that I saved 4 cycles from using LAX.</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>875071[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>Yeah, there were lots of places where I couldn&apos;t use this trick.</p>
<p>&#xA0;</p>
<p>But I think if you&apos;re already using this trick, I think you could use it to create an <strong>8 byte VSYNC!</strong></p>
<p>&#xA0;</p>
<p>Now, this assumes that BRK/RTI will restore flags on returning. It does, right? If so, then this should work when SP=$FF and you use it right after your INTIM loop, like this:</p>
<p>.1</p>
<p> LDX INTIM</p>
<p> BNE .1 </p>
<p>&#xA0;</p>
<p>so you are certain X=0 and the Z flag is 1. Anyway:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">; 8 byte VSYNC!
BRK;STA WSYNC, plus restore flags (?)
TXS;stack pointer = 0, which is VSYNC
PHP;Z=1, which writes a 1 to bit 1 of VSYNC
BRK
BRK
BRK
STX VSYNC
</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__20">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on June 16, 2005</div><div class="mdl-card__supporting-text">
<p>Here&apos;s a killer hack from the stella archives. It&apos;s near and dear to me because it is a key component used in most of the modern moving 48 wide sprite code ( like my Amiga Boing demo 2.0 (derived from R. Kudla/ E. Stolberg) . It is also used in the various Fu Kung demos from A. Davies)</p>
<p>&#xA0;</p>
<p>Also, it is very cool. Definately a killer hack.</p>
<p>&#xA0;</p>
<p>It was originally posted by the late Jim Nitchals on Mar 18 1998</p>
<p>&#xA0;</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Hi,<p>&#xA0;</p>
<p>Here&apos;s a way to implement single cycle resolution without the use of the</p>
<p>carry flag (which adds overhead in the setup and at the end):</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">; A is assumed to hold the delay value plus the offset address of JumpTable.
; Or, you can align JumpTable to a page boundary.

&#xA0;sta indjmp
&#xA0;jmp (indjmp) ; point indjmp+1 to JumpTable somewhere in your init code

JumpTable:
&#xA0;dc.b $C9
&#xA0;dc.b $C9
; repeat as many $C9&apos;s as you need for the maximum number of cycles you
; you need to delay by.
&#xA0;dc.b $C9 &#xA0; &#xA0; ; opcode: CMP immediate (4 cycles: uses the $C5, executes
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; the NOP below.)
&#xA0;dc.b $C5 &#xA0; &#xA0; ; opcode: CMP zero page (3 cycles, uses up the NOP as a
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; destination address of $EA)
&#xA0;nop &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;; opcode: NOP (2 cycles by itself)
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>You may find the reduced overhead of this technique useful.</p>
<p></p>
</div></blockquote>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__21">
                                                        <div class="mdl-card__title"><strong>cd-wcd-w</strong> posted on June 19, 2005</div><div class="mdl-card__supporting-text">
<p>This is a fairly obvious hack, but here goes ...</p>
<p>&#xA0;</p>
<p>If you want to display more than 2 sprites, you can use the missile and ball graphics to construct pseudo-sprites. Obviously you can only display a limited number of shapes, but if you are clever, you can obtain the appearance of extra flicker-free sprites. The following code fragment illustrates how to draw a man sprite using only missile 0:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">Kernel
       sta WSYNC
       sta HMOVE               ; [0] + 3
               
       ; Draw Sprite (SwitchDraw Variant)
       cpy PSWITCH             ; [3] + 3 
       bpl PSwitch             ; [6] + 2/3
       lda (PPTR),Y            ; [8] + 5
       sta ENAM0               ; [13] + 3
       sta HMM0                ; [16] + 3
       asl                     ; [19] + 2
       asl                     ; [21] + 2
       sta NUSIZ0              ; [23] + 3
PContinue
       dey
       bpl Kernel

       ; SwitchDraw Routines
PSwitch
       bne PWait               ; [9] + 2/3
       lda PEND                ; [11] + 3      
       sta PSWITCH             ; [14] + 3
       SLEEP 6                 ; [17] + 6
       bcs PContinue           ; [23] + 3
PWait
       sta HMCLR               ; [12] + 3
       SLEEP 8                 ; [15] + 8
       bpl PContinue           ; [23] + 3      

; Player Data
; Bit 7-4 = HMove 
; Bit 3-2 = Missile Width (1, 2, 4, or 8 pixels)
; Bit 1-0 = Missile Enable
Player1
       DC.B    %00000000
       DC.B    %00000110
       DC.B    %00000010               
       DC.B    %00000110
       DC.B    %11111010
       DC.B    %00001010
       DC.B    %00001010
       DC.B    %00001010       
       DC.B    %00001010       
       DC.B    %00010010
       DC.B    %00000110
       DC.B    %00000010
       DC.B    %00000110
       DC.B    %11111010
       DC.B    %00001010               
       DC.B    %00010110             
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>I have attached the full code to this message which allows you to move the sprite around the screen.</p>
<p>&#xA0;</p>
<p>Chris</p>
<p><a href="https://atariage.com/forums/applications/core/interface/file/attachment.php?id=35903" data-fileid="35903" data-fileext="zip" rel original-href="https://atariage.com/forums/applications/core/interface/file/attachment.php?id=35903">msprite.zip</a></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__22">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on June 20, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Actually, SBX is an illegal opcode that stores to X the result of (A&amp;X)-Immediate (and it ignores the carry!)&#xA0; For this reason I&apos;ve found it useful to save a byte here and there.<p></p>
<div style="text-align:right;"><p><a rel></a>873288[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>What&apos;s the best resource for finding a list of such opcodes, DASM&apos;s preferred mnemonics for them, and any side-effects or weirdnesses?</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__23">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on June 21, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="supercat" data-cite="supercat" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Actually, SBX is an illegal opcode that stores to X the result of (A&amp;X)-Immediate (and it ignores the carry!)&#xA0; For this reason I&apos;ve found it useful to save a byte here and there.<p></p>
<div style="text-align:right;"><p><a rel></a>873288[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>What&apos;s the best resource for finding a list of such opcodes, DASM&apos;s preferred mnemonics for them, and any side-effects or weirdnesses?</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>877857[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>Emulator source code is the most comprehensive resource. Second best is probably <a href="downloads/missing/64doc.txt" rel="external nofollow" original-href="http://www.viceteam.org/plain/64doc.txt">this.</a></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__24">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on July 14, 2005</div><div class="mdl-card__supporting-text">
<p>Not a killer hack but I&apos;d like to share a link to an interview with William Mensch, 6502 designer.</p>
<p>&#xA0;</p>
<p><a href="http://vodreal.stanford.edu/sul/sgp/mensch.ram" rel="external nofollow" original-href="http://vodreal.stanford.edu/sul/sgp/mensch.ram">Real format video of interview</a></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__25">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on July 21, 2005</div><div class="mdl-card__supporting-text">
<p>Hello,</p>
<p>&#xA0;</p>
<p>A few days ago I worked up a slick routine for 8-bit unsigned multiplication (or I think it&apos;s slick, anyway.) It works as long as the values do not overflow 8 bits, in which case the value should not be relied upon anyway. The loop will never repeat more than 8 times.</p>
<p>&#xA0;</p>
<p>The beq done and bcs done are optional, one or both might save cycles but I haven&apos;t tested to see if it actually decreases or increases cycles on average.</p>
<p></p>
<pre class="ipsCode">; x and a contain multiplicands, result in a

stx temp1
sta temp2
lda #0
rept
lsr temp2
bcc skip
clc
adc temp1
;bcs done might save cycles?
skip
;beq done might save cycles?
asl temp1
bne rept
done
</pre>
<div></div>
<p></p>
<p>I tried to work up a good division routine too, but all I could come up with is successive subtraction, which is sub-optimal for small denominator values. Anyone know of a better way?</p>
<p></p>
<pre class="ipsCode">; x=numerator a=denominator, result in x
lsr
beq end;div by 0 = bad, div by 1=no calc needed, so bail out
rol;restore a
sta temp1
txa 
ldx #$ff
sec
loop
sbc temp1
inx
bcs loop
end; result in x
</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__26">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on July 21, 2005July 21, 2005</div><div class="mdl-card__supporting-text">
<p>Basically, that&apos;s how multiplication without tables works. The code could be optimized, but the table based approach is much faster.</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2005-07-21T21:38:35Z" title="07/21/2005 09:38  PM" data-short="14 yr">July 21, 2005</time> by Thomas Jentzsch</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__27">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on July 21, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="Thomas Jentzsch" data-cite="Thomas Jentzsch" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Basically, that&apos;s how multiplication without tables works. The code could be optimized, but the table based approach is much faster.<p></p>
<div style="text-align:right;"><p><a rel></a>895999[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>How big is the table?</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__28">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on July 21, 2005July 21, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>A few days ago I worked up a slick routine for 8-bit unsigned multiplication (or I think it&apos;s slick, anyway.)&#xA0; It works as long as the values do not overflow 8 bits, in which case the value should not be relied upon anyway.&#xA0; The loop will never repeat more than 8 times.<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Computing 8x8-&gt;16 multiply is more useful than 8x8-&gt;8, and isn&apos;t really any harder. The 6502&apos;s lack of add-without-carry is somewhat irksome, but there are a variety of workarounds that could be used.</p>
<p></p>
<pre class="ipsCode">; Compute mul1*mul2+acc -&gt; acc:mul1 [mul2 is unchanged]

&#xA0;ldx #8
&#xA0;dec mul2
lp:
&#xA0;lsr
&#xA0;ror mul1
&#xA0;bcc nope
&#xA0;adc mul2
nope:
&#xA0;dex
&#xA0;bne lp
&#xA0;inc mul2
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>As for division, the normal approach is to do a shift-and-subtract. A 16/8-&gt;8+8 result is pretty easy, with the caveat that the results will be meaningless if the quotient doesn&apos;t fit in eight bits. I&apos;ll try to work one up for you.</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2005-07-21T22:35:17Z" title="07/21/2005 10:35  PM" data-short="14 yr">July 21, 2005</time> by supercat</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__29">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on July 21, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="supercat" data-cite="supercat" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>A few days ago I worked up a slick routine for 8-bit unsigned multiplication (or I think it&apos;s slick, anyway.)&#xA0; It works as long as the values do not overflow 8 bits, in which case the value should not be relied upon anyway.&#xA0; The loop will never repeat more than 8 times.<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Computing 8x8-&gt;16 multiply is more useful than 8x8-&gt;8, and isn&apos;t really any harder. I&apos;ll have to see if I can work one up that deals with the 6502&apos;s &quot;fun&quot; add with carry behavior.</p>
<p>&#xA0;</p>
<p>As for division, the normal approach is to do a shift-and-subtract. A 16/8-&gt;8+8 result is pretty easy, with the caveat that the results will be meaningless if the quotient doesn&apos;t fit in eight bits. Again, I&apos;ll try to work one up for you.</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>896028[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>You can whip one up for 16-bit multiplication but I don&apos;t need it right now - I just need 8x8-&gt;8 for batari Basic, actually, where you can&apos;t use 16-bit numbers anyway, and probably won&apos;t ever be able to - as the utility of these is somewhat limited and the routines to implement them would use up precious ROM space. It&apos;s wise to keep bB from getting too top-heavy, since it&apos;s supposed to be a stepping stone to asm, and is only intended for making games, not doing complex math...</p>
<p>&#xA0;</p>
<p>But don&apos;t let this stop you, as someone may find it useful, sometime, somewhere...</p>
<p>&#xA0;</p>
<p>As for division, all I want is 8/8-&gt;8... If you want to do 16/8-&gt;8+8, go ahead, but again, I probably don&apos;t need it, for the same reasons.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__30">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on July 21, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>You can whip one up for 16-bit multiplication but I don&apos;t need it right now - I just need 8x8-&gt;8 for batari Basic, actually, where you can&apos;t use 16-bit numbers anyway, and probably won&apos;t ever be able to - as the utility of these is somewhat limited and the routines to implement them would use up precious ROM space.&#xA0; It&apos;s wise to keep bB from getting too top-heavy, since it&apos;s supposed to be a stepping stone to asm, and is only intended for making games, not doing complex math...</div></blockquote>
<p>&#xA0;</p>
<p>Well, I just snuck 8x8-&gt;16 in up above. I would think that for your fixed-point maths you&apos;d want an 8x8-&gt;16 multiply. As noted, it&apos;s pretty easy.</p>
<p>&#xA0;</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>As for division, all I want is 8/8-&gt;8... If you want to do 16/8-&gt;8+8, go ahead, but again, I probably don&apos;t need it, for the same reasons.</div></blockquote>
<p>&#xA0;</p>
<p>Here&apos;s a simple divide routine off the top of my head, but it probably isn&apos;t quite right. I&apos;ll have to simulate and see if I got it correct. It should divide A:quot by denom, leaving the quotient in quot and the remainder in A.</p>
<p></p>
<pre class="ipsCode">&#xA0;ldx #8
lp:
&#xA0;cmp denom
&#xA0;bcc toosmall
&#xA0;sbc denom &#xA0; ; Note: Carry is, and will remain, set.
&#xA0;rol quot
&#xA0;rol
&#xA0;dex
&#xA0;bne lp
&#xA0;beq done
toosmall:
&#xA0;rol quol
&#xA0;rol
&#xA0;dex
&#xA0;bne lp
done:
</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__31">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on July 21, 2005July 21, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="supercat" data-cite="supercat" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Well, I just snuck 8x8-&gt;16 in up above.&#xA0; I would think that for your fixed-point maths you&apos;d want an 8x8-&gt;16 multiply.&#xA0; As noted, it&apos;s pretty easy.<p></p>
</div></blockquote>
<p>Wow, I had no idea it was so simple. I&apos;ll go ahead and use it, and just return the lower byte in the result, but leave a note in the docs on how to get the upper byte for integer multiplication if someone really needs it in bB!</p>
<p>&#xA0;</p>
<p>EDIT: Just noticed, before the ADC, the carry is always set... do you need to clear it first?</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2005-07-21T22:53:57Z" title="07/21/2005 10:53  PM" data-short="14 yr">July 21, 2005</time> by batari</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__32">
                                                        <div class="mdl-card__title"><strong>retroconretrocon</strong> posted on July 21, 2005July 21, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="supercat" data-cite="supercat" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>As for division, the normal approach is to do a shift-and-subtract.&#xA0; A 16/8-&gt;8+8 result is pretty easy, with the caveat that the results will be meaningless if the quotient doesn&apos;t fit in eight bits.&#xA0; I&apos;ll try to work one up for you.<p></p>
<div style="text-align:right;"><p><a rel></a>896028[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Supercat,</p>
<p>&#xA0;</p>
<p>For a division shortcut, does this make any sense to you? This was a response I just got on a mailing list when asking how to optimize out a divide by 5 on a 10 bit unsigned number. I&apos;m not sure I understand it fully, but I&apos;d like to understand the concept. Do you know what would be the cheapest way to calculate a divide by 5? Table not an option of course.</p>
<p>&#xA0;</p>
<p>&quot;This is often easier to understand when expressed in binary.</p>
<p>&#xA0;</p>
<p>1/5 equals 0.00110011001100110011 etc.</p>
<p>&#xA0;</p>
<p>0.00110011 etc equals 11 multiplied by 0.000100010001 etc.</p>
<p>&#xA0;</p>
<p>0.000100010001 etc equals 10001 multiplied by 0.0000000100000001 etc.</p>
<p>&#xA0;</p>
<p>This suggests the following result (in C syntax):</p>
<p>&#xA0;</p>
<p>Y1 = (X + X&lt;&lt;1)</p>
<p>&#xA0;</p>
<p>Y2 = (Y1 + Y1&lt;&lt;4)</p>
<p>&#xA0;</p>
<p>Y3 = (Y2 + Y2&lt;&lt;<img alt="8)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_cool.gif" show-src="scraper/images/atariage_icon_cool.gif"></p>
<p>&#xA0;</p>
<p>and we have a result accurate to 16 bits with only three adders.</p>
<p>&#xA0;</p>
<p>Y4 = (Y3 + Y3&lt;&lt;16)</p>
<p>&#xA0;</p>
<p>32 bits with only four adders. &quot;</p>
<p>&#xA0;</p>
<p>[EDIT] Somehow I think this is related to this algorithm here, but I&apos;m not seeing it quite yet: <a href="http://www.sxlist.com/techref/method/math/divconst.htm" rel="external nofollow" original-href="http://www.sxlist.com/techref/method/math/divconst.htm">http://www.sxlist.com/techref/method/math/divconst.htm</a></p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2005-07-21T23:27:06Z" title="07/21/2005 11:27  PM" data-short="14 yr">July 21, 2005</time> by retrocon</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__33">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on July 22, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>EDIT: Just noticed, before the ADC, the carry is always set... do you need to clear it first?<p></p>
<div style="text-align:right;"><p><a rel></a>896042[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>That&apos;s what the &quot;dec mul2&quot; and &quot;inc mul2&quot; instructions are for. Other ways of dealing with the issue would be to subtract mul1 from the accumulator before the multiplication (which would work nicely for the low-half, but correctly dealing with the high half would be more work), inverting mul1 beforehand and then reversing the sense of the branch (adds two bytes/two cycles at the spot where mul1 gets loaded, but makes the routine more &apos;opaque&apos;), or adding a &quot;clc&quot; before the &quot;adc&quot; [which costs one byte instead of four, but sixteen cycles instead of ten].</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__34">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on July 22, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="retrocon" data-cite="retrocon" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>For a division shortcut, does this make any sense to you? This was a response I just got on a mailing list when asking how to optimize out a divide by 5 on a 10 bit unsigned number. I&apos;m not sure I understand it fully, but I&apos;d like to understand the concept. Do you know what would be the cheapest way to calculate a divide by 5?</div></blockquote>
<p>&#xA0;</p>
<p>Basically, you&apos;re replacing division by a constant with multiplication by a constant. This is an optimization approach which goes back at least to the 1960&apos;s, and probably even earlier. It&apos;s often an effective approach, but one needs to be careful to ensure that the results will aways be rounded in the expected direction (if one cares).</p>
<p>&#xA0;</p>
<p>By the way, there are some interesting table-based approaches to multiplication by non-constants which can be somewhat practical if one is doing a lot of multiplication, but require some care to ensure correct operation. One nice method, for example, takes advantage of the fact that A*A-B*B = (A+B)*(A-B).</p>
<p></p>
<pre class="ipsCode">FastMult:; Multiplies n1 by n2. &#xA0;Requires that n1+n2 be 255 or less, and n1&gt;=n2.
&#xA0;lda n1
&#xA0;clc
&#xA0;adc n2
&#xA0;tax
&#xA0;lda n1
&#xA0;sec
&#xA0;sbc n2
&#xA0;tay
&#xA0;lda squareL,x
&#xA0;sbc squareL,y
&#xA0;sta resultL
&#xA0;lda squareH,x
&#xA0;sbc squareH,y
&#xA0;sta resultH
</pre>
<div></div>
<p></p>
<p>Fourty-two cycles for an 8x8-&gt;16 multiply, subject to the restrictions noted above. Considerably faster than the shift-add method, but at the expense of 512 bytes worth of tables. The tables should be computed such that ([squareH+n]:[squareL+n]) equals int(n*n/4).</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__35">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on July 22, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="supercat" data-cite="supercat" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Basically, you&apos;re replacing division by a constant with multiplication by a constant.&#xA0; This is an optimization approach which goes back at least to the 1960&apos;s, and probably even earlier.&#xA0; It&apos;s often an effective approach, but one needs to be careful to ensure that the results will aways be rounded in the expected direction (if one cares).<p>&#xA0;</p>
<p>By the way, there are some interesting table-based approaches to multiplication by non-constants which can be somewhat practical if one is doing a lot of multiplication, but require some care to ensure correct operation.&#xA0; One nice method, for example, takes advantage of the fact that A*A-B*B = (A+B)*(A-B).</p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>goes back to at <em>least</em> the 1960&apos;s <img alt=":D" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_mrgreen.gif" show-src="scraper/images/atariage_icon_mrgreen.gif"> </p>
<p>&#xA0;</p>
<p>Both the multiply by 1/x and using the tables of squares for multiplication can be traced back to the Babylonians (2000-600BC) </p>
<p>&#xA0;</p>
<p>The formula is:</p>
<p>ab = [(a+b)^2 - (a-b)^2]/4 </p>
<p>&#xA0;</p>
<p><a href="http://www.bath.ac.uk/~ma2jc/babylonian.html" rel="external nofollow" original-href="http://www.bath.ac.uk/~ma2jc/babylonian.html">Babylonian Mathematics</a></p>
<p>&#xA0;</p>
<p>There are also the useful: sqrt(a^2 + b) approx = a + b/2a </p>
<p>&#xA0;</p>
<p>There are several variations on this code and the following mores specialized version is attributed to Stephen Judd at C=Hacking (noted in old Stella post) and is 24-26 cycles at the expense of some range. Multiplying several numbers by a particular number is quite fast as you just need to reload Y each time.</p>
<p>&#xA0;</p>
<p><a href="scraper/files/c=hacking9.txt" rel="external nofollow" original-href="http://www.ffd2.com/fridge/chacking/c=hacking9.txt">Fast Signed Multiply</a></p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">; &#xA0; &#xA0; &#xA0; &#xA0;Multiply Y * A and result in A

STA ZP1	;ZP1 -- zero page pointer to table of g(x)
EOR #$FF
CLC
ADC #$01
STA ZP2	;ZP2 also points to g(x)
LDA (ZP1),Y;g(Y+A)
SEC
SBC (ZP2),Y;g(Y-A)

</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__36">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on July 22, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Both the multiply by 1/x and using the tables of squares for multiplication can be traced back to the Babylonians (2000-600BC) <p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Yeah, well that&apos;s even further before my time than the 1960&apos;s.</p>
<p>&#xA0;</p>
<p>BTW, I developed an interesting method for doing long division which would be really cool if someone hadn&apos;t patented the same thing shortly before (and unbeknownst to me).  It would be especially useful for performing really huge divisions on machines with a fast multiply but slow divide.</p>
<p>&#xA0;</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>There are several variations on this code and the following mores specialized version is attributed to Stephen Judd&#xA0; at C=Hacking (noted in old Stella post)&#xA0; and is 24-26 cycles at the expense of some range. Multiplying several numbers by a particular number is quite fast as you just need to reload Y each time.<p></p>
<div style="text-align:right;"><p><a rel></a>896209[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Cute bit of code. Looks like it should be extendable to produce 16-bit results also.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__37">
                                                        <div class="mdl-card__title"><strong>Atari-JessAtari-Jess</strong> posted on July 22, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Not a killer hack but I&apos;d like to share a link to an interview with William Mensch, 6502 designer.<p>&#xA0;</p>
<p><a href="http://vodreal.stanford.edu/sul/sgp/mensch.ram" rel="external nofollow" original-href="http://vodreal.stanford.edu/sul/sgp/mensch.ram">Real format video of interview</a></p>
<p></p>
<div style="text-align:right;"><p><a rel></a>891481[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>That was an awesome interview, but man, I greatly disliked the interviewer.</p>
<p>&#xA0;</p>
<p>He bumbled with his words and he sounded like a smart ass and only genuinely interested when it seemed like something he knew already.</p>
<p>&#xA0;</p>
<p>I apologize if its someone here or another &quot;legend&quot; in microprocessing, but man, I can&apos;t stand the interviewer. But Mensch was awesome.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__38">
                                                        <div class="mdl-card__title"><strong>mos6507mos6507</strong> posted on August 31, 2005</div><div class="mdl-card__supporting-text">
<p>That interview must be from about 10 years ago. He&apos;s talking about Super Nintendo and the Pentium Pro like they are current products.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__39">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on November 9, 2005</div><div class="mdl-card__supporting-text">
<p>Some code courtesy of </p>
<p>&#xA0;</p>
<p><a href="http://members.lycos.co.uk/leeedavison/6502/shorts/index.html" rel original-href="http://members.lycos.co.uk/leeedavison/6502/shorts/index.html">Lee Davison 6502 code &apos;shorts&apos;</a></p>
<p>&#xA0;</p>
<p>Range test. By Lee Davison</p>
<p>&#xA0;</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>For all of these we assume that the byte to be tested is in A and that the start and end values, n and m, are already defined. Also that 0 &lt; n &lt; m &lt; $FF. <p>If you don&apos;t need to preserve the byte in A then testing the byte can be done in five bytes and only six cycles. This sets the carry if A is in the range n to m. </p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">CLC	; clear carry for add
ADC	#$FF-m; make m = $FF
ADC	#m-n+1; carry set if in range n to m	
</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__40">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on November 9, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Some code courtesy of <p>&#xA0;</p>
<p><a href="http://members.lycos.co.uk/leeedavison/6502/shorts/index.html" rel original-href="http://members.lycos.co.uk/leeedavison/6502/shorts/index.html">Lee Davison 6502 code &apos;shorts&apos;</a></p>
<p></p>
<div style="text-align:right;"><p><a rel></a>962533[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>I like his hex-digit conversion routine. Saves a byte over the one I normally use if the state of carry on entry is unknown. I also like his &apos;toggle carry&apos; method, though I still find myself wishing the 6502 allowed a direct method to do that.</p>
<p>&#xA0;</p>
<p>BTW, one thing that&apos;s often useful is the &quot;cookie cutter&quot; operation. For example, to store bits 3-5 of the accumulator into a memory location while leaving the other bits untouched:</p>
<p></p>
<pre class="ipsCode">&#xA0;eor dest
&#xA0;and #$38; bits 3-5
&#xA0;eor dest
&#xA0;sta dest
</pre>
<div></div>
<p></p>
<p>If you want to read bits 3-5 of a memory location into the corresponding bits of the accumulator, you may similarly do:</p>
<p></p>
<pre class="ipsCode">&#xA0;eor src
&#xA0;and #$C7 ; not bits 3-5
&#xA0;eor src
</pre>
<div></div>
<p></p>
<p>but there&apos;s a very important proviso here: src MUST NOT change between the two &apos;eor&apos; instructions. Any bit of src which changes between those instructions will cause the corresponding bit in the accumulator to be toggled if not in the range of bit 3..5.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__41">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on November 10, 2005</div><div class="mdl-card__supporting-text">
<p>Here&apos;s some interesting code <a href="https://atariage.com/forums/index.php?showtopic=75267&amp;view=findpost&amp;p=954542" rel original-href="https://atariage.com/forums/index.php?showtopic=75267&amp;view=findpost&amp;p=954542">from batari</a>:</p>
<p>&#xA0;</p>
<p>This:</p>
<p></p>
<pre class="ipsCode"> &#xA0; ldx #56
&#xA0; loop
&#xA0;;do some stuff here
&#xA0; txa
&#xA0; sec
&#xA0; sbc #14
&#xA0; tax
&#xA0; bne loop</pre>
<div></div>
<p></p>
<p>Can be rewritten like this:</p>
<p></p>
<pre class="ipsCode"> &#xA0; ldx #56
&#xA0; loop
&#xA0;;do some stuff here
&#xA0; txa
&#xA0; sbx #14
&#xA0; bne loop</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>And his comment:</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>the whole routine above was in a loop that was executed up to 10 times, thus saving 2 bytes and up to 160 cycles.</div></blockquote>
<p>Though I think that &quot;160 cycles&quot; is wrong; I think if the loop is executed 10 times you would save 40 cycles altogether.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__42">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on November 10, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Here&apos;s some interesting code <a href="https://atariage.com/forums/index.php?showtopic=75267&amp;view=findpost&amp;p=954542" rel original-href="https://atariage.com/forums/index.php?showtopic=75267&amp;view=findpost&amp;p=954542">from batari</a>:<p>&#xA0;</p>
<p>This:</p>
<p></p>
<pre class="ipsCode"> &#xA0; ldx #56
&#xA0; loop
;do some stuff here
&#xA0; txa
&#xA0; sbx #14
&#xA0; bne loop</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>And his comment:</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>the whole routine above was in a loop that was executed up to 10 times, thus saving 2 bytes and up to 160 cycles.</div></blockquote>
<p>Though I think that &quot;160 cycles&quot; is wrong; I think if the loop is executed 10 times you would save 40 cycles altogether.</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>963347[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>The comment was misleading. The loop shown is executed 4 times, but an outer, unseen loop was executed 10 times for a total of 40. So 160 cycles would be correct.</p>
<p>&#xA0;</p>
<p>This code was in my game Zirconium until I found that the FB2 doesn&apos;t do SBX (nor does PCAE.) So I recoded it <img alt=":(" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_sad.gif" show-src="scraper/images/atariage_icon_sad.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__43">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on November 10, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>This code was in my game Zirconium until I found that the FB2 doesn&apos;t do SBX (nor does PCAE.)&#xA0; So I recoded it <img alt=":(" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_sad.gif" show-src="scraper/images/atariage_icon_sad.gif">
</div></blockquote>
<p>IMO it&apos;s a bad idea to tailor code to partially incompatible hardware or quite outdated emulators. The target system should be the Atari 2600 and nothing else.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__44">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on November 10, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="Thomas Jentzsch" data-cite="Thomas Jentzsch" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>This code was in my game Zirconium until I found that the FB2 doesn&apos;t do SBX (nor does PCAE.)&#xA0; So I recoded it <img alt=":(" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_sad.gif" show-src="scraper/images/atariage_icon_sad.gif">
</div></blockquote>
<p>IMO it&apos;s a bad idea to tailor code to partially incompatible hardware or quite outdated emulators. The target system should be the Atari 2600 and nothing else.</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>963398[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>Agreed.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__45">
                                                        <div class="mdl-card__title"><strong>mojofltrmojofltr</strong> posted on November 10, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="Atari-Jess" data-cite="Atari-Jess" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Not a killer hack but I&apos;d like to share a link to an interview with William Mensch, 6502 designer.<p>&#xA0;</p>
<p><a href="http://vodreal.stanford.edu/sul/sgp/mensch.ram" rel="external nofollow" original-href="http://vodreal.stanford.edu/sul/sgp/mensch.ram">Real format video of interview</a></p>
<p></p>
<div style="text-align:right;"><p><a rel></a>891481[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>That was an awesome interview, but man, I greatly disliked the interviewer.</p>
<p>&#xA0;</p>
<p>He bumbled with his words and he sounded like a smart ass and only genuinely interested when it seemed like something he knew already.</p>
<p>&#xA0;</p>
<p>I apologize if its someone here or another &quot;legend&quot; in microprocessing, but man, I can&apos;t stand the interviewer. But Mensch was awesome.</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>896314[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Yikes! I couldn&apos;t agree more! The guy sounds like he drank a couple of bottles of Robitussin before the interview! <img alt=":P" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_razz.gif" show-src="scraper/images/atariage_icon_razz.gif"> Still, when he isn&apos;t talking, the video is quite interesting.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__46">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on November 10, 2005November 10, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="Thomas Jentzsch" data-cite="Thomas Jentzsch" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>This code was in my game Zirconium until I found that the FB2 doesn&apos;t do SBX (nor does PCAE.)&#xA0; So I recoded it <img alt=":(" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_sad.gif" show-src="scraper/images/atariage_icon_sad.gif">
</div></blockquote>
<p>IMO it&apos;s a bad idea to tailor code to partially incompatible hardware or quite outdated emulators. The target system should be the Atari 2600 and nothing else.</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>963398[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>I tend to agree too, but there are still a staggering number of PCAE users, many of which are almost dogmatic about it. Maybe a bad decision, but I didn&apos;t want people not judging my game in the minigame contest because it wouldn&apos;t run on what they still consider the &quot;best&quot; emulator despite the fact that it&apos;s very dated (and the author has <a href="https://atariage.com/forums/index.php?showtopic=78054&amp;pid=959025&amp;st=0&amp;&amp;do=findComment&amp;comment=959025" rel original-href="https://atariage.com/forums/index.php?showtopic=78054&amp;pid=959025&amp;st=0&amp;&amp;do=findComment&amp;comment=959025">annouced</a> that he will no longer update it.)</p>
<p>&#xA0;</p>
<p>The FB2 was a lesser consideration... but I have to say I really like the quality of the composite video, and yes I do play my own game occasionally.</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2005-11-10T23:05:12Z" title="11/10/2005 11:05  PM" data-short="13 yr">November 10, 2005</time> by batari</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__47">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on November 10, 2005November 10, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="Thomas Jentzsch" data-cite="Thomas Jentzsch" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>This code was in my game Zirconium until I found that the FB2 doesn&apos;t do SBX (nor does PCAE.)&#xA0; So I recoded it <img alt=":(" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_sad.gif" show-src="scraper/images/atariage_icon_sad.gif">
</div></blockquote>
<p>IMO it&apos;s a bad idea to tailor code to partially incompatible hardware or quite outdated emulators. The target system should be the Atari 2600 and nothing else.</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>963398[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>I tend to agree too, but there are still a staggering number of PCAE users, many of which are almost dogmatic about it. Maybe a bad decision, but I didn&apos;t want people not judging my game in the minigame contest because it wouldn&apos;t run on what they still consider the &quot;best&quot; emulator despite the fact that it&apos;s very dated (and the author has <a href="https://atariage.com/forums/index.php?showtopic=78054&amp;pid=959025&amp;st=0&amp;&amp;do=findComment&amp;comment=959025" rel original-href="https://atariage.com/forums/index.php?showtopic=78054&amp;pid=959025&amp;st=0&amp;&amp;do=findComment&amp;comment=959025">annouced</a> that he will no longer update it.)</p>
<p>&#xA0;</p>
<p>The FB2 was a lesser consideration... but I have to say I really like the quality of the composite video, and yes I do play my own game occasionally.</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>963421[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>Hmmm...I wonder if Go Fish! 1K will run in PCAE? I never even bothered to check...</p>
<p>&#xA0;</p>
<p>EDIT: Sure as heck doesn&apos;t! Wonder why...</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2005-11-10T23:24:37Z" title="11/10/2005 11:24  PM" data-short="13 yr">November 10, 2005</time> by vdub_bobby</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__48">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on November 11, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Hmmm...I wonder if Go Fish! 1K will run in PCAE?&#xA0; I never even bothered to check...<p>&#xA0;</p>
<p>EDIT: Sure as heck doesn&apos;t!&#xA0; Wonder why...</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>963428[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>Are you using v2.6? It seems to load up just fine for me. The score is messed up though...</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__49">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on November 11, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Hmmm...I wonder if Go Fish! 1K will run in PCAE?&#xA0; I never even bothered to check...<p>&#xA0;</p>
<p>EDIT: Sure as heck doesn&apos;t!&#xA0; Wonder why...</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>963428[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>Are you using v2.6? It seems to load up just fine for me. The score is messed up though...</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>963447[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>Actually...I don&apos;t know what is going on. For some reason, the file menu is showing 3 different gofish1k.bin files, each of which behaves differently. There is only one file by that name in the directory...</p>
<p>&#xA0;</p>
<p>And for kicks, none of the three behaves like it does in z26. Really weird.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__50">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on November 15, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="supercat" data-cite="supercat" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div> I also like his &apos;toggle carry&apos; method, though I still find myself wishing the 6502 allowed a direct method to do that.<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Yes, that is a nice one. At a quick glance, I thought it trashed A (but it doesn&apos;t as bit seven is safely tucked away in the carry and is restored in the ror)</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">rol	; Cb into b0 &#xA0;
eor #$01	; toggle bit
ror	; b0 into Cb
</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__51">
                                                        <div class="mdl-card__title"><strong>TROGDORTROGDOR</strong> posted on December 21, 2005December 21, 2005</div><div class="mdl-card__supporting-text">
<p>Here&apos;s my all-time favorite hack for the 6502. The &quot;skip 2 bytes&quot; pseudo-instruction, which piggybacks off the BIT instruction. It saves a byte when performing &quot;either/or&quot; branching.</p>
<p>&#xA0;</p>
<p>Consider the following example. You want to store a value in either Loc1 or Loc2, depending on whether it&apos;s negative. Normally, your code would look like:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">LDA MyNumber;2
BPL B1;2
STA Loc1;2
BMI Done;2 (This is effectively a BRA to Done.)
B1
STA Loc2;2
Done
</pre>
<div></div>
<p></p>
<p>It uses 10 bytes. Now consider this alternative:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">LDA MyNumber;2
BPL B1;2
STA Loc1;2
.BYTE $2C;1 (Skips the next 2 bytes, effectively doing a BRA to Done.)
B1
STA Loc2;2
Done
</pre>
<div></div>
<p></p>
<p>It only uses 9 bytes, and does the same thing. When the processor hits the &quot;.BYTE $2C&quot;, it reads this as an Absolute BIT command, which is a 3 byte command. So, it uses the two bytes of the STA Loc2 command as the argument to the BIT command, performs a meaningless BIT test, and then continues to run, without ever executing the STA Loc2 command. The only thing to be careful with this is that the N, V, and Z flags will be corrupted. But the accumulator is not affected. So you&apos;ve just saved a byte. Also be wary that one extra cycle is used. BIT Absolute is 4 cycles, and a BMI branch is 3 cycles (or 4 if it crosses a page boundary.)</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2005-12-21T06:53:06Z" title="12/21/2005 06:53  AM" data-short="13 yr">December 21, 2005</time> by TROGDOR</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__52">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on December 21, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="TROGDOR" data-cite="TROGDOR" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>The only thing to be careful with this is that the N, V, and Z flags will be corrupted.&#xA0; But the accumulator is not affected.&#xA0; So you&apos;ve just saved a byte.&#xA0; Also be wary that one extra cycle is used.&#xA0; BIT Absolute is 4 cycles, and a BMI branch is 3 cycles (or 4 if it crosses a page boundary.)<p></p>
<div style="text-align:right;"><p><a rel></a>986490[/snapback]</p></div>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Another thing to beware of is that certain memory locations can be affected by reads. In a 4K cart, this isn&apos;t apt to be a problem (the only thing affected by a read is the timer-interrupt flag on the RIOT which is cleared by reading INTIM). In a 16K or 32K cart, skipping &quot;INC nn,X&quot; or &quot;ISB nn,x&quot; will trigger a bank switch if &apos;nn&apos; is $1F, $3F, $5F, $7F, $9F, $BF, $DF, or $FF, but such an instruction isn&apos;t too likely to occur. In a 32K cart, skipping &quot;SBC nn,X&quot; will also trigger a bankswitch.</p>
<p>&#xA0;</p>
<p>None of those bankswitch hotspots is in practice likely to be a problem. On the other hand, RAM based carts open up a much bigger danger zone. On a Superchip cart, skipping any instruction whose opcode is $00-$7F and whose operand is $10, $30, $50, $70, $90, $B0, $D0, or $F0 will trash a byte of Superchip RAM. On a Supercharger, skipping any two-byte instruction whose operand is one of the above will be, to put it mildly, &quot;interesting&quot;.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__53">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on December 21, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Yes, that is a nice one. At a quick glance, I thought it trashed A (but it doesn&apos;t as bit seven is safely tucked away in the carry and is restored in the ror)<p></p>
<div style="text-align:right;"><p><a rel></a>965779[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>BTW, if it&apos;s desired to copy bit 7 of an address into all bits of the accumulator (so it&apos;s 00 or FF):</p>
<p></p>
<pre class="ipsCode">&#xA0;lda #$7F
&#xA0;cmp Address ; Carry clear if &gt;= $80
&#xA0;adc #$80 &#xA0;; $00 if carry set; $FF if carry clear
</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__54">
                                                        <div class="mdl-card__title"><strong>TROGDORTROGDOR</strong> posted on December 21, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="supercat" data-cite="supercat" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="TROGDOR" data-cite="TROGDOR" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>The only thing to be careful with this is that the N, V, and Z flags will be corrupted.&#xA0; But the accumulator is not affected.&#xA0; So you&apos;ve just saved a byte.&#xA0; Also be wary that one extra cycle is used.&#xA0; BIT Absolute is 4 cycles, and a BMI branch is 3 cycles (or 4 if it crosses a page boundary.)<p></p>
<div style="text-align:right;"><p><a rel></a>986490[/snapback]</p></div>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Another thing to beware of is that certain memory locations can be affected by reads. In a 4K cart, this isn&apos;t apt to be a problem (the only thing affected by a read is the timer-interrupt flag on the RIOT which is cleared by reading INTIM). In a 16K or 32K cart, skipping &quot;INC nn,X&quot; or &quot;ISB nn,x&quot; will trigger a bank switch if &apos;nn&apos; is $1F, $3F, $5F, $7F, $9F, $BF, $DF, or $FF, but such an instruction isn&apos;t too likely to occur. In a 32K cart, skipping &quot;SBC nn,X&quot; will also trigger a bankswitch.</p>
<p>&#xA0;</p>
<p>None of those bankswitch hotspots is in practice likely to be a problem. On the other hand, RAM based carts open up a much bigger danger zone. On a Superchip cart, skipping any instruction whose opcode is $00-$7F and whose operand is $10, $30, $50, $70, $90, $B0, $D0, or $F0 will trash a byte of Superchip RAM. On a Supercharger, skipping any two-byte instruction whose operand is one of the above will be, to put it mildly, &quot;interesting&quot;.</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>986508[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Thanks for the heads-up supercat. I want to maintain Supercharger compatibility for all my programs, so it looks like I&apos;ll have to ditch my favorite hack. <img alt=":sad:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_frown.gif" show-src="scraper/images/atariage_icon_frown.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__55">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on December 21, 2005December 21, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="TROGDOR" data-cite="TROGDOR" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="supercat" data-cite="supercat" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>On a Supercharger, skipping any two-byte instruction whose operand is one of the above will be, to put it mildly, &quot;interesting&quot;.<p></p>
<div style="text-align:right;"><p><a rel></a>986508[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>Thanks for the heads-up supercat. I want to maintain Supercharger compatibility for all my programs, so it looks like I&apos;ll have to ditch my favorite hack.</p>
</div></blockquote>
<p>No need to abandon the hack unless you are writing actual Supercharger games. If you create a regular 4k binary and run it on a Supercharger, you will have writes disabled anyway so this doesn&apos;t apply.</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2005-12-21T09:20:12Z" title="12/21/2005 09:20  AM" data-short="13 yr">December 21, 2005</time> by batari</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__56">
                                                        <div class="mdl-card__title"><strong>cd-wcd-w</strong> posted on December 21, 2005</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="TROGDOR" data-cite="TROGDOR" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-username="supercat" data-cite="supercat" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>On a Supercharger, skipping any two-byte instruction whose operand is one of the above will be, to put it mildly, &quot;interesting&quot;.<p></p>
<div style="text-align:right;"><p><a rel></a>986508[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>Thanks for the heads-up supercat. I want to maintain Supercharger compatibility for all my programs, so it looks like I&apos;ll have to ditch my favorite hack.</p>
</div></blockquote>
<p>No need to abandon the hack unless you are writing actual Supercharger games. If you create a regular 4k binary and run it on a Supercharger, you will have writes disabled anyway so this doesn&apos;t apply.</p>
<p></p>
<div style="text-align:right;"><p><a rel></a>986549[/snapback]</p></div>
<p></p>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Ah, I have been wondering for some time why this trick was unreliable when I used it within my PoP code <img alt=":idea:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_idea.gif" show-src="scraper/images/atariage_icon_idea.gif"> </p>
<p>&#xA0;</p>
<p>Thanks,</p>
<p>Chris</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__57">
                                                        <div class="mdl-card__title"><strong>cd-wcd-w</strong> posted on April 19, 2006</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="873438" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Here&apos;s the software collision routine I worked up for Go Fish!<p>A little different - I use it to check if two boxes overlap. Call it once for X values, then call it again with Y values.</p>
<p></p>
<pre class="ipsCode">CheckBoundaries
	lda rect1.leftortop
	cmp rect2.leftortop	  [*]
	bmi Check2
	cmp rect2.rightorbottom
	bmi InsideBoundingBox
Check2
	lda rect2.leftortop
	cmp rect1.leftortop	 [*]
	bmi NotInsideBoundingBox
	cmp rect1.rightorbottom
	bpl NotInsideBoundingBox
InsideBoundingBox
	sec
	rts
NotInsideBoundingBox
	clc
	rts
</pre>
<div></div>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>I was looking back through this thread for a collision detection routine for my Juno First game, and the above routine looks like it will be ideal. However, if I am not mistaken, the comparisons marked [*] are the inverse of each other, so I think the code can be simplified as follows:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">CheckBoundaries
	lda rect1.leftortop
	cmp rect2.leftortop  
	bmi Check2
	cmp rect2.rightorbottom
	bmi InsideBoundingBox
NotInsideBoundingBox
	clc
	rts
Check2
	lda rect2.leftortop
	cmp rect1.rightorbottom
	bpl NotInsideBoundingBox
InsideBoundingBox
	sec
	rts
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Chris</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__58">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on April 19, 2006</div><div class="mdl-card__supporting-text">
<p><img alt=":thumbsup:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_thumbsup.gif" show-src="scraper/images/atariage_icon_thumbsup.gif"></p>
<p>&#xA0;</p>
<p>Don&apos;t know how I missed that; that looks nice. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__59">
                                                        <div class="mdl-card__title"><strong>cd-wcd-w</strong> posted on April 19, 2006</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1053879" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<img alt=":thumbsup:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_thumbsup.gif" show-src="scraper/images/atariage_icon_thumbsup.gif"><p>Don&apos;t know how I missed that; that looks nice. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Thanks - I haven&apos;t actually tried it yet, but it should work unless I am missing something <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"> </p>
<p>&#xA0;</p>
<p>Chris</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__60">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on April 19, 2006</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1053871" data-ipsquote-username="cd-w" data-cite="cd-w" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>I was looking back through this thread for a collision detection routine for my Juno First game, and the above routine looks like it will be ideal. However, if I am not mistaken, the comparisons marked [*] are the inverse of each other, so I think the code can be simplified as follows:</div></blockquote>
<p>&#xA0;</p>
<p>If one is trying to determine whether two objects of fixed size are overlapping, why not just use:</p>
<p></p>
<pre class="ipsCode"> ; Start with carry clear
 lda xpos1
 sbc xpos2 ; Note will subtract n-1
 sbc #SIZE2-1
 adc #SIZE1+SIZE2-1 ; Carry set if overlap
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>If SIZE1=4 and SIZE2=8, xpos1=20...</p>
<p>- If xpos2=24, the first SBC yields $FB (no carry) and the second, $F3 (carry set). The ADC generates no carry.</p>
<p>- If xpos2=12, the first SBC yields $07 (carry set) and the second, $00 (carry set). Again, the ADC generates no carry.</p>
<p>&#xA0;</p>
<p>- If xpos2=23, the first SBC yields $FC (no carry) and the second, $F4 (carry set). The ADC generates carry.</p>
<p>- If xpos2=13, the first SBC yields $06 (carry set) and the second, $FF (carry clear). Again, the ADC generates carry.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__61">
                                                        <div class="mdl-card__title"><strong>cd-wcd-w</strong> posted on April 20, 2006April 20, 2006</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1054049" data-ipsquote-username="supercat" data-cite="supercat" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>If one is trying to determine whether two objects of fixed size are overlapping, why not just use:<p></p>
<pre class="ipsCode">; Start with carry clear
 lda xpos1
 sbc xpos2; Note will subtract n-1
 sbc #SIZE2-1
 adc #SIZE1+SIZE2-1; Carry set if overlap
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>If SIZE1=4 and SIZE2=8, xpos1=20...</p>
<p>- If xpos2=24, the first SBC yields $FB (no carry) and the second, $F3 (carry set). The ADC generates no carry.</p>
<p>- If xpos2=12, the first SBC yields $07 (carry set) and the second, $00 (carry set). Again, the ADC generates no carry.</p>
<p>&#xA0;</p>
<p>- If xpos2=23, the first SBC yields $FC (no carry) and the second, $F4 (carry set). The ADC generates carry.</p>
<p>- If xpos2=13, the first SBC yields $06 (carry set) and the second, $FF (carry clear). Again, the ADC generates carry.</p>
</div></blockquote>
<p>&#xA0;</p>
<p>This seems to be an even better approach, and is particularly useful for me as it has a constant cycle count. I wish I could write code like this, but I always seem to have trouble figuring the arithmetic <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"> Incidentally, I implemented the previous version which I posted above and it works fine.</p>
<p>&#xA0;</p>
<p>Chris</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2006-04-20T11:03:27Z" title="04/20/2006 11:03  AM" data-short="13 yr">April 20, 2006</time> by cd-w</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__62">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on May 21, 2006</div><div class="mdl-card__supporting-text">
<p>Here&apos;s another one for the code wizards out there. I&apos;m trying to write some good code for 7-bit binary-&gt;8-bit BCD. Here&apos;s two examples I&apos;ve come up with:</p>
<p>&#xA0;</p>
<p>Obvious method (23 bytes):</p>
<p></p>
<pre class="ipsCode">; input: binary value in A

  ldx #$FF
  sec
count
  sbc #10
  inx
  bcs count
  adc #10
  ora table,x

; output: BCD value in A

table .byte $0,$10,$20,$30,$40,$50,$60,$70,$80,$90

</pre>
<div></div>
<p> </p>
<p>&#xA0;</p>
<p>&#xA0;</p>
<p>Obfuscated method: 19 bytes</p>
<p></p>
<pre class="ipsCode">; input: binary value in A

  ldx #8
  ldy #4
repeat
  dey
  bmi noadd
  cmp #$50
  bcc noadd
  adc #$2f
noadd
  cmp #$80
  rol
  dex
  bne repeat

; output: BCD value in A

</pre>
<div></div>
<p></p>
<p>Can anyone guess how #2 works?</p>
<p>&#xA0;</p>
<p>I&apos;m not satisfied with either though. It seems that there should be a better way, in terms of speed and cycles... Maybe something using the &quot;D&quot; flag?</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__63">
                                                        <div class="mdl-card__title"><strong>RybagsRybags</strong> posted on May 21, 2006</div><div class="mdl-card__supporting-text">
<p>Quickly written... probably more cycles - table values adjusted since carry will be set for add.</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">tay 
and #3; starting figure (0-7) 
pha 
tya 
lsr a 
lsr a
lsr a 
sta ztemp 
pla 
ldx #4
loop:  lsr ztemp 
bcc noadd 
adc dectab-1,x 
noadd:  dex 
bne loop
rts 
dectab .byte $63,$31,$15,$07
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Another tip: Instead of using branch, load/or, etc in certain conditions, you can just use the Processor Status, e.g. preserve bit 7 of a location.</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">Lda (screen),y
php
&lt;other stuff&gt;
plp
and #$80
ora newchar
sta (screen),y
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>I used a similar technique to preserve bit 7 of screen data in a softsprite routine - so that multicolour bitpair 11 still uses the right playfield.</p>
<p>&#xA0;</p>
<p>Handily, the N and V flags and bit 7 and 6, so something like a BIT instruction followed by PHP will preserve the bit values for later processing.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__64">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on May 21, 2006May 21, 2006</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1071119" data-ipsquote-username="Rybags" data-cite="Rybags" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Quickly written... probably more cycles - table values adjusted since carry will be set for add.</div></blockquote>
<p>Actually it might be quicker in terms of cycles, but it is quite a bit longer.</p>
<p>&#xA0;</p>
<p>After research, I came up with something really short (17 bytes)</p>
<p></p>
<pre class="ipsCode">; Binary in A

  sed
  sta temp1
  lda #0
  ldx #8
loop
  asl temp1
  sta temp2
  adc temp2
  dex
  bne loop
  cld

; BCD in A
</pre>
<div></div>
<p></p>
<p>What&apos;s cool about this one is that it actually will do 8-bit binary -&gt; 9-bit BCD, with the 9th bit contained in the carry! Can this be improved any more, though?</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2006-05-21T21:34:47Z" title="05/21/2006 09:34  PM" data-short="13 yr">May 21, 2006</time> by batari</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__65">
                                                        <div class="mdl-card__title"><strong>Heaven/TQAHeaven/TQA</strong> posted on May 22, 2006</div><div class="mdl-card__supporting-text">
<p>ehm...call me stupid but for what do i need 9th bit bcd? positive/negative range?</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__66">
                                                        <div class="mdl-card__title"><strong>RybagsRybags</strong> posted on May 22, 2006</div><div class="mdl-card__supporting-text">
<p>Theoretically, allowing full representation of 0-127, I suppose. </p>
<p>&#xA0;</p>
<p>Probably would want some modification to allow for calling and using the carry bit in each initial calculation.</p>
<p>&#xA0;</p>
<p>Anyway, stuff like that you only need once in a program and memory usage is mainly a 2600 consideration for stuff like BCD score / timers etc.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__67">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on March 7, 2007</div><div class="mdl-card__supporting-text">
<p>This isn&apos;t exactly a 6502 Killer hack but I wanted to share this link.</p>
<p>&#xA0;</p>
<p><a href="http://graphics.stanford.edu/~seander/bithacks.html" rel="external nofollow" original-href="http://graphics.stanford.edu/~seander/bithacks.html">http://graphics.stanford.edu/~seander/bithacks.html</a></p>
<p>&#xA0;</p>
<p>There you will find some useful methods that apply to your 6502 coding.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__68">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on March 9, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1252071" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<p>This isn&apos;t exactly a 6502 Killer hack but I wanted to share this link.</p>
<p>&#xA0;</p>
<p><a href="http://graphics.stanford.edu/~seander/bithacks.html" rel="external nofollow" original-href="http://graphics.stanford.edu/~seander/bithacks.html">http://graphics.stanford.edu/~seander/bithacks.html</a></p>
<p>&#xA0;</p>
<p>There you will find some useful methods that apply to your 6502 coding.</p>
<p></p>
</div></blockquote>
<p>Some of those are pretty cool.</p>
<p>&#xA0;</p>
<p>I thought I&apos;d translate some of them to 6502 assembly:</p>
<p></p>
<pre class="ipsCode">Counting bits set, Brian Kernighan&apos;s way

unsigned int v; // count the number of bits set in v
unsigned int c; // c accumulates the total bits set in v
for (c = 0; v; c++)
{
 v &amp;= v - 1; // clear the least significant bit set
}
</pre>
<div></div>
<p></p>
<p>Assembly:</p>
<p></p>
<pre class="ipsCode">;--count set bits in v
;  trashes v, accumulator, result is in c

  lda #0
  sta c
Loop
  lda v
  beq Done
  inc c
  dec v
  and v
  sta v
  bne Loop
Done</pre>
<div></div>
<p></p>
<p>Seems like that should be improveable.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__69">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on March 9, 2007March 9, 2007</div><div class="mdl-card__supporting-text">
<p>Here&apos;s another:</p>
<p></p>
<pre class="ipsCode">Swapping values with XOR

#define SWAP(a, b) (((a) ^= (b)), ((b) ^= (a)), ((a) ^= (b)))

This is an old trick to exchange the values of the variables a and b without using extra space for a temporary variable.

;--swap a and b

  lda a
  eor b
  sta a
  eor b
  sta b
  eor a
  sta a</pre>
<div></div>
<p></p>
<p>That right?</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2007-03-09T18:58:48Z" title="03/09/2007 06:58  PM" data-short="12 yr">March 9, 2007</time> by vdub_bobby</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__70">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on March 9, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1253332" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<p>Here&apos;s another:</p>
<p></p>
<pre class="ipsCode">Swapping values with XOR

#define SWAP(a, b) (((a) ^= (b)), ((b) ^= (a)), ((a) ^= (b)))

This is an old trick to exchange the values of the variables a and b without using extra space for a temporary variable.

;--swap a and b

  lda a
  eor b
  sta a
  eor b
  sta b
  eor a
  sta a</pre>
<div></div>
<p></p>
<p>That right?</p>
<p></p>
</div></blockquote>
<p>That does have some academic appeal, but this is how I usually do it:</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<p> lda a</p>
<p> ldy b</p>
<p> sta b</p>
<p> sty a</p>
<p></p>
</div></blockquote>
<p>I suppose if you absolutely can&apos;t use RAM or another register, the EOR trick would work.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__71">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on March 9, 2007March 9, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1253421" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>That does have some academic appeal</div></blockquote>
<p>That&apos;s what I&apos;m going for here! <img alt=":lol:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_lol.gif" show-src="scraper/images/atariage_icon_lol.gif"></p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2007-03-09T21:28:29Z" title="03/09/2007 09:28  PM" data-short="12 yr">March 9, 2007</time> by vdub_bobby</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__72">
                                                        <div class="mdl-card__title"><strong>UrchlayUrchlay</strong> posted on March 9, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1253327" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<p>Assembly:</p>
<p></p>
<pre class="ipsCode">;--count set bits in v
;  trashes v, accumulator, result is in c

  lda #0
  sta c
Loop
  lda v
  beq Done
  inc c
  dec v
  and v
  sta v
  bne Loop
Done</pre>
<div></div>
<p></p>
<p>Seems like that should be improveable.</p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>I&apos;ll take a stab at it...</p>
<p>&#xA0;</p>
<p>Execution time for your version is 11 cycles if v is 0, or 5+n*23-1 cycles if v is not zero (where n is the number of bits set in v). Average time (4 bits set in input) is 96 cycles.</p>
<p>&#xA0;</p>
<p>One obvious improvement would be to use the X register instead of memory location c. Use &quot;ldx #0&quot; to initialize (saves 3 cycles, assuming &quot;c&quot; was a zero page address), and &quot;inx&quot; instead of &quot;inc c&quot; (saves 3 cycles per set bit in v). Also the code gets 2 bytes smaller. Of course, if you already had written a lot of code that used this as a subroutine, all that code would have to change (to look for the result in X instead of c). Depending on how the calling code used the result, you might end up losing a lot more than the 2 bytes you&apos;ve saved.</p>
<p>&#xA0;</p>
<p>Another improvement would be to move the Loop label down two lines (below the &quot;beq Done&quot;)... You only need to do &quot;lda v : beq Done&quot; once, before the first loop iteration (to catch the special case where the initial value of v is zero). At the end of the loop, you&apos;re making this check again (the &quot;bne Loop&quot;)... if this branch is taken (back to Loop), it&apos;s redundant to check v for zero again (you&apos;re guaranteed it&apos;s not, since you just took the &quot;bne Loop&quot; branch). This will save you 4 cycles per set bit in v, and it won&apos;t break compatibility with (hypothetical) existing code that calls the routine, either. (It will add 4 constant cycles before the loop, though)</p>
<p>&#xA0;</p>
<p>Applying both improvements (X register and moving the label) would save 7 cycles per loop iteration, which is a 30% speedup (of just the loop)... not bad.</p>
<p>&#xA0;</p>
<p>Code looks like:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">;--count set bits in v
;  trashes v, accumulator, result is in X register

  ldx #0
  lda v
  beq Done
Loop
  inx
  dec v
  and v
  sta v
  bne Loop
Done</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Timing is 8 cycles if v is 0, or 7+16*n-1 if v is not 0... Average case (4 bits set in input) is 70 cycles, 28% faster than the original, assuming I&apos;ve gotten all the numbers right (if not, I apologize). Total code size is 15 bytes (3 bytes smaller than the original).</p>
<p>&#xA0;</p>
<p>However, there are a couple of other ways to count set bits that are faster at the expense of more code. I was messing around with this a while back, and came up with 5 other solutions (I never came up with the Kernighan method on my own, though). Here are a couple of them:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Count the number of set bits in A
; Unrolled version
; Result in A
; Uses one byte of RAM at tmp (preferably ZP)
; On exit: X and Y untouched, C/Z/N undefined
; Code size: 36 bytes (+1 for RTS = 37)
; Execution time: Constant, 5+(7*8) = 61 cycles (+6 for RTS = 67)
countbits_3:
 sta tmp; 3
 lda #0 ; 2
 rol tmp; 5
 adc #0 ; 2
 rol tmp; 5
 adc #0 ; 2
 rol tmp; 5
 adc #0 ; 2
 rol tmp; 5
 adc #0 ; 2
 rol tmp; 5
 adc #0 ; 2
 rol tmp; 5
 adc #0 ; 2
 rol tmp; 5
 adc #0 ; 2
 rol tmp; 5
 adc #0 ; 2

 rts
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Count the number of set bits in A
; Nybble table version
; Result in A
; Uses one byte of RAM at tmp (preferably ZP)
; Execution time: Constant, 35 cycles (+6 for RTS)
; Code size: 17 bytes table + 19 bytes code = 36 bytes (+1 for RTS = 37)
; This is faster than the fully-unrolled version,
; but it trashes all the registers and flags. Could use PHA/PLA instead of
; TAY/TYA, to preserve the Y register, at the expense of 2 cycles.
nyb_bits: byte 0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4
countbits_4:
 tay		   ; 2
 and #$0F	  ; 3
 tax		   ; 2
 lda nyb_bits,x; 4
 sta tmp	   ; 3
 tya		   ; 2
 lsr		   ; 2
 lsr		   ; 2
 lsr		   ; 2
 lsr		   ; 2
 tax		   ; 2
 lda nyb_bits,x; 4
 clc		   ; 2
 adc tmp	   ; 3

 rts		   ; 6
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Neither of these is all that original. The unrolled version is obvious to any 6502&apos;er, and the nybble-table idea came from some code I saw either here or on the [stella] list (I couldn&apos;t find the original code, so I rewrote it from scratch).</p>
<p>&#xA0;</p>
<p>Here&apos;s one I came up with on my own. It&apos;s not all that fast, but I like it because it fits in 11 bytes of code and doesn&apos;t use a temp location in RAM. Also, if I added a ROL before the RTS, the accumulator and carry flag would keep their original values, which might simplify things for the calling code.</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Count the number of set bits in A
; Result in Y
; Uses no RAM
; On exit:
; Y = result, X = 0, A = undefined, C = undefined, Z = 1, N = 0
; Min execution time (input $00, 0 bits set):
; 4+(2+3+2+3)*8-1 = 83 cycles
; Avg execution time (input $AA, 4 bits set):
; 4+(2+3+2+3)*4+(2+2+2+2+3)*4-1 = 87 cycles
; Max execution time (input $FF, 8 bits set):
; 4+(2+2+2+2+3)*8-1 = 91 cycles
; (add 6 cycles for RTS to all 3 counts)
; Code size: 11 bytes (+1 for RTS = 12)

countbits_2:
ldx #8; 2
ldy #0; 2

cb2loop
 rol		 ; 2
 bcc cb2_noiny; 2/3
 iny		 ; 2
cb2_noiny
 dex		 ; 2
 bne cb2loop ; 3

; rol; adding this ROL preserves the original values of A and C (and sets Z and N according to the A value)
 rts; 6 
</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__73">
                                                        <div class="mdl-card__title"><strong>UrchlayUrchlay</strong> posted on March 9, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1253421" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<p>I suppose if you absolutely can&apos;t use RAM or another register, the EOR trick would work.</p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>The EOR trick still uses RAM (locations a and b).</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__74">
                                                        <div class="mdl-card__title"><strong>UrchlayUrchlay</strong> posted on March 9, 2007</div><div class="mdl-card__supporting-text">
<p>A while ago, I wrote this bit of code to calculate even/odd parity. It could probably stand some improvement... I definitely don&apos;t consider it a &quot;killer hack&quot;: it&apos;s coded for clarity more than speed or size, but it does implement something from the bithack page, so I thought someone might be interested.</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; calc_parity will calculate even or odd parity for the low 7 bits of A,
; sets the high bit and N flag to the result.

; Input:
; A = data to calculate parity for (bit 7 ignored)
; C = carry set for odd parity, clear for even
; X, Y, other flags: ignored

; Output:
; A = data with correct parity bit in bit 7 (bits 0-6 unchanged)
; N = parity bit (same as A bit 7)
; C = parity bit (same as A bit 7 and N)
; Z = 1 if A is 0, or 0 otherwise
; X = 0
; Y = bits 0-6 of input
; tmp = same as Y

; Memory usage: One byte at tmp. No stack used.
; If desired, the routine could easily be modified to preserve the
; Y register (and use another RAM temp instead).

; Execution time: Constant, 108 cycles, +6 for RTS. Add 10 cycles if tmp is
; not located in zero page.

; Code size: 25 bytes, +1 for RTS (+4 if tmp not zero page)

; Code:
calc_parity: subroutine;{
 and #$7F ; 2; throw away top bit (it will get replaced anyway)
 sta tmp  ; 3; copy in tmp will be repeatedly shifted (destroyed),
 tay	  ; 2; so stash another copy in Y
 lda #0   ; 2; init accumulator:
 rol	  ; 2; A=1 if C was set, otherwise A=0
 ldx #7   ; 2
	   ; =13 (+1 if tmp not ZP)

;  {
.loop	 ; loop executes 7 times...
 lsr tmp  ; 5
 adc #0   ; 2
 dex	  ; 2
 bne .loop; 3
	   ; =12*7-1 = 83, +7 if tmp not ZP
;  }

; A now has count of set bits from bits 0-6 of the original argument,
; plus 1 if C flag was initially set.
; Bit 0 of A will be the new parity bit.
 ror	  ; 2; C = bit 0 of A
 lda #0   ; 2
 ror	  ; 2; bit 7 of A = C, bits 0-6 are 0
 sty tmp  ; 3
 ora tmp  ; 3
	   ; =12 (+2 if tmp not ZP)

 rts	  ; 6
;}
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>BTW, the comments with the curly braces (lines like &quot;; }&quot;) are a Stupid Editor Trick: My editor lets me jump from an opening { to a closing } quickly (very handy for C or Java code), so I&apos;ve gotten in the habit of using them in 6502 asm code for easy navigation. I use Vim, and I know Emacs has support for this, too. I&apos;d bet that any halfway decent code editor or IDE supports it, too.</p>
<p>&#xA0;</p>
<p>I&apos;ve also got a vim macro that selects the current block of code (from the { to the }), for cut/copy or applying other commands. I just press F2 to highlight... and I&apos;ve got F1 bound to a macro that comments out the block (or uncomments it, if it&apos;s already commented). Who says vi is hard to use? <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__75">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on March 9, 2007</div><div class="mdl-card__supporting-text">
<p>This is how I would do it:</p>
<pre class="ipsCode">	lda	 v	  ; 2
ldx	 #-1	; 2
.count:
inx			; 2
.loop:
lsr			; 2
bcs	 .count ; 2&#xB3;
bne	 .loop  ; 2&#xB3;</pre>
<div></div>
<p></p>
<p>No someone do the math. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__76">
                                                        <div class="mdl-card__title"><strong>UrchlayUrchlay</strong> posted on March 9, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1253462" data-ipsquote-username="Thomas Jentzsch" data-cite="Thomas Jentzsch" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<p>This is how I would do it:</p>
<pre class="ipsCode">	lda	 v	 ; 2
ldx	 #-1; 2
.count:
inx		; 2
.loop:
lsr		; 2
bcs	 .count; 2&#xB3;
bne	 .loop ; 2&#xB3;</pre>
<div></div>
<p></p>
<p>No someone do the math. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Holy crap, *that* is a killer hack!</p>
<p>&#xA0;</p>
<p>10 cycles if v was 0, and 63 cycles if it was $FF (worst case)... in 10 bytes of code!</p>
<p>&#xA0;</p>
<p>Also, your version is optimized for lower numbers... the execution time depends on where the most significant set bit is, instead of the number of set bits like the Kernighan version (so your version is faster for $0F than it would be for $F0, even though both have 4 bits set).</p>
<p>&#xA0;</p>
<p>If I were wearing a hat, I&apos;d take it off to you <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__77">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on March 9, 2007</div><div class="mdl-card__supporting-text">
<p><img alt=":D" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_mrgreen.gif" show-src="scraper/images/atariage_icon_mrgreen.gif"> Thanks Urchlay and TJ, lots of fun reading. </p>
<p>&#xA0;</p>
<p>Now tell me what in the world &quot;parity&quot; is. <img alt=":?" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_confused.gif" show-src="scraper/images/atariage_icon_confused.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__78">
                                                        <div class="mdl-card__title"><strong>UrchlayUrchlay</strong> posted on March 9, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1253493" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<p><img alt=":D" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_mrgreen.gif" show-src="scraper/images/atariage_icon_mrgreen.gif"> Thanks Urchlay and TJ, lots of fun reading. </p>
<p>&#xA0;</p>
<p>Now tell me what in the world &quot;parity&quot; is. <img alt=":?" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_confused.gif" show-src="scraper/images/atariage_icon_confused.gif"></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Long description: <a href="https://en.wikipedia.org/wiki/Parity_%28telecommunication%29" rel="external nofollow" original-href="https://en.wikipedia.org/wiki/Parity_%28telecommunication%29">http://en.wikipedia.org/wiki/Parity_%28telecommunication%29</a></p>
<p>&#xA0;</p>
<p>Short version: An 8th bit that&apos;s added to a 7-bit byte, so that the number of 1 bits comes out to an even number (even parity) or to an odd number (odd parity). Used to detect errors on a serial line: the sender sends bytes with correct parity, and the receiver calculates what the parity bit should be... and if they&apos;re different, the receiver knows the data got garbled during transmission.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__79">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on March 9, 2007March 9, 2007</div><div class="mdl-card__supporting-text">
<p>Thanks. <img alt=";)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_wink.gif" show-src="scraper/images/atariage_icon_wink.gif"></p>
<p>&#xA0;</p>
<p>EDIT: How about this one:</p>
<p></p>
<pre class="ipsCode">Determining if an integer is a power of 2

unsigned int v; // we want to see if v is a power of 2
bool f;		 // the result goes here 

f = (v &amp; (v - 1)) == 0;

Note that 0 is incorrectly considered a power of 2 here. To remedy this, use:

f = !(v &amp; (v - 1)) &amp;&amp; v;</pre>
<div></div>
<p></p>
<p>What&apos;s the killer 6502 hack for this? I&apos;ve come up with this:</p>
<p></p>
<pre class="ipsCode">   lda v
  dec v
  and v
  inc v</pre>
<div></div>
<p></p>
<p>Which returns zero in the accumulator if v is a power of two and anything else if it isn&apos;t. And preserves v.</p>
<p>&#xA0;</p>
<p>Except it doesn&apos;t handle v==0 and I&apos;d rather have it return 0 if false and anything else if true.</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2007-03-09T23:34:58Z" title="03/09/2007 11:34  PM" data-short="12 yr">March 9, 2007</time> by vdub_bobby</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__80">
                                                        <div class="mdl-card__title"><strong>UrchlayUrchlay</strong> posted on March 10, 2007March 10, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1253514" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">   lda v
  dec v
  and v
  inc v</pre>
<div></div>
<p></p>
<p>Which returns zero in the accumulator if v is a power of two and anything else if it isn&apos;t. And preserves v.</p>
<p>&#xA0;</p>
<p>Except it doesn&apos;t handle v==0 and I&apos;d rather have it return 0 if false and anything else if true.</p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>The return value should really be in a flag, so you can immediately use a branch instruction afterwards... otherwise you&apos;ll need something like &quot;cmp #0&quot; in the caller. How about:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">; Warning: untested code!

is_x_power_of_2:; convenience entry point: checks X instead of location v
 stx v
 .byte $2C; aka BIT absolute opcode, skips the &quot;sta v&quot; below

is_a_power_of_2:; convenience entry point: checks accumulator instead of location v
 sta v

; Main entry point:
is_v_power_of_2: subroutine; {
 lda v
 bne .main
 lda #1; Special case: return with Z flag false, if v==0
 rts

.main; v is known to be non-zero, here
 dec v
 and v; accumulator now contains 0 if v is a power of 2 (Z flag is set correctly, but &quot;inc v&quot; is about to destroy it)

; If you don&apos;t care about preserving v, you can comment out both these lines:
 inc v
 cmp #0; set Z flag true if a==0, or false otherwise (needed because &quot;inc v&quot; trashes the Z flag)

.done
 rts
; }
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>It&apos;s not so &quot;killer&quot; any more, but it&apos;s easy to use:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode"> ldx $whatever; get a byte from somewhere
 stx v
 jsr is_v_power_of_2; Was it a power of 2?
 beq yes_it_was; yep!
; no, do whatever here...

;; Alternatively:
 lda $whatever; or, A could be the result of some calculations
 jsr is_a_power_of_2
 beq yes_it_was
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Also, since you&apos;re only dealing with an 8-bit byte, you can just brute-force it:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">; Return Z=true if A is a power of two, or Z=false if it isn&apos;t
; Uses no RAM, preserves A/X/Y, trashes flags
is_a_power_of_2: subroutine; {
 cmp #1
 beq .yes
 cmp #2
 beq .yes
 cmp #4
 beq .yes
 cmp #8
 beq .yes
 cmp #16
 beq .yes
 cmp #32
 beq .yes
 cmp #64
 beq .yes
 cmp #128
 beq .yes

; if none of the compares are true, Z ends up being false
.yes; if any of the compares are true, Z is true when we branch here

; Either way, just return it.
 rts
; }
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Converting the brute-force method to a loop... which will be slower than the original:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">is_a_power_of_2: subroutine; {
 ldx #1
 stx tmp

.loop; {
 cmp tmp
 beq .done; return with Z=true
 asl tmp
 bne .loop
;	}

; original: lda #1; return with Z=false (too bad there&apos;s no CLZ in 6502-speak)
; EDIT:
 ldx #1; return with Z=false, preserving the value of A

.done
 rts
; }
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>&#xA0;</p>
<p>However, TJ is probably about to post something that blows all this code away <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2007-03-10T00:48:07Z" title="03/10/2007 12:48  AM" data-short="12 yr">March 10, 2007</time> by Urchlay</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__81">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on March 10, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1253514" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<p>Thanks. <img alt=";)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_wink.gif" show-src="scraper/images/atariage_icon_wink.gif"></p>
<p>&#xA0;</p>
<p>EDIT: How about this one:</p>
<p></p>
<pre class="ipsCode">Determining if an integer is a power of 2

unsigned int v; // we want to see if v is a power of 2
bool f;		 // the result goes here 

f = (v &amp; (v - 1)) == 0;

Note that 0 is incorrectly considered a power of 2 here. To remedy this, use:

f = !(v &amp; (v - 1)) &amp;&amp; v;</pre>
<div></div>
<p></p>
<p>What&apos;s the killer 6502 hack for this? I&apos;ve come up with this:</p>
<p></p>
<pre class="ipsCode">   lda v
  dec v
  and v
  inc v</pre>
<div></div>
<p></p>
<p>Which returns zero in the accumulator if v is a power of two and anything else if it isn&apos;t. And preserves v.</p>
<p>&#xA0;</p>
<p>Except it doesn&apos;t handle v==0 and I&apos;d rather have it return 0 if false and anything else if true.</p>
<p></p>
</div></blockquote>
<p>Nice! <img alt=":lust:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_lust.gif" show-src="scraper/images/atariage_icon_lust.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__82">
                                                        <div class="mdl-card__title"><strong>UrchlayUrchlay</strong> posted on March 10, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1253554" data-ipsquote-username="Urchlay" data-cite="Urchlay" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<p>However, TJ is probably about to post something that blows all this code away <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>This isn&apos;t up to TJ&apos;s standards, but I just thought of another solution in the shower:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">; destructively test to see if the accumulator is a power of two
; on exit, A is trashed, X and Y are preserved, and Z is set if A was a power of two
is_a_power_of_2: subroutine; {
 cmp #0; Test for special case A==0
 bne .loop
 adc #1; another &quot;CLZ&quot;
 rts

; All powers of two have only one bit set!
.loop; {
; This loop terminates when we find a set bit
 lsr
 bcc .loop
;   }

 rts; If we found a set bit, the Z flag will be set if that was the *only* set bit
; }
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>That would actually be kind of elegant, if it weren&apos;t for the need to test for the special A==0 case <img alt=":(" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_sad.gif" show-src="scraper/images/atariage_icon_sad.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__83">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on March 10, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1253577" data-ipsquote-username="Urchlay" data-cite="Urchlay" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>That would actually be kind of elegant, if it weren&apos;t for the need to test for the special A==0 case <img alt=":(" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_sad.gif" show-src="scraper/images/atariage_icon_sad.gif">
</div></blockquote>
<p>&#xA0;</p>
<p>Hmm...</p>
<p></p>
<pre class="ipsCode"> cmp #1
 adc #255
lp:
 lsr
 bcc lp
</pre>
<div></div>
<p></p>
<p>Should do an early exit (NZ) in the A=0 case.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__84">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on March 10, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1253554" data-ipsquote-username="Urchlay" data-cite="Urchlay" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<p></p>
<pre class="ipsCode">   lda v
  dec v
  and v
  inc v</pre>
<div></div>
<p></p>
<p>Which returns zero in the accumulator if v is a power of two and anything else if it isn&apos;t. And preserves v.</p>
<p>&#xA0;</p>
<p>Except it doesn&apos;t handle v==0 and I&apos;d rather have it return 0 if false and anything else if true.</p>
</div></blockquote>
<p>How about</p>
<pre class="ipsCode">  dec v
 lda v
 inc v
 beq .exit
 and v
.exit:</pre>
<div></div>
<p>?</p>
<p>Not perfect, since you still need a compare.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__85">
                                                        <div class="mdl-card__title"><strong>UrchlayUrchlay</strong> posted on March 11, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1253590" data-ipsquote-username="supercat" data-cite="supercat" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1253577" data-ipsquote-username="Urchlay" data-cite="Urchlay" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>That would actually be kind of elegant, if it weren&apos;t for the need to test for the special A==0 case <img alt=":(" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_sad.gif" show-src="scraper/images/atariage_icon_sad.gif">
</div></blockquote>
<p>&#xA0;</p>
<p>Hmm...</p>
<p></p>
<pre class="ipsCode"> cmp #1
 adc #255
lp:
 lsr
 bcc lp
</pre>
<div></div>
<p></p>
<p>Should do an early exit (NZ) in the A=0 case.</p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Nice!</p>
<p>&#xA0;</p>
<p>Now it&apos;s elegant.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__86">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on March 11, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1254160" data-ipsquote-username="Urchlay" data-cite="Urchlay" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Now it&apos;s elegant.</div></blockquote>
<p>&#xA0;</p>
<p>Maybe. Still a bit slow, though.</p>
<p></p>
<pre class="ipsCode"> cmp #1   ; Optional first part to make zero yield a non-zero result
 adc #255

 tax
 dex
 sbx #0
</pre>
<div></div>
<p></p>
<p>If for some reason it&apos;s better to have the result in the carry flag, replace the last instruction with &quot;sbx #1&quot;. In that case, the zero flag will not be meaningful.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__87">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on March 11, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1254375" data-ipsquote-username="supercat" data-cite="supercat" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1254160" data-ipsquote-username="Urchlay" data-cite="Urchlay" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Now it&apos;s elegant.</div></blockquote>
<p>&#xA0;</p>
<p>Maybe. Still a bit slow, though.</p>
<p></p>
<pre class="ipsCode"> cmp #1  ; Optional first part to make zero yield a non-zero result
 adc #255

 tax
 dex
 sbx #0
</pre>
<div></div>
<p></p>
<p>If for some reason it&apos;s better to have the result in the carry flag, replace the last instruction with &quot;sbx #1&quot;. In that case, the zero flag will not be meaningful.</p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Ahhh... I wasn&apos;t going to say anything about your previous routine but I <em>was</em> wondering... I mean it looped! <img alt=";)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_wink.gif" show-src="scraper/images/atariage_icon_wink.gif"></p>
<p>&#xA0;</p>
<p>But this one ties it all together.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__88">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on March 11, 2007</div><div class="mdl-card__supporting-text">
<p>To detect zero, just do this:</p>
<p></p>
<pre class="ipsCode"> tax
 dex
 bmi done
 sbx #0
done
</pre>
<div></div>
<p></p>
<p>Also, why not load the value to be tested with lax, so you don&apos;t need the tax above?</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__89">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on March 12, 2007March 12, 2007</div><div class="mdl-card__supporting-text">
<p>Cool! Here&apos;s another one:</p>
<p>&#xA0;</p>
<p>Modulus.</p>
<p>&#xA0;</p>
<p>I need to find n mod 20. Well, to be specific, I need to find if n mod 20 is zero or otherwise.</p>
<p>Here&apos;s how I do it:</p>
<p></p>
<pre class="ipsCode">   lda n
  sec
Loop
  sbc #20
  bcc Remainder
  bne Loop
;--remainder is zero</pre>
<div></div>
<p></p>
<p>Which is slow. Is there a better way?</p>
<p>&#xA0;</p>
<p>EDIT: And another:</p>
<p>I have often wanted to find the absolute value of a signed byte, usually I do something like this:</p>
<p></p>
<pre class="ipsCode">   lda v
  bpl FoundAbs
  lda #0
  sec
  sbc v
FoundAbs</pre>
<div></div>
<p></p>
<p>Which is ok, I guess. The website djmips posted has this non-branching solution:</p>
<p></p>
<pre class="ipsCode">Compute the integer absolute value (abs) without branching

int v;	  // we want to find the absolute value of v
int r;	  // the result goes here 
int const mask = v &gt;&gt; sizeof(int) * CHAR_BIT - 1;

r = (v + mask) ^ mask;

Patented variation:

r = (v ^ mask) - mask;</pre>
<div></div>
<p></p>
<p>Which I translated into 6502 assembly; seems a bit messy:</p>
<p></p>
<pre class="ipsCode">   lda v
  eor #$80
  asl
  sta temp
  sbc temp
  sta temp
  clc
  adc v
  eor temp</pre>
<div></div>
<p></p>
<p>Any improvements on either routine?</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2007-03-12T18:11:34Z" title="03/12/2007 06:11  PM" data-short="12 yr">March 12, 2007</time> by vdub_bobby</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__90">
                                                        <div class="mdl-card__title"><strong>UrchlayUrchlay</strong> posted on March 12, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1255235" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<p>&#xA0;</p>
<p>I have often wanted to find the absolute value of a signed byte, usually I do something like this:</p>
<p></p>
<pre class="ipsCode">   lda v
  bpl FoundAbs
  lda #0
  sec
  sbc v
FoundAbs</pre>
<div></div>
<p></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>How about:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode"> lda v
 bpl .foundabs
 eor #$ff
 clc; not needed if the state of C is known up front
 adc #1; would be &quot;adc #0&quot;, if C is known to be set
.foundabs
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Not much of an improvement, but it does run 1 cycle faster if v is negative (or 3, if you can leave out the CLC).</p>
<p>&#xA0;</p>
<p>Reading over this thread, I can see that I need to learn how to use the illegal/undocumented opcodes. About the only ones I&apos;ve ever used are DCP and some of the extended NOPs (e.g. to sleep for 3 cycles).</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__91">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on March 13, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1255298" data-ipsquote-username="Urchlay" data-cite="Urchlay" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div><p>Reading over this thread, I can see that I need to learn how to use the illegal/undocumented opcodes. About the only ones I&apos;ve ever used are DCP and some of the extended NOPs (e.g. to sleep for 3 cycles).</p></div></blockquote>
<p>LAX is also often very useful (especially LAX (),y). And the various NOPs can also be used to skip instructions (like BIT does) but without changing the flag and sometimes even slightly faster (NOP #imm).</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__92">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on March 13, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1255235" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div><p>I need to find n mod 20. Well, to be specific, I need to find if n mod 20 is zero or otherwise.</p></div></blockquote>
<p>Using prime factors might help here. 20 = 2*2*5, so first we could SHR twice and check the carries. But then we still need an effective solution for 5. <img alt=":ponder:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_ponder.gif" show-src="scraper/images/atariage_icon_ponder.gif"> </p>
<p>&#xA0;</p>
<p>Not sure, but this may work:</p>
<pre class="ipsCode">  while (n &gt; 0) {
n = n/4 - n%4
 }</pre>
<div></div>
<p></p>
<p>n has to be zero.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__93">
                                                        <div class="mdl-card__title"><strong>CybergothCybergoth</strong> posted on March 13, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1255867" data-ipsquote-username="Thomas Jentzsch" data-cite="Thomas Jentzsch" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>But then we still need an effective solution for 5. <img alt=":ponder:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_ponder.gif" show-src="scraper/images/atariage_icon_ponder.gif">
</div></blockquote>
<p>&#xA0;</p>
<p>A 60 byte lookup table? <img alt=":twisted:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_twisted.gif" show-src="scraper/images/atariage_icon_twisted.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__94">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on March 13, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1255868" data-ipsquote-username="Cybergoth" data-cite="Cybergoth" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div><p>A 60 byte lookup table? <img alt=":twisted:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_twisted.gif" show-src="scraper/images/atariage_icon_twisted.gif"></p></div></blockquote>
<p>Nah, that&apos;s cheating. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<p>&#xA0;</p>
<p>But I just had another idea: Add the two nibbles and check if the result can be divided by 5 (== 5, A, F). For results above F you have to repeat.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__95">
                                                        <div class="mdl-card__title"><strong>Bruce TomlinBruce Tomlin</strong> posted on March 13, 2007March 13, 2007</div><div class="mdl-card__supporting-text">
<p>Here&apos;s a quick mod 5 I just came up with:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">	LDX	#5*32; start with 5 shifted left as far as possible
STX	temp
.10
CMP	temp
BCS	.20; branch if A &lt; temp
SEC; may or not be needed, I can never remember how carry works 6502 subtract
SBC	temp; subtract temp from A
;   BNE	.30; can short-cut exit here if exact multiple
.20
LSR	temp; shift divisor right
BCC	.10; loop until all divisors tried
.30
; remainder is in A
</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Completely untested of course. This should work for a mod by any odd number, using the low bit as an end condition. If you shift out and save the two low bits, then shift them back in, you should have a mod 20. You can then use LDX #5*8 instead of LDX #5*32. It might even be possible to completely unroll this:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">	LSRA
ROR temp
LSRA
ROR temp

CMP #5*8
BCS .10
SEC
SBC #5*8
.10
CMP #5*4
BCS .20
SEC
SBC #5*4
.20
CMP #5*2
BCS .30
SEC
SBC #5*2
.30
CMP #5*1
BCS .40
SEC
SBC #5*1
.40
ASL temp
ROLA
ASL temp
ROLA
.50
BNE notdiv20</pre>
<div></div>
<p></p>
<p>Fix the carry flag stuff to work the right way of course.</p>
<p>&#xA0;</p>
<p>If all you need to do is test for divide by 20, then just BCS notdiv20 instead of ROR temp.</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2007-03-13T19:20:23Z" title="03/13/2007 07:20  PM" data-short="12 yr">March 13, 2007</time> by Bruce Tomlin</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__96">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on March 13, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1256189" data-ipsquote-username="Bruce Tomlin" data-cite="Bruce Tomlin" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<p>Here&apos;s a quick mod 5 I just came up with:</p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>Decent approach, though I don&apos;t see the need for temp:</p>
<p></p>
<pre class="ipsCode"> ldx #8
lp:
 cmp #80
 bcc nosub
 sbc #160 ; Note carry set by cmp
 bcs nosub
 adc #80 ; Note carry clear by sbc
nosub:
 asl
 dex
 bne lp
</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__97">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on March 13, 2007</div><div class="mdl-card__supporting-text">
<p>Here&apos;s another interesting approach:</p>
<p></p>
<pre class="ipsCode">; Enter at s0
s4:
 asl
 bcs s4
 beq done_bad
s3:
 asl
 bcs s2
s1:
 asl
 bcs s3
s2:
 asl
 bcc s4
s0:
 asl
 bcs s1
 bne s0
done_good:
</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__98">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on May 21, 2007May 24, 2007</div><div class="mdl-card__supporting-text">
<p><a href="https://en.wikipedia.org/wiki/Arithmetic_shift" rel="external nofollow" original-href="https://en.wikipedia.org/wiki/Arithmetic_shift">Arithmetic Shifts</a></p>
<p>-------------------</p>
<p>&#xA0;</p>
<p>For signed shifting you need to use an arithmetic shift.</p>
<p>&#xA0;</p>
<p>The consensus on how to do a single arithmetic shift right is.</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">  cmp #$80
 ror</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>And here is the code for when you are doing 4 or more bits at once. 4 in this example.</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">  lsr
 lsr
 lsr
 lsr
 clc
 adc #$F8
 eor #$F8</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>For an arithmetic shift left, you can just use ASL but it doesn&apos;t correctly set the overflow flag. If you need to check the overflow flag then use the following code sequence.</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">   clc
  sta temp
  adc temp</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Credits - Lee Davison, TJ</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2007-05-24T17:20:23Z" title="05/24/2007 05:20  PM" data-short="12 yr">May 24, 2007</time> by djmips</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__99">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on May 21, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1301054" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>If you need to check the overflow flag then use the following code sequence.</div></blockquote>
<p>&#xA0;</p>
<p>Or you could do the shift the normal way and then do something like:</p>
<p></p>
<pre class="ipsCode">  bcs  shifted_out_1
 bpl  overflow_nope
overflow_yep:
 ...

shifted_out_1:
 bpl overflow_yep
overflow_nope:</pre>
<div></div>
<p></p>
<p>That takes 5 cycles if no overflow; 4 or 6 cycles if overflow. The accumulator is not disturbed.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__100">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on May 22, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1301054" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>And here is the code for when you are doing more bits at once. 3 in this example.<p></p>
<pre class="ipsCode">  lsr
 lsr
 lsr
 adc #$F0
 eor #$F0</pre>
<div></div>
<p></p>
</div></blockquote>
<p>Cool! <img alt="8)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_cool.gif" show-src="scraper/images/atariage_icon_cool.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__101">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on May 23, 2007</div><div class="mdl-card__supporting-text">
<p>Getting the 2&apos;s complement of the accumulator, rudimentary, but the extra here is two implementations.</p>
<p>&#xA0;</p>
<p>One version uses clc, the other sec so you could save the sec or clc if you know the prior state of the carry flag.</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">;2&apos;s complement x = x ^ $FF + 1
;assumes carry is clear
 eor #$FF
 adc #01

; 2&apos;s complement x = x - 1 ^ $FF  
; assumes carry is set
 sbc #01
 eor #$FF</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__102">
                                                        <div class="mdl-card__title"><strong>Robert MRobert M</strong> posted on May 31, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1255235" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Cool! Here&apos;s another one:<p>&#xA0;</p>
<p>Modulus.</p>
<p>&#xA0;</p>
<p>I need to find n mod 20. Well, to be specific, I need to find if n mod 20 is zero or otherwise.</p>
<p>Here&apos;s how I do it:</p>
<p></p>
<pre class="ipsCode">   lda n
  sec
Loop
  sbc #20
  bcc Remainder
  bne Loop
;--remainder is zero</pre>
<div></div>
<p></p>
<p>Which is slow. Is there a better way?</p>
</div></blockquote>
<p>&#xA0;</p>
<p>&#xA0;</p>
<p>That division by 5 is nasty for optimization. Instead I recommend dividing by 40 so that the average number of times through the loop is cut in half plus 1 add instruction. Its slower for some cases, but I estimate about 45% faster on average. </p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">Modulo20
 ; input: A = the unsigned number to test (0 to 255)
  tax ; Need to set Z-flag for special case that A is already 0.  ( your original code did not do this so it may not be important.)
  sec
loop
  beq done
  sbc #40
  bcs loop
 ; C = 0
  adc #20
done
 ; Z = 1 if the input number was a multiple of 20.
 ; X = the original number
 ; A = garbage.</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__103">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on May 31, 2007</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>That division by 5 is nasty for optimization. Instead I recommend dividing by 40 so that the average number of times through the loop is cut in half plus 1 add instruction. Its slower for some cases, but I estimate about 45% faster on average.</div></blockquote>
<p>&#xA0;</p>
<p>How about something like:</p>
<p></p>
<pre class="ipsCode">  sec
u160: ; Test 160 from above
 sbc #160
 bcc b80
u80:
 sbc #80
 bcc b40
u40:
 sbc #40
 bcc b20
u20:
 sbc #20
 bcc bzero
done:
 rts
b80: ; Test 80 from below
 adc #80
 bcs u40
b40:
 adc #40
 bcs u20
b20:
 adc #20
 bcs done
bzero:
 adc #20
 rts</pre>
<div></div>
<p></p>
<p>That should take 10 cycles for adc/sbc&apos;s, 8-12 for branches, and six for the RTS.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__104">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on January 23, 2008</div><div class="mdl-card__supporting-text">
<p>Anyone have a killer hack for 8.8 multiplication? </p>
<p>I need to do 8.8 * 8.8 and have the result be 8.8.</p>
<p>&#xA0;</p>
<p>I know that the integer part of the result will not exceed 8 bits and I don&apos;t need a 16-bit remainder.</p>
<p>&#xA0;</p>
<p>What I&apos;ve got is this:</p>
<p></p>
<pre class="ipsCode">  ; a.b * c.d = e.fg
  lda #0
  sta e
  sta f
  sta g
  ldx a
  ldy b
  clc
MultiplyLoop
  lda g
  adc d
  sta g
  lda f
  adc d
  sta f
  lda e
  adc #0
  sta e
  dey
  bne MultiplyLoop
  dex
  bne MultiplyLoop
 ;result in e.fg ... ignore g to get e.f as 8.8 result</pre>
<div></div>
<p></p>
<p>(This ignores some zero cases.)</p>
<p>The main problem is that this is slower than dirt.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__105">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on January 23, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451251" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Anyone have a killer hack for 8.8 multiplication? <p>I need to do 8.8 * 8.8 and have the result be 8.8.</p>
</div></blockquote>
<p>How much space do you have? </p>
<p>&#xA0;</p>
<p>Check this link: <a href="scraper/files/c=hacking9.txt" rel="external nofollow" original-href="http://www.ffd2.com/fridge/chacking/c=hacking9.txt">http://www.ffd2.com/fridge/chacking/c=hacking9.txt</a></p>
<p>&#xA0;</p>
<p>This is one of my all time favourites. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__106">
                                                        <div class="mdl-card__title"><strong>CybergothCybergoth</strong> posted on January 23, 2008</div><div class="mdl-card__supporting-text">
<p>C= Hacking was brilliant, too bad it&apos;s been a few years already since the last issue. Still joping for its return <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__107">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on January 23, 2008January 23, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451276" data-ipsquote-username="Thomas Jentzsch" data-cite="Thomas Jentzsch" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451251" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Anyone have a killer hack for 8.8 multiplication? <p>I need to do 8.8 * 8.8 and have the result be 8.8.</p>
</div></blockquote>
<p>How much space do you have? </p>
<p>&#xA0;</p>
<p>Check this link: <a href="scraper/files/c=hacking9.txt" rel="external nofollow" original-href="http://www.ffd2.com/fridge/chacking/c=hacking9.txt">http://www.ffd2.com/fridge/chacking/c=hacking9.txt</a></p>
<p>&#xA0;</p>
<p>This is one of my all time favourites. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<p></p>
</div></blockquote>
<p>Do you mean the f(x) = (x^2)/4 method?</p>
<p>&#xA0;</p>
<p>That requires a table of squares, which is fine for 8 bits, but how do I translate that to 16 bits? The table I would need is enormous! I don&apos;t have that much space. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2008-01-23T23:06:40Z" title="01/23/2008 11:06  PM" data-short="11 yr">January 23, 2008</time> by vdub_bobby</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__108">
                                                        <div class="mdl-card__title"><strong>Ben_LarsonBen_Larson</strong> posted on January 23, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Anyone have a killer hack for 8.8 multiplication? <p>I need to do 8.8 * 8.8 and have the result be 8.8.</p>
</div></blockquote>
<p>&#xA0;</p>
<p>well if you&apos;re using fixed point notation, then 8.8 is the same as 16.0, right? I mean, it&apos;s just a matter of how you interpret it. with that said I think you could use this method (scroll down to &apos;Binary Multiplication&apos;):</p>
<p>&#xA0;</p>
<p><a href="http://www.atariarchives.org/roots/chapter_10.php" rel="external nofollow" original-href="http://www.atariarchives.org/roots/chapter_10.php">http://www.atariarchives.org/roots/chapter_10.php</a></p>
<p>&#xA0;</p>
<p>Basically the algorithm is long multiplication like you&apos;d do by hand, except in binary form.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__109">
                                                        <div class="mdl-card__title"><strong>supercatsupercat</strong> posted on January 24, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451363" data-ipsquote-username="Ben_Larson" data-cite="Ben_Larson" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>(scroll down to &apos;Binary Multiplication&apos;):</div></blockquote>
<p>&#xA0;</p>
<p>Three useful optimizations I would suggest:</p>
<p>&#xA0;</p>
<p></p>
<ul>
<li>Subtract 1 from the multiplicand stored in memory, to eliminate the in-loop CLC.<br>
</li>
<li>Store the other multiplicand into the product low byte location. In that way, the ROR that stores the product low bits can also sample the next bit of the multiplicand.<br>
</li>
<li>If code space permits, unroll the loop at least somewhat. Unrolling 2x will save about twenty cycles.<br>
</li>
</ul>
<p></p>
<p>Such approaches still won&apos;t be as fast as the table-lookup approach, but they&apos;ll be pretty good.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__110">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on January 24, 2008January 24, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451337" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Do you mean the f(x) = (x^2)/4 method?<p>&#xA0;</p>
<p>That requires a table of squares, which is fine for 8 bits, but how do I translate that to 16 bits? The table I would need is enormous! I don&apos;t have that much space. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
</div></blockquote>
<p>No, you only require those 8 bit tables. I did this back in the 80ies with my C64. IIRC I did use 5 256 bytes tables (some were used just to save a few cycles) for 32 bit FP math (Mandelbrot).</p>
<p>&#xA0;</p>
<p>Let&apos;s see if I can remember it...</p>
<p>&#xA0;</p>
<p>A8:8*B8:8 = A8:0*B8:0 + 2*A8:0*B0:8 + 2*A0:8*B8:0 + A0:8*B:08</p>
<p>&#xA0;</p>
<p>So everything is reduced to 8 (or 9) bits. You can get away with just one 256 bytes table. Or you can do extra tables for the 9 bit results to save a few extra cycles.</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2008-01-24T17:38:47Z" title="01/24/2008 05:38  PM" data-short="11 yr">January 24, 2008</time> by Thomas Jentzsch</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__111">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on January 24, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451775" data-ipsquote-username="Thomas Jentzsch" data-cite="Thomas Jentzsch" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>No, you only require those 8 bit tables. I did this back in the 80ies with my C64. IIRC I did use 5 256 bytes tables (some were used just to save a few cycles) for 32 bit FP math (Mandelbrot).<p>&#xA0;</p>
<p>Let&apos;s see if I can remember it...</p>
<p>&#xA0;</p>
<p>A8:8*B8:8 = A8:0*B8:0 + 2*A8:0*B0:8 + 2*A0:8*B8:0 + A0:8*B:08</p>
<p>&#xA0;</p>
<p>So everything is reduced to 8 (or 9) bits. You can get away with just one 256 bytes table. Or you can do extra tables for the 9 bit results to save a few extra cycles.</p>
</div></blockquote>
<p>Thanks. </p>
<p>&#xA0;</p>
<p>It turns out what I really need is A0:8 * B8:8 and I don&apos;t need the least-significant byte.</p>
<p>&#xA0;</p>
<p>So I think I can do this...</p>
<p>A0:8 * B0:8 + 256*(A0:8 * B8:0)</p>
<p>and then just throw away the bottom byte. </p>
<p>&#xA0;</p>
<p>My next question!</p>
<p>&#xA0;</p>
<p>You need a table of the values (x^2)/4 for x=0 to 255. But what happens when (x^2)/4 &gt; 255? I.e., for x&gt;31? Don&apos;t you need two tables, one for the lower byte and one for the upper byte. </p>
<p>&#xA0;</p>
<p>And don&apos;t your tables need to be ~512 bytes long, for when x+y&gt;255? Since xy=f(x+y)-f(x-y)</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__112">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on January 24, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451813" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>A0:8 * B0:8 + 256*(A0:8 * B8:0)<p>and then just throw away the bottom byte.</p>
</div></blockquote>
<p>You have to double A0:8 * B8:0</p>
<p>&#xA0;</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>You need a table of the values (x^2)/4 for x=0 to 255. But what happens when (x^2)/4 &gt; 255? I.e., for x&gt;31? Don&apos;t you need two tables, one for the lower byte and one for the upper byte.</div></blockquote>
<p>Sure, 2 tables here. We are getting close to the 5 tables I remember. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<p>&#xA0;</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>And don&apos;t your tables need to be ~512 bytes long, for when x+y&gt;255? Since xy=f(x+y)-f(x-y)</div></blockquote>
<p>That would be another 2 tables, yes. Unless I miss something. <img alt=":ponder:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_ponder.gif" show-src="scraper/images/atariage_icon_ponder.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__113">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on January 24, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451817" data-ipsquote-username="Thomas Jentzsch" data-cite="Thomas Jentzsch" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451813" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>A0:8 * B0:8 + 256*(A0:8 * B8:0)<p>and then just throw away the bottom byte.</p>
</div></blockquote>
<p>You have to double A0:8 * B8:0</p>
</div></blockquote>
<p>Nah, slightly different algorithm, I think.</p>
<p>&#xA0;</p>
<p>Use base-10, let each letter be a digit: a * bc = a * ( ( 10 * b ) + c ) = 10 * a * b + a * c</p>
<p>&#xA0;</p>
<p>Same thing, only where each &quot;digit&quot; is an 8-bit number, the base is 256.</p>
<p>So a * bc = a * ( ( 256 * b ) + c ) = 256 * a * b + a * c</p>
<p>&#xA0;</p>
<p>In other words, I drop the &quot;place&quot; value of each digit and then add it back in at the end, kinda like when you do multiplication on paper:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">	 a b
  * c d
  ------
  ad bd
ac bc
--------</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Using a lot of large tables, I think I can get my A0:8 * B8:8 multiplication, throwing away the bottom byte of the result, in 77 cycles:</p>
<p></p>
<pre class="ipsCode">  ;--a * b:c
  lda a
  sta IntPtrPlus
  sta FractPtrPlus
  sta IntPtrMinus
  sta FractPtrMinus   ;four tables so I don&apos;t have to figure -c
  ldy c
  lda (IntPtrPlus),Y
  sec
  sbc (IntPtrMinus),Y
  sta ResultInt1
 ;--don&apos;t care about bottom byte of a * c since I&apos;ll drop it anyway
  ldy b
  lda (IntPtrPlus),Y
  sec
  sbc (IntPtrMinus),Y
  sta ResultInt2
  lda (FractPtrPlus),Y
  sbc (FractPtrMinus),Y
  clc
  adc ResultInt1
  sta ResultInt1
  lda ResultInt2
  adc #0
  sta ResultInt2</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>I *think* that will work...</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__114">
                                                        <div class="mdl-card__title"><strong>Robert MRobert M</strong> posted on January 24, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451251" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Anyone have a killer hack for 8.8 multiplication? <p>I need to do 8.8 * 8.8 and have the result be 8.8.</p>
<p>&#xA0;</p>
<p><strong>I know that the integer part of the result will not exceed 8 bits and I don&apos;t need a 16-bit remainder.</strong></p>
</div></blockquote>
<p>&#xA0;</p>
<p>So is this really a 4.8 * 4.8 multiply, or you can just guarantee that if the one value is bigger than 12 bits, then the other will be sufficiently small to prevent an 8-bit overflow?</p>
<p>&#xA0;</p>
<p>&#xA0;</p>
<p>If it is really just 4.8 * 4.8 and you are discarding the fraction, then you can just do 4.4 * 4.4. Because the lower 4 bits of the fractions can never effect the integer portion of the result. 4.4 * 4.4 is just a bit shifted 8*8. I think that will simplify things. <img alt=";)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_wink.gif" show-src="scraper/images/atariage_icon_wink.gif"> </p>
<p>&#xA0;</p>
<p>Cheers!</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__115">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on January 24, 2008January 24, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451861" data-ipsquote-username="Robert M" data-cite="Robert M" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>So is this really a 4.8 * 4.8 multiply, or you can just guarantee that if the one value is bigger than 12 bits, then the other will be sufficiently small to prevent an 8-bit overflow?<p>&#xA0;</p>
<p>&#xA0;</p>
<p>If it is really just 4.8 * 4.8 and you are discarding the fraction, then you can just do 4.4 * 4.4. Because the lower 4 bits of the fractions can never effect the integer portion of the result. 4.4 * 4.4 is just a bit shifted 8*8. I think that will simplify things. <img alt=";)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_wink.gif" show-src="scraper/images/atariage_icon_wink.gif"></p>
</div></blockquote>
<p>If you scroll/read down a bit, you&apos;ll see that it is really 0.8 * 8.8 and I want an 8.8 result. And I wrote a ~ 1-scanline multiply routine, just waiting for someone to tell me (a) how to make it faster or (b) how it won&apos;t work. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2008-01-24T21:53:38Z" title="01/24/2008 09:53  PM" data-short="11 yr">January 24, 2008</time> by vdub_bobby</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__116">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on January 24, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451833" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Nah, slightly different algorithm, I think.</div></blockquote>
<p>You are right. My mistake.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__117">
                                                        <div class="mdl-card__title"><strong>Robert MRobert M</strong> posted on January 24, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451874" data-ipsquote-username="vdub_bobby" data-cite="vdub_bobby" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451861" data-ipsquote-username="Robert M" data-cite="Robert M" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>So is this really a 4.8 * 4.8 multiply, or you can just guarantee that if the one value is bigger than 12 bits, then the other will be sufficiently small to prevent an 8-bit overflow?<p>&#xA0;</p>
<p>&#xA0;</p>
<p>If it is really just 4.8 * 4.8 and you are discarding the fraction, then you can just do 4.4 * 4.4. Because the lower 4 bits of the fractions can never effect the integer portion of the result. 4.4 * 4.4 is just a bit shifted 8*8. I think that will simplify things. <img alt=";)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_wink.gif" show-src="scraper/images/atariage_icon_wink.gif"></p>
</div></blockquote>
<p>If you scroll/read down a bit, you&apos;ll see that it is really 0.8 * 8.8 and I want an 8.8 result. And I wrote a ~ 1-scanline multiply routine, just waiting for someone to tell me (a) how to make it faster or (b) how it won&apos;t work. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>&#xA0;</p>
<p>Since you are thowing away the bottom byte of the 8.16 result, doesn&apos;t the problem reduce to 0.4 * 8.4, and you can just use a lookup table with the 16 possible 8.8 results? Or is my thinking all screwy on this?</p>
<p>&#xA0;</p>
<p>Cheers!</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__118">
                                                        <div class="mdl-card__title"><strong>Robert MRobert M</strong> posted on January 24, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451889" data-ipsquote-username="Robert M" data-cite="Robert M" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Since you are thowing away the bottom byte of the 8.16 result, doesn&apos;t the problem reduce to 0.4 * 8.4, and you can just use a lookup table with the 16 possible 8.8 results? Or is my thinking all screwy on this?<p>&#xA0;</p>
<p>Cheers!</p>
</div></blockquote>
<p>&#xA0;</p>
<p>My thinking is screwy. The table won&apos;t work, but the reduction to 0.4 * 8.8 is still correct I think. <img alt=":ponder:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_ponder.gif" show-src="scraper/images/atariage_icon_ponder.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__119">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on January 24, 2008January 24, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451900" data-ipsquote-username="Robert M" data-cite="Robert M" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451889" data-ipsquote-username="Robert M" data-cite="Robert M" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Since you are thowing away the bottom byte of the 8.16 result, doesn&apos;t the problem reduce to 0.4 * 8.4, and you can just use a lookup table with the 16 possible 8.8 results? Or is my thinking all screwy on this?<p>&#xA0;</p>
<p>Cheers!</p>
</div></blockquote>
<p>&#xA0;</p>
<p>My thinking is screwy. The table won&apos;t work, but the reduction to 0.4 * 8.8 is still correct I think. <img alt=":ponder:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_ponder.gif" show-src="scraper/images/atariage_icon_ponder.gif"></p>
<p></p>
</div></blockquote>
<p>I&apos;m not sure if that is correct or not...it doesn&apos;t seem like it to me, but I have to think for a long time to wrap my head around these things <img alt=":lol:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_lol.gif" show-src="scraper/images/atariage_icon_lol.gif"></p>
<p>&#xA0;</p>
<p>But in any case, I don&apos;t think it will help my current routine, other than reducing the size of my tables, since multiplying a nibble by a byte will be the same as multiplying a byte by a byte. Or...<img alt=":ponder:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_ponder.gif" show-src="scraper/images/atariage_icon_ponder.gif"></p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2008-01-24T22:16:43Z" title="01/24/2008 10:16  PM" data-short="11 yr">January 24, 2008</time> by vdub_bobby</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__120">
                                                        <div class="mdl-card__title"><strong>Robert MRobert M</strong> posted on January 24, 2008</div><div class="mdl-card__supporting-text">
<p>Okay, I did a spreadsheet in Excel to prove this to myself. </p>
<p>&#xA0;</p>
<p>0.8 * 8.8 = 8.16</p>
<p>&#xA0;</p>
<p>but we are throwing the lower 8 bits of the answer away which makes the problem this:</p>
<p>&#xA0;</p>
<p>0.8 * 8.8 = 8.16 / 256</p>
<p>&#xA0;</p>
<p>We want to move the division by 256 to the left side of the equation, which because it is applied after the multiplication we must take the square root of 256. That is 16, so:</p>
<p>&#xA0;</p>
<p>(0.8 / 16) * (8.8 / 16) = 8.16 / 256 [Excel says I am right <img alt=":ponder:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_ponder.gif" show-src="scraper/images/atariage_icon_ponder.gif"> ] </p>
<p>&#xA0;</p>
<p>So the problem reduces to:</p>
<p>&#xA0;</p>
<p>0.4 * 8.4 = 8.8 </p>
<p>&#xA0;</p>
<p>I don&apos;t know if that makes the code easier, but it should get the same answer as the original (0.8 * 8.8)/256 minus a small rounding error.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__121">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on January 24, 2008January 24, 2008</div><div class="mdl-card__supporting-text">
<p>Hmmm. Have to think about that...</p>
<p>&#xA0;</p>
<p>EDIT: I&apos;m not exactly following this. Doesn&apos;t 8.16 / 256 = 0.24 ?</p>
<p>&#xA0;</p>
<p>EDIT: Actually, more generally, I think I follow your argument - but what <em>is</em> that rounding error? How big is it?</p>
<p>&#xA0;</p>
<p>After all, 2.95 * 0.73 = 2.1535</p>
<p>If you throw away the bottom two digits, you get 2.15 which is within 1/2% of the true answer.</p>
<p>But if you truncate before multiplying you get 2.03, which is over 5% away from the actual answer.</p>
<p>&#xA0;</p>
<p>And the difference would be larger for truncating 4 bits, so I dunno...a pre-truncating routine would have to be smoking fast to be worth the error, I think. <img alt=":ponder:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_ponder.gif" show-src="scraper/images/atariage_icon_ponder.gif"></p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2008-01-24T23:12:03Z" title="01/24/2008 11:12  PM" data-short="11 yr">January 24, 2008</time> by vdub_bobby</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__122">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on January 24, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451915" data-ipsquote-username="Robert M" data-cite="Robert M" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>0.4 * 8.4 = 8.8</div></blockquote>
<p>Or e.g. 0.2 * 8.6? <img alt=":ponder:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_ponder.gif" show-src="scraper/images/atariage_icon_ponder.gif"></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__123">
                                                        <div class="mdl-card__title"><strong>Robert MRobert M</strong> posted on January 25, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451938" data-ipsquote-username="Thomas Jentzsch" data-cite="Thomas Jentzsch" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1451915" data-ipsquote-username="Robert M" data-cite="Robert M" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>0.4 * 8.4 = 8.8</div></blockquote>
<p>Or e.g. 0.2 * 8.6? <img alt=":ponder:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_ponder.gif" show-src="scraper/images/atariage_icon_ponder.gif"></p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>&#xA0;</p>
<p>&#xA0;</p>
<p>Okay my shorthand was too short <img alt=";)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_wink.gif" show-src="scraper/images/atariage_icon_wink.gif"> </p>
<p>&#xA0;</p>
<p>8.8 means 8 bits integer and 8 bits fraction. </p>
<p>&#xA0;</p>
<p>so the original equation was ([0].[8] * [8].[8]) &gt;&gt; 8 , where &gt;&gt; 8 is the same as /256</p>
<p>&#xA0;</p>
<p>I am saying you can divide the arguments before you multiply and get the same answer with less multiplying and the same amount of dividing.</p>
<p>&#xA0;</p>
<p>(([0].[8] &gt;&gt; 4) * ([8].[8] &gt;&gt; 4)) == ([0].[8] * [8].[8]) &gt;&gt; 8</p>
<p>&#xA0;</p>
<p>The original equation on the right is easier to round after the divide by bitshift since you can just add the .5 in the carry back into the answer.</p>
<p>The new equation has two shifts and you would need to remember the carry from both and round up the answer by one only if both were set.</p>
<p>The equation on the left after the shift is a nybble * 12 bits which I think should be easier than a byte times 16 bits. Just the rounding gets </p>
<p>tougher. I will try to come up with some code shortly.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__124">
                                                        <div class="mdl-card__title"><strong>Hornpipe2Hornpipe2</strong> posted on April 11, 2008</div><div class="mdl-card__supporting-text">
<p>I personally like to use BRANCH instructions instead of JMP wherever possible. It saves a byte of ROM each time, and the cycle cost is the same. There are so many branch instructions you can usually find one that will execute 100% of the time for your given application.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__125">
                                                        <div class="mdl-card__title"><strong>johncljohncl</strong> posted on December 29, 2008December 29, 2008</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="872999" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>I like that version, nice use of LAX, but you gotta be brave and not use the temp <img alt=";)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_wink.gif" show-src="scraper/images/atariage_icon_wink.gif"> <p>&#xA0;</p>
<p></p>
<pre class="ipsCode"> &#xA0; &#xA0;LAX word
&#xA0; &#xA0;INX
&#xA0; &#xA0;AND #$F0
&#xA0; &#xA0;STA word
&#xA0; &#xA0;TXA
&#xA0; &#xA0;AND #$0F
&#xA0; &#xA0;ORA word
&#xA0; &#xA0;STA word</pre>
<div></div>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>A late reply to the starting hack of this thread. If you got a free byte of memory space and you could initialise that before the loop this should be faster:</p>
<p>&#xA0;</p>
<p>At an init stage store the top 4 bits in a variable:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">lda word
and #$f0
sta hi</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>And in your loop when you are iterating and need the wraparound increment on lower 4 bits:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">ldx word ; 3
inx	  ; 2
txa	  ; 2
and #$0f ; 2
ora hi; 3
sta word ; 3</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Uses a total of 15 cycles, 4 less than the one quoted assuming word and hi are in zero page. <img alt=":)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_smile.gif" show-src="scraper/images/atariage_icon_smile.gif"></p>
<p>&#xA0;</p>
<p>Well, if you can assume that your &quot;word&quot; variable bit 4 is always zero (so counter starts from one of $00,$20,$40,$60,$80,$a0,$c0,$e0) you could do this also:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">ldx word; 3
inx	 ; 2
txa	 ; 2
and #$ef; 2
sta word; 2</pre>
<div></div>
<p></p>
<p>&#xA0;</p>
<p>Which is only 11 cycles! <img alt=":P" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_razz.gif" show-src="scraper/images/atariage_icon_razz.gif"></p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2008-12-29T13:46:18Z" title="12/29/2008 01:46  PM" data-short="10 yr">December 29, 2008</time> by johncl</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__126">
                                                        <div class="mdl-card__title"><strong>bogaxbogax</strong> posted on February 24, 2009</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="872906" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>As I was growing up, I kept a notebook full of cool code snippets and ideas. My notebook had been misplaced but I ran across it recently and here is one of the pages which is from a 1987 Dr. Dobbs article by Mark S. Ackerman. &quot;6502 Killer Hacks&quot;.<p>&#xA0;</p>
<p><span style="color:#FF0000;">Post your own 6502 Killer Hacks and share them with the rest of us!</span></p>
<p>.</p>
<p>.</p>
<p>.</p>
<p>Well here is the killer hack. This one is to scrimp on RAM.</p>
<p>&#xA0;</p>
<p>Incrementing only the lower 4 bits of a byte (with wrap)</p>
<p>.</p>
<p>.</p>
<p>.</p>
<p> - David</p>
</div></blockquote>
<p>&#xA0;</p>
<p> Just joined these forums so sorry if I&apos;m a little late to this party <img alt=";)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_wink.gif" show-src="scraper/images/atariage_icon_wink.gif"></p>
<p>&#xA0;</p>
<p> Here&apos;s a couple of my favorites</p>
<p>&#xA0;</p>
<p> First the counter</p>
<p>&#xA0;</p>
<p> eor something with its self you get 0</p>
<p> eor something with 0 you get its self</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode"> lda counter
inc counter
eor counter
and #$F0
eor counter
sta counter</pre>
<div></div>
<p></p>
<p> Of course you can insert bits from one byte into another</p>
<p> byte (not just from a changed version of itself) </p>
<p> Used eg for setting pixels </p>
<p>&#xA0;</p>
<p>=========</p>
<p>&#xA0;</p>
<p> Parity is just an xoring of bits</p>
<p>&#xA0;</p>
<p> A simple sum is just an xoring of bits</p>
<p>&#xA0;</p>
<p> 0+0=0</p>
<p> 0+1=1</p>
<p> 1+0=1</p>
<p> 1+1=0</p>
<p>&#xA0;</p>
<p> Disregarding the carry obviously</p>
<p>&#xA0;</p>
<p> Carry is a way of propagating bits across a byte (sort of)</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">   000a
 +0111
 =a???</pre>
<div></div>
<p></p>
<p> We can combine the two to get parity and collect &quot;bits&quot; across a byte</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">;parity of A

sta temp
asl
eor temp
and #b10101010
adc #b01100110
and #b10001000
adc #b01111000
;now the parity is in the sign bit</pre>
<div></div>
<p> </p>
<p>=========</p>
<p>&#xA0;</p>
<p> Already posted this to a different thread</p>
<p>&#xA0;</p>
<p> Rotate two bits left through the carry</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode"> asl
adc #$80
rol</pre>
<div></div>
<p></p>
<p>Do it twice to swap nibbles</p>
<p>&#xA0;</p>
<p>============</p>
<p>&#xA0;</p>
<p> Kernigans method for counting set bits in a byte</p>
<p>&#xA0;</p>
<p> This code lifted directly from dclxvi in the 6502.org</p>
<p> programming forum</p>
<p>&#xA0;</p>
<p> <a href="http://forum.6502.org/viewtopic.php?p=6993&amp;highlight=#6993" rel="external nofollow" original-href="http://forum.6502.org/viewtopic.php?p=6993&amp;highlight=#6993">http://forum.6502.org/viewtopic.php?p=6993...highlight=#6993</a></p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">   TAX 
  BEQ L2 
  LDX #0 
  SEC 
L1 INX 
  STA SCRATCH 
  SBC #1 
  AND SCRATCH 
  BNE L1 
  TXA 
L2 RTS</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__127">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on February 24, 2009February 24, 2009</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1689548" data-ipsquote-username="bogax" data-cite="bogax" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>Kernigans method for counting set bits in a byte<p>&#xA0;</p>
<p> This code lifted directly from dclxvi in the 6502.org</p>
<p> programming forum</p>
<p>&#xA0;</p>
<p> <a href="http://forum.6502.org/viewtopic.php?p=6993&amp;highlight=#6993" rel="external nofollow" original-href="http://forum.6502.org/viewtopic.php?p=6993&amp;highlight=#6993">http://forum.6502.org/viewtopic.php?p=6993...highlight=#6993</a></p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">   TAX 
  BEQ L2 
  LDX #0 
  SEC 
L1 INX 
  STA SCRATCH 
  SBC #1 
  AND SCRATCH 
  BNE L1 
  TXA 
L2 RTS</pre>
<div></div>
<p></p>
</div></blockquote>
<p>A simple shifting approach is more efficient in terms of size (and in many cases, cycles) than any other routine I saw on that thread.</p>
<p>&#xA0;</p>
<p>They all start with the value passed in the accumulator and return the accumulator, so I&apos;ll do the same:</p>
<p></p>
<pre class="ipsCode">  sta temp
 lda #0
loop
 asl temp
 beq done
 adc #0
 bcc loop
done</pre>
<div></div>
<p></p>
<p>I&apos;m sure this can be improved somehow.</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2009-02-24T07:56:31Z" title="02/24/2009 07:56  AM" data-short="10 yr">February 24, 2009</time> by batari</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__128">
                                                        <div class="mdl-card__title"><strong>Nukey ShayNukey Shay</strong> posted on February 24, 2009</div><div class="mdl-card__supporting-text">
<p>How about this?</p>
<p>A bit smaller using the X register to count:</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode">;A=byte value
  ldx #-1
Bump_Count
  inx
Next_Bit
  lsr
  bcs Bump_Count
  bne Next_Bit
;X=number of set bits, A=0</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__129">
                                                        <div class="mdl-card__title"><strong>Nukey ShayNukey Shay</strong> posted on February 24, 2009</div><div class="mdl-card__supporting-text">
<p><img alt=":ponder:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_ponder.gif" show-src="scraper/images/atariage_icon_ponder.gif"></p>
<p>&#xA0;</p>
<p>Maybe precede the LSR with CLC, but it&apos;s still smaller.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__130">
                                                        <div class="mdl-card__title"><strong>+bataribatari</strong> posted on February 24, 2009</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1689583" data-ipsquote-username="Nukey Shay" data-cite="Nukey Shay" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<img alt=":ponder:" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_ponder.gif" show-src="scraper/images/atariage_icon_ponder.gif"><p>&#xA0;</p>
<p>Maybe precede the LSR with CLC, but it&apos;s still smaller.</p>
</div></blockquote>
<p>Why would you need to do that?</p>
<p>&#xA0;</p>
<p>But anyway, this further proves my point that the code linked in the thread above isn&apos;t ideal in terms of size and (with the probable exception of the 256-byte table) cycles.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__131">
                                                        <div class="mdl-card__title"><strong>bogaxbogax</strong> posted on February 24, 2009</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1689561" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>A simple shifting approach is more efficient in terms of size (and in many cases, cycles) than any other routine I saw on that thread.</div></blockquote>
<p> Yes</p>
<p> I just think it&apos;s a clever hack (OK, so it&apos;s not a killer hack..)</p>
<p> I presume it was originally in C</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__132">
                                                        <div class="mdl-card__title"><strong>grafixbmpgrafixbmp</strong> posted on March 2, 2009</div><div class="mdl-card__supporting-text">
<p>Anyone have a slick hack for taking a byte and separate 5 bits on one side and the other 3 bits as well?</p>
<p>&#xA0;</p>
<p> I saw where some were talking about swaping nibbles. This is also usefull for taking 11111111 and producing 00001111 and 11110000 but shifting it down to be 00001111.</p>
<p>&#xA0;</p>
<p> The the 5 /3 one would be like taking 11111111 and producing 00011111 and 00000111 out of it with minimal cycles used.</p>
<p>&#xA0;</p>
<p>just curious.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__133">
                                                        <div class="mdl-card__title"><strong>Nukey ShayNukey Shay</strong> posted on March 2, 2009</div><div class="mdl-card__supporting-text">
<p>5 bits? Is this for audio frequency? If so, are you aware that the upper 3 bits are irrelivant for these registers? Likewise, the upper 4 bits are irrelivant for distortion and volume registers.</p>
<p>&#xA0;</p>
<p>So you could use the original merged value to update frequency, then drop the upper 3 bits down (5xLSR) for one of the other registers.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__134">
                                                        <div class="mdl-card__title"><strong>grafixbmpgrafixbmp</strong> posted on March 2, 2009March 2, 2009</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1694113" data-ipsquote-username="Nukey Shay" data-cite="Nukey Shay" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>5 bits? Is this for audio frequency? If so, are you aware that the upper 3 bits are irrelivant for these registers? Likewise, the upper 4 bits are irrelivant for distortion and volume registers.<p>&#xA0;</p>
<p>So you could use the original merged value to update frequency, then drop the upper 3 bits down (5xLSR) for one of the other registers.</p>
</div></blockquote>
<p>Yes. but I was more intrested in getting thoes last 3 bits ready ASAP for audio control. The other byte is used for sustain and rest duration. This is how long the volume is held and how long it is off. I was going to organize thoes 3 bits to cover the most usable distortion settings on the audio control register.</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2009-03-02T20:58:30Z" title="03/02/2009 08:58  PM" data-short="10 yr">March 2, 2009</time> by grafixbmp</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__135">
                                                        <div class="mdl-card__title"><strong>+SpiceWareSpiceWare</strong> posted on March 2, 2009</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1694113" data-ipsquote-username="Nukey Shay" data-cite="Nukey Shay" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>drop the upper 3 bits down (5xLSR) for one of the other registers.</div></blockquote>
<p>4 ROLs</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__136">
                                                        <div class="mdl-card__title"><strong>Nukey ShayNukey Shay</strong> posted on March 2, 2009</div><div class="mdl-card__supporting-text">
<p>List &apos;em first. %sssssccc. It&apos;s only 2 cycles to AND off the upper bits...and by using LAX, you don&apos;t need to reload (the original value is still in X).</p>
<p>&#xA0;</p>
<p>LAX tablevalue</p>
<p>AND #7</p>
<p>STA AUDCn</p>
<p>TXA</p>
<p>LSR</p>
<p>LSR</p>
<p>LSR</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__137">
                                                        <div class="mdl-card__title"><strong>grafixbmpgrafixbmp</strong> posted on March 2, 2009</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1694369" data-ipsquote-username="Nukey Shay" data-cite="Nukey Shay" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>List &apos;em first. %sssssccc. It&apos;s only 2 cycles to AND off the upper bits...and by using LAX, you don&apos;t need to reload (the original value is still in X).<p>&#xA0;</p>
<p>LAX tablevalue</p>
<p>AND #7</p>
<p>STA AUDCn</p>
<p>TXA</p>
<p>LSR</p>
<p>LSR</p>
<p>LSR</p>
</div></blockquote>
<p>&#xA0;</p>
<p>How quick then would it be to do the others from X? Remove the low 3 bits and shift down. Or somehow keep the carry at 0 while ROR 3 times</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__138">
                                                        <div class="mdl-card__title"><strong>foxfox</strong> posted on March 31, 2009</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1071314" data-ipsquote-username="batari" data-cite="batari" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>After research, I came up with something really short (17 bytes)<p></p>
<pre class="ipsCode">; Binary in A

  sed
  sta temp1
  lda #0
  ldx #8
loop
  asl temp1
  sta temp2
  adc temp2
  dex
  bne loop
  cld

; BCD in A</pre>
<div></div>
<p></p>
<p>What&apos;s cool about this one is that it actually will do 8-bit binary -&gt; 9-bit BCD, with the 9th bit contained in the carry! Can this be improved any more, though?</p>
</div></blockquote>
<p>&#xA0;</p>
<p>Faster, one byte shorter and not using X:</p>
<p></p>
<pre class="ipsCode">	sec
rol	@
sta	bin
lda	#0
sed
do_bit
sta	bcd
adc	bcd
asl	bin
bne	do_bit
cld</pre>
<div></div>
<p></p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__139">
                                                        <div class="mdl-card__title"><strong>vdub_bobbyvdub_bobby</strong> posted on March 3, 2011</div><div class="mdl-card__supporting-text">
<p>Just saw this today:</p>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<strong>Average of Integers</strong><p>This is actually an extension of the &quot;well known&quot; fact that for binary integer values x and y, (x+y) equals ((x&amp;y)+(x|y)) equals ((x^y)+2*(x&amp;y)).</p>
<p>&#xA0;</p>
<p>Given two integer values x and y, the (floor of the) average normally would be computed by (x+y)/2; unfortunately, this can yield incorrect results due to overflow. A very sneaky alternative is to use (x&amp;y)+((x^y)/2). If we are aware of the potential non-portability due to the fact that C does not specify if shifts are signed, this can be simplified to (x&amp;y)+((x^y)&gt;&gt;1). In either case, the benefit is that this code sequence cannot overflow. </p>
</div></blockquote>
<p><a href="http://aggregate.ee.engr.uky.edu/MAGIC/#Average%20of%20Integers" rel="external nofollow" original-href="http://aggregate.ee.engr.uky.edu/MAGIC/#Average%20of%20Integers">http://aggregate.ee.engr.uky.edu/MAGIC/#Average%20of%20Integers</a></p>
<p>&#xA0;</p>
<p>In 6502 assembly:</p>
<p></p>
<pre class="ipsCode">lda a
and b
sta temp

lda a
eor b
lsr
clc
adc temp</pre>
<div></div>
<p></p>
<p>Next question: extend to more than 2 integers, and is it possible to do without temp RAM?</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__140">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on March 3, 2011</div><div class="mdl-card__supporting-text">
<p>Why not</p>
<p></p>
<pre class="ipsCode">  clc
 lda a 
 adc b
 ror</pre>
<div></div>
<p>?</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__141">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on March 4, 2011March 4, 2011</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="1689548" data-ipsquote-username="bogax" data-cite="bogax" data-ipsquote-timestamp="1235458816" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="872906" data-ipsquote-username="djmips" data-cite="djmips" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentid="71120" data-ipsquote-contentclass="forums_Topic"><div>As I was growing up, I kept a notebook full of cool code snippets and ideas. My notebook had been misplaced but I ran across it recently and here is one of the pages which is from a 1987 Dr. Dobbs article by Mark S. Ackerman. &quot;6502 Killer Hacks&quot;.<p>&#xA0;</p>
<p><span style="color:#FF0000;">Post your own 6502 Killer Hacks and share them with the rest of us!</span></p>
<p>.</p>
<p>.</p>
<p>.</p>
<p>Well here is the killer hack. This one is to scrimp on RAM.</p>
<p>&#xA0;</p>
<p>Incrementing only the lower 4 bits of a byte (with wrap)</p>
<p>.</p>
<p>.</p>
<p>.</p>
<p> - David</p>
</div></blockquote>
<p>&#xA0;</p>
<p> Just joined these forums so sorry if I&apos;m a little late to this party <img alt=";)" src original-src="https://atariage.com/forums/uploads/emoticons/atariage_icon_wink.gif" show-src="scraper/images/atariage_icon_wink.gif"></p>
<p>&#xA0;</p>
<p> Here&apos;s a couple of my favorites</p>
<p>&#xA0;</p>
<p> First the counter</p>
<p>&#xA0;</p>
<p> eor something with its self you get 0</p>
<p> eor something with 0 you get its self</p>
<p>&#xA0;</p>
<p></p>
<pre class="ipsCode"> lda counter
inc counter
eor counter
and #$F0
eor counter
sta counter</pre>
<div></div>
<p></p>
<p> Of course you can insert bits from one byte into another</p>
<p> byte (not just from a changed version of itself) </p>
<p> Used eg for setting pixels </p>
<p>&#xA0;</p>
<p></p>
</div></blockquote>
<p>&#xA0;</p>
<p>=========</p>
<p>&#xA0;</p>
<p> haven&apos;t read this thread for awhile (thanks to vdub to resurrect it so I would actually see some of the cool additions)</p>
<p>&#xA0;</p>
<p>This is more likely the original Ackerman &apos;hack&apos; for incrementing only the low 4 bits of a byte without requiring any additional memory. I think the other &apos;bad&apos; version must have been my own idle mind playing around with other ideas. Thanks bogax.</p>
<span class="ipsType_reset ipsType_medium ipsType_light" data-excludequote>
<strong>Edited <time datetime="2011-03-04T08:54:32Z" title="03/04/2011 08:54  AM" data-short="8 yr">March 4, 2011</time> by djmips</strong>
</span>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__142">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on April 4, 2017</div><div class="mdl-card__supporting-text">
<blockquote data-ipsquote class="ipsQuote" data-ipsquote-contentcommentid="2224284" data-ipsquote-contentapp="forums" data-ipsquote-contenttype="forums" data-ipsquote-contentclass="forums_Topic" data-ipsquote-contentid="71120" data-ipsquote-username="Thomas Jentzsch" data-cite="Thomas Jentzsch" data-ipsquote-timestamp="1299189465"><div><div>
<p>Why not</p>
<pre class="ipsCode prettyprint lang-auto">clc
  lda a 
  adc b
  ror</pre>?<p>&#xA0;</p>
</div></div></blockquote>
<p>This won&apos;t work because you could overflow if the numbers were both &gt; 128</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__143">
                                                        <div class="mdl-card__title"><strong>Thomas JentzschThomas Jentzsch</strong> posted on April 4, 2017</div><div class="mdl-card__supporting-text">
<p>The ROR will take take of that.</p>
</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-1__144">
                                                        <div class="mdl-card__title"><strong>djmipsdjmips</strong> posted on April 4, 2017</div><div class="mdl-card__supporting-text">
<p>Ah yes, I suspected I would be corrected. Of course, the carry is the ninth bit. I am rusty. </p>
</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="misc-2">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Ask all programming questions here!</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <h6 class="cardSubtitle">Written by KHAN Games</h6>

                        
					This is a thread where you can come ask all technical programming questions, without fear of people mocking you.&#xA0; No matter how ridiculous the question, ask it here.&#xA0; We will check it often.<br>
<br>
<img src width="400" original-src="http://i100.photobucket.com/albums/m18/Battymo/NGDunicorn.jpg" show-src="scraper/images/NGDunicorn.jpg"><br>
<br>
The power of the NGD-riding unicorn wards off all mean-spirited people.&#xA0; Feel safe here.
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#misc-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;misc-2__comments&apos;);">
                            Toggle Responses
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=103138" target="_blank">
                                Original Thread
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="misc-2__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1">
                                                        <div class="mdl-card__title"><strong>Sniglet</strong> posted on 
		
			
				
				May 15, 2013 at 2:12:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok I&apos;ve got a few questions. I only just started seriously collecting and also only just found out about these homebrew carts and repros and such. So i hope my questiosn are relevant... maybe not lol.
<br>
<br>1. I noticed someone offering really nice repros but only with certain donor carts. Why wont just any cart work?
<br>2. How does one actually put a new game onto an old one? for example, placing Final Fantasy V onto an SNES sports game.
<br>3. How do people make these super awesome personalized carts and labels such as with Battle kid?
<br>4. What kind of programs and or equipment would be required should I study up more and decide i want to make my own games on carts? Where does one even begin?
<br>5. Is this something someone could persue who has no prior knowledge of such activities?
<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__2">
                                                        <div class="mdl-card__title"><strong>NESMASTER14</strong> posted on 
		
			
				
				May 15, 2013 at 2:23:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					lmao I never thought I&apos;d see that pic again...
<br>
<br>Anywho, cool thread. I will probably pop in here from time to time. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__3">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 15, 2013 at 2:38:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Sniglet</b></i><br>
	<br>
	Ok I&apos;ve got a few questions. I only just started seriously collecting and also only just found out about these homebrew carts and repros and such. So i hope my questiosn are relevant... maybe not lol.<br>
	<br>
	1. I noticed someone offering really nice repros but only with certain donor carts. Why wont just any cart work?<br>
	2. How does one actually put a new game onto an old one? for example, placing Final Fantasy V onto an SNES sports game.<br>
	3. How do people make these super awesome personalized carts and labels such as with Battle kid?<br>
	4. What kind of programs and or equipment would be required should I study up more and decide i want to make my own games on carts? Where does one even begin?<br>
	5. Is this something someone could persue who has no prior knowledge of such activities?<br>
	<br>
	&#xA0;</div>
<br>
As this thread is supposed to be solely for homebrew related programming questions, these types of questions are sort of off-topic, but I&apos;ll answer them the best I can, since the unicorn compels me.<br>
<br>
1. I noticed someone offering really nice repros but only with certain donor carts. Why wont just any cart work?<br>
<br>
Certain games require certain mappers.&#xA0; They won&apos;t work with any other mapper.&#xA0; If you don&apos;t know what a mapper is, hit up the google!<br>
<br>
2. How does one actually put a new game onto an old one? for example, placing Final Fantasy V onto an SNES sports game.<br>
<br>
Assuming the mapper is correct, you would an eprom burner to do these sorts of things.&#xA0; As I have no idea how this stuff works, since it isn&apos;t programming related, I&apos;ll tell you to again, hit up the google.<br>
<br>
3. How do people make these super awesome personalized carts and labels such as with Battle kid?<br>
<br>
I assume they are designing the labels in Photoshop/Illustrator and then printing them.&#xA0; The colored cartridges are available from retrousb.com.<br>
<br>
4. What kind of programs and or equipment would be required should I study up more and decide i want to make my own games on carts? Where does one even begin?<br>
<br>
Again, this isn&apos;t programming related, so you&apos;d need an eprom burner and god-knows what else.&#xA0; I don&apos;t know anything about this, so you&apos;ll have to ask a Repro person.<br>
<br>
5. Is this something someone could persue who has no prior knowledge of such activities?<br>
<br>
I assume people aren&apos;t born with this innate knowledge, so I would imagine it is teachable.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__4">
                                                        <div class="mdl-card__title"><strong>gliptitude</strong> posted on 
		
			
				
				May 16, 2013 at 1:32:05 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					What does a &quot;program&quot; look like, before you &quot;assemble&quot; it?<br>
<br>
What would an average length (in lines) be for a full (NES) game program?<br>
<br>
Do all (NES) programs have structural similarities? How is a program structured?<br>
<br>
Do (NES) programs have to be optimized and tweaked in order to display properly on a real NES, (avoid slowdown and graphics glitches)? Is there a big disparity between emulation and the real rom/cart/console?<br>
<br>
Is DMG Gameboy somehow impossible to program for?<br>
<br>
Can you answer these questions in a way that some one who has never programmed anything before can understand?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__5">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				May 16, 2013 at 2:16:32 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Program before assembling is a text (source code), usually there are many text files with the code, along with files with various binary data, such as graphics sets, music, etc.
<br>
<br>Average length is difficult to say, and it depends from programming language, and data storage approach - sometimes part of it is stored as binary, sometimes it is encoded in the source code, various amounts. Anyway, no less than thousand(s), even a simple one-screen logic game could be like 5000 lines of assembly code or 1500-2000 lines of C code.
<br>
<br>Some structure is suggested by the hardware design, i.e. there is main loop and NMI handler. Any access to the VRAM needs to be done during vertical blanking, so it is usually put into the NMI handler. Other than this, structure could be different. Say, you sure that you game won&apos;t run longer than a TV frame per in-game frame, so you can put it into the NMI handler entirely. Or you put part of the code (v-blank related, music player) into the NMI handler, but the rest of the code into the main loop. Or, you can do slow calculations in the main loop, while user interaction is done in the NMI handler - this could be useful in logic games, where the game code needs quite some time, but user could move the cursor around any time he wants.
<br>
<br>There are imperfections in the NES emulators, so yes, you can make a game that runs in an emulator, but not on the hardware, or vice versa. Speed-wise, normally there is no difference. So testing the program on the real hardware is a good idea, although with certain experience it is possible to make programs that will work on the hardware having no hardware, using knowledge of possible pitfalls and many emulators to testing.
<br>
<br>Gameboy is not different from any other computing platform, you can program it as well. The hardware is different from the NES, though.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__6">
                                                        <div class="mdl-card__title"><strong>SegF4ult</strong> posted on 
		
			
				
				May 16, 2013 at 4:04:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Sniglet</b></i><br>
	<br>
	Ok I&apos;ve got a few questions. I only just started seriously collecting and also only just found out about these homebrew carts and repros and such. So i hope my questiosn are relevant... maybe not lol.<br>
	<br>
	1. I noticed someone offering really nice repros but only with certain donor carts. Why wont just any cart work?<br>
	2. How does one actually put a new game onto an old one? for example, placing Final Fantasy V onto an SNES sports game.<br>
	3. How do people make these super awesome personalized carts and labels such as with Battle kid?<br>
	4. What kind of programs and or equipment would be required should I study up more and decide i want to make my own games on carts? Where does one even begin?<br>
	5. Is this something someone could persue who has no prior knowledge of such activities?</div>
<ol>
	<li>
		Not just any cart works because of hardware differences. Carts have a certain memory mapping chip depending on the amount of memory the ROM needs to be written on. Without this &apos;mapper&apos;, the NES wouldn&apos;t be able to properly find instructions and data from the big amount of memory inside the cart.</li>
	<li>
		You can&apos;t just put new games on an old cartridge most of the time. The old memory chips are removed from the board and replaced by compatible rewritable memory.</li>
	<li>
		That&apos;s an entirely different ballpark altogether. Printing quality labels is dependant on the printer, the paper you use, the method you use of adhering it to the cartridge. Some use a clear film over the label, others don&apos;t. There are a lot of ways to do labels. As for personalized cartridges, retrousb.com sells translucent NES carts, you could however also opt to make your own molds and cast these cartridge shells by hand, but it&apos;s a ridiculously pricy process</li>
	<li>
		First of all, stick to developing roms that work in an emulator. Once you&apos;re ready to go the cart route, you&apos;d need an (E)EPROM programmer with appropriate software and some software to split up your game ROM into a PRG and a CHR rom.</li>
	<li>
		It is always worth pursueing something you&apos;re interested in, it is entirely possible to do so. The journey is one filled with knowledge.</li>
</ol>
<div class="FTQUOTE">
	<i>Originally posted by:&#xA0;<b>gliptitude</b></i><br>
	<br>
	What does a &quot;program&quot; look like, before you &quot;assemble&quot; it?<br>
	<br>
	What would an average length (in lines) be for a full (NES) game program?<br>
	<br>
	Do all (NES) programs have structural similarities? How is a program structured?<br>
	<br>
	Do (NES) programs have to be optimized and tweaked in order to display properly on a real NES, (avoid slowdown and graphics glitches)? Is there a big disparity between emulation and the real rom/cart/console?<br>
	<br>
	Is DMG Gameboy somehow impossible to program for?<br>
	<br>
	Can you answer these questions in a way that some one who has never programmed anything before can understand?</div>
Any program, no matter whether it&apos;s for a NES, PC, GameBoy or &lt;insert system name here&gt;, starts out as flat text. This text is then interpreted by specialized software to build binary files.<br>
An average length for a full game, that&apos;s a tricky one. It depends on the algorithms you want to use and how efficiently you can implement them.<br>
<br>
All games have at least some structural similarities. It is common to structure a game as follows:
<ul>
	<li>
		Initialize key variables</li>
	<li>
		Start a main game loop (loops are important, otherwise execution would halt)</li>
	<li>
		Poll controller(s) for input</li>
	<li>
		Change variables based on controller input (think sprite placement or something entirely different)</li>
	<li>
		Make extra checks, i.e. collision detection, valid input, etc.</li>
</ul>
There are more things you could add. What is important is that the NES/PC/Whatever gets the time to render the screen at some point. Video timing is critical.<br>
<br>
As for optimization and tweaks to work properly on a real NES? It depends on the emulator you&apos;re using. No emulator works the same, so what is valid in one emulator could go wrong in the other. What works on an emulator could also fail to work on real hardware.<br>
There are certainly emulators out there that do a really good job of mimicking the real hardware. Chances are, if it runs in that emulator, it&apos;ll work on the hardware.<br>
<br>
Gameboys aren&apos;t impossible to program for. They use different hardware, among which a different CPU. So it&apos;s a different instruction set, different architecture, etc.<br>
The Gameboy and Gameboy Colour use a modified Zilog Z80, so reading up on Z80 assembler could work for that. Otherwise, there are also probably C compilers available.<br>
<br>
<br>
I&apos;ve tried to explain these concepts to the best of my ability, if there are certain things that aren&apos;t clear, just send me a PM or let me know here.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__7">
                                                        <div class="mdl-card__title"><strong>Parpunk</strong> posted on 
		
			
				
				May 16, 2013 at 9:40:31 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here&apos;s a great one
<br>
<br>Can some vets post the tools and programs they use to get started, and links to where to download them etc.
<br>
<br>1. In games like Super Mario Bros. (side scrolling) in a nutshell, is a game like this contain way more code then a game that is not side scrolling?
<br>2. To make your sprite on screen move to the direction of the D pad being pushed, is this a simple code to enter that will connect it, to the D pad? or does it consist of tons of codes just to make it possible to have control of a character.
<br>3. When a character jumps on screen, Is it contained in the programming of how fast/smooth/high/far it can jump? Never understood this in games like adventure island where you can sorta feel your jump by how long you hold down the jump button etc. for small jumps.
<br>
<br>I dunno know im sure i have a million more, but just the simplest of things confuse me before even getting started lol
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__8">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				May 16, 2013 at 9:51:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Parpunk</b></i><br>
	<br>
	Here&apos;s a great one<br>
	<br>
	Can some vets post the tools and programs they use to get started, and links to where to download them etc.<br>
	<br>
	1. In games like Super Mario Bros. (side scrolling) in a nutshell, is a game like this contain way more code then a game that is not side scrolling?<br>
	2. To make your sprite on screen move to the direction of the D pad being pushed, is this a simple code to enter that will connect it, to the D pad? or does it consist of tons of codes just to make it possible to have control of a character.<br>
	3. When a character jumps on screen, Is it contained in the programming of how fast/smooth/high/far it can jump? Never understood this in games like adventure island where you can sorta feel your jump by how long you hold down the jump button etc. for small jumps.<br>
	<br>
	I dunno know im sure i have a million more, but just the simplest of things confuse me before even getting started lol</div>
<br>
1. I&apos;d say that one-way scrollers like SMB1 probably don&apos;t have much more code than a single screen game. The reason is that the persistence of enemies and destructible blocks only needs to last as long as they are onscreen. For a two-way scroller, suddenly you have to decide how long things are allowed to live off screen. Most games solve this with re-spawning, but re-spawning itself introduces the problem of how many instances of an enemy are allowed to be created. It&apos;s really when you get to two way scrollers that things begin to get hairy.<br>
<br>
2. Moving a character with the d-pad doesn&apos;t involve much code, even when it is done with more advanced techniques.<br>
<br>
3. A jump works by adding a velocity value onto a height value. And then, on every frame, an acceleration value is added to the velocity. Typically, the velocity will start out negative, making your character rise (going downwards is actually positive Y instead of upwards as is traditional on graph paper).&#xA0; Eventually the velocity will go zero and then start to make your character go downwards again (because acceleration keeps getting added to it, the velocity might change from -5 to -4 to -3 to -2 to -1 to 0 to 1 to 2 to 3 to 4 to 5.....uuuup.......dooowwwn..... make sense?). This simple setup produces a smooth jump arc.&#xA0;&#xA0; The jump can be stopped at any time by detecting that the jump button was released.<br>
<br>
....that might be a great topic for a video....kinda hard to explain in a little paragraph! Maybe some others can help clarify this.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__9">
                                                        <div class="mdl-card__title"><strong>SegF4ult</strong> posted on 
		
			
				
				May 16, 2013 at 9:57:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Parpunk</b></i><br>
	1. In games like Super Mario Bros. (side scrolling) in a nutshell, is a game like this contain way more code then a game that is not side scrolling?<br>
	2. To make your sprite on screen move to the direction of the D pad being pushed, is this a simple code to enter that will connect it, to the D pad? or does it consist of tons of codes just to make it possible to have control of a character.<br>
	3. When a character jumps on screen, Is it contained in the programming of how fast/smooth/high/far it can jump? Never understood this in games like adventure island where you can sorta feel your jump by how long you hold down the jump button etc. for small jumps.</div>
I am by no means a veteran, nor have I written any sort of game for the NES, however, I am a programmer. So let&apos;s start this off. All of the tools most people use can be found at&#xA0;<a href="http://nesdev.com/#PC" target="_blank" original-href="http://nesdev.com/#PC">http://nesdev.com/#PC</a><br>
I&apos;ll try to answer the rest of your questions to the best of my ability.<br>
<ol>
	<li>
		I wouldn&apos;t say it has substantially more code. It all depends on how you define your levels. Scrolling is quite tricky to implement (to be honest, I don&apos;t have any idea where to start to do scrolling). The amount of code is greatly dependant upon your algorithm.</li>
	<li>
		To make a character sprite move isn&apos;t as straightforward as &apos;connecting&apos; a button to the sprite. You read in the state of all the buttons (the entire NES pad) and then check to see if a certain bit is a logic 1. You then write code that tells the NES to increment or decrement a certain variable based on the status of these bits coming from the NES pad.</li>
	<li>
		All of a character&apos;s movements are contained in the programming. See my #2 answer,&#xA0;it is a simple matter of incrementing or decrementing variables based on external variables, say time.</li>
</ol>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__10">
                                                        <div class="mdl-card__title"><strong>Parpunk</strong> posted on 
		
			
				
				May 16, 2013 at 9:58:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>GradualGames</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Parpunk</b></i><br>
		<br>
		Here&apos;s a great one<br>
		<br>
		Can some vets post the tools and programs they use to get started, and links to where to download them etc.<br>
		<br>
		1. In games like Super Mario Bros. (side scrolling) in a nutshell, is a game like this contain way more code then a game that is not side scrolling?<br>
		2. To make your sprite on screen move to the direction of the D pad being pushed, is this a simple code to enter that will connect it, to the D pad? or does it consist of tons of codes just to make it possible to have control of a character.<br>
		3. When a character jumps on screen, Is it contained in the programming of how fast/smooth/high/far it can jump? Never understood this in games like adventure island where you can sorta feel your jump by how long you hold down the jump button etc. for small jumps.<br>
		<br>
		I dunno know im sure i have a million more, but just the simplest of things confuse me before even getting started lol</div>
	<br>
	1. I&apos;d say that one-way scrollers like SMB1 probably don&apos;t have much more code than a single screen game. The reason is that the persistence of enemies and destructible blocks only needs to last as long as they are onscreen. For a two-way scroller, suddenly you have to decide how long things are allowed to live off screen. Most games solve this with re-spawning, but re-spawning itself introduces the problem of how many instances of an enemy are allowed to be created. It&apos;s really when you get to two way scrollers that things begin to get hairy.<br>
	<br>
	2. Moving a character with the d-pad doesn&apos;t involve much code, even when it is done with more advanced techniques.<br>
	<br>
	3. A jump works by adding a velocity value onto a height value. And then, on every frame, an acceleration value is added to the velocity. Typically, the velocity will start out negative, making your character rise (going downwards is actually positive Y instead of upwards as is traditional on graph paper).&#xA0; Eventually the velocity will go zero and then start to make your character go downwards again (because acceleration keeps getting added to it, the velocity might change from -5 to -4 to -3 to -2 to -1 to 0 to 1 to 2 to 3 to 4 to 5.....uuuup.......dooowwwn..... make sense?). This simple setup produces a smooth jump arc.&#xA0;&#xA0; The jump can be stopped at any time by detecting that the jump button was released.<br>
	<br>
	&#xA0;</div>
WOW thanks man, starting to make a little more sense!<br>
<br>
As a first project i would like to do a side scrolling platformer style game. Kinda like adventure island.<br>
<br>
1. Is this dreaming too big for a first project? It dont have to play as good or look as good as AI, but something where the concept would be. a.) character moves left to right throwing stuff at enemies.&#xA0;<br>
<br>
Thats pretty much it lol. dont sound like much but probably pretty tough to code.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__11">
                                                        <div class="mdl-card__title"><strong>Parpunk</strong> posted on 
		
			
				
				May 16, 2013 at 10:23:56 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Gradual Games
<br>
<br>Just watched the demo for the first time of Owlia, and man i have to say it is extremely impressive! If i could learn to design something just a tenth as good as that i would be over the moon lol. How long have you been going at nes programming?
<br>
<br>Thats really impressive man!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__12">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				May 16, 2013 at 10:33:10 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Parpunk,<br>
<br>
If you haven&apos;t programmed before, I would recommend starting smaller than a scrolling platformer, say with an arcade clone of sorts (but as your FIRST experiments, even smaller than that---just moving something around, playing a sound, just getting your feet wet with the basics!) I think most of us started small in some way or another. I had been programming for quite a while before I started on the NES. At nes programming specifically, I&apos;ve been at it since november of &apos;08. *edit* note, I think the NES can be your first system, just be prepared to take it slow. Or, spend some time with something like python/pygame, then come back. Everyone&apos;s path will be different; there&apos;s no wrong way to start. I started in QBasic, in the 90&apos;s.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__13">
                                                        <div class="mdl-card__title"><strong>Parpunk</strong> posted on 
		
			
				
				May 16, 2013 at 10:39:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here&apos;s a wild question<br>
<br>
Have any of the vet homebrewers (gradual games, sivak, bunnyboy and others) ever considered getting together and starting a combined company and start pumping out new games every couple of months??? LOL. Start the next capcom lol<br>
<br>
I know it sounds crazy, but all you guys are so talented i bet it would really generate a rebirth in new NES games and production would be so much faster.<br>
<br>
Im sure there would be alot of hurdles, legally, financially, timewise, schedule wise,<br>
But just sounded like a pretty wild idea.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__14">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				May 16, 2013 at 10:44:30 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That&apos;s a neat idea, but let&apos;s keep this thread on topic. You could start a new thread with that idea perhaps. I think if I ever tried to recruit a team, it&apos;d be for a SNES rpg or something in the future, we&apos;ll see. I might be done after Owlia, I&apos;m not sure. I&apos;ll have to see how I feel!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__15">
                                                        <div class="mdl-card__title"><strong>NewUser123456789</strong> posted on 
		
			
				
				May 16, 2013 at 10:52:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					let&apos;s try to keep all questions on topic.
<br>
<br>and the topic is Programming questions.
<br>
<br>No questions about how to make repro, setting up homebrew companies, none of that.
<br>
<br>Just programming questions.
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__16">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 16, 2013 at 10:55:10 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Paul</b></i><br>
	<br>
	let&apos;s try to keep all questions on topic.<br>
	<br>
	and the topic is Programming questions.<br>
	<br>
	No questions about how to make repro, setting up homebrew companies, none of that.<br>
	<br>
	Just programming questions.<br>
	&#xA0;</div>
<br>
Thanks, Paul.<br>
<br>
I intended this thread to be for people who are trying to program to come in and say &quot;Hey, I&apos;m trying to get this sprite to move across the screen.&#xA0; Here&apos;s my code.&#xA0; What&apos;s wrong with it?&quot;<br>
<br>
Or &quot;I really want my sprite to collide with the background and stop.&#xA0; What&apos;s the best way to go about this?&quot;<br>
<br>
The more generic questions are fine.&#xA0; I just don&apos;t want this thread to get so far off of what I intended that it fails to serve its purpose in the future.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__17">
                                                        <div class="mdl-card__title"><strong>Parpunk</strong> posted on 
		
			
				
				May 16, 2013 at 11:08:23 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					My bad, just so many questions all over the place. Did not mean to derail. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__18">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				May 16, 2013 at 11:12:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Parpunk</b></i><br>
	<br>
	Here&apos;s a great one<br>
	<br>
	Can some vets post the tools and programs they use to get started, and links to where to download them etc.<br>
	&#xA0;</div>
<br>
I&apos;ve been one to usually use Tile Layer Pro for graphics. I used to use Tepples&apos; nametable maker called 8name, but it likes to crash for me on Windows 8, so I switched to Shiru&apos;s newer program called NES Screen Tool:&#xA0;<br>
<br>
<a href="http://forums.nesdev.com/viewtopic.php?f=21&amp;t=7237" target="_blank" original-href="http://forums.nesdev.com/viewtopic.php?f=21&amp;t=7237">http://forums.nesdev.com/viewtopi...</a><br>
<br>
I use ca65 as my assembler which has given me VERY little problems when building (I can only think of one confusing instance that happened lately). Google should find this rather quickly. There are other, more NES geared assemblers like ASM6 out there, but I just got used to ca65. It does require setting up a config file (I think the really good programmers call them linker files???), but once you have a basic one set up, you don&apos;t have to worry about it anymore. If anyone chooses to go the route of ca65, I can give a bare-bones config file that should get you going.<br>
<br>
Of course some sort of text editor, whatever someone is comfortable with using. I guess that is the basics of what I use. I can&apos;t think of anything else that springs to mind.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__19">
                                                        <div class="mdl-card__title"><strong>Parpunk</strong> posted on 
		
			
				
				May 16, 2013 at 11:19:43 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Roth</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Parpunk</b></i><br>
		<br>
		Here&apos;s a great one<br>
		<br>
		Can some vets post the tools and programs they use to get started, and links to where to download them etc.<br>
		&#xA0;</div>
	<br>
	I&apos;ve been one to usually use Tile Layer Pro for graphics. I used to use Tepples&apos; nametable maker called 8name, but it likes to crash for me on Windows 8, so I switched to Shiru&apos;s newer program called NES Screen Tool:&#xA0;<br>
	<br>
	<a href="http://forums.nesdev.com/viewtopic.php?f=21&amp;t=7237" target="_blank" original-href="http://forums.nesdev.com/viewtopic.php?f=21&amp;t=7237">http://forums.nesdev.com/viewtopic.php?f=21&amp;t=7237</a><br>
	<br>
	I use ca65 as my assembler which has given me VERY little problems when building (I can only think of one confusing instance that happened lately). Google should find this rather quickly. There are other, more NES geared assemblers like ASM6 out there, but I just got used to ca65. It does require setting up a config file (I think the really good programmers call them linker files???), but once you have a basic one set up, you don&apos;t have to worry about it anymore. If anyone chooses to go the route of ca65, I can give a bare-bones config file that should get you going.<br>
	<br>
	Of course some sort of text editor, whatever someone is comfortable with using. I guess that is the basics of what I use. I can&apos;t think of anything else that springs to mind.</div>
Awesome thanks a lot Roth!<br>
<br>
In general could you describe what each of the tools you mention do, and what order you go in when programming? Or the general consensus of what you need to use each program for? I have looked around in nerdy nights, but the very first lesson just starts out with Codes slapped in the thread, with no explaining of what the objective is in sight with the codes?? I dont know if i am supposed to already know what to do, but i literaly have no idea and have not found anywhere explaining how to get off the ground.&#xA0;<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__20">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				May 16, 2013 at 11:25:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Even though an one-way scrolling engine could contain not that much more code compared to a single screen game, that does not mean it is &apos;not than much&apos; more complex than a single screen game. It is non-linear relation, scrolling introduces a number of problems to solve, making code considerable more complex. Like, world space in 16-bit coordinates (at least) with &apos;virtual camera&apos;; unpacking level data row by row, as unpacked scrolling levels take a lot of room; updating video memory when needed; keeping status bar static via screen split or something; sprites that could go offscreen - a range of subproblems, as you can&apos;t now process all enemies on a level like in a single screen game, you have to keep amount of simultaneously processed enemies reasonable in some way. Also, while you can easily code a level for a single screen game without extra tools, you&apos;ll sure will need a custom map editor or a converter from some general map format - something that&apos;ll allow to edit large levels and pack them into your custom format. So you may need skills of PC programming as well.
<br>
<br>Bottom line: there is a reason why so many homebrew games are single screen ones, and the reason is because it is noticeably easier. So don&apos;t start with a scrolling game like SMB right away.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__21">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				May 16, 2013 at 11:44:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	Even though an one-way scrolling engine could contain not that much more code compared to a single screen game, that does not mean it is &apos;not than much&apos; more complex than a single screen game. It is non-linear relation, scrolling introduces a number of problems to solve, making code considerable more complex. Like, world space in 16-bit coordinates (at least) with &apos;virtual camera&apos;; unpacking level data row by row, as unpacked scrolling levels take a lot of room; updating video memory when needed; keeping status bar static via screen split or something; sprites that could go offscreen - a range of subproblems, as you can&apos;t now process all enemies on a level like in a single screen game, you have to keep amount of simultaneously processed enemies reasonable in some way. Also, while you can easily code a level for a single screen game without extra tools, you&apos;ll sure will need a custom map editor or a converter from some general map format - something that&apos;ll allow to edit large levels and pack them into your custom format. So you may need skills of PC programming as well.<br>
	<br>
	Bottom line: there is a reason why so many homebrew games are single screen ones, and the reason is because it is noticeably easier. So don&apos;t start with a scrolling game like SMB right away.</div>
<br>
I don&apos;t see camera space to screen space adding that much more code, just a loop that subtracts the camera&apos;s X and Y from each metasprite&apos;s X and Y.<br>
<br>
Unpacking level data is a problem for a large single screen game, too.&#xA0; Battle Kid had around 500 rooms I believe. If you string them out end to end, that&apos;s actually longer (in terms of sheer screen real-estate) than Nomolos. I&apos;d be shocked if Sivak did that all in a text editor. So you could still need that skill (programming an editor for use on a PC) for a single screen game.<br>
<br>
Actually updating the nametables for scrolling is definitely a challenge, but in my opinion does not introduce much complexity until you allow backtracking. Nomolos was originally single scrolling----and the number of problems I had to solve really exploded when I decided to rewrite the scrolling engine to allow backtracking. *edit* I suppose it is also possible I am taking for granted the step up from single screen since I&apos;ve never made a single screen game! (on the NES...made lots in QBasic years ago)<br>
<br>
I do agree though that starting with scrolling for one&apos;s first project, especially with not much experience prior, would not be wise. I&apos;m just standing by my feeling that single-scrolling isn&apos;t a huge step up in complexity from single-screen. It&apos;s definitely a step up, but its just not...huge. haha.&#xA0; Taking the step up to 8 way scrolling though would be project suicide for someone starting out. It took me several months to get Owlia&apos;s 8 way scrolling engine working correctly (compare that to...about an afternoon for Nomolos&apos;s scrolling engine..*edit* that&apos;s just scrolling though, that does not include all the problems I later had to solve as a result....). The hardest problem to solve there is updating the attribute table, and then updating both a row and column inside vblank without going past the end of vblank and mucking up the ppu with garbage. (*edit* I forgot also hiding update glitches....there are quite a few details here to cover)<br>
<br>
I forgot about status bars---but that&apos;s because I don&apos;t like them and never use them <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__22">
                                                        <div class="mdl-card__title"><strong>gliptitude</strong> posted on 
		
			
				
				May 16, 2013 at 4:32:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry to flood your thread with super general noob questions KHAN games. It was a new thread with a sticky on it and it said &quot;no matter how ridiculous&quot; and &quot;without fear of mocking&quot;, so...
<br>
<br>Sniglet actually asked a question or two for which your answers were very illuminating for me, (I looked up &quot;mappers&quot;, which is not something that relates to the Vectrex assembly programming I have been trying to learn about).
<br>
<br>... I think if I had a very specific question with a project of my own, I would probably start my own thread, rather than getting lost in another one. Wouldn&apos;t specific questions about one&apos;s own active project warrant that???
<br>
<br>So the answers to my own super general questions here were very welcome, and I am glad you made this thread! 
<br>
<br>... I did subsequently view the &quot;Nerdy Nights&quot; weekly tutorials, which are also linked from a sticky thread, though. Probably that is the most appropriate place for people to start. It looks like a very well organized introduction.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__23">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 16, 2013 at 4:50:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Stickied.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__24">
                                                        <div class="mdl-card__title"><strong>JKeefe56</strong> posted on 
		
			
				
				May 16, 2013 at 5:06:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I hate to ask something like this, because I feel like it&apos;s asking too much.  But I&apos;m working on a puzzle game.  I can make a level of it, but then I get stuck.  Is there anyone willing to write out a code to show me, that would do something like this, just so I can see how it is done?
<br>
<br>Just load a background screen and then when a certain button is pressed it loads the next background?
<br>
<br>I&apos;ve gotten stuck here a few times.  Or if there&apos;s a NN that covers this that I missed, could you point me in that direction?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__25">
                                                        <div class="mdl-card__title"><strong>gliptitude</strong> posted on 
		
			
				
				May 16, 2013 at 5:10:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<br>
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	Program before assembling is a text (source code), usually there are many text files with the code, along with files with various binary data, such as graphics sets, music, etc.<br>
	<br>
	Average length is difficult to say, and it depends from programming language, and data storage approach - sometimes part of it is stored as binary, sometimes it is encoded in the source code, various amounts. Anyway, no less than thousand(s), even a simple one-screen logic game could be like 5000 lines of assembly code or 1500-2000 lines of C code.<br>
	&#xA0;</div>
<br>
Thanks for this reply Shiru.<br>
<br>
Could you possibly explain to me in a conceptual way, how the &quot;many text files with the code&quot; are grouped together? ... Is it eventually all organized in ONE sequential list of commands (&quot;the program&quot;)? ... Or is it that there is one core program with occasional instructions to &quot;leave&quot; and go to another, or to &quot;retrieve&quot; information from one of the other &quot;text files&quot;? Or are most of these extra files deposited by the cartridge in memory on the console while the program is running?<br>
<br>
Or perhaps it is silly to ask these questions at the outset?<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__26">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				May 16, 2013 at 5:27:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>gliptitude</b></i><br>
	<br>
	<div class="FTQUOTE">
		<br>
		<i>Originally posted by: <b>Shiru</b></i><br>
		<br>
		Program before assembling is a text (source code), usually there are many text files with the code, along with files with various binary data, such as graphics sets, music, etc.<br>
		<br>
		Average length is difficult to say, and it depends from programming language, and data storage approach - sometimes part of it is stored as binary, sometimes it is encoded in the source code, various amounts. Anyway, no less than thousand(s), even a simple one-screen logic game could be like 5000 lines of assembly code or 1500-2000 lines of C code.<br>
		&#xA0;</div>
	<br>
	Thanks for this reply Shiru.<br>
	<br>
	Could you possibly explain to me in a conceptual way, how the &quot;many text files with the code&quot; are grouped together? ... Is it eventually all organized in ONE sequential list of commands (&quot;the program&quot;)? ... Or is it that there is one core program with occasional instructions to &quot;leave&quot; and go to another, or to &quot;retrieve&quot; information from one of the other &quot;text files&quot;? Or are most of these extra files deposited by the cartridge in memory on the console while the program is running?<br>
	<br>
	Or perhaps it is silly to ask these questions at the outset?</div>
<br>
Those are great questions, not silly at all. The answers to them will become more clear over time, but a general answer follows:<br>
<br>
It is optional whether a game program is contained all within one text file or multiple text files before assembled into a final binary ROM that the NES or an emulator reads. Neither an emulator nor the NES can know how many text files created it. The only reason multiple text files are ever used is to help the programmer split up their code into logical chunks. You might have a text file that deals with the camera,&#xA0; a text file that deals with updating all enemies on screen, another to decode the map and perform scrolling, another for generic PPU operations, etc.&#xA0; It&apos;s all about organization.&#xA0; That leaves a ton of details out, but hopefully helps a little.<br>
<br>
<br>
It took a bit for another part of your question to sink in. The NES can *potentially* see up to 64kb of ROM or RAM at any given time. However, the way the cartridge pins and memory pins are wired up to the NES, it can usually only see 2kb of RAM (8kb with wram), and up to 32kb of ROM at any given time. That 32KB of ROM is basically where your text files appear, in binary form. It is typically made up of two 16 kb chunks, and depending on the mapper they can be swapped out, like &quot;windows&quot; into the code that originally appeared in your text files.&#xA0;&#xA0; 2kb of ram is on the NES itself, any additional RAM has to be on the cartridge. All of your program code just stays right on the cartridge---and is read directly by the CPU with the help of the mapper on the cartridge, for letting the cpu dig into various 16kb chunks at a time. Again...I probably glossed over a lot of details, but trying to keep my answers as simple as I can.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__27">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 16, 2013 at 5:40:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>JKeefe56</b></i><br>
	<br>
	I hate to ask something like this, because I feel like it&apos;s asking too much. But I&apos;m working on a puzzle game. I can make a level of it, but then I get stuck. Is there anyone willing to write out a code to show me, that would do something like this, just so I can see how it is done?<br>
	<br>
	Just load a background screen and then when a certain button is pressed it loads the next background?<br>
	<br>
	I&apos;ve gotten stuck here a few times. Or if there&apos;s a NN that covers this that I missed, could you point me in that direction?</div>
<br>
Basically, you have to create a subroutine that is activated when something happens.&#xA0; i.e. your score reaches a level, you die, you win, etc.&#xA0;<br>
<br>
Just have it set a flag that allows your subroutine to run.&#xA0; This routine will switch the game state, load the status screen, clear the variables in the level RAM, and then sit there and wait for you to push Start or something.<br>
<br>
Then you push start and it loads the next level, changes the game state, and dumps the player into the next level.&#xA0;<br>
<br>
It is challenging, but you just have to think:&#xA0; Okay, what did I do to get the first screen to load?&#xA0; Sprites, background, initilize all the RAM required to run the room, etc.&#xA0; Do this every friggin&apos; time you load a room or different level, set, death, and stuff.&#xA0;<br>
<br>
It would probably be easier with an example, but I really don&apos;t have time to whip up another tutorial right now.&#xA0; Hope that helps though.&#xA0;<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__28">
                                                        <div class="mdl-card__title"><strong>gliptitude</strong> posted on 
		
			
				
				May 16, 2013 at 5:43:13 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SegF4ult</b></i><br>
	<br>
	Any program, no matter whether it&apos;s for a NES, PC, GameBoy or <insert here name system>, starts out as flat text. This text is then interpreted by specialized software to build binary files.<br>
	An average length for a full game, that&apos;s a tricky one. It depends on the algorithms you want to use and how efficiently you can implement them.<br>
	<br>
	All games have at least some structural similarities. It is common to structure a game as follows:
	<ul>
		<li>
			Initialize key variables</li>
		<li>
			Start a main game loop (loops are important, otherwise execution would halt)</li>
		<li>
			Poll controller(s) for input</li>
		<li>
			Change variables based on controller input (think sprite placement or something entirely different)</li>
		<li>
			Make extra checks, i.e. collision detection, valid input, etc.</li>
	</ul>
	There are more things you could add. What is important is that the NES/PC/Whatever gets the time to render the screen at some point. Video timing is critical.<br>
	<br>
	As for optimization and tweaks to work properly on a real NES? It depends on the emulator you&apos;re using. No emulator works the same, so what is valid in one emulator could go wrong in the other. What works on an emulator could also fail to work on real hardware.<br>
	There are certainly emulators out there that do a really good job of mimicking the real hardware. Chances are, if it runs in that emulator, it&apos;ll work on the hardware.</insert><br>
	&#xA0;</div>
<br>
This game structure is semi comprehensible to me. ...<br>
<br>
With the question of emulation/console disparity I am coming from an experience with Vectrex, in which (someone else&apos;s homebrew game) looks PERFECT in an emulator, but VERY DISTORTED on the actual Vectrex. ... It appears to me that this is far less of an issue on NES (and other consoles), and that the NES is working with a much more straightforward paradigm of graphics display and organization. &quot;Tiles&quot; and &quot;scrolling&quot; are kind of a built functionality of this machine. Correct???? I know that Vectrex is a very strange point of reference, but in comparison there seems to be much more of a language and a modular structure to &quot;drawing&quot; the graphics on NES.<br>
<br>
You say that &quot;video timing is critical&quot; though, and that time must be allowed for rendering, (if I understand correctly this &quot;time&quot; is tiny fractions of a second, in between other equally brief commands which are constantly being executed and re-executed in a cycle).&#xA0; ... Is it common that major compromises need to be made to the (NES) game program in order to get it to LOOK the way you want it to?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__29">
                                                        <div class="mdl-card__title"><strong>gliptitude</strong> posted on 
		
			
				
				May 16, 2013 at 5:52:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>GradualGames</b></i><br>
	<br>
	It is optional whether a game program is contained all within one text file or multiple text files before assembled into a final binary ROM that the NES or an emulator reads. Neither an emulator nor the NES can know how many text files created it. The only reason multiple text files are ever used is to help the programmer split up their code into logical chunks. You might have a text file that deals with the camera,&#xA0; a text file that deals with updating all enemies on screen, another to decode the map and perform scrolling, another for generic PPU operations, etc.&#xA0; It&apos;s all about organization.&#xA0; That leaves a ton of details out, but hopefully helps a little.<br>
	&#xA0;</div>
<br>
Awesome succinct answer. Thank you.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__30">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 16, 2013 at 6:09:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>JKeefe56</b></i><br>
	<br>
	I hate to ask something like this, because I feel like it&apos;s asking too much. But I&apos;m working on a puzzle game. I can make a level of it, but then I get stuck. Is there anyone willing to write out a code to show me, that would do something like this, just so I can see how it is done?<br>
	<br>
	Just load a background screen and then when a certain button is pressed it loads the next background?<br>
	<br>
	I&apos;ve gotten stuck here a few times. Or if there&apos;s a NN that covers this that I missed, could you point me in that direction?</div>
<br>
LoadNametable:<br>
&#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;normal loading routine<br>
&#xA0; LDA #$20<br>
&#xA0; STA $2006<br>
&#xA0; LDA #$00<br>
&#xA0; STA $2006<br>
SetNametable:<br>
&#xA0; LDA BG_ptr&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;BG_ptr is a variable in your zero page which tells the game<br>
&#xA0; ASL A&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;which level you&apos;re on.&#xA0; Everytime you beat a level, increment this.<br>
&#xA0; TAY<br>
&#xA0; LDA bkgd_pointer_table, y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;pointer table which takes the BG_ptr variable and<br>
&#xA0; STA AddrLow&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;tells it which level data to load.<br>
&#xA0; LDA bkgd_pointer_table+1, y<br>
&#xA0; STA AddrHigh<br>
<br>
&#xA0; LDX #$04<br>
&#xA0; LDY #$00<br>
LoadBackgroundsLoop:<br>
&#xA0; LDA [AddrLow], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;load nametable<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;draw tile<br>
&#xA0; INY&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;X is 0, so move on to get new counter number<br>
&#xA0; BNE LoadBackgroundsLoop<br>
;;Outer Loop<br>
&#xA0; INC AddrHigh<br>
&#xA0; DEX<br>
&#xA0; BNE LoadBackgroundsLoop<br>
&#xA0; RTS<br>
<br>
bkgd_pointer_table:&#xA0; ;;table of addresses for backgrounds.&#xA0; if BG_ptr is #$00, it will<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;;load the first one.&#xA0; #$01, the second.&#xA0; etc<br>
&#xA0; .dw gamebkgd0&#xA0;&#xA0; ;;level 0 background<br>
&#xA0; .dw gamebkgd1&#xA0;&#xA0; ;;level 1 background<br>
&#xA0; .dw gamebkgd2&#xA0;&#xA0; ;;level 2 background<br>
&#xA0; .dw gamebkgd3&#xA0;&#xA0; ;;level 3 background<br>
&#xA0; .dw gamebkgd4&#xA0;&#xA0; ;;level 4 background<br>
&#xA0; .dw gamebkgd5&#xA0;&#xA0; ;;level 5 background<br>
&#xA0; .dw gamebkgd6&#xA0;&#xA0; ;;level 6 background<br>
&#xA0; .dw gamebkgd7&#xA0;&#xA0; ;;level 7 background<br>
&#xA0; .dw gamebkgd8&#xA0;&#xA0; ;;level 8 background<br>
&#xA0; .dw gamebkgd9&#xA0;&#xA0; ;;level 9 background<br>
&#xA0; .dw gamebkgd10&#xA0; ;;level 10 background<br>
&#xA0; .dw gamebkgd11&#xA0; ;;level 11 background<br>
&#xA0; .dw gamebkgd12&#xA0; ;;level 12 background<br>
&#xA0; .dw gamebkgd13&#xA0; ;;level 13 background<br>
&#xA0; .dw gamebkgd14&#xA0; ;;level 14 background<br>
&#xA0; .dw gamebkgd15&#xA0; ;;level 15 background<br>
<br>
gamebkgd0:&#xA0; ;a full table of tile numbers that fill up the screen.&#xA0; you&apos;ll need one of these for<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;every &quot;.dw&quot; in the pointer table.<br>
&#xA0;&#xA0; &#xA0;.db $05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05, etc, etc<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__31">
                                                        <div class="mdl-card__title"><strong>JKeefe56</strong> posted on 
		
			
				
				May 17, 2013 at 1:15:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Khan and MRN, thank you very much for this.
<br>
<br>KHAN - The script will be very helpful, I&apos;m sure.  I can&apos;t wait to implement it.  What does dw stand for?  I&apos;ve only ever seen .db before.
<br>
<br>MRN - Thank you as well.  I think that was what was screwing me up...I kept trying to just re-load images, as opposed to initialize the ram, and doing everything over from the start.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__32">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				May 17, 2013 at 4:11:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>JKeefe56</b></i><br>
	<br>
	What does dw stand for? I&apos;ve only ever seen .db before.<br>
	&#xA0;</div>
<br>
As .db is a byte-sized chunk, .dw is a word sized chunk.&#xA0;<br>
<br>
.db $12 ; 8-bit number<br>
<br>
.dw $1234 ; 16-bit number<br>
<br>
MOST of the time, as in Kevin&apos;s example, it is an address in ROM. Some assemblers have different ways you can have a word-sized numeral for better readability, such as .addr (address):<br>
<br>
<span style="color: rgb(0, 0, 0); font-family: Geneva, Verdana, Arial, Helvetica, sans-serif; font-size: 11px;">.addr gamebkgd0&#xA0;&#xA0; ;;level 0 background</span><br style="color: rgb(0, 0, 0); font-family: Geneva, Verdana, Arial, Helvetica, sans-serif; font-size: 11px;">
<span style="color: rgb(0, 0, 0); font-family: Geneva, Verdana, Arial, Helvetica, sans-serif; font-size: 11px;">.addr gamebkgd1&#xA0;&#xA0; ;;level 1 background</span><br style="color: rgb(0, 0, 0); font-family: Geneva, Verdana, Arial, Helvetica, sans-serif; font-size: 11px;">
<span style="color: rgb(0, 0, 0); font-family: Geneva, Verdana, Arial, Helvetica, sans-serif; font-size: 11px;">.addr gamebkgd2&#xA0;&#xA0; ;;level 2 background<br>
; etc etc etc<br>
<br>
That just depends on the assembler that you end up choosing though.</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__33">
                                                        <div class="mdl-card__title"><strong>acomicbookguyc</strong> posted on 
		
			
				
				May 17, 2013 at 4:19:05 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					What are some classes one could take at say a Community College to get a better idea about programming.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__34">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 17, 2013 at 2:47:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>acomicbookguyc</b></i><br>
	<br>
	What are some classes one could take at say a Community College to get a better idea about programming.</div>
<br>
I&apos;m sure that varies school to school.&#xA0; You&apos;d just have to check their curriculum.&#xA0; I doubt there would be anything directly assembly language related though.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__35">
                                                        <div class="mdl-card__title"><strong>m308gunner</strong> posted on 
		
			
				
				May 17, 2013 at 2:52:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Roth</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>JKeefe56</b></i><br>
		<br>
		What does dw stand for? I&apos;ve only ever seen .db before.<br>
		&#xA0;</div>
	<br>
	As .db is a byte-sized chunk, .dw is a word sized chunk.&#xA0;<br>
	<br>
	.db $12 ; 8-bit number<br>
	<br>
	.dw $1234 ; 16-bit number<br>
	<br>
	MOST of the time, as in Kevin&apos;s example, it is an address in ROM. Some assemblers have different ways you can have a word-sized numeral for better readability, such as .addr (address):<br>
	<br>
	<span style="color: rgb(0, 0, 0); font-family: Geneva, Verdana, Arial, Helvetica, sans-serif; font-size: 11px;">.addr gamebkgd0&#xA0;&#xA0; ;;level 0 background</span><br style="color: rgb(0, 0, 0); font-family: Geneva, Verdana, Arial, Helvetica, sans-serif; font-size: 11px;">
	<span style="color: rgb(0, 0, 0); font-family: Geneva, Verdana, Arial, Helvetica, sans-serif; font-size: 11px;">.addr gamebkgd1&#xA0;&#xA0; ;;level 1 background</span><br style="color: rgb(0, 0, 0); font-family: Geneva, Verdana, Arial, Helvetica, sans-serif; font-size: 11px;">
	<span style="color: rgb(0, 0, 0); font-family: Geneva, Verdana, Arial, Helvetica, sans-serif; font-size: 11px;">.addr gamebkgd2&#xA0;&#xA0; ;;level 2 background<br>
	; etc etc etc<br>
	<br>
	That just depends on the assembler that you end up choosing though.</span></div>
&#xA0; So .dw means Data Word, and .db means Data Byte?<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__36">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				May 17, 2013 at 2:58:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>m308gunner</b></i><br>
	<br>
	&#xA0; So .dw means Data Word, and .db means Data Byte?<br>
	&#xA0;</div>
<br>
Sounds about right!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__37">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 17, 2013 at 4:22:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>JKeefe56</b></i><br>
	<br>
	Khan and MRN, thank you very much for this.<br>
	<br>
	KHAN - The script will be very helpful, I&apos;m sure. I can&apos;t wait to implement it. What does dw stand for? I&apos;ve only ever seen .db before.<br>
	<br>
	MRN - Thank you as well. I think that was what was screwing me up...I kept trying to just re-load images, as opposed to initialize the ram, and doing everything over from the start.</div>
<br>
<br>
Don&apos;<font face="Times New Roman"><font color="#000000" size="3">t clear out all the RAM, just the stuff applicable to the rooms.<br>
<br>
You can also use:<br>
&#xA0; .byte<br>
&#xA0; .word</font></font><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__38">
                                                        <div class="mdl-card__title"><strong>XYZ</strong> posted on 
		
			
				
				May 18, 2013 at 11:40:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am taking a slightly different approach to learning 6502 than jumping right into the Nerdy Nights. I have read the first 4 tutorials but before I move on, I am trying to learn 6502 from scratch. Every book I have skimmed always begins with hex-dec-bin and doing math with these. The next thing covered is explanations of the 7 flags and operand formats, such as indexed direct and immediate. My question is for some of the veterans to tell us what stuff is key and most important to know in 6502. Just so we have an idea what things we need to have a good understanding of. I feel like ASCII code is not useful for NES game making, so I have not spent as much time on it as I have with HEX math. I am hoping for a response that might give us a very skeletal overview of what stuff is integral. Clearly, the 6502 books don&apos;t cover sprites, sound, controller input, or anything to make games - it&apos;s just about learning the actual language and its concepts.<br>
<br>
Also, I am having a hard time with LDA/STA and remembering which does which. Sure, it might be easy for some, but I keep confusing the two. How do you guys go about this? Load the Accumulator and Store the Accumulator. Sound the same but do two completely different things. I hate having to look in my notes every single time. I need &quot;hints&quot; and &quot;tricks&quot; to memorizing key stuff.<br>
<br>
Do you guys take notes? Do you write things down in a notebook or do everything using the computer?<br>
<br>
Mostly general questions about approaches you take. Not necessarily specifics to a program I am working on. But that&apos;s because I haven&apos;t started my program yet. Your answers will help me move forward though!!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__39">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 18, 2013 at 12:02:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I mostly remember &quot;Load&quot; and &quot;Store&quot; as in you have to &quot;Load&quot; something to change it, and when you&apos;re done, you &quot;Store&quot; it when you&apos;re done. Like when you go grocery shopping. You store everything away in the cabinets and walk away. I don&apos;t really know how else to explain it. Just give it some time. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
I think a lot of people that are learning to program are getting hung up on math. I have no idea what %01010101 is in decimal. I have no idea what $E4 is in decimal. When I need to know these things, I open up the Windows calculator, turn it to Hex or Bin, type in the value, then change it to Dec and it converts it for me. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
The main thing you&apos;re going to have to understand is the various values of addresses on the Nintendo, because you&apos;re going to be manipulating them over and over and over.<br>
<br>
The nametable you&apos;re going to be using 95% of the time is $2000. The sprites you&apos;re using will be starting at $0200 (or $0300 depending on where you put them.) The palette is at $3F00. All of these addresses are just things you&apos;re going to have to ingrain in your memory, because that&apos;s the stuff you&apos;re going to be changing.<br>
<br>
Other than that, the main thing you&apos;re going to have to learn is how certain things are changed and when you can change them. Moving a sprite across the screen can be done at anytime. Changing a tile of the background can only be done in a very short time called Vblank, which sounds complicated, but there&apos;s a specific location in your assembly document where all this stuff goes. Eventually if you try to do too much there, it will run out of time and things start blowing up, so you have to be very careful.<br>
<br>
I generally don&apos;t take notes, but I do have to open up some of the Nerdy Nights tutorials every now and then to remind myself on how to do certain things.<br>
<br>
I build my entire games with only these commands haha.<br>
<br>
LDA<br>
STA<br>
CMP<br>
BEQ<br>
BNE<br>
BCC<br>
BCS<br>
LDX<br>
CPX<br>
TAX<br>
TXA<br>
LDY<br>
TAY<br>
TYA<br>
CPY<br>
ADC<br>
SBC<br>
JSR<br>
JMP<br>
<br>
Well, I guess that&apos;s more commands than I thought.&#xA0; Still seems simple! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__40">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				May 18, 2013 at 1:06:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>XYZ</b></i><br>
	<br>
	Also, I am having a hard time with LDA/STA and remembering which does which. Sure, it might be easy for some, but I keep confusing the two. How do you guys go about this? Load the Accumulator and Store the Accumulator.</div>
If you really need to, write it down on a sticky note (either a virtual one or a real one):&#xA0;&quot;LDA: Load from memory to A, STA: Store from A to memory&quot;.&#xA0;You will without a doubt learn it by heart after using it for a a couple of weeks.<br>
<br>
As for hexadecimal and other numbering systems, I agree with KHAN. The most important thing is to understand that all of the numbering systems are just different <em>representations </em>for the same number. It&apos;s also useful to understand some relations between them, for example the fact that a hexadecimal digit (0 through F) corresponds to 4 binary digits (bits) (e.g. $F = %1111). But don&apos;t get hung up with conversions.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__41">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				May 18, 2013 at 2:49:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	Moving a sprite across the screen can be done at anytime.</div>
<br>
<br>
Really? I thought you updated the sprite RAM and then used DMA in the VBLANK.<br>
Can you use writes to $2003/4 outside NMI?<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__42">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 18, 2013 at 3:32:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					All you&apos;d be doing is changing the value of $0300/$0303 (or whatever sprite you&apos;re moving), so yes, that can be done anytime.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__43">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				May 18, 2013 at 3:39:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry, I was just nitpicking. <span class="sprites_emoticons absmiddle" id="emo_wink"></span>
<br>I meant, the sprites aren&apos;t actually changed when you change the sprite RAM.
<br>But it is easy as changing it anytime you want, since you can just DMA one RAM page to the sprite OAM.
<br>
<br>Or am I wrong here?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__44">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 18, 2013 at 5:05:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	Sorry, I was just nitpicking.<br>
	I meant, the sprites aren&apos;t actually changed when you change the sprite RAM.<br>
	But it is easy as changing it anytime you want, since you can just DMA one RAM page to the sprite OAM.<br>
	<br>
	Or am I wrong here?</div>
<br>
Oh, I see what you&apos;re saying.&#xA0; Yes, if you&apos;re being nitpicky about it you are correct.&#xA0; I&apos;m just trying to explain things to people who have no idea what you&apos;re talking about (most people reading this thread).<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__45">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				May 18, 2013 at 5:07:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	Sorry, I was just nitpicking.<br>
	I meant, the sprites aren&apos;t actually changed when you change the sprite RAM.<br>
	But it is easy as changing it anytime you want, since you can just DMA one RAM page to the sprite OAM.<br>
	<br>
	Or am I wrong here?</div>
That&apos;s correct. (Calling it &quot;sprite RAM&quot; is misleading though, better call it something like &quot;shadow OAM&quot; or &quot;shadow sprite RAM&quot; instead because &quot;sprite RAM&quot; is usually used to refer to the 256 byte sprite RAM that&apos;s inside the PPU).<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__46">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				May 18, 2013 at 5:24:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry. <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
<br>
<br>I have a question. Is it common to interpret a value as a 2&apos;s complement signed number,
<br>and use the negative values for left movement and positive values for right movement?
<br>Could you then get away with just adding a value to the sprite&apos;s X value every time you move?
<br>You know, instead of having to branch and subtract if you want to move left?
<br>If this is a good idea, some example code would be appreciated. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>An example or explanation of sub-pixel movement would also be nice.
<br>
<br>I hope I&apos;m making sense, thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__47">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				May 18, 2013 at 5:26:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>DoNotWant</b></i><br>
		<br>
		Sorry, I was just nitpicking.<br>
		I meant, the sprites aren&apos;t actually changed when you change the sprite RAM.<br>
		But it is easy as changing it anytime you want, since you can just DMA one RAM page to the sprite OAM.<br>
		<br>
		Or am I wrong here?</div>
	That&apos;s correct. (Calling it &quot;sprite RAM&quot; is misleading though, better call it something like &quot;shadow OAM&quot; or &quot;shadow sprite RAM&quot; instead because &quot;sprite RAM&quot; is usually used to refer to the 256 byte sprite RAM that&apos;s inside the PPU).</div>
Ok, I will remember that, kiitos!<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__48">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				May 18, 2013 at 6:09:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	I have a question. Is it common to interpret a value as a 2&apos;s complement signed number,<br>
	and use the negative values for left movement and positive values for right movement?</div>
Yes.<br>
<br>
<div class="FTQUOTE" style="width: 529.59375px;">
	<i>Originally posted by:&#xA0;<b>DoNotWant</b></i><br>
	<br>
	Could you then get away with just adding a value to the sprite&apos;s X value every time you move?<br>
	You know, instead of having to branch and subtract if you want to move left?<br>
	An example or explanation of sub-pixel movement would also be nice.</div>
Yes. Basically your signed number would be the X velocity here.<br>
<br>
To get sub-pixel movement you would make the velocity a fixed point number, for example 8.8 fixed point (8 bits for the whole part, 8 bits for the fractional part, 16 bits total). The position also needs a fractional part, so you would make that a fixed point number as well.<br>
<br>
Then just add the velocity to the object position on every frame, and modify the velocity depending on which direction you want the object to move. If you add a constant value to velocity on every frame, you get acceleration/deceleration.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__49">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				May 18, 2013 at 9:12:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>XYZ</b></i><br>
	<br>
	I am taking a slightly different approach to learning 6502 than jumping right into the Nerdy Nights. I have read the first 4 tutorials but before I move on, I am trying to learn 6502 from scratch. Every book I have skimmed always begins with hex-dec-bin and doing math with these. The next thing covered is explanations of the 7 flags and operand formats, such as indexed direct and immediate. My question is for some of the veterans to tell us what stuff is key and most important to know in 6502. Just so we have an idea what things we need to have a good understanding of. I feel like ASCII code is not useful for NES game making, so I have not spent as much time on it as I have with HEX math. I am hoping for a response that might give us a very skeletal overview of what stuff is integral. Clearly, the 6502 books don&apos;t cover sprites, sound, controller input, or anything to make games - it&apos;s just about learning the actual language and its concepts.<br>
	<br>
	Also, I am having a hard time with LDA/STA and remembering which does which. Sure, it might be easy for some, but I keep confusing the two. How do you guys go about this? Load the Accumulator and Store the Accumulator. Sound the same but do two completely different things. I hate having to look in my notes every single time. I need &quot;hints&quot; and &quot;tricks&quot; to memorizing key stuff.<br>
	<br>
	Do you guys take notes? Do you write things down in a notebook or do everything using the computer?<br>
	<br>
	Mostly general questions about approaches you take. Not necessarily specifics to a program I am working on. But that&apos;s because I haven&apos;t started my program yet. Your answers will help me move forward though!!</div>
<br>
The more code you write, it&apos;ll become more clear. Maybe try to come up with metaphors for yourself. I probably take it for granted, but I think of the accumulator as like, your workspace. LDA puts a number on your workspace. STA, &quot;stores&quot; something that had been on your workspace (but leaves a copy there) when you&apos;re done with what you had been working on. Not sure if that helps.<br>
<br>
When I first did NES code, I had had some x86 background but had to look things up quite a bit to get a hang of 6502. New assembly languages will have a different feel but will use the same concepts, if that makes sense. Once you know binary, hex, bitwise operations, branches, addressing modes, 2&apos;s complement....etc. you can pick up any assembly language. Basically just keep at it.<br>
<br>
It&apos;s hard to gain so much fluency in assembly language that you don&apos;t have to sketch something out &quot;in pseudo code&quot; first. I&apos;m starting to get almost that comfortable with 6502, after one game and now working on another, but usually I have my devlog up while working, and I think &quot;out loud&quot; into my text document for quite a while before coding something. I usually break it down into lots of tiny chunks and work on them one at a time. I definitely wouldn&apos;t fit the stereotypical thought of &quot;guy staying up late hammering out code at a million miles an hour&quot; heck, sometimes I sit and think and write in my devlog and just sit there..for a long time, before actually coding anything. Even now, it is a slow process. I have no idea if this is normal or not, or if there are some folks out there who can do it way more efficiently, but....I&apos;m able to do it and I&apos;m happy I&apos;m doing it.&#xA0; I guess that&apos;s why I feel so compelled to get others into it or help out somehow. I know I&apos;m not a genius, I just realllly want to do this stuff, even if I&apos;m slow as moles&apos; asses in january at it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__50">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jun 4, 2013 at 9:47:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					A couple of general questions:
<br>
<br>1.  Regarding compilers, what type of differences exist between each of them. Are they essential differences, or &quot;merely&quot; matters of how one goes about writing code? The reason that I ask is that I read somewhere a while back (cannot recall where) some rather negative remarks about NESASM3 and did not know if learning another compiler would be necessary in the near future. Will NESASM3 get the job done when it comes to making games? I have a feeling that it will, and if it did not have some critics I would be worried (like fifty glowing Amazon reviews for the next piece of exercise equipment), but I thought that I would check. If anyone has continued to use NESASM3 beyond the Nerdy Nights tutorials I would be interested to know. I saw some discussion on NESdev, but it was geared more toward &quot;name your favorite compiler,&quot; and it did not seem to address general or generally specific differences between the different options.
<br>
<br>2.  In terms of graphics, what purpose do programs like Tile Layer Pro serve for the homebrewer? Most of the information that I have been able to find about this type of program relates to ROM hacking so even a broad overview would be helpful (or a link to a broad overview). Is this somewhat similar to the map editor that Sivak wrote for his games, or that Maiu posted a while back for Project P (<br clear="all"><div class="col-md-6"><div class="embed-responsive embed-responsive-16by9"><a href="https://www.youtube.com/DjYeB604a1s?list=UUGNm2vGRTPwbO0Q6u-X7MuA&amp;index=6">Youtube</a></div></div><br clear="all">)? It would appear that at least the latter programs would alleviate some of the need for coding each individual tile of the background (not trying to bypass that essential skill, but just looking ahead).
<br>
<br>Thanks in advance!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__51">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jun 4, 2013 at 2:09:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>NESHERO27</b></i><br>
	<br>
	A couple of general questions:<br>
	<br>
	1. Regarding compilers, what type of differences exist between each of them. Are they essential differences, or &quot;merely&quot; matters of how one goes about writing code? The reason that I ask is that I read somewhere a while back (cannot recall where) some rather negative remarks about NESASM3 and did not know if learning another compiler would be necessary in the near future. Will NESASM3 get the job done when it comes to making games? I have a feeling that it will, and if it did not have some critics I would be worried (like fifty glowing Amazon reviews for the next piece of exercise equipment), but I thought that I would check. If anyone has continued to use NESASM3 beyond the Nerdy Nights tutorials I would be interested to know. I saw some discussion on NESdev, but it was geared more toward &quot;name your favorite compiler,&quot; and it did not seem to address general or generally specific differences between the different options.</div>
<br>
I still use NESASM3 exclusively, and as far as I know the only differences are how you write things.&#xA0; Of course I am not an expert in this area, so I&apos;ll let someone more knowledgeable chime in.&#xA0; Bunnyboy still updates NESASM3 when bugs are discovered, but as far as I know everything major has been worked out at this point.&#xA0; I&apos;ve never had any problems with it, anyway.<br>
<div class="FTQUOTE">
	<i>Originally posted by: <b>NESHERO27</b></i><br>
	<br>
	2. In terms of graphics, what purpose do programs like Tile Layer Pro serve for the homebrewer? Most of the information that I have been able to find about this type of program relates to ROM hacking so even a broad overview would be helpful (or a link to a broad overview). Is this somewhat similar to the map editor that Sivak wrote for his games, or that Maiu posted a while back for Project P (<br clear="all"><div class="col-md-6"><div class="embed-responsive embed-responsive-16by9"><a href="https://www.youtube.com/DjYeB604a1s?list=UUGNm2vGRTPwbO0Q6u-X7MuA">Youtube</a></div></div><br clear="all">)? It would appear that at least the latter programs would alleviate some of the need for coding each individual tile of the background (not trying to bypass that essential skill, but just looking ahead).<br>
	<br>
	Thanks in advance!</div>
I only use Tile Layer Pro for drawing tiles, creating the .chr file that I .include in my assembly files.&#xA0; I don&apos;t know of its potential to actually create map data (and honestly, I had no idea that Project P existed until you just posted that.&#xA0; It looks amazing!)&#xA0; I&apos;ve personally use&#xA0;(and I know a few other homebrewers that also use) nesst for my games, which doesn&apos;t have the drag and drop feature that Project P has, but it still works very well for what I need.<br>
<br>
Hopefully some more developers will jump in here and answer from their perspectives.&#xA0; They may know of features/tools that I haven&apos;t used.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__52">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Jun 5, 2013 at 11:43:34 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>NESHERO27</b></i><br>
	<br>
	A couple of general questions:<br>
	<br>
	1. Regarding compilers, what type of differences exist between each of them. Are they essential differences, or &quot;merely&quot; matters of how one goes about writing code? The reason that I ask is that I read somewhere a while back (cannot recall where) some rather negative remarks about NESASM3 and did not know if learning another compiler would be necessary in the near future. Will NESASM3 get the job done when it comes to making games? I have a feeling that it will, and if it did not have some critics I would be worried (like fifty glowing Amazon reviews for the next piece of exercise equipment), but I thought that I would check. If anyone has continued to use NESASM3 beyond the Nerdy Nights tutorials I would be interested to know. I saw some discussion on NESdev, but it was geared more toward &quot;name your favorite compiler,&quot; and it did not seem to address general or generally specific differences between the different options.<br>
	<br>
	2. In terms of graphics, what purpose do programs like Tile Layer Pro serve for the homebrewer? Most of the information that I have been able to find about this type of program relates to ROM hacking so even a broad overview would be helpful (or a link to a broad overview). Is this somewhat similar to the map editor that Sivak wrote for his games, or that Maiu posted a while back for Project P (<br clear="all"><div class="col-md-6"><div class="embed-responsive embed-responsive-16by9"><a href="https://www.youtube.com/DjYeB604a1s?list=UUGNm2vGRTPwbO0Q6u-X7MuA">Youtube</a></div></div><br clear="all">)? It would appear that at least the latter programs would alleviate some of the need for coding each individual tile of the background (not trying to bypass that essential skill, but just looking ahead).<br>
	<br>
	Thanks in advance!</div>
<br>
1. It&apos;s not so much HOW you write things, but more of what features are available to ease how you code, I guess you could say. From what I can tell, the assemblers that people generally find the most easy to set up and get started for NES programs are ASM6 and NESASM. I believe Sivak also uses NESASM, so it seems to work fine for bigger projects.<br>
<br>
2. Tile Layer Pro is pretty much exclusively for making the 8x8 tiles for the graphics. It doesn&apos;t do anything like help you arrange background tiles into readable data for games. People usually make their own programs to ease the process of making backgrounds. If your backgrounds aren&apos;t too complicated, you can just enter the data into an ASM file. I had no problems using this method for NES Virus Cleaner, because the backgrounds were pretty much 5 or so different 16x16 tiles, and it was single-screen gaming. It all depends on how big your game is going to be, or if you need any compression at all for your backgrounds. 8name from the Pin Eight tools or the aforementioned NESST can be used to make nametables without compression, and used directly in your game. You just have to remember that each uncompressed nametable is 1k worth of data. It&apos;s all pretty much game specific.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__53">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jun 5, 2013 at 12:19:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That about covers what I needed to know, thanks guys. As far as compilers go, if it is good enough to make the Battle Kid games and your various games Khan (anxiously awaiting Study Hall and Unicorn, not to mention The Great Gatsby), it is good enough for me. As for the second question, I was beginning to guess that they were two different things, thanks Roth for helping to clarify and explain both types of programs. The power of the unicorn protects!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__54">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jun 5, 2013 at 12:22:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Roth</b></i><br>
	<br>
	the aforementioned NESST can be used to make nametables without compression, and used directly in your game. You just have to remember that each uncompressed nametable is 1k worth of data. It&apos;s all pretty much game specific.</div>
NESST (short for NES Screen Tool, BTW) can also export RLE-compressed data, and 6502 source of a RLE-decompressor is included in the package. Shiru himself (author of NESST) has used the program to create the levels in some of his games.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__55">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Jun 5, 2013 at 2:15:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ah, thanks for the clarification Kalle! I opened NESST real quick to look for something like that but didn&apos;t see anything right away. <br clear="all"><div class="col-md-6"><div class="embed-responsive embed-responsive-16by9"><a href="https://www.youtube.com/v3rhQc666Sg">Youtube</a></div></div><br clear="all">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__56">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Jun 5, 2013 at 2:22:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I personally really like CA65 for large projects. My favorite thing about it is the ability to use segments. So if you have to spread things across different banks, it is easy to do it all in one source file and have related code and data together. The only way to do this with simpler assemblers such as nesasm or asm6, as far as I know (someone please step in and correct me if I am wrong), is to cleverly use a lot of split-up files as .includes in a higher level master file that has all the .org&apos;s and .pad&apos;s you&apos;ll need to lay out your code and data in banks. I can see that working alright----I just like the convenience and &quot;pro feeling&quot; of CA65. Other than the .segments feature....I know I like to use .scope and .endscope a lot, so when I use local labels I can give them nice names but be able to re-use them later without causing too much trouble. None of these considerations should be important for anybody starting out, though.<br>
<br>
As for editors, I wrote my own graphics editor and level editor in C#. I&apos;ve previously <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=99434" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=99434">shared these</a> for others to use, and I know at least one guy who used them to help him develop a game.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__57">
                                                        <div class="mdl-card__title"><strong>tex_hammer</strong> posted on 
		
			
				
				Jun 14, 2013 at 9:49:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m sorry if you have already heard this question, and I have already asked it, but I am a Mac user and have absolutely NO idea how to program for NES games. I don&apos;t even know how to program, period. I have Xcode, but I need some help with that. What would I write first if I were to start programming an NES game in Xcode? And when it&apos;s all done, how would I convert it into an .NES file, put it onto an NES motherboard and into an NES cart? If none of this can be done in Xcode, what sort of Mac-compatible programming software can be used to do this?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__58">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jun 14, 2013 at 9:50:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					XCode is just for Mac stuff, it doesn&apos;t and never will assemble NES program. Best bet, outside of virtual boxing all the programs available online, is to go buy a Windows machine. An old XP/7 tower or something.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__59">
                                                        <div class="mdl-card__title"><strong>tex_hammer</strong> posted on 
		
			
				
				Jun 14, 2013 at 9:57:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	XCode is just for Mac stuff, it doesn&apos;t and never will assemble NES program. Best bet, outside of virtual boxing all the programs available online, is to go buy a Windows machine. An old XP/7 tower or something.</div>
<br>
<br>
Hmm. Well darn. Oh well. Thanks for the input anyway. I guess I should start saving my money.<br>
<br>
But just to be clear, is most or all of the NES programming software out there Windows based?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__60">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jun 14, 2013 at 10:03:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					99.99999% is windows based. There&apos;s some assemblers and such which should compile on Linux and Mac. I run Linux and have gotten ASM6 to compile quick. But most of the tools with GUI&apos;s (Namtable and graphics editors) are basically Windows only. There&apos;s one IDE, NESICIDE, that has Linux and Windows versions, but I dunno about Mac.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__61">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jun 14, 2013 at 10:08:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The NESASM and ASM6 assemblers are easily compiled for MacOS so you can make games, but right now the best greaphics tools and debuggers are Windows only. Hopefully NESICIDE will get more stable because it really is meant to be cross platform. I primarily use Xcode-&gt;NESASM-&gt;Nestopia, then drop into Parallels/XP to use FCEUX for debugging when needed. A separate box would be too much hassle.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__62">
                                                        <div class="mdl-card__title"><strong>tex_hammer</strong> posted on 
		
			
				
				Jun 14, 2013 at 10:09:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	99.99999% is windows based. There&apos;s some assemblers and such which should compile on Linux and Mac. I run Linux and have gotten ASM6 to compile quick. But most of the tools with GUI&apos;s (Namtable and graphics editors) are basically Windows only. There&apos;s one IDE, NESICIDE, that has Linux and Windows versions, but I dunno about Mac.</div>
<br>
What would be the best NES programming software for Windows? Or at least the best one that you have used? Or what you have heard other people say nice things about?<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__63">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jun 14, 2013 at 10:11:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It&apos;s ALL different. On windows, NESst and YY-chr 0.99 beta 2 (?) are the best tools for nametables and graphics editing. Compilers, there&apos;s tons to chose from. Nerdy nights use NESASM3. There&apos;s ASM6, most people use that. NESICIDE&apos;s stuff...so many more. I&apos;d worry about going over the basics and trying to understand the nerdy nights for. This stuff is so difficult, you have to do this for a while before you&apos;re qualified to know what tools to use to do anything, really.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__64">
                                                        <div class="mdl-card__title"><strong>gliptitude</strong> posted on 
		
			
				
				Jun 15, 2013 at 8:43:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok I have a vague question that is more an intellectual one, rather than an immediate programming issue. (If I were in process of programming something, I would be nowhere near as advanced as this issue in my endeavor).<br>
<br>
Basically I am just wondering how the scrolling in BURAI FIGHTER is conceived of, especially in the Game Boy version. (I have only baaarely played the NES version and the scrolling changes direction much less than the Game Boy version, at least in the beginning of the game).<br>
<br>
It just seems like such an unusual mechanic and I am wondering if it would be difficult to repeat.<br>
<br>
(At least on the Game Boy version) The screen scrolls in at least 4 different directions, (perhaps 8) and at times the scrolling is not strictly imposed by the level, but rather scrolls according to the direction that the player chooses to move in. VERY STRANGE.<br>
<br>
... So it is my understanding that SCROLLING is a very essential part of NES programming, something that the console was optimized for and one of the main things that sets it apart from its predecessors. (I assume that the Game Boy was set up in a similar way in this respect and I also assume that the NES Burai Fighter at least had SOME of the weird multi-directional scrolling of the Game Boy version). I know that the design/concept of scrolling in this game is quite unique - and I am wondering if the PROGRAMMING of this scrolling would be as obscure as it appears????
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__65">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jun 15, 2013 at 9:11:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The burai fighters scrolling wouldn&apos;t bee too hard at all. Although, the main thing is, you need to develop the skills of problem solving stuff with arrays and logic as you learn. Looking at that with my experience, it&apos;s not bad at all if you plan it out right the first time. If I saw that when I was starting out, there&apos;d be no way in hell I&apos;d be able to write it in 100 times. <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__66">
                                                        <div class="mdl-card__title"><strong>gliptitude</strong> posted on 
		
			
				
				Jun 21, 2013 at 7:00:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	The burai fighters scrolling wouldn&apos;t bee too hard at all. Although, the main thing is, you need to develop the skills of problem solving stuff with arrays and logic as you learn. Looking at that with my experience, it&apos;s not bad at all if you plan it out right the first time. If I saw that when I was starting out, there&apos;d be no way in hell I&apos;d be able to write it in 100 times.</div>
<br>
Now I have gotten ahold of NES Burai Fighter on cart, and confirmed that the scrolling definitely is much less complicated than on the Game Boy version. ... Do the differences between the two factor in at all to your answer? Is the Game Boy one still basically as simple of a programming task as the NES one?<br>
<br>
In my dirty readings of Nerdy Nights etc, I thought I read that scrolling involved drawing the background graphics off screen, a full screen area in advance. Can this be done for a diagonal scroll???? Is diagonal scrolling more complicated than horizontal or vertical?<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__67">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jun 21, 2013 at 7:29:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, diagonal scroll is kinda hard to do right, but it&apos;s still easily possible, even if it has some glitches, even the GBC game isn&apos;t too hard to do.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__68">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jun 22, 2013 at 3:36:08 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>gliptitude</b></i><br>
	<br>
	In my dirty readings of Nerdy Nights etc, I thought I read that scrolling involved drawing the background graphics off screen, a full screen area in advance. Can this be done for a diagonal scroll???? Is diagonal scrolling more complicated than horizontal or vertical?<br>
	&#xA0;</div>
You don&apos;t need to draw a full screen in advance. You will draw new stuff when required. For example, if you limit the &quot;camera&quot; to move 8 pixels/frame in a single direction, you will need to draw at most one 8 pixel row/column per frame.<br>
<br>
Diagonal scrolling is significantly harder to implement than simple horizontal/vertical scrolling. But it also depends on where you cap the scroll speed and other limitations you set. For example, if you never scroll more than 1-2 pixels per frame in a direction and force the scrolling to end on a 8x8 grid (could be usable in an RPG style game, or an overworld map in general), it&apos;s easier to implement than allowing the screen to scroll 16 pixels in either direction on each frame.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__69">
                                                        <div class="mdl-card__title"><strong>gliptitude</strong> posted on 
		
			
				
				Jun 22, 2013 at 12:51:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	You don&apos;t need to draw a full screen in advance. You will draw new stuff when required. For example, if you limit the &quot;camera&quot; to move 8 pixels/frame in a single direction, you will need to draw at most one 8 pixel row/column per frame.<br>
	<br>
	Diagonal scrolling is significantly harder to implement than simple horizontal/vertical scrolling. But it also depends on where you cap the scroll speed and other limitations you set. For example, if you never scroll more than 1-2 pixels per frame in a direction and force the scrolling to end on a 8x8 grid (could be usable in an RPG style game, or an overworld map in general), it&apos;s easier to implement than allowing the screen to scroll 16 pixels in either direction on each frame.</div>
<br>
Interesting. Thank you for this answer.<br>
<br>
... Even though space shooters are a totally pervasive genre of games, I actually feel that the NES is lacking in them, and it seems like a very ripe area for homebrew to me. I know that there are plenty of them on NES, but honestly almost every one of them irritates me. (Lifeforce gives me nightmares.) A lot of them feel very samey and others have colors and imagery that stress me out.  ... Generally the DMG Game Boy versions are much more entertaining for me.<br>
<br>
Burai Fighter really stands out for me as a true original, though it also has many of the colors and graphics that bother me. ... The bizarre scrolling concept seems like a technique that could be elaborated on in a new game with really interesting results.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__70">
                                                        <div class="mdl-card__title"><strong>m308gunner</strong> posted on 
		
			
				
				Jun 28, 2013 at 3:14:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So I&apos;ve been stumped by the Nerdy Nights example below for about a year now and I think I finally understand it. Is my example underneath the original accurate?
<br>
<br><a href="http://s1341.photobucket.com/user/m308gunner1/media/More%20NES%20Games/GraphicsBuilding_zps1df2672d.jpg.html" target="_blank" original-href="http://s1341.photobucket.com/user/m308gunner1/media/More%20NES%20Games/GraphicsBuilding_zps1df2672d.jpg.html"><img src original-src="http://i1341.photobucket.com/albums/o754/m308gunner1/More%20NES%20Games/GraphicsBuilding_zps1df2672d.jpg" show-src="scraper/images/GraphicsBuilding_zps1df2672d.jpg"></a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__71">
                                                        <div class="mdl-card__title"><strong>m308gunner</strong> posted on 
		
			
				
				Jul 3, 2013 at 11:18:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Bump for help.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__72">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jul 3, 2013 at 12:36:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>m308gunner</b></i><br>
	<br>
	So I&apos;ve been stumped by the Nerdy Nights example below for about a year now and I think I finally understand it. Is my example underneath the original accurate?</div>
Your example seems to be correct except for a small thing: the NES will not actually render the black color from color #4 of the palette, it will always use color #0 for the background color (i.e. when the 2 bits of the pattern table tile data are %00). In other words, if the final color index is 0, 4, 8 or 12, NES will always render with color #0.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__73">
                                                        <div class="mdl-card__title"><strong>kidkratos</strong> posted on 
		
			
				
				Jul 27, 2013 at 12:05:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi, I had just wondering about debugging support... or debugging symbols more specifically...
<br>
<br>Can nesasm produce debugging symbols? And is there a way to load them into the fceuxdsp debugger (or maybe nintendulator)?
<br>
<br>I see nesasm generates a .fls file, which looks like a map for the labels. I also see an option for the listing output level, but as I far as I can tell it has no effect(?). Also, is there a way to dump the global variables to the .fls?
<br>
<br>I&apos;ve seen nlgen which generates fceuxdsp readable symbol maps from ca65 generated code... I assume I could write something similar that converts a .fls into a format that fceuxdsp can read(?) (or maybe it can already read a .fls?).
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__74">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 3, 2013 at 4:28:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am trying to make a block grab a key (nothing like a &quot;simple&quot; port as a first post-Pong project). I have my block, and I have a two sprite key, and I have been able to get the block to push the key successfully. However, upon contact I would like to have the key move with the block in all eight directions. I have tried several things, but either A) I cannot get the key to maintain its position relative to the block on contact, or B) I cannot get the key to both push and pull with the block. I have also tried to map the location of the key to the block sprite, but understandably it does not maintain its position relative to the block.
<br>
<br>Looking ahead, where do sprites go when they need to be gotten rid of, say a castle gate that has been opened (and no, there is not an opened door sprite to take its place)? Are they simply turned off, moved off screen, or other things?
<br>
<br>Any help on these questions would be great. I will be away from the internet for a couple of days, so thanks in advance!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__75">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Aug 5, 2013 at 12:14:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					kidkratos, I&apos;m sorry.  I don&apos;t know the answers to your questions.  I was hoping someone more knowledgeable would pipe up.  We&apos;ll cross our fingers.
<br>
<br>Beau, the way I would probably code your problem is like this:
<br>
<br>1.) Check to see if your block is overlapping the key sprites in any location.  If so, set a zero page variable flag to 1.
<br>2.) Have a subroutine constantly checking to see if that variable is 1.  If so, move that sprite(s) in exactly the same way your controller is moving your block.
<br>
<br>When sprites need to be moved off screen, you can just move them to #$FF in either the x or y position.  Just keep in mind that if you have too many sprites moved to #$FF on the same scanline, you&apos;re going to run into problems!
<br>
<br>As always, my email address is always open to you, friend.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__76">
                                                        <div class="mdl-card__title"><strong>kidkratos</strong> posted on 
		
			
				
				Aug 5, 2013 at 6:41:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Kevin, thanks for the response and no worries.
<br>
<br>I&apos;m assuming that the support just isn&apos;t there yet for nesasm. I&apos;m guessing it&apos;s just a matter of time before someone adds it, maybe I will if/when I have some time... for now, I&apos;m just using ca65 / nintendulator which has the symbol debugging I was looking for.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__77">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 9, 2013 at 7:11:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks Kevin! The whole check variable thing was very helpful, I had not thought of doing things that way. Be on the lookout for another email this evening.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__78">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 30, 2013 at 1:35:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					In looking through some examples of games I have noticed that with the switch to more banks there is often also the inclusion of more &quot;reset vectors&quot; sections in the code at the end of some of the banks, but not others. Does anybody have any idea as to where or why to place them different places? Thanks.
<br>
<br>Oh, and in case &quot;reset vectors&quot; is not the right name, what I am talking about is this business:
<br>
<br>  .org $FFFA     ;first of the three vectors starts here
<br>  .dw NMI        ;when an NMI happens (once per frame if enabled) the 
<br>                 ;processor will jump to the label NMI:
<br>  .dw RESET      ;when the processor first turns on or is reset, it will jump
<br>                 ;to the label RESET:
<br>  .dw 0          ;external interrupt IRQ is not used in this tutorial
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__79">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Aug 30, 2013 at 5:17:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>NESHERO27</b></i><br>
	<br>
	In looking through some examples of games I have noticed that with the switch to more banks there is often also the inclusion of more &quot;reset vectors&quot; sections in the code at the end of some of the banks, but not others. Does anybody have any idea as to where or why to place them different places? Thanks.<br>
	<br>
	Oh, and in case &quot;reset vectors&quot; is not the right name, what I am talking about is this business:<br>
	<br>
	.org $FFFA ;first of the three vectors starts here<br>
	.dw NMI ;when an NMI happens (once per frame if enabled) the<br>
	;processor will jump to the label NMI:<br>
	.dw RESET ;when the processor first turns on or is reset, it will jump<br>
	;to the label RESET:<br>
	.dw 0 ;external interrupt IRQ is not used in this tutorial</div>
I think that is because they switch the PRG banks with the interrupt vectors in them, and they are always needed. How else would you get to your NMIs and your IRQs?<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__80">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Aug 30, 2013 at 5:22:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>NESHERO27</b></i><br>
	<br>
	In looking through some examples of games I have noticed that with the switch to more banks there is often also the inclusion of more &quot;reset vectors&quot; sections in the code at the end of some of the banks, but not others. Does anybody have any idea as to where or why to place them different places? Thanks.</div>
Depends on the mapper!<br>
<br>
Some mappers like UNROM switch only the first 16KB of PRG ($8000-BFFF) and keep the last 16KB ($C000-FFFF) as a fixed bank. &#xA0;In those cases the vectors are only needed in the last 16KB of PRG.<br>
<br>
Some mappers like AOROM switch all 32KB ($8000-FFFF) at once. &#xA0;In those cases the vectors need to be in every 32KB of PRG because you don&apos;t know what bank will be active when NMI/IRQ/reset happens. &#xA0;Hitting the reset button does not change the active bank for almost all mappers, so vectors must be available in any bank that could possibly be swapped in.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__81">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 30, 2013 at 9:35:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>NESHERO27</b></i><br>
		<br>
		...</div>
	Depends on the mapper!<br>
	<br>
	Some mappers like UNROM switch only the first 16KB of PRG ($8000-BFFF) and keep the last 16KB ($C000-FFFF) as a fixed bank. &#xA0;In those cases the vectors are only needed in the last 16KB of PRG.<br>
	<br>
	Some mappers like AOROM switch all 32KB ($8000-FFFF) at once. &#xA0;In those cases the vectors need to be in every 32KB of PRG because you don&apos;t know what bank will be active when NMI/IRQ/reset happens. &#xA0;Hitting the reset button does not change the active bank for almost all mappers, so vectors must be available in any bank that could possibly be swapped in.</div>
<br>
Well that certainly makes sense, I was not expecting such a clear solution <span class="sprites_emoticons absmiddle" id="emo_smile"></span> &#xA0;Thanks!<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__82">
                                                        <div class="mdl-card__title"><strong>Tommy The Cat</strong> posted on 
		
			
				
				Sep 4, 2013 at 1:14:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So I managed to fool around with some code and get NESASM to spit out a file that my NES emulator can run, which was super exciting.
<br>
<br>So, eventually I might actually get a game together, and I might want to put it on a cart, even a repro one.
<br>
<br>1) Is this possible using the code I write for NESASM and/or the file NESASM produces?
<br>
<br>2) If so, how do I actually get my game from my computer to the cart?
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__83">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Sep 5, 2013 at 1:05:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					1.) Yes.
<br>
<br>2.) PowerPak. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>  (Or bug a person who makes reproductions.  If you are deadset on doing it yourself, you&apos;ll need someone more knowledgeable than me!)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__84">
                                                        <div class="mdl-card__title"><strong>Amack1233</strong> posted on 
		
			
				
				Oct 13, 2013 at 6:08:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey guys,
<br>
<br>I&apos;m starting to make repros of particular roms for snes. I&apos;m looking to complete dragon quest 1,2,3,5,6  as well as chrono trigger crimson echoes, terranigma and others ! From what research I have conducted I realize most these games will esquire different EPROMs 32,36,40,44 pin chips. Can someone point me in the direction of a cheap programmer that will do most of these chips with minimal of adapters being purchased. Also If someone could point me in the direction of the software needed to remove the headers,checksum, pan out a file to a larger size or anything else anyone may know about putting roms on existing carts. 
<br>
<br>Thanks in advance for any responses
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__85">
                                                        <div class="mdl-card__title"><strong>Amack1233</strong> posted on 
		
			
				
				Oct 14, 2013 at 2:35:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey,
<br>
<br>I have a question regarding preparing files to be burnt to eproms. must the header always be removed? if not how do you know what cases to remove the header? what is the point, is it just to make the ROM a specific size? Next I was wondering about checksum. Does it always have to pass in order to have a working file burnt to a EPROM ? cause I noticed when I apply certain patches to certain roms the checksum then fails but the emulator will still play it quite fine. Would this be the case if put into a real SNES ? Also what would someone with experience suggest to use to modify and correct checksums ?
<br>
<br>Thanks for your help
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__86">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				Oct 14, 2013 at 4:46:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Amack1233</b></i><br>
	<br>
	Hey guys,<br>
	<br>
	I&apos;m starting to make repros of particular roms for snes. I&apos;m looking to complete dragon quest 1,2,3,5,6 as well as chrono trigger crimson echoes, terranigma and others ! From what research I have conducted I realize most these games will esquire different EPROMs 32,36,40,44 pin chips. Can someone point me in the direction of a cheap programmer that will do most of these chips with minimal of adapters being purchased. Also If someone could point me in the direction of the software needed to remove the headers,checksum, pan out a file to a larger size or anything else anyone may know about putting roms on existing carts.<br>
	<br>
	Thanks in advance for any responses</div>
I think you are a bit confused about what this thread is for.&#xA0;<br>
<br>
It is about programming homebrew games for the NES, not making reproductions. &#xA0;There are lots of good resources out there, try searching around.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__87">
                                                        <div class="mdl-card__title"><strong>doppelganger</strong> posted on 
		
			
				
				Oct 24, 2013 at 3:12:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I can only assume that you&apos;re working with the SNES, and referring to the SMC header.&#xA0; That header itself is not part of the ROM space and is not actually used by any emulator (that I know of).&#xA0; From what I know, emulators tend to rely on parts of the registration data inside the ROM at address space $00:$FFB0-$FFDF in order to figure out how the ROM is mapped to memory, and if any add-on chips need to be emulated.&#xA0; So yes, any headers like the SMC one need to be removed.<br>
<br>
As for the checksum, an SNES emulator may check it and the complement check to make sure the ROM contents are not corrupted as a courtesy, but this is not required in order for the ROM itself to run as long as the ROM contents are not corrupted.&#xA0; The SNES itself doesn&apos;t do anything with the checksum.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__88">
                                                        <div class="mdl-card__title"><strong>vcube1234</strong> posted on 
		
			
				
				Oct 29, 2013 at 11:02:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here&apos;s my question:
<br>
<br>How do ya make repros? <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__89">
                                                        <div class="mdl-card__title"><strong>coffeewithmrsaturn</strong> posted on 
		
			
				
				Oct 29, 2013 at 11:37:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This isn&apos;t exactly programming-related, but I just opened up an Ogre Battle snes cartridge and saw 3 of the big chips on the right side...is that normal? I don&apos;t recall seeing games with 3 of the large chips, even on the big boards for games with save batteries.<br>
<br>
edit: got antsy, made a thread: <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=8&amp;threadid=114090" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=8&amp;threadid=114090">http://www.nintendoage.com/forum/...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__90">
                                                        <div class="mdl-card__title"><strong>pk space jam</strong> posted on 
		
			
				
				Nov 13, 2013 at 11:46:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					OK so I am trying to make my sprite duck. I really need help, cant sleep until i figure this out, what am i doing wrong here. I am also JSR&apos;ing to LookForDuck in my playing engine. When I press down, nothing is happening.<br>
<br>
LookForDuck:<br>
LDA DownHeld<br>
CMP #$01<br>
BNE .End<br>
LDA $0301<br>
CMP #$1B<br>
BCC .Left<br>
LDA #$01<br>
STA PlayerisDucking<br>
RTS<br>
.Left:<br>
LDA #$02<br>
STA PlayerisDucking<br>
.End:<br>
RTS<br>
<br>
Ducking:<br>
LDA PlayerisDucking<br>
CMP #$00<br>
BEQ .End<br>
CMP #$01<br>
BEQ .Left<br>
CMP #$02<br>
BEQ .Right<br>
.End:<br>
RTS<br>
.Left:<br>
LDA DownHeld<br>
CMP #$01<br>
BEQ .ResetL<br>
LDA #$09<br>
STA $0301<br>
LDA #$0A<br>
STA $0305<br>
LDA #$19<br>
STA $0309<br>
LDA #$1A<br>
STA $030D<br>
RTS<br>
.ResetL:<br>
JSR ResetSpritesLeft<br>
LDA #$00<br>
STA PlayerisDucking<br>
RTS<br>
.Right:<br>
LDA DownHeld<br>
CMP #$01<br>
BEQ .ResetR<br>
LDA #$29<br>
STA $0301<br>
LDA #$2A<br>
STA $0305<br>
LDA #$39<br>
STA $0309<br>
LDA #$3A<br>
STA $030D<br>
RTS<br>
.ResetR:<br>
JSR ResetSpritesRight<br>
LDA #$00<br>
STA PlayerisDucking<br>
RTS<br>
<br>
EDIT: I ended up figuring this out guys, here is the corrected code, also had to JSR to Ducking in game engine.<br>
<br>
<div>
	LookForDuck:</div>
<div>
	&#xA0; LDA DownHeld</div>
<div>
	&#xA0; CMP #$01</div>
<div>
	&#xA0; BNE .End</div>
<div>
	&#xA0; LDA $0301</div>
<div>
	&#xA0; CMP #$1B</div>
<div>
	&#xA0; BCC .Left</div>
<div>
	&#xA0; LDA #$01</div>
<div>
	&#xA0; STA PlayerisDucking</div>
<div>
	&#xA0; RTS</div>
<div>
	.Left:</div>
<div>
	&#xA0; LDA #$02</div>
<div>
	&#xA0; STA PlayerisDucking</div>
<div>
	.End:</div>
<div>
	&#xA0; RTS</div>
<div>
	&#xA0;&#xA0;</div>
<div>
	Ducking:</div>
<div>
	&#xA0; LDA PlayerisDucking</div>
<div>
	&#xA0; CMP #$00</div>
<div>
	&#xA0; BEQ .End</div>
<div>
	&#xA0; CMP #$01</div>
<div>
	&#xA0; BEQ .Left</div>
<div>
	&#xA0; CMP #$02</div>
<div>
	&#xA0; BEQ .Right</div>
<div>
	.End:</div>
<div>
	&#xA0; RTS</div>
<div>
	.Left:</div>
<div>
	&#xA0; LDA DownHeld</div>
<div>
	&#xA0; CMP #$01</div>
<div>
	&#xA0; BNE .ResetL</div>
<div>
	&#xA0; LDA #$29</div>
<div>
	&#xA0; STA $0301</div>
<div>
	&#xA0; LDA #$2A</div>
<div>
	&#xA0; STA $0305</div>
<div>
	&#xA0; LDA #$39</div>
<div>
	&#xA0; STA $0309</div>
<div>
	&#xA0; LDA #$3A</div>
<div>
	&#xA0; STA $030D</div>
<div>
	&#xA0; RTS</div>
<div>
	.ResetL:</div>
<div>
	&#xA0; JSR ResetSpritesLeft</div>
<div>
	&#xA0; LDA #$00</div>
<div>
	&#xA0; STA PlayerisDucking</div>
<div>
	&#xA0; RTS</div>
<div>
	.Right:</div>
<div>
	&#xA0; LDA DownHeld</div>
<div>
	&#xA0; CMP #$01</div>
<div>
	&#xA0; BNE .ResetR</div>
<div>
	&#xA0; LDA #$09</div>
<div>
	&#xA0; STA $0301</div>
<div>
	&#xA0; LDA #$0A</div>
<div>
	&#xA0; STA $0305</div>
<div>
	&#xA0; LDA #$19</div>
<div>
	&#xA0; STA $0309</div>
<div>
	&#xA0; LDA #$1A</div>
<div>
	&#xA0; STA $030D</div>
<div>
	&#xA0; RTS</div>
<div>
	.ResetR:</div>
<div>
	&#xA0; JSR ResetSpritesRight</div>
<div>
	&#xA0; LDA #$00</div>
<div>
	&#xA0; STA PlayerisDucking</div>
<div>
	&#xA0; RTS</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__91">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Dec 7, 2013 at 11:23:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					One question that has been eluding me for a while has been the practical difference between CHR RAM and CHR ROM. I have read through the NESDEV material on the subject, and also several threads, but no one seems to be too interested in breaking down the differences in practical terms, i.e. how they actually affect game design and for which types of games each is best suited. Instead the material seems to focus more on the exceptions to the rule and fancy technical effects (which are interesting, but way down the line for me). I understand that one&apos;s choice can be made for them through the choice of a mapper, but in the case of the MMC1 both options exist (looking at INL&apos;s flashable options). So, for those who have done some programming, what has your experience been? What influenced your decision, and what benefits/limitations came with your choice? Also, if you have any recommendations for someone looking to do an overhead adventure game with a lot of tile data, I would be curious to know your thoughts on this as well <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>Lastly, when choosing a flashable board for testing purposes, is it all right to have too high of specs? Would the best bet for development be to get the largest board possible, or will this cause complications? The answer may be obvious, but I thought that I would check before purchasing (assuming that I can make a decision on the CHR RAM/ROM issue).
<br>
<br>Thanks for any and all help!
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__92">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Dec 7, 2013 at 11:49:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	One question that has been eluding me for a while has been the practical difference between CHR RAM and CHR ROM. I have read through the NESDEV material on the subject, and also several threads, but no one seems to be too interested in breaking down the differences in practical terms, i.e. how they actually affect game design and for which types of games each is best suited. Instead the material seems to focus more on the exceptions to the rule and fancy technical effects (which are interesting, but way down the line for me). I understand that one&apos;s choice can be made for them through the choice of a mapper, but in the case of the MMC1 both options exist (looking at INL&apos;s flashable options). So, for those who have done some programming, what has your experience been? What influenced your decision, and what benefits/limitations came with your choice? Also, if you have any recommendations for someone looking to do an overhead adventure game with a lot of tile data, I would be curious to know your thoughts on this as well<br>
	<br>
	Lastly, when choosing a flashable board for testing purposes, is it all right to have too high of specs? Would the best bet for development be to get the largest board possible, or will this cause complications? The answer may be obvious, but I thought that I would check before purchasing (assuming that I can make a decision on the CHR RAM/ROM issue).<br>
	<br>
	Thanks for any and all help!</div>
<br>
CHR-RAM can be written to as well as read from, whereas CHR-ROM is read only and all you can do is swap it out, usually in 4kb sized banks (I believe there are smaller and larger configurations of chunks that can be swapped out, as well).<br>
<br>
I like CHR-RAM for my games because it allows maximum deduplication of graphics data. Say you have some background graphics for a given area or level, and then you proceed to a new area or level and most of the graphics are the same but a couple of tiles are different. With CHR-ROM, unless the bank swapping granularity of your mapper is sufficiently high this will force you to duplicate a lot of your graphics just so you can show those couple of new tiles. With CHR-RAM, you can simply keep all these chunks of background data separate, and load them in different combinations based on what area or level you are loading up. The same thing applies for sprites, in fact this application is probably much more commonly used for sprites than for background data.<br>
<br>
For most existing mappers, typically CHR-ROM was used for background animation because of the bank swapping capability. But with new mappers being developed by bunnyboy and others, we can now bankswitch with CHR-RAM, which essentially gives us the best of both worlds. To me, I cannot at the moment envision any real benefits of CHR-ROM over CHR-RAM. I think CHR-RAM is probably the best option for homebrew game development. I have more experience with it though so I&apos;ll let others comment on any details I may have left out.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__93">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Dec 9, 2013 at 3:59:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					^^ Made good points.  However, I&apos;d say that from an actual build mode, assuming it&apos;s your first couple games (which are typically NROM or some other simple mapper), you should probably stick with CHR-ROM.  It takes a pretty substantial homebrew game to use all of the tiles in an NROM or CNROM cart even if you&apos;re trying.  AND the doner carts are much easier to find and cheaper.  
<br>
<br>But if you&apos;re going <span class="sprites_emoticons absmiddle" id="emo_teabag"></span> out and making a big platformer or porno or something, CHR-RAM is the way to go.  There&apos;s no exact answer to your question, it depends on the game.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__94">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Dec 9, 2013 at 4:19:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Plus, new PCB&apos;s have RAM, AND 32KB of it standard. It&apos;s so flexible for the programmer, and easy to get carts made using. It&apos;s great.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__95">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Dec 10, 2013 at 5:10:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					To all that replied, here and privately, thanks for your input. I had initially decided on using CHR ROM, due to many of the games that I enjoy using that format, but it now appears that CHR RAM does indeed seem to be the way to go. I made the move to MMC1 a while back after running out of room with NROM and not being able to plan ahead for battery saves with UNROM. My plan is to use INL&apos;s boards rather than relying on donors (mostly due to my lack of skills with that process; impressive stash of carts/boards though MRN), so that has influenced my decisions as well. I would like this to be an open question, however, so if you have thoughts I am still interested in hearing them. Just wanted to say thanks for those who have taken the time to respond so far!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__96">
                                                        <div class="mdl-card__title"><strong>Dimeback</strong> posted on 
		
			
				
				Dec 11, 2013 at 10:05:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m a bit new to NES programming, so after doing some research when some programming veteran brought up the term &quot;hardcoded OAM&quot;, I discovered my sprite data was hardcoded (my sprite is 16x16 pixels). I was wondering how I could make it non-hardcoded (hopefully this all makes sense to you). I was told to draw all the other sprites around the main sprite I use for movement, collisions, updates, etc. but I am not sure how todo that. Here is my sprite drawing routine:<br>
<br>
PlayingSP: ; These are the sprites during the game<br>
;vert tile attr horiz<br>
.db $B0, $00, $00, $20<br>
.db $B0, $01, $00, $28<br>
.db $B8, $02, $00, $20<br>
.db $B8, $03, $00, $28<br>
.db $37, $37, $37, $37 ;end &#xA0; &#xA0;&lt;- Ignore this.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__97">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Dec 12, 2013 at 9:15:48 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Dimeback</b></i><br>
	<br>
	I&apos;m a bit new to NES programming, so after doing some research when some programming veteran brought up the term &quot;hardcoded OAM&quot;, I discovered my sprite data was hardcoded (my sprite is 16x16 pixels). I was wondering how I could make it non-hardcoded (hopefully this all makes sense to you). I was told to draw all the other sprites around the main sprite I use for movement, collisions, updates, etc. but I am not sure how todo that. Here is my sprite drawing routine:<br>
	<br>
	PlayingSP: ; These are the sprites during the game<br>
	;vert tile attr horiz<br>
	.db $B0, $00, $00, $20<br>
	.db $B0, $01, $00, $28<br>
	.db $B8, $02, $00, $20<br>
	.db $B8, $03, $00, $28<br>
	.db $37, $37, $37, $37 ;end &#xA0; &#xA0;&lt;- Ignore this.</div>
<br>
<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33378" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33378">http://nintendoage.com/forum/messageview.cfm?catid=22&amp;th...</a> <br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__98">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 16, 2013 at 11:33:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Dimeback</b></i><br>
	<br>
	PlayingSP: ; These are the sprites during the game<br>
	;vert tile attr horiz<br>
	.db $B0, $00, $00, $20<br>
	.db $B0, $01, $00, $28<br>
	.db $B8, $02, $00, $20<br>
	.db $B8, $03, $00, $28<br>
	.db $37, $37, $37, $37 ;end &#xA0; &#xA0;&lt;- Ignore this.</div>
<br>
Just to clarify, that isn&apos;t a drawing routine.&#xA0; That&apos;s just the sprite data.&#xA0; The actual drawing routine (since I&apos;m guessing that&apos;s the code from my lessons that you&apos;re using) will be at a subroutine called &quot;LoadSprites&quot;.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__99">
                                                        <div class="mdl-card__title"><strong>Dimeback</strong> posted on 
		
			
				
				Dec 20, 2013 at 12:30:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Dimeback</b></i><br>
		<br>
		I&apos;m a bit new to NES programming, so after doing some research when some programming veteran brought up the term &quot;hardcoded OAM&quot;, I discovered my sprite data was hardcoded (my sprite is 16x16 pixels). I was wondering how I could make it non-hardcoded (hopefully this all makes sense to you). I was told to draw all the other sprites around the main sprite I use for movement, collisions, updates, etc. but I am not sure how todo that. Here is my sprite drawing routine:<br>
		<br>
		PlayingSP: ; These are the sprites during the game<br>
		;vert tile attr horiz<br>
		.db $B0, $00, $00, $20<br>
		.db $B0, $01, $00, $28<br>
		.db $B8, $02, $00, $20<br>
		.db $B8, $03, $00, $28<br>
		.db $37, $37, $37, $37 ;end &#xA0; &#xA0;&lt;- Ignore this.</div>
	<br>
	<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33378" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33378">http://nintendoage.com/forum/messageview.cfm?catid=22&amp;th...</a> <br>
	&#xA0;</div>
Okay, I think I have incorporated everything within the link above. &#xA0;I haven&apos;t run into any problems, so I think I got it working. &#xA0;That brings me to my next question: &#xA0;I&apos;m trying to make my 16x16 sprite flip when I press left (these sprites are oriented to the right). &#xA0;I know how to make the graphics for individual sprites flip, but what I was wondering was how to swap the places of the vertical 8x16 sprites (they appear vertically fragmented) so that it looks like a proper flip.<br>
<br>
<br>
<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Dimeback</b></i><br>
		<br>
		PlayingSP: ; These are the sprites during the game<br>
		;vert tile attr horiz<br>
		.db $B0, $00, $00, $20<br>
		.db $B0, $01, $00, $28<br>
		.db $B8, $02, $00, $20<br>
		.db $B8, $03, $00, $28<br>
		.db $37, $37, $37, $37 ;end &#xA0; &#xA0;&lt;- Ignore this.</div>
	<br>
	Just to clarify, that isn&apos;t a drawing routine.&#xA0; That&apos;s just the sprite data.&#xA0; The actual drawing routine (since I&apos;m guessing that&apos;s the code from my lessons that you&apos;re using) will be at a subroutine called &quot;LoadSprites&quot;.<br>
	&#xA0;</div>
Oh, thanks for clarifying that. &#xA0;(I&apos;m still trying to wrap my head around how everything in the code works, mostly the stuff I haven&apos;t learnt much about, but it&apos;s gradually becoming clearer to me.)<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__100">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Dec 20, 2013 at 2:38:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You might have to post a picture...could it be as simple as switching the tiles?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__101">
                                                        <div class="mdl-card__title"><strong>Oddzball</strong> posted on 
		
			
				
				Dec 20, 2013 at 4:18:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry, I should have probably posted this here instead of it&apos;s own thread, but i actually didn&apos;t notice this sticky thread. Sorry for that. I was asking the following;
<br>
<br>Hi,
<br>
<br>I know how busy folks are, but I wanted to talk a little bit about one of my Favorite games on the SNES, Harvest Moon.
<br>
<br>I was wondering, how difficult would it be, to do a relatively simple hack of Harvest Moon? What I want to do, is firstly, go back through the dialong and clean up the typos and bad grammar. Second, I wanted to go through the Girls, and change the looks of the sprites for the characters to the more modern versions of them that appear in the newer games.
<br>
<br>At this time I think this is more of an educational exercise for me, but how difficult would this be to do? The characters dont have a lot of animations you would have to go through and change, (really they just have their directional walking sprites)
<br>
<br>My final question is, the possibility of adding character portraits to the dialog when talking to the girls...
<br>
<br>I dont know if this is possible or not as it would be a major modification to the game... Any thoughts on this?
<br>
<br>I have plenty of experience with C and C+ programming, also, but Im not exactly sure how SNES games are written, so I dont know if my skill will transfer over very well...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__102">
                                                        <div class="mdl-card__title"><strong>Dimeback</strong> posted on 
		
			
				
				Dec 20, 2013 at 4:34:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	You might have to post a picture...could it be as simple as switching the tiles?</div>
<a href="http://gyazo.com/08cf1354df68eb9ccbd1b8b22d1ca376" target="_blank" original-href="http://gyazo.com/08cf1354df68eb9ccbd1b8b22d1ca376">http://gyazo.com/08cf1354df68eb9ccbd1b8b22d1ca376</a>&#xA0; &lt;-- What the normal sprite looks like [after pressing right]<br>
<a href="http://gyazo.com/518373409760ff3d7efe42390dcb7115" target="_blank" original-href="http://gyazo.com/518373409760ff3d7efe42390dcb7115">http://gyazo.com/518373409760ff3d7efe42390dcb7115</a>&#xA0; &lt;-- What the flipped sprite looks like [after pressing left]<br>
And no, you can&apos;t switch the tiles, I tried.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__103">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Dec 20, 2013 at 6:39:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes. You just need to switch the tiles that you are displaying. Make the left sprite show the tile currently showing on the right one and vice versa.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__104">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 21, 2013 at 12:24:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, using the flip flag is tricky.  It flips each individual tile in their current locations.  It doesn&apos;t know that you&apos;re using four tiles to make up your sprite.
<br>
<br>So you&apos;ll need to do:
<br>
<br>When facing right (assuming your character starts at $0300):
<br>  $0301 - top left sprite        ;not flipped.
<br>  $0305 - top right sprite
<br>  $0309 - bottom left sprite
<br>  $030D - bottom right sprite
<br>
<br>When facing left:
<br>  $0301 - top right sprite (flipped)
<br>  $0305 - top left sprite (flipped)
<br>  $0309 - bottom right sprite (flipped)
<br>  $030D - bottom left sprite (flipped)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__105">
                                                        <div class="mdl-card__title"><strong>Oddzball</strong> posted on 
		
			
				
				Jan 2, 2014 at 7:56:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have a question, is there documentation somewhere with all the functions you can do for the 6502? I think the tutorial mentions there are 52 functions right? 10 of which we will use all the time...
<br>
<br>Some documentation and example code of each would be awesome IMO.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__106">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 2, 2014 at 8:28:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<a href="http://www.obelisk.demon.co.uk/6502/reference.html" target="_blank" original-href="http://www.obelisk.demon.co.uk/6502/reference.html">http://www.obelisk.demon.co.uk/65...</a> is the site I use.  It doesn&apos;t have a source code example, but it has the logical function and what addressing modes can be used with each opcode.  It also has the instructions grouped by function: <a href="http://www.obelisk.demon.co.uk/6502/instructions.html" target="_blank" original-href="http://www.obelisk.demon.co.uk/6502/instructions.html">http://www.obelisk.demon.co.uk/65...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__107">
                                                        <div class="mdl-card__title"><strong>MadnessVX</strong> posted on 
		
			
				
				Jan 8, 2014 at 4:31:46 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Quick question. I have a routine that updates 6 sprites based off the first one. When I move the sprites all together, the first sprite is a pixel or two ahead of the rest. My movement routine moves only the first sprite. The code is similar to MRN&apos;s in his engine building tuts. 
<br>
<br>Is there a way to compensate for this delay? Here are the subroutines:
<br>
<br>MovePlayer:
<br>  LDA UpHeld                 ;Up
<br>  CMP #$01
<br>  BNE .NotUp
<br>  LDA PLAYER_SPRITE_RAM
<br>  SEC
<br>  SBC #$03
<br>  STA PLAYER_SPRITE_RAM
<br>.NotUp
<br>  LDA DownHeld               ;Down
<br>  CMP #$01
<br>  BNE .NotDown
<br>  LDA PLAYER_SPRITE_RAM
<br>  CLC
<br>  ADC #$03
<br>  STA PLAYER_SPRITE_RAM
<br>.NotDown
<br>  LDA LeftHeld                ;Left
<br>  CMP #$01
<br>  BNE .NotLeft
<br>  LDA PLAYER_SPRITE_RAM+3
<br>  SEC
<br>  SBC #$03
<br>  STA PLAYER_SPRITE_RAM+3
<br>.NotLeft
<br>  LDA RightHeld              ;Right
<br>  CMP #$01
<br>  BNE .End
<br>  LDA PLAYER_SPRITE_RAM+3
<br>  CLC
<br>  ADC #$03
<br>  STA PLAYER_SPRITE_RAM+3
<br>.End
<br>  RTS
<br>
<br>UpdatePlayerSprites:
<br>  LDA PLAYER_SPRITE_RAM   ;Update vertical positions.
<br>  STA PLAYER_SPRITE_RAM+4
<br>  CLC
<br>  ADC #$08
<br>  STA PLAYER_SPRITE_RAM+8
<br>  STA PLAYER_SPRITE_RAM+12
<br>  CLC
<br>  ADC #$08
<br>  STA PLAYER_SPRITE_RAM+16
<br>  STA PLAYER_SPRITE_RAM+20
<br>  CLC
<br>  ADC #$08
<br>  STA PLAYER_SPRITE_RAM+24
<br>  STA PLAYER_SPRITE_RAM+28
<br>  LDA PLAYER_SPRITE_RAM+3 ;Update horizontal positions.
<br>  STA PLAYER_SPRITE_RAM+11
<br>  STA PLAYER_SPRITE_RAM+19
<br>  STA PLAYER_SPRITE_RAM+27
<br>  CLC
<br>  ADC #$08
<br>  STA PLAYER_SPRITE_RAM+7
<br>  STA PLAYER_SPRITE_RAM+15
<br>  STA PLAYER_SPRITE_RAM+23
<br>  STA PLAYER_SPRITE_RAM+31
<br>  RTS
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__108">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jan 8, 2014 at 4:38:01 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m not looking at the code, but if you want to move others based off the first sprite, you obviously need to figure the first sprite position, then you need to move all other sprites based from that number instead of any other number you&apos;ll be using to initiate them, they should be initiated this way, too.
<br>
<br>And if there&apos;s a pixel off, your math is a pixel off somewhere. Make sure to CLC before you ADC. Then also lastly, indent your code. You need white space before instructions to really tell the assembler it&apos;s not a label, and also you need it to make it more readable, as the execution flow is 10x easier to see with label indents.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__109">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 8, 2014 at 4:40:31 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Would have to see more code, but you probably have the order wrong.  Likely you have:
<br>
<br>MovePlayer (updates only first sprite)
<br>sprite dma (now first and rest are out of sync)
<br>UpdatePlayerSprites (now in sync, but too late to display)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__110">
                                                        <div class="mdl-card__title"><strong>MadnessVX</strong> posted on 
		
			
				
				Jan 8, 2014 at 12:55:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Forgot to clarify that everything works like it should, just the top left sprite moves a split second before the rest.
<br>Some pics:
<br><a href="http://goo.gl/HLJP3G" target="_blank" original-href="http://goo.gl/HLJP3G">http://goo.gl/HLJP3G...</a> When not moving
<br><a href="http://goo.gl/hYZqoP" target="_blank" original-href="http://goo.gl/hYZqoP">http://goo.gl/hYZqoP...</a> When moving left
<br>
<br>When not moving, all the sprites are in the proper places.
<br>Here is the code if interested: <a href="http://pastebin.com/gA8qBYdT" target="_blank" original-href="http://pastebin.com/gA8qBYdT">http://pastebin.com/gA8qBYdT...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__111">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 8, 2014 at 1:01:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yup swap lines 367 and 368.  You want to move the player, then update all the sprites.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__112">
                                                        <div class="mdl-card__title"><strong>MadnessVX</strong> posted on 
		
			
				
				Jan 8, 2014 at 1:11:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Gotcha, works perfect now. Thanks! I was guessing since everything moves frame-by-frame, order would not have mattered.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__113">
                                                        <div class="mdl-card__title"><strong>skylersz</strong> posted on 
		
			
				
				Jan 19, 2014 at 12:24:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hello all.
<br>
<br>I have a small? request for help on a mini project of mine. I don&apos;t want to post any specifics because it will be part of something larger later on. Whoever helps I will make sure is credited for their work.
<br>
<br>Basically I have dumped 3 chips off a NES cart, the PRG, CHR and a 3rd chip which I believe to possibly be some sort of patch/modification to the original code. I have verified the dumps and I have been able to get the main code to run in an emulator. I have skimmed the 3rd chip but I am stuck as to what it actually changes/what it&apos;s purpose really is. 
<br>
<br>If you think you could help me, please send me a PM and we will go from there. If any of the programming gods want to have a go, I would really appreciate it.
<br>BTW due to the nature of the content (which really could turn out to be nothing special) I would like to try and work with someone who has a good rep, nothing to do with skills, more on the whole keeping it between myself and the other person.
<br>
<br>Wish I could be more clear, but if you want to help, please send me a PM. I know some of you don&apos;t do PM&apos;s (I&apos;m looking at you Bunny) and you want to help, just post here and I can contact you via email or whatever your preferred communication method is.
<br>I am from Australia so bear with me in terms of the time difference. I am in no hurry though.
<br>
<br>Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__114">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jan 22, 2014 at 7:37:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p>
	This is a problem that I skipped over a while ago in order to focus on getting a single room to work, but now I&#xA0;would like&#xA0;to have more than one room actually functional&#xA0;(think <i>Adventure</i> for the 2600, or any overhead action-adventure). I have different backgrounds, attributes, and palettes loading, but the question is: how to get different sprites for different rooms, while keeping the location of the hero sprite dependent on player input. If a looped sprite table is used, as found in the NN tutorials, the hero&#x2019;s position understandably jumps to whatever location it is assigned in the table. If a routine similar to the UpdateSprites routine in NN Week 9 is used in place of this, and in combination with a routine that sets the initial position of the hero (similar to the &quot;update ball stats here&quot; section near the beginning of NN Week 9), hero movement is fluid, but all addresses must be individually declared. Further, all sprite locations ($0200, $0201, etc.) must first have a variable assigned to them (herox, heroy, etc.), creating a ton of extra variables that may or may not be needed. This becomes more confusing when the whole SPRITE_ constant system is used, since herox, heroy, etc. can all be replaced with SPRITE_ and function just fine. What exactly needs to be done when loading a new room to ensure that the hero&#x2019;s location is kept, and that new enemy sprites are loaded? Should some sort of routine that stores and loads the hero&#x2019;s last location be used? The looped table is really appealing, but it also seems to be fairly rigid when it comes to moving beyond single screen games (although I am hopefully just using it wrong). Do there need to be long lists of Update____ for each room (i.e. UpdateEneniesRoom1, UpdateEnemiesRoom2, etc.)? Any help would be greatly appreciated, and if this does not make sense just ask. I am guessing that this is a fairly easy problem, but something is wrong in my logic (brain or computer). I am more than ready to start playing around with sprites, but have been hung up on this problem for a while.</p>
<p>
	&#x3000;</p>
<p>
	Examples of the three systems discussed above:<br>
	&#xA0;</p>
<p style="margin-left: 40px;">
	Room1spr:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Table, there would be one of these for each room, or one at the</p>
<p style="margin-left: 40px;">
	;vert tile attr horiz&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; beginning of the playing state?</p>
<p style="margin-left: 40px;">
	.db $C0, $00, $00, $70 ;Hero</p>
<p style="margin-left: 40px;">
	.db $FE, $FE, $00, $FE</p>
<p>
	<br>
	or</p>
<p>
	&#xA0;</p>
<p style="margin-left: 40px;">
	UpdateHeroSprite:</p>
<p style="margin-left: 40px;">
	LDA HeroY ;;update all hero sprite info</p>
<p style="margin-left: 40px;">
	STA $0200</p>
<p style="margin-left: 40px;">
	LDA #$00</p>
<p style="margin-left: 40px;">
	STA $0201</p>
<p style="margin-left: 40px;">
	LDA #$00</p>
<p style="margin-left: 40px;">
	STA $0202</p>
<p style="margin-left: 40px;">
	LDA HeroX</p>
<p style="margin-left: 40px;">
	STA $0203</p>
<p style="margin-left: 40px;">
	RTS</p>
<p>
	<br>
	In conjunction with:</p>
<p>
	&#xA0;</p>
<p style="margin-left: 40px;">
	SetInitialHeroLocation: ; Only used once at the beginning of the Playing State</p>
<p style="margin-left: 40px;">
	LDA #$C0</p>
<p style="margin-left: 40px;">
	STA HeroY</p>
<p style="margin-left: 40px;">
	LDA #$20</p>
<p style="margin-left: 40px;">
	STA HeroX</p>
<p style="margin-left: 40px;">
	LDA #$01</p>
<p style="margin-left: 40px;">
	STA InitialState</p>
<p style="margin-left: 40px;">
	.Done</p>
<p style="margin-left: 40px;">
	RTS</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__115">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jan 22, 2014 at 9:41:05 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I basically have a table with the coordinates for the locations where my sprite (in this case, leisure suit larry) can be, depending on which room he&apos;s coming from:<br>
<br>
When I&apos;m leaving one room, I will assign a variable called ReturnFlag.&#xA0; This variable will have a value of #00,#01,#02, etc.&#xA0; Every two numbers is a set of coordinates.<br>
<br>
ReturnCoords:<br>
&#xA0; .db $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF ;title<br>
&#xA0; .db $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF ;credits<br>
&#xA0; .db $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF ;gameover<br>
&#xA0; .db $97,$78,$88,$78,$82,$D8,$FF,$FF ;bar (0=starting, 1=leaving bar, 2=dumpster)<br>
&#xA0; .db $AA,$78,$79,$47,$95,$CD,$FF,$FF ;inside bar (0=from outside, 1=drunk, 2=bouncer)<br>
&#xA0; .db $90,$78,$76,$99,$FF,$FF,$FF,$FF ;drunk dude (0=inside bar, 1=bathroom)<br>
&#xA0; .db $78,$5A,$FF,$FF,$FF,$FF,$FF,$FF ;bathroom<br>
&#xA0; .db $8C,$23,$4E,$A4,$FF,$FF,$FF,$FF ;bouncer (0=from inside bar, 1=from prostitute)<br>
&#xA0; .db $7C,$58,$8C,$CB,$FF,$FF,$FF,$FF ;prostitute (0=from bouncer, 1=from window)<br>
;;;;;;;;;;;;;;; etc etc<br>
<br>
Then I take that value to see where I need to place Larry, depending on what room I&apos;m in.&#xA0; I run this subroutine after my LoadSprites is finished, just so that everything else is in its proper place for whatever room it is, but then Larry is moved to his correct position only after that.<br>
<br>
PositionLarry:<br>
&#xA0; LDX BG_ptr&#xA0;&#xA0;&#xA0; ;set BG_ptr to X<br>
&#xA0; TXA&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;transfer to A<br>
&#xA0; ASL A&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply by 2<br>
&#xA0; ASL A&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;x4<br>
&#xA0; ASL A&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;x8 (because I have 8 possible coordinates per room)<br>
&#xA0; TAX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;transfer back to X<br>
.Loop:<br>
&#xA0; LDA ReturnFlag&#xA0;&#xA0;&#xA0; ;then I load the variable ReturnFlag<br>
&#xA0; CMP #$00<br>
&#xA0; BEQ .Place&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if it&apos;s #$00, just load the first two coordinates in a row<br>
&#xA0; INX<br>
&#xA0; INX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;increment by 2 to get the next two coordinates<br>
&#xA0; DEC ReturnFlag&#xA0; ;decrement ReturnFlag once and repeat this until return flag is 0.<br>
&#xA0; JMP .Loop<br>
.Place:<br>
&#xA0; LDA ReturnCoords,x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;position sprite to correct location.<br>
&#xA0; STA SPRITE_BANKV<br>
&#xA0; STA SPRITE_BANKV+4<br>
&#xA0; CLC<br>
&#xA0; ADC #$08<br>
&#xA0; STA SPRITE_BANKV+8<br>
&#xA0; STA SPRITE_BANKV+12<br>
&#xA0; CLC<br>
&#xA0; ADC #$08<br>
&#xA0; STA SPRITE_BANKV+16<br>
&#xA0; STA SPRITE_BANKV+20<br>
&#xA0; CLC<br>
&#xA0; ADC #$08<br>
&#xA0; STA SPRITE_BANKV+24<br>
&#xA0; STA SPRITE_BANKV+28<br>
&#xA0; INX<br>
&#xA0; LDA ReturnCoords,x<br>
&#xA0; STA SPRITE_BANK<br>
&#xA0; STA SPRITE_BANK+8<br>
&#xA0; STA SPRITE_BANK+16<br>
&#xA0; STA SPRITE_BANK+24<br>
&#xA0; CLC<br>
&#xA0; ADC #$08<br>
&#xA0; STA SPRITE_BANK+4<br>
&#xA0; STA SPRITE_BANK+12<br>
&#xA0; STA SPRITE_BANK+20<br>
&#xA0; STA SPRITE_BANK+28<br>
&#xA0; RTS
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__116">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jan 22, 2014 at 2:34:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You&apos;ll likely want to keep all the sprites in the Sprite_RAM+XXX thinking when you get to making collision detection engines.  Just have two routines, one that updates the hero and others that update the bad guys.  Just start the badguy update loops at Sprite_RAM+4 instead of Sprite_RAM+0.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__117">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jan 22, 2014 at 2:54:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks Kevin. I thought about it a bit, and since the player will be able to enter from any border point I came up with the following based on your logic (I think anyways). After declaring a HeroPosition variable, and reserving enough space (16), I added the following routines:<br>
<br>
StoreHeroLocation:<br>
&#xA0; LDA SPRITE_BANK<br>
&#xA0; STA HeroPosition<br>
&#xA0; LDA SPRITE_BANK+1<br>
&#xA0; STA HeroPosition+1<br>
&#xA0; LDA SPRITE_BANK+2<br>
&#xA0; STA HeroPosition+2<br>
&#xA0; LDA SPRITE_BANK+3<br>
&#xA0; STA HeroPosition+3<br>
.Done<br>
&#xA0; RTS<br>
<br>
<br>
<br>
RetrieveHeroLocation:<br>
&#xA0; LDA HeroPosition<br>
&#xA0; STA SPRITE_BANK<br>
&#xA0; LDA HeroPosition+1<br>
&#xA0; STA SPRITE_BANK+1<br>
&#xA0; LDA HeroPosition+2<br>
&#xA0; STA SPRITE_BANK+2<br>
&#xA0; LDA HeroPosition+3<br>
&#xA0; STA SPRITE_BANK+3<br>
.Done<br>
&#xA0; RTS<br>
<br>
Hopefully that is transcribed correctly, I am away from my other computer at the moment. Calling the store routine at the beginning of a room loading routine and again at the end seems to accomplish what I was after. Hopefully this help anyone else who has a similar problem, and if there are problems with what I have, please point them out sooner than later <span class="sprites_emoticons absmiddle" id="emo_smile"></span> Thanks too MRN, just saw your post. I have a feeling that that will be my next issue (and may be related to the question below).<br>
<br>
<br>
<br>
On another note, how does one get rid of sprites that loaded in a different state? I ran into this with Pong too, once the game finished and the background changed to the Game Over background, the sprites were still visible, though inactive. In my current situation the sprites all load fine in the rooms, but once the player moves from a room with three sprites to two, for example, the third sprite still appears in its old location. Any thoughts?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__118">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 22, 2014 at 3:05:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					As you get into more advanced games, using the sprite page for storage turns into a bad idea.  What you will want is:
<br>
<br>Move player/enemies - none of the variables used will be in the sprite page.  player position is separate from sprite coords
<br>Render sprites - copy relevant data from the player/enemies into the sprite page.  if an object is off screen or hidden it won&apos;t get copied.
<br>Fill sprites - set the Y coord of all unused sprite slots to off screen
<br>
<br>That way if you have a cut screen you skip move+render and just do fill.  No sprites will be on screen but all your player data is still valid.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__119">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jan 22, 2014 at 3:47:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well let&apos;s see how much or how little I understand. The HeroPosition variable is already in the zero page; is this what you meant? Or am I missing something? Should I not be not be touching the SPRITE_BANK addresses at all when doing player movement?
<br>
<br>As far as rendering sprites, should I figure out the maximum number that will be on a screen at once and then load all of them in a table each time that I call the LoadSprites routine? Any that are not used would of course be given addresses off screen.
<br>
<br>The &quot;fill sprites&quot; thing you mention, is that part of the sprite table, or will a separate routine be needed? I assume that it is part of the table, but just wanted to clarify.
<br>
<br>Sad to say, but the last comment leaves me baffled in terms of the &quot;if you have a cut screen (?) you skip move+render and just do fill.&quot; Sorry for asking you to dumb it down a shade (to quote a famous cartoon character), but I want to make sure that I get what is going on before proceeding and the having to go back and redo a bunch of things.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__120">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jan 22, 2014 at 4:39:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	As you get into more advanced games, using the sprite page for storage turns into a bad idea. What you will want is:<br>
	<br>
	Move player/enemies - none of the variables used will be in the sprite page. player position is separate from sprite coords<br>
	Render sprites - copy relevant data from the player/enemies into the sprite page. if an object is off screen or hidden it won&apos;t get copied.<br>
	Fill sprites - set the Y coord of all unused sprite slots to off screen<br>
	<br>
	That way if you have a cut screen you skip move+render and just do fill. No sprites will be on screen but all your player data is still valid.</div>
This never occured to me.&#xA0; Very interesting.&#xA0; I haven&apos;t run into something where this would be a problem as all the cut screens that I&apos;ve done have been between independent screens.&#xA0; Good tip!<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__121">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jan 22, 2014 at 8:49:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	As you get into more advanced games, using the sprite page for storage turns into a bad idea. What you will want is:<br>
	<br>
	Move player/enemies - none of the variables used will be in the sprite page. player position is separate from sprite coords<br>
	Render sprites - copy relevant data from the player/enemies into the sprite page. if an object is off screen or hidden it won&apos;t get copied.<br>
	Fill sprites - set the Y coord of all unused sprite slots to off screen<br>
	<br>
	That way if you have a cut screen you skip move+render and just do fill. No sprites will be on screen but all your player data is still valid.</div>
<br>
Showoff.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__122">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 22, 2014 at 11:38:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	Should I not be not be touching the SPRITE_BANK addresses at all when doing player movement?</div>
Consider your sprite page as write only. &#xA0;All your player/enemy variables should be somewhere else so you don&apos;t have to read from it. &#xA0;The idea is to decouple the sprite page (used for drawing) from the object variables (used for moving/collisions).<br>
<br>
<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	As far as rendering sprites, should I figure out the maximum number that will be on a screen at once and then load all of them in a table each time that I call the LoadSprites routine?</div>
You would go through each one of your players/enemies/objects and copy the x/y/tile to the sprite page if that object is on screen and active. &#xA0;The number that will be on screen won&apos;t matter unless you have more than 64 sprites total.<br>
<br>
<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	The &quot;fill sprites&quot; thing you mention, is that part of the sprite table, or will a separate routine be needed? I assume that it is part of the table, but just wanted to clarify.</div>
All those 3 parts (move, render, fill) are completely separate functions. &#xA0;The fill sprites only fills the unused sprites with Y = off screen. &#xA0;If you want something slightly easier and less efficient, first fill ALL sprite with Y = off screen, then do render sprites. &#xA0;That way any unused sprite slots will already be off screen.<br>
<br>
<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	Sad to say, but the last comment leaves me baffled in terms of the &quot;if you have a cut screen (?) you skip move+render and just do fill.&quot;&#xA0;</div>
Go to 3:10 in this video of Battle Kid:&#xA0;<br clear="all"><div class="col-md-6"><div class="embed-responsive embed-responsive-16by9"><a href="https://www.youtube.com/yne04hukuyc">Youtube</a></div></div><br clear="all"> &#xA0;Player is on screen, then the cut screen with dialog shows up. &#xA0;Don&apos;t want the player visible or able to move around, so the move and render steps get skipped. &#xA0;When the cut screen exits the player is still in the same place and rendered again.<br>
<br>
<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	Sorry for asking you to dumb it down a shade (to quote a famous cartoon character), but I want to make sure that I get what is going on before proceeding and the having to go back and redo a bunch of things.</div>
Don&apos;t be sorry, thats what this thread is for &#xA0;<span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__123">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jan 23, 2014 at 7:08:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Looking back at the Nerdy Nights, I have tried to apply what you mentioned to what was in the lessons. Conceptually, at least, here is what I have:<br>
<br>
-Move/Collide Players/Enemies: variables are assigned in the zero page, such as ballx, bally, paddle1ytop, paddle2ybot, etc. When moving these objects, or determining collisions, these variables are called and NOT $02xx (or SPRITE_BANK/RAM+xxx, assuming that these are constants that begin at $0200 or somewhere like that).<br>
<br>
-Render Sprites: Not entirely certain on this one, but this appears to be equivalent to the UpdateSprites routine in Week 9. Each room would have one(/several?) of these that loads into (write) the sprite page what is needed on the present screen. This will involve a rather lengthy routine for each room, or for each type of object to be updated; see below for what I think I mean.<br>
<br>
-Fill: This is equivalent to the LoadSprites routine and the accompanying tables? One of these would be needed for each room. This did not appear to be included in Week 9, since there is not a LoadSprites routine and also if the table is commented out the program seems to run no different (though I could be wrong).<br>
<br>
<br>
<br>
Summary: The fill routine gives the default values for the room (although this would mean that it is read from, but only prior to the room loading. Hmm...). The render routine is where the object variables are read from, and they are the values that are written back to the fill portion of code. Movement/collisions use object variables, NOT sprite page addresses.<br>
<br>
<br>
<br>
If the above makes sense, I think that my main source of confusion was in equating $02xx/SPRITE_RAM+xx with object variables (ballx, bally, etc.) since they can at times functionally be the same. If I INC or DEC $0200 I can change the y position of the first sprite (though I now know that I should not). It was such a nice system since it eliminated the middle man (variable). I have wondered since last July why they were part of the code, now I know <span class="sprites_emoticons absmiddle" id="emo_smile"></span>. Out curiosity, where should I reserve spaces for object variables? Should these still be in the zero page as they are in the NN? If each sprite has four elements (y, tile, attribute, x), will I need to reserve 256 spaces? It should then be a simple processing of finding/replacing the old SPRITE_BANK+xxx addresses with the new variable. These, of course, could be divided between the different elements of the game, such as Hero, Weapons, Enemies, etc. Different update routines, such as UpdateHero, UpdateWeapons, UpdateEnemies, etc., would be used for the rendering portions(?). Let me know if any of this is on track, hopefully some of it is. Connections to the NN would be helpful, if there are analogous elements. And thanks! I have been avoiding sprites for far too long, and this is really helpful. If nothing else, just trying to figure them out is a step in the right direction.<br>
<br>
<br>
<u>Edit/Update</u>: I switched everything around and it all appears to be working using the logic above <span class="sprites_emoticons absmiddle" id="emo_smile"></span> Also added in MRN&apos;s move one sprite, move the whole meta-sprite routine, which works wonderfully! Code is much more simplified now, though does it save on space/memory?<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__124">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jan 24, 2014 at 8:48:30 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					$00xx should be used for pointers...only.
<br>$01xx is your stack.
<br>$02xx is what you&apos;re using for sprites (though you can use whatever you want)
<br>so use $03xx, $04xx, $05xx, $06xx, or $07xx for other variables.
<br>
<br>Though MetalSlime uses $03xx for sound variables in his tutorials, IIRC.  
<br>
<br>So use one of the other pages for your &quot;soft&quot; sprite variables.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__125">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jan 24, 2014 at 9:56:23 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think it&apos;s pretty good to use at least half of the $0100 page for buffers too. ($100-$17F) random 32-byte, 16-byte, etc. That is, if you can optimize a route to only touch the PLA instruction to get a value needed with X and Y for the other logic/counters it needs to use only the stack and those buffers to store crap to, it&apos;s great optimization.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__126">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jan 25, 2014 at 3:04:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	$00xx should be used for pointers...only.<br>
	$01xx is your stack.<br>
	$02xx is what you&apos;re using for sprites (though you can use whatever you want)<br>
	so use $03xx, $04xx, $05xx, $06xx, or $07xx for other variables.<br>
	<br>
	Though MetalSlime uses $03xx for sound variables in his tutorials, IIRC.<br>
	<br>
	So use one of the other pages for your &quot;soft&quot; sprite variables.</div>
<br>
Thanks for pointing that out MRN. I remembered you mentioning it in your tutorials, but the tip about MetalSlime&apos;s use of $03xx will come in handy when the day comes for music.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__127">
                                                        <div class="mdl-card__title"><strong>QuickThumbs</strong> posted on 
		
			
				
				Jan 30, 2014 at 1:32:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have a lot of extra time on my hands an think it is finally time to learn Assembly Language. Can anyone suggest some books for a complete beginner? So far I have &quot;Assembly Lines: The Book&quot;, but would also like something that explains &apos;how&apos; Assembly Language/Processors work together. Seems like you need to know basic electronics before you can grapple with hexadecimals If it helps, I do have several years experience with BASIC derivatives, ROM hacking, and a bit of Pascal.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__128">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Jan 30, 2014 at 1:34:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Why in the world do so many people want books when the online resources that COME WITH HELP are 100% the same tools and syntax they will be using? There is basically no reason to use a book, really.
<br>
<br>JUust start through the nerdy nights. Whatever you don&apos;t get, either google and find a better source, or ask. Really, it&apos;s _that_ simple.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__129">
                                                        <div class="mdl-card__title"><strong>QuickThumbs</strong> posted on 
		
			
				
				Jan 30, 2014 at 1:42:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Mainly I want a book because I am a collector... Not to mention it&apos;s more enjoyable reading a book than a print-out or video screen.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__130">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Jan 30, 2014 at 1:53:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					QuickThumbs: Check out this thread I started a few months back:  <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=93756" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=93756">http://www.nintendoage.com/forum/...</a>
<br>
<br>It&apos;ll point you to a nice book for learning all the hard concepts behind assembly language. Note it isn&apos;t 6502, but I&apos;m a really big fan of Jeff Duntemann&apos;s teaching style. It really helped me out when I was a teenager cause I have a bit of a rough time learning technical concepts. But, I love programming so I don&apos;t give up.
<br>
<br>3gengames: Everyone&apos;s different. No matter how much you browbeat other people to do things the way you think they ought to be done, there will be some who will benefit by alternative methods.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__131">
                                                        <div class="mdl-card__title"><strong>QuickThumbs</strong> posted on 
		
			
				
				Jan 30, 2014 at 2:01:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					GradualGamer: Thanks a lot! Personally I prefer BASIC/Pascal because they really aren&apos;t as limited as people claim, but there is something &apos;romantic&apos; about assembly language. Probably because I&apos;m rereading &quot;Hackers&quot; by Steven Levy. People here should check out that book, too. ^^
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__132">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jan 30, 2014 at 2:02:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That Assembly Language: Step By Step referenced in GG&apos;s thread is a good resource.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__133">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jan 30, 2014 at 3:35:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>QuickThumbs</b></i><br>
	<br>
	but there is something &apos;romantic&apos; about assembly language.</div>
<br>
<br>
Agreed. Even after days of struggling with the same, simple&#xA0;bit of code, the romance remains. Same goes for print. I even printed and bound the Nerdy Nights just to be able to focus in on them without the distractions of the computer. It can be nice to step away from the workspace and process things in your head without the pressure to try them out right away. Oh, and Dutemann&apos;s book is good. Being able to understand a few things, which the author really helps the reader to do,&#xA0;can give the confidence needed to get started.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__134">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Jan 30, 2014 at 4:47:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>QuickThumbs</b></i><br>
		<br>
		but there is something &apos;romantic&apos; about assembly language.</div>
	<br>
	<br>
	Agreed. Even after days of struggling with the same, simple&#xA0;bit of code, the romance remains. Same goes for print. I even printed and bound the Nerdy Nights just to be able to focus in on them without the distractions of the computer. It can be nice to step away from the workspace and process things in your head without the pressure to try them out right away. Oh, and Dutemann&apos;s book is good. Being able to understand a few things, which the author really helps the reader to do,&#xA0;can give the confidence needed to get started.</div>
+1. I fell in love with assembly language programming in the late 90&apos;s writing graphics demos and games for DOS. Loved it ever since. Constrained to a retro computer of some kind, the simplicity of it is very appealing. I don&apos;t know that it&apos;d be the language of choice for a modern mobile app, of course, as the complexity just gets so high with modern computing you pretty much have to rely on third party OSs, libraries, cloud backend, yada yada to make even the simplest things work the way they are supposed to. But if you&apos;re into retro games and computers, there&apos;s nothing like it.&#xA0;<br>
<br>
QuickThumbs: I got my start in QBasic and C. It&apos;s interesting how often you see adherants of BASIC delving into assembly language later on. Not sure why that is---maybe driven by nostalgia for old computers in general, since those were typically the two languages you&apos;d see (asm and BASIC)?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__135">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Feb 3, 2014 at 7:38:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					When doing an inventory screen and a playing state status bar (for an overhead adventure), is it a better to use sprites for weapon and item images, or rewrite background tiles? I have the latter method more or less working, but noticed that Zelda and a few other games seem to use the former. I can see advantages and disadvantages to both (I think), so any thoughts or advice is welcome.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__136">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 3, 2014 at 9:23:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	When doing an inventory screen and a playing state status bar (for an overhead adventure), is it a better to use sprites for weapon and item images, or rewrite background tiles? I have the latter method more or less working, but noticed that Zelda and a few other games seem to use the former. I can see advantages and disadvantages to both (I think), so any thoughts or advice is welcome.</div>
<br>
I&apos;d personally probably use a combination of sprites and background tiles for this. You&apos;ll probably encounter trade-offs unique to your own game. In other words, any graphics you use for sprites can&apos;t be used by the background and vice versa. Which one do you want to maximize? In a single screen game, you can probably use a combination without too much trouble. Obviously, anything that spans more than 8 tiles wide will have to be background tiles. Maybe use sprites for small, more colorful icons that stand out from the rest of the status bar.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__137">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 3, 2014 at 12:11:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve pretty much always used sprites because of color restrictions, and generally there aren&apos;t more than 8 sprites up that high on the status bar.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__138">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Feb 3, 2014 at 1:32:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Good points fellows! I had completely overlooked color restrictions, since the first few weapons/items that I designed all use the same palette as the status bar. Since one weapon will probably be permanent, the combination method should work nicely, costing a couple of background tiles, but also saving a couple of sprites. So many factors to consider when designing things it is almost overwhelming. Thanks for saving me from some future frustrations!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__139">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 3, 2014 at 2:56:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I wouldn&apos;t worry about saving sprites at this stage.  I&apos;d be surprised if you ever have enough going on (that looks okay) to where you actually run out of them.  I&apos;d focus more on making your game look cool and colorful than this stuff.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__140">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Feb 3, 2014 at 5:15:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	I wouldn&apos;t worry about saving sprites at this stage. I&apos;d be surprised if you ever have enough going on (that looks okay) to where you actually run out of them. I&apos;d focus more on making your game look cool and colorful than this stuff.</div>
<br>
<br>
Right now the sprite breakdown for the playing state looks roughly like this:<br>
<div style="margin-left: 40px;">
	4 - Hero<br>
	1 - Hero&apos;s face<br>
	2-4 - Weapon A<br>
	6 - Weapon B<br>
	20-24 - Enemies (generally four sprites each, maximum of 6 large enemies&#xA0;on a given screen, which yes, I realize is high and will cause scan line issues if measures are not taken)<br>
	10-12 - Enemy weapons (2 sprites each, though this may be reduced)<br>
	? - Dropped items (may be able to reuse enemy sprites?, not sure as I have not tried to do these yet)<br>
	? - Objects, items, etc. (doors, keys, chests, switches,&#xA0;whatever; although some of these could be done with background tiles)<br>
	? - Graphical flair<br>
	2-4 - Weapon B status bar image</div>
<br>
It seems to be adding up pretty quickly, but then again there is not a lot more that needs to be accounted for (feel free to point out omissions/oversights). I have probably budgeted too many sprites&#xA0;for certain things, but I&apos;d rather be&#xA0;thinking ahead&#xA0;than running out of room by misusing things unknowingly.<br>
<br>
<br>
I was kind of trying to avoid this, but since it looks like sprites are the way to go&#xA0;when it comes to an inventory screen there&#xA0;results a question.&#xA0;When switching between the playing state and the inventory state, what would be a decent way of preserving the active positions/tiles/attributes of the on-screen sprites? I have BunnyBoy&apos;s update sprite concept working well,&#xA0;meaning that&#xA0;when the start button is pressed the state and screen switch and move all sprites off-screen. When the button is pressed again the game returns to its previous state and the sprites resume their last positions.&#xA0;As it stands, this&#xA0;will work great for cut scenes&#xA0;and other static screens composed solely of background tiles.&#xA0;However, if the inventory screen is made up of sprites and these are updated using the same method&#xA0;as in the playing state (some form of updates will need to occur as weapon and items are added to the player&apos;s inventory), this alters their last position, causing them to move when play is resumed. If&#xA0;there were enough free sprites I could simply move the playing ones off-screen and the inventory ones on-screen, but it seems that the playing sprites (hero, enemies, weapons, etc.) will have to be re-purposed for the inventory screen (8 weapons/items using 2-4 sprites a piece, plus whatever else).&#xA0;A clunky way to preserve their positions would be to save the sprite positions/attributes/tiles to a place holder variable and reload it, but I am guessing that there is a more elegant, and less variable costing&#xA0;method. Of course, the&#xA0;other way to do all of this would be to use background tiles&#xA0;for the weapon/item images, but this will eat up a lot of&#xA0;background tiles. A separate CHR page (pardon the terminology if this is not correct)&#xA0;could be devoted&#xA0;to the inventory screen, but this may not be ideal.&#xA0;Any thoughts?<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__141">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 3, 2014 at 7:46:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
		<br>
		I wouldn&apos;t worry about saving sprites at this stage. I&apos;d be surprised if you ever have enough going on (that looks okay) to where you actually run out of them. I&apos;d focus more on making your game look cool and colorful than this stuff.</div>
	<br>
	<br>
	Right now the sprite breakdown for the playing state looks roughly like this:<br>
	<div style="margin-left: 40px;">
		4 - Hero<br>
		1 - Hero&apos;s face<br>
		2-4 - Weapon A<br>
		6 - Weapon B<br>
		20-24 - Enemies (generally four sprites each, maximum of 6 large enemies&#xA0;on a given screen, which yes, I realize is high and will cause scan line issues if measures are not taken)<br>
		10-12 - Enemy weapons (2 sprites each, though this may be reduced)<br>
		? - Dropped items (may be able to reuse enemy sprites?, not sure as I have not tried to do these yet)<br>
		? - Objects, items, etc. (doors, keys, chests, switches,&#xA0;whatever; although some of these could be done with background tiles)<br>
		? - Graphical flair<br>
		2-4 - Weapon B status bar image</div>
	<br>
	It seems to be adding up pretty quickly, but then again there is not a lot more that needs to be accounted for (feel free to point out omissions/oversights). I have probably budgeted too many sprites&#xA0;for certain things, but I&apos;d rather be&#xA0;thinking ahead&#xA0;than running out of room by misusing things unknowingly.<br>
	<br>
	<br>
	I was kind of trying to avoid this, but since it looks like sprites are the way to go&#xA0;when it comes to an inventory screen there&#xA0;results a question.&#xA0;When switching between the playing state and the inventory state, what would be a decent way of preserving the active positions/tiles/attributes of the on-screen sprites? I have BunnyBoy&apos;s update sprite concept working well,&#xA0;meaning that&#xA0;when the start button is pressed the state and screen switch and move all sprites off-screen. When the button is pressed again the game returns to its previous state and the sprites resume their last positions.&#xA0;As it stands, this&#xA0;will work great for cut scenes&#xA0;and other static screens composed solely of background tiles.&#xA0;However, if the inventory screen is made up of sprites and these are updated using the same method&#xA0;as in the playing state (some form of updates will need to occur as weapon and items are added to the player&apos;s inventory), this alters their last position, causing them to move when play is resumed. If&#xA0;there were enough free sprites I could simply move the playing ones off-screen and the inventory ones on-screen, but it seems that the playing sprites (hero, enemies, weapons, etc.) will have to be re-purposed for the inventory screen (8 weapons/items using 2-4 sprites a piece, plus whatever else).&#xA0;A clunky way to preserve their positions would be to save the sprite positions/attributes/tiles to a place holder variable and reload it, but I am guessing that there is a more elegant, and less variable costing&#xA0;method. Of course, the&#xA0;other way to do all of this would be to use background tiles&#xA0;for the weapon/item images, but this will eat up a lot of&#xA0;background tiles. A separate CHR page (pardon the terminology if this is not correct)&#xA0;could be devoted&#xA0;to the inventory screen, but this may not be ideal.&#xA0;Any thoughts?<br>
	<br>
	&#xA0;</div>
<br>
One idea which might help and which I think is reflected in a lot of game engines, NES and modern is to abstract your drawing code away from your &quot;object&quot; code. In other words, you might have some portions of RAM devoted entirely to the abstract idea of an object or &quot;entity&quot; as I call them in my engine. So you might have:<br>
<br>
entity_alive: .res MAX_ENTITIES &#xA0;;where MAX_ENTITIES might be say 8 or something, whatever you want<br>
entity_type: .res MAX_ENTITIES &#xA0;;this could be an index into a look up table of &quot;brain routines&quot; for each object<br>
entity_x: .res MAX_ENTITIES &#xA0;&#xA0;<br>
entity_y: .res MAX_ENTITIES<br>
entity_sprite_lo: .res MAX_ENTITIES<br>
entity_sprite_hi: .res MAX_ENTITIES<br>
<br>
And you&apos;d have a part of your engine called something like:<br>
<br>
.proc update_entities<br>
<br>
&#xA0; &#xA0;;in here, iterate over entity_alive, and for any entity that is alive, look up its &quot;brain&quot; routine using entity_type<br>
&#xA0; &#xA0;;each entity &quot;brain&quot; routine would be responsible for making that entity move the way it is supposed to.<br>
<br>
&#xA0; rts<br>
<br>
.endproc<br>
<br>
and you might also have:<br>
<br>
.proc draw_entities<br>
<br>
&#xA0; ;in here, interate over all entities that are &quot;alive&quot; and call a metasprite drawing routine and pass it entity_x and entity_y, entity_sprite_lo and entity_sprite_hi (the full address of a metasprite for the entity).<br>
<br>
&#xA0; rts<br>
<br>
.endproc<br>
<br>
The metasprite drawing routine would read the metasprite and shovel the sprites into $0200. Exactly *where* it gets shoveled will depend on your game engine. For simpler games that do not require sorting of any kind, a common technique is to store one variable for the last sprite written (a pointer into $0200), and just shovel metasprites into that point, and let that variable keep wrapping around the page. This is a cheap way to implement sprite flickering, too, but for simpler games this typically won&apos;t even show up that much.<br>
<br>
But anyway, I just skimmed a ton of details there...but the main point is that if you can separate out the concept of &quot;make stuff move around&quot; from &quot;draw stuff&quot; and treat the sprite page as just the thing to which you draw things, you can switch states in your game with ease and not worry about what sprites were occupying the sprite page. They would still be in your entity variables.<br>
<br>
Feel free to PM or email me, too, if you are interested in talking more about any of that stuff.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__142">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 3, 2014 at 7:55:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Just to add a couple more thoughts: Your play state would be the one that would call update_entities and draw_entities. When you go to something like an inventory state, you&apos;d probably just stop calling those, leaving all the entities at the positions/state they were last in for the time being. Then once in the inventory state, you will clear all the sprites in $0200, and then draw whatever is appropriate for the inventory state (probably not entity objects, depending on your engine, probably just a couple of cursors or what not). When you go back to the play state you&apos;d resume calling update_entities and draw_entities, and again $0200 would have the sprites at the locations they were last updated to. Does any of that make sense or am I going way too fast?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__143">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Feb 3, 2014 at 10:18:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>GradualGames</b></i><br>
	<br>
	Just to add a couple more thoughts: Your play state would be the one that would call update_entities and draw_entities. When you go to something like an inventory state, you&apos;d probably just stop calling those, leaving all the entities at the positions/state they were last in for the time being. Then once in the inventory state, you will clear all the sprites in $0200, and then draw whatever is appropriate for the inventory state (probably not entity objects, depending on your engine, probably just a couple of cursors or what not). When you go back to the play state you&apos;d resume calling update_entities and draw_entities, and again $0200 would have the sprites at the locations they were last updated to. Does any of that make sense or am I going way too fast?</div>
<br>
Hey Derek,<br>
<br>
Your first post is going to take a bit of time to dwell upon, but for the most part I think that I have indeed&#xA0;separated the variable/movement code from the drawing code. The issue is,&#xA0;if the inventory screen is going to be made up largely of sprites, how can these be re-positioned and changed without affecting the update routines in the playing state?&#xA0;I wrote you a nice long message detailing all of my steps and logic, and then somewhere in there I realized that if the inventory screen sprites are updated during the Load Inventory state, but AFTER the LoadSprites routine, they will not affect the playing state positions. Everything resets to its former place once the playing state is called again.&#xA0;This gets rid of any sort of UpdateInventory routine that would be running during the main inventory state (which I had modeled off of the playing state updates),&#xA0;except for a cursor of course.&#xA0;When I tried that approach I may have been doubling variables between the two states, come to think of it, but the solution here works for now. Thanks though for re-clarifying a bunch of things, and bringing up some new things to consider as well. I recently played a game that did not&#xA0;implement sprite flicker and watched as half of the enemies became twice a deadly with their new found invisibility.&#xA0;<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__144">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Feb 8, 2014 at 8:04:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<a href="http://pastebin.com/EMSR2Gua" target="_blank" original-href="http://pastebin.com/EMSR2Gua">http://pastebin.com/EMSR2Gua...</a>
<br>I made this little program to mess with backgrounds, and I&apos;m wondering if you can use less code to write lines 149-164, i.e. not having to use this kind of code multiple times
<br>  LDA $2002  ;/___________________________________________________________________________________________________________________________________/
<br>  LDA #$XX  ;_\Hi part of the address
<br>  STA $2006
<br>  LDA #$XX  ;Lo part of the address
<br>  STA $2006
<br>
<br>ROM is here
<br><a href="https://dl.dropboxusercontent.com/u/53366073/randomletter.nes" target="_blank" original-href="https://dl.dropboxusercontent.com/u/53366073/randomletter.nes">https://dl.dropboxusercontent.com...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__145">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 8, 2014 at 8:15:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					LDA $2002<br>
LDA #$21 ;Write Hipart of $21BC to PPU<br>
STA $2006<br>
LDA #$BC ;Now Lopart<br>
STA $2006<br>
LDA randomness<br>
STA $2007<br>
LDA $2002 ;NOT NEEDED ANYHOW, THIS DOES NOTHING.<br>
LDA #$21 ;Write Hipart of $21DC to PPU<br>
STA $2006<br>
LDA #$DC ;Now Lopart<br>
STA $2006<br>
LDA randomness<br>
CLC<br>
ADC #$10<br>
STA $2007<br>
<br>
can be:<br>
<br>
LDA ($2000 Var in RAM) ;Get the game $2000 register value, this will be stored in RAM.<br>
ORA %00000100 ;Set +32 mode.<br>
STA PPUCtrl ;Set it up. Use a name not a number.<br>
LDA PPUStatus ;Reset high/low PPU latch. Use a name not a number.<br>
LDA #$21<br>
STA PPUData ;Less numbers on out code the better. Put a name to the PPU register, not a number. Numbers are hard to remember, names are not. Names is from nesdev wiki.<br>
LDA #$BC<br>
LDA Randomness<br>
STA PPUData ;Write the first value.<br>
CLC<br>
ADC #$10<br>
STA PPUData ;Write the second.<br>
<br>
With this routin just watch what the games *wants* to be the default for the PPU increment. We usually want it to be 1, but this changes it to 32, which will be used from now on unles you change it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__146">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Feb 8, 2014 at 8:36:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	LDA $2002<br>
	LDA #$21 ;Write Hipart of $21BC to PPU<br>
	STA $2006<br>
	LDA #$BC ;Now Lopart<br>
	STA $2006<br>
	LDA randomness<br>
	STA $2007<br>
	LDA $2002 ;NOT NEEDED ANYHOW, THIS DOES NOTHING.<br>
	LDA #$21 ;Write Hipart of $21DC to PPU<br>
	STA $2006<br>
	LDA #$DC ;Now Lopart<br>
	STA $2006<br>
	LDA randomness<br>
	CLC<br>
	ADC #$10<br>
	STA $2007<br>
	<br>
	can be:<br>
	<br>
	LDA ($2000 Var in RAM) ;Get the game $2000 register value, this will be stored in RAM.<br>
	ORA %00000100 ;Set +32 mode.<br>
	STA PPUCtrl ;Set it up. Use a name not a number.<br>
	LDA PPUStatus ;Reset high/low PPU latch. Use a name not a number.<br>
	LDA #$21<br>
	STA PPUData ;Less numbers on out code the better. Put a name to the PPU register, not a number. Numbers are hard to remember, names are not. Names is from nesdev wiki.<br>
	LDA #$BC<br>
	LDA Randomness<br>
	STA PPUData ;Write the first value.<br>
	CLC<br>
	ADC #$10<br>
	STA PPUData ;Write the second.<br>
	<br>
	With this routin just watch what the games *wants* to be the default for the PPU increment. We usually want it to be 1, but this changes it to 32, which will be used from now on unles you change it.</div>
A few questions...<br>
1 - What does ORA do? What I understand is that it&apos;s used to make the PPU increment by 32 instead of 1 so it goes directly to where the bottom of the letter should be<br>
2 - It&apos;s not a bad idea to use names for the PPU registers, however, how do you want me to set them up?<br>
3 - Can I have a link to the page with your names from the NESdev wiki?<br>
4 - What&apos;s with the first line?<br>
<br>
That&apos;s all. Thanks for helping an ASM n00b ^^<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__147">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 8, 2014 at 8:42:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					1. ORA sets certain bits, I wrote it in binary so you can see which bits are set with it, it&apos;s the 3rd bit over from the left. 2^2.
<br>
<br>2. The NESDev wiki pake. Most people use PPU(Name)4 letters after. Its pretty easy to understand. <a href="http://wiki.nesdev.com/w/index.php/PPU_registers" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_registers">http://wiki.nesdev.com/w/index.ph...</a>
<br>
<br>PPUCtrl=$2000
<br>PPUMask=$2001
<br>PPUStatus=$2002
<br>PPUOAMAddr=$2003
<br>PPUOAM(Data)=$2004
<br>PPUScroll=$2005
<br>PPUAddr=$2006
<br>PPUData=$2007
<br>
<br>4. The () just show I dont really know what to put there. Most games keep a copy of $2000 and $2001 in RAM, instead of using magic values, or hard-coded stuff, this is the way you&apos;d use it with a game engine already around it. Or your code will eventually develop into this style, it&apos;s just much easier.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__148">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Feb 8, 2014 at 8:53:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	1. ORA sets certain bits, I wrote it in binary so you can see which bits are set with it, it&apos;s the 3rd bit over from the left. 2^2.<br>
	<br>
	2. The NESDev wiki pake. Most people use PPU(Name)4 letters after. Its pretty easy to understand. <a href="http://wiki.nesdev.com/w/index.php/PPU_registers" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_registers">http://wiki.nesdev.com/w/index.php/PPU_registers</a><br>
	<br>
	PPUCtrl=$2000<br>
	PPUMask=$2001<br>
	PPUStatus=$2002<br>
	PPUOAMAddr=$2003<br>
	PPUOAM(Data)=$2004<br>
	PPUScroll=$2005<br>
	PPUAddr=$2006<br>
	PPUData=$2007<br>
	<br>
	4. The () just show I dont really know what to put there. Most games keep a copy of $2000 and $2001 in RAM, instead of using magic values, or hard-coded stuff, this is the way you&apos;d use it with a game engine already around it. Or your code will eventually develop into this style, it&apos;s just much easier.</div>
<br>
Thanks <span class="sprites_emoticons absmiddle" id="emo_happy"></span> That article from NESdev is going to be an interesting read <span class="sprites_emoticons absmiddle" id="emo_smile"></span> However, I still don&apos;t quite understand question 4 :/<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__149">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Feb 8, 2014 at 9:07:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It just shows you&apos;re supposed to replace it. You can either use a one-off value (#$XX) or a variable in RAM. Most engines and such have a variable to keep track of the current $2000 setup of the PPU, I just wrote it like that so if you did, you&apos;d know where to put it. <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__150">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Feb 8, 2014 at 9:17:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	It just shows you&apos;re supposed to replace it. You can either use a one-off value (#$XX) or a variable in RAM. Most engines and such have a variable to keep track of the current $2000 setup of the PPU, I just wrote it like that so if you did, you&apos;d know where to put it.</div>
<br>
<br>
Aha! Now I understand! Thanks for the help ^^
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__151">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 10, 2014 at 5:58:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The PPUDATA read buffer (post-fetch) section of that page is interesting.  I have used this a lot with collision detection and know you have to read twice, but I didn&apos;t know why!  Learning.  Who&apos;d a thunk it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__152">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Feb 12, 2014 at 3:05:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have another question about my program... In my program, the &quot;randomness&quot; factor is determined by incrementing a certain value. When the button is pressed, this value is stored in the box to determine the letter. However, it&apos;s not really that random as you might have guessed, so I&apos;d like to know if there&apos;s a way to make better &quot;random&quot; values, which can be used for things a bit more advanced than generating a random letter like taking a random card from a deck of cards
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__153">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Feb 12, 2014 at 4:33:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You can find some random number generators from here: <a href="http://codebase64.org/doku.php?id=base:6502_6510_maths#random_numbers" target="_blank" original-href="http://codebase64.org/doku.php?id=base:6502_6510_maths#random_numbers">http://codebase64.org/doku.php?id...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__154">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Feb 12, 2014 at 5:19:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks! This one seems fairly simple, here&apos;s what I understand about it. Keep in mind that I&apos;m a beginner at 6502 ASM, as I just finished the Nerdy Nights.
<br>getrandom:
<br>
<br>         lda random+1  ;Loads random into the accumulator (Don&apos;t have a clue about the +1 though)
<br>         sta temp1  ;Stores random+1 to temp1
<br>         lda random  ;Loads Random without the +1
<br>         asl a  ;Shifts the value (random divided by two) in the accu to the left, sticks byte 0 in the carry flag
<br>         rol temp1  ;ROLs (Rotate left, multiplies by two) temp1, which is random+1
<br>         asl a  ;Do what you already did to the value in the accu a second time
<br>         rol temp1  ;Same for temp1
<br>         clc  ;Clear the Carry flag
<br>         adc random  ;Then add random to the accumulator
<br>         pha  ;vectrex280996.exe encountered an unknown opcode and stopped running. What I understand is that this makes a copy of the accu to the stack according to <a href="http://www.obelisk.demon.co.uk/6502/reference.html#PHA" target="_blank" original-href="http://www.obelisk.demon.co.uk/6502/reference.html#PHA">http://www.obelisk.demon.co.uk/65...</a>
<br>         lda temp1  ;Loads temp1 to the accu
<br>         adc random+1  ;Adds random+1 to accu
<br>         sta random+1  ;Then stores this to random+1
<br>         pla  ;What does this opcode do? According to <a href="http://www.obelisk.demon.co.uk/6502/reference.html#PLA" target="_blank" original-href="http://www.obelisk.demon.co.uk/6502/reference.html#PLA">http://www.obelisk.demon.co.uk/65...</a>, it takes the value you put in the stack before and sticks it in the accumulator
<br>         adc #$11  ;Add #$11 (Decimal 17) to what is in the accu (don&apos;t really know what&apos;s in the accumulator due to pla)
<br>         sta random  ;Store it in random
<br>         lda random+1  ;Loads random+1 in the accu
<br>         adc #$36  ;Add hex value 36 (Decimal 54 to the accumulator
<br>         sta random+1  ;Then stores it to random+1
<br>
<br>         rts
<br>
<br>temp1:   
<br>  .byte $5a
<br>random:  
<br>  .byte %10011101,%01011011
<br>
<br>
<br>A few questions now.
<br>1.What is the +1 for?
<br>2.What do PLA and PHA really do?
<br>3.What is .byte for?
<br>4.How can I use this subroutine when I want a random value in my game?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__155">
                                                        <div class="mdl-card__title"><strong>segis</strong> posted on 
		
			
				
				Feb 12, 2014 at 5:34:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Im kind of interested in starting to get a cheap eprom programmer ( <a href="http://rover.ebay.com/rover/1/711-53200-19255-0/1?type=1&amp;campid=5338390229&amp;toolid=10001&amp;mpre=http%3A%2F%2Fwww.ebay.com%2Fitm%2FTOP853-USB-universal-programmer-EPROM-MCU-GAL-PIC-%2F330583838352%3Fpt%3DAU_B_I_Electrical_Test_Equipment%26hash%3Ditem4cf8550e90" target="_blank" original-href="http://rover.ebay.com/rover/1/711-53200-19255-0/1?type=1&amp;campid=5338390229&amp;toolid=10001&amp;mpre=http%3A%2F%2Fwww.ebay.com%2Fitm%2FTOP853-USB-universal-programmer-EPROM-MCU-GAL-PIC-%2F330583838352%3Fpt%3DAU_B_I_Electrical_Test_Equipment%26hash%3Ditem4cf8550e90">http://www.ebay.com/itm/TOP853-US...</a> ) and i wonder if its suited for snes eproms and what eproms should i get? 
<br>I got some german and japanese games i want to translate like terranigma. Is there anything special i should learn before geting one?
<br>Every answer is a big help!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__156">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 12, 2014 at 8:22:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	Thanks! This one seems fairly simple, here&apos;s what I understand about it. Keep in mind that I&apos;m a beginner at 6502 ASM, as I just finished the Nerdy Nights.<br>
	getrandom:<br>
	<br>
	lda random+1 ;Loads random into the accumulator (Don&apos;t have a clue about the +1 though)<br>
	sta temp1 ;Stores random+1 to temp1<br>
	lda random ;Loads Random without the +1<br>
	asl a ;Shifts the value (random divided by two) in the accu to the left, sticks byte 0 in the carry flag<br>
	rol temp1 ;ROLs (Rotate left, multiplies by two) temp1, which is random+1<br>
	asl a ;Do what you already did to the value in the accu a second time<br>
	rol temp1 ;Same for temp1<br>
	clc ;Clear the Carry flag<br>
	adc random ;Then add random to the accumulator<br>
	pha ;vectrex280996.exe encountered an unknown opcode and stopped running. What I understand is that this makes a copy of the accu to the stack according to <a href="http://www.obelisk.demon.co.uk/6502/reference.html#PHA" target="_blank" original-href="http://www.obelisk.demon.co.uk/6502/reference.html#PHA">http://www.obelisk.demon.co.uk/6502/reference.html#PHA</a><br>
	lda temp1 ;Loads temp1 to the accu<br>
	adc random+1 ;Adds random+1 to accu<br>
	sta random+1 ;Then stores this to random+1<br>
	pla ;What does this opcode do? According to <a href="http://www.obelisk.demon.co.uk/6502/reference.html#PLA" target="_blank" original-href="http://www.obelisk.demon.co.uk/6502/reference.html#PLA">http://www.obelisk.demon.co.uk/6502/reference.html#PLA</a>, it takes the value you put in the stack before and sticks it in the accumulator<br>
	adc #$11 ;Add #$11 (Decimal 17) to what is in the accu (don&apos;t really know what&apos;s in the accumulator due to pla)<br>
	sta random ;Store it in random<br>
	lda random+1 ;Loads random+1 in the accu<br>
	adc #$36 ;Add hex value 36 (Decimal 54 to the accumulator<br>
	sta random+1 ;Then stores it to random+1<br>
	<br>
	rts<br>
	<br>
	temp1:<br>
	.byte $5a<br>
	random:<br>
	.byte %10011101,%01011011<br>
	<br>
	<br>
	A few questions now.<br>
	1.What is the +1 for?<br>
	2.What do PLA and PHA really do?<br>
	3.What is .byte for?<br>
	4.How can I use this subroutine when I want a random value in my game?</div>
<br>
thumbs up for the site thefox mentioned, I got a psrng from there as well, haha.<br>
<br>
1. The +1 accesses one byte past what the address &quot;random&quot; points to. &quot;random&quot; is an address, which is basically an index into a huge list of &quot;bytes&quot;. Bytes can be thought of as a number from 0 to 255. You can look up 65536 bytes all in a row, numbered from 0 to 65535, using the 6502&apos;s 16 bit addressing system. Some of these bytes are mapped to RAM, others to permanent ROM, and still others to registers that control what the NES&apos;s graphics, sound and input hardware do.<br>
<br>
2. pha and pla push to and pull from the stack, respectively. Basically it literally takes whatever is in the accumulator and literally puts it on a stack. The only rule is, the last thing you put in (pha) is the first thing you will pull out (pla). It&apos;s most common use is when calling subroutines, with jsr. The cpu automatically uses the stack, with that, though, you don&apos;t need pha and pla for calling a routine (you do need rts though). &#xA0;It&apos;s very useful for preserving local state when you need to jump to a routine that may clobber a part of RAM you were using before you called said routine. Typically one wants to avoid that but used judiciously it can be very convenient.<br>
<br>
3. .byte tells the assembler to just spit out a byte into the ROM. This is a bit hard to explain. When you first start out you will see .res 1 &#xA0;in some places and .byte $00 in others and wonder what the real difference is. Basically, .res will not actually output a byte. It just means<br>
<br>
random: .res 1<br>
<br>
Will point to a location in memory. You won&apos;t typically see .res anywhere but ZP or RAM on the NES, because its for reading/writing variables.<br>
<br>
.byte $00 will actually put the value &quot;0&quot; permanently into your rom. So if you&apos;re storing data such as a metasprite, a coordinate, some other value for whatever you&apos;re doing in your engine, and you want it to be PERMANENT, you use .byte. (or .word, or a host of other directives that some assemblers offer)<br>
<br>
Using a prng is fairly easy. Just call it to let it permute the current value of random (and random+1...looks like this one works with a 16 bit value), and then transform that value into something usable like a coordinate, a speed, or whatever else you may need it for. It&apos;s often possible to get better results from prngs by throwing more chaos into it drawn from parts of your engine, such as the player&apos;s coordinates (a human can add a lot of randomness to a game).<br>
<br>
Hope that helps a little!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__157">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 12, 2014 at 8:26:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Note! That prng you found is probably intended for a machine that loads a program into RAM, as it DOES use .byte to spit out a value into what appears to be treated as RAM, in that routine. On the NES, you may want to adapt this by doing:<br>
<br>
random: .res 2<br>
<br>
and then have an init routine that fills &quot;random&quot; with an initial seed value.<br>
<br>
I skimmed over a lot there---there&apos;s a lot of details other tutorials and folks here can help fill in. Hopefully something in there helped a bit, though.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__158">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 12, 2014 at 9:09:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The random routine you posted is the same one I use in all my games, Vectrex. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__159">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Feb 13, 2014 at 1:34:56 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the explanation! However, I still don&apos;t understand a few things...
<br>1.Whenever I input  .res 2 in NESASM3, it says &quot;Unknown instruction!&quot;. Any idea on how I could adapt this piece of code to the NES?
<br>2.What I understand about using the prng is that you call it with a JSR to get the current value of random and random+1, then you can do something like
<br>  LDA random
<br>  STA playerspeed
<br>to make the player&apos;s speed &quot;random&quot;. random+1 should be used in a 16 bit value (I think).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__160">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 13, 2014 at 9:21:08 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Someone may need to step in and help. &quot;.res&quot; is what I&apos;m familiar with in CA65...I actually forget right now what its counterpart in nesasm is. It might be .rs. Also, make sure based on whatever tutorials you are using that you&apos;re using these directives in the right places. .rs / .res needs to be used somewhere in ram (usually zp, stack, or bss). .byte, somewhere in your rom.<br>
<br>
for #2 yes, you just need to play with it and figure out how to transform the random value to something that makes sense for what you are doing. Usually this sort of thing takes a lot of tweaking to get desirable results that &quot;feel truly random.&quot; even though ultimately they really aren&apos;t <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__161">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Feb 13, 2014 at 10:57:11 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>GradualGames</b></i><br>
	<br>
	Someone may need to step in and help. &quot;.res&quot; is what I&apos;m familiar with in CA65...I actually forget right now what its counterpart in nesasm is. It might be .rs. Also, make sure based on whatever tutorials you are using that you&apos;re using these directives in the right places. .rs / .res needs to be used somewhere in ram (usually zp, stack, or bss). .byte, somewhere in your rom.<br>
	<br>
	for #2 yes, you just need to play with it and figure out how to transform the random value to something that makes sense for what you are doing. Usually this sort of thing takes a lot of tweaking to get desirable results that &quot;feel truly random.&quot; even though ultimately they really aren&apos;t</div>
Oh yeah! I use .rs when I declare variables at the beginning of my code so this may be it.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__162">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 13, 2014 at 11:11:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sent you a pm. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__163">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Feb 17, 2014 at 6:59:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m not sure what answer I&apos;m expecting, but I&apos;ll ask anyway <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>At what point do you guys just give up on doing things the &quot;right way&quot; and just settle for something that works?  I find myself spending too long finding clever tricks which is really holding me back, and I&apos;m finding it hard to force myself out of it.  A sort of premature optimisation I guess.  I see the same thing where people spend all their time bickering over the best way to do something, to the point where they never finish their projects.
<br>
<br>Anyway, I really just wanted thank you all for the advice and tutorials here, they&apos;ve been a great help.
<br>
<br>Rob.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__164">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 17, 2014 at 9:02:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That is an important question. All too many people get a bit too consumed with the &quot;right way.&quot; We see the opposite extreme, however, where there&apos;s no concern at all for the &quot;right way.&quot; It&apos;s a balancing act. It all depends on what is most deeply important to you. If it is more deeply important to you to build an entire game from end to end, then sometimes you may have to pick something that works rather than do it the right way. It&apos;s amazing how deep the &quot;right way&quot; can really go. When it comes to bugs and glitches, I believe it is important to always get at the root cause, or you can really step on yourself and make it very difficult to maintain your code. But in terms of choosing the right way of doing some aspect of a game engine---it is a balancing act.
<br>
<br>IMHO, if something is worth doing, it is worth doing badly (G.K. Chesterton). This quote has helped me focus on building complete games from end to end. Nice thing is---this quote merely helps remove inhibition, it doesn&apos;t mean I will commit to doing things poorly for all time. The code in Nomolos is pretty messy and ugly compared to what I&apos;m doing in Owlia, yet I&apos;m still aware of many flaws I could improve on for when I make a third game. I&apos;d rather have it this way than spin my wheels for years and never finish something!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__165">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 17, 2014 at 9:30:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					We&apos;re not bickering, we&apos;re discussing.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__166">
                                                        <div class="mdl-card__title"><strong>Alder</strong> posted on 
		
			
				
				Feb 17, 2014 at 9:45:06 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Great question.  I agree with Derek.  What matters most is that the game runs smoothly with minimal bugs.  A playable game with messy code is arguably better than a half-finished demo with elegant code.  
<br>
<br>However, I would like to stress code modularity.  There&apos;s a difference between inefficient (un-optimized) algorithms and unstructured code.  It&apos;s worth taking the time to think ahead and abstract your code down to the simplest possible modules.  In other words, writing an entire game in one huge function would be a nightmare to debug or modify, even with elegant code.  So code structure is more important than elegance when it comes to editing your game by scaling and maintaining your code.
<br>
<br>TL;DR: write functions that are well-defined and optimize them later, as needed.  
<br>
<br>This is coming from someone who still hasn&apos;t touched 6502, so take it with a grain of salt <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__167">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 17, 2014 at 10:33:44 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					In my opinion, as long as it works, it&apos;s the right way. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__168">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Feb 17, 2014 at 10:39:48 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the advice guys, I just need to suck it up and get it done.  Like Derek said, this is probably going to be an incremental thing, so get my first game done and learn and optimise from there.  I like that plan <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>And MRN: I was more thinking of the NesDev forums when I said that than here, your programming resources thread is fucking awesome <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__169">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 17, 2014 at 10:49:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Alder</b></i><br>
	<br>
	Great question. I agree with Derek. What matters most is that the game runs smoothly with minimal bugs. A playable game with messy code is arguably better than a half-finished demo with elegant code.<br>
	<br>
	However, I would like to stress code modularity. There&apos;s a difference between inefficient (un-optimized) algorithms and unstructured code. It&apos;s worth taking the time to think ahead and abstract your code down to the simplest possible modules. In other words, writing an entire game in one huge function would be a nightmare to debug or modify, even with elegant code. So code structure is more important than elegance when it comes to editing your game by scaling and maintaining your code.<br>
	<br>
	TL;DR: write functions that are well-defined and optimize them later, as needed.<br>
	<br>
	This is coming from someone who still hasn&apos;t touched 6502, so take it with a grain of salt</div>
<br>
yes, modularity of code is just as important in 6502 as any other language. I&apos;ve found it&apos;s possible to write very clean/readable code in pure 6502 with very little language level abstraction, or even macros. Often, an optimization can be found at a higher, architectural level that is influenced by the mechanics of your game that will give you more bang for your buck than squeezing every last cycle out of the CPU.<br>
<br>
KHAN: That&apos;s a good way of looking at it, from the perspective of your players. For yourself though, being the programmer, you have the most to gain from thinking about the &quot;right way,&quot; as it can increase efficiency of development and reduce the number of bugs you may have to work through. &#xA0;Note, in saying this I do not claim to be perfect at getting things right, code wise. I have a backlog of bugs and am aware of many flaws in my own code as well. It is something we all ought to think about.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__170">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 17, 2014 at 11:04:03 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>chowder</b></i><br>
	<br>
	Thanks for the advice guys, I just need to suck it up and get it done. Like Derek said, this is probably going to be an incremental thing, so get my first game done and learn and optimise from there. I like that plan<br>
	<br>
	And MRN: I was more thinking of the NesDev forums when I said that than here, your programming resources thread is fucking awesome</div>
<br>
That&apos;s a great attitude. Start with something of reasonable scope, too. Most successful homebrewers I&apos;ve met start small, finish their projects and then increase complexity from there.&#xA0;<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__171">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Feb 17, 2014 at 11:16:42 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Once your game is done nobody cares about what the code looks like!  Working vs a good design vs the best way makes no difference.  However a good-best way usually ends up being faster dev for that project and code reuse for the next project.  If my game is something I just need finished fast my code is very sloppy and inefficient compared to my full games.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__172">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 17, 2014 at 11:51:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The code from my first game scares me.  When I open it up I just get stressed out. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>  I re-coded Frogger and it took like 1/3 of the code space.  It&apos;s hilarious.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__173">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Feb 17, 2014 at 12:13:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hahaha, you don&apos;t want to see my current code then! &#xA0;I&apos;m probably over stretching myself with what I&apos;m attempting, but I&apos;ll keep at it and learn for future projects like you say. &#xA0;I&apos;m having fun working on this, so if it never gets finished it&apos;ll have at least provided some entertainment for myself. &#xA0;Hopefully it&apos;ll get done and provide entertainment to others when they play it <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__174">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 19, 2014 at 9:12:43 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yea, I&apos;m on my forth iteration of the nightman code.  The first two attempts I honestly have no clue how the room selection worked.  I had a professor in college that used to put ? marks everywhere and write &quot;compensating errors&quot;.  I just stopped messing with it when it worked.  Then, like Bunny said, there&apos;s no way to use it when you make another game.  The third iteration was pretty good, but it included separate engines for the levels and background, bad guys and playable characters.  Basically, doubling the code required.  This fourth iteration I have a better idea of what I&apos;m doing and it&apos;s pretty fucking sleek.  Adding new shit is as simple as copy/paste &amp; update pointer tables.  It all just depends on what you&apos;re going for.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__175">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Feb 23, 2014 at 8:39:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Since the topic of the week has been cleaning up/optimizing code, I had a question or two. For the most part my game engine has followed that of the Nerdy Nights, except that since Pong only had one screen for the playing state I did not know how to do individual rooms. At the moment, I have each room as a separate game state, which leads to a LOT of duplicated code since all of the playing state material is re-written for each room. Is this the correct way to do things? I am guessing not <span class="sprites_emoticons absmiddle" id="emo_smile"></span>, and from beginning to understand MRN&apos;s room indexing lesson I can see what appears to be another way (though I have not figured out how non-player character sprites are updated in new rooms), but could use whatever advice folks have to offer. Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__176">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Feb 24, 2014 at 9:01:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No, a game state would be like Pause, Cut Screens, Main Game, Death, etc. where there are different types of game functions.  I&apos;m pretty sure #6 (or there abouts) discusses this.  An &quot;engine&quot; would work with whatever you put into it.  It sounds like you&apos;re &quot;hard coding&quot; rooms if you have to make a different GS for each one.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__177">
                                                        <div class="mdl-card__title"><strong>Baka94</strong> posted on 
		
			
				
				Mar 7, 2014 at 7:30:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here&apos;s a question:
<br>What are the scanlines in NES&apos;s PPU? Why and where are they used? Why are they required for the PPU? I don&apos;t really understand them so I need explaining. Also, an example picture showing where the scanlines go would be helpful.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__178">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Mar 10, 2014 at 4:11:48 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					One horizontal row of pixels displayed on the TV screen is the scanline.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__179">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Mar 15, 2014 at 1:12:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					OK, I&apos;m stuck on the easiest way to do do player + bg collision detection.  I&apos;ve got it working with hard coded bounding boxes - basically, there are currently 6 variably sized blocks on a screen that should be impassible, so I coded the coords in for them, then compare them to the player sprite&apos;s box to see whether the movement should be allowed.  Works great, but I can&apos;t be bothered changing the coords every time I alter the level structure.
<br>
<br>With the following limitations in mind, what&apos;s the easiest way of doing this?
<br>
<br>1.) No scrolling.  Each screen is static.
<br>2.) I&apos;m not using metatiles, or even nametable compression at the moment.
<br>
<br>I thought of maybe just checking directions eg: sprite wants to move up, so check the tile one row up in the nametable, if it&apos;s solid, don&apos;t allow movement.  This would then cause issues where it&apos;s fixed to tile boundaries, so the sprite could potentially be stopped almost a full 8 pixels before the actual obstruction...  &quot;Pixel exact&quot; would be good.
<br>
<br>I&apos;m missing something really obvious, I&apos;m sure, but I can&apos;t figure it out <span class="sprites_emoticons absmiddle" id="emo_sad"></span>
<br>
<br>Thanks for any help.
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__180">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Mar 15, 2014 at 4:02:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You should not use bounding box intersection for BG-to-object collision. You need to have a walkmap instead, an array with flags for each tile that specified either it is passable or not.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__181">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Mar 15, 2014 at 7:51:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	You should not use bounding box intersection for BG-to-object collision. You need to have a walkmap instead, an array with flags for each tile that specified either it is passable or not.</div>
<br>
I just had a moment of inispriation with this post.&#xA0; I need to make some notes!<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__182">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Mar 16, 2014 at 6:13:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hmm, I&apos;m messing something up with my sprite-&gt;nametable coordinate mapping or something.  My impassible blocks have now become impassible buildings of various sizes due to my awesome graphical abilities (it&apos;s a top down rpg-ish/shooter).  It just seems easier to keep 4 bytes of collision data for each building (x1, y1, x2, y2) and looping through to check for collisions in each direction, but directly indexing the nametable data would make more sense I guess.  And also be even simpler if I knew what the hell I was doing <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__183">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Mar 16, 2014 at 7:13:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The bounding box based BG collision would work fine on modern platforms with a lot of RAM and CPU power, but on the NES it&apos;ll quickly become impractical as number of the BG elements grows up. Also, if you need a more complex walkmap shapes than a set of simple rectangles, like, diagonal slopes as in SMB3, you&apos;ll simply have to switch to array of tile flags instead of bounding boxes, because non-axis aligned rectangle collisions will take way much more CPU time.
<br>
<br>A complex case of BG-to-object collisions from an actual NES game is explained <a href="http://games.greggman.com/game/programming_m_c__kids/" target="_blank" original-href="http://games.greggman.com/game/programming_m_c__kids/">here</a>.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__184">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Mar 17, 2014 at 8:39:01 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That was an interesting read, thanks Shiru.  Way beyond my own talents at the moment, just baby steps for me at the moment.
<br>
<br>I have a single screen (created with your excellent Screen Tool btw, thank you for that!) just defined as a series of bytes - no compression.  Sprites are 8x8, I&apos;ve been trying to translate the player&apos;s X/Y coordinates to a nametable index by dividing by 8, then using tile_x * 32 + tile_y, but it doesn&apos;t seem to be working properly.
<br>
<br>I can&apos;t post the code now, I&apos;ll try again later and include code to see if anyone can lend a hand.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__185">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Mar 17, 2014 at 10:54:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>chowder</b></i><br>
	<br>
	then using tile_x * 32 + tile_y, but it doesn&apos;t seem to be working properly.</div>
It should be tile_y*32 + tile_x. Also you have to use 16-bit arithmetic because the result doesn&apos;t always fit in 8 bits.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__186">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Mar 17, 2014 at 12:10:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m looking at MRN&apos;s Metasprite tutorial right now, and I came up with this little program. However, I made my own random sprite movement routine, and it seems to crash on NEStopia (Mac version), even though it runs fine on Windows XP&apos;s FCEUX<br>
Anyone knows what&apos;s wrong?<br>
<a href="http://pastebin.com/ZiuSVTj3" target="_blank" original-href="http://pastebin.com/ZiuSVTj3">http://pastebin.com/ZiuSVTj3...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__187">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Mar 17, 2014 at 3:11:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					D&apos;oh! &#xA0;Of course the result needs to be 16-bit&#xA0;&#xA0; The other tile_x/tile_y part was a typo on my part. &#xA0;Thanks for the pointer thefox, it&apos;s much appreciated. &#xA0;That&apos;ll teach me for late night coding. &#xA0;And being a dumbass <span class="sprites_emoticons absmiddle" id="emo_happy"></span><br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__188">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Mar 18, 2014 at 6:29:44 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Anyone?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__189">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Mar 18, 2014 at 9:21:48 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	Anyone?</div>
<br>
You commented all the parts of the code that I don&apos;t need to understand. <span class="sprites_emoticons absmiddle" id="emo_smile"></span> I have no idea what you&apos;re trying to do after MoveRightDone. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__190">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Mar 18, 2014 at 9:36:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Without studying your code in great detail, it would appear the program is based entirely on nmi interrupts rather than main thread + interrupts (which is fine for something small). However, you still need an infinite loop to prevent your nmi handler from running outside of nmi. Right above your nmi routine, put something like:<br>
<br>
GameLoop:<br>
jmp GameLoop<br>
<br>
For an nmi based game that doesn&apos;t need much processing, you can just leave it blank.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__191">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Mar 18, 2014 at 12:19:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>GradualGames</b></i><br>
	<br>
	Without studying your code in great detail, it would appear the program is based entirely on nmi interrupts rather than main thread + interrupts (which is fine for something small). However, you still need an infinite loop to prevent your nmi handler from running outside of nmi. Right above your nmi routine, put something like:<br>
	<br>
	GameLoop:<br>
	jmp GameLoop<br>
	<br>
	For an nmi based game that doesn&apos;t need much processing, you can just leave it blank.</div>
Can&apos;t believe I&apos;m so stupid for having forgotten this! Of course it won&apos;t work that way <span class="sprites_emoticons absmiddle" id="emo_tongue"></span><br>
<br>
<i>Originally posted by:&#xA0;<b>KHAN Games</b></i><br>
<br>
<div class="FTQUOTE" "background-color: rgb(255, 255, 255); border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); border-left-width: border-left-style: border-left-color: rgb(119, 119, 119); border-right-width: border-right-style: border-right-color: border-top-width: border-top-style: border-top-color: width: 413px; margin-top: 10px; margin-right: 30px; margin-bottom: margin-left: padding-top: 6px; padding-right: padding-bottom: padding-left: ">
	<i>Originally posted by:&#xA0;<b>Vectrex280996</b></i><br>
	<br>
	Anyone?</div>
<br>
You commented all the parts of the code that I don&apos;t need to understand. I have no idea what you&apos;re trying to do after MoveRightDone.<br>
<div>
	<br>
	First forgetting an infinite loop, then forgetting to comment. That&apos;ll teach me to program on Sundays</div>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__192">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Mar 19, 2014 at 2:46:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Did that fix your problem?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__193">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Mar 20, 2014 at 5:46:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>chowder</b></i><br>
	<br>
	D&apos;oh! &#xA0;Of course the result needs to be 16-bit&#xA0;&#xA0; The other tile_x/tile_y part was a typo on my part. &#xA0;Thanks for the pointer thefox, it&apos;s much appreciated. &#xA0;That&apos;ll teach me for late night coding. &#xA0;And being a dumbass</div>
<br>
Cracked it, finally. &#xA0;This thread is very useful for anyone else struggling with bg/player collision:<br>
<br>
<a href="http://forums.nesdev.com/viewtopic.php?f=10&amp;t=9953" target="_blank" original-href="http://forums.nesdev.com/viewtopic.php?f=10&amp;t=9953">http://forums.nesdev.com/viewtopi...</a><br>
<br>
Thinking about it, it might be easier to just use a 120 byte array for bg collision (1 bit per 8x8 tile would suffice for my needs), thus saving oodles of space, but this works for now <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__194">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Mar 21, 2014 at 2:56:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br><br>Did that fix your problem?</div><br><br><br>
Yep it did
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__195">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 9, 2014 at 11:30:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I cannot for the life of me figure out sprites. I can write the code to load the initial sprites, that&apos;s easy. What I can&apos;t figure out is how to get more to load during game play (Push a button and sprite appears) or make them go away during game play (Push a button and the sprite is gone).&#xA0; Essentially, my sprites don&apos;t move, they are just replaced by other sprites. So, here is an example below (not my actual code, but I want to make my code do this):<br>
<br>
<strong>Here is what I want my code to do:</strong><br>
-Initially Load sprite1 and sprite4 (I can do this)<br>
-Press and hold Button A - sprite1 changes to sprite2 (and sprite2 changes to another and this continues until you get to the last sprite or release A, to keep it simple, I am just stopping at sprite2) AND<br>
sprite3 changes to sprite4<br>
<br>
<br>
-Release Button A - first set of sprites (sprite1 and sprite2) stop changing AND sprite4 changes back to sprite3<br>
-Press Button B - sprite2 changes back to sprite1<br>
<br>
So, basically, I want to push a button and make a sprite leave the screen and make a different sprite load on the screen in the exact same location. Sprites 1 and 2 are beer mugs and sprites 3 and 4 are the tap handle. Press Button A, fill mug (series of 7 sprites) and tap the handle. Let go of A, mug stops filling and handle go back to the up position. Press B, a new empty mug loads.<br>
<br>
<strong>Example Code:</strong><br>
;;Initial Sprite Load<br>
LoadSprite1:<br>
&#xA0; LDX #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start at 0<br>
.Loop:<br>
&#xA0; LDA sprites1, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; load data from address (sprites +&#xA0; x)<br>
&#xA0; STA $0200, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; store into RAM address ($0200 + x)<br>
&#xA0; INX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; X = X + 1<br>
&#xA0; CPX #$10&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare X to hex $10<br>
&#xA0; BNE .Loop&#xA0;&#xA0; ; Branch to LoadSpritesLoop if compare was Not Equal to zero<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
<br>
LoadSprite3:<br>
&#xA0; LDX #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start at 0<br>
.Loop:<br>
&#xA0; LDA sprites2, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; load data from address (sprites +&#xA0; x)<br>
&#xA0; STA $0220, x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; store into RAM address ($0220 + x)<br>
&#xA0; INX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; X = X + 1<br>
&#xA0; CPX #$08&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare X to hex $08<br>
&#xA0; BNE .Loop&#xA0;&#xA0; ; Branch to LoadSpritesLoop if compare was Not Equal to zero<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
<br>
<br>
sprite1: ;empty mug<br>
&#xA0;&#xA0;&#xA0;&#xA0; ;vert tile attr horiz<br>
&#xA0; .db $80, $00, $00, $90&#xA0;&#xA0; ;tile 0<br>
&#xA0; .db $80, $01, $00, $98&#xA0;&#xA0; ;tile 1<br>
&#xA0; .db $88, $02, $00, $90&#xA0;&#xA0; ;tile 2<br>
&#xA0; .db $88, $03, $00, $98&#xA0;&#xA0; ;tile 3<br>
<br>
sprite2: ;start to fill mug<br>
&#xA0;&#xA0;&#xA0;&#xA0; ;vert tile attr horiz<br>
&#xA0; .db $80, $04, $00, $90&#xA0;&#xA0; ;tile 4<br>
&#xA0; .db $80, $05, $00, $98&#xA0;&#xA0; ;tile 5<br>
&#xA0; .db $88, $06, $00, $90&#xA0;&#xA0; ;tile 6<br>
&#xA0; .db $88, $07, $00, $98&#xA0;&#xA0; ;tile 7<br>
<br>
sprite3: ;handle not tapped<br>
&#xA0;&#xA0;&#xA0;&#xA0; ;vert tile attr horiz<br>
&#xA0; .db $60, $08, $00, $90&#xA0;&#xA0; ;tile 8<br>
&#xA0; .db $68, $09, $00, $90&#xA0;&#xA0; ;tile 9<br>
<br>
<br>
sprite4: ;tapped handle<br>
&#xA0;&#xA0;&#xA0;&#xA0; ;vert tile attr horiz<br>
&#xA0; .db $60, $0A, $00, $90&#xA0;&#xA0; ;tile 10<br>
&#xA0; .db $68, $0B, $00, $90&#xA0;&#xA0; ;tile 11<br>
&#xA0; .db $60, $0C, $00, $88&#xA0;&#xA0; ;tile 12<br>
&#xA0; .db $68, $0D, $00, $88&#xA0;&#xA0; ;tile 13<br>
<br>
<br>
***NOTE*** The code I listed is just an example, so it proably has errors in the logic. I can fix that. I am just confused on process.<br>
<br>
Sorry if my question isn&apos;t clear, I&apos;m just so confused, I really don&apos;t even know how to ask what I&apos;m trying to do.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__196">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 10, 2014 at 1:00:01 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You only need to load the sprites when you&apos;re loading the screen for the first time. After that&apos;s it&apos;s just changing what tile each sprite is using, if you want it to appear in the same exact spot. Can you post your full code on pastebin and send me a PM?&#xA0; (I&apos;ll also need to see your CHR file)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__197">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 10, 2014 at 1:06:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Done. Do you need my CHR file?<br>
<br>
EDIT: Reread your message. Sending.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__198">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 10, 2014 at 1:31:05 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Issue resolved thanks to KHAN Games.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__199">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Apr 16, 2014 at 5:04:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					OK, my collision code still doesn&apos;t work right. Anyone know of any decent tutorials that don&apos;t assume you&apos;re using metatiles?<br>
<br>
[code]<br>
; create index into nametable from player x,y<br>
; return non-zero for a collision between player and bg tile<br>
check_collisions:<br>
lda #$00<br>
sta index + 1<br>
lda player_y<br>
and #%11111000<br>
asl<br>
rol index + 1<br>
asl<br>
rol index + 1<br>
adc #<game_bg 1 adc index lda sta>game_bg<br>
sta index + 1<br>
lda player_x<br>
lsr<br>
lsr<br>
lsr<br>
tay<br>
lda (index),y<br>
rts<br>
[/code]<br>
<br>
game_bg points to the (uncompressed) nametable data. It sort of works, but characters get stuck sometimes (guess I have to move them, then &quot;eject&quot; them the opposite direction if a collision occurred?), and other times it just doesn&apos;t seem to detect collisions right. Basically I&apos;m just classing anything non-zero in the nametable as solid at the moment. Any pointers at all?<br>
<br>
Thanks!</game_bg>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__200">
                                                        <div class="mdl-card__title"><strong>Dreadmoc</strong> posted on 
		
			
				
				Apr 20, 2014 at 1:58:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry guys,<br>
<br>
I&apos;m not as far along as you all seem to be at this point, but I just can&apos;t seem to find anything.<br>
<br>
My question is, if I plan to eventually move my game to a cart, are there certain tools I should avoid? Playing my game on a cart on my nintendo is the end result I&apos;m looking for and I just want to make sure I use the right tools to achieve this.<br>
<br>
Thanks guys.<br>
<br>
Edit: After going through a rather painful search mission, I gathered a little more information. I read that it is possible with nesasm using powerpak carts, or using new roms after performing some surgery on existing carts. Though the information is limited and I could use some clarification if anyone has the time. Most video tutorial tend to lead back to Nerdy Nights, and I suspect a lot of this information has simply become buried. I&apos;m having a hard time digging it up, I mean.<br>
<br>
As far as assemblers go, would I be able to burn a new rom using ca65? As far as pc to cart transfer, what is the better way to go? I know it seems early, but I want to make sure I&apos;m working with the right tools to begin with rather than fiddle around, get used to one and ave to change later.<br>
<br>
Thanks again.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__201">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 20, 2014 at 7:49:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Depends on what kind of game you&apos;re making. If you&apos;re getting into an NROM game as your first one, you shouldn&apos;t have any problems with whatever you use. I&apos;d stick with something simple for the first try. 
<br>
<br>After that, you should know enough to have an idea about what works and what won&apos;t.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__202">
                                                        <div class="mdl-card__title"><strong>Dreadmoc</strong> posted on 
		
			
				
				Apr 21, 2014 at 12:35:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks, man. I will. I watched your youtube videos on The Grind and some of the gameplay. Sweet shit, dude. I guess what you&apos;ve done is kind of the model i want to use. Though, I was thinking about a game more like Dr. Mario or Tetris for a first go, but I have a long way to go yet. I just got my feet wet.
<br>
<br>I managed to download cc65, fceux and run the simple &quot;Hello, NES!&quot; program. Even that was a nightmare. I finally found a good tutorial on how to separate folders, create the batch for the code and convert the file. Sweet deal. Now I am ready for some nerdy nights!
<br>
<br>I have a very long way to go, but I took my first baby steps today. 
<br>
<br>Thanks for taking the time to answer questions and share knowledge, man. I appreciate it.
<br>
<br>Nick
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__203">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Apr 21, 2014 at 1:26:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Assembler does not matter. What you should avoid is old emulators, they aren&apos;t very precise and may allow incorrect interaction with the hardware. I.e. your program will work seemingly correctly in such emulator, but not on the real console. Latest versions of Nestopia and Nintendulator are good to go.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__204">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 21, 2014 at 2:57:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I pasted a lot of code, so I just did a pastebin.<br>
<br>
Here is the issue, when I run this code in the ENGINETITLE section:<br>
&#xA0; LDA #$01<br>
&#xA0; STA ChangeColor&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Flag to tell the system to run UpdateColor Subroutine in the NMI section (00=Skip ColorUpdate, 01=Run ColorUpdate)<br>
&#xA0; LDA #$29&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0; STA attribute_RAM&#xA0;&#xA0;&#xA0;&#xA0; ;Color to change to $29<br>
<br>
My background goes to all zeros. If I take it out, the background loads just fine, but I my color won&apos;t go back to color $29.<br>
<br>
Basically, I am changing 1 color of the palette duing game play, specifically address #3F11, and I want to reset it to the default value for the Title Screen. In trying to do so, it breaks my LoadBackround Routine and I get all Zeros. The wierd thing is, the background should be loaded well before this point hits. I cannot for the life of me figure out what I am doing wrong.<br>
<br>
I have added a pastebin of the relevant code to the 3 process (Color Change, Switching Gamestates, and Loading Backgrounds). I do run the ColorUpdate Subroutine during gameplay to update some colors when the D-Pad is pressed and everything works fine there. It&apos;s only at the Title Screen where it breaks it.<br>
<br>
<a href="http://pastebin.com/Z785aqBB" target="_blank" original-href="http://pastebin.com/Z785aqBB">http://pastebin.com/Z785aqBB...</a><br>
<br>
Thanks! Hope this makes sense.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__205">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 21, 2014 at 3:26:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	I pasted a lot of code, so I just did a pastebin.<br>
	<br>
	Here is the issue, when I run this code in the ENGINETITLE section:<br>
	&#xA0; LDA #$01<br>
	&#xA0; STA ChangeColor&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Flag to tell the system to run UpdateColor Subroutine in the NMI section (00=Skip ColorUpdate, 01=Run ColorUpdate)<br>
	&#xA0; LDA #$29&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
	&#xA0; STA attribute_RAM&#xA0;&#xA0;&#xA0;&#xA0; ;Color to change to $29<br>
	<br>
	My background goes to all zeros. If I take it out, the background loads just fine, but I my color won&apos;t go back to color $29.<br>
	<br>
	Basically, I am changing 1 color of the palette duing game play, specifically address #3F11, and I want to reset it to the default value for the Title Screen. In trying to do so, it breaks my LoadBackround Routine and I get all Zeros. The wierd thing is, the background should be loaded well before this point hits. I cannot for the life of me figure out what I am doing wrong.<br>
	<br>
	I have added a pastebin of the relevant code to the 3 process (Color Change, Switching Gamestates, and Loading Backgrounds). I do run the ColorUpdate Subroutine during gameplay to update some colors when the D-Pad is pressed and everything works fine there. It&apos;s only at the Title Screen where it breaks it.<br>
	<br>
	<a href="http://pastebin.com/Z785aqBB" target="_blank" original-href="http://pastebin.com/Z785aqBB">http://pastebin.com/Z785aqBB</a><br>
	<br>
	Thanks! Hope this makes sense.</div>
<br>
I guess you took out a lot of code to simplify things for us, but it looks like the palette update is running nonstop at the title screen.&#xA0; Is there other code that only allows that flag to be set at a certain event?<br>
<br>
I would try setting those two variables to their respective values as you&apos;re changing the gamestate back to the title, and not when it&apos;s actually already in the title gamestate.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__206">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 21, 2014 at 3:39:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You really shouldn&apos;t be running your entire code in NMI like that. If that is your whole program, you&apos;ve removed the actual &quot;run during NMI&quot; part. Like KHAN said, you just run through the code continuously from top to bottom, over and over, and all NMI does is jump in and insert an additional run through in when NMI hits. Take a look through the NN and my tutorials again, it splits it out nicely.<br>
<br>
Also, you should be pushing/popping your registers in NMI or it will cause more problems.<br>
<br>
Also, and this really isn&apos;t important at this point, but if you just have a 0/1 flag, you can use something like:<br>
<br>
UpdateColor:<br>
LDA ChangeColor ;make a variable in zero page and set it to #$01 whenever you want this color to change.<br>
BEQ .End<br>
LDA $2002 ;changing the palette (and background tiles)<br>
LDA #$3F<br>
STA $2006<br>
LDA #$11 ;address of specific color you want to change<br>
STA $2006<br>
LDA attribute_RAM ;value of new color you want to change it to.<br>
STA $2007<br>
DEC ChangeColor<br>
.End:<br>
RTS<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__207">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 21, 2014 at 4:33:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	&#xA0;Is there other code that only allows that flag to be set at a certain event?<br>
	<br>
	I would try setting those two variables to their respective values as you&apos;re changing the gamestate back to the title, and not when it&apos;s actually already in the title gamestate.<br>
	&#xA0;</div>
The only other place that calls for that code is when the a directional pad is pushed only during game play. I only look at the Start Button on the Game Over and Title Screen. During gameplay, the code is skipped unless one of the directions is pressed.<br>
<br>
This was the first way I done it. The title screen works fine at first boot, but breaks when called by the Game Over Screeb.&#xA0; I actually had it like this first:<br>
<br>
<div class="de1">
	;----------------------------------------------------------- &#xA0;</div>
<div class="de2">
	;-----------------------START TITLE-------------------------</div>
<div class="de1">
	;-----------------------------------------------------------</div>
<div class="de2">
	StartTitle:</div>
<div class="de1">
	&#xA0; &#xA0;</div>
<div class="de2">
	&#xA0; LDA #STATETITLE</div>
<div class="de1">
	&#xA0; STA gamestate</div>
<div class="de2">
	&#xA0; &#xA0; JSR DisablePPU</div>
<div class="de2">
	&#xA0; &#xA0; JSR LoadBackground<br>
	&#xA0; &#xA0; JSR EnablePPU<br>
	&#xA0;&#xA0;&#xA0;&#xA0; <strong>LDA #$01<br>
	&#xA0; &#xA0;&#xA0; STA ChangeColor&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Flag to tell the system to run UpdateColor Subroutine in the NMI section (00=Skip ColorUpdate, 01=Run ColorUpdate)<br>
	&#xA0; &#xA0;&#xA0; LDA #$29&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
	&#xA0; &#xA0;&#xA0; STA attribute_RAM&#xA0;&#xA0;&#xA0;&#xA0; ;Color to change to $29</strong></div>
<div class="de1">
	&#xA0;</div>
<div class="de2">
	StartTitleDone:</div>
<div class="de1">
	&#xA0; RTS</div>
<div class="de1">
	--------------<br>
	<br>
	<br>
	And like this<br>
	<br>
	<br>
	<div class="de1">
		;----------------------------------------------------------- &#xA0;</div>
	<div class="de2">
		;-----------------------START TITLE-------------------------</div>
	<div class="de1">
		;-----------------------------------------------------------</div>
	<div class="de2">
		StartTitle:</div>
	<div class="de1">
		&#xA0; &#xA0;</div>
	<div class="de2">
		&#xA0; LDA #STATETITLE</div>
	<div class="de1">
		&#xA0; STA gamestate</div>
	<div class="de2">
		&#xA0; &#xA0; JSR DisablePPU</div>
	<div class="de1">
		&#xA0; &#xA0; JSR LoadBackground<br>
		<strong>&#xA0;&#xA0;&#xA0;&#xA0; LDA #$01<br>
		&#xA0; &#xA0;&#xA0; STA ChangeColor&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Flag to tell the system to run UpdateColor Subroutine in the NMI section (00=Skip ColorUpdate, 01=Run ColorUpdate)<br>
		&#xA0; &#xA0;&#xA0; LDA #$29&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
		&#xA0; &#xA0;&#xA0; STA attribute_RAM&#xA0;&#xA0;&#xA0;&#xA0; ;Color to change to $29</strong></div>
	<div class="de2">
		&#xA0; &#xA0; JSR EnablePPU</div>
	<div class="de1">
		&#xA0;</div>
	<div class="de2">
		StartTitleDone:</div>
	<div class="de1">
		&#xA0; RTS</div>
</div>
<br>
I thought I was doing everything correct for the NMI process, but maybe not. I have all of the practice code downloaded from NN, in fact this program is directly built off the last NN tutorial. I just ripped out the code and inserted mine as I went along.<br>
<br>
I thought I was being clever by leaving out the code that is irrelvant to the situation (I just didn&apos;t want to paste my code for all to see) but maybe it is leaving out what you were wanting to see. If you want to request it, I would do a temp pastebin for either of you for the entire code. Just know, there are parts that are intentionally left wrong because I haven&apos;t cleaned that part up yet or I am not on that step (such as the attributes for the Title and Game Over Screens.<br>
<br>
I will run through the tutorials again. I really don&apos;t understand what you mean by some of the suggestions such as &quot;you should be pushing/popping your registers in NMI or it will cause more problems&quot;, so apparently I misunderstood something in the tutorials.<br>
<br>
MRN, thanks for the slight change to UpdateColor, it&apos;s cleaner. Never thought to code it that way.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__208">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 22, 2014 at 12:36:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					*EDIT* Apparently My spacing didn&apos;t work. Going to try to edit this post.<br>
<br>
Rewrote the game states to match MRN&apos;s #2 tutorial code and this was the result:<br>
1. Flicker stopped on screen transition (found out I was turning the PPU back on too fast, need to let the NMI handle that).<br>
<br>
LDA #STATETITLE<br>
STA gamestate<br>
JSR DisablePPU<br>
JSR LoadBackground<br>
JSR EnablePPU &lt;--------REMOVED, NMI NOW DOES THIS PROCESS<br>
<br>
2. I was still getting the all 0&apos;s title screen when transitioning from the Game Over screen.<br>
FIX: Fixed this by moving the color change code to the transition of the Game Playing Screen to the Game Over Screen. Don&apos;t know why it fixed it, it happens at the same point of the other transition. The only difference, the first is called when you hit the Start Button, the second is called when the condition of the time reaching 00 hits.<br>
<br>
DOES NOT WORK HERE:<br>
;-----------------------------------------------------------<br>
;-----------------------START TITLE-------------------------<br>
;-----------------------------------------------------------<br>
StartTitle:<br>
<br>
LDA GameState<br>
STA GameState+1<br>
<br>
LDA #STATETITLE<br>
STA gamestate<br>
<br>
JSR DisablePPU<br>
JSR LoadBackground<br>
<br>
<strong>LDA #$01<br>
STA ChangeColor&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; ;Flag to tell the system to run UpdateColor Subroutine in the NMI section (00=Skip ColorUpdate, 01=Run ColorUpdate)<br>
LDA #$29<br>
STA attribute_RAM &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;Color to change to $29</strong><br>
<br>
StartTitleDone:<br>
RTS<br>
<br>
<br>
<br>
CODE WORKS HERE:<br>
;-----------------------------------------------------------<br>
;----------------------GAME OVER----------------------------<br>
;-----------------------------------------------------------<br>
CheckGameOver:<br>
LDA time1<br>
BNE CheckGameOverDone<br>
LDA time10<br>
BNE CheckGameOverDone &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;Check if Time is 00, if yes, change to Game Over State<br>
<br>
LDA GameState<br>
STA GameState+1<br>
<br>
LDA #STATEGAMEOVER<br>
STA GameState<br>
<br>
JSR DisablePPU<br>
JSR LoadBackground<br>
<br>
<strong>LDA #$01<br>
STA ChangeColor&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Flag to tell the system to run UpdateColor Subroutine in the NMI section (00=Skip ColorUpdate, 01=Run ColorUpdate)<br>
LDA #$29<br>
STA attribute_RAM&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Color to change to $29</strong><br>
<br>
CheckGameOverDone:<br>
RTS<br>
<br>
<br>
Conclussion: I think I rewrote my entire code for nothing. After moving the game state format to match MRN&apos;s instead of what I had, I think I just had to tweak my code just a bit to make it correct. Although, I learned a lot and I&apos;m now confused on some more stuff that I still need to figure out. I know the code works, I&apos;m just not fully grasping how it works. I&apos;m happy it&apos;s now to a state where I can move forward with my programming and put this behind me.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__209">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Apr 22, 2014 at 12:48:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Moving forward and not understanding is why you don&apos;t get it.<br>
<br>
Just gonna point out a logical error too: You don&apos;t disable the PPU then not enable it. Unless you do it in the NMI, in which your engine should be constructed so that it handles that situation and doesn&apos;t turn on rendering during certain events like screen uploading. Your NMI might cause glitches if you don&apos;t remember that point. Disabling, then having an NMI happen when &quot;off&quot; in the middle of doing stuff will lead to nasty bugs, that sometimes may or may not be easy to find.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__210">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 22, 2014 at 2:07:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	Moving forward and not understanding is why you don&apos;t get it. Just gonna point out a logical error too: You don&apos;t disable the PPU then not enable it. You have to enable it (Or at MINIMUM NMI&apos;s) forit to be enabled. Your NMI might cause glitches if you don&apos;t remember, it can and does happen. Disabling, then having an NMI happen when &quot;off&quot; in the middle of doing stuff will lead to nasty bugs.</div>
<br>
Thanks for clearing that up.&#xA0;&#xA0; ...?<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__211">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Apr 22, 2014 at 2:29:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	Moving forward and not understanding is why you don&apos;t get it.</div>
<br>
<br>
Some people learn in different ways. Sometimes advancing beyond your means is helpful and you start to understand more as you go on. I can&apos;t tell you how long it was that I didn&apos;t even understand how my controls were working with eor and and&apos;ing and all that jazz. But I moved on to learn more stuff. I ended up catching on to that kind of thing. Like I said, some people learn in different ways. No need to talk to the dude like that.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__212">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Apr 22, 2014 at 2:31:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Roth</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>3GenGames</b></i><br>
		<br>
		Moving forward and not understanding is why you don&apos;t get it.</div>
	<br>
	<br>
	Some people learn in different ways. Sometimes advancing beyond your means is helpful and you start to understand more as you go on. I can&apos;t tell you how long it was that I didn&apos;t even understand how my controls were working with eor and and&apos;ing and all that jazz. But I moved on to learn more stuff. I ended up catching on to that kind of thing. Like I said, some people learn in different ways. No need to talk to the dude like that.<br>
	&#xA0;</div>
<br>
Amen. I&apos;ve been working as a software engineer for 7 years, have a degree in computer science, have published an NES game and working on a second, and it is *still* a challenge to fully understand my own code, let alone code written by others. Turns out you don&apos;t need to be a whiz bang, you just have to work hard and love what you do.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__213">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Apr 22, 2014 at 2:58:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, I was that way in math, but there&apos;s a certain level of understanding you need. If you don&apos;t understand WHY a chip does what it does, you&apos;re missing something fundamental that you NEED to know.
<br>
<br>And MRN, I was just pointing out stuff I saw in his code, why bust my balls? Is it a douchy thing to help? Really?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__214">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 22, 2014 at 3:03:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	Is it a douchy thing to help? Really?</div>
<br>
The fact that you&apos;re helping and not just making fun of someone is a step in the right direction!<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__215">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Apr 22, 2014 at 3:04:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	Yeah, I was that way in math, but there&apos;s a certain level of understanding you need. If you don&apos;t understand WHY a chip does what it does, you&apos;re missing something fundamental that you NEED to know.<br>
	<br>
	And MRN, I was just pointing out stuff I saw in his code, why bust my balls? Is it a douchy thing to help? Really?</div>
<br>
You just need to learn to state things in a less flatly dismissive way is all. Nothing wrong with pointing out errors or suggesting an approach to a problem. You have to be careful---what you may perceive as really helpful could end up being the opposite. You might even damn someone to a lifetime devoted to revenge. I know because it happened to me <span class="sprites_emoticons absmiddle" id="emo_smile"></span> &#xA0;(I was damned to a lifetime devoted to revenge)<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__216">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Apr 22, 2014 at 3:06:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>GradualGames</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>3GenGames</b></i><br>
		<br>
		Yeah, I was that way in math, but there&apos;s a certain level of understanding you need. If you don&apos;t understand WHY a chip does what it does, you&apos;re missing something fundamental that you NEED to know.<br>
		<br>
		And MRN, I was just pointing out stuff I saw in his code, why bust my balls? Is it a douchy thing to help? Really?</div>
	<br>
	You just need to learn to state things in a less flatly dismissive way is all.</div>
<br>
Right on.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__217">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 22, 2014 at 3:07:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	Yeah, I was that way in math, but there&apos;s a certain level of understanding you need. If you don&apos;t understand WHY a chip does what it does, you&apos;re missing something fundamental that you NEED to know.<br>
	<br>
	And MRN, I was just pointing out stuff I saw in his code, why bust my balls? Is it a douchy thing to help? Really?</div>
Okay, we can do this.&#xA0; I&apos;ve not got in a good nerd fight for a while.&#xA0; No, helping is not douchy.&#xA0; However, a lot of the time the way you say things is really douchy.&#xA0; On top of that, your comments are difficult to understand and often not really correct, at least the way you phrase them.&#xA0; When I was first starting out people would tell me to STFU if I couldn&apos;t be clear and concise.&#xA0; So, I&apos;ll pass that wisdom along, STFU unless you can relay what you&apos;re trying to say without coming off as&#xA0;a dick or including any ambiguity.&#xA0;&#xA0;<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__218">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 22, 2014 at 3:08:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Those three posted while I was ranting.  Good job.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__219">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 22, 2014 at 4:02:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No worries, all. I&apos;m thick skinned. Sometimes a good slap to the back of the head with and calling me an idiot is just what i need. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
I understand what they set of code does, but I am getting lost breaking it down line by line. For example, WTF is this guy doing except sitting there spinning in circles:<br>
<br>
.loop<br>
&#xA0; LDA sleeping<br>
&#xA0; BNE .loop<br>
<br>
I just can&apos;t grasp the concept why it must be there. And there are other things as well, such as pointers and the random [] around some of them, what&apos;s up with the period in from of .loop, and many other things. But then I realize, it works, I can repllcate it in other parts of my code and it works, so why worry. I usually learn what they do when I break the code and I have to relearn it.<br>
<br>
Now, since this is a coding question thread, I have one for you all. I&apos;m playing with a new way to write text to the screen. I have 100% written this code by hand trying to understand pointers. It kind of works, however, when it comes time to write the word PAUSE on the screen or erase it, I get 0000000000000000000000000000000000000000000 all the way across the screen in the row where PAUSE should show up. I&apos;m trying to do it this way so I can reuse the loop for future text I want to display.<br>
<br>
***NOTE*** Ignore the line comments of the code. I robbed this code from other sections of my code and haven&apos;t cleaned it up yet.<br>
<br>
<strong>;Variables Section</strong><br>
TEXTLENGTH .rs 1<br>
TEXTLOWBYTE .rs 1<br>
TEXTHIGBYTE .rs 1<br>
Text_Pointer .rs 1<br>
<br>
<strong>;Code I added to my Write Pause Subroutine</strong><br>
&#xA0; LDA #$05<br>
&#xA0; STA TEXTLENGTH<br>
&#xA0;<br>
&#xA0; LDA #$0E<br>
&#xA0; STA TEXTLOWBYTE<br>
&#xA0;<br>
&#xA0; LDA #$21<br>
&#xA0; STA TEXTHIGBYTE<br>
&#xA0;<br>
&#xA0; LDA #$00<br>
&#xA0; TAX<br>
&#xA0;<br>
&#xA0; LDA Texts,x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Load the Main Program Pointer<br>
&#xA0; STA Text_Pointer<br>
&#xA0;<br>
&#xA0; JSR LoadText<br>
&#xA0;<br>
&#xA0;<br>
<br>
<strong>;Load Text Loop</strong><br>
<br>
LoadText:<br>
&#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; read PPU status to reset the high/low latch<br>
&#xA0; LDA #TEXTHIGBYTE&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; variable<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $2000 address<br>
&#xA0; LDA #TEXTLOWBYTE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; variable<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $2000 address<br>
&#xA0; LDX #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start out at 0<br>
<br>
LoadTextLoop:<br>
&#xA0; LDA Text_Pointer, x&#xA0;&#xA0;&#xA0;&#xA0; ; load data from address (background + the value in x)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;variable<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write to PPU<br>
&#xA0; INX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; X = X + 1<br>
&#xA0; CPX #TEXTLENGTH&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare X to hex $80, decimal 128 - copying 128 bytes&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; variable - Character Length<br>
&#xA0; BNE LoadTextLoop&#xA0; ; Branch to LoadBackgroundLoop if compare was Not Equal to zero<br>
&#xA0; RTS<br>
&#xA0;<br>
<br>
<strong>;Databases</strong><br>
&#xA0;<br>
Texts:<br>
&#xA0; .word PauseText,UnDrawPauseText<br>
&#xA0;<br>
PauseText:<br>
&#xA0;.db&#xA0; $19,$0A,$1E,$1C,$0E&#xA0;&#xA0;&#xA0;&#xA0; ;PAUSE<br>
UnDrawPauseText:<br>
&#xA0;.db&#xA0; $24,$24,$24,$24,$24&#xA0;&#xA0;&#xA0;&#xA0; ;Undraw Pause
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__220">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 22, 2014 at 4:06:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	Moving forward and not understanding is why you don&apos;t get it. Just gonna point out a logical error too: You don&apos;t disable the PPU then not enable it. You have to enable it (Or at MINIMUM NMI&apos;s) forit to be enabled. Your NMI might cause glitches if you don&apos;t remember, it can and does happen. Disabling, then having an NMI happen when &quot;off&quot; in the middle of doing stuff will lead to nasty bugs.</div>
<br>
I don&apos;t think it will be a problem because nothing really happens between that code and the NMI. I was enabling the PPU right after the LoadBackground and it was wigging out my screen. Since going this route, my screen issues have fixed. If it breaks future code, then I guess I will be forced to cross that bridge when it happens. The NMI is still and enigma to me, so any advice helps!<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__221">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Apr 22, 2014 at 4:22:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	No worries, all. I&apos;m thick skinned. Sometimes a good slap to the back of the head with and calling me an idiot is just what i need.<br>
	<br>
	I understand what they set of code does, but I am getting lost breaking it down line by line. For example, WTF is this guy doing except sitting there spinning in circles:<br>
	<br>
	.loop<br>
	&#xA0; LDA sleeping<br>
	&#xA0; BNE .loop<br>
	<br>
	I just can&apos;t grasp the concept why it must be there. And there are other things as well, such as pointers and the random [] around some of them, what&apos;s up with the period in from of .loop, and many other things. But then I realize, it works, I can repllcate it in other parts of my code and it works, so why worry. I usually learn what they do when I break the code and I have to relearn it.<br>
	<br>
	Now, since this is a coding question thread, I have one for you all. I&apos;m playing with a new way to write text to the screen. I have 100% written this code by hand trying to understand pointers. It kind of works, however, when it comes time to write the word PAUSE on the screen or erase it, I get 0000000000000000000000000000000000000000000 all the way across the screen in the row where PAUSE should show up. I&apos;m trying to do it this way so I can reuse the loop for future text I want to display.<br>
	<br>
	***NOTE*** Ignore the line comments of the code. I robbed this code from other sections of my code and haven&apos;t cleaned it up yet.<br>
	<br>
	<strong>;Variables Section</strong><br>
	TEXTLENGTH .rs 1<br>
	TEXTLOWBYTE .rs 1<br>
	TEXTHIGBYTE .rs 1<br>
	Text_Pointer .rs 1<br>
	<br>
	<strong>;Code I added to my Write Pause Subroutine</strong><br>
	&#xA0; LDA #$05<br>
	&#xA0; STA TEXTLENGTH<br>
	&#xA0;<br>
	&#xA0; LDA #$0E<br>
	&#xA0; STA TEXTLOWBYTE<br>
	&#xA0;<br>
	&#xA0; LDA #$21<br>
	&#xA0; STA TEXTHIGBYTE<br>
	&#xA0;<br>
	&#xA0; LDA #$00<br>
	&#xA0; TAX<br>
	&#xA0;<br>
	&#xA0; LDA Texts,x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Load the Main Program Pointer<br>
	&#xA0; STA Text_Pointer<br>
	&#xA0;<br>
	&#xA0; JSR LoadText<br>
	&#xA0;<br>
	&#xA0;<br>
	<br>
	<strong>;Load Text Loop</strong><br>
	<br>
	LoadText:<br>
	&#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; read PPU status to reset the high/low latch<br>
	&#xA0; LDA #TEXTHIGBYTE&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; variable<br>
	&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $2000 address<br>
	&#xA0; LDA #TEXTLOWBYTE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; variable<br>
	&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $2000 address<br>
	&#xA0; LDX #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start out at 0<br>
	<br>
	LoadTextLoop:<br>
	&#xA0; LDA Text_Pointer, x&#xA0;&#xA0;&#xA0;&#xA0; ; load data from address (background + the value in x)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;variable<br>
	&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write to PPU<br>
	&#xA0; INX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; X = X + 1<br>
	&#xA0; CPX #TEXTLENGTH&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare X to hex $80, decimal 128 - copying 128 bytes&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; variable - Character Length<br>
	&#xA0; BNE LoadTextLoop&#xA0; ; Branch to LoadBackgroundLoop if compare was Not Equal to zero<br>
	&#xA0; RTS<br>
	&#xA0;<br>
	<br>
	<strong>;Databases</strong><br>
	&#xA0;<br>
	Texts:<br>
	&#xA0; .word PauseText,UnDrawPauseText<br>
	&#xA0;<br>
	PauseText:<br>
	&#xA0;.db&#xA0; $19,$0A,$1E,$1C,$0E&#xA0;&#xA0;&#xA0;&#xA0; ;PAUSE<br>
	UnDrawPauseText:<br>
	&#xA0;.db&#xA0; $24,$24,$24,$24,$24&#xA0;&#xA0;&#xA0;&#xA0; ;Undraw Pause</div>
<br>
<br>
A pointer is going to be a 16-bit number. So where you have.... lda texts, x &#xA0;sta Text_Pointer... you are loading an 8-bit value. To be super generic about it, you could just do:<br>
<br>
lda &lt;#PauseText<br>
sta Text_Pointer+0<br>
lda &gt;#PauseText<br>
sta Text_Pointer+1<br>
<br>
Then you would have to use the Y register and not the X. Since the address is in zero page, using (), y will get you want you want:<br>
<br>
lda (Text_Pointer), y<br>
sta $2007<br>
iny<br>
;etc etc<br>
<br>
Be sure to change Text_Pointer to .res 2, because you want to reserve 2 bytes for it since it is going to be used as a 16-bit address.<br>
<br>
Dunno if there&apos;s errors in what I said, but that&apos;s what it looks like needs to be done to me. Hope it helps! Oh, and the syntax I use is for ca65, you may need to adjust for whatever assembler you use.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__222">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Apr 22, 2014 at 4:26:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>3GenGames</b></i><br>
		<br>
		Moving forward and not understanding is why you don&apos;t get it. Just gonna point out a logical error too: You don&apos;t disable the PPU then not enable it. You have to enable it (Or at MINIMUM NMI&apos;s) forit to be enabled. Your NMI might cause glitches if you don&apos;t remember, it can and does happen. Disabling, then having an NMI happen when &quot;off&quot; in the middle of doing stuff will lead to nasty bugs.</div>
	<br>
	I don&apos;t think it will be a problem because nothing really happens between that code and the NMI. I was enabling the PPU right after the LoadBackground and it was wigging out my screen. Since going this route, my screen issues have fixed. If it breaks future code, then I guess I will be forced to cross that bridge when it happens. The NMI is still and enigma to me, so any advice helps!</div>
<br>
More than likely, you touch $2006 in between screen enabling. Look at The Skinny:&#xA0;<a href="http://wiki.nesdev.com/w/index.php/The_skinny_on_NES_scrolling" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/The_skinny_on_NES_scrolling">http://wiki.nesdev.com/w/index.ph...</a><br>
<br>
Basically, $2000, $2005, and $2006 all share bits of a single 16-bit register, so the last thing you need to do in NMI is update $2005 (x2) and $2000. That will more than likely fix your problem.<br>
<br>
And lastly, NMI is easy:<br>
Do graphics updates, including map changes.<br>
Do sprite updates.<br>
(Optional) Do sound stuff.<br>
Write $2005 (x2) and $2000 to the correct values.<br>
Return to the main engine to run engine stuff.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__223">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 22, 2014 at 4:47:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Roth</b></i><br>
	<br>
	A pointer is going to be a 16-bit number. So where you have.... lda texts, x &#xA0;sta Text_Pointer... you are loading an 8-bit value. To be super generic about it, you could just do:<br>
	<br>
	lda &lt;#PauseText<br>
	sta Text_Pointer+0<br>
	lda &gt;#PauseText<br>
	sta Text_Pointer+1<br>
	<br>
	Then you would have to use the Y register and not the X. Since the address is in zero page, using (), y will get you want you want:<br>
	<br>
	lda (Text_Pointer), y<br>
	sta $2007<br>
	iny<br>
	;etc etc<br>
	<br>
	Be sure to change Text_Pointer to .res 2, because you want to reserve 2 bytes for it since it is going to be used as a 16-bit address.<br>
	<br>
	Dunno if there&apos;s errors in what I said, but that&apos;s what it looks like needs to be done to me. Hope it helps! Oh, and the syntax I use is for ca65, you may need to adjust for whatever assembler you use.</div>
<br>
Only difference for the NESASM compiler is he&apos;ll have to use [] instead of ().&#xA0; (Assuming he keeps the beginning of his old routine the same.)<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__224">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 22, 2014 at 4:53:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Roth</b></i><br>
		<br>
		A pointer is going to be a 16-bit number. So where you have.... lda texts, x &#xA0;sta Text_Pointer... you are loading an 8-bit value. To be super generic about it, you could just do:<br>
		<br>
		lda &lt;#PauseText<br>
		sta Text_Pointer+0<br>
		lda &gt;#PauseText<br>
		sta Text_Pointer+1<br>
		<br>
		Then you would have to use the Y register and not the X. Since the address is in zero page, using (), y will get you want you want:<br>
		<br>
		lda (Text_Pointer), y<br>
		sta $2007<br>
		iny<br>
		;etc etc<br>
		<br>
		Be sure to change Text_Pointer to .res 2, because you want to reserve 2 bytes for it since it is going to be used as a 16-bit address.<br>
		<br>
		Dunno if there&apos;s errors in what I said, but that&apos;s what it looks like needs to be done to me. Hope it helps! Oh, and the syntax I use is for ca65, you may need to adjust for whatever assembler you use.</div>
	<br>
	Only difference for the NESASM compiler is he&apos;ll have to use [] instead of ().&#xA0; (Assuming he keeps the beginning of his old routine the same.)<br>
	&#xA0;</div>
Sorry, using NESASM.<br>
<br>
It dislikes &lt; and &gt;. I&apos;m messing with the code trying different things.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__225">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Apr 22, 2014 at 4:56:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Roth</b></i><br>
		<br>
		A pointer is going to be a 16-bit number. So where you have.... lda texts, x &#xA0;sta Text_Pointer... you are loading an 8-bit value. To be super generic about it, you could just do:<br>
		<br>
		lda &lt;#PauseText<br>
		sta Text_Pointer+0<br>
		lda &gt;#PauseText<br>
		sta Text_Pointer+1<br>
		<br>
		Then you would have to use the Y register and not the X. Since the address is in zero page, using (), y will get you want you want:<br>
		<br>
		lda (Text_Pointer), y<br>
		sta $2007<br>
		iny<br>
		;etc etc<br>
		<br>
		Be sure to change Text_Pointer to .res 2, because you want to reserve 2 bytes for it since it is going to be used as a 16-bit address.<br>
		<br>
		Dunno if there&apos;s errors in what I said, but that&apos;s what it looks like needs to be done to me. Hope it helps! Oh, and the syntax I use is for ca65, you may need to adjust for whatever assembler you use.</div>
	<br>
	Only difference for the NESASM compiler is he&apos;ll have to use [] instead of ().&#xA0; (Assuming he keeps the beginning of his old routine the same.)<br>
	&#xA0;</div>
Sorry to be a picky little dweeb here, but NESASM is an assembler. Compilers are usually a lot more complex than assemblers.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__226">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 22, 2014 at 5:02:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>KHAN Games</b></i><br>
		<br>
		<div class="FTQUOTE">
			<i>Originally posted by: <b>Roth</b></i><br>
			<br>
			A pointer is going to be a 16-bit number. So where you have.... lda texts, x &#xA0;sta Text_Pointer... you are loading an 8-bit value. To be super generic about it, you could just do:<br>
			<br>
			lda &lt;#PauseText<br>
			sta Text_Pointer+0<br>
			lda &gt;#PauseText<br>
			sta Text_Pointer+1<br>
			<br>
			Then you would have to use the Y register and not the X. Since the address is in zero page, using (), y will get you want you want:<br>
			<br>
			lda (Text_Pointer), y<br>
			sta $2007<br>
			iny<br>
			;etc etc<br>
			<br>
			Be sure to change Text_Pointer to .res 2, because you want to reserve 2 bytes for it since it is going to be used as a 16-bit address.<br>
			<br>
			Dunno if there&apos;s errors in what I said, but that&apos;s what it looks like needs to be done to me. Hope it helps! Oh, and the syntax I use is for ca65, you may need to adjust for whatever assembler you use.</div>
		<br>
		Only difference for the NESASM compiler is he&apos;ll have to use [] instead of ().&#xA0; (Assuming he keeps the beginning of his old routine the same.)<br>
		&#xA0;</div>
	Sorry, using NESASM.<br>
	<br>
	It dislikes &lt; and &gt;. I&apos;m messing with the code trying different things.<br>
	<br>
	&#xA0;</div>
<br>
&#xA0; LDA #low(PauseText)<br>
&#xA0; STA TextPointer<br>
&#xA0; LDA #high(PauseText)<br>
&#xA0; STA TextPointer+1<br>
<br>
<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	Sorry to be a picky little dweeb here, but NESASM is an assembler. Compilers are usually a lot more complex than assemblers.</div>
<br>
Terminology has never been my strong suit .<span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__227">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 22, 2014 at 5:13:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Working, thanks everyone!<br>
<br>
Final code:<br>
<br>
TEXTLENGTH .rs 1<br>
TEXTLOWBYTE .rs 1<br>
TEXTHIGBYTE .rs 1<br>
TextPointer .rs 2<br>
<br>
&#xA0; LDA #$05<br>
&#xA0; STA TEXTLENGTH<br>
&#xA0;<br>
&#xA0; LDA #$0E<br>
&#xA0; STA TEXTLOWBYTE &#xA0;<br>
&#xA0; LDA #$21<br>
&#xA0; STA TEXTHIGBYTE<br>
&#xA0;<br>
&#xA0; LDA #low(PauseText)<br>
&#xA0; STA TextPointer<br>
&#xA0; LDA #high(PauseText)<br>
&#xA0; STA TextPointer+1<br>
&#xA0;<br>
&#xA0; JSR LoadText<br>
<br>
<br>
LoadText:<br>
&#xA0; &#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; read PPU status to reset the high/low latch<br>
&#xA0;&#xA0;&#xA0; LDA TEXTHIGBYTE&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; variable<br>
&#xA0;&#xA0;&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $2000 address<br>
&#xA0;&#xA0;&#xA0; LDA TEXTLOWBYTE&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; variable<br>
&#xA0;&#xA0;&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $2000 address<br>
&#xA0;&#xA0;&#xA0; LDX #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start out at 0<br>
<br>
LoadTextLoop:<br>
&#xA0; &#xA0; LDA [TextPointer], y&#xA0;&#xA0;&#xA0;&#xA0; ; load data from address (background + the value in x)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;variable<br>
&#xA0; &#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write to PPU<br>
&#xA0;&#xA0;&#xA0; INY&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; X = X + 1<br>
&#xA0;&#xA0;&#xA0; CPY TEXTLENGTH&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare X to hex $80, decimal 128 - copying 128 bytes&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; variable - Character Length<br>
&#xA0;&#xA0;&#xA0; BNE LoadTextLoop&#xA0; ; Branch to LoadBackgroundLoop if compare was Not Equal to zero<br>
&#xA0;&#xA0;&#xA0; RTS<br>
&#xA0;<br>
PauseText:<br>
&#xA0;&#xA0; .db&#xA0; $19,$0A,$1E,$1C,$0E&#xA0;&#xA0;&#xA0;&#xA0; ;PAUSE<br>
UnDrawPauseText:<br>
&#xA0;&#xA0; .db&#xA0; $24,$24,$24,$24,$24&#xA0;&#xA0;&#xA0;&#xA0; ;Undraw Pause<br>
<br>
<br>
<br>
<br>
<br>
Why doing I need:<br>
&#xA0; LDA #high(PauseText)<br>
&#xA0; STA TextPointer+1<br>
<br>
I never call for TextPointer+1 in the code. Is it because I somehow made something 16-bit?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__228">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Apr 22, 2014 at 5:18:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>KHAN Games</b></i><br>
		<br>
		<div class="FTQUOTE">
			<i>Originally posted by: <b>Roth</b></i><br>
			<br>
			A pointer is going to be a 16-bit number. So where you have.... lda texts, x &#xA0;sta Text_Pointer... you are loading an 8-bit value. To be super generic about it, you could just do:<br>
			<br>
			lda &lt;#PauseText<br>
			sta Text_Pointer+0<br>
			lda &gt;#PauseText<br>
			sta Text_Pointer+1<br>
			<br>
			Then you would have to use the Y register and not the X. Since the address is in zero page, using (), y will get you want you want:<br>
			<br>
			lda (Text_Pointer), y<br>
			sta $2007<br>
			iny<br>
			;etc etc<br>
			<br>
			Be sure to change Text_Pointer to .res 2, because you want to reserve 2 bytes for it since it is going to be used as a 16-bit address.<br>
			<br>
			Dunno if there&apos;s errors in what I said, but that&apos;s what it looks like needs to be done to me. Hope it helps! Oh, and the syntax I use is for ca65, you may need to adjust for whatever assembler you use.</div>
		<br>
		Only difference for the NESASM compiler is he&apos;ll have to use [] instead of ().&#xA0; (Assuming he keeps the beginning of his old routine the same.)<br>
		&#xA0;</div>
	Sorry, using NESASM.<br>
	<br>
	It dislikes &lt; and &gt;. I&apos;m messing with the code trying different things.<br>
	<br>
	&#xA0;</div>
Watch out dude. If you do this:<br>
STA #$00, X<br>
intending that to be a zero page, X instruction, it won&apos;t be. It will still assemble to an absolute, X instruction, wasting 1 byte and 1 cycle.<br>
In NESASM you would have to do it like STA &lt;#$00, X so sometimes &lt; is useful.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__229">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Apr 22, 2014 at 5:27:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You were trying to reach a 16-bit address with the table you had setup with .word. NES uses something called little endian (just Google that), and the +1 is the high byte of the address, whereas the +0 is the low byte. The only 8-bit addresses you&apos;ll be messing with are zeropage : ). But yeah, maybe just look up little endian 6502 or something. It should make sense. Ask questions if not!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__230">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 22, 2014 at 5:40:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Roth</b></i><br>
	<br>
	You were trying to reach a 16-bit address with the table you had setup with .word. NES uses something called little endian (just Google that), and the +1 is the high byte of the address, whereas the +0 is the low byte. The only 8-bit addresses you&apos;ll be messing with are zeropage : ). But yeah, maybe just look up little endian 6502 or something. It should make sense. Ask questions if not!</div>
Thanks. I know what little endian and big endian are. So, it is calling the address of PauseText in the register? If so, that was a huge light bulb!<br>
<br>
I always thought it was doing this (but I am guessing I was wrong):<br>
<br>
<strong>&#xA0; LDA #low(PauseText)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; = $19 (First number of .db&#xA0; $19,$0A,$1E,$1C,$0E)<br>
&#xA0; STA TextPointer<br>
&#xA0; LDA #high(PauseText)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; = $0E (First number of .db&#xA0; $19,$0A,$1E,$1C,$0E)&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0; STA TextPointer+1<br>
<br>
PauseText:<br>
&#xA0;&#xA0; .db&#xA0; $19,$0A,$1E,$1C,$0E&#xA0;&#xA0;&#xA0;&#xA0; ;PAUSE</strong><br>
<br>
If I am right, it is saying PauseText is stored at $WXYZ (just using placeholder numbers) and Low is YZ and High is WX?<br>
So, when you point to it using [TextPointer], it grabs it as $WXYZ.<br>
<br>
I hope I am right now, because I used to be so lost with this! Thanks ROTH!<br>
Sorry for all of the questions, this was good for me today...<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__231">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 22, 2014 at 6:14:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You are correct with the address assumption. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__232">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Apr 22, 2014 at 7:38:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Right on! Now, to show you why this is so helpful, I&apos;ll make a short bit o&apos; code for you to check out. If you already understand what I&apos;m about to post, then cool, maybe it will help someone else hehe Anywho, let&apos;s use palettes as an example. And let&apos;s say for every level in the game, you have a different full 32 byte palette that you want to use. The typical way for a small game is to just do something like this:<br>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	<code>ldx #$00</code></div>
<div>
	<code>:<span class="Apple-tab-span"> </span>lda palette_address, x</code></div>
<div>
	<code>sta $2007</code></div>
<div>
	<code>inx</code></div>
<div>
	<code>cpx #$20</code></div>
<div>
	<code>bne :-</code></div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	Well now (assuming this is while rendering is off), someone could do this:</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	<div>
		<code>ldx current_level</code></div>
	<div>
		<code>lda palette_table_lo, x</code></div>
	<div>
		<code>sta palette_addy+0</code></div>
	<div>
		<code>lda palette_table_hi, x</code></div>
	<div>
		<code>sta palette_addy+1</code></div>
	<div>
		<code>&#xA0;</code></div>
	<div>
		<code>lda #$3f</code></div>
	<div>
		<code>sta $2006</code></div>
	<div>
		<code>lda #$00</code></div>
	<div>
		<code>sta $2006</code></div>
	<div>
		<code>ldy #$00</code></div>
	<div>
		<code>:<span class="Apple-tab-span"> </span>lda (palette_addy), y</code></div>
	<div>
		<code>sta $2007</code></div>
	<div>
		<code>iny</code></div>
	<div>
		<code>cpy #$20</code></div>
	<div>
		<code>bne :-</code></div>
</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	And then in ROM, you have two tables set up, and the order in which your palettes go according to the game engine:</div>
<div>
	&#xA0;</div>
<div>
	&#xA0;</div>
<div>
	<code>palette_table_lo:</code></div>
<div>
	<code>.byte &lt;<palette_lvl1, div>palette_lvl1, &lt;palette_lvl2, &lt;palette_lvl3, &lt;palette_lvl4
	<div>
		palette_table_hi:</div>
	<div>
		.byte &gt;palette_lvl1, &gt;palette_lvl2, &gt;palette_lvl3, &gt;palette_lvl4</div>
	</palette_lvl1,></code>
	<div>
		&#xA0;</div>
	<div>
		&#xA0;</div>
	<div>
		And those two tables are pointing, with the low and the high addresses, to each 32 byte palette that you have stored:</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0;</div>
	<div>
		<code>palette_lvl1:</code></div>
	<div>
		<code>.byte $0f,$07,$04,$0f, $0f,$07,$19,$0f, $0f,$0c,$04,$0f, $0f,$00,$27,$16</code></div>
	<div>
		<code>.byte $0f,$0f,$0f,$0f, $0f,$0f,$0f,$0f, $0f,$0f,$0f,$0f, $0f,$0f,$0f,$0f</code></div>
	<div>
		<code>palette_lvl2:</code></div>
	<div>
		<code>.byte $0f,$00,$10,$30, $0f,$0f,$0f,$0f, $0f,$0f,$0f,$0f, $0f,$0f,$0f,$0f</code></div>
	<div>
		<code>.byte $0f,$00,$10,$30, $0f,$0f,$0f,$0f, $0f,$0f,$0f,$0f, $0f,$0f,$0f,$0f</code></div>
	<div>
		<code>palette_lvl3:</code></div>
	<div>
		<code>; etc</code></div>
	<div>
		<code>palette_lvl4:</code></div>
	<div>
		<code>; etc</code></div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0;</div>
	<div>
		So then, when a level is finished and you are ready to start loading the next level, you just increment the variable current_level. So the first time X would grab the low and high bytes of palette_lvl1, because the offset of current_level was at zero. &#xA0;Then when loading the next level, palette_lvl2, the low and high bytes of the address, will be loaded by X because current_level is used as the offset, and it is at 1 now. Etc etc.</div>
	<div>
		&#xA0;</div>
	<div>
		Hopefully that wasn&apos;t too much to digest, but I think learning this kind of concept early is REALLY helpful and will help set up programs with more ease than what some might think is possible when learning.</div>
</div>
<br>
EDIT: Put missing bytes from the palette_table_lo table. Seems like NA&apos;s rendering of the code tag isn&apos;t all that haha
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__233">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 22, 2014 at 9:45:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is great stuff. Even with the syntax I&apos;m not familiar with (since I code for NESASM), I was able to follow it. I was thinking last week that you should be able to load different palettes for different levels.
<br>
<br>I have been getting more used to seeing code written for the ca65 assembler because last week I download the !Clik! source code from your site to see how you handled moving from Title Screen to Game Play. Needless to say, I was pretty confused when I first saw it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__234">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Apr 23, 2014 at 2:07:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It&apos;s really personal preference, but I love asm6 - it&apos;s simple, and the syntax just makes sense to me:<br>
<a href="http://home.comcast.net/~olimar/NES/" target="_blank" original-href="http://home.comcast.net/~olimar/NES/">http://home.comcast.net/~olimar/NES/</a><br>
<br>
There are some templates over on NesDev that can get you started quickly:<br>
<a href="http://forums.nesdev.com/viewtopic.php?t=6160" target="_blank" original-href="http://forums.nesdev.com/viewtopic.php?t=6160">http://forums.nesdev.com/viewtopi...</a><br>
<br>
ca65 is the way to go for huge projects I imagine, but the learning curve/extra setup stuff just isn&apos;t worth it to me at the moment.<br>
<br>
Edit: Fixed broken asm6 link
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__235">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Apr 23, 2014 at 4:38:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here you have CA65 templates for NROM and SG/SNROM. <a href="http://forums.nesdev.com/viewtopic.php?f=22&amp;t=7991" target="_blank" original-href="http://forums.nesdev.com/viewtopic.php?f=22&amp;t=7991">http://forums.nesdev.com/viewtopi...</a><br>
I think one of the biggest hurdles when changing from NESASM, ASM6 or something similar to CA65 is the separate linker.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__236">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 24, 2014 at 2:27:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So, I need a way to check if I have exceed a limit.<br>
<br>
Is this how I do it?<br>
<br>
<br>
Subroutine:<br>
&#xA0;&#xA0; LDA Variable<br>
&#xA0;&#xA0; CMP #$50<br>
&#xA0;&#xA0; BMI SubroutineDone &#xA0;&#xA0;<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; CODE TO RUN<br>
<br>
SubroutineDone:<br>
&#xA0; RTS<br>
<br>
<br>
Basically, when Variable hits 50 or any number above 50, I want to run CODE TO RUN.<br>
<br>
The issue is, I am incrementing Variable with different number (1,2,3,4,5), so my program may not always hit 50.<br>
<br>
Thanks<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__237">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 24, 2014 at 2:35:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Nevermind, I figured it out finally. I was right.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__238">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 24, 2014 at 9:31:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					BMI and BPL deal with bit 7, or %10000000. 
<br>
<br>BCS and BCC deal with greater/less than. In that case, you&apos;d use bcc.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__239">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 25, 2014 at 12:35:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	BMI and BPL deal with bit 7, or %10000000.<br>
	<br>
	BCS and BCC deal with greater/less than. In that case, you&apos;d use bcc.</div>
Interesting, BMI working great for me in many locations.<br>
<br>
From what I read, the CMP will set the Negative flag (bit 7) if the compare is negative. In my case, I am enabling features in later levels. So, I compare the LevelVariable (set to Level 1) to #$04. The compare sets the negative flag because 1-4= -3. Once the Negative Flag clears in the compare (4-4=0 or 5-4=1), then the new feature is unlocked for the rest of the game.<br>
<br>
<strike>I will be posting my new ROM in a bit </strike>on the private thread. You can check it out there.<br>
<br>
EDIT: New ROM was posted last night.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__240">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 25, 2014 at 7:33:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I guess we are both correct. I was talking about LDA. I didn&apos;t know you could use those commands for compare!  Interesting. 
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__241">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 25, 2014 at 9:55:30 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So, I was doing some research of general 6502 programming and it looks like the accepted standard way for &apos;less than &amp; greater than\equal to&apos; is BCC and BCS. BMI and BPL can do the same thing in a compare situation, however, it may be slow. I think I am seeing this issue when writing text to the sceen using BMI. I am going to replace BMI with BCC and see if it improves it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__242">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 25, 2014 at 10:13:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So, it may have been a fluke, but bcc seems like a faster command than bmi how I was using it. From 6502.org, here is the bast ways to do all comparisons:<br>
<br>
If the Z flag is 0, then A &lt;&gt; NUM and BNE will branch<br>
If the Z flag is 1, then A = NUM and BEQ will branch<br>
If the C flag is 0, then A (unsigned) &lt; NUM (unsigned) and BCC will branch<br>
If the C flag is 1, then A (unsigned) &gt;= NUM (unsigned) and BCS will branch<br>
<br>
Link: <a href="http://www.6502.org/tutorials/compare_beyond.html#1.1" target="_blank" original-href="http://www.6502.org/tutorials/compare_beyond.html#1.1">http://www.6502.org/tutorials/com...</a><br>
<br>
So basically:<br>
BNE to check for not equal &lt;&gt;<br>
BEQ to check for equal =<br>
BCC to check for less than &lt;<br>
BCS to check for greater than equalto &gt;=
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__243">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Apr 25, 2014 at 3:20:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					They operate the same speed, your code is 99% chance bugged. And using 2 branches is only acceptible when you HAVE to do the math a vertain way, because you can subtract 1 value from one of the numbers and do the compare and always get a 1-branch determination for what you need.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__244">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 26, 2014 at 8:35:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Is there a way to program a game to auto detect if you&apos;re using an emulator or hardware?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__245">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Apr 26, 2014 at 8:38:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	Is there a way to program a game to auto detect if you&apos;re using an emulator or hardware?</div>
<br>
<br>
Get ahold of tepples. I believe he came up with code that does that.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__246">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Apr 26, 2014 at 11:02:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It is possible to detect older or current emulators, but just as you use such detection, emulators will eventually consider your trick and it&apos;ll stop to work. Not to mention that all your tricky detection code could be disabled by a romhacker in minutes.<br>
<br>
One of ways is to check initial RAM/VRAM contents. Emulators clear it out on start up, but it is never clear on actual hardware, and has semi-random data pattern instead.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__247">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 26, 2014 at 11:17:43 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I more just want to set it to change control styles on emulator vs hardware. 
<br>
<br>Not really for hackers. Last time I had a choice on the start screen. It would just be cool to be automatic.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__248">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Apr 26, 2014 at 11:40:32 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					In this case, there is no reliable way to detect emulators in general. The whole idea of emulators is to recreate a system as closely as possible, so in an ideal emulator there are no chances of detection at all, it should be 100% identical to the original. As emulators aren&apos;t 100% exact just yet (but close enough), you can detect flaws in certain emulators, or tricky things that aren&apos;t emulated properly so far. There are chances of false detections as well.
<br>
<br>One way to provide reliable detection is to introduce virtual register in every emulator, which is not exist on the original hardware, and reading it will always provide clear answer is it emulator or not.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__249">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Apr 26, 2014 at 1:15:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Unfortunately ways to tell most emulators need eyeballs, like many get the grayscale flag wrong.  At least most people use old emulators so any tricks you do figure out won&apos;t be fixed!  Theres a few emu specific bugs like flags after BRK but it would take a lot of those checks to cover all the popular ones.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__250">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				Apr 26, 2014 at 10:44:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	I more just want to set it to change control styles on emulator vs hardware.<br>
	<br>
	Not really for hackers. Last time I had a choice on the start screen. It would just be cool to be automatic.</div>
<br>
The problem with this is that there is no guarantee that the person using an emulator isn&apos;t using a joypad.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__251">
                                                        <div class="mdl-card__title"><strong>Saintkat</strong> posted on 
		
			
				
				May 3, 2014 at 7:17:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve been working on this for the last five hours and am not getting anywhere, blah.  I&apos;m trying to change the attribute of a background tile to use a different color palette.  Maybe I&apos;m failing at googling the correct terms but I can&apos;t seem to figure out an easy way (or even a hard way) to find the code in the ROM hex editor to change them.  I can find the code in the PPU memory no problem.  This has all been done in FCEUX 2.2.2.  Maybe there is a more straight forward program to handle this task?
<br>
<br>Some of my resources (for my later reference):
<br>
<br><a href="http://archive.rpgclassics.com/subsites/twit/docs/text/" target="_blank" original-href="http://archive.rpgclassics.com/subsites/twit/docs/text/">http://archive.rpgclassics.com/su...</a>
<br><a href="http://badderhacksnet.ipage.com/badderhacks/index.php?option=com_content&amp;view=article&amp;id=270:the-nes-picture-processing-unit-ppu&amp;catid=14" target="_blank" original-href="http://badderhacksnet.ipage.com/badderhacks/index.php?option=com_content&amp;view=article&amp;id=270:the-nes-picture-processing-unit-ppu&amp;catid=14">http://badderhacksnet.ipage.com/b...</a><span class="sprites_emoticons absmiddle" id="emo_happy"></span>r-floppy&amp;Itemid=7
<br><a href="scraper/files/NESprgmn.txt" target="_blank" original-href="http://nesdev.com/NESprgmn.txt">http://nesdev.com/NESprgmn.txt...</a>
<br><a href="downloads/missing/ppu.txt" target="_blank" original-href="http://gilgalad.arc-nova.org/docs/ppu.txt">http://gilgalad.arc-nova.org/docs...</a>
<br><a href="http://www.thetechnickel.com/video-games/nes-development-intro" target="_blank" original-href="http://www.thetechnickel.com/video-games/nes-development-intro">http://www.thetechnickel.com/vide...</a>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__252">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				May 4, 2014 at 10:32:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, this seems to be more of a hacking question. I&apos;m not sure what game you are hacking, but if you know what is happening in the PPU at the time, have you tried putting a conditional in the debugger that matches where you want it to change? For instance if it is address $23c9 that you want to change, and you know what it is already, put the conditional of $23c9 == #170. The 170 would be whatever you know it is at this point. It&apos;ll probably snap somewhere in NMI if it is loading on the fly, and that will show you where it is loading from, which will probably be somewhere in RAM. After you find out where it is loading from, then you can change the conditional to match the address in RAM, which will probably allow you to find where it is loading from.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__253">
                                                        <div class="mdl-card__title"><strong>Saintkat</strong> posted on 
		
			
				
				May 4, 2014 at 1:01:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve tried that but perhaps I am going around it the wrong way?  Or maybe I just don&apos;t know how to effectively read the debugger.
<br>
<br>If I put in the conditional for address $23CC, A == #00, it&apos;ll snap and I&apos;ll have this read out:
<br>
<br> 00:F1BB:8D 00 20  STA $2000 = #$10
<br> 00:F1BE:A9 20     LDA #$20
<br> 00:F1C0:8D 06 20  STA $2006 = #$CC
<br> 00:F1C3:A9 00     LDA #$00
<br> 00:F1C5:8D 06 20  STA $2006 = #$CC
<br> 00:F1C8:A2 04     LDX #$04
<br> 00:F1CA:A0 00     LDY #$00
<br> 00:F1CC:A9 24     LDA #$24
<br> 00:F1CE:8D 07 20  STA $2007 = #$00
<br> 00:F1D1:88        DEY
<br> 00:F1D2<span class="sprites_emoticons absmiddle" id="emo_happy"></span>0 FA     BNE $F1CE
<br> 00:F1D4:CA        DEX
<br> 00:F1D5<span class="sprites_emoticons absmiddle" id="emo_happy"></span>0 F7     BNE $F1CE
<br> 00:F1D7:A9 23     LDA #$23
<br> 00:F1D9:8D 06 20  STA $2006 = #$CC
<br> 00:F1DC:A9 C0     LDA #$C0
<br> 00:F1DE:8D 06 20  STA $2006 = #$CC
<br> 00:F1E1:A0 40     LDY #$40
<br> 00:F1E3:A9 00     LDA #$00
<br>&gt;00:F1E5:8D 07 20  STA $2007 = #$00
<br> 00:F1E8:88        DEY
<br> 00:F1E9<span class="sprites_emoticons absmiddle" id="emo_happy"></span>0 FA     BNE $F1E5
<br> 00:F1EB:60        RTS -----------------------------------------
<br> 00:F1EC:8D 06 20  STA $2006 = #$CC
<br> 00:F1EF:C8        INY
<br> 00:F1F0:B1 00     LDA ($00),Y @ $0336 = #$B3
<br> 00:F1F2:8D 06 20  STA $2006 = #$CC
<br> 00:F1F5:C8        INY
<br> 00:F1F6:B1 00     LDA ($00),Y @ $0336 = #$B3
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__254">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				May 4, 2014 at 1:19:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That&apos;s happening while NMIs are turned off and filling an entire nametable. One problem I see with what you want to do is that it seems to be using the first palette for all of the background, since it is LDA #$00 STA $2007 and does it for all 64 bytes of the attribute table (the LDY #$40/ DEY / etc). You&apos;d need to find a way (and find room) to make some sort of subroutine that writes what you want in a specific place before the screen is turned back on.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__255">
                                                        <div class="mdl-card__title"><strong>Saintkat</strong> posted on 
		
			
				
				May 4, 2014 at 3:26:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok, that kinda makes sense.  The entire background is using the first palette.  I guess I am stuck with that for now at my skill lvl!  Thanks for the feedback!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__256">
                                                        <div class="mdl-card__title"><strong>Saintkat</strong> posted on 
		
			
				
				May 8, 2014 at 2:24:39 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Alright, another hard to ask question (the hard part being the wording, no clue if I am using byte correctly for example).
<br>
<br>After the color palettes for a level I am hacking, I get a bunch of attributes for the background.  In the hex editor, I&apos;ll see:
<br>
<br>... 23 E1 03 88 00 88 23 E9 ...
<br>
<br>Now $23E1 corresponds to one the 32x32 attribute areas on the background, 23E9 will be another one.
<br>
<br>The bytes 88 and 00 on the bit level would represent the color palettes used for each quarter of the 32x32 attribute area.
<br>
<br>So the only byte here I don&apos;t know what it does is the 03 byte.   The first 88 contains the attributes for the $23E1 attribute area and the 88 and 00 are for other attribute areas, so I assume that the 03 byte defines which attributes areas the 00 and second 88 palette attributes belong to (relative to 23E1)?
<br>
<br>Anyone able to point me in the direction of what makes up the byte immediately following the attribute area (the 03 in this case)?
<br>
<br>I obtained all my knowledge about all this from this article (for my reference really): <a href="http://badderhacksnet.ipage.com/badderhacks/index.php?option=com_content&amp;view=article&amp;id=270:the-nes-picture-processing-unit-ppu&amp;catid=14" target="_blank" original-href="http://badderhacksnet.ipage.com/badderhacks/index.php?option=com_content&amp;view=article&amp;id=270:the-nes-picture-processing-unit-ppu&amp;catid=14">http://badderhacksnet.ipage.com/b...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__257">
                                                        <div class="mdl-card__title"><strong>Dimeback</strong> posted on 
		
			
				
				May 9, 2014 at 10:24:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m having a strange issue regarding controller input. Recently, I tried redoing my controller reading code to match the one in the Nerdy Nights subroutines tutorial. For the most part, it works as it should, but every time I press left the game crashes. Nothing I change in my code makes a difference and I have no clue what could be causing it, as it for some reason only does this when I press left. Any ideas?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__258">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 9, 2014 at 10:29:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Your engine is doing it, not the subroutine, I&apos;d hope. Post the controller code.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__259">
                                                        <div class="mdl-card__title"><strong>Dimeback</strong> posted on 
		
			
				
				May 9, 2014 at 10:34:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					EDIT: &#xA0;I have actually fixed the problem.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__260">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 9, 2014 at 10:38:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, what does LDA buttons1 do, when you LDA right after it?
<br>
<br>And the problem doesn&apos;t seem to be that code otherwise, I&apos;d check to see what else reads from that memory location, and see the difference between builds.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__261">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 9, 2014 at 10:50:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Dimeback</b></i><br>
	<br>
	EDIT: &#xA0;I have actually fixed my problem.</div>
<br>
<br>
<br>
LOL, right before I replied.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__262">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				May 17, 2014 at 2:29:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have a little problem...<br>
I wanted to save some space on my title screen so I came up with this little routine. However, all it does is that it makes my background flash. Does anyone know what the problem is?<br>
<div text-align:>
	<br>
	<div>
		<span font-family:courier>LoadTitle:</span></div>
	<div>
		<span font-family:courier>&#xA0; LDA $2002</span></div>
	<div>
		<span font-family:courier>&#xA0; LDA #$20</span></div>
	<div>
		<span font-family:courier>&#xA0; STA $2006</span></div>
	<div>
		<span font-family:courier>&#xA0; LDA #$00</span></div>
	<div>
		<span font-family:courier>&#xA0; STA $2006<span class="Apple-tab-span"> </span>;Begins at $2000</span></div>
	<div>
		<span font-family:courier>&#xA0; LDX #$00</span></div>
	<div>
		<span font-family:courier>LoadTitleLoop:</span></div>
	<div>
		<span font-family:courier>&#xA0; LDA title,x &#xA0; &#xA0; &#xA0;<span class="Apple-tab-span"> </span>; load data from address (background + the value in x)</span></div>
	<div>
		<span font-family:courier>&#xA0; CMP #$FF<span class="Apple-tab-span"> </span>;Compares value to $FF, and if it is equal to FF, skip next branch</span></div>
	<div>
		<span font-family:courier>&#xA0; BNE Write_Title_Tile</span></div>
	<div>
		<span font-family:courier>&#xA0; INX</span></div>
	<div>
		<span font-family:courier>&#xA0; LDA title,x<span class="Apple-tab-span"> </span>;Takes value next to $FF and rams it in the variable title_black (a racist variable)</span></div>
	<div>
		<span font-family:courier>&#xA0; STA title_black</span></div>
	<div>
		<span font-family:courier>&#xA0; LDY #$00<span class="Apple-tab-span"> </span>;Prepares Y register</span></div>
	<div>
		<span font-family:courier>Black_Loop:</span></div>
	<div>
		<span font-family:courier>&#xA0; LDA #$00</span></div>
	<div>
		<span font-family:courier>&#xA0; STA $2007<span class="Apple-tab-span"> </span>;Puts a lot of black tiles on the screen (CHR+pallettes make them black)</span></div>
	<div>
		<span font-family:courier>&#xA0; INY<span class="Apple-tab-span"> </span>;Increments Y and then compares it to the title_black variable</span></div>
	<div>
		<span font-family:courier>&#xA0; CPY title_black</span></div>
	<div>
		<span font-family:courier>&#xA0; BNE Black_Loop<span class="Apple-tab-span"> </span>;If it&apos;s not equal, go back to Black_Loop</span></div>
	<div>
		<span font-family:courier>&#xA0; INX<span class="Apple-tab-span"> </span>;Increments X for it to be ready for the next tile, and goes back to LoadTitleLoop</span></div>
	<div>
		<span font-family:courier>&#xA0; JMP LoadTitleLoop</span></div>
	<div>
		<span font-family:courier>Write_Title_Tile:</span></div>
	<div>
		<span font-family:courier>&#xA0; STA $2007 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; write to PPU</span></div>
	<div>
		<span font-family:courier>&#xA0; INX &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; X = X + 1</span></div>
	<div>
		<span font-family:courier>&#xA0; CPX #$FA &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;; Compare X to hex $FA</span></div>
	<div>
		<span font-family:courier>&#xA0; BNE LoadTitleLoop<span class="Apple-tab-span"> </span>; Go back to LoadTitleLoop if it&apos;s not equal</span><br>
		<br>
		&#xA0;</div>
	<div>
		<span font-family:courier>title:</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $FF,$42,$1D,$0D,$19,$1C,$0F,$00,$00,$30,$31,$32,$33,$34,$35,$36</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $37,$FF,$03,$38,$39,$3A,$3B,$00,$12,$13,$01,$00,$40,$41,$42,$43</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $44,$45,$46,$47,$0B,$18,$0E,$48,$49,$4A,$4B,$FF,$31,$1A,$00,$1C</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $00,$0F,$00,$1D,$00,$0F,$00,$18,$00,$1E,$FF,$29</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $00,$1D,$3D,$4D,$3F,$3E,$3F,$4D,$3C,$3E,$3F,$4C,$4D,$3C,$00,$3E &#xA0;;; &#xA0;SFS Inscription! WEEEEEE</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $3F,$3D,$3D,$3D,$4D,$3F,$4C,$4D,$4C,$4D,$3C,$4D,$3C,$4D,$3F,$00 &#xA0;;; &#xA0;</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $00,$1F,$3D,$3D,$3D,$3D,$3C,$3D,$00,$3D,$3C,$00,$3D,$00,$00,$3D &#xA0;;; &#xA0;</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $3C,$3D,$3D,$3D,$3D,$3D,$00,$3D,$00,$3D,$00,$3D,$00,$3D,$3D,$00 &#xA0;;; &#xA0;</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $00,$1A,$3D,$3D,$3D,$4E,$3F,$4D,$3C,$3D,$00,$00,$3D,$00,$00,$4E &#xA0;;; &#xA0;</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $3F,$3D,$3D,$3D,$4D,$3D,$00,$3D,$00,$3D,$00,$4D,$3C,$4D,$4F,$00 &#xA0;;; &#xA0;</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $00,$0F,$3D,$3D,$3D,$3D,$3D,$3D,$00,$3D,$3D,$00,$3D,$00,$00,$3D &#xA0;;; &#xA0;</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $3D,$3D,$3D,$3D,$3D,$3D,$00,$3D,$00,$3D,$00,$3D,$00,$4D,$3F,$00 &#xA0;;; &#xA0;</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $00,$1C,$3D,$3D,$3D,$4E,$4F,$4C,$3C,$4E,$4F,$00,$3C,$00,$00,$4E &#xA0;;; &#xA0;</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $4F,$4E,$4C,$4F,$3C,$3C,$00,$3C,$00,$3C,$00,$4C,$3C,$3C,$3C,$FF &#xA0;;; &#xA0;Ends here <span class="sprites_emoticons absmiddle" id="emo_happy"></span></span></div>
	<div>
		<span font-family:courier>&#xA0; .db $4A,$02,$00,$1A,$16,$0B,$23,$0F,$1C,$00,$11,$0B,$17,$0F,$FF,$33</span></div>
	<div>
		<span font-family:courier>&#xA0; .db $03,$00,$1A,$16,$0B,$23,$0F,$1C,$00,$11,$0B,$17,$0F,$FF,$33</span></div>
</div>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__263">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 17, 2014 at 3:26:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That&apos;s a confusing ass loop.&#xA0; I gave up. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__264">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				May 17, 2014 at 3:52:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you can&apos;t solve it, I guess I&apos;ll have to come back to my old loop then <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__265">
                                                        <div class="mdl-card__title"><strong>Famicuber</strong> posted on 
		
			
				
				May 18, 2014 at 1:15:43 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is probably a Obscure Question and pretty sure it&apos;s been answered in Nerdy Nights but,<br>
I wan&apos;t to change the controls from A and B to the Left and Right on the D-Pad. But i have completly no clue how and Nerdy Nights currently didn&apos;t help. I was wondering how to do it but (obviously) it&apos;s difficult to make it possible.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__266">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 18, 2014 at 1:21:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You need to take the button they check for on that part of the engine and change it. Start by working back from controller readying with $4016 and $4017, and see where they store the variables. Then find the one they use in the engine, and just fiddle with them and see which action each check handles. Then, change the button they check for from the L/R buttons to A/B. Anything more than that needed help/explaination, might as well be asking us to do it for you honestly. Not that there is anything wrong, just don&apos;t expect results tbh.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__267">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 18, 2014 at 11:15:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Famicuber Inc.</b></i><br>
	<br>
	This is probably a Obscure Question and pretty sure it&apos;s been answered in Nerdy Nights but,<br>
	I wan&apos;t to change the controls from A and B to the Left and Right on the D-Pad. But i have completly no clue how and Nerdy Nights currently didn&apos;t help. I was wondering how to do it but (obviously) it&apos;s difficult to make it possible.</div>
<br>
What part of Nerdy Nights are you at?&#xA0; If you get to one of the later lessons, it starts using different controller code.<br>
<br>
Can you post what controller code you&apos;re currently using?<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__268">
                                                        <div class="mdl-card__title"><strong>Famicuber</strong> posted on 
		
			
				
				May 18, 2014 at 12:01:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Famicuber Inc.</b></i><br>
		<br>
		This is probably a Obscure Question and pretty sure it&apos;s been answered in Nerdy Nights but,<br>
		I wan&apos;t to change the controls from A and B to the Left and Right on the D-Pad. But i have completly no clue how and Nerdy Nights currently didn&apos;t help. I was wondering how to do it but (obviously) it&apos;s difficult to make it possible.</div>
	<br>
	What part of Nerdy Nights are you at?&#xA0; If you get to one of the later lessons, it starts using different controller code.<br>
	<br>
	Can you post what controller code you&apos;re currently using?<br>
	&#xA0;</div>
<br>
It doesn&apos;t really matter anymore now, I&apos;ve figure it out. I&apos;m sure i&apos;ll ask more questions here in the future.&#xA0;<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__269">
                                                        <div class="mdl-card__title"><strong>HerpDerpDerp</strong> posted on 
		
			
				
				May 19, 2014 at 1:07:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m on Nerdy Nights week 2 and I want to know what&apos;s meant by 8 sprites per scanline. What exactly are sprites? Are they tiles or are they groups of tiles?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__270">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				May 19, 2014 at 2:56:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>HerpDerpDerp</b></i><br>
	<br>
	I&apos;m on Nerdy Nights week 2 and I want to know what&apos;s meant by 8 sprites per scanline. What exactly are sprites? Are they tiles or are they groups of tiles?</div>
A scanline is a single horizontal row of pixels.&#xA0; Sprites are objects that are independent from the background.&#xA0; When you think of sprites, think of moving bullets or walking enemies.&#xA0; Each sprite can be either 8x8 or 8x16 pixels.&#xA0; For general size reference, in Super Mario Bros, the &quot;?&quot; block is 16x16 pixels.<br>
<br>
So, the 8 sprites per scanline limit means that if you place 9 sprites overlapping the same scanline, the 9th will not be visible.&#xA0; Certain games use tricks to cycle sprites causing flickering when there are more than 8 sprites on a scanline. This way you will still be able to see the object without it completely disappearing.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__271">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 19, 2014 at 10:14:36 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Typically it&apos;s just a single &quot;tile,&quot; as most games don&apos;t use the 8x16 sprites.
<br>
<br>Also, can we get this thing re-stickied?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__272">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				May 19, 2014 at 11:25:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Still, many games use 8x16 sprites. Battle City, Super Mario Bros. 2 and 3, Contra, and so on.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__273">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 19, 2014 at 11:30:03 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	I have a little problem...<br>
	I wanted to save some space on my title screen so I came up with this little routine. However, all it does is that it makes my background flash. Does anyone know what the problem is?<br>
	<div text-align:>
		<br>
		<div>
			<span font-family:courier>LoadTitle:</span></div>
		<div>
			<span font-family:courier>&#xA0; LDA $2002</span></div>
		<div>
			<span font-family:courier>&#xA0; LDA #$20</span></div>
		<div>
			<span font-family:courier>&#xA0; STA $2006</span></div>
		<div>
			<span font-family:courier>&#xA0; LDA #$00</span></div>
		<div>
			<span font-family:courier>&#xA0; STA $2006<span class="Apple-tab-span"> </span>;Begins at $2000</span></div>
		<div>
			<span font-family:courier>&#xA0; LDX #$00</span></div>
		<div>
			<span font-family:courier>LoadTitleLoop:</span></div>
		<div>
			<span font-family:courier>&#xA0; LDA title,x &#xA0; &#xA0; &#xA0;<span class="Apple-tab-span"> </span>; load data from address (background + the value in x)</span></div>
		<div>
			<span font-family:courier>&#xA0; CMP #$FF<span class="Apple-tab-span"> </span>;Compares value to $FF, and if it is equal to FF, skip next branch</span></div>
		<div>
			<span font-family:courier>&#xA0; BNE Write_Title_Tile</span></div>
		<div>
			<span font-family:courier>&#xA0; INX</span></div>
		<div>
			<span font-family:courier>&#xA0; LDA title,x<span class="Apple-tab-span"> </span>;Takes value next to $FF and rams it in the variable title_black (a racist variable)</span></div>
		<div>
			<span font-family:courier>&#xA0; STA title_black</span></div>
		<div>
			<span font-family:courier>&#xA0; LDY #$00<span class="Apple-tab-span"> </span>;Prepares Y register</span></div>
		<div>
			<span font-family:courier>Black_Loop:</span></div>
		<div>
			<span font-family:courier>&#xA0; LDA #$00</span></div>
		<div>
			<span font-family:courier>&#xA0; STA $2007<span class="Apple-tab-span"> </span>;Puts a lot of black tiles on the screen (CHR+pallettes make them black)</span></div>
		<div>
			<span font-family:courier>&#xA0; INY<span class="Apple-tab-span"> </span>;Increments Y and then compares it to the title_black variable</span></div>
		<div>
			<span font-family:courier>&#xA0; CPY title_black</span></div>
		<div>
			<span font-family:courier>&#xA0; BNE Black_Loop<span class="Apple-tab-span"> </span>;If it&apos;s not equal, go back to Black_Loop</span></div>
		<div>
			<span font-family:courier>&#xA0; INX<span class="Apple-tab-span"> </span>;Increments X for it to be ready for the next tile, and goes back to LoadTitleLoop</span></div>
		<div>
			<span font-family:courier>&#xA0; JMP LoadTitleLoop</span></div>
		<div>
			<span font-family:courier>Write_Title_Tile:</span></div>
		<div>
			<span font-family:courier>&#xA0; STA $2007 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; write to PPU</span></div>
		<div>
			<span font-family:courier>&#xA0; INX &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; X = X + 1</span></div>
		<div>
			<span font-family:courier>&#xA0; CPX #$FA &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;; Compare X to hex $FA</span></div>
		<div>
			<span font-family:courier>&#xA0; BNE LoadTitleLoop<span class="Apple-tab-span"> </span>; Go back to LoadTitleLoop if it&apos;s not equal</span><br>
			<br>
			&#xA0;</div>
		<div>
			<span font-family:courier>title:</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $FF,$42,$1D,$0D,$19,$1C,$0F,$00,$00,$30,$31,$32,$33,$34,$35,$36</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $37,$FF,$03,$38,$39,$3A,$3B,$00,$12,$13,$01,$00,$40,$41,$42,$43</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $44,$45,$46,$47,$0B,$18,$0E,$48,$49,$4A,$4B,$FF,$31,$1A,$00,$1C</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $00,$0F,$00,$1D,$00,$0F,$00,$18,$00,$1E,$FF,$29</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $00,$1D,$3D,$4D,$3F,$3E,$3F,$4D,$3C,$3E,$3F,$4C,$4D,$3C,$00,$3E &#xA0;;; &#xA0;SFS Inscription! WEEEEEE</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $3F,$3D,$3D,$3D,$4D,$3F,$4C,$4D,$4C,$4D,$3C,$4D,$3C,$4D,$3F,$00 &#xA0;;; &#xA0;</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $00,$1F,$3D,$3D,$3D,$3D,$3C,$3D,$00,$3D,$3C,$00,$3D,$00,$00,$3D &#xA0;;; &#xA0;</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $3C,$3D,$3D,$3D,$3D,$3D,$00,$3D,$00,$3D,$00,$3D,$00,$3D,$3D,$00 &#xA0;;; &#xA0;</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $00,$1A,$3D,$3D,$3D,$4E,$3F,$4D,$3C,$3D,$00,$00,$3D,$00,$00,$4E &#xA0;;; &#xA0;</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $3F,$3D,$3D,$3D,$4D,$3D,$00,$3D,$00,$3D,$00,$4D,$3C,$4D,$4F,$00 &#xA0;;; &#xA0;</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $00,$0F,$3D,$3D,$3D,$3D,$3D,$3D,$00,$3D,$3D,$00,$3D,$00,$00,$3D &#xA0;;; &#xA0;</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $3D,$3D,$3D,$3D,$3D,$3D,$00,$3D,$00,$3D,$00,$3D,$00,$4D,$3F,$00 &#xA0;;; &#xA0;</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $00,$1C,$3D,$3D,$3D,$4E,$4F,$4C,$3C,$4E,$4F,$00,$3C,$00,$00,$4E &#xA0;;; &#xA0;</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $4F,$4E,$4C,$4F,$3C,$3C,$00,$3C,$00,$3C,$00,$4C,$3C,$3C,$3C,$FF &#xA0;;; &#xA0;Ends here </span></div>
		<div>
			<span font-family:courier>&#xA0; .db $4A,$02,$00,$1A,$16,$0B,$23,$0F,$1C,$00,$11,$0B,$17,$0F,$FF,$33</span></div>
		<div>
			<span font-family:courier>&#xA0; .db $03,$00,$1A,$16,$0B,$23,$0F,$1C,$00,$11,$0B,$17,$0F,$FF,$33</span><br>
			&#xA0;</div>
	</div>
</div>
I see what you are doing. You are using $FF as a flag in the table to jump to the &quot;Black_Loop&quot; loop. The number after $FF in the table is the number of times that &quot;Black_Loop&quot; is supposed to write tile $00. So in the title table, $FF will tell the loop to start and it will run $42 times. X Increases to 2 and now the &quot;Write_Title_Tile&quot; loop is enabled which writes tiles:<br>
$1D,$0D,$19,$1C,$0F,$00,$00,$30,$31,$32,$33,$34,$35,$36<br>
&#xA0; .db $37<br>
to the background. Then $FF hits again, &quot;Black_Loop&quot; is enabled, and tile $00 is written $03 times. This continues for the rest of the table.<br>
<br>
The only thing I can see is that you are ending the table with $FF,$33 which is in the &quot;Black_Loop&quot;. However, your code exits the loop in the &quot;Write_Title_Tile&quot; loop.<br>
<br>
Write_Title_Tile:<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write to PPU<br>
&#xA0; INX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; X = X + 1<br>
&#xA0; CPX #$FA&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare X to hex $FA <strong>&lt;--Exit Loop when X equals #$FA</strong><br>
&#xA0; BNE LoadTitleLoop ; Go back to LoadTitleLoop if it&apos;s not equal<br>
<br>
Since you start the Write_Title_Tile loop with writing to the PPU, this could wreck the entire loop if there is nothing in the table for it to write after $FF,$33.<br>
<br>
Hope that makes sense.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__274">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 19, 2014 at 11:57:46 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Also, I don&apos;t know if X is equal to $FA during the Write_Title_Tile. I figured up that you have $FB tiles, so that means that $FF in the Title table would be X=$FA. Although, my math could be wrong.<br>
<br>
I honestly don&apos;t think you are exiting your loop.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__275">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 19, 2014 at 1:15:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	Typically it&apos;s just a single &quot;tile,&quot; as most games don&apos;t use the 8x16 sprites.<br>
	<br>
	Also, can we get this thing re-stickied?</div>
Check.<br>
<br>
<br>
<br type="_moz">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__276">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				May 20, 2014 at 4:17:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Vectrex280996</b></i><br>
		<br>
		I have a little problem...<br>
		I wanted to save some space on my title screen so I came up with this little routine. However, all it does is that it makes my background flash. Does anyone know what the problem is?<br>
		<div text-align:>
			<br>
			<div>
				<span font-family:courier>LoadTitle:</span></div>
			<div>
				<span font-family:courier>&#xA0; LDA $2002</span></div>
			<div>
				<span font-family:courier>&#xA0; LDA #$20</span></div>
			<div>
				<span font-family:courier>&#xA0; STA $2006</span></div>
			<div>
				<span font-family:courier>&#xA0; LDA #$00</span></div>
			<div>
				<span font-family:courier>&#xA0; STA $2006<span class="Apple-tab-span"> </span>;Begins at $2000</span></div>
			<div>
				<span font-family:courier>&#xA0; LDX #$00</span></div>
			<div>
				<span font-family:courier>LoadTitleLoop:</span></div>
			<div>
				<span font-family:courier>&#xA0; LDA title,x &#xA0; &#xA0; &#xA0;<span class="Apple-tab-span"> </span>; load data from address (background + the value in x)</span></div>
			<div>
				<span font-family:courier>&#xA0; CMP #$FF<span class="Apple-tab-span"> </span>;Compares value to $FF, and if it is equal to FF, skip next branch</span></div>
			<div>
				<span font-family:courier>&#xA0; BNE Write_Title_Tile</span></div>
			<div>
				<span font-family:courier>&#xA0; INX</span></div>
			<div>
				<span font-family:courier>&#xA0; LDA title,x<span class="Apple-tab-span"> </span>;Takes value next to $FF and rams it in the variable title_black (a racist variable)</span></div>
			<div>
				<span font-family:courier>&#xA0; STA title_black</span></div>
			<div>
				<span font-family:courier>&#xA0; LDY #$00<span class="Apple-tab-span"> </span>;Prepares Y register</span></div>
			<div>
				<span font-family:courier>Black_Loop:</span></div>
			<div>
				<span font-family:courier>&#xA0; LDA #$00</span></div>
			<div>
				<span font-family:courier>&#xA0; STA $2007<span class="Apple-tab-span"> </span>;Puts a lot of black tiles on the screen (CHR+pallettes make them black)</span></div>
			<div>
				<span font-family:courier>&#xA0; INY<span class="Apple-tab-span"> </span>;Increments Y and then compares it to the title_black variable</span></div>
			<div>
				<span font-family:courier>&#xA0; CPY title_black</span></div>
			<div>
				<span font-family:courier>&#xA0; BNE Black_Loop<span class="Apple-tab-span"> </span>;If it&apos;s not equal, go back to Black_Loop</span></div>
			<div>
				<span font-family:courier>&#xA0; INX<span class="Apple-tab-span"> </span>;Increments X for it to be ready for the next tile, and goes back to LoadTitleLoop</span></div>
			<div>
				<span font-family:courier>&#xA0; JMP LoadTitleLoop</span></div>
			<div>
				<span font-family:courier>Write_Title_Tile:</span></div>
			<div>
				<span font-family:courier>&#xA0; STA $2007 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; write to PPU</span></div>
			<div>
				<span font-family:courier>&#xA0; INX &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; X = X + 1</span></div>
			<div>
				<span font-family:courier>&#xA0; CPX #$FA &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;; Compare X to hex $FA</span></div>
			<div>
				<span font-family:courier>&#xA0; BNE LoadTitleLoop<span class="Apple-tab-span"> </span>; Go back to LoadTitleLoop if it&apos;s not equal</span><br>
				<br>
				&#xA0;</div>
			<div>
				<span font-family:courier>title:</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $FF,$42,$1D,$0D,$19,$1C,$0F,$00,$00,$30,$31,$32,$33,$34,$35,$36</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $37,$FF,$03,$38,$39,$3A,$3B,$00,$12,$13,$01,$00,$40,$41,$42,$43</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $44,$45,$46,$47,$0B,$18,$0E,$48,$49,$4A,$4B,$FF,$31,$1A,$00,$1C</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $00,$0F,$00,$1D,$00,$0F,$00,$18,$00,$1E,$FF,$29</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $00,$1D,$3D,$4D,$3F,$3E,$3F,$4D,$3C,$3E,$3F,$4C,$4D,$3C,$00,$3E &#xA0;;; &#xA0;SFS Inscription! WEEEEEE</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $3F,$3D,$3D,$3D,$4D,$3F,$4C,$4D,$4C,$4D,$3C,$4D,$3C,$4D,$3F,$00 &#xA0;;; &#xA0;</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $00,$1F,$3D,$3D,$3D,$3D,$3C,$3D,$00,$3D,$3C,$00,$3D,$00,$00,$3D &#xA0;;; &#xA0;</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $3C,$3D,$3D,$3D,$3D,$3D,$00,$3D,$00,$3D,$00,$3D,$00,$3D,$3D,$00 &#xA0;;; &#xA0;</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $00,$1A,$3D,$3D,$3D,$4E,$3F,$4D,$3C,$3D,$00,$00,$3D,$00,$00,$4E &#xA0;;; &#xA0;</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $3F,$3D,$3D,$3D,$4D,$3D,$00,$3D,$00,$3D,$00,$4D,$3C,$4D,$4F,$00 &#xA0;;; &#xA0;</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $00,$0F,$3D,$3D,$3D,$3D,$3D,$3D,$00,$3D,$3D,$00,$3D,$00,$00,$3D &#xA0;;; &#xA0;</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $3D,$3D,$3D,$3D,$3D,$3D,$00,$3D,$00,$3D,$00,$3D,$00,$4D,$3F,$00 &#xA0;;; &#xA0;</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $00,$1C,$3D,$3D,$3D,$4E,$4F,$4C,$3C,$4E,$4F,$00,$3C,$00,$00,$4E &#xA0;;; &#xA0;</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $4F,$4E,$4C,$4F,$3C,$3C,$00,$3C,$00,$3C,$00,$4C,$3C,$3C,$3C,$FF &#xA0;;; &#xA0;Ends here </span></div>
			<div>
				<span font-family:courier>&#xA0; .db $4A,$02,$00,$1A,$16,$0B,$23,$0F,$1C,$00,$11,$0B,$17,$0F,$FF,$33</span></div>
			<div>
				<span font-family:courier>&#xA0; .db $03,$00,$1A,$16,$0B,$23,$0F,$1C,$00,$11,$0B,$17,$0F,$FF,$33</span><br>
				&#xA0;</div>
		</div>
	</div>
	I see what you are doing. You are using $FF as a flag in the table to jump to the &quot;Black_Loop&quot; loop. The number after $FF in the table is the number of times that &quot;Black_Loop&quot; is supposed to write tile $00. So in the title table, $FF will tell the loop to start and it will run $42 times. X Increases to 2 and now the &quot;Write_Title_Tile&quot; loop is enabled which writes tiles:<br>
	$1D,$0D,$19,$1C,$0F,$00,$00,$30,$31,$32,$33,$34,$35,$36<br>
	&#xA0; .db $37<br>
	to the background. Then $FF hits again, &quot;Black_Loop&quot; is enabled, and tile $00 is written $03 times. This continues for the rest of the table.<br>
	<br>
	The only thing I can see is that you are ending the table with $FF,$33 which is in the &quot;Black_Loop&quot;. However, your code exits the loop in the &quot;Write_Title_Tile&quot; loop.<br>
	<br>
	Write_Title_Tile:<br>
	&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write to PPU<br>
	&#xA0; INX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; X = X + 1<br>
	&#xA0; CPX #$FA&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare X to hex $FA <strong>&lt;--Exit Loop when X equals #$FA</strong><br>
	&#xA0; BNE LoadTitleLoop ; Go back to LoadTitleLoop if it&apos;s not equal<br>
	<br>
	Since you start the Write_Title_Tile loop with writing to the PPU, this could wreck the entire loop if there is nothing in the table for it to write after $FF,$33.<br>
	<br>
	Hope that makes sense.<br>
	&#xA0;</div>
<br>
That&apos;s exactly how my routine works, and you just fixed my glitch! Thanks a lot because this saves a lot of space!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__277">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 20, 2014 at 4:47:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	<br>
	That&apos;s exactly how my routine works, and you just fixed my glitch! Thanks a lot because this saves a lot of space!</div>
<br>
Not a problem, fresh eyes do wonders.<br>
<br>
This is a very cool way to do this. Granted, the backend work to setup the table probably sucked, but it has to take up about 1/4 of space as your old routine. Very intuitive.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__278">
                                                        <div class="mdl-card__title"><strong>Famicuber</strong> posted on 
		
			
				
				May 22, 2014 at 11:45:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi! I wanted to make a 32 x 16 Sprite Move by pushing the Left and right buttons, but when i load and save sprite positions more than 4, It makes the sprite move right very quickly, it&apos;s probably some kind of limitation, but i&apos;m not sure which to expand the numbers.
<br>Here&apos;s a screenshot on what i&apos;ve done on the screen. (which is edited in Nerdy Nights Week 6.)
<br><a href="http://i.imgur.com/FGQSOrZ.png" target="_blank" original-href="http://i.imgur.com/FGQSOrZ.png">http://i.imgur.com/FGQSOrZ.png...</a> (Any 80&apos;s and 90&apos;s kid from the UK may knew who this Duck is..)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__279">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 22, 2014 at 12:04:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Are you saying that it moves fast when you move 4 pixels per frame?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__280">
                                                        <div class="mdl-card__title"><strong>Famicuber</strong> posted on 
		
			
				
				May 22, 2014 at 12:18:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No, I meant that i wanted a 32 x 16 Sprite to move left and right by buttons TOGETHER.
<br>By what happened, The First 16 x 16 Sprite works.
<br>But the Second 16 x 16 Sprite Moves Right Very Fast without pushing a button.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__281">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 22, 2014 at 12:24:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, post code. We&apos;re not psychic, man. <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__282">
                                                        <div class="mdl-card__title"><strong>Famicuber</strong> posted on 
		
			
				
				May 22, 2014 at 12:37:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Had to use Pastebin for this, But here you go!
<br><a href="http://pastebin.com/Uzi6tJJp" target="_blank" original-href="http://pastebin.com/Uzi6tJJp">http://pastebin.com/Uzi6tJJp...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__283">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 22, 2014 at 12:47:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The main problem is your code is just really....terrible flow, it doesn&apos;t work. Take out the code in the NMI, and make an NMI handler. Just something to show NMI has happened, like clearing a value somewhere. Then make the game engine react on that. Both code screws up, one is just not see able and &quot;seems&quot; to work.
<br>
<br>But to get this to work for now, move 127-130 to where NotRightButton, and then delete the JMP ButtonA because you HAVE to return from the NMI, you never will if you keep looping forever and crash the stack.
<br>
<br>And lastly, never read buttons directly from the port, terrible thing to do in every aspect, read them into a variable and then use the variable. Sometimes you will need buttons many times in your programs, if you do that you will not be able to ever do that without it looking like crap and wasting 1/2 your CPU.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__284">
                                                        <div class="mdl-card__title"><strong>Famicuber</strong> posted on 
		
			
				
				May 22, 2014 at 1:03:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, At least now the Bottom of the 16 x 16 Sprite stops moving, only to not being able to move by pushing a button. But Thanks for your help anyway.
<br>Also, <a href="http://i.imgur.com/LyCImUo.png" target="_blank" original-href="http://i.imgur.com/LyCImUo.png">http://i.imgur.com/LyCImUo.png...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__285">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 22, 2014 at 1:07:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, the code looked okay with the right sprite spots moving. I&apos;d say just....I dunno, that should be it. Honestly as someone who has finished a project Nerdy Nights has good stuff, but man it definitely doesn&apos;t teach you how to properly program, just get stuff working. And storing data....incbin is 100x better than including it with .db&apos;s, but oh well. I&apos;d say fiddle with it more, if you need more help paste bin it and message me I&apos;ll look again if I see something blatantly wrong.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__286">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 22, 2014 at 2:26:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Don&apos;t get discouraged.  It will click, sooner or later!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__287">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 22, 2014 at 2:54:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					3gen, can you post some of your code? I really want to see what beautiful flowing code looks like.<br>
<br>
edit: Just in case you&apos;re wondering, yes, I&apos;m serious.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__288">
                                                        <div class="mdl-card__title"><strong>Famicuber</strong> posted on 
		
			
				
				May 22, 2014 at 9:10:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	Well, the code looked okay with the right sprite spots moving. I&apos;d say just....I dunno, that should be it. Honestly as someone who has finished a project Nerdy Nights has good stuff, but man it definitely doesn&apos;t teach you how to properly program, just get stuff working. And storing data....incbin is 100x better than including it with .db&apos;s, but oh well. I&apos;d say fiddle with it more, if you need more help paste bin it and message me I&apos;ll look again if I see something blatantly wrong.</div>
<br>
<br>
<br>
Ok, I could&apos;ve said this when i was first asking, but i was new at NES Assembly, so that&apos;s probably why the code i showed you was mediocre.(?)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__289">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 22, 2014 at 9:23:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	3gen, can you post some of your code? I really want to see what beautiful flowing code looks like.<br>
	<br>
	edit: Just in case you&apos;re wondering, yes, I&apos;m serious.</div>
<br>
I have posted code in a few languages on here, dig deep. It&apos;s out there so I don&apos;t have to post code, just look it up, and really, just read the code. Look at the commands I use, and how I access the &quot;files&quot; as really, the best way to program NES is basically files in a table. I&apos;ve used this in basically every piece of code I&apos;ve done. I&apos;ve shown the multicart engine, the RLE engine(s), and the controller test, and probably some other stufff I forget which is already out there.<br>
<br>
I mean, you&apos;ll get used to it, I&apos;m more informing you that the code isn&apos;t too good. THis is a reason most seasoned devs don&apos;t help people. You just have to chug trhough and learn the basics well enough to teach &#xA0;yourself how to code better. And reading off of a volatile (<a href="http://tigcc.ticalc.org/doc/keywords.html#volatile" target="_blank" original-href="http://tigcc.ticalc.org/doc/keywords.html#volatile">http://tigcc.ticalc.org/doc/keywo...</a>) isn&apos;t good, just because....we don&apos;t know what condition you look for, even if commented. Better to put it in a variable, which is named, then we know what the variable contains, and then do what we need. It will get more people helping. And honestly, it is easier to code better. If you want source, it&apos;s out there, look at it first. Take their basics, implement them, and learn to program. Not read nerdy nights and take bits of code. I mean we all start somewhere, I&apos;m just trying to lead you on to a path that will make what you make good. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__290">
                                                        <div class="mdl-card__title"><strong>Dimeback</strong> posted on 
		
			
				
				May 23, 2014 at 12:37:23 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve made a sprite where it shoots 4 bullet sprites in all four directions.  There were a few things I was wondering though:
<br>Is it possible to redraw the bullet sprite 3 times without having it take up space in the sprite memory?  Each bullet uses the same tile with the same attributes and starting positions.
<br>
<br>Is there any way to legitimately hide the bullet sprites when they aren&apos;t being fired?  By that I actually mean turning the sprites off or making them invisible (and turn on/reappear when they are shot) rather than hiding them behind the 16x16 metasprite they are shot from, which is the trick I currently use. (Or is the trick I use the only/best way?)
<br>
<br>I have collision points set up for the bullets so that when they reach a certain part of the screen they will go back to hiding behind the sprite so they can be fired again.  I want to make it so that all four bullets are only fired after the previous 4 bullets have successfully collided and gone back to that hiding state, but with the code I have now, once one bullet collides with a wall, all of the other bullets will automatically return to that hiding state and fire again.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__291">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 23, 2014 at 12:59:03 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					1. Make an object system, but you&apos;re talking hundreds of lines of code and a game engine, so not exactly easy. Or hardcode them all.
<br>
<br>2. Set the Y position of the sprite to $FF. Sprites not displayed need to always be set to $FF.
<br>
<br>3. Set up a counter, each time one is removed, set the Y position to FF, then increment it. Unless we increment to the value of 4, it&apos;s not done. Any sprite with an FF position, skip moving it or collision detecting it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__292">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 23, 2014 at 9:05:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>KHAN Games</b></i><br>
		<br>
		3gen, can you post some of your code? I really want to see what beautiful flowing code looks like.<br>
		<br>
		edit: Just in case you&apos;re wondering, yes, I&apos;m serious.</div>
	<br>
	I have posted code in a few languages on here, dig deep. It&apos;s out there so I don&apos;t have to post code, just look it up, and really, just read the code. Look at the commands I use, and how I access the &quot;files&quot; as really, the best way to program NES is basically files in a table. I&apos;ve used this in basically every piece of code I&apos;ve done. I&apos;ve shown the multicart engine, the RLE engine(s), and the controller test, and probably some other stufff I forget which is already out there.<br>
	<br>
	I mean, you&apos;ll get used to it, I&apos;m more informing you that the code isn&apos;t too good. THis is a reason most seasoned devs don&apos;t help people. You just have to chug trhough and learn the basics well enough to teach &#xA0;yourself how to code better. And reading off of a volatile (<a href="http://tigcc.ticalc.org/doc/keywords.html#volatile" target="_blank" original-href="http://tigcc.ticalc.org/doc/keywords.html#volatile">http://tigcc.ticalc.org/doc/keywords.html#volatile</a>) isn&apos;t good, just because....we don&apos;t know what condition you look for, even if commented. Better to put it in a variable, which is named, then we know what the variable contains, and then do what we need. It will get more people helping. And honestly, it is easier to code better. If you want source, it&apos;s out there, look at it first. Take their basics, implement them, and learn to program. Not read nerdy nights and take bits of code. I mean we all start somewhere, I&apos;m just trying to lead you on to a path that will make what you make good.</div>
<br>
Yea, Kevin, I mean fuck!&#xA0; There&apos;s only one way to do it, and he&apos;s obvoiusly right.&#xA0; Get with the program and start doing it right.&#xA0; As someone who&apos;s never actually released a game, you can dig deep and find some shit that will impart knowledge on you.&#xA0; He uses commands and shit to access files...from tables!!&#xA0;<br>
<br>
Then make the random jump to variables&#xA0;and seasoned vets.&#xA0; And, above all else, don&apos;t use the Nerdy Nights.&#xA0; Just make sure you start somewhere and figure this shit out before you post questions about it!!!&#xA0;<br>
<br>
<br type="_moz">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__293">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 23, 2014 at 9:12:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Dimeback</b></i><br>
	<br>
	I&apos;ve made a sprite where it shoots 4 bullet sprites in all four directions. There were a few things I was wondering though:<br>
	Is it possible to redraw the bullet sprite 3 times without having it take up space in the sprite memory? Each bullet uses the same tile with the same attributes and starting positions.<br>
	<br>
	Is there any way to legitimately hide the bullet sprites when they aren&apos;t being fired? By that I actually mean turning the sprites off or making them invisible (and turn on/reappear when they are shot) rather than hiding them behind the 16x16 metasprite they are shot from, which is the trick I currently use. (Or is the trick I use the only/best way?)<br>
	<br>
	I have collision points set up for the bullets so that when they reach a certain part of the screen they will go back to hiding behind the sprite so they can be fired again. I want to make it so that all four bullets are only fired after the previous 4 bullets have successfully collided and gone back to that hiding state, but with the code I have now, once one bullet collides with a wall, all of the other bullets will automatically return to that hiding state and fire again.</div>
<br>
First, each sprite you want to display on the screen will require some sprite memory.&#xA0; You just have to track them as required.&#xA0;<br>
<br>
You need to program to be offscreen when they are inactive.&#xA0; If you don&apos;t, you&apos;ll end up with flickering or a problem if there&apos;s not an active sprite to hide them behind.&#xA0; Just throw $FE in the four bytes for that sprite.<br>
<br>
Don&apos;t use the counter 3Gen suggests, that&apos;s not necessary.&#xA0; Simply check the sprites you want to use for the bulletts to see if they are &quot;inactive&quot;&#xA0; i.e. if they are in the $FE position, they are inactive.&#xA0; If all 4 (or really whichever you want to use) are inactive, tell the routine to fire.&#xA0; Otherwise, skip firing for that frame.&#xA0; Same thing if you want to only fire in a direction if the bullett for that direction is inactive.&#xA0;<br>
<br>
<br type="_moz">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__294">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 23, 2014 at 9:15:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I know, MRN.  I have a lot of work to do, but it&apos;s something to strive for.
<br>
<br>One day I hope to become a seasoned vet.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__295">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 23, 2014 at 10:42:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Dimeback</b></i><br>
		<br>
		I&apos;ve made a sprite where it shoots 4 bullet sprites in all four directions. There were a few things I was wondering though:<br>
		Is it possible to redraw the bullet sprite 3 times without having it take up space in the sprite memory? Each bullet uses the same tile with the same attributes and starting positions.<br>
		<br>
		Is there any way to legitimately hide the bullet sprites when they aren&apos;t being fired? By that I actually mean turning the sprites off or making them invisible (and turn on/reappear when they are shot) rather than hiding them behind the 16x16 metasprite they are shot from, which is the trick I currently use. (Or is the trick I use the only/best way?)<br>
		<br>
		I have collision points set up for the bullets so that when they reach a certain part of the screen they will go back to hiding behind the sprite so they can be fired again. I want to make it so that all four bullets are only fired after the previous 4 bullets have successfully collided and gone back to that hiding state, but with the code I have now, once one bullet collides with a wall, all of the other bullets will automatically return to that hiding state and fire again.</div>
	<br>
	First, each sprite you want to display on the screen will require some sprite memory.&#xA0; You just have to track them as required.&#xA0;<br>
	<br>
	You need to program to be offscreen when they are inactive.&#xA0; If you don&apos;t, you&apos;ll end up with flickering or a problem if there&apos;s not an active sprite to hide them behind.&#xA0; Just throw $FE in the four bytes for that sprite.<br>
	<br>
	<strong>Don&apos;t use the counter 3Gen suggests, that&apos;s not necessary.</strong>&#xA0; Simply check the sprites you want to use for the bulletts to see if they are &quot;inactive&quot;&#xA0; i.e. if they are in the $FE position, they are inactive.&#xA0; If all 4 (or really whichever you want to use) are inactive, tell the routine to fire.&#xA0; Otherwise, skip firing for that frame.&#xA0; Same thing if you want to only fire in a direction if the bullett for that direction is inactive.&#xA0;</div>
It isn&apos;t necessary. Adding tons of code to check for an arbitrary condition is the exact perfect way to go, and the best way to make an object system work. Have at it. 3 instructions and 1 state check is much worse than 4 state checks per frame with 1 register used as a variable, man what the hell was I thinking?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__296">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 23, 2014 at 11:01:23 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The great thing about code is there is more than 1 right answer. Some strive for the smallest and quickest solution. Some strive for the cleanest looking code so its easy to follow. Others just make it work. 
<br>
<br>Personally, I would go the route of MRN on how to hide sprites just because for me, its the simplest to follow. I&apos;m not too worried about CPU and space at this time because my programs are not very big or labor intensive.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__297">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 23, 2014 at 11:10:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					When you have more than 4, or are keeping track of multiple bullet sets, counters are impractical.  You&apos;re either going to have to set up a new &quot;available&quot; variable for each sprite or use the position.  
<br>
<br>i.e. if he had 4 sets of 4 bullets all of which could fire as a set of 4 independently, using counters wouldn&apos;t work very well.  
<br>
<br>Setting up a bit more code to start with is easier to learn and has more uses.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__298">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 23, 2014 at 11:14:36 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	The great thing about code is there is more than 1 right answer. Some strive for the smallest and quickest solution. Some strive for the cleanest looking code so its easy to follow. Others just make it work.<br>
	<br>
	Personally, I would go the route of MRN on how to hide sprites just because for me, its the simplest to follow. I&apos;m not too worried about CPU and space at this time because my programs are not very big or labor intensive.</div>
<br>
Just to post the difference between our code:<br>
<br>
LDY YPosition,X ;Get the Y position<br>
INY<br>
BEQ .NothingToBeMoved<br>
-Move object-<br>
-if out of range true for this, move it to FF and run line below-<br>
INC OutOfRangeObjects ;We have 1 more bullet out of range, not being moved.<br>
.NothingToBeMoved:<br>
<br>
Later on in the code:<br>
<br>
LDA OutOfRangeObjects ;Did we delete all our objects yet?1<br>
CMP #NumberOfObjects ;Test if we did.<br>
BNE .NothingToBeDoneHere ;;Nope, skip resetting them for now.<br>
-Reset them here- ;Reset them.<br>
.NothingToBeReset: ;DOne.<br>
<br>
SUPER simple, easy to read. It makes sense what the state of the variable is and if needed, what sets it, somewhere else. The best way to write code is to make it simple, and keep parts of the engine, like sprite positions which are 100% tied to hardware, out of the code. Otherwise, it is hard to read, and hard to modify if you&apos;re someone else. Write code like this, and you will get help 10x more often. Comment it too, and make sure it&apos;s not direct copy/paste, because the most simple and small and straightforward code you say you use, is NOT in the nerdy nights. I can post my start up code and show you the differences if you want to see what I mean, but nerdy nights isn&apos;t the best code for that.<br>
<br>
The code he describes, the first part would be the same, but somewhere randomly in the engine would be this:<br>
<br>
LDX YPosition<br>
INX<br>
BNE .NoReset<br>
LDX YPosition+4<br>
INX<br>
BNE .NoReset<br>
LDX YPosition+8<br>
INX<br>
BNE .NoReset<br>
LDX YPosition+12<br>
INX<br>
BNE .NoReset<br>
-Reset them here-<br>
.NoReset:<br>
<br>
It&apos;s 1. Bulky. 2. Inefficient. 3. COnfusing to anyoine trying to read your code to help you. I&apos;m sorry you guys don&apos;t like it, but honestly we need to work on better code examples and rework nerdy nights so it&apos;s less copying, and more real thinking. Because honestly, I don&apos;t ever help with NN because the code usually is horrid, especially when people extend on to it, because they use the same stuff, like &quot;DB walls&quot; as I call them, or just engine design that is weird. I know, shut up and do it yourself, one day, but for now man just....we as a community need to work together to make something better, even if it is just an &quot;alternative&quot; to it in some sections, or a &quot;What to avoid from the nerdy nights&quot; articles, I can do that. Or, just list off example of where nerdy nights code isn&apos;t good, and could be imporved on, that could work. I dunno, we&apos;re teaching these people assembly wrong, it&apos;s a good base for people who have programmed, and even people learning too, but it just could a lot better.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__299">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				May 23, 2014 at 11:22:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	When you have more than 4, or are keeping track of multiple bullet sets, counters are impractical. You&apos;re either going to have to set up a new &quot;available&quot; variable for each sprite or use the position.<br>
	<br>
	i.e. if he had 4 sets of 4 bullets all of which could fire as a set of 4 independently, using counters wouldn&apos;t work very well.<br>
	<br>
	Setting up a bit more code to start with is easier to learn and has more uses.</div>
<br>
Why would counters not work correctly? Every bomb deleted, you would use a 4 byte array to store the offset of the available sprite, then use a counter, still, to count up until 4 are off screen, then when there are 4 again, you read the sprites from the 4 byte array. The count, will also double as the index to the data. Very easy to do, something that would be way over designed and contribute 10x more code checking them all than just doing it with counters, unless I am misunderstanding how it&apos;s supposed to work in your example.<br>
<br>
And yes, it is good to start out with this, but we need to make sure they understand how there could be better ways to do this. Or just different ways of thinking, it&apos;s not that people can&apos;t program good, like I said, it&apos;s that the tutorial doesn&apos;t do a very good job of it. Would it be a good idea to make a &quot;How to program in assembly better.&quot; article to help people out with their programms techniques so they can clean up their code and know what to improve on after they learn from the nerdy nights?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__300">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 23, 2014 at 11:26:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	<strong>shut up and do it yourself,</strong></div>
Hey look something we can all agree on! &#xA0;<span class="sprites_emoticons absmiddle" id="emo_smile"></span> &#xA0;Until that happens all the complaints about horrid code are just thread mess. &#xA0;Code size and inefficiency makes zero difference when you are only running 100 instructions per frame. &#xA0;<br>
<br>
So many people are able to write tutorials, so many people complain about tutorials, almost nobody ever puts in the work. If you want to teach reading by starting with latin roots, go for it! &#xA0;Unfortunately its an easy bet that will never happen...<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__301">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 23, 2014 at 12:00:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					See you in a couple weeks 3GenGames.  Several warnings were issued to this guy for his trolling practices...obviously they didn&apos;t help.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__302">
                                                        <div class="mdl-card__title"><strong>quietquiet</strong> posted on 
		
			
				
				May 23, 2014 at 9:48:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Tried searching for an answer on the forums but I couldn&apos;t find one. I made some graphic mods to Hogan&apos;s Alley using Tile Layer Pro but once I play the rom on an emulator the zapper function doesn&apos;t work anymore. When I play the original rom, it works fine.&#xA0;I want to put it onto a custom cart but I&apos;m afraid it will be unplayable if it doesn&apos;t work on an emulator. Is there a way to fix this? &#xA0;Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__303">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				May 24, 2014 at 8:13:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So using the NN I was able to easily (i.e. with a bit of help, thanks man!) set up my splash, title, and other opening screens. However, I have very slowly switched to MRN&apos;s style of displaying screens and, more importantly, using game states (more or less combining MRN&apos;s tutorials week 2 and week 6). What would be a good way to implement some sort of timer system? Each screen should display for a few seconds, switch to the next, and then ultimately switch game states to something along the lines of LOZ&apos;s file entry screen. If this last screen/state should be part of the preceding state, please speak up.<br>
<br>
In my own trials with this problem (it should be pretty easy after all), what is strange is that I can get the splash screen to display for a few seconds and then switch to the next game state; OR I can get the splash to switch to the next screen within the same state (title screen), but it will not switch to the next game state (the screen is off, however, and a white line pulses through it; I&apos;m guessing the the screen is loading and reloading furiously). However, I cannot get both things to work at the same time. I can post code tomorrow, if that helps, but I am away from my code at the moment.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__304">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 25, 2014 at 12:24:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Quiet, zapper and rob work by flashing colors to signal when something is happening. You probably overwrote something important to this function. 
<br>
<br>Solegoose, it sounds like you didn&apos;t reset a timer or something. Just a frame counter that resets Everytime it reloads a screen should work. Just be sure to reset the counter before you load the screen or make the load routine aware that it is loading. I.e. Don&apos;t let the counter hit zero, start a screen load (which could take more than one frame), trigger a reload before the screen is finished reloading and the counter is reset, etc. 
<br>
<br>I usually just turn off the background and tell the program to skip the nmi graphics updates when I&apos;m loading a routine that&apos;s long like that. Should function the same as switching with a character, just uses a timer.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__305">
                                                        <div class="mdl-card__title"><strong>quietquiet</strong> posted on 
		
			
				
				May 25, 2014 at 4:42:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the answer, but something else seems to be the problem. I would save the rom with a tiny minor pixel change in Tile Layer Pro and that would also affect the zapper functionality. There must be zapper game mods that were successful, I don&apos;t understand why resaving a rom with even the slightest change would stop make it unplayable on an emulator. Just for clarification, I&apos;m using the mouse as a zapper, not an actual nes zapper.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__306">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				May 25, 2014 at 7:10:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	Solegoose, it sounds like you didn&apos;t reset a timer or something. Just a frame counter that resets Everytime it reloads a screen should work. Just be sure to reset the counter before you load the screen or make the load routine aware that it is loading. I.e. Don&apos;t let the counter hit zero, start a screen load (which could take more than one frame), trigger a reload before the screen is finished reloading and the counter is reset, etc.<br>
	<br>
	I usually just turn off the background and tell the program to skip the nmi graphics updates when I&apos;m loading a routine that&apos;s long like that. Should function the same as switching with a character, just uses a timer.</div>
<br>
I think that my main issue with timers is setting up correct loops. Conceptually, here is kind of what I have, but it does not work as intended. A lot of it is redundant, and even more can be reorganized into subroutines, but I wanted to keep it as simple as possible before scattering the code throughout the main file. Just to note most of this is repurposed from my inventory screen routine, I just tried to expand it. Oh, and this is not my actual code, but I&apos;m transposing it from one computer to another, in case there are any compiler mistakes.<br>
<br>
<br>
<br>
;initial splash screen is loaded in the initializing portion of the code, i.e. XCoordinate and YCoordinate variables are set to 0. Initial game state is also set to 2, the intro sequence.<br>
<br>
GameState2: &#xA0; &#xA0; &#xA0; &#xA0; ;Initial screen should show for 30<br>
&#xA0; INC Timer<br>
&#xA0; LDA Timer<br>
&#xA0; CMP #$30<br>
&#xA0; BEQ .Next1<br>
&#xA0; RTS<br>
.Next1 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;After 30, the second screen should load<br>
&#xA0; LDA Timer<br>
&#xA0; CMP #$60<br>
&#xA0; BEQ .Next2<br>
<br>
&#xA0; LDA #$01<br>
&#xA0; STA YCoordinate &#xA0; &#xA0; ;setting it to the next screen<br>
<br>
&#xA0; ;bankswitching, background, palette, sprite, and attribute loading occur here<br>
<br>
&#xA0; RTS<br>
<br>
.Next2 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;after 90, the state should switch to the main game playing state<br>
&#xA0; LDA Timer<br>
&#xA0; CMP #$90<br>
&#xA0; BEQ .Next3<br>
<br>
&#xA0; LDA #$01 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;These coordinates being the location of the first room in the main playing state<br>
&#xA0; STA YCoordinate<br>
&#xA0; LDA #$01<br>
&#xA0; STA XCoordinate<br>
<br>
&#xA0; ;bankswitching, background, etc. loading here<br>
<br>
&#xA0; LDA #$00 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;main playing state<br>
&#xA0; STA GameState<br>
<br>
.Next3<br>
<br>
&#xA0; RTS
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__307">
                                                        <div class="mdl-card__title"><strong>Aaendi</strong> posted on 
		
			
				
				May 25, 2014 at 8:12:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					With the whole 3GG vs MRN debate, both methods seem strange to me.  I always used object memory slots, and a &quot;draw sprite&quot; or &quot;draw metasprite&quot; subroutine.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__308">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 25, 2014 at 9:47:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That&apos;s the beauty of coding.  There are probably 15 different ways to do everything. <span class="sprites_emoticons absmiddle" id="emo_smile"></span> That doesn&apos;t make anyone wrong, and definitely shouldn&apos;t warrant being talked down to if someone doesn&apos;t do something the same way as you.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__309">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 25, 2014 at 10:17:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>quietquiet</b></i><br>
	<br>
	I would save the rom with a tiny minor pixel change in Tile Layer Pro and that would also affect the zapper functionality.&#xA0;</div>
Maybe the emulator is doing a crc check to enable the zapper, so when you make any change it turns the zapper off?<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__310">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 25, 2014 at 10:40:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	GameState2:&#xA0;<br>
	&#xA0; INC Timer<br>
	&#xA0; LDA Timer<br>
	&#xA0; CMP #$30<br>
	&#xA0; BEQ .Next1<br>
	&#xA0; RTS<br>
	.Next1 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;<strong> Gets here only when timer = 30</strong><br>
	&#xA0; LDA Timer<br>
	&#xA0; CMP #$60<br>
	&#xA0; BEQ .Next2 &#xA0; &#xA0; &#xA0; &#xA0; <strong>Which means Timer never = 60 here, branch never happens</strong><br>
	&#xA0;<br>
	&#xA0; LDA #$01<br>
	&#xA0; STA YCoordinate &#xA0; &#xA0; ;setting it to the next screen<br>
	<br>
	&#xA0; ;bankswitching, background, palette, sprite, and attribute loading occur here<br>
	<br>
	&#xA0; RTS<br>
	<br>
	.Next2 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <strong>So this code will never run</strong></div>
<br>
You either need to use branches other than BEQ, or do all the CMP/BEQ in a row with the RTS at the end<br>
<br>
&#xA0; LDA Timer<br>
&#xA0; CMP #$30<br>
&#xA0; BEQ step1<br>
&#xA0; CMP #$60<br>
&#xA0; BEQ step2<br>
&#xA0; CMP #$90<br>
&#xA0; BEQ step3<br>
&#xA0; RTS&#xA0;<br>
<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__311">
                                                        <div class="mdl-card__title"><strong>quietquiet</strong> posted on 
		
			
				
				May 25, 2014 at 10:58:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>quietquiet</b></i><br>
		<br>
		I would save the rom with a tiny minor pixel change in Tile Layer Pro and that would also affect the zapper functionality.&#xA0;</div>
	Maybe the emulator is doing a crc check to enable the zapper, so when you make any change it turns the zapper off?<br>
	<br>
	&#xA0;</div>
<i>Yeah, that ended up being the issue! I had tried changing the input port 1 to zapper but it was port 2 I needed to use. Everything works fine now! Thanks!</i><br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__312">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				May 25, 2014 at 11:13:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
		<br>
		GameState2:&#xA0;<br>
		&#xA0; INC Timer<br>
		&#xA0; LDA Timer<br>
		&#xA0; CMP #$30<br>
		&#xA0; BEQ .Next1<br>
		&#xA0; RTS<br>
		.Next1 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;<strong> Gets here only when timer = 30</strong><br>
		&#xA0; LDA Timer<br>
		&#xA0; CMP #$60<br>
		&#xA0; BEQ .Next2 &#xA0; &#xA0; &#xA0; &#xA0; <strong>Which means Timer never = 60 here, branch never happens</strong><br>
		&#xA0;<br>
		&#xA0; LDA #$01<br>
		&#xA0; STA YCoordinate &#xA0; &#xA0; ;setting it to the next screen<br>
		<br>
		&#xA0; ;bankswitching, background, palette, sprite, and attribute loading occur here<br>
		<br>
		&#xA0; RTS<br>
		<br>
		.Next2 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <strong>So this code will never run</strong></div>
	<br>
	You either need to use branches other than BEQ, or do all the CMP/BEQ in a row with the RTS at the end<br>
	<br>
	&#xA0; LDA Timer<br>
	&#xA0; CMP #$30<br>
	&#xA0; BEQ step1<br>
	&#xA0; CMP #$60<br>
	&#xA0; BEQ step2<br>
	&#xA0; CMP #$90<br>
	&#xA0; BEQ step3<br>
	&#xA0; RTS&#xA0;<br>
	<br>
	<br>
	&#xA0;</div>
<br>
Thanks! That makes much more sense, and coincidentally enough about matches what I did for my weapon select routines <span class="sprites_emoticons absmiddle" id="emo_smile"></span>. Time in place of buttons just left me a bit baffled for some reason...<br>
<br>
Any suggestions or thoughts about whether a list of BEQs or a combination of different branching commands would be more effective/efficient/etc.? Not necessarily for this task, but in general when doing this type of thing. I had initially used others, but kept getting confused in my logic.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__313">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 25, 2014 at 11:33:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The problem with the list of BEQ is each branch can only jump over a certain amount of code. So if your step1 is very long, the BEQ step2 might not reach. Instead you would have to do:<br>
<br>
&#xA0; LDA Timer<br>
&#xA0; CMP #$30<br>
&#xA0; BNE not30<br>
&#xA0; jmp step1<br>
not30:<br>
&#xA0; CMP #$60<br>
&#xA0; BNE not60<br>
&#xA0; jmp step2<br>
not60:<br>
&#xA0; etc<br>
<br>
which is harder to read. Until you are ready for much more advanced stuff that is probably going to be the best way.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__314">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 26, 2014 at 1:45:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	The problem with the list of BEQ is each branch can only jump over a certain amount of code. So if your step1 is very long, the BEQ step2 might not reach. Instead you would have to do:<br>
	<br>
	&#xA0; LDA Timer<br>
	&#xA0; CMP #$30<br>
	&#xA0; BNE not30<br>
	&#xA0; jmp step1<br>
	not30:<br>
	&#xA0; CMP #$60<br>
	&#xA0; BNE not60<br>
	&#xA0; jmp step2<br>
	not60:<br>
	&#xA0; etc<br>
	<br>
	which is harder to read. Until you are ready for much more advanced stuff that is probably going to be the best way.</div>
<br>
<br>
For those of us who have been using this method for a long time, what is the next, more complicated, way to do it?<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__315">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 26, 2014 at 12:10:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Pointers!!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__316">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 26, 2014 at 12:14:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					LSR or ASL to get rid of all the unneeded bits and reduce it down.<br>
<br>
I.e. 0-15 would use&#xA0;4 LSR and be 0 in the table. 16-31 would be 1. Etc.<br>
<br>
Or I&apos;m sure there are other ways.<br type="_moz">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__317">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				May 30, 2014 at 12:29:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have a little question... What would be the most effective way of moving a sprite in a circle?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__318">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				May 30, 2014 at 12:36:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi all,
<br>
<br>Sprite Palette:
<br>
<br>Subset A / Subset B / Subset C / Subset D
<br>c0 c1 c2 c3 / c0 c4 c5 c6 / c0 c7 c8 c9 / c0 cA cB cC
<br>
<br>Total 1 (c0) + 12 colors, correct?
<br>
<br>Each 8x8px (or 8x16px) sprite can have only 4 colors, and one of them is c0, right?
<br>
<br>If so far I&apos;m correct... Quick question, simple curiosity:
<br>
<br>It seems no possible to have a sprite with, for example, c0 c1 c2 _c9_.
<br>
<br>A sprite can only get the colors in a single subset of a palette?
<br>
<br>It is this restriction true, or I&apos;m missing something?
<br>
<br>Say a sprite needs Black Red Blue Green, and another Black Red Blue Yellow, two out of four palettes are needed for only those two sprites?
<br>
<br>Is there a way to mix up the 4 colors of different sprites?
<br>
<br>I mean, for example:
<br>
<br>- color 00 +
<br>- color 01 from Subset A +
<br>- color 10 from Subset C +
<br>- color 11 from Subset B
<br>
<br>Sorry if the question was already covered somewhere, I couldn&apos;t find a clear answer.
<br>
<br>I know my English is far from perfection, I hope this is understandable.
<br>
<br>Any feedback is welcome. Thanks.
<br>
<br>Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__319">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 30, 2014 at 12:48:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	Hi all,<br>
	<br>
	Sprite Palette:<br>
	<br>
	Subset A / Subset B / Subset C / Subset D<br>
	c0 c1 c2 c3 / c0 c4 c5 c6 / c0 c7 c8 c9 / c0 cA cB cC<br>
	<br>
	Total 1 (c0) + 12 colors, correct?<br>
	<br>
	Each 8x8px (or 8x16px) sprite can have only 4 colors, and one of them is c0, right?<br>
	<br>
	If so far I&apos;m correct... Quick question, simple curiosity:<br>
	<br>
	It seems no possible to have a sprite with, for example, c0 c1 c2 _c9_.<br>
	<br>
	A sprite can only get the colors in a single subset of a palette?<br>
	<br>
	It is this restriction true, or I&apos;m missing something?<br>
	<br>
	Say a sprite needs Black Red Blue Green, and another Black Red Blue Yellow, two out of four palettes are needed for only those two sprites?<br>
	<br>
	Is there a way to mix up the 4 colors of different sprites?<br>
	<br>
	I mean, for example:<br>
	<br>
	- color 00 +<br>
	- color 01 from Subset A +<br>
	- color 10 from Subset C +<br>
	- color 11 from Subset B<br>
	<br>
	Sorry if the question was already covered somewhere, I couldn&apos;t find a clear answer.<br>
	<br>
	I know my English is far from perfection, I hope this is understandable.<br>
	<br>
	Any feedback is welcome. Thanks.<br>
	<br>
	Cheers!<br>
	<br>
	- user</div>
<br>
You are correct. The sprite can only use one subset of 4 colors. You cannot mix the color from subsets.<br>
<br>
If you don&apos;t already know, c0 would be used for transpency so the background will show through, so you really only get 3 colors and a transparent color.<br>
<br>
I don&apos;t know if this helps, but you can change the colors in the palette anytime during the game.<br>
So, lets say in Subset A you have c0,c1,c2,c3 where c0=black, c1=blue, c2=red, and c3=green. At any time, you can change c1 to yellow by changing the value in the pallete (I think address $3F11 for c1). However, this means that the color of blue is now gone. I use this in my game to change the color of beer I am filling the mug with.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__320">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				May 30, 2014 at 1:11:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					@Mega Mario Man<br>
<br>
Thanks. Really clear answer. Appreciated.<br>
<br>
Yes, I knew c0 was for pseudo-transparency.<br>
<br>
Going forwards with my question, if you get time:<br>
<br>
<a href="http://www.spriters-resource.com/fullview/29821/" target="_blank" original-href="http://www.spriters-resource.com/fullview/29821/">http://www.spriters-resource.com/...</a><br>
<br>
look at the flying dragon about the center of the image: black + 2 shades + horns + wings = 5 colors<br>
<br>
Or course is made by several sprites (80x80px), but they really used a second sub palette just to add a single color to it? By the way, in this case black is the color of the transparency (the background is always black in battles _iirc_), or you think there is another transparent color around the picture, which increases to total to 6?<br>
<br>
Those are the heroes, which all use 2 specific palette if I understand it right:<br>
<br>
<a href="http://www.spriters-resource.com/nes/ff2/sheet/29842/" target="_blank" original-href="http://www.spriters-resource.com/nes/ff2/sheet/29842/">http://www.spriters-resource.com/...</a><br>
<br>
- BLACK, RED, PINK, WHITE<br>
- BLACK, BLUE, YELLOW, BROWN<br>
<br>
In this case, black is the transparency, correct?<br>
<br>
If so, all four palette are used to draw the four heroes and that enemy in the battle screen.<br>
<br>
And anything else, must fit one of those 4 subsets combinations.<br>
<br>
If not, how did they do it? (I know those guys from SQUARE were genius).<br>
<br>
Citation: &quot;I don&apos;t know if this helps, but you can change the colors in the palette anytime during the game.&quot;<br>
<br>
This is possible in the same screen refresh or only between two different screen refresh?<br>
<br>
I hope all this is understandable. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Thanks again!<br>
<br>
- user<br>
<br>
edit: mispelling corrections<br>
<br>
editII:<br>
Thinking twice, I guess that likely the enemy was made of background tiles, taking colors from the background palettes: you would need a very big ammount of sprite to draw that big picture as sprites, and iirc you cannot have more than 8 sprite each line being draw, and also, iirc the hero weapons had many different colors, which would require the other two sprite palettes for that I guess. I hope this reasoning makes sense...<br>
<br>
- user<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__321">
                                                        <div class="mdl-card__title"><strong>Famicuber</strong> posted on 
		
			
				
				May 30, 2014 at 1:22:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Probably a simple question but, I&apos;m New at NES Programming, but I wanted the screen change to the menu after pressing start in the title screen, It starts with the title with &quot;PRESS START!&quot; in the first screen, but when Start is pressed, it&apos;ll move to the second screen with options. Is there a way to know how do I do it?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__322">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				May 30, 2014 at 1:29:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	I have a little question... What would be the most effective way of moving a sprite in a circle?</div>
The easiest way would be to write a program in your favorite support language that generates a look up table of fixed point values for points on a circle for the radius and resolution you desire. These points would be generated around the origin and then you can just add each point to the point around which you want your sprite to orbit.<br>
<br>
There&apos;s another way that involves generating (in 6502, not pre-generated LUT) sinusoidal motion on the X and Y axes, and having the sinusoid motion of each axis intersect such that it creates approximately circular motion, but it is hard to explain, and also hard to work with and tweak. But it can generate some neat effects (lightning balls that Boulder fires in Nomolos move this way, in slowly expanding spiral motion)<br>
<br>
I like to work with 24 bit coordinates. 16 bits for world coordinates and 8 bits for fine sub pixel precision. My velocities are typilcally 16 bits , and when I add them to the 24 bit coordinates I sign extend for the highest byte in the coordinates, where the two bytes of the velocity are added to the two lowest bytes of the 24 bit coordinates. I like this approach because I don&apos;t have to do any bit twiddling, and it is simple.<br>
<br>
There may be other ways of creating circular movement. The two approaches I mentioned have worked great for me so I haven&apos;t yet bothered to research it further. If all you need is a tight circle that doesn&apos;t change in radius, I&apos;d reccommend the first approach.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__323">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 30, 2014 at 2:09:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>GradualGames</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Vectrex280996</b></i><br>
		<br>
		I have a little question... What would be the most effective way of moving a sprite in a circle?</div>
	The easiest way would be to write a program in your favorite support language that generates a look up table of fixed point values for points on a circle for the radius and resolution you desire. These points would be generated around the origin and then you can just add each point to the point around which you want your sprite to orbit.</div>
That is what I did for the xmas 2013 game. &#xA0;ROM is cheap and CPU time is limited, so pre calculated look up tables was the only way to get that many objects moving at once. &#xA0;I just did formulas in Excel to generate the tables. &#xA0;Circles, spirals, figure 8s, etc were all done with only slightly crazy maths. &#xA0;Every level has a global movement table (like moving left/right) and then each object uses its own table (like circles).<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__324">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 30, 2014 at 2:14:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	@Mega Mario Man<br>
	<br>
	Thanks. Really clear answer. Appreciated.<br>
	<br>
	Yes, I knew c0 was for pseudo-transparency.<br>
	<br>
	Going forwards with my question, if you get time:<br>
	<br>
	<a href="http://www.spriters-resource.com/fullview/29821/" target="_blank" original-href="http://www.spriters-resource.com/fullview/29821/">http://www.spriters-resource.com/fullview/29821/</a><br>
	<br>
	look at the flying dragon about the center of the image: black + 2 shades + horns + wings = 5 colors<br>
	<br>
	Or course is made by several sprites (80x80px), but they really used a second sub palette just to add a single color to it? By the way, in this case black is the color of the transparency (the background is always black in battles _iirc_), or you think there is another transparent color around the picture, which increases to total to 6?<br>
	<br>
	Those are the heroes, which all use 2 specific palette if I understand it right:<br>
	<br>
	<a href="http://www.spriters-resource.com/nes/ff2/sheet/29842/" target="_blank" original-href="http://www.spriters-resource.com/nes/ff2/sheet/29842/">http://www.spriters-resource.com/nes/ff2/sheet/29842/</a><br>
	<br>
	- BLACK, RED, PINK, WHITE<br>
	- BLACK, BLUE, YELLOW, BROWN<br>
	<br>
	In this case, black is the transparency, correct?<br>
	<br>
	If so, all four palette are used to draw the four heroes and that enemy in the battle screen.<br>
	<br>
	And anything else, must fit one of those 4 subsets combinations.<br>
	<br>
	If not, how did they do it? (I know those guys from SQUARE were genius).<br>
	<br>
	Citation: &quot;I don&apos;t know if this helps, but you can change the colors in the palette anytime during the game.&quot;<br>
	<br>
	This is possible in the same screen refresh or only between two different screen refresh?<br>
	<br>
	I hope all this is understandable.<br>
	<br>
	Thanks again!<br>
	<br>
	- user<br>
	<br>
	edit: mispelling corrections</div>
<strong>Or course is made by several sprites (80x80px),</strong><br>
One issue I can see is that if you build the dragon at 80x80 pixels, it will flicker. This would make the dragon 10 Sprites x 10 Sprites big. NES sprites are 8x8 pixels and you can only have 8 sprites in one scan line, so that would be a 64 pixel limit for all sprites on the screen per scan line.<br>
<br>
<strong>but they really used a second sub palette just to add a single color to it?</strong><br>
Well, a sprite is only 8px X 8px, so they could have built the dragon in a way that each 8x8 px area only uses 3 colors. It looks like that is possible. The wings could be Subset A and the body could be Subset B. This would be my guess.<br>
Black is probably the transparent color if most of the background is black. It doesn&apos;t really matter for sprites what the transparent color is because it is transparent, all background colors show through pixels with c0 in a sprite.<br>
<br>
<strong>- BLACK, RED, PINK, WHITE<br>
- BLACK, BLUE, YELLOW, BROWN<br>
<br>
In this case, black is the transparency, correct?</strong><br>
I would say yes, but couldn&apos;t tell you for sure without seeing their code.<br>
<br>
<strong>If so, all four palette are used to draw the four heroes and that enemy in the battle screen.<br>
And anything else, must fit one of those 4 subsets combinations.<br>
If not, how did they do it? (I know those guys from SQUARE were genius).</strong><br>
I would say you nailed it, all 4 are used. Remember, since we can change the palette during the game, each new screen loaded probably has it&apos;s own color palette. The game I am making does this and I think it is very common to switch color palettes with screen changes. But, every sprite on that screen is limited to those 4 subsets only.<br>
<br>
<strong>Citation: &quot;I don&apos;t know if this helps, but you can change the colors in the palette anytime during the game.&quot;<br>
This is possible in the same screen refresh or only between two different screen refresh?</strong><br>
Either. However, when you change the color in the palette, all sprites using that color will change. So, the hero and the dragon both use c1 as blue and you change it to yellow during the battle, all pixels using c1 will change to yellow in all sprites.<br>
You can see this happening in games that have flashing graphics (think mega man when you hold the Fire button down to make a giant bullet) or games that do a fade-to-black during cut scenes. What is really happening is that the color palette is being changed in real time.<br>
<br>
Hope this helps.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__325">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 30, 2014 at 2:20:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Famicuber Inc.</b></i><br>
	<br>
	Probably a simple question but, I&apos;m New at NES Programming, but I wanted the screen change to the menu after pressing start in the title screen, It starts with the title with &quot;PRESS START!&quot; in the first screen, but when Start is pressed, it&apos;ll move to the second screen with options. Is there a way to know how do I do it?</div>
<br>
I suggest you start with Nerdy Nights 7.<br>
<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8747" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8747">http://nintendoage.com/forum/mess...</a><br>
<br>
Once you start getting good at coding, move to a more advanced style like this (Game Engine Building #2 by MRN):<br>
<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=37054" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=37054">http://nintendoage.com/forum/mess...</a><br>
<br>
I don&apos;t think it can be explained any better than it is in the tutorials stickied in The Brewery.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__326">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				May 30, 2014 at 2:44:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					@Mega Mario Man<br>
<br>
&quot;Hope this helps.&quot;<br>
<br>
Yep, great, thanks.<br>
<br>
I figured out few things reasoning by myself (see also my edit of the post above about the sprites displayed on a specific scan line limits), but it is useful to get confirmation from someone with more experience. And some other points you make are really enlightening on the subject, add some more knowledge, and are really clear to understand. Nice to know.<br>
<br>
Thanks again, appreciated.<br>
<br>
&quot;The game I am making...&quot;<br>
Good luck (or whatever wish fits the best) with it, of course!<br>
<br>
- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__327">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 30, 2014 at 2:52:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	@Mega Mario Man<br>
	<br>
	I figured out few things reasoning by myself (see also my edit of the post above about the sprites displayed on a specific scan line limits), but it is useful to get confirmation from someone with<strong> more experience</strong>.<br>
	<br>
	&quot;The game I am making...&quot;<br>
	Good luck (or whatever wish fits the best) with it, of course!<br>
	<br>
	- user</div>
Not too much more experience than you, I started in March 2014! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
And as for my game, it&apos;s not much, but it has been a great learning tool for me. I asked and researched a lot of the same questions you are asking. I highly suggest the Nerdy Nights tutorials and then start working through Mario&apos;s Right Nut&apos;s tutorials (these are pretty advanced, at least for me).<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__328">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 30, 2014 at 3:01:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>GradualGames</b></i><br>
		<br>
		<div class="FTQUOTE">
			<i>Originally posted by: <b>Vectrex280996</b></i><br>
			<br>
			I have a little question... What would be the most effective way of moving a sprite in a circle?</div>
		The easiest way would be to write a program in your favorite support language that generates a look up table of fixed point values for points on a circle for the radius and resolution you desire. These points would be generated around the origin and then you can just add each point to the point around which you want your sprite to orbit.</div>
	That is what I did for the xmas 2013 game. &#xA0;ROM is cheap and CPU time is limited, so pre calculated look up tables was the only way to get that many objects moving at once. &#xA0;I just did formulas in Excel to generate the tables. &#xA0;Circles, spirals, figure 8s, etc were all done with only slightly crazy maths. &#xA0;Every level has a global movement table (like moving left/right) and then each object uses its own table (like circles).<br>
	&#xA0;</div>
Would you use this same method to make the patterns that, say, Galaga uses to bring sprites on the screen?&#xA0; Or what&apos;s a good way to do something like that?<br>
<br>
<br>
<br type="_moz">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__329">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				May 30, 2014 at 3:06:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					&quot;I highly suggest the Nerdy Nights&quot;
<br>
<br>Yeah, I had time to read and understand the code for only the first chapters so far, so I&apos;m lacking a lot of knowledge. I built and added my own patterns for sprites to it, just as an experiment (I&apos;m more curious rather than really thinking about making a full game), and it worked out well. This is why I was guessing (correctly) you can&apos;t pick any of the 13 colors, just for the way the palettes and the data are stored. Thanks again!
<br>
<br>- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__330">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 30, 2014 at 3:10:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yup, any fixed curved path is pretty easy with look up tables.  You can either do the difference to add/sub each frame, or just the absolute pixel position.  All mine were deltas so a character moving in a circle could also be moving left/right.  I split each movement into X frames, then gave each character a frame counter, and make it either loop or reverse at the end.  Big circle is divided into 256 steps, a smaller circle might get only 100 so they both take the same amount of time for 1 revolution.  The character can either keep circling or bounce and change direction each time.
<br>
<br>If you look at Galaga, a set of bugs all follow the same path (simple look up table) to a certain point then branch out straight to their ending spot (simple math).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__331">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				May 30, 2014 at 6:01:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	Yup, any fixed curved path is pretty easy with look up tables. You can either do the difference to add/sub each frame, or just the absolute pixel position. All mine were deltas so a character moving in a circle could also be moving left/right. I split each movement into X frames, then gave each character a frame counter, and make it either loop or reverse at the end. Big circle is divided into 256 steps, a smaller circle might get only 100 so they both take the same amount of time for 1 revolution. The character can either keep circling or bounce and change direction each time.<br>
	<br>
	If you look at Galaga, a set of bugs all follow the same path (simple look up table) to a certain point then branch out straight to their ending spot (simple math).</div>
<br>
And how do you make such lookup tables?<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__332">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 30, 2014 at 7:00:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have pretty crazy excel spreadsheets, once they are set up I can change setup values and the whole table will recalculate.  Here is one from xmas 2013: 
<br>
<br><a href="https://docs.google.com/spreadsheets/d/1KQ1B-LdA9CKU3cxCmbswsFk2r0TIjzcdSc1ZaWkY36g/edit?usp=sharing" target="_blank" original-href="https://docs.google.com/spreadsheets/d/1KQ1B-LdA9CKU3cxCmbswsFk2r0TIjzcdSc1ZaWkY36g/edit?usp=sharing">https://docs.google.com/spreadshe...</a>
<br>
<br>It is one of the enemy movements where it does a figure 8 that drops down the screen towards the player.  &quot;dist between points&quot; sets the width, &quot;frames&quot; is how long it takes to do a complete cycle, &quot;drop speed&quot; is how much each step drops down the screen.  First the index row sets up the calcs for each frame.  Index*drop is how much to add to the normal figure 8 equation.  &quot;t angle&quot; is the 360 degrees of a circle divided into how many frames there are.  &quot;bernoulli&quot; is the crazy figure 8 equation.  &quot;x/y offset&quot; is how far each step moves, which gets truncated then converted to hex to copy/paste into a data file.  &quot;x/y abs&quot; is all those offsets added together to make the chart so everything looks good.  
<br>
<br>If I wanted it to move faster I just reduce the frames number and everything else is automatically changed.  Or to do figure 8 with no drop the speed is set to 0.  I have a separate sheet for each movement type, circles/parabolas/spirals/sin waves/etc.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__333">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 30, 2014 at 11:40:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Having a strange issue with my code when loading the Title Screen from a Game Over game state. When I start the ROM, the title screen loads just fine. Then I play the game, lose, and get to the game over screen. During all of this, I am changing the palette (with the PPU off) during game state changes and background changes. Now, when I switch from the game over game state back to the title screen, the title screen is all 0s. When I look at the Name Table Viewer in FCEUXD, the correct title screen is in $2000 and mirrored to $2800 and the other 2 name tables are all 0s. Now, if I press start again, the game playing state loads just fine and I can play the game again.<br>
<br>
With further troubleshooting, I commented out the palette change code before loading the title screen when transitioning from game over screen and the title screen loads just fine, but using the wrong palette since I commented out that part. Any ideas on what could cause this?&#xA0; Here is the relevant code to the processes: <a href="http://pastebin.com/EEWkgebx" target="_blank" original-href="http://pastebin.com/EEWkgebx">http://pastebin.com/EEWkgebx...</a><br>
<br>
If nothing looks out of sorts here, I could post the entire code for those that request it. Picture below of the emulator and the nametable.<br>
<br>
Thanks!<img align alt="hhissue" border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/19959/photobucket/239C3E93-9102-893B-563EC5E76EE3F60C.png" show-src="scraper/images/239C3E93-9102-893B-563EC5E76EE3F60C.png">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__334">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				May 31, 2014 at 2:08:39 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi all,
<br>
<br>I have few other doubts I need confirmation about.
<br>
<br>Screen shots of asm code and hex binary: it works, of course.
<br>
<br><a href="http://nintendoagemedia.com/users/21264/photobucket/2887D08E-C252-63B0-082B229C49B18A2F.png" target="_blank" original-href="http://nintendoagemedia.com/users/21264/photobucket/2887D08E-C252-63B0-082B229C49B18A2F.png">http://nintendoagemedia.com/users...</a>
<br>
<br><a href="http://nintendoagemedia.com/users/21264/photobucket/2887DB52-9A59-155B-1965439D976051F8.png" target="_blank" original-href="http://nintendoagemedia.com/users/21264/photobucket/2887DB52-9A59-155B-1965439D976051F8.png">http://nintendoagemedia.com/users...</a>
<br>
<br>#1. Line 47
<br>
<br>With 16KB of Code ROM, .bank 1 always starts at e000, correct?
<br>This is not a 6502 instruction, it is NESASM assembler specific, correct?
<br>It says to the assembler:
<br>- in the &quot;zone&quot; between e000 and ffff
<br>- go to fffa
<br>- and from there write the following addresses (xxyy as yy xx)
<br>correct?
<br>I mean, .bank 1 does not start at fffa as for the following .org; with 16KB of Code ROM it always starts at e000, whatever the following .org says. It is this correct?
<br>Also, it is this instruction (.bank) valid only for the NESASM assembler?
<br>
<br>#2. Lines 14-15
<br>
<br>The concept of setting up the stack still a bit foggy, any further feedback about it is welcome.
<br>
<br>#3. Hex Binary
<br>
<br>Starting at c000, the program bytes (except for the fffa-ffff data) end at c045 (with the 16 bytes of header not part of it): why all the other bytes are ff? why not 00? it is this important?
<br>Also, in the real time emulator hex editor the whole program is there twice, once from 8000 to bfff, and once from c000 to ffff: it is this the way Nes works whit only 16KB of Code ROM instead of 32KB?
<br>
<br>Thanks in advance to anyone has a bit of time to give some feedback, I&apos;m interested about it.
<br>
<br>I hope my English is understandable, and my questions not too silly. Also, I hope this is the correct thread to post those questions (by the way, how do you format lists in your posts?).
<br>
<br>Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>- user
<br>
<br>@BunnyBoy (if you read this): interesting writings!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__335">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jun 1, 2014 at 12:10:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	Hi all,<br>
	<br>
	I have few other doubts I need confirmation about.<br>
	<br>
	Screen shots of asm code and hex binary: it works, of course.<br>
	<br>
	<a href="http://nintendoagemedia.com/users/21264/photobucket/2887D08E-C252-63B0-082B229C49B18A2F.png" target="_blank" original-href="http://nintendoagemedia.com/users/21264/photobucket/2887D08E-C252-63B0-082B229C49B18A2F.png">http://nintendoagemedia.com/users/21264/photobucket/2887D08E...</a> <br>
	<br>
	<a href="http://nintendoagemedia.com/users/21264/photobucket/2887DB52-9A59-155B-1965439D976051F8.png" target="_blank" original-href="http://nintendoagemedia.com/users/21264/photobucket/2887DB52-9A59-155B-1965439D976051F8.png">http://nintendoagemedia.com/users/21264/photobucket/2887DB52...</a> <br>
	<br>
	#1. Line 47<br>
	<br>
	With 16KB of Code ROM, .bank 1 always starts at e000, correct?<br>
	This is not a 6502 instruction, it is NESASM assembler specific, correct?<br>
	It says to the assembler:<br>
	- in the &quot;zone&quot; between e000 and ffff<br>
	- go to fffa<br>
	- and from there write the following addresses (xxyy as yy xx)<br>
	correct?<br>
	I mean, .bank 1 does not start at fffa as for the following .org; with 16KB of Code ROM it always starts at e000, whatever the following .org says. It is this correct?<br>
	Also, it is this instruction (.bank) valid only for the NESASM assembler?<br>
	<br>
	#2. Lines 14-15<br>
	<br>
	The concept of setting up the stack still a bit foggy, any further feedback about it is welcome.<br>
	<br>
	#3. Hex Binary<br>
	<br>
	Starting at c000, the program bytes (except for the fffa-ffff data) end at c045 (with the 16 bytes of header not part of it): why all the other bytes are ff? why not 00? it is this important?<br>
	Also, in the real time emulator hex editor the whole program is there twice, once from 8000 to bfff, and once from c000 to ffff: it is this the way Nes works whit only 16KB of Code ROM instead of 32KB?<br>
	<br>
	Thanks in advance to anyone has a bit of time to give some feedback, I&apos;m interested about it.<br>
	<br>
	I hope my English is understandable, and my questions not too silly. Also, I hope this is the correct thread to post those questions (by the way, how do you format lists in your posts?).<br>
	<br>
	Cheers!<br>
	<br>
	- user<br>
	<br>
	@BunnyBoy (if you read this): interesting writings!</div>
<br>
<br>
1. I believe the .bank system is exclusive to NESASM, even though I&apos;m not really sure about it (I never used any other assembler), but it&apos;s not an Opcode or anything. Actually, what it determines is where an 8KB bank starts. It does not necessarily start at $e000. You can also make it start at $8000, $A000 or $C000.<br>
<br>
2. I believe you don&apos;t have to set up the stack if you don&apos;t plan to use it in your program (like using stack-related instructions such as PHA or PLA). Actually, you do it in order to set up the stack page at $0100-$01FF. Again, I&apos;m not an expert on anything stack-related, so further explanation might be needed.<br>
<br>
3. This just means that there&apos;s no code these addresses. you shouldn&apos;t worry about it
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__336">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 2, 2014 at 4:56:52 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					@Vectrex280996
<br>
<br>Thanks, appreciated.
<br>
<br>&quot;1. I believe the .bank system is exclusive to NESASM, even though I&apos;m not really sure about it (I never used any other assembler), but it&apos;s not an Opcode or anything. Actually, what it determines is where an 8KB bank starts. It does not necessarily start at $e000. You can also make it start at $8000, $A000 or $C000.&quot;
<br>
<br>So .bank 1 followed by .org fffa makes .bank 1 start at fffa, not e000?
<br>I mean the memory ends at ffff: would make more sense to me if .bank 0 starts at c000 and .bank 1 at e000. Just wondering, I&apos;m not claiming to be correct, I&apos;m the ignorant one here! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__337">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 2, 2014 at 6:36:02 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Never mind. The answer was in the next week (week 4) of the tutorial.<br>
<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=6082" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=6082">http://nintendoage.com/forum/mess...</a>
<pre><strong>  .bank 1
  .org $E000</strong>
palette:
  .db $0F,$31,$32,$33,$0F,$35,$36,$37,$0F,$39,$3A,$3B,$0F,$3D,$3E,$0F
  .db $0F,$1C,$15,$14,$0F,$02,$38,$3C,$0F,$1C,$15,$14,$0F,$02,$38,$3C
<strong>  .org $FFFA</strong>     ;first of the three vectors starts here
  .dw NMI        ;when an NMI happens (once per frame if enabled) the
                   ;processor will jump to the label NMI:
  .dw RESET      ;when the processor first turns on or is reset, it will jump
                   ;to the label RESET:
  .dw 0          ;external interrupt IRQ is not used in this tutorial</pre>
It is clear now. Thanks for the help. I thought it was wiser to don&apos;t go ahead in the tutorial before understanding everything, but probably I should do so before asking something already covered in the next week.<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__338">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jun 2, 2014 at 3:33:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	Now, when I switch from the game over game state back to the title screen, the title screen is all 0s. When I look at the Name Table Viewer in FCEUXD, the correct title screen is in $2000 and mirrored to $2800 and the other 2 name tables are all 0s. Now, if I press start again, the game playing state loads just fine and I can play the game again.</div>
When you write the scroll in NMI by using $2005, you should also write $2000 to completely set the scroll. The nametable select bits in $2000 can be interpreted as the 9th bits of x and y scroll offsets, allowing scroll values to have range 0..511 (for x-coordinates) and 0..479 (for y-coordinates).<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__339">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jun 2, 2014 at 3:53:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Mega Mario Man</b></i><br>
		<br>
		Now, when I switch from the game over game state back to the title screen, the title screen is all 0s. When I look at the Name Table Viewer in FCEUXD, the correct title screen is in $2000 and mirrored to $2800 and the other 2 name tables are all 0s. Now, if I press start again, the game playing state loads just fine and I can play the game again.</div>
	When you write the scroll in NMI by using $2005, you should also write $2000 to completely set the scroll. The nametable select bits in $2000 can be interpreted as the 9th bits of x and y scroll offsets, allowing scroll values to have range 0..511 (for x-coordinates) and 0..479 (for y-coordinates).</div>
BOOM! Genius!<br>
<br>
That was the issue. You know, I played with this a long time ago when I started coding. Earlier versions of this game actually have that code in the NMI, but I took it out and it seemed not to effect anything...until now.<br>
<br>
Thanks thefox!<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__340">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jun 3, 2014 at 4:25:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have another little question... How do you make the sprites flicker when there&apos;s more than eight sprites per scanline?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__341">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jun 3, 2014 at 4:35:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Cycle them.  The sprites closer in memory to $0300 (or whatever $0X00 you&apos;re using) get drawn first.  So, you flip-flop the order in which they are drawn every frame.  That means you have to store them in memory in a different page and copy them to your DMA page each frame in your flip-flop order.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__342">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jun 3, 2014 at 4:37:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Bastard thing.
<br>
<br>So you&apos;d just copy them in one frame and reverse them in the next.
<br>
<br>set a variable
<br>if it is 0, straight copy, 1, reverse copy.
<br>
<br>i.e. sprite 0 would go to 0
<br>1 to 1
<br>etc.
<br>63 to 63 in regular order
<br>
<br>i.e. sprite 63 would be copied to 0
<br>62 to 1,
<br>61 to 2
<br>etc.
<br>0 to 63 in the reverse order
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__343">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 4, 2014 at 10:51:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m looking now at NN w6.<br>
<br>
<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8172" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=8172">http://www.nintendoage.com/forum/...</a><br>
<br>
&quot;Nametables<br>
Like the sprites, background images are made up from 8x8 pixel tiles.&#xA0; The screen video resolution is 32x30 tiles, or 256x240 pixels.<br>
<br>
First the screen is divided into a 32x32 pixel grid, or 4x4 tiles.&#xA0; Each byte in the attribute table sets the color group (0-3) in the background palette that will be used in that area.&#xA0; That 4x4 tile area is divided again into 4 2x2 tile grids.&quot;<br>
<br>
Cool. Clear. I guess at least.<br>
<br>
I wonder: it is possible to do this?<br>
(the choice of colors is horrible, sorry about that)
<ul>
	<li>
		The gray box in the middle is the only sprite, and doesn&apos;t move from there.</li>
</ul>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/21264/photobucket/094A196F-951F-52C6-4F9BE6E9EC826B5E.png" show-src="images/missing/094A196F-951F-52C6-4F9BE6E9EC826B5E.png"><br>
<ul>
	<li>
		Going Left:</li>
</ul>
The colored 16 square sections are rotated like this.<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/21264/photobucket/094A1B4D-B4BE-76EB-AA7DE27128653CA7.png" show-src="images/missing/094A1B4D-B4BE-76EB-AA7DE27128653CA7.png">
<ul>
	<li>
		Going Right:</li>
</ul>
The colored 16 square sections are rotated like this.<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/21264/photobucket/094A1D30-0262-6829-315C9290EB42FFA1.png" show-src="images/missing/094A1D30-0262-6829-315C9290EB42FFA1.png"><br>
<ul>
	<li>
		Going Up:</li>
</ul>
Move forward, so the last colored row of 4 32x32 square sections disappear, while the top 3 rows (12 squares) goes down by one, and a new row of four appears on top.<br>
<br>
If you can give me a link to an example of code, that&apos;s fantastic. It doesn&apos;t matter if you have to switch NMI off (or whatever you guys call switching off the screen refresh for few draws to compute things and update the data to display on screen).<br>
<br>
If you can&apos;t give the example, that&apos;s fine: however, if you have time, just tell me if this is at least possible in theory, I&apos;ll work myself the way to do it.<br>
<br>
To whoever can help or give feedback on this,<br>
Thanks, appreciated.<br>
<br>
Cheers!<br>
<br>
edit: misspelling<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__344">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jun 4, 2014 at 2:55:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	Bastard thing.<br>
	<br>
	So you&apos;d just copy them in one frame and reverse them in the next.<br>
	<br>
	set a variable<br>
	if it is 0, straight copy, 1, reverse copy.<br>
	<br>
	i.e. sprite 0 would go to 0<br>
	1 to 1<br>
	etc.<br>
	63 to 63 in regular order<br>
	<br>
	i.e. sprite 63 would be copied to 0<br>
	62 to 1,<br>
	61 to 2<br>
	etc.<br>
	0 to 63 in the reverse order</div>
<br>
I understand what you&apos;re trying to do, but can you show me a code example of how to do it?<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__345">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jun 4, 2014 at 3:03:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
		<br>
		Bastard thing.<br>
		<br>
		So you&apos;d just copy them in one frame and reverse them in the next.<br>
		<br>
		set a variable<br>
		if it is 0, straight copy, 1, reverse copy.<br>
		<br>
		i.e. sprite 0 would go to 0<br>
		1 to 1<br>
		etc.<br>
		63 to 63 in regular order<br>
		<br>
		i.e. sprite 63 would be copied to 0<br>
		62 to 1,<br>
		61 to 2<br>
		etc.<br>
		0 to 63 in the reverse order</div>
	<br>
	I understand what you&apos;re trying to do, but can you show me a code example of how to do it?<br>
	&#xA0;</div>
<br>
Vectrex, MRN just released a new tutorial today with an example. Check it out, it&apos;s pretty good.<br>
<br>
Game Engine Building #8: Sprite Cycling and Attribute Handling<br>
<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=128426" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=128426">http://www.nintendoage.com/forum/...</a><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__346">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jun 4, 2014 at 3:18:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Excellent! Sounds like a fun read! Super Insect Swatter is safe!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__347">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 7, 2014 at 3:48:39 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi all,<br>
<ol>
	<li>
		Anyone has an answer (also generic) to my previous question (see my previous post in this thread)? I think it can be done, I&apos;d like it to be confirmed.</li>
	<li>
		I pretty much finished with NN first part. My code work, I can do things reasonably easily, and all is clear. There is only one thing I still wonder about: all SPRITES are positioned EXACTLY 1PX BELOW (on the Y AXIS) where expected: it is a BUG, or it is just the way Nes position sprites? If a sprite has vertX=$00 horzY=$00, it should be exactly on the top-left corner (in PAL viewing) or 1 pixel below that? I hope my English is understandable. Please, whoever has a couple of minutes to spend, let me know. I paste a code example:</li>
</ol>
<pre>; iNES header
  .inesprg 1   ; 1x 16KB PRGcode
  .ineschr 1   ; 1x  8KB CHRdata
  .inesmap 0   ; mapper 0=NROM
  .inesmir 1   ; background mirroring
; program ROM
  .bank 0      ; 8KB c000-dfff
  .org $c000
reset: sei
      cld
      ldx #$40
      stx $4017    ; disable APU frame IRQ
      ldx #$ff
      txs          ; Set up stack (why?)
      inx          ; x=0
      stx $2000    ; disable NMI
      stx $2001    ; disable rendering
      stx $4010    ; disable DMC IRQs
xBlk: bit $2002    ; wait vblank
      bpl xBlk     ; PPU not ready
      lda #$00
xMem: sta $0000, x
      sta $0100, x
      sta $0200, x
      sta $0400, x
      sta $0500, x
      sta $0600, x
      sta $0700, x
      lda #$fe
      sta $0300, x ; !OutOfScreen
      inx
      bne xMem
yBlk: bit $2002    ; wait vblank
      bpl yBlk     ; PPU not ready
      lda $2002    ; read PPU status to reset
      lda #$3F     ;    ...the high/low latch
      sta $2006    ; write the high byte of
      lda #$00     ;    ...$3F00 address
      sta $2006    ; write the low byte of
      ldx #$00     ;    ...$3F00 address
xPal: lda pal, x   ; load palette byte
      sta $2007    ; write to PPU
      inx          ; set index to next byte
      cpx #$20
      bne xPal     ; if x=$20 32b copied, done
      ldx #$00     ; start at 0
xSpr: lda spr, x   ; load data from address (spr + x)
      sta $0200, x ; store into RAM address ($0200 + x)
      inx          ; x=x+1
      cpx #$20     ; Compare X to hex $20, decimal 32
      bne xSpr     ; Loop if compare Not Equal zero
      lda $2002    ; read PPU status to reset
      lda #$20     ;    ...the high/low latch
      sta $2006    ; write the high byte of
      lda #$00     ;    ...$2000 address
      sta $2006    ; write the low byte of...
      ldx #$00     ;    ...$2000 address
xBkg: lda bkg, x   ; load data from address (bkg + x)
      sta $2007    ; write to PPU
      inx          ; x=x+1
      cpx #$80     ; Compare X to hex $80, decimal 128
      bne xBkg     ; Loop if compare Not Equal zero
      lda $2002    ; read PPU status to reset
      lda #$23     ;    ...the high/low latch
      sta $2006    ; write the high byte of
      lda #$C0     ;    ...$23C0 address
      sta $2006    ; write the low byte of
      ldx #$00     ;    ...$23C0 address
xAtr: lda atr, x   ; load data from address (atr + x)
      sta $2007    ; write to PPU
      inx          ; x=x+1
      cpx #$08     ; Compare X to hex $08, decimal 8
      bne xAtr     ; Loop if compare Not Equal zero
      lda #$00     ; no background scrolling
      sta $2005
      sta $2005
      lda #%10010000 ; enable NMI, spr Tb0, bkg Tb1
      sta $2000
      lda #%00011110 ; enable spr+bkg, no clipping left
      sta $2001
loop: jmp loop     ; loop<br><br>nmi: lda #$00
     sta $2003     ; set the low byte (00)
                   ; ...of the RAM address
     lda #$02
     sta $4014     ; set the high byte (02)
                   ; ...of the RAM address,
                   ; ...start the transfer
     LDA #$01
     STA $4016
     LDA #$00
     STA $4016     ; both controllers latch buttons
xA:  LDA $4016       ; player 1 - A
     AND #%00000001  ; only look at bit 0
     BEQ xB          ; xB if button is NOT pressed (0)
xB:  LDA $4016       ; player 1 - B
     AND #%00000001  ; only look at bit 0
     BEQ xS          ; xS if button is NOT pressed (0)
xS:  LDA $4016       ; player 1 - Select
     AND #%00000001  ; only look at bit 0
     BEQ xX          ; xX if button is NOT pressed (0)
xX:  LDA $4016       ; player 1 - Start
     AND #%00000001  ; only look at bit 0
     BEQ xU          ; xU if button is NOT pressed (0)
xU:  LDA $4016       ; player 1 - Up
     AND #%00000001  ; only look at bit 0
     BEQ xD          ; xD if button is NOT pressed (0)
     LDA $0200       ; load sprite Y position
     SEC             ; make sure carry flag is set
     SBC #$01        ; A = A - 1
     STA $0200       ; save sprite Y position
xD:  LDA $4016       ; player 1 - Down
     AND #%00000001  ; only look at bit 0
     BEQ xL          ; xD if button is NOT pressed (0)
     LDA $0200       ; load sprite Y position
     CLC             ; make sure the carry flag is clear
     ADC #$01        ; A = A + 1
     STA $0200       ; save sprite Y position
xL:  LDA $4016       ; player 1 - Left
     AND #%00000001  ; only look at bit 0
     BEQ xR          ; xR if button is NOT pressed (0)
     LDA $0203       ; load sprite X position
     SEC             ; make sure carry flag is set
     SBC #$01        ; A = A - 1
     STA $0203       ; save sprite X position
xR:  LDA $4016       ; player 1 - Right
     AND #%00000001  ; only look at bit 0
     BEQ xGph        ; xDrw if button is NOT pressed (0)
     LDA $0203       ; load sprite X position
     CLC             ; make sure the carry flag is clear
     ADC #$01        ; A = A + 1
     STA $0203       ; save sprite X position
xGph: lda #$00       ; no background scrolling
      sta $2005
      sta $2005
      lda #%10010000 ; enable NMI, spr Tb0, bkg Tb1
      sta $2000
      lda #%00011110 ; enable spr+bkg, no clipping left
      sta $2001
      rti            ; return from interrupt<br><br>  .bank 1            ; data
  .org $e000
pal: .db $0E,$26,$06,$38,$0E,$26,$16,$38,$0E,$16,$06,$28,$0E,$13,$03,$28 ;bkg
     .db $0E,$26,$06,$38,$0E,$26,$16,$38,$0E,$16,$06,$28,$0E,$13,$03,$28 ;spr
spr: ;vert tile attr horiz
  .db <strong>$00</strong>, $01, $00, <strong>$00</strong>   ;sprite 0
  .db <strong>$00</strong>, $02, $01, $08   ;sprite 1
  .db <strong>$00</strong>, $03, $02, $10   ;sprite 2
  .db <strong>$00</strong>, $04, $03, $18   ;sprite 3
bkg: .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 ;1
     .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
     .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 ;2
     .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
     .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 ;3
     .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
     .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 ;4
     .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
atr: .db %00000000,%00000000,%00000000,%00000000,%00000000,%00000000,%00000000,%00000000<br><br>  .org $fffa         ; vectors
  .dw nmi, reset, 0  ; 2byte NMI,reset,IRQ<br><br>  .bank 2            ; chr
  .org $0000
  .incbin &quot;gph.chr&quot;  ; 8KB graphics
</pre>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__348">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jun 7, 2014 at 5:05:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<ol>
		<li>
			There is only one thing I still wonder about: all SPRITES are positioned EXACTLY 1PX BELOW (on the Y AXIS) where expected: it is a BUG, or it is just the way Nes position sprites? If a sprite has vertX=$00 horzY=$00, it should be exactly on the top-left corner (in PAL viewing) or 1 pixel below that?</li>
	</ol>
</div>
This is just the way NES PPU works. If you use y-coordinate &quot;0&quot;, the sprite will start from the 2nd scanline from top. So you can&apos;t place sprites on the very first scanline.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__349">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 7, 2014 at 6:25:03 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	This is just the way NES PPU works. If you use y-coordinate &quot;0&quot;, the sprite will start from the 2nd scanline from top. So you can&apos;t place sprites on the very first scanline.</div>
And so to position a sprite exactly anywhere else you use posY-1. Good to know. Thanks, appreciated! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Any chance someone could confirm also that #1 from post above is doable in the nmi piece of code above?<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__350">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 8, 2014 at 3:26:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	Any chance someone could confirm also that #1 from post above is doable</div>
Never mind. Task already solved in another way (if interested: <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=128599" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=128599">link</a> post #4).<br>
<br>
Cheers.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__351">
                                                        <div class="mdl-card__title"><strong>Jazzmarazz</strong> posted on 
		
			
				
				Jun 23, 2014 at 4:33:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am using RGDBS to compile my gameboy ASM programs and need help with a few sound registers. I couldn&apos;t find anyplace else to ask so,<br>
<br>
The names are used from the &quot;Everything You wanted to KNow about Gameboy&quot; document.<br>
<br>
<u>question 1.</u><br>
<br>
$FF19 - NR 24 - AUD2HIGH<br>
<br>
Bit 6 - Counter/Consecutive selection<br>
<br>
If this bit is reset, will the sound sustain and when this bit is set, will the sound play for as long as is set in AUD2LEN, bits 5-0?<br>
<br>
[u]question 2.[/u]<br>
<br>
$FF1C - NR 32 - AUD3LEVEL<br>
<br>
This register states that the Wave Pattern RAM is located from $FF30 - $FF3F and I understand that the volume is set here. How is wave patter RAM processed though? Are all 32 bits played sequentially, 4-bits at a time?<br>
<br>
<u>question 3.&#xA0;</u><br>
<br>
$FF17 - NR 22 - AUD2ENV<br>
<br>
Bit 3 - Attenuate/Amplify<br>
<br>
Does this mean that I may not Amplify and then Attenuate? Only one at a time? Is there an easy way to use the sound length data of a channel to toggle an attack and then decay once the sound completes?<br>
<br>
<u>question 4.&#xA0;</u><br>
<br>
$FF22 - NR 43 - AUD4POLY<br>
<br>
I don&apos;t get this register in the least. What is going on? Here is the full description:<br>
<br>
Contents - Sound Mode 4 register, polynomial counter (R/W)<br>
<br>
Bit 7-4 - Selection of the shift clock frequency of the<br>
polynomial counter<br>
Bit 3 - Selection of the polynomial counter&apos;s step<br>
Bit 2-0 - Selection of the dividing ratio of frequencies<br>
<br>
Selection of the dividing ratio of frequencies:<br>
000: f * 1/2^3 * 2<br>
001: f * 1/2^3 * 1<br>
010: f * 1/2^3 * 1/2<br>
011: f * 1/2^3 * 1/3<br>
100: f * 1/2^3 * 1/4<br>
101: f * 1/2^3 * 1/5<br>
110: f * 1/2^3 * 1/6<br>
111: f * 1/2^3 * 1/7 f = 4.194304 Mhz<br>
<br>
Selection of the polynomial counter step:<br>
0: 15 steps<br>
1: 7 steps<br>
<br>
Selection of the shift clock frequency of the polynomial<br>
counter:<br>
<br>
0000: dividing ratio of frequencies * 1/2<br>
0001: dividing ratio of frequencies * 1/2^2<br>
0010: dividing ratio of frequencies * 1/2^3<br>
0011: dividing ratio of frequencies * 1/2^4<br>
: :<br>
: :<br>
: :<br>
0101: dividing ratio of frequencies * 1/2^14<br>
1110: prohibited code<br>
1111: prohibited code
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__352">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jul 1, 2014 at 12:17:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Simple Save Game Advice.<br>
<br>
I have the MMC1 up and running, with the iNES header set to 2 for battery backed WRAM. No file is created when the ROM is loaded, as BunnyBoy said would be the case in certain emulators (Advanced NN #3), but it seems that things are working (at least they are no longer crashing). My question is in regards to how to create a simple save condition. Let&apos;s say that I wanted a button or event (such as a text box option) to create a save file, recording the hero&apos;s location on the screen and the information for the current screen. How would this be accomplished? I can see several ways to go, but before I get too far down the wrong road I figured that I&apos;d ask for thoughts and opinions. Hopefully I&apos;m not over thinking this one,&#xA0;although maybe I&apos;m under thinking it,&#xA0;but who knows...<br>
<br>
Also, as things get more complex in regards to saving (weapons, events, character attributes like health, etc.), what additional things need to be thought about ahead of time? I assume that an answer to the question above will point me in the right direction, but did not know if there was any additional advice once things get more complex.<br>
<br>
Thanks for any help!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__353">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jul 1, 2014 at 3:30:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve never messed with saving, but I did write a nasty password feature with multiple encryption sequences for BAN. <span class="sprites_emoticons absmiddle" id="emo_smile"></span> So take this with a grain of salt.<br>
<br>
I&apos;d imagine that you need to write code that saves variables in a certain way and then a decode routine that restores the things you want to save. For example, for your room location, push A, it writes the room coords to the save WRAM. Same with the weapons, events, health, ammo, etc. Just make a routine that checks the status of each &quot;save bank&quot; and writes the data to the appropriate place in RAM to &quot;load the saved data&quot;. It&apos;s not really complicated.<br>
<br>
For BAN, it records the encryption routine number, level, score, lives, etc. and mixes them all up so it spits out the password that has yet to be broken.<br>
<br>
Then, when you enter a password, it reads the encryption routine number, and re-writes all the relevant data to their places in RAM, runs the room load routine, and starts you on level X with Y lives, etc.<br>
<br>
Pretty straightforward and not too difficult to add to if you need to include something new.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__354">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 1, 2014 at 4:43:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	Simple Save Game Advice.<br>
	<br>
	I have the MMC1 up and running, with the iNES header set to 2 for battery backed WRAM. No file is created when the ROM is loaded, as BunnyBoy said would be the case in certain emulators (Advanced NN #3), but it seems that things are working (at least they are no longer crashing). My question is in regards to how to create a simple save condition. Let&apos;s say that I wanted a button or event (such as a text box option) to create a save file, recording the hero&apos;s location on the screen and the information for the current screen. How would this be accomplished? I can see several ways to go, but before I get too far down the wrong road I figured that I&apos;d ask for thoughts and opinions. Hopefully I&apos;m not over thinking this one,&#xA0;although maybe I&apos;m under thinking it,&#xA0;but who knows...<br>
	<br>
	Also, as things get more complex in regards to saving (weapons, events, character attributes like health, etc.), what additional things need to be thought about ahead of time? I assume that an answer to the question above will point me in the right direction, but did not know if there was any additional advice once things get more complex.<br>
	<br>
	Thanks for any help!</div>
<br>
Is there a save file when you close the ROM after playing it?<br>
<br>
Might be in the sav folder inside the emulator folder, also.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__355">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jul 2, 2014 at 2:43:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Speaking of MMC1...
<br>
<br>I tried to make it run too, however, it doesn&apos;t. The CHR/palettes appear fine in FCEUX, however, there should be a background tile on the screen, and there isn&apos;t.
<br>Anyone knows what I forgot to do/did wrong?
<br>
<br><a href="http://pastebin.com/tRUZR7Eu" target="_blank" original-href="http://pastebin.com/tRUZR7Eu">http://pastebin.com/tRUZR7Eu...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__356">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jul 2, 2014 at 2:48:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You have an RTS after your pallet loop.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__357">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jul 2, 2014 at 2:51:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That&apos;ll teach me to copy/paste subroutines T_T
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__358">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jul 2, 2014 at 8:35:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					EDIT: Apparently the problem is that NEStopia is retarded and thinks there is more than 8 sprites on the scanline (But there&apos;s only 8 of them). Do you know what causes this problem?<br>
<br>
Now I have another little problem with the program. It runs as it should in FCEUX (the pic is correctly displayed), but on NEStopia, there are some sprites missing for some reason (sprites 6, 7, 36 and 37).<br>
Here&apos;s the metasprite building SR<br>
<br>
Increase_Four: ;Increments X by four<br>
INX<br>
INX<br>
INX<br>
INX<br>
RTS<br>
<br>
Huge_Metasprite:<br>
LDX #$00<br>
LDY #$00<br>
LDA $0200 ;First the Y position of the sprites<br>
YPos_Loop:<br>
STA $0200,x<br>
STA $0204,x<br>
STA $0208,x<br>
STA $020C,x<br>
STA $0210,x ;64x64 metasprite<br>
STA $0214,x<br>
STA $0218,x<br>
STA $021C,x<br>
CLC<br>
ADC #$08<br>
JSR Increase_Four<br>
JSR Increase_Four<br>
JSR Increase_Four<br>
JSR Increase_Four<br>
JSR Increase_Four ;Kind of an overkill, but it increases the X reg by 32<br>
JSR Increase_Four<br>
JSR Increase_Four<br>
JSR Increase_Four<br>
INY<br>
CPY #$08<br>
BNE YPos_Loop ;8 loops of this, then we can proceed<br>
LDX #$00<br>
LDY #$00<br>
LDA $0203 ;And now we&apos;re doing the X position<br>
XPos_Loop:<br>
STA $0203,x<br>
STA $0223,x<br>
STA $0243,x<br>
STA $0263,x<br>
STA $0283,x ;Kind of the same thing, but this time, it&apos;s vertical<br>
STA $02A3,x<br>
STA $02C3,x<br>
STA $02E3,x<br>
CLC<br>
ADC #$08<br>
JSR Increase_Four ;This also means less subroutines<br>
INY<br>
CPY #$08<br>
BNE XPos_Loop<br>
LDX #$00<br>
LDY #$00<br>
LDA $0201<br>
CHR_Loop:<br>
CLC<br>
STA $0201,x<br>
ADC #$01<br>
STA $0205,x<br>
ADC #$01<br>
STA $0209,x<br>
ADC #$01<br>
STA $020D,x<br>
ADC #$01<br>
STA $0211,x ;This assembles the CHR image (00,01,02,03,04,05,06,07 then 10,11,12,13,14,15,16,17 etc.)<br>
ADC #$01<br>
STA $0215,x<br>
ADC #$01<br>
STA $0219,x<br>
ADC #$01<br>
STA $021D,x<br>
INY<br>
JSR Increase_Four<br>
JSR Increase_Four<br>
JSR Increase_Four<br>
JSR Increase_Four<br>
JSR Increase_Four<br>
JSR Increase_Four<br>
JSR Increase_Four<br>
JSR Increase_Four<br>
CLC<br>
ADC #$09<br>
CPY #$08<br>
BNE CHR_Loop<br>
LDX #$00<br>
LDA #$00<br>
AttriSpr_Loop:<br>
STA $0202,x<br>
JSR Increase_Four ;Only one attribute is used<br>
CPX #$02<br>
BNE AttriSpr_Loop<br>
<br>
RTS
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__359">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Jul 7, 2014 at 1:46:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m not really sure, but could it have something to do with this portion?:
<br>
<br>CLC
<br>ADC #$09
<br>CPY #$08
<br>BNE CHR_Loop
<br>
<br>I&apos;ve never really done a CPY without the INY or DEY right before it, so I don&apos;t know if that would mess with anything. I also noticed that it&apos;s an ADC #$09, while it seems to be 8 for the others? I haven&apos;t looked super hard at the code though so 9 might be what you need to do there.
<br>
<br>As an aside, the parts that you do the multiple JSRs would benefit greatly by just doing this instead:
<br>
<br>	pha
<br>	txa
<br>	clc
<br>	adc #$20
<br>	tax
<br>	pla
<br>
<br>Every JSR builds at 3 bytes apiece. So with every time you place that down 8 times, you are building 24 bytes into ROM when just doing the snippet above will build at 7 bytes. Just something to think about!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__360">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 7, 2014 at 2:10:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					LDX #$00
<br>LDY #$00
<br>LDA $0201
<br>CHR_Loop:
<br>CLC
<br>STA $0201,x
<br>ADC #$01
<br>STA $0205,x
<br>ADC #$01
<br>STA $0209,x
<br>ADC #$01
<br>STA $020D,x
<br>ADC #$01
<br>STA $0211,x ;This assembles the CHR image (00,01,02,03,04,05,06,07 then 10,11,12,13,14,15,16,17 etc.)
<br>ADC #$01
<br>STA $0215,x
<br>ADC #$01
<br>STA $0219,x
<br>ADC #$01
<br>STA $021D,x
<br>
<br>This part looks weird to me.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__361">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jul 8, 2014 at 12:45:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Roth</b></i><br>
	<br>
	I&apos;m not really sure, but could it have something to do with this portion?:<br>
	<br>
	CLC<br>
	ADC #$09<br>
	CPY #$08<br>
	BNE CHR_Loop<br>
	<br>
	I&apos;ve never really done a CPY without the INY or DEY right before it, so I don&apos;t know if that would mess with anything. I also noticed that it&apos;s an ADC #$09, while it seems to be 8 for the others? I haven&apos;t looked super hard at the code though so 9 might be what you need to do there.<br>
	<br>
	As an aside, the parts that you do the multiple JSRs would benefit greatly by just doing this instead:<br>
	<br>
	pha<br>
	txa<br>
	clc<br>
	adc #$20<br>
	tax<br>
	pla<br>
	<br>
	Every JSR builds at 3 bytes apiece. So with every time you place that down 8 times, you are building 24 bytes into ROM when just doing the snippet above will build at 7 bytes. Just something to think about!</div>
Interesting... Could you tell me more about PHA and PLA? Seems like these could help me in my games...<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__362">
                                                        <div class="mdl-card__title"><strong>rizz</strong> posted on 
		
			
				
				Jul 8, 2014 at 1:49:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	LDX #$00<br>
	LDA #$00<br>
	AttriSpr_Loop:<br>
	STA $0202,x<br>
	JSR Increase_Four ;Only one attribute is used<br>
	CPX #$02<br>
	BNE AttriSpr_Loop<br>
	<br>
	RTS</div>
<br>
At a glance, it looks like CPX #$02 would cause an endless loop.&#xA0; It&apos;s initialized with 0, and then would go to 4,8,12, etc.&#xA0; Eventually it would get to 248, 252, and then loop back to 0, 4, 8, etc.<br>
<br>
PHA &amp; PLA are for setting aside the current value in the accumulator (usually because you are going to use it for something else), and then getting the previous accumulator value back in there.&#xA0; You could use a byte in RAM to store the accumulator temporarily too, but that would use up a valuable byte (the PHA &amp; PLA make use of the Stack).<br>
<br>
I have found it very useful to use PHA &amp; PLA when I&apos;m entering and exiting subroutines, but I use it more for X &amp; Y register safety.&#xA0; Example:<br>
<br>
&#xA0; LDX #0<br>
&#xA0; Loop1:<br>
&#xA0; JSR Subroutine1<br>
&#xA0; INX<br>
&#xA0; CPX #4<br>
&#xA0; BNE Loop1<br>
&#xA0;<br>
Subroutine1:<br>
&#xA0; TXA<br>
&#xA0; PHA<br>
&#xA0; lines of code that make use of the X register<br>
&#xA0; PLA<br>
&#xA0; TAX<br>
&#xA0; RTS<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__363">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Jul 8, 2014 at 8:32:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	Interesting... Could you tell me more about PHA and PLA? Seems like these could help me in my games...</div>
<br>
Pretty much was Rizz said! They can be used for other things too, like speedy writes to the background. You can do something like push multiple bytes from a table onto the stack and then in NMI pull them all and store them in $2007 so that you can get more done during NMI if you need a lot of background tiles changed. If I remember correctly, Battletoads makes heavy use of this technique. Something like:<br>
<br>
; in ROM<br>
table:<br>
.byte $00,$0a,$34,$99 ; etc etc<br>
<br>
; in the main loop<br>
ldx #$00<br>
@looper:<br>
lda table, x<br>
pha<br>
inx<br>
cpx #$04 ; whatever the amount of bytes in the table are<br>
bne @looper<br>
<br>
; in nmi<br>
<br>
lda #$20 &#xA0; &#xA0; ; whatever the proper bg address you need to write to is<br>
sta $2006<br>
lda #$00<br>
sta $2006<br>
pla<br>
sta $2007<br>
pla<br>
sta $2007<br>
pla<br>
sta $2007<br>
pla<br>
sta $2007<br>
; etc etc<br>
<br>
I haven&apos;t personally used this, but I have used zeropage to do the same thing. It&apos;s also used at the beginning and end of NMI, which I think you may have already seen before:<br>
<br>
pha<br>
txa<br>
pha<br>
tya<br>
pha<br>
<br>
; all nmi code<br>
<br>
pla<br>
tay<br>
pla<br>
tax<br>
pla<br>
rti<br>
<br>
That just saves all the registers in case your loop happens to take too long. But still, my main use of it is exactly what Rizz said in the first place : )<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__364">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jul 9, 2014 at 3:43:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank you both, Roth and Rizz!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__365">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jul 12, 2014 at 9:45:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	<br>
	Is there a save file when you close the ROM after playing it?<br>
	<br>
	Might be in the sav folder inside the emulator folder, also.<br>
	&#xA0;</div>
<br>
Just got back to this. Thanks Kevin. Save file was definitely in the emulator folder, along with all of the different versions that I had marked as failed tests. Live and learn.<br>
<br>
<br>
<strike>Another question (for anyone), when making a grid, what is a good way to go about doing so? Something like a name entry grid with the alphabet, for instance. I&apos;ve done a smaller one for weapons (2x4 locations), but I have a feeling that the branch addresses will be out of range for a larger selection process. I&apos;m guessing that the solution lies in some form of lookup (pointer?) table, but I&apos;m pretty fuzzy on how these work for something like background locations (well, pretty much for anything to be honest). I&apos;ve looked at Metal Slime&apos;s music tutorials some, but haven&apos;t been able to translate it to my current problem. Any thoughts or advice?<br>
<br>
EDIT: BunnyBoy may have already provided an answer to at least a portion of my question a few weeks ago regarding branch addresses being out of range. Still not sure if I&apos;m doing a grid in the best way possible though.<br>
<br>
DOUBLE EDIT: Even with jumps, it only made it to F before spitting back branch address out of range. I had a feeling 500+ lines of code might have been a bit much for it to see down...<br>
<br>
TRIPLE EDIT: Not sure how yet, but I might have figured it out! The cursor grid is working, even if all of the letters do not register (A-F I understand, but not really sure why &#xA0;W-d work <span class="sprites_emoticons absmiddle" id="emo_smile"></span>). Woohoo</strike>!<br>
<br>
Branch address out of range due to accidentally using a O instead of an 0. One more question that has solved itself...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__366">
                                                        <div class="mdl-card__title"><strong>Godfather</strong> posted on 
		
			
				
				Jul 16, 2014 at 12:35:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Question: How is it legal? When someone creates a remake of super mario or castlevania and sells them?<br>
<br>
I think it&apos;s awesome but how do these programmers get away with it?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__367">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Jul 16, 2014 at 2:11:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This thread is about programming original games, which is 100% legal. &quot;Programming&quot; an ee-prom (remakes of Mario, Castlevania as per your example) is not the same thing as &quot;programming&quot; a new homebrew game. I can&apos;t personally comment on the legality of repros because I do not make them nor collect them.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__368">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jul 16, 2014 at 3:09:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There are plenty of threads elsewhere on this topic (let&apos;s not clog this one up <span class="sprites_emoticons absmiddle" id="emo_smile"></span>). Most end in stalemates between two polar views, with a range of opinions in between. Discussion can be helpful, but for most I&apos;d guess that it goes nowhere.<br>
<br>
Oh, and welcome to the forums! A good question to ask, just one that has been beaten like a dead horse.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__369">
                                                        <div class="mdl-card__title"><strong>Godfather</strong> posted on 
		
			
				
				Jul 17, 2014 at 1:39:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	There are plenty of threads elsewhere on this topic (let&apos;s not clog this one up ). Most end in stalemates between two polar views, with a range of opinions in between. Discussion can be helpful, but for most I&apos;d guess that it goes nowhere.<br>
	<br>
	Oh, and welcome to the forums! A good question to ask, just one that has been beaten like a dead horse.</div>
<br>
<br>
Could you kindly direct me to one as I did the search and could not find one. Being that are plenty of threads on this topic pointing me to one would be much appreciative
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__370">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jul 17, 2014 at 2:28:59 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Godfather</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
		<br>
		There are plenty of threads elsewhere on this topic (let&apos;s not clog this one up ). Most end in stalemates between two polar views, with a range of opinions in between. Discussion can be helpful, but for most I&apos;d guess that it goes nowhere.<br>
		<br>
		Oh, and welcome to the forums! A good question to ask, just one that has been beaten like a dead horse.</div>
	<br>
	<br>
	Could you kindly direct me to one as I did the search and could not find one. Being that are plenty of threads on this topic pointing me to one would be much appreciative</div>
<br>
Yeah, sorry about that, I should have included some links. Here is one that doesn&apos;t end in name calling and what not: <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=7&amp;threadid=41096" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=7&amp;threadid=41096">http://www.nintendoage.com/forum/...</a>. It gets at the legal issues a bit better than most. I&apos;ll look for a couple of more decent ones, but on the whole they tend to go sour pretty quick, and do not always bring out the best in people.<br>
<br>
The search function for &quot;repros legal&quot; tends to get quite a few decent results, but it does take some sifting.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__371">
                                                        <div class="mdl-card__title"><strong>kiljo</strong> posted on 
		
			
				
				Jul 20, 2014 at 5:06:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	Or &quot;I really want my sprite to collide with the background and stop.&#xA0; What&apos;s the best way to go about this?&quot;</div>
<br>
Sorry if this has been asked and answered, but from reading the first ~100 posts I did not see it.&#xA0; I would like my character sprite guy to interact with my background and I have an idea of how to do it, but it does not seem like a good idea.<br>
<br>
Currently, I have a sprite that can move around, jump and duck (I achieved this by using the first 4 weeks of tutorials from KHAN). I put a crate on the ground in my background and would like to make my character stop moving when they run into it. Additionally, I would like them to be able to jump on top of it and not fall through it.<br>
<br>
My idea is to gather locations that represent the size of my character (I would have a box that defines the space he takes up) and track that with his movements. Then create a space where my crate is and prevent my character from going there (this is how I got Pong working in nerdy nights). But it seems to me that if my game gets more complicated, I would have to have a bunch of lines just checking if I am colliding with any user defined background objects.<br>
<br>
Is there a better for my character to interact with the background?<br>
Also, when I jump and land at a different elevation I get some problems... I currently have my character jump and land at the same elevation (this is all defined in the jumping subroutine). Should I instead have constants defining my background as &#x201C;solid&#x201D; (i.e. don&#x2019;t let my character go past this value) and just have him land when he hits the &#x201C;solid&#x201D; part of the background? If I did things that way, I would probably need to implement a gravity that is constantly happening instead of having my character fall as part of my jumping subroutine.<br>
<br>
Hopefully that all sounds right, I did some talking out loud so that if things are terribly wrong someone can let me know (or watch me suffer). I would appreciate any advise or insight into a better way of interacting with my background.<br>
<br>
Thanks,<br>
<br>
kiljo<span "display: none;">&#xA0;</span><br type="_moz">
<div id="cke_pastebin" "left: -1000px; top: 10.44px; width: 1px; height: overflow: hidden; position: absolute;">
	&#xA0;</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__372">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 20, 2014 at 5:38:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>kiljo</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>KHAN Games</b></i><br>
		<br>
		Or &quot;I really want my sprite to collide with the background and stop.&#xA0; What&apos;s the best way to go about this?&quot;</div>
	<br>
	Sorry if this has been asked and answered, but from reading the first ~100 posts I did not see it.&#xA0; I would like my character sprite guy to interact with my background and I have an idea of how to do it, but it does not seem like a good idea.<br>
	<br>
	Currently, I have a sprite that can move around, jump and duck (I achieved this by using the first 4 weeks of tutorials from KHAN). I put a crate on the ground in my background and would like to make my character stop moving when they run into it. Additionally, I would like them to be able to jump on top of it and not fall through it.<br>
	<br>
	My idea is to gather locations that represent the size of my character (I would have a box that defines the space he takes up) and track that with his movements. Then create a space where my crate is and prevent my character from going there (this is how I got Pong working in nerdy nights). But it seems to me that if my game gets more complicated, I would have to have a bunch of lines just checking if I am colliding with any user defined background objects.<br>
	<br>
	Is there a better for my character to interact with the background?<br>
	Also, when I jump and land at a different elevation I get some problems... I currently have my character jump and land at the same elevation (this is all defined in the jumping subroutine). Should I instead have constants defining my background as &#x201C;solid&#x201D; (i.e. don&#x2019;t let my character go past this value) and just have him land when he hits the &#x201C;solid&#x201D; part of the background? If I did things that way, I would probably need to implement a gravity that is constantly happening instead of having my character fall as part of my jumping subroutine.<br>
	<br>
	Hopefully that all sounds right, I did some talking out loud so that if things are terribly wrong someone can let me know (or watch me suffer). I would appreciate any advise or insight into a better way of interacting with my background.<br>
	<br>
	Thanks,<br>
	<br>
	kiljo<span display:>&#xA0;</span><br>
	<div height: id="cke_pastebin" left: overflow: position: top: width:>
		&#xA0;</div>
</div>
<br>
Is your name really Kevin H too?&#xA0; Haha.&#xA0; Weird!<br>
<br>
Anyway, I made a Week 5 lesson dedicated to background collision. <span class="sprites_emoticons absmiddle" id="emo_smile"></span> I&apos;ll upload it now.&#xA0; It&apos;s more geared toward overhead collision, so I&apos;m not sure how well it will work in a platformer scenario, but at least you will kind of get the idea;<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__373">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 3, 2014 at 8:41:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hmm, not really sure what is going on with this, but here goes. I&apos;ve got saves up and running, for the most part, but have a small problem. The program seems to only be reading the first 15 .rs spaces (bytes?) at $6000. I&apos;ve moved things around in terms of order, and this seems to be what is going on (i.e. if things are switched around, different things save, etc.). Is this normal? Any thoughts?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__374">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Aug 4, 2014 at 12:36:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	Hmm, not really sure what is going on with this, but here goes. I&apos;ve got saves up and running, for the most part, but have a small problem. The program seems to only be reading the first 15 .rs spaces (bytes?) at $6000. I&apos;ve moved things around in terms of order, and this seems to be what is going on (i.e. if things are switched around, different things save, etc.). Is this normal? Any thoughts?</div>
Not normal. The entire 8 KB at $6000..7FFF is saved.<br>
<br>
Here&apos;s my suggestion: open up the Hex Editor in FCEUX to see what&apos;s actually at $6000..7FFF. Then close the emulator and FCEUX should save the contents into a .SAV file somewhere (for me it&apos;s &quot;C:\Program Files (x86)\fceux\sav&quot;). Open the save file in an (external) hex editor like HxD and verify that the contents are what they should be. Play around with your code and hex editors until you can make sense of what&apos;s wrong in your program.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__375">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 4, 2014 at 6:39:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
		<br>
		Hmm, not really sure what is going on with this, but here goes. I&apos;ve got saves up and running, for the most part, but have a small problem. The program seems to only be reading the first 15 .rs spaces (bytes?) at $6000. I&apos;ve moved things around in terms of order, and this seems to be what is going on (i.e. if things are switched around, different things save, etc.). Is this normal? Any thoughts?</div>
	Not normal. The entire 8 KB at $6000..7FFF is saved.<br>
	<br>
	Here&apos;s my suggestion: open up the Hex Editor in FCEUX to see what&apos;s actually at $6000..7FFF. Then close the emulator and FCEUX should save the contents into a .SAV file somewhere (for me it&apos;s &quot;C:\Program Files (x86)\fceux\sav&quot;). Open the save file in an (external) hex editor like HxD and verify that the contents are what they should be. Play around with your code and hex editors until you can make sense of what&apos;s wrong in your program.<br>
	<br>
	&#xA0;</div>
<br>
The contents are what they should be, for the first 15 locations at the $6000 range at least, but then beginning on space 16 there are only zeroes for the rest of the $6000 block. If I write new values to what should be at these locations in the program itself (i.e. registering a name in one of the spots that it is writing a string of whatever happens to be at the #$00 address in my CHR file), then things change as they should. When power is pulled, however, they change back to zeroes.<br>
<br>
EDIT: Might have figured it out. I&apos;ll update once I try a few more things.<br>
<br>
ANSWER (in case it helps anybody out in the future): I was running the wrong value prior to setting up the MMC1 (equivalent to Bunny&apos;s ConfigWrite in his MMC1 tutorial). Still not sure if I understand the whole process all the way, but in place of running #%01101111 I was running #%00001111, which is how I ended up with 15 (or %1111). I think anyways. Regardless, it all works now. Check off one more fictitious problem for me <span class="sprites_emoticons absmiddle" id="emo_smile"></span>, and thanks for your help Kalle!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__376">
                                                        <div class="mdl-card__title"><strong>MadnessVX</strong> posted on 
		
			
				
				Aug 10, 2014 at 3:08:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have a quick question for anyone using MetalSlime&apos;s sound engine. Is there a way to silence the noise channel other than setting a volume envelope with $00? 
<br>
<br>Say if I were using quarter notes and I want 2 drum beats, then silent for a quarter note, then one more drum beat. The only way I seem to achieve that is using opcodes to set a different volume envelope for that one time signature, then restore it to what it was before.
<br>
<br>This would be fine, but it seems a bit of a waste of space. Also it seems in both of the sound modes for noise, there is not &quot;off&quot; $00 and $10 still plays a slight noise. 
<br>
<br>Thanks in advance!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__377">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Aug 12, 2014 at 5:13:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I had to modify the sound engine pretty heavily to make it do all the stuff with the noise channel that I wanted, resting being one of those issues.  But you can make it support rests, VE, PE, etc. pretty easily.  Basically, just set it to run a different routine on the noise channel and change MetalSlime&apos;s routines around a bit to account for the difference in noise data vs. note data.  You can make some bad ass effects with PE on noise.  
<br>
<br>Specifically, you can disable the noise channel just like the others.  I just don&apos;t think that he made it that far before he stopped the tutorials.  Might be as simple as adding &quot;JSR se_check_rest&quot; to the end of the &quot;se_do_noise&quot; routine.  Can&apos;t remember exactly.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__378">
                                                        <div class="mdl-card__title"><strong>MadnessVX</strong> posted on 
		
			
				
				Aug 12, 2014 at 7:55:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the reply!
<br>
<br>Yeah after looking through the tuts a few times I had a feeling I had to add more to the engine. I was just hoping it was something stupid simple that I was overlooking.(like simply writing a value to the noise channel as I previously talked about) I still don&apos;t 100% understand his engine, but I&apos;m getting the hang of things. Its immensely satisfying having sound working. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>Thanks again!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__379">
                                                        <div class="mdl-card__title"><strong>Jazzmarazz</strong> posted on 
		
			
				
				Aug 12, 2014 at 8:11:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I don&apos;t know about NES but on the gameboy, setting volume to 0 on a particular sound channel&apos;s register just makes it very quiet! You have to disable it completely if you want it to stop playing. I actually found this out last night while writing a test sound. The emulator goes dead silent but when I slapped it my actual gameboy the sound was still present, but incredibly quite.&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__380">
                                                        <div class="mdl-card__title"><strong>MadnessVX</strong> posted on 
		
			
				
				Aug 12, 2014 at 9:14:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Jazzmarazz</b></i><br><br>I don&apos;t know about NES but on the gameboy, setting volume to 0 on a particular sound channel&apos;s register just makes it very quiet! You have to disable it completely if you want it to stop playing. I actually found this out last night while writing a test sound. The emulator goes dead silent but when I slapped it my actual gameboy the sound was still present, but incredibly quite.&#xA0;</div><br><br><br>
Yeah, about same on the NES for what I have personally seen. Its not too much of a problem when all channels play, but still loud enough to be annoying.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__381">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 16, 2014 at 6:12:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, I&apos;ve had a lot of trouble understanding how to get sprites working (well at least), and the time has come to fill in the gaps. All of my previous questions on the subject have suffered from some fundamental errors, but I think that I am on the right track. One of the biggest areas that I have misunderstood occurs between weeks 6 and 7 of the Nerdy Nights. In week 6 sprites are loaded like this:
<br>
<br>
<br>LoadSprites:
<br>  LDX #$00              ; start at 0
<br>LoadSpritesLoop:
<br>  LDA sprites, x        ; load data from address (sprites +  x)
<br>  STA $0200, x          ; store into RAM address ($0200 + x)
<br>  INX                   ; X = X + 1
<br>  CPX #$10              ; Compare X to hex $10, decimal 16
<br>  BNE LoadSpritesLoop   ; Branch to LoadSpritesLoop if compare was Not Equal to zero
<br>                        ; if compare was equal to 16, keep going down
<br>             
<br>
<br>sprites:
<br>     ;vert tile attr horiz
<br>  .db $80, $32, $00, $80   ;sprite 0
<br>  .db $80, $33, $00, $88   ;sprite 1
<br>  .db $88, $34, $00, $80   ;sprite 2
<br>  .db $88, $35, $00, $88   ;sprite 3
<br>
<br>
<br>
<br>The next lesson, however, loads them as follows:
<br>
<br>
<br>UpdateSprites:
<br>  LDA bally  ;;update all ball sprite info
<br>  STA $0200
<br>  
<br>  LDA #$30
<br>  STA $0201
<br>  
<br>  LDA #$00
<br>  STA $0202
<br>  
<br>  LDA ballx
<br>  STA $0203
<br>  
<br>  ;;update paddle sprites
<br>  RTS
<br>
<br>
<br>
<br>Both routines are loading values into $0200 and the following addresses, but they do so in different ways. The first loads static values, whereas the second loads variables that are being updated elsewhere in the program. This second method, though, accomplishes its updates though the slow, painful, and redundant process of updating the value at each address by itself. Gone is that handy pointer table from the week before. Is there a way to load the updateable data found in week 7 (bally, ballx,) into the program using some sort of loop or pointer that copies information stored in a table (or table-like array)? For the sake of this question, let&apos;s say that I just want to update this for a single sprite. I&apos;m trying to isolate and distill what is actually going on with all of this before really trying to figure out MRN&apos;s lesson on the subject. At the moment I have things up and running for the hero and weapons, using metasprites and all, but when I start to look ahead to doing enemies it seems like it would be really unrealistic to have these long lists like in week 7 for every room. Thanks for any help! I&apos;m definitely ready to move past this problem...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__382">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Aug 16, 2014 at 8:14:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					edit: Nevermind.&#xA0; You already know what I typed.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__383">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 17, 2014 at 8:13:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	edit: Nevermind.&#xA0; You already know what I typed.</div>
<br>
Maybe??<br>
<br>
I&apos;m trying to back up and not miss anything this time around. Back in January I asked way too complicated of a question, and really did not understand a lot of necessary things. It is funny, sprites are one of the easiest things to get moving around on the screen, which leads to the illusion that I understand them, only to realize that I have no clue. At the moment I just want to figure out how to load/update them. Perhaps loading and updating are the same, maybe not; I&apos;m not even sure on that anymore. We all seem to use the terminology differently, and it gets to be a bit confusing. Room indexing, meta-sprites, and all of that other stuff can wait until later.<br>
<br>
<u>Super Edit</u>: After ripping apart MRN&apos;s code (down to 22 lines&#xA0;to get one sprite up, bit more to get it moving)&#xA0;I think that I&apos;ve got it! I&apos;ll share what I&apos;ve&#xA0;come to realize when I get things fully figured out (it could be a while).&#xA0;However, if you have thoughts or advice on the subject feel free to share it as I slowly rebuild things.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__384">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Aug 27, 2014 at 6:45:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have a little question about BG collision... I managed to complete KHAN&apos;s background collision detection tutorial, along with the metatile tuto, and now, I&apos;d like to know how to do it when there&apos;s scrolling like Super Mario Bros. (I can only make it on a still screen, think Legend of Zelda). Also, the game I&apos;d like to make is going to be 16x16 metatile based like Super Mario Bros just so you know.
<br>Can anyone help <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__385">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Aug 28, 2014 at 9:10:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There&apos;s a number of different ways of doing it.  One way would be to make a section of RAM your collision table.  Just update the appropriate address as you load new background and make sure your character is referenced to the appropriate scroll point.  i.e. instead of reading from the original background data in ROM, load the collision data into RAM.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__386">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Aug 30, 2014 at 8:02:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	There&apos;s a number of different ways of doing it. One way would be to make a section of RAM your collision table. Just update the appropriate address as you load new background and make sure your character is referenced to the appropriate scroll point. i.e. instead of reading from the original background data in ROM, load the collision data into RAM.</div>
<br>
<br>
I think I got it. Thanks! I&apos;ll post another reply if I have any questions.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__387">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Sep 5, 2014 at 4:08:03 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	(cut...) ... I managed to complete <strong>KHAN&apos;s background collision detection tutorial</strong> ... (cut...)</div>
Did I miss a tutorial published on this forum? If so, can you provide me a link please?<br>
Thanks! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__388">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Sep 5, 2014 at 5:53:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Vectrex280996</b></i><br>
		<br>
		(cut...) ... I managed to complete <strong>KHAN&apos;s background collision detection tutorial</strong> ... (cut...)</div>
	Did I miss a tutorial published on this forum? If so, can you provide me a link please?<br>
	Thanks!<br>
	<br>
	- user</div>
<br>
PM KHAN Games and he can send it to you <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__389">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Sep 5, 2014 at 6:08:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>user</b></i><br>
		<br>
		<div class="FTQUOTE">
			<i>Originally posted by: <b>Vectrex280996</b></i><br>
			<br>
			(cut...) ... I managed to complete <strong>KHAN&apos;s background collision detection tutorial</strong> ... (cut...)</div>
		Did I miss a tutorial published on this forum? If so, can you provide me a link please?<br>
		Thanks!<br>
		<br>
		- user</div>
	<br>
	PM KHAN Games and he can send it to you<br>
	&#xA0;</div>
<br>
Thanks! Appreciated. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
@Khan: I&apos;m of course interested in a NES tutorial I didn&apos;t read yet, can I PM you about this?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__390">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Sep 5, 2014 at 9:47:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Vectrex280996</b></i><br>
		<br>
		<div class="FTQUOTE">
			<i>Originally posted by: <b>user</b></i><br>
			<br>
			<div class="FTQUOTE">
				<i>Originally posted by: <b>Vectrex280996</b></i><br>
				<br>
				(cut...) ... I managed to complete <strong>KHAN&apos;s background collision detection tutorial</strong> ... (cut...)</div>
			Did I miss a tutorial published on this forum? If so, can you provide me a link please?<br>
			Thanks!<br>
			<br>
			- user</div>
		<br>
		PM KHAN Games and he can send it to you<br>
		&#xA0;</div>
	<br>
	Thanks! Appreciated.<br>
	@Khan: I&apos;m of course interested in a NES tutorial I didn&apos;t read yet, can I PM you about this?</div>
<br>
Of course, buddy.&#xA0; Just PM me your email address and I&apos;ll add you to the list so you can access it online!<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__391">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Sep 10, 2014 at 8:28:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Two very basic questions today <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>-Can subroutines be placed into subfolders? Or does this only work for other types of data? I changed a bunch of stuff around and tried using subfolders for the first time, but it does not seem to be reading them and the program fails to compile.
<br>
<br>-What is the difference between JSR and JMP? When should one be used and not the other? I get the feeling that I&apos;ve been a little too lucky in guessing which one to use and haven&apos;t learned the hard way yet...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__392">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Sep 10, 2014 at 8:41:34 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	Two very basic questions today<br>
	<br>
	-Can subroutines be placed into subfolders? Or does this only work for other types of data? I changed a bunch of stuff around and tried using subfolders for the first time, but it does not seem to be reading them and the program fails to compile.<br>
	<br>
	-What is the difference between JSR and JMP? When should one be used and not the other? I get the feeling that I&apos;ve been a little too lucky in guessing which one to use and haven&apos;t learned the hard way yet...</div>
<br>
Yes, you can place any code anywhere, as long as you tell your assembler where to find the files. With nesasm, I imagine that would involve explicitly telling it where to find each include file, e.g. &#xA0;.include &quot;enemies/slime.inc&quot; . &#xA0;With CA65, you can actually give it a list of folders to search for include files, so you don&apos;t need to spell out exactly where to find each file, though that is still an option I believe.<br>
<br>
JSR remembers where you were when you called it and places the current PC on the stack (can&apos;t remember if it advances it before or after the call, though), then jumps to the address you gave it. When your code hits an RTS, it pops off that PC that was stored earlier and resumes right AFTER the original JSR call. That&apos;s just a subroutine call. In fact it stands for &quot;jump sub routine.&quot; &#xA0;you have to be careful to always use an rts with this or you will crash your game with invalid stack data! &#xA0;I actually had &#xA0;once very odd bug in Nomolos because I forgot an rts in a routine so it just kept running right into another bit of code.<br>
<br>
That said though you ought to be using jsr and subroutines all over the place. This is one of the only natively available elements of abstraction that straight 6502 gives you. With well named routines with well-defined responsibilities, you can actually write pretty clean code with it.&#xA0;<br>
<br>
JMP does not remember where you were and just goes straight where you tell it to. It is neat though in that it has the capability of doing indirect jumps as well as direct. This allows you to use it in combination with jsr to call routines function-pointer style a-la C. Very powerful.<br>
<br>
In general, try to avoid using JMP too much, it can lead to very hard to follow code flow. Generally, I only use it when I&apos;m transitioning between game states, and when I&apos;m returning to the top of an infinite loop. And also for indirect JSRs, like this:<br>
<br>
<div>
	indirect_jsr_w0:</div>
<div>
	&#xA0; jmp (w0) &#xA0;;where w0 is a zp variable that has reserved 2 bytes</div>
<div>
	<br>
	<br>
	then, somewhere in your code:<br>
	<br>
	&#xA0; lda #&lt;a_routine_you_want_to_call<br>
	&#xA0; sta w0<br>
	&#xA0; &#xA0;lda #&gt;a_routine_you_want_to_call<br>
	&#xA0; &#xA0;sta w0+1<br>
	&#xA0; jsr indirect_jsr_w0<br>
	<br>
	You can then dynamically load addresses of routines you want to call. Very useful say if you have enemy definitions and a table of addresses of routines that constitute the enemys&apos; &quot;brains.&quot;</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__393">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Sep 11, 2014 at 8:31:38 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks Derek! It helps when one uses .include instead of .incbin <span class="sprites_emoticons absmiddle" id="emo_wink"></span> I knew there had to be a way. Now everything compiles, and I just have to put it all back together again...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__394">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Sep 13, 2014 at 1:59:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I asked a coding question in my project thread:<br>
<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=134187" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=134187">http://nintendoage.com/forum/mess...</a><br>
<br>
Since there are not links that directly link to a specific post, just search:<br>
Saturday, September 13, 2014 - 01:50:20 PM<br>
<br>
Thanks in advance to anyone can help. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user<br>
<br>
<br>
<strong>Edit: solved.</strong>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__395">
                                                        <div class="mdl-card__title"><strong>The Hero</strong> posted on 
		
			
				
				Sep 23, 2014 at 9:47:11 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am interested in being able to have customizable messages in the game like what retrozone is offering for their Xmas games?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__396">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Sep 30, 2014 at 5:59:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>The Hero</b></i><br>
	<br>
	I am interested in being able to have customizable messages in the game like what retrozone is offering for their Xmas games?</div>
<br>
You mean having custom messages in various copies of your game? If that&apos;s the case, you have to reprogram each string of text in every single copy of the game.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__397">
                                                        <div class="mdl-card__title"><strong>The Hero</strong> posted on 
		
			
				
				Sep 30, 2014 at 6:25:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>The Hero</b></i><br>
		<br>
		I am interested in being able to have customizable messages in the game like what retrozone is offering for their Xmas games?</div>
	<br>
	You mean having custom messages in various copies of your game? If that&apos;s the case, you have to reprogram each string of text in every single copy of the game.</div>
<br>
Thnk You!<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__398">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Oct 16, 2014 at 11:14:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Is there a cleaner way to do this? I am messing with the Power Pad. Basically, I want to utilize the &quot;buttons pressed&quot; code so if the button is stepped on, it only registers as 1 press and not a continual press.
<br><a href="http://pastebin.com/64rKimJe" target="_blank" original-href="http://pastebin.com/64rKimJe">http://pastebin.com/64rKimJe...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__399">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Oct 16, 2014 at 9:16:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	Is there a cleaner way to do this? I am messing with the Power Pad. Basically, I want to utilize the &quot;buttons pressed&quot; code so if the button is stepped on, it only registers as 1 press and not a continual press.<br>
	<a href="http://pastebin.com/64rKimJe" target="_blank" original-href="http://pastebin.com/64rKimJe">http://pastebin.com/64rKimJe</a></div>
<br>
This is pretty much what my program does for combos: save the first input, don&apos;t save other inputs until the button was relsased (old button == 00) in previous frames.<br>
So A + A is: A, release, A.<br>
And L + R is: L (don&apos;t take another L in the next frames if L was not released), release, R.<br>
<br>
I don&apos;t know if this is the best practice, it is just the one I use too.<br>
<br>
- Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__400">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Oct 17, 2014 at 7:56:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Mega Mario Man</b></i><br>
		<br>
		Is there a cleaner way to do this? I am messing with the Power Pad. Basically, I want to utilize the &quot;buttons pressed&quot; code so if the button is stepped on, it only registers as 1 press and not a continual press.<br>
		<a href="http://pastebin.com/64rKimJe" target="_blank" original-href="http://pastebin.com/64rKimJe">http://pastebin.com/64rKimJe</a></div>
	<br>
	This is pretty much what my program does for combos: save the first input, don&apos;t save other inputs until the button was relsased (old button == 00) in previous frames.<br>
	So A + A is: A, release, A.<br>
	And L + R is: L (don&apos;t take another L in the next frames if L was not released), release, R.<br>
	<br>
	I don&apos;t know if this is the best practice, it is just the one I use too.<br>
	<br>
	- Cheers!<br>
	<br>
	- user<br>
	&#xA0;</div>
Thanks for the reply! I think you and I are talking about 2 different things. Specifically, this part:<br>
<div class="de1">
	&#xA0; <span class="kw1">LDA</span> buttons1Lo_old <span class="co1">;what was pressed last frame. &#xA0;EOR to flip all the bits to find ...</span></div>
<div class="de2">
	&#xA0; <span class="kw1">EOR</span> <span class="sy0">#</span><span class="nu13">$FF</span> &#xA0; &#xA0;<span class="co1">;what was not pressed last frame</span></div>
<div class="de1">
	&#xA0; <span class="kw1">AND</span> buttons1Lo <span class="co1">;what is pressed this frame</span></div>
<div class="de2">
	&#xA0; <span class="kw1">STA</span> buttons1Lo_pressed <span class="co1">;stores off-to-on transitions</span></div>
<div class="de1">
	&#xA0;</div>
<div class="de2">
	&#xA0; <span class="kw1">LDA</span> buttons1Hi_old <span class="co1">;what was pressed last frame. &#xA0;EOR to flip all the bits to find ...</span></div>
<div class="de1">
	&#xA0; <span class="kw1">EOR</span> <span class="sy0">#</span><span class="nu13">$FF</span> &#xA0; &#xA0;<span class="co1">;what was not pressed last frame</span></div>
<div class="de2">
	&#xA0; <span class="kw1">AND</span> buttons1Hi <span class="co1">;what is pressed this frame</span></div>
<div class="de1">
	&#xA0; <span class="kw1">STA</span> buttons1Hi_pressed <span class="co1">;stores off-to-on transitions</span></div>
<div class="de2">
	&#xA0; <span class="kw1">RTS<br>
	<br>
	<br>
	The way I have it coded now, it works great. I was just looking to see what others may have done.</span><br>
	&#xA0;</div>
<br>
<br>
I was mainly asking if their was a better way to write the code I have their to make it smaller.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__401">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Oct 17, 2014 at 8:29:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					A technique I originally learned from a guy named banshaku over at nesdev is really easy to use and highly flexible. I know you&apos;re using the power pad but I imagine the same technique would transfer over.<br>
<br>
.proc controller_read<br>
<br>
lda #$01<br>
sta $4016<br>
lda #$00<br>
sta $4016<br>
<br>
;a<br>
lda $4016<br>
ror<br>
rol buffer_controller<br>
<br>
;b<br>
lda $4016<br>
ror<br>
rol buffer_controller+1<br>
<br>
;select<br>
lda $4016<br>
ror<br>
rol buffer_controller+2<br>
<br>
;start<br>
lda $4016<br>
ror<br>
rol buffer_controller+3<br>
<br>
;up<br>
lda $4016<br>
ror<br>
rol buffer_controller+4<br>
<br>
;down<br>
lda $4016<br>
ror<br>
rol buffer_controller+5<br>
<br>
;left<br>
lda $4016<br>
ror<br>
rol buffer_controller+6<br>
<br>
;right<br>
lda $4016<br>
ror<br>
rol buffer_controller+7<br>
<br>
rts<br>
.endproc<br>
<br>
<br>
What this does is rotate the current state of each controller button into a byte in an array called buffer_controller. Then, each byte in buffer_controller holds the current state of the button, and the history for 7 previous frames. Typically you won&apos;t need all 7 bits of history. But to detect an off-to-on transition for example you could go (assuming you called the routine above for the current frame):<br>
<br>
;get out the button press history for the A button<br>
lda buffer_controller<br>
and #%00000011 ;isolate only the current and previous state<br>
cmp #%00000001 ;test whether the button transitioned from off to on<br>
beq player_hit_button<br>
player_did_not_hit_button:<br>
<br>
jmp done<br>
player_hit_button:<br>
<br>
done:<br>
<br>
It makes the juggling of states for current and previous a little simpler to visualize, plus you don&apos;t need extra bytes for each button for previous states--just one byte per button holding a history of presses.<br>
<br>
That rotating buffer technique is a neat one, too, as it can come in handy in other situations. For example, you could layer on another buffer for rotating detected off-to-on transitions...this would make it easy to implement a cheat sequence of buttons for example, or sequence of buttons for executing a fighting game move.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__402">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Oct 17, 2014 at 10:43:43 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The tricky part about the Power Pad is that it doesn&apos;t register on bit 1. It registers on bits 3 and 4. So, 8 of the buttons will look like this 0000 1000, the other four look like this 0001 0000. You have to check both bits on each pass because the first 4 passes can be 0000 1000 or 0001 0000. The last four passes really don&apos;t matter because it can only be 0000 1000. So, with your code, I think I would have to do this:<br>
<br>
;read 2<br>
lda $4016<br>
ror&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&lt;--Bit 0, Standard Controller<br>
ror&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&lt;--Bit 1<br>
ror&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; &lt;--Bit 2<br>
ror&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&lt;--Bit 3, Power Pad First 8 Buttons, Check on all 8 passes of $4016<br>
rol buffer_controller<br>
;read 4<br>
ror&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; &lt;--Bit 4, Power Pad Last 4 Buttons, Check on the first 4 passes of $4016<br>
rol buffer_controller+1<br>
<br>
;read 1<br>
lda $4016<br>
ror<br>
ror<br>
ror<br>
ror<br>
rol buffer_controller+2<br>
;read 3<br>
ror<br>
rol buffer_controller+3<br>
<br>
;read 5<br>
lda $4016<br>
ror<br>
ror<br>
ror<br>
ror<br>
rol buffer_controller+4<br>
;read 12<br>
ror<br>
rol buffer_controller+5<br>
<br>
;read 9<br>
lda $4016<br>
ror<br>
ror<br>
ror<br>
ror<br>
rol buffer_controller+6<br>
;read 8<br>
ror<br>
rol buffer_controller+7<br>
<br>
;read 6<br>
lda $4016<br>
ror<br>
ror<br>
ror<br>
ror<br>
rol buffer_controller+8<br>
<br>
;read 10<br>
lda $4016<br>
ror<br>
ror<br>
ror<br>
ror<br>
rol buffer_controller+9<br>
<br>
;read 11<br>
lda $4016<br>
ror<br>
ror<br>
ror<br>
ror<br>
rol buffer_controller+10<br>
<br>
;read 7<br>
lda $4016<br>
ror<br>
ror<br>
ror<br>
ror<br>
rol buffer_controller+11
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__403">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Oct 17, 2014 at 10:46:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Wow...I had no idea that technique would be difficult to apply to the power pad (well, not difficult, just ugly). Oh well, haha. Good luck. <span class="sprites_emoticons absmiddle" id="emo_smile"></span> Seems every time you turn a corner in any software development, a surprise turns up.<br>
<br>
Perhaps that wouldn&apos;t be so bad though---the rotating bit buffer sure makes it convenient to test for off-to-on, on-to-off, etc. Whatever works! &#xA0;How many spots are there on the power pad?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__404">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Oct 17, 2014 at 11:01:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Their are 12 spots. Although, the programming looks like there is room for 16. Not sure why they wouldn&apos;t go the full 16. Maybe the pad would have been too big for their liking.<br>
<br>
Bit 3 - 8 Buttons out of 8 possible spots<br>
Bit 4 - 4 Buttons out of 8 possible spots (could have had 4 more buttons here!)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__405">
                                                        <div class="mdl-card__title"><strong>Hoddy Krishnuh</strong> posted on 
		
			
				
				Oct 24, 2014 at 9:00:01 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Between C and C++, which is considered the best for writing/improving 8-bit or 16-bit emulators? &#xA0;Examples of said emulators would be much appreciated.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__406">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				Oct 27, 2014 at 2:26:33 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Jeckidy</b></i><br>
	<br>
	Between C and C++, which is considered the best for writing/improving 8-bit or 16-bit emulators? &#xA0;Examples of said emulators would be much appreciated.</div>
<br>
Nobody (that I&apos;m aware of that posts regularly) has written an emulator here at Nintendoage. That question might gain some traction on the NESDev forums, as they have a very active emulator sub-forum.<br>
<br>
In my humble opinion, the language doesn&apos;t really matter, the improvements made to currently maintained emulators have mostly come from finally understanding the inner workings of the hardware.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__407">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Oct 27, 2014 at 10:31:02 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Most emulators I know are written in C++: FCEUX, Nestopia, Nintendulator, puNES. When choosing between C and C++, it mostly comes down to your own preference. C is older and simpler. C++ has more helpful features and a larger standard library, but is much more complex as a result. It&apos;s not required to use all of the complex C++ features though, you can also use it as an &quot;enhanced C&quot;; in fact, this is what Nintendulator and FCEUX are essentially doing.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__408">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Oct 27, 2014 at 10:41:44 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>NESHomebrew</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Jeckidy</b></i><br>
		<br>
		Between C and C++, which is considered the best for writing/improving 8-bit or 16-bit emulators? &#xA0;Examples of said emulators would be much appreciated.</div>
	<br>
	Nobody (that I&apos;m aware of that posts regularly) has written an emulator here at Nintendoage. That question might gain some traction on the NESDev forums, as they have a very active emulator sub-forum.<br>
	<br>
	In my humble opinion, the language doesn&apos;t really matter, the improvements made to currently maintained emulators have mostly come from finally understanding the inner workings of the hardware.</div>
<br>
I think that AlBailey wrote one, but I don&apos;t know if he finished it. &#xA0;It&apos;s been a while since I&apos;ve heard anyting about it. &#xA0;<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__409">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Oct 30, 2014 at 4:07:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi all,<br>
<br>
I have a question I&apos;m wondering about just for teh sake of it.<br>
<br>
<strong>Can a NMI happen if the code from the previous NMI didn&apos;t reach a RTI yet?</strong><br>
<br>
My program has a flag to set the change of the background.<br>
This is used for example when a dialog has to be shown.<br>
<pre>In pseudocode:
NMI
If the flag is set:
0. disable $2001, only the rendering (not $2000!)
1. unset the flag (and do music stuff)
2. the &quot;set background routine&quot; uploads all the text &quot;glyphs&quot; background in $2007
3. RTI
If the flag is NOT set:
0. (unrelated to this: music stuff, joypad inputs detect and other quick stuff)
1. enable $2001
2. RTI</pre>
My question is: let say the &quot;set background routine&quot; takes more than 1/60th of a second to execute, since only $2001 (not $2000) is disabled, can in theory another NMI happen before the code gets to the RTI? If so, what happens then?<br>
Or instead the next NMIs will never happen if the running NMI loop didn&apos;t exit yet with an RTI?<br>
<br>
Thank you. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__410">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Oct 30, 2014 at 5:14:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<a href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs">http://wiki.nesdev.com/w/index.ph...</a><br>
EDIT: Concentrate on this section -<strong><span class="mw-headline" id="VBlank.2C_Rendering_Time.2C_and_NMIs"> VBlank, Rendering Time, and NMIs</span></strong><br>
<br>
Read this. Once I read this, I started to understand VBlanks and NMIs.<br>
<br>
Basically, if you can&apos;t get everything done in that 1/60th of a second, thePPU moves on without you and you will have major glitches. I think it would take a TON of graphic updates in order for you to spill into a 2nd NMI. There is a lot you can update in the 1/60th of a second.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__411">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Oct 30, 2014 at 5:42:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	<a href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs">http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs</a><br>
	EDIT: Concentrate on this section -<strong><span class="mw-headline" id="VBlank.2C_Rendering_Time.2C_and_NMIs"> VBlank, Rendering Time, and NMIs</span></strong><br>
	<br>
	Read this. Once I read this, I started to understand VBlanks and NMIs.<br>
	<br>
	Basically, if you can&apos;t get everything done in that 1/60th of a second, thePPU moves on without you and you will have major glitches. I think it would take a TON of graphic updates in order for you to spill into a 2nd NMI. There is a lot you can update in the 1/60th of a second.</div>
Thanks for your answer. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
I knew that document, and I know that a NMI will interrupt a main loop.<br>
<br>
My question (curiosity) was about interrupting the code executed after an NMI.<br>
<br>
I try asking it in a different way: putting an infinite loop starting with an NMI, the game will freeze. Does in this case still trigger NMIs? Or since the RTI was never reached, no other NMI are triggered?<br>
<br>
Or, if you prefer: if the NMI code is too long and doesn&apos;t reach the RTI in 1/60th of second, 1/60th of second later another NMI will be triggered or not? If it will, will NMI code restart executing? In this case will the RTI ever be reached?<br>
<br>
I hope this makes sense in English and programming wise.<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user<br>
<br>
<strong>Edit</strong>: formatting, added a note
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__412">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Oct 30, 2014 at 5:43:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					IIRC, and I may not cause I&apos;m dumb, but NMI is just a notification.  It will jump to your NMI vector EVERY time the notification hits.  So, if you&apos;re going to stick a bunch of shit in NMI, you need to disable it first thing then re-enable it last thing.  This will keep it from interrupting it&apos;s self.  
<br>
<br>The system has no way of knowing if you&apos;ve finished your operations or not and called RTI.  NMI is just that, an interrupt.  It will jump to the vector and it&apos;s up to you to return from it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__413">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Oct 30, 2014 at 5:51:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br>IIRC, and I may not cause I&apos;m dumb, but NMI is just a notification.  It will jump to your NMI vector EVERY time the notification hits.  So, if you&apos;re going to stick a bunch of shit in NMI, you need to disable it first thing then re-enable it last thing.  This will keep it from interrupting it&apos;s self.  
<br>
<br>The system has no way of knowing if you&apos;ve finished your operations or not and called RTI.  NMI is just that, an interrupt.  It will jump to the vector and it&apos;s up to you to return from it.</div><br><br><br>Thanks! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br><br>Exactly the answer I was looking for!<br><br>So, it doesn&apos;t matter if the program is executing code inside the main loop or the NMI loop. If $2000 is not disabled, every 1/60th of a second it will restart running from the beginning of the NMI code! If so, I learned something for sure today!<br><br>Thanks, appreciated! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br><br>- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__414">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Nov 7, 2014 at 6:24:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Just a little question about MMC1 mapping.<br>
I&apos;m using this mapper with 32KB bankswitching, and I was just wondering how this kind of PRG bankswitching works. (I know how MMC1 bankswitching works, I&apos;m just wondering how the NES works when you switch banks, as I want to switch banks during some routines)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__415">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Nov 7, 2014 at 2:23:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That&apos;s kind of an open question. It switches everything in PRG when you set it that way.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__416">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Nov 7, 2014 at 4:15:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					At the moment of the last $e000 write selected bank replaces current one immediately. So in 32K mode you either need to plan your code very carefully to not allow code execution to get into unexpected location after the switch, or, which is way more viable, use a &apos;trampoline&apos; (or &apos;far call&apos;) in the RAM. I.e. bankswitching subroutine stored in the RAM, and takes two input parameters - PRG bank number and new PC value after performing the jump/call.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__417">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Nov 7, 2014 at 4:42:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	At the moment of the last $e000 write selected bank replaces current one immediately. So in 32K mode you either need to plan your code very carefully to not allow code execution to get into unexpected location after the switch, or, which is way more viable, use a &apos;trampoline&apos; (or &apos;far call&apos;<span class="sprites_emoticons absmiddle" id="emo_wink"></span> in the RAM. I.e. bankswitching subroutine stored in the RAM, and takes two input parameters - PRG bank number and new PC value after performing the jump/call.</div>
<br>
Thanks <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__418">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Nov 17, 2014 at 1:18:38 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					And now I have another question regarding the MMC1. When I bankswitch the CHR background like this<br>
<br>
LDA #%00000010 ;Swap background<br>
JSR Background_Select ;Go to $C000 bankswitching subroutine<br>
<br>
;Rest of code here<br>
<br>
<div>
	Background_Select:</div>
<div>
	&#xA0; STA $C000</div>
<div>
	&#xA0; LSR A</div>
<div>
	&#xA0; STA $C000</div>
<div>
	&#xA0; LSR A</div>
<div>
	&#xA0; STA $C000</div>
<div>
	&#xA0; LSR A</div>
<div>
	&#xA0; STA $C000</div>
<div>
	&#xA0; LSR A</div>
<div>
	&#xA0; STA $C000</div>
<div>
	&#xA0; RTS</div>
<br>
It works fine on an emulator. However, on real hardware, it seems like there is no such thing, the name entry screen of Deal or no Deal keeps the title background CHR bank. What am I doing wrong?<br>
<br>
EDIT: Answered on NESDEV. Gonna keep you informed
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__419">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Nov 18, 2014 at 4:57:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div>
	Rewrote my routine, but I have the same problem on real hardware using flashcarts... Please help me <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
	The CHR banks are supposed to be those in case_bank, but it glitches up on real hardware...</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; LDX CharNumber</div>
<div>
	&#xA0; LDA case_bank,x</div>
<div>
	&#xA0; JSR Background_Select ;$C000 MMC1 writes</div>
<div>
	&#xA0;</div>
<div>
	;Blahblahblahworkingcodeblahblahblah</div>
<div>
	&#xA0;</div>
<div>
	case_bank:</div>
<div>
	&#xA0; .db $03,$03,$03,$03,$03,$04,$04,$04,$04,$04,$05,$05,$05,$05,$05</div>
<div>
	&#xA0; .db $06,$06,$06,$06,$06,$07,$07,$07,$07,$07,$08,$08,$08,$08,$08</div>
<div>
	&#xA0;</div>
<div>
	Do you know what&apos;s wrong?</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__420">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Nov 20, 2014 at 8:52:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There are a lot of things that could make it glitch on hardware but not an emulator.  Are you sure it&apos;s in the bank switching code?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__421">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Nov 20, 2014 at 10:31:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	There are a lot of things that could make it glitch on hardware but not an emulator. Are you sure it&apos;s in the bank switching code?</div>
<br>
<br>
I&apos;m positive...<br>
<br>
Real hardware<br>
<img alt src original-src="http://i.imgur.com/JNSBJCa.jpg" show-src="scraper/images/JNSBJCa.jpg"><br>
<br>
Emulator<br>
<img src original-src="http://i1074.photobucket.com/albums/w408/KilleRotom/deal001_zpsc4a4ede7.png" show-src="scraper/images/deal001_zpsc4a4ede7.png">&#xA0;(Old picture but you get the idea... It should look like this)<br>
<br>
It seems like it goes back to the title screen bank for some reason, doing 03,00,01,02,03,08 instead of doing 03,04,05,06,07,08.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__422">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Nov 20, 2014 at 10:51:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Without looking at the actual code, I&apos;d say you have an error either in your bank selection routine or the config reg set up routine.  i.e. you have your CHR set to swap 8k chunks and you&apos;re trying to switch 4k chunks.  Or vice versa.  The emulator will sometimes ignore stuff and function with this error, but the hardware won&apos;t. Just check everything and make sure there&apos;s not an error.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__423">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Nov 20, 2014 at 12:58:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<i>Problem solved per PM!</i>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__424">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Dec 4, 2014 at 4:49:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					How do you make aimed bullets on the NES? I can&apos;t figure out a clever way to do this...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__425">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 4, 2014 at 4:53:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	How do you make aimed bullets on the NES? I can&apos;t figure out a clever way to do this...</div>
Do you mean detect a collision between two sprites?<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__426">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Dec 4, 2014 at 5:58:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Vectrex280996</b></i><br>
		<br>
		How do you make aimed bullets on the NES? I can&apos;t figure out a clever way to do this...</div>
	Do you mean detect a collision between two sprites?<br>
	<br>
	&#xA0;</div>
<br>
No, I think I already know how to do this <span class="sprites_emoticons absmiddle" id="emo_tongue"></span> I mean having enemies aim at you and then shoot so the bullets come to you (but don&apos;t home), like in many shooters such as Gradius<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__427">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 4, 2014 at 6:19:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>user</b></i><br>
		<br>
		<div class="FTQUOTE">
			<i>Originally posted by: <b>Vectrex280996</b></i><br>
			<br>
			How do you make aimed bullets on the NES? I can&apos;t figure out a clever way to do this...</div>
		Do you mean detect a collision between two sprites?<br>
		<br>
		&#xA0;</div>
	<br>
	No, I think I already know how to do this I mean having enemies aim at you and then shoot so the bullets come to you (but don&apos;t home), like in many shooters such as Gradius<br>
	&#xA0;</div>
I don&apos;t know Gradius. However, I guess you have to shoot at different angles. The only thing I can think about is a lookup table of x coordinate movement and y coordinate movement, depending on the direction of the target, like, for instance: 355&#xB0; / 5&#xB0; -&gt; x 00, y ##; 5&#xB0;-15&#xB0; -&gt; x ##, y ##; and so on up to 345&#xB0;-355&#xB0;. But there is probably a better way and maybe this is not even what you are looking for.<br>
<strong>Edit</strong>: misspelling.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__428">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 4, 2014 at 6:48:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					To aim a bullet you just need atan2 function. You determine the angle that way, then take deltas for required speed using a table. atan2 may sound scary, but it fast it isn&apos;t too slow, check this implementation: <a href="http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle" target="_blank" original-href="http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle">http://codebase64.org/doku.php?id...</a><br>
<br>
If you need range more than 8 bit, you can just divide the source vector by 2, 4, etc. This will be precise enough.<br>
<br>
And of course, never use 360 degree circle on 8 bit CPU. It should be 256 degree instead.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__429">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 4, 2014 at 10:56:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	If you need range more than 8 bit, you can just divide the source vector by 2, 4, etc. This will be precise enough.<br>
	<br>
	And of course, never use 360 degree circle on 8 bit CPU. It should be 256 degree instead.</div>
I was thinking exactly about these two optimizations (divide the &quot;circle&quot; in a multiple of 2, and do a LSR on bigger distances) after posting, but I wasn&apos;t even sure I gave a good advice in the beginning so I didn&apos;t bother editing! Thank you for confirming me that I was somehow on the good track, after all!<br>
<br>
- user<br>
<br>
<strong>Edit</strong>: misspelling.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__430">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Dec 5, 2014 at 3:36:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	To aim a bullet you just need atan2 function. You determine the angle that way, then take deltas for required speed using a table. atan2 may sound scary, but it fast it isn&apos;t too slow, check this implementation: <a href="http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle" target="_blank" original-href="http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle">http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle</a><br>
	<br>
	If you need range more than 8 bit, you can just divide the source vector by 2, 4, etc. This will be precise enough.<br>
	<br>
	And of course, never use 360 degree circle on 8 bit CPU. It should be 256 degree instead.</div>
<br>
Thanks, gonna take a look at it this evening (Cause I need to refresh my math skills <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>)<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__431">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 5, 2014 at 10:07:48 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think it is worth to mention that from the math standpoint a more straightforward way to implement the aiming would be just normalizing the vector, then multiplying it by the speed, this would give the deltas for a projectile. But it would be too slow on 6502 to do this math (requires multiplication) with enough precision. So the other way, determine the angle and get new deltas, is faster, as it can be boiled down to just a number of LUTs.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__432">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Dec 5, 2014 at 11:29:24 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Wish I had seen that when I was doing BAN.  It would have been much easier than what I did and probably would have worked better.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__433">
                                                        <div class="mdl-card__title"><strong>farmerdwight</strong> posted on 
		
			
				
				Dec 7, 2014 at 2:20:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Is it possible to take a .nes game file and extract the code so that it looks like the assembly code in the nerdy nights tutorial?  I looked in the FCEUXD and the debugger looks similar to the assembly code because I see many opcodes but it&apos;s still quite different.  I&apos;m trying to understand the relationship between these different files like .nes and .asm.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__434">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Dec 7, 2014 at 4:57:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>farmerdwight</b></i><br>
	<br>
	Is it possible to take a .nes game file and extract the code so that it looks like the assembly code in the nerdy nights tutorial? I looked in the FCEUXD and the debugger looks similar to the assembly code because I see many opcodes but it&apos;s still quite different. I&apos;m trying to understand the relationship between these different files like .nes and .asm.</div>
<br>
Decompilation is a very complicated process I&apos;m afraid, and even if you manage to decompile the ROM, you&apos;ll still need to annotate it. However, there are a few decompiled NES ROMs out there, like SMB3, SMB, Metroid, and Secret Scout (The latter being interesting due to being the actual source code published by the programmer himself)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__435">
                                                        <div class="mdl-card__title"><strong>farmerdwight</strong> posted on 
		
			
				
				Dec 7, 2014 at 11:28:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>farmerdwight</b></i><br>
		<br>
		Is it possible to take a .nes game file and extract the code so that it looks like the assembly code in the nerdy nights tutorial? I looked in the FCEUXD and the debugger looks similar to the assembly code because I see many opcodes but it&apos;s still quite different. I&apos;m trying to understand the relationship between these different files like .nes and .asm.</div>
	<br>
	Decompilation is a very complicated process I&apos;m afraid, and even if you manage to decompile the ROM, you&apos;ll still need to annotate it. However, there are a few decompiled NES ROMs out there, like SMB3, SMB, Metroid, and Secret Scout (The latter being interesting due to being the actual source code published by the programmer himself)</div>
Ok, so there is a lot of manual effort involved in decompiling a ROM? &#xA0;I downloaded the files that &quot;L&quot; posted at this site:<br>
<br>
<a href="http://forums.selectbutton.net/viewtopic.php?t=26956&amp;sid=1a883209e1ba63877bcd58c007bb63ae" target="_blank" original-href="http://forums.selectbutton.net/viewtopic.php?t=26956&amp;sid=1a883209e1ba63877bcd58c007bb63ae">http://forums.selectbutton.net/vi...</a><br>
<br>
which shows an annotated SMB assembly.<br>
<br>
Why is the iNES header in a seperate file (smb.hdr)? &#xA0;In the Nerdy Nights tutorials, the iNES headers are just the first lines in the code I thought or is that something different:<br>
<br>
<div>
	&#xA0; .inesprg 1 &#xA0; ; 1x 16KB PRG code</div>
<div>
	&#xA0; .ineschr 1 &#xA0; ; 1x &#xA0;8KB CHR data</div>
<div>
	&#xA0; .inesmap 0 &#xA0; ; mapper 0 = NROM, no bank swapping</div>
<div>
	&#xA0; .inesmir 1 &#xA0; ; background mirroring</div>
<br>
Another question I have is where are the levels stored (in SMB) like the exact layout of where each block is located? &#xA0;Are they in the .asm file somewhere?<br>
<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__436">
                                                        <div class="mdl-card__title"><strong>Baka94</strong> posted on 
		
			
				
				Dec 8, 2014 at 4:06:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>farmerdwight</b></i><br>
	<br>
	Ok, so there is a lot of manual effort involved in decompiling a ROM? &#xA0;I downloaded the files that &quot;L&quot; posted at this site:<br>
	<br>
	<a href="http://forums.selectbutton.net/viewtopic.php?t=26956&amp;sid=1a883209e1ba63877bcd58c007bb63ae" target="_blank" original-href="http://forums.selectbutton.net/viewtopic.php?t=26956&amp;sid=1a883209e1ba63877bcd58c007bb63ae">http://forums.selectbutton.net/viewtopic.php?t=26956&amp;sid...</a> <br>
	<br>
	which shows an annotated SMB assembly.<br>
	<br>
	Why is the iNES header in a seperate file (smb.hdr)? &#xA0;In the Nerdy Nights tutorials, the iNES headers are just the first lines in the code I thought or is that something different:<br>
	<br>
	<div>
		&#xA0; .inesprg 1 &#xA0; ; 1x 16KB PRG code</div>
	<div>
		&#xA0; .ineschr 1 &#xA0; ; 1x &#xA0;8KB CHR data</div>
	<div>
		&#xA0; .inesmap 0 &#xA0; ; mapper 0 = NROM, no bank swapping</div>
	<div>
		&#xA0; .inesmir 1 &#xA0; ; background mirroring</div>
	<br>
	Another question I have is where are the levels stored (in SMB) like the exact layout of where each block is located? &#xA0;Are they in the .asm file somewhere?<br>
	&#xA0;</div>
<br>
I guess the iNES header is in separate file just to make things easier to read. It&apos;s better to have the code broken in smaller parts than have everything in one .asm file (especially in large games). It makes reading and editing the code easier.<br>
<br>
Also, for your another question:<br>
I don&apos;t think the level data is in the .asm file. Even if they are, they are probably compressed to save space. I don&apos;t know how SMB compresses levels, but I&apos;m farily sure it goes along something like this:&#xA0;8x8 tiles &gt; Metatiles &gt; Screens &gt; Levels<br>
<br>
If the level data is in the .asm file, it&apos;d probably look something like this<br>
<br>
<code>World1_3: &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;; Lable indicating stage<br>
&#xA0;.db $04,$05,$06</code><br>
<br>
(The .db is probably longer and there may be multiple lines of it)<br>
By the values of the .db, the level decompression code starts to decode the level data and then write it in the PPU to draw it on screen.<br>
<br>
I&apos;m not expert in these things, but I believe that this is how just about every NES game handles level data.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__437">
                                                        <div class="mdl-card__title"><strong>Rodragon</strong> posted on 
		
			
				
				Dec 11, 2014 at 3:00:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Friends, how can I make an 2J3M works for a Final Fantasy III using 4x 27C801? 
<br>
<br>I dont know where the pins 2 and 3 of the LS139 need to be soldered =/ 
<br>
<br>can you help? 
<br>
<br>Best regards, 
<br>
<br>Rodragon
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__438">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 12, 2014 at 11:55:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m planning on a car racing game, top view like Off-Road, but with the tracks vast 4 screens instead of one. So I need a four direction scrolling routine which allows an inversion of direction depending on which direction you are facing. If there is any good tutorial or article about this someone wishes to link, or if someone has some time to waste in my favor to give advice, that would be extremely welcome. I never programmed a scrolling game for NES so far.
<br>
<br>Thanks.
<br>
<br>- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__439">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 13, 2014 at 12:33:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					4 screen scrolling is as difficult as any greater number of screens (unless you use 4-screen mirroring with extra nametable RAM, used in like two games ever). 2 screen scrolling is just a bit more difficult than no scrolling.
<br>
<br>I&apos;d recommend to start with a simple demo with one axis scrolling (SMB-like), both directions. Then you&apos;ll get idea how to turn it into 8-way scrolling, and realize that it is not so easy.
<br>
<br>General idea of all scrolling routines is that you update one column and/or row slighly before the screen edge by direction of the scrolling. So you need to store map somehow (unpacked, or packed with metatiles or RLE), prepare row/column buffer to update during normal frame time, and send it to the VRAM during VBlank.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__440">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 13, 2014 at 1:59:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	4 screen scrolling is as difficult as any greater number of screens (unless you use 4-screen mirroring with extra nametable RAM, used in like two games ever). 2 screen scrolling is just a bit more difficult than no scrolling.<br>
	<br>
	I&apos;d recommend to start with a simple demo with one axis scrolling (SMB-like), both directions. Then you&apos;ll get idea how to turn it into 8-way scrolling, and realize that it is not so easy.<br>
	<br>
	General idea of all scrolling routines is that you update one column and/or row slighly before the screen edge by direction of the scrolling. So you need to store map somehow (unpacked, or packed with metatiles or RLE), prepare row/column buffer to update during normal frame time, and send it to the VRAM during VBlank.</div>
Thanks. I will follow your advice.<br>
I also remember a page on nesdev wiki about SMB scrolling with an animated demo, which explained the basics, I have to find it again.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__441">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Dec 13, 2014 at 2:45:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There&apos;s something I&apos;ve had a hard time wrapping my head around for longer than I want to admit now, and It&apos;s starting to get embarassing, so I&apos;ll just see if I can get it together myself with some helpful hints(hopefully) from you guys.<br>
<br>
So, first of all; how do you keep an 8.8(signed) variable between -n and n(e.g. -$02.$80 and $02.$80), and how could you increment/decrement the value of this 8.8 fixed-point number by x(8-bit number)?<br>
<br>
Thanks, and sorry for awkward English. :S
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__442">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Dec 13, 2014 at 5:24:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	So, first of all; how do you keep an 8.8(signed) variable between -n and n(e.g. -$02.$80 and $02.$80)</div>
Clamp the value: if it&apos;s less than the minimum, set it to the minimum, if it&apos;s over the maximum, set it to the maximum. See&#xA0;<a href="http://www.6502.org/tutorials/compare_beyond.html#6" target="_blank" original-href="http://www.6502.org/tutorials/compare_beyond.html#6">http://www.6502.org/tutorials/compare_beyond.html#6</a> for how to compare two signed 16-bit values (result in N).<br>
<br>
You have to make sure that no overflow can occur in whatever operation you do before the clamp.<br>
<br>
<div class="FTQUOTE" "width: 697.59375px;">
	<i>Originally posted by:&#xA0;<b>DoNotWant</b></i><br>
	<br>
	and how could you increment/decrement the value of this 8.8 fixed-point number by x(8-bit number)?</div>
This is just normal addition, same as for unsigned non-fixed-point numbers.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__443">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Dec 13, 2014 at 6:04:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>DoNotWant</b></i><br>
		<br>
		So, first of all; how do you keep an 8.8(signed) variable between -n and n(e.g. -$02.$80 and $02.$80)</div>
	Clamp the value: if it&apos;s less than the minimum, set it to the minimum, if it&apos;s over the maximum, set it to the maximum. See&#xA0;<a href="http://www.6502.org/tutorials/compare_beyond.html#6" target="_blank" original-href="http://www.6502.org/tutorials/compare_beyond.html#6">http://www.6502.org/tutorials/compare_beyond.html#6</a> for how to compare two signed 16-bit values (result in N).<br>
	<br>
	You have to make sure that no overflow can occur in whatever operation you do before the clamp.<br>
	<br>
	<div class="FTQUOTE" width:>
		<i>Originally posted by:&#xA0;<b>DoNotWant</b></i><br>
		<br>
		and how could you increment/decrement the value of this 8.8 fixed-point number by x(8-bit number)?</div>
	This is just normal addition, same as for unsigned non-fixed-point numbers.</div>
I have read that document 4 or 5 times now, I still don&apos;t seem to grasp the later stuff. I&apos;d show you my code, if it were not a cluster fuck. I&apos;ll go through it again and see if I can get it to work, or at least clean it up a bit.<br>
<br>
I knew about the clamping BTW, I just have trouble doing it. Not for the positive numbers, but the negative. Obviously it&apos;s something that I don&apos;t grasp yet, but I&apos;m starting to feel like a retard over here.<br>
<br>
<pre>  LDA NUM1L ; NUM1-NUM2
  CMP NUM2L
  LDA NUM1H
  SBC NUM2H
  BVC LABEL ; N eor V
  EOR #$80
LABEL</pre>
What is the use of CMP here? Wouldn&apos;t the zero flag get mangled by LDA NUM1H?<br>
<br>
Thanks!<br>
<br>
<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__444">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Dec 13, 2014 at 6:19:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	I have read that document 4 or 5 times now, I still don&apos;t seem to grasp the later stuff. I&apos;d show you my code, if it were not a cluster fuck. I&apos;ll go through it again and see if I can get it to work, or at least clean it up a bit.<br>
	<br>
	I knew about the clamping BTW, I just have trouble doing it. Not for the positive numbers, but the negative. Obviously it&apos;s something that I don&apos;t grasp yet, but I&apos;m starting to feel like a retard over here.<br>
	<br>
	<pre>  LDA NUM1L ; NUM1-NUM2
  CMP NUM2L
  LDA NUM1H
  SBC NUM2H
  BVC LABEL ; N eor V
  EOR #$80
LABEL</pre>
	What is the use of CMP here? Wouldn&apos;t the zero flag get mangled by LDA NUM1H?</div>
Zero flag yeah, but CMP also sets the carry flag, which gets used by SBC. In any case, you don&apos;t really need to understand how the code works to use it.<br>
<br>
Here&apos;s a macro (ca65) for signed 16-bit clamping that I&apos;ve used a couple of times:<br>
<pre>; NOTE: min and max have to be immediates, but without #
.macro signed_clamp16 addr, min, max, offs1
    .local HIBYTE_OFFSET_1, is_greater_than_min, is_less_than_or_equ_to_max, out
    .ifblank offs1
        HIBYTE_OFFSET_1 = 1
    .else
        HIBYTE_OFFSET_1 = offs1
    .endif
    ; this is a signed 16bit compare which leaves the result in N flag
    ; so BMI will branch if param1 &lt;= param2
    ; and BPL will branch if param1 &gt; param2
    
    ; First check if &quot;addr&quot; is bigger than &quot;min&quot;.
    lda addr
    cmp #&lt;(min)
    lda HIBYTE_OFFSET_1+addr
    sbc #&gt;(min)
    bvc :+
    eor #$80
:
    bpl is_greater_than_min
    ; Less than minimum, clamp.
    lda #&lt;(min)
    sta addr
    lda #&gt;(min)
    sta HIBYTE_OFFSET_1+addr
    jmp out
    
is_greater_than_min:
    ; Now check if &quot;addr&quot; is smaller than &quot;max&quot;.
    lda addr
    cmp #&lt;(max)
    lda HIBYTE_OFFSET_1+addr
    sbc #&gt;(max)
    bvc :+
    eor #$80
:
    bmi is_less_than_or_equ_to_max
    ; Bigger than maximum, clamp.
    lda #&lt;(max)
    sta addr
    lda #&gt;(max)
    sta HIBYTE_OFFSET_1+addr
    
is_less_than_or_equ_to_max:
    ; If we branched here, min &lt; addr &lt; max
    
out:
.endmacro<br><br>; Usage example:
signed_clamp16 variable, -123, 123
</pre>
There&apos;s a lot that can go wrong when messing with numbers, no shame in that. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__445">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Dec 14, 2014 at 3:57:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	In any case, you don&apos;t really need to understand how the code works to use it.<br>
	<br>
	&#xA0;</div>
<br>
OCD. The real kind.<br>
Thanks for the code, I&apos;ll go through it with pen and paper so I understand all of it. If I can&apos;t get<br>
the basics of handling numbers down, I might as well just go back to make shit in Java and C++ for PC.<br>
I have no intention of doing that tho. <span class="sprites_emoticons absmiddle" id="emo_tongue"></span><br>
<br>
Again, thanks a lot!<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__446">
                                                        <div class="mdl-card__title"><strong>Baka94</strong> posted on 
		
			
				
				Dec 15, 2014 at 6:01:08 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here are few questions I need answers for:
<br>1. How do I change what&apos;s loaded to the pattern tables? Do I just set PPU address register ($2006) to either $0000 or $1000 and load new pattern table with PPU data register ($2007)?
<br>2. How do I make MMC3 mapper have save RAM and in what range of addresses it is located at?
<br>3. Should I write data that I want to have saved always in the save RAM area or write there only when game saves?
<br>
<br>(If some of the save RAM stuff is assembler specific, I&apos;m using NESASM3)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__447">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 15, 2014 at 7:15:02 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					1) If you have CHR-RAM, yes.
<br>2) Save RAM is generally the same thing that is called PRG RAM or WRAM, located at $6000. For MMC3, you need to have the save RAM on board, then use $A001 to enable or write protect it.
<br>3) You can use the extra RAM as a normal RAM, it is up to you what to store there and how to manage it. It only turns into &apos;save&apos; (i.e. stores its content while game is not powered on) when it is battery backed.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__448">
                                                        <div class="mdl-card__title"><strong>Baka94</strong> posted on 
		
			
				
				Dec 15, 2014 at 8:51:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	1) If you have CHR-RAM, yes.</div>
So, does this mean that if I don&apos;t use a memory mapper (just the NROM board) I can&apos;t change pattern tables at all?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__449">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 15, 2014 at 9:06:20 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Mapper does not matter here. It only depends on what you have on the cartridge board on the PPU bus - ROM or RAM. If your board uses ROM for CHR (normal for NROM and most other boards), you won&apos;t be able to rewrite its contents, and if your board uses RAM for CHR, you will always have to rewrite it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__450">
                                                        <div class="mdl-card__title"><strong>Baka94</strong> posted on 
		
			
				
				Dec 15, 2014 at 1:42:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	Mapper does not matter here. It only depends on what you have on the cartridge board on the PPU bus - ROM or RAM. If your board uses ROM for CHR (normal for NROM and most other boards), you won&apos;t be able to rewrite its contents, and if your board uses RAM for CHR, you will always have to rewrite it.</div>
If the mapper doesn&apos;t matter, then how do I specify if I have CHR RAM or ROM? Like I said earlier, I use NESASM3 (if that even matters).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__451">
                                                        <div class="mdl-card__title"><strong>MadnessVX</strong> posted on 
		
			
				
				Dec 15, 2014 at 3:23:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Got a few newbie questions: I&apos;m trying to use the Sunsoft Mapper FME 5B, and while I (think) I understand so far how to organize my banks using <a href="http://wiki.nesdev.com/w/index.php/Sunsoft_FME-7" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/Sunsoft_FME-7">THIS</a> as reference, how do I set up the ines header?<br>
<br>
From what I have seen in tutorials so far, the header specifies 16KB prg banks at a time and from what I am seeing, there are 5 8KB banks for this mapper. Would I simply set it to .inesprg 3, then for the graphics .ineschr 1? Or would specifying the correct mapper change that to 8KB banks, in which case I would set it to .inesprg 5?<br>
<br>
Thanks for your help! And if anyone has any other articles I can go over for this mapper, I would really appreciate taking a peek at those.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__452">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 15, 2014 at 5:01:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Baka94, you &apos;specify&apos; it by the board configuration itself. For emulators you can just set the number of CHR banks in the iNES header to zero, this means the game uses CHR RAM. However, it is not guaranteed that all emulators will act like this for those configurations that does not typically use CHR RAM (such as NROM).
<br>
<br>MadnessVX, you have to specify number of 16K banks in the iNES header. Internal banks granularity is up to the mapper, it is not reflected in the header in any way other than the mapper ID. NESASM also throws in the unnecessary 8K bank granularity, inherited from the PCE roots of the tool.
<br>
<br>For both questions, I&apos;d recommend to switch to CA65, it is way more flexible in creating various complex configurations. It may feel a bit difficult to understand at beginning, but it is worth the trouble.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__453">
                                                        <div class="mdl-card__title"><strong>MadnessVX</strong> posted on 
		
			
				
				Dec 17, 2014 at 1:51:08 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the reply. After spending half the day trying to get a hold of ca65, I finally found out it was part of cc65.<br>
I took a look at some example code from nesdev, but how everything is structured went way over my head. If it will help me in the end, are there any write-ups specifically using ca65 to write for the NES? Thanks for your time.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__454">
                                                        <div class="mdl-card__title"><strong>Baka94</strong> posted on 
		
			
				
				Dec 17, 2014 at 3:17:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	Baka94, you &apos;specify&apos; it by the board configuration itself. For emulators you can just set the number of CHR banks in the iNES header to zero, this means the game uses CHR RAM. However, it is not guaranteed that all emulators will act like this for those configurations that does not typically use CHR RAM (such as NROM).</div>
<br>
I guess I still need some CHR ROM to store the graphics anyway. Then load parts that I want in the CHR RAM and put them to the pattern tables through $2006 and $2007.<br>
<br>
It seems that iNES mapper 119 is only MMC3 mapper that uses both CHR ROM and RAM, so I&apos;ll probably use that.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__455">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 17, 2014 at 3:52:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					MadnessVX, I&apos;m not sure if there are write ups on the ca65 for NES, I actually figured out how the linker config works by examining existing configs and reading the docs. I think it is a good idea to just get existing config and experiment with changing it a bit. There should be templates for a few popular mappers somewhere on NesDev.
<br>
<br>Baka94, no, you can&apos;t have CHR ROM and CHR RAM at the same time (not in any of existing configs, at least). The whole point of having CHR RAM is to get rid of CHR ROM, and use PRG ROM to store (compressed) graphics instead. Also, don&apos;t mess up CHR RAM with the Save RAM (WRAM, PRG RAM), these are two different things.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__456">
                                                        <div class="mdl-card__title"><strong>Baka94</strong> posted on 
		
			
				
				Dec 17, 2014 at 8:39:59 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	Baka94, no, you can&apos;t have CHR ROM and CHR RAM at the same time (not in any of existing configs, at least). The whole point of having CHR RAM is to get rid of CHR ROM, and use PRG ROM to store (compressed) graphics instead. Also, don&apos;t mess up CHR RAM with the Save RAM (WRAM, PRG RAM), these are two different things.</div>
<br>
Okay. Do I still need to put the CHR data to the PPU Pattern tables manually after putting it to CHR RAM? Or does the PPU do that automatically like with CHR ROM?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__457">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 17, 2014 at 9:02:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you use CHR RAM, you will always have to put something there with your code. Otherwise you&apos;ll have random garbage instead of graphics (on the hardware), or blank tileset (in emulators). PPU does not do anything automatically, it does not even know any difference between CHR ROM, CHR RAM, or lack of ROM/RAM (you can even wire it up so it&apos;ll use its own nametable RAM). PPU does not automatically put anything into CHR ROM, it is basic feature of the ROM itself, to keep preprogrammed information. ROM is not programmable by PPU/CPU, it is only programmed during manufacturing process.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__458">
                                                        <div class="mdl-card__title"><strong>Baka94</strong> posted on 
		
			
				
				Dec 18, 2014 at 2:41:01 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	If you use CHR RAM, you will always have to put something there with your code. Otherwise you&apos;ll have random garbage instead of graphics (on the hardware), or blank tileset (in emulators). PPU does not do anything automatically, it does not even know any difference between CHR ROM, CHR RAM, or lack of ROM/RAM (you can even wire it up so it&apos;ll use its own nametable RAM). PPU does not automatically put anything into CHR ROM, it is basic feature of the ROM itself, to keep preprogrammed information. ROM is not programmable by PPU/CPU, it is only programmed during manufacturing process.</div>
<br>
What I meant was that when you put the .chr file in your code like this:<br>
<br>
<code>&#xA0;.bank 2<br>
&#xA0;.org $0000<br>
&#xA0;.incbin &quot;Graphics.chr&quot;</code><br>
<br>
You don&apos;t need to do anything else to make it appear in the pattern tables. This is when using CHR ROM at least.<br>
<br>
So, after loading the graphics to the CHR RAM, I then need to use $2006 and $2007 registers to write it to the pattern tables?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__459">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 18, 2014 at 4:32:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That code is just a directive to your assembler to insert the graphics.chr binary into final output at certain place, where emulator expect to see CHR ROM data. If you were making a cartridge out of this file, you would need to separate the CHR part, and burn it into a separate ROM chip, which would became CHR ROM.
<br>
<br>Pattern tables are located in CHR memory, either CHR ROM (preprogrammed) or CHR RAM (programmable). So you can say they are the CHR ROM or CHR RAM. You load the graphics into the CHR RAM by using $2006/7, so it become your pattern tables.
<br>
<br>Honestly, you just really need to learn the basics first, like NES and cartridge architecture, the idea of separate CPU/PPU address spaces, NES memory map.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__460">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Dec 18, 2014 at 6:20:32 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have a glitch in one of my games that is starting to get really annoying...<br>
I&apos;m trying to have my enemies &quot;alive&quot; on two nametables. This routine works great, however, it always thinks it&apos;s on nametable 1 when the scroll variable is at $00. The position of the enemies is contained in the enemyposx/enemyposy variables, and the enemiesnametable variable is the nametable the enemies are supposed to be on. The variables work fine according to the FCEUX hex editor, so I definitely think the problem is in that routine<br>
Sorry for the lack of annotations, I sometimes (90% of the time <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>) forget to annotate my stuff<br>
<br>
LDX #$00<br>
LDY #$00<br>
SpritesPosLoop:<br>
LDA enemiesnametable,y<br>
BEQ NT0<br>
LDA enemiesposy,y<br>
STA $0224,x<br>
LDA enemiesposx,y<br>
SEC<br>
SBC scroll<br>
CMP enemiesposx,y<br>
BCC HideSprite2<br>
.keepon2<br>
STA $0227,x<br>
JSR BuildMetaEnemy<br>
JMP SpriteDone<br>
HideSprite2:<br>
LDA #$F0<br>
STA $0224,x<br>
STA $0227,x<br>
<br>
JSR BuildMetaEnemy<br>
<br>
JMP SpriteDone<br>
NT0:<br>
LDA enemiesposy,y<br>
STA $0224,x<br>
LDA enemiesposx,y<br>
SEC<br>
SBC scroll<br>
CMP enemiesposx,y<br>
BCS HideSprite<br>
.keepon<br>
STA $0227,x<br>
JSR BuildMetaEnemy<br>
JMP SpriteDone<br>
HideSprite:<br>
LDA #$F0<br>
STA $0224,x<br>
STA $0227,x<br>
JSR BuildMetaEnemy<br>
SpriteDone:<br>
LDA $022B,x<br>
CMP #$08<br>
BCS NoHide<br>
LDA #$F0<br>
STA $0228,x<br>
STA $0230,x<br>
NoHide:<br>
<br>
LDA enemiesposx,y<br>
BEQ SetNT1<br>
JMP NTCheckDone<br>
SetNT1:<br>
LDA enemiesnametable,y<br>
BNE SetNT0<br>
LDA #$01<br>
STA enemiesnametable,y<br>
JMP NTCheckDone<br>
SetNT0:<br>
LDA #$00<br>
STA enemiesnametable,y<br>
NTCheckDone:<br>
<br>
TXA<br>
CLC<br>
ADC #$10<br>
TAX<br>
INY<br>
CPY #$04<br>
BEQ .endsprpos<br>
JMP SpritesPosLoop<br>
.endsprpos
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__461">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Dec 18, 2014 at 4:05:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m not really sure what&apos;s wrong.  I see that when you do the SEC/SBC Scroll, you use BCC and BCS, not the same.  Not sure if that&apos;s intentional.  For me, if I run across a bug I can&apos;t find, I&apos;ll just delete the routine and re-write it.  Usually works and is faster than chasing down a stupid bug.
<br>
<br>I might be looking at it wrong, but wouldn&apos;t the &quot;ADC #$10&quot; at the bottom be &quot;ADC #$04&quot; if you&apos;re looking for the next sprite?
<br>
<br>
<br>
<br>A couple suggestions:
<br>
<br>Use the local references, the period before the address, in all things that aren&apos;t routines.  Like your &quot;SetNT1&quot;, &quot;SetNT0&quot;, &quot;NoHide&quot;, etc.  This makes it a lot easier to avoid using the same &quot;address&quot; twice and keeps it simple cause you know anything without a period is a routine.  
<br>
<br>Next, on the sprite references, you should consider using something like &quot;Sprite_RAM&quot; for $0224 and &quot;Sprite_RAM+3&quot; for $0227.  If you ever realize, oh fuck, I have need sprite zero for something, or oh ball sack, I need 2 more bullets in my bullet routines and you need to add them in, you&apos;ll be forever chasing down these hard-coded references.  If you have &quot;Sprite_RAM = $0224&quot; and you need to insert one, you only have to change it to &quot;Sprite_RAM = $0228&quot; not 1000 times throughout your entire program.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__462">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Dec 18, 2014 at 5:35:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	I&apos;m not really sure what&apos;s wrong. I see that when you do the SEC/SBC Scroll, you use BCC and BCS, not the same. Not sure if that&apos;s intentional. For me, if I run across a bug I can&apos;t find, I&apos;ll just delete the routine and re-write it. Usually works and is faster than chasing down a stupid bug.<br>
	<br>
	I might be looking at it wrong, but wouldn&apos;t the &quot;ADC #$10&quot; at the bottom be &quot;ADC #$04&quot; if you&apos;re looking for the next sprite?<br>
	<br>
	<br>
	<br>
	A couple suggestions:<br>
	<br>
	Use the local references, the period before the address, in all things that aren&apos;t routines. Like your &quot;SetNT1&quot;, &quot;SetNT0&quot;, &quot;NoHide&quot;, etc. This makes it a lot easier to avoid using the same &quot;address&quot; twice and keeps it simple cause you know anything without a period is a routine.<br>
	<br>
	Next, on the sprite references, you should consider using something like &quot;Sprite_RAM&quot; for $0224 and &quot;Sprite_RAM+3&quot; for $0227. If you ever realize, oh fuck, I have need sprite zero for something, or oh ball sack, I need 2 more bullets in my bullet routines and you need to add them in, you&apos;ll be forever chasing down these hard-coded references. If you have &quot;Sprite_RAM = $0224&quot; and you need to insert one, you only have to change it to &quot;Sprite_RAM = $0228&quot; not 1000 times throughout your entire program.</div>
<br>
Thanks for the tips, this will definitely help me for my games. Also, I managed to fix the glitch (<br clear="all"><div class="col-md-6"><div class="embed-responsive embed-responsive-16by9"><a href="https://www.youtube.com/P3ALwKeSEYs">Youtube</a></div></div><br clear="all">) by condensing the routine and adding a small check for when you&apos;re on the spot where the glitch was occuring. It works fine now.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__463">
                                                        <div class="mdl-card__title"><strong>MadnessVX</strong> posted on 
		
			
				
				Dec 21, 2014 at 3:13:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					For anyone using ca65: I am beginning to understand how everything is setup using Rainwarriors example, but there is a file that I did not find in the CFG or the BAT file called NESPROJECT File that I need clarification on. What is the importance of this file to the newbie programmer? 
<br>
<br>I see its listing palettes, setting output file names, etc... But I thought stuff like this was setup in the actual asm file (Palette data) and in the cfg? When exactly is this file called? Everything seems to compile just fine even when I remove it.
<br>
<br>I think (hope) this is the last thing I need clarified before I feel comfortable switching over to ca65. Let me know if this file is even needed! Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__464">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 21, 2014 at 6:21:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This file is for NESICIDE (<a href="http://www.nesicide.com/" target="_blank" original-href="http://www.nesicide.com/">http://www.nesicide.com/...</a>), not needed when ca65 used stand-alone.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__465">
                                                        <div class="mdl-card__title"><strong>MadnessVX</strong> posted on 
		
			
				
				Dec 21, 2014 at 8:09:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Gotcha, out it goes then. Thanks!<br>
<br>
Edit:<br>
<br>
[SOLVED AT NESDEV]<br>
<br>
Ok, so if I wanted to setup the Sunsoft 5B mapper based off of this information:<br>
<ul>
	<li>
		CPU $6000-$7FFF: 8 KB Bankable PRG ROM or PRG RAM</li>
	<li>
		CPU $8000-$9FFF: 8 KB Bankable PRG ROM</li>
	<li>
		CPU $A000-$BFFF: 8 KB Bankable PRG ROM</li>
	<li>
		CPU $C000-$DFFF: 8 KB Bankable PRG ROM</li>
	<li>
		CPU $E000-$FFFF: 8 KB PRG ROM, fixed to the last bank of ROM</li>
	<li>
		PPU $0000-$03FF: 1 KB Bankable CHR ROM</li>
	<li>
		PPU $0400-$07FF: 1 KB Bankable CHR ROM</li>
	<li>
		PPU $0800-$0BFF: 1 KB Bankable CHR ROM</li>
	<li>
		PPU $0C00-$0FFF: 1 KB Bankable CHR ROM</li>
	<li>
		PPU $1000-$13FF: 1 KB Bankable CHR ROM</li>
	<li>
		PPU $1400-$17FF: 1 KB Bankable CHR ROM</li>
	<li>
		PPU $1800-$1BFF: 1 KB Bankable CHR ROM</li>
	<li>
		PPU $1C00-$1FFF: 1 KB Bankable CHR ROM</li>
</ul>
<br>
Would I need to write this:<br>
<br>
MEMORY {<br>
&#xA0;&#xA0;&#xA0; ZP:&#xA0;&#xA0;&#xA0;&#xA0; start = $00,&#xA0;&#xA0;&#xA0; size = $0100, type = rw, file = &quot;&quot;;<br>
&#xA0;&#xA0;&#xA0; OAM:&#xA0;&#xA0;&#xA0; start = $0200,&#xA0; size = $0100, type = rw, file = &quot;&quot;;<br>
&#xA0;&#xA0;&#xA0; RAM:&#xA0;&#xA0;&#xA0; start = $0300,&#xA0; size = $0500, type = rw, file = &quot;&quot;;<br>
&#xA0;&#xA0;&#xA0; HDR:&#xA0;&#xA0;&#xA0; start = $0000,&#xA0; size = $0010, type = ro, file = %O, fill = yes, fillval = $00;<br>
<span>&#xA0;&#xA0;&#xA0; PRG:&#xA0;&#xA0;&#xA0; start = $6000,&#xA0; size = $2000, type = ro, file = %O, fill = yes, fillval = $00;<br>
&#xA0;&#xA0;&#xA0; PRG:&#xA0;&#xA0;&#xA0; start = $8000,&#xA0; size = $2000, type = ro, file = %O, fill = yes, fillval = $00;<br>
&#xA0;&#xA0;&#xA0; PRG:&#xA0;&#xA0;&#xA0; start = $A000,&#xA0; size = $2000, type = ro, file = %O, fill = yes, fillval = $00;<br>
&#xA0;&#xA0;&#xA0; PRG:&#xA0;&#xA0;&#xA0; start = $C000,&#xA0; size = $2000, type = ro, file = %O, fill = yes, fillval = $00;<br>
&#xA0;&#xA0;&#xA0; PRG:&#xA0;&#xA0;&#xA0; start = $E000,&#xA0; size = $2000, type = ro, file = %O, fill = yes, fillval = $00;<br>
&#xA0;&#xA0;&#xA0; CHR:&#xA0;&#xA0;&#xA0; start = $0000,&#xA0; size = $0400, type = ro, file = %O, fill = yes, fillval = $00;<br>
&#xA0;&#xA0;&#xA0; CHR:&#xA0;&#xA0;&#xA0; start = $0400,&#xA0; size = $0400, type = ro, file = %O, fill = yes, fillval = $00;<br>
&#xA0;&#xA0;&#xA0; CHR:&#xA0;&#xA0;&#xA0; start = $0800,&#xA0; size = $0400, type = ro, file = %O, fill = yes, fillval = $00;<br>
&#xA0;&#xA0;&#xA0; CHR:&#xA0;&#xA0;&#xA0; start = $0C00,&#xA0; size = $0400, type = ro, file = %O, fill = yes, fillval = $00;<br>
&#xA0;&#xA0;&#xA0; CHR:&#xA0;&#xA0;&#xA0; start = $1000,&#xA0; size = $0400, type = ro, file = %O, fill = yes, fillval = $00;<br>
&#xA0;&#xA0;&#xA0; CHR:&#xA0;&#xA0;&#xA0; start = $1400,&#xA0; size = $0400, type = ro, file = %O, fill = yes, fillval = $00;<br>
&#xA0;&#xA0;&#xA0; CHR:&#xA0;&#xA0;&#xA0; start = $1800,&#xA0; size = $0400, type = ro, file = %O, fill = yes, fillval = $00;<br>
&#xA0;&#xA0;&#xA0; CHR:&#xA0;&#xA0;&#xA0; start = $1C00,&#xA0; size = $0400, type = ro, file = %O, fill = yes, fillval = $00;</span><br>
<span>Edit:<br>
Found out this does not work. readjusted to use:&#xA0; </span><br>
&#xA0;&#xA0;&#xA0; PRG:&#xA0;&#xA0;&#xA0; start = $6000,&#xA0; size = $A000, type = ro, file = %O, fill = yes, fillval = $00;<br>
&#xA0;&#xA0;&#xA0; CHR:&#xA0;&#xA0;&#xA0; start = $0000,&#xA0; size = $2000, type = ro, file = %O, fill = yes, fillval = $00;<br>
}<br>
<br>
Then would I need a segment for each of those banks 8KB banks? Or in the case of the chr, 1KB banks?<br>
<br>
SEGMENTS {<br>
&#xA0;&#xA0;&#xA0; ZEROPAGE: load = ZP,&#xA0; type = zp;<br>
&#xA0;&#xA0;&#xA0; OAM:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; load = OAM, type = bss, align = $100;<br>
&#xA0;&#xA0;&#xA0; RAM:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; load = RAM, type = bss;<br>
&#xA0;&#xA0;&#xA0; HEADER:&#xA0;&#xA0; load = HDR, type = ro;<br>
&#xA0;&#xA0;&#xA0; CODE0:&#xA0;&#xA0;&#xA0;&#xA0; load = PRG, type = ro,&#xA0; start = $6000;<br>
&#xA0;&#xA0;&#xA0; CODE1:&#xA0;&#xA0;&#xA0;&#xA0; load = PRG, type = ro,&#xA0; start = $8000;<br>
&#xA0;&#xA0;&#xA0; CODE2:&#xA0;&#xA0;&#xA0;&#xA0; load = PRG, type = ro,&#xA0; start = $A000;<br>
&#xA0;&#xA0;&#xA0; CODE3:&#xA0;&#xA0;&#xA0;&#xA0; load = PRG, type = ro,&#xA0; start = $C000;<br>
&#xA0;&#xA0;&#xA0; CODE4:&#xA0;&#xA0;&#xA0;&#xA0; load = PRG, type = ro,&#xA0; start = $E000;<br>
&#xA0;&#xA0;&#xA0; RODATA:&#xA0;&#xA0; load = PRG, type = ro;<br>
&#xA0;&#xA0;&#xA0; VECTORS:&#xA0; load = PRG, type = ro,&#xA0; start = $FFFA;<br>
&#xA0;&#xA0;&#xA0; TILES0:&#xA0;&#xA0;&#xA0; load = CHR, type = ro; (<span>Would I need to specify where they start as well?</span>)<br>
&#xA0;&#xA0;&#xA0; ETC...<br>
}<br>
<br>
Everything seems to compile fine so far, just winging it at the moment. Lemme know if this is horribly wrong!<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__466">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 28, 2014 at 11:48:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you&apos;re using RLE background compression for a two screen game which can scroll back and forth depending on the positioning of the player sprite, how is background collision handled?
<br>
<br>I am basically decompressing the first screen to RAM in $0400-$0700, but there obviously isn&apos;t enough room to decompress a second nametable.  I can&apos;t think of a way to load the middle values of RLE compressed collision data depending on what the scroll value is.  How is this usually handled?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__467">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Dec 29, 2014 at 4:31:31 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	If you&apos;re using RLE background compression for a two screen game which can scroll back and forth depending on the positioning of the player sprite, how is background collision handled?<br>
	<br>
	I am basically decompressing the first screen to RAM in $0400-$0700, but there obviously isn&apos;t enough room to decompress a second nametable. I can&apos;t think of a way to load the middle values of RLE compressed collision data depending on what the scroll value is. How is this usually handled?</div>
Whaaa, one screen $300 bytes in RAM? You can fit collision maps for 3 screens in there if you use 16*16 meta-tiles.<br>
I don&apos;t think RLE is used with scrolling. Don&apos;t you encode the collision data in the meta-tile definitions? Do you actually have separate collision maps stored in ROM?<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__468">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 29, 2014 at 10:45:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So it&apos;s basically impossible to do unless I switch to metatiles?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__469">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 29, 2014 at 11:28:52 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You can use RLE for one-axis scrolling game if the game levels has a lot of empty space. In case of horizontal scrolling, just store the columns vertically, un-RLE them on a per-column basis.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__470">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Dec 29, 2014 at 12:30:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Collision detection needs only a few accesses to the background so you can decompress as needed.  Dragon Warrior uses RLE for a full row of tiles, then has a pointer table to the start of each row.  To find an X/Y tile you look up the right row (Y) then decompress until you hit the right tile (X).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__471">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Dec 29, 2014 at 2:27:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	So it&apos;s basically impossible to do unless I switch to metatiles?</div>
<br>
May I ask why not use meta-tiles? It&apos;s compression in itself.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__472">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 29, 2014 at 8:37:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>KHAN Games</b></i><br>
		<br>
		So it&apos;s basically impossible to do unless I switch to metatiles?</div>
	<br>
	May I ask why not use meta-tiles? It&apos;s compression in itself.<br>
	&#xA0;</div>
<br>
Because I DoNotWant to! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Actually, I&apos;m going to now.&#xA0; It&apos;s just a pain in the ass to change my collision routines.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__473">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 30, 2014 at 5:26:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>KHAN Games</b></i><br>
		<br>
		So it&apos;s basically impossible to do unless I switch to metatiles?</div>
	<br>
	May I ask why not use meta-tiles? It&apos;s compression in itself.</div>
<br>
If the game background is composed by 16x16 regions, then the use of meta-tiles makes sense.<br>
If a game is designed with backgrounds composed by 8x8 regions, I don&apos;t see how meta-tiles can help.<br>
<br>
From his last reply, this is not Khan game case; but still, if a game background design freely mixes up many different 8x8 tiles, instead of being locked into 16x16 bigger tiles, then I think that the use of meta-tiles will not help simplifying things up.<br>
<br>
Just my two cents. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Please correct me if I am wrong.<br>
<br>
- user<br>
<br>
<strong>Edit</strong>: misspelling.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__474">
                                                        <div class="mdl-card__title"><strong>Dredster</strong> posted on 
		
			
				
				Jan 3, 2015 at 11:14:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					What is the deal with .bin files as NES roms ? I downloaded a monstrous rom collection and some are .bin files. I was really wondering about the game master rom. I am guessing it is the bios for the action game master. I was reading somewhere that a lot of NES roms used to be .bin files and that some old emulators accepted them. How do I get these to play ? They won&apos;t open through regular extraction. Can you use an assembler to attach them to something else and open them ?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__475">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Jan 4, 2015 at 1:33:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The NES ROMs with the *.nes extension isn&apos;t something that is related to the hardware. It is a (sort of propietary) format of an old emulator called iNES, hence this is the iNES format that was adopted by all emulators since then. The format itself is very simple, it is one or two binary files, contents of the PRG ROM and CHR ROM (if present) respectively, along with a 16-byte header that tells an emulator how to interpret this data and which hardware options the game uses. To make an iNES format ROM from these binary files, you need to glue them together and add the header with proper information. You don&apos;t need an assembler to do it, just a HEX editor, or one of the ROM split tools that also supports a backwards operation.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__476">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jan 5, 2015 at 8:55:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
If you&apos;re using RLE background compression for a two screen game which can scroll back and forth depending on the positioning of the player sprite, how is background collision handled?<br>
<br>
I am basically decompressing the first screen to RAM in $0400-$0700, but there obviously isn&apos;t enough room to decompress a second nametable. I can&apos;t think of a way to load the middle values of RLE compressed collision data depending on what the scroll value is. How is this usually handled?</div>
Pull the tile information from the background. &#xA0;<br>
<br>
i.e. Rather than STA $2007, use LDA $2007.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__477">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jan 7, 2015 at 8:45:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br><div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
If you&apos;re using RLE background compression for a two screen game which can scroll back and forth depending on the positioning of the player sprite, how is background collision handled?<br>
<br>
I am basically decompressing the first screen to RAM in $0400-$0700, but there obviously isn&apos;t enough room to decompress a second nametable. I can&apos;t think of a way to load the middle values of RLE compressed collision data depending on what the scroll value is. How is this usually handled?</div>
Pull the tile information from the background. &#xA0;<br>
<br>
i.e. Rather than STA $2007, use LDA $2007.<br>
&#xA0;</div><br><br><br>
This is definitely doable, but can&apos;t you update the collision RAM as the screen is scrolling? Also, I use metatiles for that stuff in one of my games and I have more than enough room in the RAM. 
Moreover, that game uses a status bar, which reduces the amount of RAM needed.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__478">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Jan 8, 2015 at 4:55:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Reading back VRAM to do collision detection is not something that you can see often, as you may need these reads with arbitary and relatively long delays between reads, while reading VRAM is only possilbe in the VBlank. Usually collision routines either do direct access to the map data, or use a RAM buffer for the current screen data.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__479">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jan 9, 2015 at 9:00:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yea, I agree, RAM or BG data is the way to go.  However, but for something like Bust A Nut, it was the only way I could figure out how to do it.  And, it was something that was good to learn.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__480">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 10, 2015 at 9:35:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Quick question: NROM 32kB of ROM plus 8kB of CHRROM.<br>
There are 256 sprites tiles, and 256 background tiles.<br>
Can I somehow, with rendering off, switch them?<br>
<br>
Scope: I have a new project for a game where I&apos;m using all the background chr tiles for the game itself, and I still need background tiles for the starting screen background. The sprites tiles are mostly empty, and the starting screen does not use sprites.<br>
<br>
Hence I thought to fit the starting screen tiles in the sprites &quot;side&quot;, start the game using the sprites tiles for background purposes, then switch after pushing start to the correct assignments: sprites tiles for the sprites, background tiles for the background.<br>
<br>
It is this possible? Reasonable coding wise?<br>
Or do I really have to use something different than NROM?<br>
<br>
Thanks! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user<br>
<br>
<strong>Edit</strong>: minor corrections.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__481">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jan 10, 2015 at 9:52:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Can&apos;t you just manipulate the bits that are writing to the $2000 address that controls which pattern table is used for sprites and which is used for background?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__482">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 10, 2015 at 9:57:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The PPU register $2000 (<a href="http://wiki.nesdev.com/w/index.php/PPU_registers#Controller_.28.242000.29_.3E_write" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_registers#Controller_.28.242000.29_.3E_write">http://wiki.nesdev.com/w/index.ph...</a>) determines which 4KB pattern table is for bg and which is sprites.  They can also both use the same set, or be changed at (almost) anytime.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__483">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 10, 2015 at 9:58:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank you both. This was what I was asking: if I turn rendering off, can I do this? <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>Thanks! Appreciated!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__484">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jan 10, 2015 at 10:51:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You can do it either way, as far as I know!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__485">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 11, 2015 at 12:47:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	You can do it either way, as far as I know!</div>
Thanks. I badly wish to be able to test on real hardware.<br>
When new experiments work on an emulator, I always have the doubt they will not on real hardware.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__486">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 13, 2015 at 1:42:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	The PPU register $2000 (<a href="http://wiki.nesdev.com/w/index.php/PPU_registers#Controller_.28.242000.29_.3E_write" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_registers#Controller_.28.242000.29_.3E_write">http://wiki.nesdev.com/w/index.php/PPU_registers#Controller_...</a> ) determines which 4KB pattern table is for bg and which is sprites. <strong>They can also both use the same set</strong>, or be changed at (almost) anytime.</div>
<br>
And this is a great news. It works perfectly on emulator after switching rendering off to load the new background, then&#xA0; turning it on again with the new background loaded from the other pattern table; and it allows to have sprites on screen from the same pattern table too. This solves the project needs completely. Thanks again to both!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__487">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 15, 2015 at 10:50:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m working on this other experimental project too, the car racing game (Super Sprint like or Super Off Road like) I was talking about few posts above, and I have three quick questions:<br>
<br>
1. Scrolling<br>
I got advice here to start from an easy horizontal scrolling, so I decided to have long shaped tracks rather than squared shaped tracks. I mean, fi, to have tracks 1x4 screen rather than 2x2 screens. I know there is a nice page on nesdev wiki (IIRC) on how to do horizontal scrolling correctly, but I can&apos;t find it. Anyone can help?<br>
<br>
2. Sprite 0 collision<br>
What is that exactly? Is there a page explaining it deeply?<br>
If so please point it out, I can&apos;t find anything except vague references to it.<br>
<br>
3. Nes Four Score<br>
Is there a good page on what to do if I want the game to support the NES four score?<br>
<br>
Thanks in advance to anyone can help. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user<br>
<br>
<strong>Edit</strong>: added alpha 0000000001 file.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__488">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jan 16, 2015 at 9:15:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Bunnyboy did a tutorial on scrolling and the sprite 0 stuff.  It&apos;s in Roth&apos;s organization thread.  
<br>
<br>IIRC, to handle the four score, you just read the controller 1 and 2 ports a second time...so you&apos;d read them like 1, 2, 1, 2 and store the data you get in the controller variables for 1, 2, 3, 4.  Then the controller variables run just like the others.  Been a while since I messed with this though.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__489">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jan 16, 2015 at 9:48:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	Bunnyboy did a tutorial on scrolling and the sprite 0 stuff. It&apos;s in Roth&apos;s organization thread.<br>
	<br>
	IIRC, to handle the four score, you just read the controller 1 and 2 ports a second time...so you&apos;d read them like 1, 2, 1, 2 and store the data you get in the controller variables for 1, 2, 3, 4. Then the controller variables run just like the others. Been a while since I messed with this though.</div>
<br>
The four score reads players 1 &amp; 3 from $4016 and 2 &amp; 4 from $4017. Also, I think you have to add some extra reads to determine if the switch is in 2 or 4 player mode on the four score. I think you end up reading each 24 times.<br>
<br>
Here is where I got my info when I was looking at the four score a few months ago.<br>
<br>
<a href="http://wiki.nesdev.com/w/index.php/Four_score" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/Four_score">http://wiki.nesdev.com/w/index.ph...</a><br>
<br>
I thought I found someone&apos;s sample code a while back, but I can&apos;t seem to find it anymore. I shortly gave up on this and moved to my power pad project.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__490">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jan 16, 2015 at 3:21:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	I&apos;m working on this other experimental project too, the car racing game (Super Sprint like or Super Off Road like) I was talking about few posts above, and I have three quick questions:<br>
	<br>
	1. Scrolling<br>
	I got advice here to start from an easy horizontal scrolling, so I decided to have long shaped tracks rather than squared shaped tracks. I mean, fi, to have tracks 1x4 screen rather than 2x2 screens. I know there is a nice page on nesdev wiki (IIRC) on how to do horizontal scrolling correctly, but I can&apos;t find it. Anyone can help?<br>
	<br>
	2. Sprite 0 collision<br>
	What is that exactly? Is there a page explaining it deeply?<br>
	If so please point it out, I can&apos;t find anything except vague references to it.<br>
	<br>
	3. Nes Four Score<br>
	Is there a good page on what to do if I want the game to support the NES four score?<br>
	<br>
	Thanks in advance to anyone can help.<br>
	<br>
	- user<br>
	<br>
	<strong>Edit</strong>: added alpha 0000000001 file.</div>
<br>
<br>
About sprite zero: I made a little parallax scrolling demo that involves Sprite Zero. Dunno if it helps<br>
<br>
<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=138967" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=138967">http://www.nintendoage.com/forum/...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__491">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 16, 2015 at 3:55:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here are the executive summaries, with links to more info. &#xA0;Ask more specifics if needed!
<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
<br>
1. Scrolling<br>
I got advice here to start from an easy horizontal scrolling, so I decided to have long shaped tracks rather than squared shaped tracks. I mean, fi, to have tracks 1x4 screen rather than 2x2 screens. I know there is a nice page on nesdev wiki (IIRC) on how to do horizontal scrolling correctly, but I can&apos;t find it. Anyone can help?</div>
For horizontal scrolling, you will write columns of tiles in the off screen area and use $2005 to set the scroll point. &#xA0;Use a nametable viewer in emulator to watch a game like SMB to see the off screen data being written. &#xA0;<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36958" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36958">http://www.nintendoage.com/forum/...</a><br>
<br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
<br>
2. Sprite 0 collision<br>
What is that exactly? Is there a page explaining it deeply?</div>
<br>
When a non-transparent pixel on the first sprite overlaps with a non-transparent pixel on the background, a PPU flag is set. &#xA0;Your code polls the flag to wait for that point of the screen to be drawn. &#xA0;Normally used for split screen scrolling without extra hardware, like SMB. &#xA0;<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36969" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36969">http://nintendoage.com/forum/mess...</a><br>
<br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
<br>
3. Nes Four Score<br>
Is there a good page on what to do if I want the game to support the NES four score?</div>
Read $4016 8x to get controller 1 like normal. &#xA0;Then read 8x again to get controller 3. &#xA0;Then read 8x again to get the signature byte. &#xA0;If signature byte is not correct, then there is no Four Score or it is in the 2 player position, so ignore data for controller 3. &#xA0;Same for $4017 to get controllers 2 and 4. &#xA0;<a href="http://wiki.nesdev.com/w/index.php/Four_score" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/Four_score">http://wiki.nesdev.com/w/index.ph...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__492">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 16, 2015 at 4:31:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Wow!<br>
<br>
Thanks to MRN, MMM, Vec, and BB, for all the answers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
I noted down all the links (including Vec demo), I will look at them in the next days. I didn&apos;t remember NN had also chapters about this stuff. It is more vast than what I remember, it will be good to read it once again after few months (it was September when I followed it up start to end)..<br>
<br>
In the meanwhile, I expanded the demo, finding also a nice way to display the car with 2 sprites:<br>
<strong>L/R turn<br>
A/B decelerate/accelerate</strong><br>
The speed should feel constant (when speed hor/vert +3 &gt;&gt; diagonal +2x +2y, not exactly sqr(2)/2, but good enough I guess). The final controls are going to be different, I have something cool in mind about it, but these controls are good to test out stuff to implement.<br>
<br>
Time for me to learn these new concepts. Thanks again!<br>
<br>
- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__493">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 16, 2015 at 7:02:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	Here are the executive summaries, with links to more info. &#xA0;Ask more specifics if needed!<br>
	<br>
	When a non-transparent pixel on the first sprite overlaps with a non-transparent pixel on the background, a PPU flag is set. &#xA0;Your code polls the flag to wait for that point of the screen to be drawn. &#xA0;Normally used for split screen scrolling without extra hardware, like SMB.</div>
<br>
I was thinking of a completely different use of it. Let say sprite 0 is the front of the car (see attachment above), and the track is like this (800% zoom, and yes, I know the track is too thin, this is just an example to explain a concept I wish to implement) where the gray is the transparent color:<br>
<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/21264/photobucket/93C2A55F-D2B8-4753-FAEF48451E44AAC7.png" show-src="images/missing/93C2A55F-D2B8-4753-FAEF48451E44AAC7.png"><br>
<br>
1. Can I use sprite 0 collision to detect the fact that the car went off-track?<br>
<br>
2. If I have 4 cars, and each NMI I rotate which car uses the sprite 0 for its front (fi: <strong>red 0 </strong>blue yellow green &gt;&gt; next frame <strong>blue 0 </strong>yellow green red &gt;&gt; next frame <strong>yellow 0 </strong>green red blue &gt;&gt; next frame <strong>green 0 </strong>red blue yellow), can I use sprite 0 collision to detect, once every 4 NMI frames (ie. 1/15th of a second), if that car (red, blue, yellow, or green) went off track? I have an alternative plan about this, but this would make things way easier, if once every 4 frames would turn out to be an high enough detection frequency for off-tacks checks.<br>
<br>
3. Also, if the two above are true, when exactly (if a specific timing is needed) should the code perform this check?<br>
<br>
Thanks, Appreciated! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__494">
                                                        <div class="mdl-card__title"><strong>MadnessVX</strong> posted on 
		
			
				
				Jan 17, 2015 at 3:53:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					In that example, if the grey were set as the transparent color, I could see that working. At least I wouldn&apos;t see why not!<br>
<br>
I have not played with sprite zero much, but I would think you could just make a routine that checks the sprite zero flag and which car it belongs to each frame since it either overlaps or it&apos;s not.<br>
<br>
If it can work, that&apos;s a pretty neat idea.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__495">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jan 17, 2015 at 4:39:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>bunnyboy</b></i><br>
		<br>
		Here are the executive summaries, with links to more info. &#xA0;Ask more specifics if needed!<br>
		<br>
		When a non-transparent pixel on the first sprite overlaps with a non-transparent pixel on the background, a PPU flag is set. &#xA0;Your code polls the flag to wait for that point of the screen to be drawn. &#xA0;Normally used for split screen scrolling without extra hardware, like SMB.</div>
	<br>
	I was thinking of a completely different use of it. Let say sprite 0 is the front of the car (see attachment above), and the track is like this (800% zoom, and yes, I know the track is too thin, this is just an example to explain a concept I wish to implement) where the gray is the transparent color:<br>
	<br>
	<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/21264/photobucket/93C2A55F-D2B8-4753-FAEF48451E44AAC7.png" show-src="images/missing/93C2A55F-D2B8-4753-FAEF48451E44AAC7.png"><br>
	<br>
	1. Can I use sprite 0 collision to detect the fact that the car went off-track?<br>
	<br>
	2. If I have 4 cars, and each NMI I rotate which car uses the sprite 0 for its front (fi: <strong>red 0 </strong>blue yellow green &gt;&gt; next frame <strong>blue 0 </strong>yellow green red &gt;&gt; next frame <strong>yellow 0 </strong>green red blue &gt;&gt; next frame <strong>green 0 </strong>red blue yellow), can I use sprite 0 collision to detect, once every 4 NMI frames (ie. 1/15th of a second), if that car (red, blue, yellow, or green) went off track? I have an alternative plan about this, but this would make things way easier, if once every 4 frames would turn out to be an high enough detection frequency for off-tacks checks.<br>
	<br>
	3. Also, if the two above are true, when exactly (if a specific timing is needed) should the code perform this check?<br>
	<br>
	Thanks, Appreciated!<br>
	<br>
	- user</div>
<br>
<br>
<br>
If you do a sprite zero check to see if the car got out of the track, you can only have a transparent colour on the track, and it becomes a major hassle when you have 16x16 sprites and/or multiple sprites. Trust me, I thought about doing this too and it&apos;s not worth it. A better solution would be using the MMC1 because you have the additionnal WRAM, which expands the RAM by a LOT. That way, you have enough space to do collision checks on every part of the track. Also, you can load the data from the ROM and stick it in the aforementioned RAM each time you load a new track. With 256KB of ROM, you can have a lot of tracks in the game that way.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__496">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 17, 2015 at 9:10:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Vectrex280996</b></i><br>
	<br>
	If you do a sprite zero check to see if the car got out of the track, you can only have a transparent colour on the track, and it becomes a major hassle when you have 16x16 sprites and/or multiple sprites. Trust me,<strong> I thought about doing this too and it&apos;s not worth it</strong>. A better solution would be using the MMC1 because you have the additionnal WRAM, which expands the RAM by a LOT. That way, you have enough space to do collision checks on every part of the track. Also, you can load the data from the ROM and stick it in the aforementioned RAM each time you load a new track. With 256KB of ROM, you can have a lot of tracks in the game that way.</div>
<br>
<br>
Thanks for the reply.<br>
<br>
I got to your same (highlighted in <strong>bold</strong>) conclusions, but for different reasons: rotate between the cars sprites which one is sprite 0 is an added complexity, and it is too slow anyways being a check that would work only once every 4 frames, with 4 cars on the track.<br>
<br>
I implemented instead my alternative solution, which is check points (ie. a virtual line crossing the track each begin and end of a curve) that when crossed generate the coordinates of a &quot;box&quot; where the car is supposed to be next, and a quick &quot;collision&quot; routine with that box each subsequent frame (to make sure the car is inside it).<br>
<br>
Even using only 32kB of ROM space and not using WRAM, I am not facing ROM/RAM space issues so far, even with many tracks, since their data can be easily compressed; and the boxes generated only need 4 byte each. But I will in future look with interest to these alternatives you propose.<br>
<br>
Scrolling will not be included either, since with 4 players each can have his car in a different position of the track, so unless splitting the screen in 4 (not so simple to do on a NES), this cannot be implemented.<br>
<br>
So, ironically, since I implemented different solutions, everything I learned from the first two of the above three questions I asked, will likely be useful in future projects, but not on this specific project.<br>
<br>
Thanks to all for all the replies, it is useful to have a direct link to all these documents linked.<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user<br>
<br>
<br>
@MadnessVX<br>
With only one car, it would probably be an efficace solution, or at least make more sense &quot;collision reaction time&quot; wise.<br>
<br>
<strong>Edit</strong>: mispelling.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__497">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jan 25, 2015 at 2:11:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Forget it...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__498">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 27, 2015 at 5:02:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Three quick questions on sprite/backgrounds overlaps:
<br>
<br>1.
<br>
<br>You have the sprites data to transfer to the PPU each NMI in the page $0200 of the RAM.
<br>And you go from $0200 to $02ff when transferring that data to the PPU.
<br>
<br>So $0200 is the y coordinate of sprite 0, and $0203 is its x coordinate.
<br>And $0204 is the y coordinate of sprite 1, and $0207 is its x coordinate.
<br>
<br>Let say sprite 0 and sprite 1 have the same y coordinate, the same x coordinate, and the same pattern (ie. they overlap); the only thing which change is their attribute, which have the same orienting for both of them, but the subpalette used for the color is different: hence sprite 0 is, fi. red, and sprite 1 is, fi. blue.
<br>
<br>Which sprite will be in front, and which one will be hidden behind the other?
<br>i.e. would you see a red sprite or a blue sprite?
<br>
<br>I know I could set up a quick test on an emulator, but I wish to know for sure how this works on real hardware: sprite 0 is in front or behind sprite 1? And this holds true for all the sprites? I mean having 64 sprites sharing the same position and shape, the last one (ie. y-position $02fc, pattern $02fd, attribute $02fe, x-position $02ff) to be transferred to the PPU is the one which will be on front of all the previous others, or behind all the previous others?
<br>
<br>Thanks in advance to anyone has the answer, on real hardware, for sure.
<br>
<br>
<br>2.
<br>
<br>Also, I know about the fact that sprites can be in front or behind the background, but I can&apos;t remember where you set this option (I always had sprites in front and backgrounds behind so far in my games).
<br>
<br>
<br>3.
<br>
<br>Also, if you set a further color (fi. the second color of a specific subpalette) identical to the transparency color (ie. the first color of that specific subpalette), will that color be drawn, or will it be transparent?
<br>
<br>Let say you set the sprites in front of the background, have a background &quot;black red red red&quot; and the whole background area fully filled with a &quot;solid&quot; red background, and you set &quot;black black yellow green&quot; in a sprite subpalette: the area which use the second color of that sprite will be drawn black above the red &quot;solid&quot; background or not?
<br>I hope all this makes sense in English. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>
<br>Thank you in advance to anyone can help giving answer for sure on real hardware. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__499">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 27, 2015 at 5:13:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Vectrex280996</b></i><br>
<br>
Forget it...</div>
<br>
In case you haven&apos;t forgotten it, I don&apos;t remember seeing a wait for sprite 0 flag to be cleared first. &#xA0;The flag is cleared at the end of vblank, so if you check for it set before then you will get the results from the previous frame. &#xA0;Not sure if that was the problem but its something to check!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__500">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jan 27, 2015 at 5:16:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>Vectrex280996</b></i><br>
<br>
Forget it...</div>
<br>
In case you haven&apos;t forgotten it, I don&apos;t remember seeing a wait for sprite 0 flag to be cleared first. &#xA0;The flag is cleared at the end of vblank, so if you check for it set before then you will get the results from the previous frame. &#xA0;Not sure if that was the problem but its something to check!</div>
<br>
I fixed the problem actually <span class="sprites_emoticons absmiddle" id="emo_smile"></span> Also, I&apos;m lloking forward to see Beat &apos;em and Eat &apos;em on RetroUSB <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__501">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 27, 2015 at 5:22:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
<br>
Which sprite will be in front, and which one will be hidden behind the other?<br>
i.e. would you see a red sprite or a blue sprite?</div>
The sprite with the lower index has priority, so if both sprites have a non transparent pixel in the same spot then the sprite 0 pixel is drawn and sprite 1 is not. &#xA0;<a href="http://wiki.nesdev.com/w/index.php/PPU_sprite_priority" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_sprite_priority">http://wiki.nesdev.com/w/index.ph...</a><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
<br>
<span style="line-height: 1.6;">Also, I know about the fact that sprites can be in front or behind the background, but I can&apos;t remember where you set this option (I always had sprites in front and backgrounds behind so far in my games).</span></div>
<br>
Priority bit in the sprite attributes:&#xA0;<a href="http://wiki.nesdev.com/w/index.php/PPU_OAM" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_OAM">http://wiki.nesdev.com/w/index.ph...</a><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
<br>
Also, if you set a further color (fi. the second color of a specific subpalette) identical to the transparency color (ie. the first color of that specific subpalette), will that color be drawn, or will it be transparent?<br>
<br>
Let say you set the sprites in front of the background, have a background &quot;black red red red&quot; and the whole background area fully filled with a &quot;solid&quot; red background, and you set &quot;black black yellow green&quot; in a sprite subpalette: the area which use the second color of that sprite will be drawn black above the red &quot;solid&quot; background or not?</div>
A transparent sprite pixel does not get drawn. &#xA0;But a pixel using the same color index (black) not in the transparent slot (first slot) will get drawn. &#xA0;So in your example if the sprite uses the first black (transparent) the picture will be red (background), and if it uses the second black (actually black) the picture will be black (sprite). &#xA0;This should probably have a cool sample image here... &#xA0;The slot is the important part, not the color itself. &#xA0;Hope that makes sense in English too &#xA0;<span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__502">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jan 27, 2015 at 5:27:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					user:<br>
<br>
1. The one lower down will be drawn on top. i.e. 0 on top of 1, 4 on top of 10, and 62 on top of 63, and so on.<br>
<br>
2. Bit %00X00000 of the sprite attributes specifies on top/behind bg. 0 is in front, 1 is behind.<br>
<br>
3. If I understand your question, the transparent color is always transparent when rendering sprites. Otherwise you&apos;d have a square running around all the time.<br>
<br>
Beat me to it with a better answer!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__503">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 27, 2015 at 5:41:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	A transparent sprite pixel does not get drawn. &#xA0;But a pixel using the same color index (black) not in the transparent slot (first slot) will get drawn. &#xA0;So in your example if the sprite uses the first black (transparent) the picture will be red (background), and if it uses the second black (actually black) the picture will be black (sprite). &#xA0;This should probably have a cool sample image here... &#xA0;The slot is the important part, not the color itself. &#xA0;Hope that makes sense in English too &#xA0;</div>
Yes, #3 you got my question right, I don&apos;t know if makes sense in English, but makes sense to me <span class="sprites_emoticons absmiddle" id="emo_wink"></span><br>
<br>
And...<br>
Wow! Thanks to both (including MarioRN) for the quick answers.<br>
<br>
Really appreciated! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__504">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Feb 4, 2015 at 8:43:59 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is something that has always given me trouble (along with sprites in general), but what would be some different ways to program autonomous sprite movement? I understand getting something to move through player input, or even if it is hard coded from the get go (as in the ball in Pong), but what if one wants more control? Just to keep things simple, say when the A button is pressed, the player sprite walks several steps and then stops. At the moment, all I can get him to do is jump to a new location. Any help would be great!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__505">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 4, 2015 at 9:11:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					At that point, you might consider what some call an object or entity system. In other words, you&apos;ll have chunks of RAM devoted to tracking where a certain object currently is, and other information about that object&apos;s state. In addition to that you might have a special routine for specific types of objects that are dedicated to updating the state for that object. From there, it would be a matter of coming up with a state machine appropriate to that object. Let me see if I can whip up a pseudo-asm example. Note I did not compile any of this, and I&apos;m terribly lazy so don&apos;t try to import it directly in your code. Instead try to understand the concepts, then write it yourself. Also, I left out any drawing code. See if you can extend the below ideas to have another look up table for pointing to sprites or meta sprites for each type of entity. And please use actual labels for your zp variables, don&apos;t hard code them like I did for this fast and loose example.<br>
<br>
<div>
	&#xA0;</div>
<div>
	;this example assumes zp location $00 is used for entity type</div>
<div>
	;and assumes locations $01 and $02 are a 16 bit address for calling an</div>
<div>
	;entity update.</div>
<div>
	&#xA0;</div>
<div>
	;RAM</div>
<div>
	MAX_ENTITIES = 16</div>
<div>
	&#xA0;</div>
<div>
	entity_type: .res MAX_ENTITIES</div>
<div>
	entity_state: .res MAX_ENTITIES</div>
<div>
	entity_alive: .res MAX_ENTITIES</div>
<div>
	entity_x: .res MAX_ENTITIES</div>
<div>
	entity_y: .res MAX_ENTITIES</div>
<div>
	entity_local0: .res MAX_ENTITIES</div>
<div>
	entity_local1: .res MAX_ENTITIES</div>
<div>
	;add as many extra arrays as you think your entities may need to use</div>
<div>
	<br>
	kill_all_entities:<br>
	<br>
	&#xA0; ;TODO: Write code to set all entity_alive values to 0 before you create any entities.<br>
	<br>
	&#xA0; rts<br>
	&#xA0;</div>
<div>
	;routine for creating an entity</div>
<div>
	;assumes zp location $00 contains type of entity to create.</div>
<div>
	;please in your own code, don&apos;t hard code $00, use a zp label</div>
<div>
	create_entity:</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; ;find a dead entity</div>
<div>
	&#xA0; ldy #(MAX_ENTITIES-1)</div>
<div>
	next_entity:</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; lda entity_alive</div>
<div>
	&#xA0; beq found_dead_entity</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; dey</div>
<div>
	&#xA0; bpl next_entity<br>
	<div>
		&#xA0; ;if y is negative, all entity slots are in use so we can&apos;t spawn this one</div>
	<div>
		&#xA0; bmi cannot_spawn_entity</div>
</div>
<div>
	found_dead_entity:</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; ;here, y points to an entity slot that is dead so we can make a new one</div>
<div>
	&#xA0; lda #1</div>
<div>
	&#xA0; sta entity_alive,y<br>
	&#xA0; ;this routine assumes that we stored the desired entity type in $00. This would be from the equates below such as ENTITY_TYPE_SLIME for example. This value will be used later to know which &quot;brain&quot; routine to call for this entity.</div>
<div>
	&#xA0; lda $00</div>
<div>
	&#xA0; sta entity_type,y</div>
<div>
	&#xA0; ;we assume all entities have an init state assigned to slot 0</div>
<div>
	&#xA0; lda #0</div>
<div>
	&#xA0; sta entity_state,y</div>
<div>
	&#xA0;</div>
<div>
	cannot_spawn_entity:</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; rts</div>
<div>
	&#xA0;</div>
<div>
	;routines for updating all the entities every frame (outside of nmi, not during. in nmi, hopefully all you would be doing is updating sprite OAM..I left out all drawing concerns in this example, however)</div>
<div>
	update_entities:</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; ldy #(MAX_ENTITIES-1)</div>
<div>
	next_entity1:</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; lda entity_alive,y</div>
<div>
	&#xA0; beq entity_not_alive1</div>
<div>
	&#xA0; lda entity_type,y</div>
<div>
	&#xA0; tax</div>
<div>
	&#xA0; lda entity_brain_lo,x</div>
<div>
	&#xA0; sta $01</div>
<div>
	&#xA0; lda entity_brain_hi,x</div>
<div>
	&#xA0; sta $02</div>
<div>
	&#xA0; jsr indirect_jsr_01</div>
<div>
	entity_not_alive1:</div>
<div>
	&#xA0;</div>
<div>
	&#xA0; dey</div>
<div>
	&#xA0; bpl next_entity1</div>
<div>
	&#xA0;</div>
<div>
	indirect_jsr_01:</div>
<div>
	&#xA0; jmp ($01)</div>
<div>
	&#xA0;</div>
<div>
	;entity types</div>
<div>
	ENTITY_TYPE_SLIME = 0</div>
<div>
	ENTITY_TYPE_BULLET = 1</div>
<div>
	ENTITY_TYPE_WOLF = 2</div>
<div>
	&#xA0;</div>
<div>
	;look up table for entity brains</div>
<div>
	entity_brain_lo:</div>
<div>
	&#xA0; .byte ;for some reason the damn forum keeps erasing my lobyte (html tag??) symbols. This is the same as below only with less than signs instead of greater than signs as in the below look up table.<slime_update, div>
	<div>
		&#xA0;</div>
	<div>
		entity_brain_hi:</div>
	<div>
		&#xA0; .byte &gt;slime_update, &gt;bullet_update, &gt;wolf_update</div>
	<div>
		<br>
		;these equates represent the various states an entity can transition between.<br>
		;in this example, we have designed it so all entities are expected to have an &quot;init&quot;<br>
		;state in slot 0. This init branch should be used to set up the entity&apos;s variables when first created.<br>
		;the init state will typically then transition to another state that does something interesting like moving<br>
		<div>
			SLIME_STATE_INIT = 0</div>
		<div>
			SLIME_STATE_MOVE_RIGHT = 1</div>
		<div>
			SLIME_STATE_STOP = 2</div>
		<div>
			&#xA0;</div>
	</div>
	<div>
		;actual entity brain routines</div>
	<div>
		<br>
		slime_counter = entity_local0</div>
	<div>
		&#xA0;</div>
	<div>
		slime_update:</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; ;the y register at this point essentially is the &quot;THIS&quot; pointer,</div>
	<div>
		&#xA0; ;when we get here, we KNOW we have a live slime entity at the location</div>
	<div>
		&#xA0; ;in the entity arrays specified by y.</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; ;simple state switchboard. In actual practice, you may want to move to a</div>
	<div>
		&#xA0; ;look up table like I did above for entity update routines. But for simple</div>
	<div>
		&#xA0; ;experiments this is fine.</div>
	<div>
		&#xA0; lda entity_state,y</div>
	<div>
		&#xA0; cmp #SLIME_STATE_INIT</div>
	<div>
		&#xA0; beq slime_init</div>
	<div>
		&#xA0; cmp #SLIME_STATE_MOVE_RIGHT</div>
	<div>
		&#xA0; beq slime_move_right</div>
	<div>
		&#xA0; cmp #SLIME_STATE_STOP</div>
	<div>
		&#xA0; beq slime_stop</div>
	<div>
		&#xA0;</div>
	<div>
		slime_init:</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; lda #0</div>
	<div>
		&#xA0; sta entity_x,y</div>
	<div>
		&#xA0; sta entity_y,y</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; ;we&apos;re going to move right by 20 pixels</div>
	<div>
		&#xA0; lda #20</div>
	<div>
		&#xA0; sta slime_counter,y</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; lda #SLIME_STATE_MOVE_RIGHT</div>
	<div>
		&#xA0; sta entity_state,y</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; rts</div>
	<div>
		&#xA0;</div>
	<div>
		slime_move_right:</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; inc entity_x,y</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; dec slime_counter,y</div>
	<div>
		&#xA0; bne not_yet_zero</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; lda #SLIME_STATE_STOP</div>
	<div>
		&#xA0; sta entity_state,y</div>
	<div>
		&#xA0;</div>
	<div>
		not_yet_zero:</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; rts</div>
	<div>
		&#xA0;</div>
	<div>
		slime_stop:</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; ;we do nothing here</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; rts</div>
	<div>
		&#xA0;</div>
	<div>
		bullet_update:</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; ;bullet code here</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; rts</div>
	<div>
		&#xA0;</div>
	<div>
		wolf_update:</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; ;wolf code here</div>
	<div>
		&#xA0;</div>
	<div>
		&#xA0; rts</div>
	<div>
		&#xA0;</div>
	</slime_update,></div>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__506">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 4, 2015 at 10:14:54 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	This is something that has always given me trouble (along with sprites in general), but what would be some different ways to program autonomous sprite movement? I understand getting something to move through player input, or even if it is hard coded from the get go (as in the ball in Pong), but what if one wants more control? Just to keep things simple, say when the A button is pressed, the player sprite walks several steps and then stops. At the moment, all I can get him to do is jump to a new location. Any help would be great!</div>
A conceptual-only attempt to help.<br>
<br>
Programming AIs kind of behavior is fun and interesting to do, but time consuming to code and test out.<br>
<br>
I see 3 solution at first glance, surely there are more and maybe better ones:<br>
<br>
1. have countdown timer. When pushing A the motion starts following a set pattern and the timer is set, each NMI the timer decreases, when reaching 0 the motion ends.<br>
<br>
2. have a target x/y coordinates. When pushing A the motion starts following a set pattern, and each NMI the game check if the target x/y coordinates are reached (note: be careful on &quot;exact&quot; target coordinates, if the object can bypass them try to set as target the &quot;box&quot; inside x1 x2 y1 y2).<br>
<br>
3. have a set of instruction. When pushing A the motion starts following a set pattern on the first instruction, and each NMI the game check if the instruction is done and shifts to the next, the last instruction will be an arbitrary opcode (fi. FF) meaning &quot;task completed&quot;.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__507">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Feb 4, 2015 at 10:21:30 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
		<br>
		This is something that has always given me trouble (along with sprites in general), but what would be some different ways to program autonomous sprite movement? I understand getting something to move through player input, or even if it is hard coded from the get go (as in the ball in Pong), but what if one wants more control? Just to keep things simple, say when the A button is pressed, the player sprite walks several steps and then stops. At the moment, all I can get him to do is jump to a new location. Any help would be great!</div>
	A conceptual-only attempt to help.<br>
	<br>
	Programming AIs kind of behavior is fun and interesting to do, but time consuming to code and test out.<br>
	<br>
	I see 3 solution at first glance, surely there are more and maybe better ones:<br>
	<br>
	1. have countdown timer. When pushing A the motion starts following a set pattern and the timer is set, each NMI the timer decreases, when reaching 0 the motion ends.<br>
	<br>
	2. have a target x/y coordinates. When pushing A the motion starts following a set pattern, and each NMI the game check if the target x/y coordinates are reached (note: be careful on &quot;exact&quot; target coordinates, if the object can bypass them try to set as target the &quot;box&quot; inside x1 x2 y1 y2).<br>
	<br>
	3. have a set of instruction. When pushing A the motion starts following a set pattern on the first instruction, and each NMI the game check if the instruction is done and shifts to the next, the last instruction will be an arbitrary opcode (fi. FF) meaning &quot;task completed&quot;.</div>
<br>
<br>
I used #3 in Happy Hour to animate the mug sliding across the bar.<br>
So, it went:<br>
Fill Mug,<br>
Slide Mug to end of screen,<br>
When it reached end of screen, change sprite to empty mug<br>
Slide mug back to beer tap.<br>
Stop when it reaches the coordinates under beer tap.<br>
<br>
<br>
During this process, you can&apos;t do anything during the game except pause.<br>
<br>
<br>
Is that what you are kind of looking for SoleGoose?<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__508">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Feb 4, 2015 at 10:40:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That&apos;s pretty much exactly what I&apos;m looking for! As simple as it is, I must be missing something in my logic. A speed versus position issue I&apos;m guessing...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__509">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Feb 4, 2015 at 12:07:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Just to bring the question back around full circle, I will post the code on my solution to this from Happy Hour with comments. Maybe it will help others as well. I had the same issues SoleGoose had when I was trying to figure it out. I think MRN helped me through it. KHAN may have had a hand or two in it as well, I can&apos;t remember now.
<br>
<br> ;;;;;;;;;;;;;;;;;;;;;;;;
<br>SlideMug:                                     ;When B button is pressed, slide the mug to the right
<br>  LDA SlideMugFlag                   ;Hitting B will load 1 into this flag and kick off the routine
<br>  BEQ SlideMugDone
<br>    
<br>    LDA ReturnMugFlag              ;This for is for when the Mug is returning. Once it hits end of screen, the mug returns (slide left)
<br>    BNE SlideMugDone               ;I do this to skip the slide right part which is the next code
<br>
<br>
<br>    LDX MugPosition                    ;Start by finding the position of the mug and load it into X, I have it stored in this variable
<br>                                                        ;this is the coordinate on the screen where it is
<br> 
<br>    LDA mug_RAM+3       ; load sprite 0 X position                         ;This should look familiar, this is moving the four sprites of the mug to the RIGHT.
<br>    CLC             ; make sure the carry flag is clear
<br>    ADC SlideSpeed       ; A = A + 1
<br>    STA mug_RAM+3       ; save sprite 0 X position
<br>    
<br>    LDA mug_RAM+7        ; load sprite 1 X position
<br>    CLC             ; make sure the carry flag is clear
<br>    ADC SlideSpeed        ; A = A + 1
<br>    STA mug_RAM+7          ; save sprite 1 X position
<br>    
<br>    LDA mug_RAM+11          ; load sprite 2 X position
<br>    CLC             ; make sure the carry flag is clear
<br>    ADC SlideSpeed        ; A = A + 1
<br>    STA mug_RAM+11          ; save sprite 2 X position
<br>    
<br>    LDA mug_RAM+15          ; load sprite 3 X position
<br>    CLC             ; make sure the carry flag is clear
<br>    ADC SlideSpeed        ; A = A + 1
<br>    STA mug_RAM+15          ; save sprite 3 X position
<br>    
<br>    INX                                                                                                       ;Increment X (remember from above, X is loaded with MugPosition Variable
<br>    CMP #$FE            ;Mug stopping point                                          ;Now check to see if X is greater than #$FE (end of screen) (Load this as where you want the sprite to stop)
<br>    BCC SlideMugDone                                                                         ;If X is greater that #$FE (so #$FF), then routine is done.
<br>    
<br>;-------------------------------------------------------------------------------------------------------------------------------------------------------
<br>;Between these lines, I reset the Mug to Empty sprites and ready it to start sliding LEFT back to the Beer Tap
<br>      LDA #$00            ;Reset Mug to Empty
<br>      STA mug_RAM+1  
<br>      LDA #$01
<br>      STA mug_RAM+5
<br>      LDA #$02
<br>      STA mug_RAM+9  
<br>      LDA #$03
<br>      STA mug_RAM+13
<br> 
<br>      INC IncScoreFlag                ;Increment flag to add score.
<br>            
<br>      LDA #$00                        
<br>      STA MugCheckNotFillingFlag     ;Reset the Flag to show sprites not filling (enables color change)
<br>
<br>      INC RandomBeerFlag             ;Increment flag to run random generator to produce new beer order
<br> 
<br>      INC ReturnMugFlag
<br>      ;JSR ReturnMug
<br>;--------------------------------------------------------------------------------------------------------------------------------------------------------
<br>
<br>  
<br>SlideMugDone:
<br>  RTS
<br>
<br>;;;;;;;;;;;;;;;;;;;;;;;;;;;;
<br> :Basically, this is the same as above, only the routine is now sliding the Mug to the LEFT
<br>ReturnMug:                                             ;Return the mug to it&apos;s starting position
<br>  LDA ReturnMugFlag
<br>  BEQ ReturnMugDone
<br>    LDX MugPosition
<br> 
<br>    LDA mug_RAM+3       ; load sprite 0 X position
<br>    SEC
<br>    SBC SlideSpeed      
<br>    STA mug_RAM+3       ; save sprite 0 X position
<br>    
<br>    LDA mug_RAM+7        ; load sprite 1 X position
<br>    SEC
<br>    SBC SlideSpeed      
<br>    STA mug_RAM+7          ; save sprite 1 X position
<br>    
<br>    LDA mug_RAM+11          ; load sprite 2 X position
<br>    SEC
<br>    SBC SlideSpeed      
<br>    STA mug_RAM+11          ; save sprite 2 X position
<br>    
<br>    LDA mug_RAM+15          ; load sprite 3 X position
<br>    SEC
<br>    SBC SlideSpeed      
<br>    STA mug_RAM+15          ; save sprite 3 X position
<br>    
<br>    DEX
<br>    CMP #$98
<br>    BNE ReturnMugDone
<br>      LDA #$00                        
<br>      STA MugCheckNotFillingFlag2    ;Reset the Flag to enable A Button
<br>      STA MugCheckCounter
<br>      STA SlideMugFlag
<br>      STA ReturnMugFlag
<br>      STA DoubleBonusFlag
<br>
<br>ReturnMugDone:
<br>  RTS 
<br>
<br>
<br>
<br>
<br>----------------------------------------------------------
<br>So, basically, here is what animates the sprites:
<br>
<br>
<br>    LDX MugPosition                    ;Start by finding the position of the mug and load it into X, I have it stored in this variable
<br>                                                        ;this is the coordinate on the screen where it is
<br>
<br>;Sprite data here
<br>
<br>    INX                                                                                                       ;Increment X (remember from above, X is loaded with MugPosition Variable
<br>    CMP #$FE            ;Mug stopping point                                          ;Now check to see if X is greater than #$FE (end of screen) (Load this as where you want the sprite to stop)
<br>    BCC SlideMugDone                                                                         ;If X is greater that #$FE (so #$FF or greater), then routine is done.
<br>
<br>
<br>You are just using a variable to hold the horizontal position on the screen (MugPosition) and comparing it to the horizontal stopping point (in this case #$FE). Well, actually, I am stopping at anything greater than #$FE. I did this because my MugSpeed variable is 2, so I increment by 2&apos;s instead of 1&apos;s, so I never actually hit #$FF. So, I know I always want to stop at anything greater than #$FF. If I had BNE here instead of BCC, my mug would slide right off the screen right side of the screen and start back at #$00 and reenter on the left side of the screen and just keep looping.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__510">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 4, 2015 at 4:40:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Forgive me for jumping so far ahead...I make too many assumptions. Maybe someday I will better understand how to teach!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__511">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Feb 4, 2015 at 4:45:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>GradualGames</b></i><br>
	<br>
	Forgive me for jumping so far ahead...I make too many assumptions. Maybe someday I will better understand how to teach!</div>
<br>
Well, you have a homebrew icon and I don&apos;t, so it must mean you are doing something right. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Not to mention, you have helped me through a couple of problems in the past.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__512">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 4, 2015 at 4:48:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<span class="sprites_emoticons absmiddle" id="emo_smile"></span> It&apos;s definitely too easy to take some things for granted. I started coding in &apos;96! Anyway, back to topic..carry on guys <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__513">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 4, 2015 at 7:30:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>GradualGames</b></i><br>
	<br>
	Forgive me for jumping so far ahead...I make too many assumptions. <strong>Maybe someday I will better understand how to teach!</strong></div>
<br>
I&apos;m the new one here, but for what my opinion is worth, I think that you effort was an extremely welcome reply, and I&apos;m confident that your snippet of code and your comments helped out, were fully understandable, and were definitely useful to the member you were replying to. Moreover, I think that when posting a &quot;solution&quot; on a thread &quot;stackoverflow.com-like&quot;, like this one is, it is not really about &quot;only&quot; give a possible solution to the one person asking, is more about giving an answer to anyone reading the thread, maybe having the same issue but not brave enough to ask. Just my &quot;personal opinion&quot; two cents.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__514">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 10, 2015 at 12:25:18 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You will forgive my ignorance, two hours ago I was not even aware of the existence of .nsf files.
<br>
<br>I&apos;ve been asking to use, as a soundtrack in a game we are developing, some music a composer composed in .nsf format. After understanding I could open the file in FcEux, it was obvious to me that in no way this could be done directly converting the data in the file in the &quot;language&quot; of the game sound engine (atm just a simplified version of MetalSlime NN sound engine, which is planned to be enhanced if needed in order to handle this music complexity).
<br>
<br>So my questions are:
<br>
<br>- is there a tool which allows me to graphically see the &quot;music-sheet&quot; (pitches, volume and lengths would be a start) of square1, square2, triangle, and noise channels parameters, of a specific track in that .nsf file? (I tried Famitracker, after downloading it, but it seems not even able to play the .nsf format music); or
<br>
<br>- is there a tool able to convert a specific .nsf track to midi format of four channels? (so I can open it in a midi editor to see the &quot;music-sheet&quot; of each channel and rewrite the music for the game music engine? I think this one is really unlikely to be true); or
<br>
<br>- is there another solution you would suggest?
<br>
<br>Thanks to anybody can help. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__515">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				Feb 10, 2015 at 1:30:46 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There&apos;s a plugin for FamiTracker that will open NSFs:&#xA0;<a href="http://famitracker.com/wiki/index.php?title=NSF_Importer" target="_blank" original-href="http://famitracker.com/wiki/index.php?title=NSF_Importer">http://famitracker.com/wiki/index.php?title=NSF_Importer</a>. It&apos;s not perfect, but I&apos;ve definitely used it when I wanted to look at channel data. IIRC, it&apos;s only compatible with a certain version of FamiTracker, so be sure to check before using the plugin.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__516">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Feb 10, 2015 at 10:31:36 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>GradualGames</b></i><br>
	<br>
	Forgive me for jumping so far ahead...I make too many assumptions. Maybe someday I will better understand how to teach!</div>
<br>
Shoot Derek, I just saw this. Your comments were definitely useful, and have gotten me thinking about different ways to handle sprites all around and in a bigger sense. I am quite excited to dig into them more, but need to take a few smaller steps first <span class="sprites_emoticons absmiddle" id="emo_smile"></span>. Plenty of questions will be sent your way once I really begin to work with them, but for now I just needed help with using movements in one small feature (that will likely have to be redone in the end, but at least it is working now!).<br>
<br>
Oh, and&#xA0;there are no better&#xA0;teacher credentials then this: &quot;Instead try to understand the concepts, then write it yourself.&quot; Except in my lazy moments, when I just want answers <span class="sprites_emoticons absmiddle" id="emo_wink"></span>.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__517">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 10, 2015 at 11:10:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Rachel</b></i><br>
	<br>
	There&apos;s a plugin for FamiTracker that will open NSFs:&#xA0;<a href="http://famitracker.com/wiki/index.php?title=NSF_Importer" target="_blank" original-href="http://famitracker.com/wiki/index.php?title=NSF_Importer">http://famitracker.com/wiki/index.php?title=NSF_Importer</a>. It&apos;s not perfect, but I&apos;ve definitely used it when I wanted to look at channel data. IIRC, it&apos;s only compatible with a certain version of FamiTracker, so be sure to check before using the plugin.</div>
<br>
Thanks, appreciated! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
It seems to works with version 0.4.4. Now I just have to understand the way FamiTracker displays the channels data, but at least there is something more promising to start from.<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user<br>
<br>
Any other feedback on the issue is welcome. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__518">
                                                        <div class="mdl-card__title"><strong>Rachel</strong> posted on 
		
			
				
				Feb 10, 2015 at 4:25:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Good luck tracking! Here are two beginner FamiTracker resources that aren&apos;t too overwhelming for a beginner. The first link focuses more on navigating the program rather than composing, which might be ideal if you&apos;re just looking to review existing songs.
<br>
<br>Understanding FamiTracker layout: <a href="http://www.vg-resource.com/thread-19262.html" target="_blank" original-href="http://www.vg-resource.com/thread-19262.html">http://www.vg-resource.com/thread...</a>
<br>Cheatsheet: <a href="scraper/files/famitracker-workshop-handout.pdf" target="_blank" original-href="http://b-knox.com/wp-content/uploads/2011/08/famitracker-workshop-handout.pdf">http://b-knox.com/wp-content/uplo...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__519">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 10, 2015 at 4:35:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Rachel</b></i><br>
	<br>
	Good luck tracking! Here are two beginner FamiTracker resources that aren&apos;t too overwhelming for a beginner. The first link focuses more on navigating the program rather than composing, which might be ideal if you&apos;re just looking to review existing songs.<br>
	<br>
	Understanding FamiTracker layout: <a href="http://www.vg-resource.com/thread-19262.html" target="_blank" original-href="http://www.vg-resource.com/thread-19262.html">http://www.vg-resource.com/thread-19262.html</a><br>
	Cheatsheet: <a href="scraper/files/famitracker-workshop-handout.pdf" target="_blank" original-href="http://b-knox.com/wp-content/uploads/2011/08/famitracker-workshop-handout.pdf">http://b-knox.com/wp-content/uploads/2011/08/famitracker-wor...</a> </div>
<br>
Thanks, I will eventually study famitracker way to handle things someday. So much to learn...<br>
<br>
I&apos;m now mostly looking for a .nfs file srtucture description like this one for bitmaps:<br>
<br>
&#xA0;<a href="https://en.wikipedia.org/wiki/BMP_file_format#File_structure" target="_blank" original-href="https://en.wikipedia.org/wiki/BMP_file_format#File_structure">https://en.wikipedia.org/wiki/BMP...</a><br>
<br>
to program a converter from the .nsf format, to the sound engine music data compressing method used by the game (<strong>edit</strong>: or at least &quot;back engineer&quot; the notes pitch, volume and length from the .nsf file <strong>/edit</strong>).<br>
<br>
<strong>EditII</strong>: unless a tool converting a .nsf track to an human readable &quot;music sheet&quot; already exists! <span class="sprites_emoticons absmiddle" id="emo_wink"></span><br>
<br>
Thanks for the help! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__520">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 10, 2015 at 5:42:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					^^__ Never mind, issue solved otherwise. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__521">
                                                        <div class="mdl-card__title"><strong>M-Tee</strong> posted on 
		
			
				
				Feb 16, 2015 at 10:51:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div>
	Terminology question:<br>
	&#xA0;</div>
<div>
	How would one specifically and clearly refer to a 4-byte chunk of a palette?</div>
<div>
	<br>
	<img alt src "width: 544px; height: 104px;" original-src="http://files.mteegfx.com/FCEUXpalettewindow.png" show-src="scraper/images/FCEUXpalettewindow.png"><br>
	&#xA0;</div>
<div>
	So far, I&apos;ve been referring to them as&#xA0;<em>slots.</em>&#xA0;For &#xA0;example,&#xA0;<em>The background palette and the sprite palette have four slots each, identified as BG palette slot 00, 01, 02, 03 and OBJ palette slot 00, 01, 02, 03.</em><br>
	<br>
	However, I can&apos;t help but feel that there is a specific term I should be using instead of&#xA0;<em>slot</em>.</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__522">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Feb 16, 2015 at 11:02:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>M-Tee</b></i><br>
	<br>
	<div>
		Terminology question:<br>
		&#xA0;</div>
	<div>
		How would one specifically and clearly refer to a 4-byte chunk of a palette?</div>
	<div>
		<br>
		<img alt height: src width: original-src="http://files.mteegfx.com/FCEUXpalettewindow.png" show-src="scraper/images/FCEUXpalettewindow.png"><br>
		&#xA0;</div>
	<div>
		So far, I&apos;ve been referring to them as&#xA0;<em>slots.</em>&#xA0;For &#xA0;example,&#xA0;<em>The background palette and the sprite palette have four slots each, identified as BG palette slot 00, 01, 02, 03 and OBJ palette slot 00, 01, 02, 03.</em><br>
		<br>
		However, I can&apos;t help but feel that there is a specific term I should be using instead of&#xA0;<em>slot</em>.</div>
</div>
<br>
Not sure if I&apos;m correct, but I call them as they are:<br>
Background Palette 0<br>
Background Palette 1<br>
Background Palette 2<br>
Background Palette 3<br>
Sprite Palette 0<br>
Sprite Palette 1<br>
Sprite Palette 2<br>
Sprite Palette 3<br>
<br>
That&apos;s just me, not sure those are the &quot;techical&quot; terms.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__523">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				Feb 16, 2015 at 11:07:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Slot sounds too singular to me. I would just say &quot;sprite palette 0&quot; or &quot;background palette 3&quot;. Shorthand on the Internet would just be BG PAL 2, our whatever. Slot would work fine too though, you just have to be on the same wavelength as the person or persons you are discussing it with.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__524">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 16, 2015 at 11:17:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	A transparent sprite pixel does not get drawn. &#xA0;But a pixel using the same color index (black) not in the transparent <strong>slot </strong>(first slot) will get drawn. &#xA0;So in your example if the sprite uses the first black (transparent) the picture will be red (background), and if it uses the second black (actually black) the picture will be black (sprite). &#xA0;This should probably have a cool sample image here... &#xA0;The <strong>slot </strong>is the important part, not the color itself. &#xA0;Hope that makes sense in English too &#xA0;</div>
bunnyboy used the term &quot;slot&quot; aswering to me few posts above, so I guess it is a good enough term to use.<br>
However, like M-Tee, I&apos;m definitely interested in what is the most correct term for it, both technically and English wise.<br>
<br>
<strong>Edit</strong>: never mind, I misunderstood the question. So the term &quot;slot&quot; is the correct one. Nice to know.<br>
Also, I use the term &quot;subpalette&quot; for each &quot;group&quot; of 4 slots, is this term correct too?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__525">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Feb 17, 2015 at 5:49:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If using the palette 0, palette 1, etc. terminology, confusion can set in when talking with non-NES programmers/artists, since most think of &quot;palette&quot; as being the total range of all available color per screen. At least that has been the case in the few times that I have tried to explain things to people. Sub-palette seems like it would be a pretty accurate term, as long as one defines what this means (16x16 pixel area, or 8x8 if using the MMC5).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__526">
                                                        <div class="mdl-card__title"><strong>M-Tee</strong> posted on 
		
			
				
				Feb 17, 2015 at 12:36:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div>
	This is exactly why I was looking to see if there was a standard (or generally accepted as standard) terminology.</div>
<div>
	&#xA0;</div>
<div>
	In the examples listed,</div>
<div>
	&#xA0;</div>
<div>
	I used&#xA0;<em>palette&#xA0;slot</em> to refer to a 4-color(byte) section of a palette. For example, the contents of Mario&apos;s palette slot would be transparent, red, brown, and tan.<br>
	<br>
	However, in the quote user posted, bunnyboy seems to use slot to refer to an individual byte. (basically a very specific address), for example&#xA0;<em>one of Mario&apos;s slots contains red.</em><br>
	<br>
	Then, SGP seems to be using slot to refer to a byte in the background attribute data (controlling which palette is assigned to a section of the screen).<br>
	<br>
	So, it seems that my choice of the word&#xA0;<em>slot </em>was an ill-made one, as even in this post, it caused confusion.<br>
	<br>
	I guess MMM&apos;s and Roth&apos;s shorthand would be the closest to generally accepted (that seems to be the terminology used on the <a href="http://wiki.nesdev.com/w/index.php/PPU_palettes" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_palettes">nesdev wiki</a>.<br>
	<br>
	<em>Therefore, a single palette is 4 bytes long, and there are 8 palettes loaded at a time, four for sprites (SPR Pal 0&#x2013;3 and four for backgrounds (BG Pal 0&#x2013;3). Each of these 16 palettes has four colors, of which one will be transparent/background.</em><br>
	<br>
	Thanks for the input on this.&#xA0;</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__527">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 19, 2015 at 9:07:16 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi all. Ok, really basic generic question about NES game design.<br>
<br>
There is a &quot;metasprite&quot;, made of 4 sprites (ie 16x16px) which can be hit. The outline of the not transparent part (which I will call &quot;filled&quot;) of the image drawn in the metasprite is not rectangular, as for instance this image of a space ship I draw:<br>
<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/21264/photobucket/5585923A-EC0E-4604-05608639C85DC413.png" show-src="images/missing/5585923A-EC0E-4604-05608639C85DC413.png"><br>
<br>
I guess it is maybe possible to program a complex collision check which detects if a point is inside or outside the &quot;filled&quot; area also in a NES game, but it is way simpler and good enough result wise to just set a rectangular box somewhere inside the metasprite and check for point collisions against that box.<br>
<br>
So here my question: is there a generic rule on how to set that box? I mean, generically speaking, for 16px sprites not rectangular in shape, it is better (ie. is the convention for NES programmers) to have few more transparent pixels trigger the collision; or is better to have few more filled pixel to _don&apos;t_ trigger the collision? Given that matasprite above, which one of the red boxes above seems the most accurate and/or balanced one to implement in your opinion? Or you would use the whole 16x16px area of the metasprite to check for point collisions?<br>
<br>
I&apos;m mostly wondering if a generic convention, about how to set collision boxes for a 16px metasprites in NES game design, exists. Thanks!<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
- user<br>
<br>
<strong>Edit</strong>: misspelling.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__528">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 19, 2015 at 1:55:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;d probably use the first option.  I&apos;ve found that it&apos;s better to be more forgiving for players than less forgiving.  The second option is way too forgiving, the third option is killing people when they aren&apos;t being touched in areas, etc, etc.  But you also have to take into account how fast the ship is flying, and what &quot;feels&quot; right when the game is being played.  If you&apos;re using, say, the next to last option for hit detection, it might &quot;feel&quot; right with how fast the ship is flying and colliding with other objects.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__529">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 19, 2015 at 8:51:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	I&apos;d probably use the first option. I&apos;ve found that it&apos;s better to be more forgiving for players than less forgiving. The second option is way too forgiving, the third option is killing people when they aren&apos;t being touched in areas, etc, etc. But you also have to take into account how fast the ship is flying, and what &quot;feels&quot; right when the game is being played. If you&apos;re using, say, the next to last option for hit detection, it might &quot;feel&quot; right with how fast the ship is flying and colliding with other objects.</div>
Thank you Kevin. Appreciated! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
This is pretty much the answer I was expecting. Thanks for confirming that there is not a set convention on the matter, and that it depends mostly on the game controls and speed. I&apos;ll take note to tend more towards &quot;forgiving&quot;, when in doubt.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__530">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Feb 19, 2015 at 9:15:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If bullets are coming parallel to the players shots (space invaders) then I think the largest rect is the best.  If it is diagonals then more forgiving works better.  Just make the game so fast that you can&apos;t tell the difference!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__531">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 19, 2015 at 10:09:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	If bullets are coming parallel to the players shots (space invaders) then I think the largest rect is the best. If it is diagonals then more forgiving works better. Just make the game so fast that you can&apos;t tell the difference!</div>
Interesting point about the &quot;bullets&quot; possible directions. Thanks!<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__532">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Feb 22, 2015 at 6:52:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ok, got some time off work. This time I&apos;m going to get this working.
<a href="http://pastebin.com/RwxUphFQ" target="_blank" original-href="http://pastebin.com/RwxUphFQ">http://pastebin.com/RwxUphFQ...</a>
So what I have been trying to do on and off for the past year or so, is something as simple as
getting an object to move using 8.8 fixed point coordinates(signed), with some inertia/gravity.
Walking right is no problem, but left is acting weird.<br><br>1. It won&apos;t clamp at $FEBB, which object_dx_min is set to. It clamps object_dx_max tho.
I&apos;m using the clamp code thefox posted <a href="http://nintendoage.com/forum/messageview.cfm?StartRow=426&amp;catid=22&amp;threadid=103138" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?StartRow=426&amp;catid=22&amp;threadid=103138">http://nintendoage.com/forum/mess...</a><br><br>2. When I let go of the left button, object_dx keeps on decreasing. What the hell did I do?
I have been tracing through my code while looking at the hex editor in FCEUX now for an hour,
and I don&apos;t understand why the damn variable keeps on decreasing instead of increasing.
Sucks to be bad at math. <span class="sprites_emoticons absmiddle" id="emo_sad"></span><br><br>object_dx  - 16bit speed<br>
object_acc - 8bit acceleration<br>
object_dec - 8bit deceleration<br><br><br>Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__533">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 22, 2015 at 7:12:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<strong>object_dx - 16bit speed</strong><br>
	&#xA0;</div>
This means you move by 1px each 256 on the speed scale?<br>
<br>
I&apos;m not 100% sure about what are your goals here, and I&apos;m rather new to 6502 Assembly, but I kind of think your approach is complex: you can use +FF (+FE +FD ...) to decrement by one (two, three, ...), and use ADC instead of SBC also when moving left: from my little experience, this simplifies the math involved. That said, rely on other more experienced than I am programmers, maybe I am missing something here. I hope I could help more. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__534">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Feb 22, 2015 at 9:20:34 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	1. It won&apos;t clamp at $FEBB, which object_dx_min is set to. It clamps object_dx_max tho.</div>
Probably a problem with where you&apos;re doing the clamping.<br>
<br>
<div class="FTQUOTE" "width: 516px;">
	<i>Originally posted by:&#xA0;<b>DoNotWant</b></i><br>
	<br>
	2. When I let go of the left button, object_dx keeps on decreasing.</div>
Let&apos;s look at the program flow here. Not pressing any buttons, so controller = 0, so &quot;beq notRight&quot; branches. If object_dx &lt; 0, its hibyte is non-zero and the &quot;beq +&quot; on line 23 never branches. Thus object_dec is subtracted from object_dx and the code jumps to dxTox to exit the routine. Seems logical, then, that the variable would keep on decreasing.<br>
<br>
BTW your code could benefit from using more macros e.g. for the 16-bit additions. As it is now, it&apos;s very difficult to read. Personally I also like to use indentation quite heavily (although your assembler may or may not allow indented labels). Might not be a bad idea to rewrite the code from scratch, sometimes you&apos;ll find that the bug has magically disappeared after a fresh try. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__535">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Feb 22, 2015 at 1:47:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	Let&apos;s look at the program flow here. Not pressing any buttons, so controller = 0, so &quot;beq notRight&quot; branches. If object_dx &lt; 0, its hibyte is non-zero and the &quot;beq +&quot; on line 23 never branches. Thus object_dec is subtracted from object_dx and the code jumps to dxTox to exit the routine. Seems logical, then, that the variable would keep on decreasing.<br>
	<br>
	BTW your code could benefit from using more macros e.g. for the 16-bit additions. As it is now, it&apos;s very difficult to read. Personally I also like to use indentation quite heavily (although your assembler may or may not allow indented labels). Might not be a bad idea to rewrite the code from scratch, sometimes you&apos;ll find that the bug has magically disappeared after a fresh try.<br>
	&#xA0;</div>
Dooooooooooooooh! I forgot to add a bmi left there ;_;<br>
Works so-so now when moving left, just some minor adjustments I believe.<br>
This I think was because I had something working, and then I added something after that broke it.<br>
Lesson learned.<br>
<br>
This is the 3rd or 4th time I rewrite this. :/<br>
I just started using ASM6, so I think I can use whitespace as I please, unlike in NESASM.<br>
The macro system is a lot nicer in ASM6 also, so I should probably use that more, yes.<br>
<br>
Thank you so much!<br>
<br>
<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	This means you move by 1px each 256 on the speed scale?<br>
	<br>
	I&apos;m not 100% sure about what are your goals here, and I&apos;m rather new to 6502 Assembly, but I kind of think your approach is complex: you can use +FF (+FE +FD ...) to decrement by one (two, three, ...), and use ADC instead of SBC also when moving left: from my little experience, this simplifies the math involved. That said, rely on other more experienced than I am programmers, maybe I am missing something here. I hope I could help more.</div>
Doesn&apos;t have to be 1/256, I could set it to 1 pixel every second frame if I wanted to, or something like that.<br>
What I hear is, if you can used signed numbers(I&apos;m a little shaky on that one <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>), stuff like gravity/inertia/jumping can be easier to pull off. I have tried doing what I&apos;m doing here with unsigned numbers, but I didn&apos;t get anywhere then, just spaghetti code. That was about a year ago tho.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__536">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 22, 2015 at 7:15:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	Doesn&apos;t have to be 1/256, I could set it to 1 pixel every second frame if I wanted to, or something like that.<br>
	What I hear is, if you can used signed numbers(I&apos;m a little shaky on that one ), stuff like gravity/inertia/jumping can be easier to pull off. I have tried doing what I&apos;m doing here with unsigned numbers, but I didn&apos;t get anywhere then, just spaghetti code. That was about a year ago tho.<br>
	&#xA0;</div>
Signed number are great, and two&apos;s complement is a good solution for what I can tell.<br>
I was not affirming that your solution was unperfect, I was just saying that, _from my little experience_, to increase/decrease a coordinate by +/- one, two, three, ..., sometimes is easier and cleaner to call a subroutine with an ADC in both cases (+ or -) and when decreasing (-) ADD the negative (FF, FE, FD) value rather than SUBTRACT the positive (01 02 03); I hope all this makes sense in English. But again, probably in your case is better your way, or even maybe I still missing something you are trying to achieve here. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__537">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Feb 23, 2015 at 12:14:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	Signed number are great, and two&apos;s complement is a good solution for what I can tell.<br>
	I was not affirming that your solution was unperfect, I was just saying that, _from my little experience_, to increase/decrease a coordinate by +/- one, two, three, ..., sometimes is easier and cleaner to call a subroutine with an ADC in both cases (+ or -) and when decreasing (-) ADD the negative (FF, FE, FD) value rather than SUBTRACT the positive (01 02 03); I hope all this makes sense in English. But again, probably in your case is better your way, or even maybe I still missing something you are trying to achieve here.</div>
<br>
What about the fractional part? <span class="sprites_emoticons absmiddle" id="emo_wink"></span><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__538">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 23, 2015 at 12:53:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>DoNotWant</b></i><br>
	<br>
	What about the fractional part?<br>
	&#xA0;</div>
This is the reason why I asked<br>
&quot;<em>This means you move by 1px each 256 on the speed scale?</em> <span class="sprites_emoticons absmiddle" id="emo_wink"></span> &quot;<br>
<br>
So, it is clear now. I learned something today. Thanks. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__539">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Feb 23, 2015 at 2:38:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	This is the reason why I asked<br>
	&quot;<em>This means you move by 1px each 256 on the speed scale?</em> &quot;<br>
	<br>
	So, it is clear now. I learned something today. Thanks.<br>
	<br>
	&#xA0;</div>
Yeah, sorry I wasn&apos;t clear about that from the beginning. I&apos;m not a people person to begin with, and English is not my native language. It&apos;s good with a fractional part if you want gravity, or just the ability to move less than 1px every frame.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__540">
                                                        <div class="mdl-card__title"><strong>Monnotonne</strong> posted on 
		
			
				
				Mar 1, 2015 at 9:08:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hello everyone! I&apos;m new here and while I do have some sort of basic programming knowledge, I&apos;m still very new to NES programming. I noticed that in the last build of my homebrew project, a few of the game sprites disappear when all of the characters stand in the same horizontal plain.<br>
<br>
<img alt src "width: 600px; height: 525px;" original-src="http://i1378.photobucket.com/albums/ah92/monnotonne/Kill%20La%20Kill%20Question%201_zpsj4cqdsvq.png" show-src="scraper/images/Kill%20La%20Kill%20Question%201_zpsj4cqdsvq.png"><br>
<br>
I do know that if you have too many sprites in a row then they are supposed to start flickering, but these sprites just disappear completely. Is flickering something that I have to program in manually, or is this another problem entirely?<br>
<br>
Sorry for the newb question, but I&apos;m still learning all of the console&apos;s &quot;charming&quot; limitations. : p
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__541">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Mar 1, 2015 at 9:15:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Flickering is something you must program.  The 8 sprites with the lowest index will be displayed and everything after that is completely dropped.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__542">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Mar 1, 2015 at 9:17:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Monnotonne</b></i><br>
	<br>
	I do know that if you have too many sprites in a row then they are supposed to start flickering, but these sprites just disappear completely. Is flickering something that I have to program in manually, or is this another problem entirely?</div>
Yes, despite many people thinking/claiming that flickering was a hardware feature of NES, it in fact has to be always manually programmed in. The basic idea is that you&apos;d change the sprite priorities (index in OAM) from frame to frame so that different sprites show up on different frames.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__543">
                                                        <div class="mdl-card__title"><strong>Monnotonne</strong> posted on 
		
			
				
				Mar 1, 2015 at 9:21:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I see. So what I always took as a limitation was actually intelligent problem solving? I think I have a new respect for NES programmers. : p
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__544">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Mar 5, 2015 at 7:46:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Monnotonne</b></i><br>
	<br>
	I see. So what I always took as a limitation was actually intelligent problem solving? I think I have a new respect for NES programmers. : p</div>
<br>
<br>
Check out MRN&apos;s tutorial on it which can be found here - <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=128426" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=128426">http://www.nintendoage.com/forum/...</a><br>
This helped me immensely when programming a sprite flickering routine. Also, if you use Sprite Zero for split scrolling/other stuff, you might change up the routine so it always is on the $0X00-$0X03 range
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__545">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Mar 14, 2015 at 12:28:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So all of the types of games we&apos;ve all been making deal with the background in the same type of way.&#xA0; Either we load a static background image and then either replace indivial/a series of tiles as things occur, or we scroll the background to load more backgrounds, but they&apos;re always mostly static images.<br>
<br>
How are racing/flying games like Rad Racer or F15 City War done? I haven&apos;t seen any programming techniques using these methods explained, and I&apos;d really love to learn more about how its done.<br>
<br>
Thanks. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__546">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Mar 14, 2015 at 1:20:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	So all of the types of games we&apos;ve all been making deal with the background in the same type of way.&#xA0; Either we load a static background image and then either replace indivial/a series of tiles as things occur, or we scroll the background to load more backgrounds, but they&apos;re always mostly static images.<br>
	<br>
	How are racing/flying games like Rad Racer or F15 City War done? I haven&apos;t seen any programming techniques using these methods explained, and I&apos;d really love to learn more about how its done.<br>
	<br>
	Thanks.</div>
<br>
<a href="http://forums.nesdev.com/viewtopic.php?t=8588" target="_blank" original-href="http://forums.nesdev.com/viewtopic.php?t=8588">http://forums.nesdev.com/viewtopi...</a><br>
<br>
This is a very interesting read <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__547">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Mar 14, 2015 at 1:48:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Its still a static background, but added scrolling magic!  Change horiz scrolling on every scanline to progressively shift the image.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__548">
                                                        <div class="mdl-card__title"><strong>Lincoln</strong> posted on 
		
			
				
				Mar 17, 2015 at 4:53:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					what is the entry point for program code on the nes? ( like main() in c ) I read on nesdev that bootup code should be in a fixed bank, but how is that resolved when fixed banks aren&apos;t universal between mappers?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__549">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Mar 17, 2015 at 5:15:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					When it starts up the CPU reads $FFFC/FFFD (the reset vector) and jumps to that address.  It is up to the programmer to make sure that points to valid code, usually in a fixed bank.  If there are no fixed banks then either the mapper needs to start up with known banks or the programmer has to put reset code in every bank.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__550">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Mar 17, 2015 at 5:20:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The second 16kb bank is typically fixed and the first, swappable. The NES looks for vectors which point to the reset code address at start up (which are placed at the very end of the second bank, see wiki). This starts the program and tells it what to do and how to begin. The programmer either has to know which bank will be fixed or put the vector/reset code in every bank...cause the NES will randomly engage one upon start up.<br>
<br>
In the case where all 32kb are switched, you have to put vectors/resets in each bank or force the NES to switch to the proper bank after it starts up in a random one.<br>
<br>
But most mappers are just more creative ways of swapping the first 16kb (or the 8kb 1/2 bank, and so on).<br>
<br>
<br>
eta: &#xA0;^^beat me to it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__551">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Mar 17, 2015 at 10:58:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Those should all be &quot;KB&quot;. Sorry. I mess that up every time.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__552">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Mar 24, 2015 at 11:14:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If splitting the screen with a sprite 0 hit, is it possible to only turn off the screen (turn off, load new background, turn back on) on one side of the split, but preserve the other?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__553">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 4, 2015 at 1:46:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Beau, I was hoping someone a little more knowledgeable here would pipe in with an answer, so I held off replying, but since that apparently isn&apos;t going to happen, I&apos;ll just say that I don&apos;t think it&apos;s possible. Sprite 0 hit is just playing tricks with the scrolling, so there isn&apos;t really a way to only turn off half the screen.<br>
<br>
You can do the manual update of tiles with the screen on, but definitely not an entire screen half. I think the tile limit per frame is something like 40? I don&apos;t remember off hand.&#xA0; It also depends on how much else is going on in your game at the time.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__554">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Apr 4, 2015 at 7:46:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have to say I didn&apos;t really understand the question.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__555">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Apr 4, 2015 at 10:32:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No worries, I just wanted to know if it was even an option before I wasted time trying to figure out something that can&apos;t be figured out (it can&apos;t, as far as I could tell). I did, however, figure out how to get the effect that I&apos;m looking for by using mid-frame palette swaps (I think anyways), though I may not go down that road at the moment. Juggling around different features and effects, and getting them all to mesh well together, is certainly challenging within the NES&apos;s limitations...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__556">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Apr 5, 2015 at 1:54:59 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You could do sprite 0, turn off screen, change nametables (using $2000), turn on screen.  You will probably need to mess with $2006 too, and it would only really work if you don&apos;t have scrolling.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__557">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Apr 5, 2015 at 8:42:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, that was the problem that I was running into, since I used scrolling to toggle between the status bar and the dialog box. Good practice, but I was not too happy with the end result and some of the compromises.
<br>
<br>Maybe I&apos;ll post what I have done in a bit just to get some feedback about ways to proceed.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__558">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Apr 5, 2015 at 9:23:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					EDIT: Fixed (on NESDEV)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__559">
                                                        <div class="mdl-card__title"><strong>mickcris</strong> posted on 
		
			
				
				Apr 20, 2015 at 12:20:42 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					nevermind. i think this is the wrong thread.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__560">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Apr 23, 2015 at 4:08:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hello <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
I need some coding help. I&apos;ve finally got some kind of game structure that I&apos;m reasonably happy with, I can add generic objects (player, enemies, bullets, whatever) to a list and then just cycle through them to update animation etc. I have an NMI routine, but at the moment I am doing some logic in there to build the sprite data from variables ready for OAM... I&apos;ve read that this is bad (ideally only PPU updates should be in NMI due to limited vblank time), but it doesn&apos;t work if I try updating in the main loop.<br>
<br>
At the moment I have one dummy sprite that moves from left to right, and it is supposed to stop when you press start on the joypad. It doesn&apos;t work <span class="sprites_emoticons absmiddle" id="emo_sad"></span> Should I be reading the joypad in NMI too? I was trying to keep as much stuff in the main loop as possible, but I don&apos;t really know if that&apos;s right.<br>
<br>
If someone could take a look, that would be much appreciated. I&apos;ve stuffed all the code in a single .asm file, you can get it here:<br>
<br>
<a href="http://pastebin.com/By4NtKVR" target="_blank" original-href="http://pastebin.com/By4NtKVR">http://pastebin.com/By4NtKVR...</a><br>
<br>
Thank you!<br>
Rob.<br>
<br>
Edit: grammar<br>
2nd edit: pastebin link instead
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__561">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 23, 2015 at 4:36:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					When I downloaded your asm document it was basically four lines that scrolled horinztally for miles, making it impossible to really look at the code.  Can you paste it on pastebin.com and link me?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__562">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Apr 23, 2015 at 4:43:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ugh, that&apos;s embarrassing, I didn&apos;t even check it!  Linux line endings or something?  Anyway, here you go:
<br>
<br><a href="http://pastebin.com/By4NtKVR" target="_blank" original-href="http://pastebin.com/By4NtKVR">http://pastebin.com/By4NtKVR...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__563">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Apr 29, 2015 at 5:20:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Anyone got any ideas? I&apos;ve put a zip file of the project on Google Drive, it includes the source and CHR. I use ASM6 to <strike>compile</strike> assemble.<br>
<br>
Thanks for any help <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<a href="https://drive.google.com/file/d/0B1Yh8r7sMuwtb0s0OWJaSzZCUnM/view?usp=sharing" target="_blank" original-href="https://drive.google.com/file/d/0B1Yh8r7sMuwtb0s0OWJaSzZCUnM/view?usp=sharing">https://drive.google.com/file/d/0...</a><br>
<br>
Edit: idiocy
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__564">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Apr 29, 2015 at 11:26:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Have you tried using a debugger?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__565">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Apr 30, 2015 at 6:38:02 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No, I hadn&apos;t!  I don&apos;t have much debugger experience, but using FCEUX I managed to trace the problem to the joypad routine - it is now fixed, so thank you for the suggestion <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
<br>
<br>Does the rest of the code look OK structure wise?  Maybe I&apos;m getting overly hung up on it, but if there&apos;s something very wrong I&apos;d like to know now rather than a couple of months down the line.
<br>
<br>Rob.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__566">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Apr 30, 2015 at 9:30:23 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>chowder</b></i><br>
	<br>
	No, I hadn&apos;t! I don&apos;t have much debugger experience, but using FCEUX I managed to trace the problem to the joypad routine - it is now fixed, so thank you for the suggestion<br>
	<br>
	Does the rest of the code look OK structure wise? Maybe I&apos;m getting overly hung up on it, but if there&apos;s something very wrong I&apos;d like to know now rather than a couple of months down the line.<br>
	<br>
	Rob.</div>
<br>
I tried your ROM.<br>
There is a sprite moving left to right. Pressing UP it stops motion. Did I miss anything else?<br>
Seems a fun game which you are planning to make. The graphics in the chr is cute.<br>
I let better assembly programmers than I am give opinions about the code itself.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__567">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Apr 30, 2015 at 2:30:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Using a debugger is definitely a skill worth learning! Usually the debugging flow is that you set a breakpoint in some interesting place of code, then start single stepping it, and at each step verify that the program is behaving as you intended (register values, memory values, branches taken, etc). And if it&apos;s not behaving as expected, then you figure out what is causing the problem, e.g. by starting the stepping from a little further back, or by using memory breakpoints to find out how a &quot;bad&quot; value got written to memory, etc.
<br>
<br>One tip for debugging is that if you want to easily start stepping the code from a known point, you can put something like a BIT $5555 instruction in your code, and then set a &quot;memory read&quot; breakpoint on $5555 (note: $5555 is an arbitrarily chosen address, but it&apos;s good because it&apos;s in a usually unused memory space). You&apos;ll then automatically land at the right place after the breakpoint hits.
<br>
<br>About the code... I&apos;ll just say that nobody (I think?) likes reviewing several hundred lines of of assembly code at once. <span class="sprites_emoticons absmiddle" id="emo_smile"></span> So, you&apos;re more likely to get an answer to that type of questions if you accompany them with more concise sections of code. Of course there&apos;s a line to be drawn there, if some piece of code depends on some other piece of code, it might be impossible to help without seeing both parts.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__568">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				Apr 30, 2015 at 4:33:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	About the code... I&apos;ll just say that nobody (I think?) likes reviewing several hundred lines of of assembly code at once. So, you&apos;re more likely to get an answer to that type of questions if you accompany them with more concise sections of code. Of course there&apos;s a line to be drawn there, if some piece of code depends on some other piece of code, it might be impossible to help without seeing both parts.</div>
<br>
Haha, good point!&#xA0; I actually have the code split into different files and then included in, for some reason I thought seeing it all in one place would be simpler.<br>
<br>
Anyway, I&apos;ll just run with it for now and come back if and when (OK, when) I have problems <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Thanks for the debugging tips too - do you have any preferred debugger?<br>
<br>
Rob.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__569">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Apr 30, 2015 at 5:54:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>chowder</b></i><br>
	<br>
	Thanks for the debugging tips too - do you have any preferred debugger?</div>
When debugging my own stuff, I mostly use a modified version of Nintendulator called NintendulatorDX (that I also made) that allows me to view the original source code when debugging. But it only works with ca65. From time to time I use FCEUX also.<br>
<br>
If you&apos;re not using ca65, FCEUX is probably the best choice for debugging.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__570">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				May 27, 2015 at 3:13:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m back with more (hopefully not too annoying) questions!
<br>
<br>What&apos;s the best way to create big (as in fullscreen) images for cutscenes and the like?  I&apos;ve been using Shiru&apos;s excellent NES Screen Tool to import BMPs as tiles, but piecing the image together from there is painful, to say the least.  Once I&apos;ve removed dupe tiles, I&apos;m left with a big mess and it&apos;s really very hard to stitch it all back together manually.
<br>
<br>I&apos;ll look in to coding some kind of parsing tool to keep track of where the duplicates have been removed from or something like that unless anyone has any better ideas.
<br>
<br>Thanks,
<br>Rob.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__571">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				May 27, 2015 at 6:07:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>chowder</b></i><br>
	<br>
	I&apos;m back with more (hopefully not too annoying) questions!<br>
	<br>
	What&apos;s the best way to create big (as in fullscreen) images for cutscenes and the like? I&apos;ve been using Shiru&apos;s excellent NES Screen Tool to import BMPs as tiles, but piecing the image together from there is painful, to say the least. Once I&apos;ve removed dupe tiles, I&apos;m left with a big mess and it&apos;s really very hard to stitch it all back together manually.<br>
	<br>
	I&apos;ll look in to coding some kind of parsing tool to keep track of where the duplicates have been removed from or something like that unless anyone has any better ideas.<br>
	<br>
	Thanks,<br>
	Rob.</div>
<br>
Here&apos;s my technique. Draw the image in TileMolestor/YYCHR/TLP/etc., then weed out all repeating tiles. Put all single tiles in your game&apos;s CHR. After that, make an infinite loop in your program so it stays on one screen. Load said program in FCEUX, and open up your Hex Editor, go under PPU memory and go to the screen memory (starting at $2000, then all the mirroring and blah blah blah). There, you can build your screen and see how it looks directly on the emulator, which is really good. Once your screen is build, paste your screen onto a HEX editor and start compressing it (I use RLE compression, do something like $FE,$69,$13 where FE corresponds to the RLE &quot;call&quot; (i.e. let the routine know you&apos;re compressing), and have tile 69 repeated 13 times). Save the compressed data onto a .bin file and put it in your program.<br>
<br>
I hope I was clear enough. It may sound like it at first but trust me, it ain&apos;t rocket science when you get used to it <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__572">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 27, 2015 at 10:01:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>chowder</b></i><br>
	<br>
	I&apos;m back with more (hopefully not too annoying) questions!<br>
	<br>
	What&apos;s the best way to create big (as in fullscreen) images for cutscenes and the like? I&apos;ve been using Shiru&apos;s excellent NES Screen Tool to import BMPs as tiles, but piecing the image together from there is painful, to say the least. Once I&apos;ve removed dupe tiles, I&apos;m left with a big mess and it&apos;s really very hard to stitch it all back together manually.<br>
	<br>
	I&apos;ll look in to coding some kind of parsing tool to keep track of where the duplicates have been removed from or something like that unless anyone has any better ideas.<br>
	<br>
	Thanks,<br>
	Rob.</div>
<br>
I highly recommend Al Bailey&apos;s Image Helper Tool.&#xA0; I&apos;ve used a lot of tools over the years I&apos;ve been making NES games, and his tool seems to have the best luck with making things look kinda right.&#xA0; You&apos;ll have to touch things up a bit, but it saves a bunch of time.&#xA0; I don&apos;t know if I&apos;m really allowed to distribute it without his permission, but I&apos;m going to post it until someone yells at me.&#xA0; It&apos;s helped me a ton so I hope it will also help other people.<br>
<br>
<a href="https://drive.google.com/file/d/0B-NEolq4vN1-a3dCUE9uakhFdXc/view?usp=sharing" target="_blank" original-href="https://drive.google.com/file/d/0B-NEolq4vN1-a3dCUE9uakhFdXc/view?usp=sharing">https://drive.google.com/file/d/0...</a><br>
<br>
Just go to Graphics &gt; Image Helper Tool.<br>
Then File &gt; Load Image.<br>
Choose the BMP.<br>
Then when you&apos;re sure it&apos;s looking decent you can export the CHR, NAM, PAL, ATTR, etc, etc.&#xA0; It&apos;s fantastic.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__573">
                                                        <div class="mdl-card__title"><strong>chowder</strong> posted on 
		
			
				
				May 28, 2015 at 7:13:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	I highly recommend Al Bailey&apos;s Image Helper Tool.&#xA0; I&apos;ve used a lot of tools over the years I&apos;ve been making NES games, and his tool seems to have the best luck with making things look kinda right.&#xA0; You&apos;ll have to touch things up a bit, but it saves a bunch of time.&#xA0; I don&apos;t know if I&apos;m really allowed to distribute it without his permission, but I&apos;m going to post it until someone yells at me.&#xA0; It&apos;s helped me a ton so I hope it will also help other people.<br>
	<br>
	<a href="https://drive.google.com/file/d/0B-NEolq4vN1-a3dCUE9uakhFdXc/view?usp=sharing" target="_blank" original-href="https://drive.google.com/file/d/0B-NEolq4vN1-a3dCUE9uakhFdXc/view?usp=sharing">https://drive.google.com/file/d/0B-NEolq4vN1-a3dCUE9uakhFdXc...</a> <br>
	<br>
	Just go to Graphics &gt; Image Helper Tool.<br>
	Then File &gt; Load Image.<br>
	Choose the BMP.<br>
	Then when you&apos;re sure it&apos;s looking decent you can export the CHR, NAM, PAL, ATTR, etc, etc.&#xA0; It&apos;s fantastic.<br>
	&#xA0;</div>
<br>
Wow, just had a quick play, but that&apos;s pretty much exactly what I was looking for.&#xA0; Thanks!&#xA0; And thank you to Al Bailey too, should he ever read this <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Vectrex, what you described sounds like a more complicated version of what I&apos;ve been doing in NES Screen Tool, but thanks for responding <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Rob.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__574">
                                                        <div class="mdl-card__title"><strong>Broke Studio</strong> posted on 
		
			
				
				Jun 3, 2015 at 12:57:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi everyone !
<br>
<br>I&apos;m new to this forum and a beginner at NES programming (not a beginner at programming in general though).
<br>I&apos;ve been looking on the forums but I haven&apos;t been able to find any answer to my question ... (sorry for my english, I&apos;m french)
<br>
<br>I&apos;m trying to write a fade out routine using the &quot;substract $10&quot; technique.
<br>
<br>Here&apos;s the idea :
<br>
<br>1) loop throught the palettes, substract $10 to each color and store it in fadePaletteData var (set the color to $0f if result is negative)
<br>2) load fadePaletteData in PPU
<br>3) activate screen (? not sure if that&apos;s right/clear)
<br>4) wait for X secondes (1 ? 2 ?)
<br>5) loop until every colors are set to $0F
<br>
<br>And here&apos;s the code I&apos;ve written so far (I&apos;m using NESIDIDE) :
<br>
<br>.proc fadeOut
<br>; init fade out
<br>
<br>    LDA $2002    ; read PPU status to reset the high/low latch to high
<br>    LDA #$3F
<br>    STA $2006    ; write the high byte of $3F00 address
<br>    LDA #$00
<br>    STA $2006    ; write the low byte of $3F00 address
<br>
<br>; save current palettes substracting $10
<br>    
<br>    LDX #$00     ; start out at 0
<br>    LDY #$20     ; 32 colors to process
<br>FadeOutSavePalette:
<br>    LDA $2007
<br>    SEC
<br>    SBC #$10
<br>    BPL FadeOutSavePaletteContinue
<br>    LDA #$0F ; if negative, set to $0F instead
<br>    DEY
<br>FadeOutSavePaletteContinue:
<br>    STA fadePaletteData, x
<br>    INX
<br>    CPX #$20
<br>    BNE FadeOutSavePalette
<br>
<br>; load new palettes
<br>
<br>    LDA $2002    ; read PPU status to reset the high/low latch to high
<br>    LDA #$3F
<br>    STA $2006    ; write the high byte of $3F00 address
<br>    LDA #$00
<br>    STA $2006    ; write the low byte of $3F00 address
<br>    LDX #$00     ; start out at 0
<br>FadeOutLoadPalette:
<br>    LDA fadePaletteData, x
<br>    STA $2007
<br>    INX
<br>    CPX #$20
<br>    BNE FadeOutLoadPalette
<br>
<br>; update screen
<br>; is there another way to apply new palette ?
<br>
<br>    LDA #%10010000 ;enable NMI, sprites from Pattern 0, background from Pattern 1
<br>    STA $2000
<br>
<br>    LDA #%00001110 ; enable sprites, enable background
<br>    STA $2001
<br>
<br>    LDA #$00 ; no scrolling (?)
<br>    STA $2005
<br>    STA $2005
<br>
<br>;
<br>; wait for 2 sec
<br>; CODE MISSING HERE
<br>;
<br>
<br>    CPY #$00 ; every colors processed ?
<br>    BNE fadeOut ; if not fade out again
<br>
<br>    RTS
<br>.endproc
<br>
<br>So I&apos;m stuck on the &quot;wait for X sec&quot; section.
<br>I really don&apos;t see how to do this ...
<br>
<br>Do I need to count X frames (50/60 for 1 sec ?) ? Is there another way to do this ?
<br>
<br>Thanks for your help !
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__575">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jun 3, 2015 at 4:25:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>glutock</b></i><br>
	<br>
	Hi everyone !<br>
	<br>
	I&apos;m new to this forum and a beginner at NES programming (not a beginner at programming in general though).<br>
	I&apos;ve been looking on the forums but I haven&apos;t been able to find any answer to my question ... (sorry for my english, I&apos;m french)<br>
	<br>
	I&apos;m trying to write a fade out routine using the &quot;substract $10&quot; technique.<br>
	<br>
	Here&apos;s the idea :<br>
	<br>
	1) loop throught the palettes, substract $10 to each color and store it in fadePaletteData var (set the color to $0f if result is negative)<br>
	2) load fadePaletteData in PPU<br>
	3) activate screen (? not sure if that&apos;s right/clear)<br>
	4) wait for X secondes (1 ? 2 ?)<br>
	5) loop until every colors are set to $0F<br>
	<br>
	And here&apos;s the code I&apos;ve written so far (I&apos;m using NESIDIDE) :<br>
	<br>
	.proc fadeOut<br>
	; init fade out<br>
	<br>
	LDA $2002 ; read PPU status to reset the high/low latch to high<br>
	LDA #$3F<br>
	STA $2006 ; write the high byte of $3F00 address<br>
	LDA #$00<br>
	STA $2006 ; write the low byte of $3F00 address<br>
	<br>
	; save current palettes substracting $10<br>
	<br>
	LDX #$00 ; start out at 0<br>
	LDY #$20 ; 32 colors to process<br>
	FadeOutSavePalette:<br>
	LDA $2007<br>
	SEC<br>
	SBC #$10<br>
	BPL FadeOutSavePaletteContinue<br>
	LDA #$0F ; if negative, set to $0F instead<br>
	DEY<br>
	FadeOutSavePaletteContinue:<br>
	STA fadePaletteData, x<br>
	INX<br>
	CPX #$20<br>
	BNE FadeOutSavePalette<br>
	<br>
	; load new palettes<br>
	<br>
	LDA $2002 ; read PPU status to reset the high/low latch to high<br>
	LDA #$3F<br>
	STA $2006 ; write the high byte of $3F00 address<br>
	LDA #$00<br>
	STA $2006 ; write the low byte of $3F00 address<br>
	LDX #$00 ; start out at 0<br>
	FadeOutLoadPalette:<br>
	LDA fadePaletteData, x<br>
	STA $2007<br>
	INX<br>
	CPX #$20<br>
	BNE FadeOutLoadPalette<br>
	<br>
	; update screen<br>
	; is there another way to apply new palette ?<br>
	<br>
	LDA #%10010000 ;enable NMI, sprites from Pattern 0, background from Pattern 1<br>
	STA $2000<br>
	<br>
	LDA #%00001110 ; enable sprites, enable background<br>
	STA $2001<br>
	<br>
	LDA #$00 ; no scrolling (?)<br>
	STA $2005<br>
	STA $2005<br>
	<br>
	;<br>
	; wait for 2 sec<br>
	; CODE MISSING HERE<br>
	;<br>
	<br>
	CPY #$00 ; every colors processed ?<br>
	BNE fadeOut ; if not fade out again<br>
	<br>
	RTS<br>
	.endproc<br>
	<br>
	So I&apos;m stuck on the &quot;wait for X sec&quot; section.<br>
	I really don&apos;t see how to do this ...<br>
	<br>
	Do I need to count X frames (50/60 for 1 sec ?) ? Is there another way to do this ?<br>
	<br>
	Thanks for your help !</div>
<br>
Moi j&apos;ai une routine toute simple pour noircir la palette. Certes, la palette se noircit chaques deux frames mais je pense que c&apos;est assez facile de la modifier pour augmenter/diminuer le temps enter deux soustractions de $10. Chaque fois que tu veux t&apos;en servir, mets une variable (J&apos;utilise $10 perso, comme &#xE7;a la palette reste noire pendant une seconde apr&#xE8;s l&apos;avoir assombrie)<br>
<br>
<div>
	;;;;;;;;;;;;;;;;;;;;;;;;;;</div>
<div>
	;;Palette fading routine;;</div>
<div>
	;;;;;;;;;;;;;;;;;;;;;;;;;;</div>
<div>
	&#xA0;</div>
<div>
	Palette_Fade:</div>
<div>
	&#xA0; LDX #$00</div>
<div>
	&#xA0; LDY #$00</div>
<div>
	&#xA0; LDA #$00</div>
<div>
	&#xA0; STA PalPointer</div>
<div>
	&#xA0; LDA fadeswitch</div>
<div>
	&#xA0; ROR A</div>
<div>
	&#xA0; BCC Palette_Fade2</div>
<div>
	&#xA0; DEC fadeswitch</div>
<div>
	&#xA0; RTS<span class="Apple-tab-span"> </span>;Make sure the human eye can actually SEE the fading - do it every 2 frames</div>
<div>
	Palette_Fade2:</div>
<div>
	&#xA0; LDA #$3F<span class="Apple-tab-span"> </span>;Hi part of $3FXX</div>
<div>
	&#xA0; STA $2006</div>
<div>
	&#xA0; LDA PalPointer<span class="Apple-tab-span"> </span>;Lo part of it</div>
<div>
	&#xA0; STA $2006</div>
<div>
	&#xA0; CPY #$00<span class="Apple-tab-span"> </span>;If the first part of the routine was done, fade the palette</div>
<div>
	&#xA0; BNE FadeOK</div>
<div>
	Palette_FadeLoop:</div>
<div>
	&#xA0; LDA $2007<span class="Apple-tab-span"> </span>;Load the palette value we use</div>
<div>
	&#xA0; CMP #$10<span class="Apple-tab-span"> </span>;Compare value to 10</div>
<div>
	&#xA0; BCS FadeMore<span class="Apple-tab-span"> </span>;If higher, fade a bit more</div>
<div>
	&#xA0; LDA #$0F</div>
<div>
	&#xA0; PHA<span class="Apple-tab-span"> </span>;Otherwise PHA some black and do nothing</div>
<div>
	&#xA0; INY</div>
<div>
	&#xA0; JMP Palette_Fade2</div>
<div>
	FadeMore:</div>
<div>
	&#xA0; SEC</div>
<div>
	&#xA0; SBC #$10<span class="Apple-tab-span"> </span>;Make it one tone darker</div>
<div>
	&#xA0; PHA<span class="Apple-tab-span"> </span>;Save this value in the STACK</div>
<div>
	&#xA0; INY<span class="Apple-tab-span"> </span>;Y reg serves as a check for this routine</div>
<div>
	&#xA0; JMP Palette_Fade2<span class="Apple-tab-span"> </span>;Go back to the palette address write to 2006</div>
<div>
	FadeOK:</div>
<div>
	&#xA0; INC PalPointer</div>
<div>
	&#xA0; PLA<span class="Apple-tab-span"> </span>;Take the value we shoved in the STACK</div>
<div>
	&#xA0; STA $2007<span class="Apple-tab-span"> </span>;And ram it in the palettes!</div>
<div>
	&#xA0; LDY #$00<span class="Apple-tab-span"> </span>;Reset the Y reg &quot;check&quot;</div>
<div>
	&#xA0; INX<span class="Apple-tab-span"> </span>;And increment X... This routine will execute itself 20 times</div>
<div>
	&#xA0; CPX #$20</div>
<div>
	&#xA0; BNE Palette_FadeLoop<span class="Apple-tab-span"> </span>;If it hasn&apos;t executed 20 times, make sure it does</div>
<div>
	&#xA0; DEC fadeswitch</div>
<div>
	&#xA0; JSR PPUCleanup</div>
<div>
	&#xA0; RTS<span class="Apple-tab-span"> </span>;Palette faded <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
	<br>
	Mets ceci en Subroutine. Ensuite, utilise le code ci-dessous au d&#xE9;but de la vBlank<br>
	<br>
	<div>
		&#xA0; LDA fadeswitch</div>
	<div>
		&#xA0; BEQ .nofade</div>
	<div>
		&#xA0; JSR Palette_Fade</div>
	<div>
		&#xA0; JMP Buffer_Done</div>
	<div>
		.nofade<br>
		<br>
		&#xA0; ;Buffer and other stuff<br>
		<br>
		Buffer_Done:</div>
</div>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__576">
                                                        <div class="mdl-card__title"><strong>Broke Studio</strong> posted on 
		
			
				
				Jun 3, 2015 at 5:42:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey ! Merci de ta r&#xE9;ponse.
<br>
<br>J&apos;ai bien compris le fonctionnement de ta routine, par contre j&apos;ai du mal &#xE0; saisir l&apos;utilisation de la variable fadeswitch ?
<br>Peux tu d&#xE9;velopper un peu &#xE7;a ? A quel moment l&apos;initialise tu ? Quelle est l&apos;utilit&#xE9; du ROR A dans ce cas pr&#xE9;cis ?
<br>C&apos;est certainement simple, mais un truc m&apos;&#xE9;chappe &#xE0; cette heure l&#xE0; <span class="sprites_emoticons absmiddle" id="emo_wink"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__577">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jun 3, 2015 at 6:27:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>glutock</b></i><br>
	<br>
	Hey ! Merci de ta r&#xE9;ponse.<br>
	<br>
	J&apos;ai bien compris le fonctionnement de ta routine, par contre j&apos;ai du mal &#xE0; saisir l&apos;utilisation de la variable fadeswitch ?<br>
	Peux tu d&#xE9;velopper un peu &#xE7;a ? A quel moment l&apos;initialise tu ? Quelle est l&apos;utilit&#xE9; du ROR A dans ce cas pr&#xE9;cis ?<br>
	C&apos;est certainement simple, mais un truc m&apos;&#xE9;chappe &#xE0; cette heure l&#xE0;</div>
<br>
En fait, d&#xE8;s qu&apos;on met une valeur autre que z&#xE9;ro dans la variable fadeswitch, la subroutine s&apos;actionne au d&#xE9;but de la vblank, ce qui rend son utilisation possible n&apos;importe o&#xF9; simplement en modifiant cette variable. En r&#xE9;sum&#xE9;, d&#xE8;s que fadeswitch =/= 0, l&apos;&#xE9;cran se noircit. Le ROR A sert &#xE0; ce que l&apos;&#xE9;cran ne se noircisse que chaques deux frames, afin que le noircissement puisse se voir &#xE0; l&apos;oeil nu (le noircissement serait bien trop rapide en 60fps)<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__578">
                                                        <div class="mdl-card__title"><strong>mattbep</strong> posted on 
		
			
				
				Jun 3, 2015 at 6:32:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I THOUGHT THIS WAS AMERICA
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__579">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jun 3, 2015 at 7:59:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>mattbep</b></i><br>
	<br>
	I THOUGHT THIS WAS AMERICA</div>
<br>
The thread has been kidnapped by french speaking programmers.<br>
Are you a bad enough dude to rescue it?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__580">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jun 8, 2015 at 8:33:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m still trying to figure this out conceptually, but what would be needed to have a projectile shoot diagonally. Not 8-directional diagonally, but any angle. What I am going for is something similar to what the Zoras do in Zelda (finding the player&apos;s position, and then shooting a projectile to that location). Not every angle will be able to be accounted for, I&apos;m guessing, and there will probably be some safe spots, but any advice to get on track with this would be great! I have mostly wiporked with four direction movement, so I&apos;m still figuring out some of the complexities that come with switching to eight directions. Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__581">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jun 8, 2015 at 11:25:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m fairly certain the experts are going to chime in with &quot;look-up tables!&quot;  I still have no idea how that&apos;s done. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__582">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jun 8, 2015 at 11:43:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I did this in Bust-A-Nut and The Grind.  Two moving things (you and the NPC) and the NPC is shooting at you.  
<br>
<br>There are several different ways of doing it.  Look up tables is a good one.  There&apos;s also a method someone posted on NA that I foolishly neglected to write down which would have worked better.
<br>
<br>I used trig to make it work properly.  You just assign each object to the points on a right triangle and make sure it knows which way is up/down, left/right.  Figure out the rise and run, divide them (which is on top/on bottof of the division depends on up/down, left/right), and you get X pixels of vertical travel for Y pixels of horizontal that hits the target 90% of the time (IIRC).  Problem is, isn&apos;t not a constant speed.  The one that I can&apos;t find is a constant speed.  
<br>
<br><a href="http://wiki.nesdev.com/w/index.php/Division_by_a_constant_integer" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/Division_by_a_constant_integer">http://wiki.nesdev.com/w/index.ph...</a>
<br><a href="http://wiki.nesdev.com/w/index.php/Multiplication_by_a_constant_integer" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/Multiplication_by_a_constant_integer">http://wiki.nesdev.com/w/index.ph...</a>
<br>
<br>Kinda make sense?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__583">
                                                        <div class="mdl-card__title"><strong>dra600n</strong> posted on 
		
			
				
				Jun 8, 2015 at 11:43:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br><br>I&apos;m still trying to figure this out conceptually, but what would be needed to have a projectile shoot diagonally. Not 8-directional diagonally, but any angle. What I am going for is something similar to what the Zoras do in Zelda (finding the player&apos;s position, and then shooting a projectile to that location). Not every angle will be able to be accounted for, I&apos;m guessing, and there will probably be some safe spots, but any advice to get on track with this would be great! I have mostly wiporked with four direction movement, so I&apos;m still figuring out some of the complexities that come with switching to eight directions. Thanks!</div><br><br><br>
What I would do is get the players position, then the starting position of the projectile, and run the movement through a quick algebraic equation. I wouldn&apos;t use a lookup table unless the players position never changes.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__584">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jun 8, 2015 at 11:45:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This forum has problems with greater than and less than signs, posting somewhere else &#xA0;<span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__585">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 8, 2015 at 1:42:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think to remember Shiru answered a really similar question from Vectrex few months ago on this forum. I&apos;ll look if I can find it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__586">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 8, 2015 at 1:52:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	I&apos;m still trying to figure this out conceptually, but what would be needed to have a projectile shoot diagonally. Not 8-directional diagonally, but any angle. What I am going for is something similar to what the Zoras do in Zelda (finding the player&apos;s position, and then shooting a projectile to that location). Not every angle will be able to be accounted for, I&apos;m guessing, and there will probably be some safe spots, but any advice to get on track with this would be great! I have mostly wiporked with four direction movement, so I&apos;m still figuring out some of the complexities that come with switching to eight directions. Thanks!</div>
^__ my post above. -&gt; Yep, here they are, in this thread.<br>
<br>
Vectrex question:&#xA0;<br>
<em>Thursday, December 04, 2014 - 04:49:41 PM</em><br>
<br>
Shiru answer:<br>
<em>Thursday, December 04, 2014 - 06:48:04 PM</em><br>
<br>
I remembered the question since I tried thinking about the best solution too.<br>
<br>
Hope this can help too. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__587">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jun 8, 2015 at 2:15:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
		<br>
		I&apos;m still trying to figure this out conceptually, but what would be needed to have a projectile shoot diagonally. Not 8-directional diagonally, but any angle. What I am going for is something similar to what the Zoras do in Zelda (finding the player&apos;s position, and then shooting a projectile to that location). Not every angle will be able to be accounted for, I&apos;m guessing, and there will probably be some safe spots, but any advice to get on track with this would be great! I have mostly wiporked with four direction movement, so I&apos;m still figuring out some of the complexities that come with switching to eight directions. Thanks!</div>
	^__ my post above. -&gt; Yep, here they are, in this thread.<br>
	<br>
	Vectrex question:&#xA0;<br>
	<em>Thursday, December 04, 2014 - 04:49:41 PM</em><br>
	<br>
	Shiru answer:<br>
	<em>Thursday, December 04, 2014 - 06:48:04 PM</em><br>
	<br>
	I remembered the question since I tried thinking about the best solution too.<br>
	<br>
	Hope this can help too.</div>
Beat me too it. I knew this was discussed before. I was banging my head trying to find it.<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__588">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jun 8, 2015 at 8:59:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>bunnyboy</b></i><br>
	<br>
	This forum has problems with greater than and less than signs, posting somewhere else &#xA0;</div>
<br>
Where is this mysterious &quot;somewhere else&quot;? <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Also, thanks for all of the feedback guys! I got hung up on another related issue, but should be able to get to it soon (and ask even more question). Weapons... the last great puzzle.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__589">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jun 14, 2015 at 3:23:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I hope Brian is still slaving away somewhere typing up the response to your question.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__590">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 15, 2015 at 10:24:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/21264/photobucket/C5B57052-BFC7-FB05-61EB4A04DA59BE9E.png" show-src="images/missing/C5B57052-BFC7-FB05-61EB4A04DA59BE9E.png"><br>
<br>
9 Sprites, in a row, the first one on the left is the lowest in number in the PPU (I hope this makes sense).<br>
<br>
Black area is the transparent color. Red area is not. Green is the scanline.<br>
<br>
So, the scanline &quot;hits&quot; 9 sprites, but doesn&apos;t render any pixel from the first one (since they are all transparent on that scanline): in such scenario the 9th sprite pixels on that scanline will be rendered or not?<br>
<br>
I can run a test in an emulator, but I wish to know for sure on real hardware.<br>
<br>
Thank you to whoever has the answer. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
I hope all this makes sense.<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<strong>Edit</strong>: misspelling
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__591">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jun 15, 2015 at 11:07:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>user</b></i><br>
	<br>
	<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/21264/photobucket/C5B57052-BFC7-FB05-61EB4A04DA59BE9E.png" show-src="images/missing/C5B57052-BFC7-FB05-61EB4A04DA59BE9E.png"><br>
	<br>
	So, the scanline &quot;hits&quot; 9 sprites, but doesn&apos;t render any pixel from the first one (since they are all transparent on that scanline): in such scenario the 9th sprite pixels on that scanline will be rendered or not?</div>
They will not be rendered. Whether the sprite has visible pixels on the specific scanline has no bearing on the sprite limitation.<br>
<br>
What happens in the PPU is that for each scanline that is being processed, it looks through the 64 sprites, and compares their Y coordinates to see if they should be rendered on the current scanline. If the Y coordinate matches, the sprite is added to the list of sprites for the current scanline, which can only fit a maximum of 8 sprites (after the list is full, the rest of the sprites are discarded). Since the sprites are scanned starting from index 0 up to index 63, the sprites with the lower index get higher priority for rendering.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__592">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 15, 2015 at 11:12:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>user</b></i><br>
		<br>
		<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/21264/photobucket/C5B57052-BFC7-FB05-61EB4A04DA59BE9E.png" show-src="images/missing/C5B57052-BFC7-FB05-61EB4A04DA59BE9E.png"><br>
		<br>
		So, the scanline &quot;hits&quot; 9 sprites, but doesn&apos;t render any pixel from the first one (since they are all transparent on that scanline): in such scenario the 9th sprite pixels on that scanline will be rendered or not?</div>
	They will not be rendered. Whether the sprite has visible pixels on the specific scanline has no bearing on the sprite limitation.<br>
	<br>
	What happens in the PPU is that for each scanline that is being processed, it looks through the 64 sprites, and compares their Y coordinates to see if they should be rendered on the current scanline. If the Y coordinate matches, the sprite is added to the list of sprites for the current scanline, which can only fit a maximum of 8 sprites (after the list is full, the rest of the sprites are discarded). Since the sprites are scanned starting from index 0 up to index 63, the sprites with the lower index get higher priority for rendering.</div>
Wow, that was quick!<br>
<br>
Thanks. Appreciated! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__593">
                                                        <div class="mdl-card__title"><strong>a0r10n</strong> posted on 
		
			
				
				Jun 18, 2015 at 9:41:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Assembly question:
<br>If I use indirect addressing mode with a register, and the resulting address would overflow, what would happen?
<br>Like:
<br>$00 = #$F0
<br>$01 = #$06
<br>x = #$20
<br>Would LDA [$00], x return $0710 or $0610?
<br>
<br>I&apos;m new to this. Sorry if the question doesn&apos;t make sense.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__594">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 18, 2015 at 10:05:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>a0r10n</b></i><br>
	<br>
	Assembly question:<br>
	If I use indirect addressing mode with a register, and the resulting address would overflow, what would happen?<br>
	Like:<br>
	$00 = #$F0<br>
	$01 = #$06<br>
	x = #$20<br>
	Would LDA [$00], x return $0710 or $0610?<br>
	<br>
	I&apos;m new to this. Sorry if the question doesn&apos;t make sense.</div>
I&apos;m not sure indexed indirect works the way you are stating here.<br>
<br>
I never used indexed indirect, while indirect indexed (the one with the &quot;y&quot; register) is pretty useful in some cases.<br>
<br>
I think in your scenario it will take the destination address from zeropage $20 and $21, but I&apos;m not too sure.<br>
What I know for sure is that indexed indirect (the one with the &quot;x&quot;) wastes lots of space in zeropage to store destination adresses, which is why I don&apos;t use it.).<br>
<br>
Better programmers than I am will likely give you a better anwer, sorry if this answer is a bit messy. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__595">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 18, 2015 at 10:23:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>a0r10n</b></i><br>
	<br>
	Assembly question:<br>
	If I use indirect addressing mode with a register, and the resulting address would overflow, what would happen?<br>
	Like:<br>
	$00 = #$F0<br>
	$01 = #$06<br>
	x = #$20<br>
	Would LDA [$00], x return $0710 or $0610?<br>
	<br>
	I&apos;m new to this. Sorry if the question doesn&apos;t make sense.</div>
<br>
Check out this link, if it still unclear let me know. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
&#xA0;<a href="http://www.obelisk.demon.co.uk/6502/addressing.html#IDX" target="_blank" original-href="http://www.obelisk.demon.co.uk/6502/addressing.html#IDX">http://www.obelisk.demon.co.uk/65...</a><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__596">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 18, 2015 at 10:38:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>a0r10n</b></i><br>
	<br>
	Assembly question:<br>
	If I use indirect addressing mode with a register, and the resulting address would overflow, what would happen?<br>
	Like:<br>
	$00 = #$F0<br>
	$01 = #$06<br>
	x = #$20<br>
	Would LDA [$00], x return $0710 or $0610?<br>
	<br>
	I&apos;m new to this. Sorry if the question doesn&apos;t make sense.</div>
Also, this one:<br>
<br>
&#xA0;<a href="http://skilldrick.github.io/easy6502/#addressing" target="_blank" original-href="http://skilldrick.github.io/easy6502/#addressing">http://skilldrick.github.io/easy6...</a><br>
<br>
---<br>
<br>
Indexed indirect: ($c0,X)<br>
<br>
This one&#x2019;s kinda weird. It&#x2019;s like a cross between zero page,X and indirect. Basically, you take the zero page address, add the value of the X register to it, then use that to look up a two-byte address. For example:<br>
<br>
LDX #$01<br>
LDA #$05<br>
STA $01<br>
LDA #$06<br>
STA $02<br>
LDY #$0a<br>
STY $0605<br>
LDA ($00,X)<br>
<br>
Memory locations $01 and $02 contain the values $05 and $06 respectively. Think of ($00,X) as ($00 + X). In this case X is $01, so this simplifies to ($01). From here things proceed like standard indirect addressing - the two bytes at $01 and $02 ($05 and $06) are looked up to form the address $0605. This is the address that the Y register was stored into in the previous instruction, so the A register gets the same value as Y, albeit through a much more circuitous route. You won&#x2019;t see this much.<br>
<br>
---<br>
<br>
So, your addressing above is neither &quot;indirect indexed&quot; nor &quot;indexed indirect&quot;.<br>
<br>
($00,x) = OK, indexed indirect<br>
($00),y = OK, indirect indexed<br>
($00),x = I fear means nothing<br>
<br>
I hope I did not write anything stupid, and that this could help a bit. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
BTW: welcome! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__597">
                                                        <div class="mdl-card__title"><strong>a0r10n</strong> posted on 
		
			
				
				Jun 18, 2015 at 10:40:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oops, you&apos;re right. I meant indirect indexed. I forget the x register can&apos;t do that.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__598">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 18, 2015 at 10:44:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>a0r10n</b></i><br>
	<br>
	Oops, you&apos;re right. I meant indirect indexed. I forget the x register can&apos;t do that.</div>
<br>
I&apos;m 99.999999% sure it does not wrap around then. It is an absolute address at that point. <span class="sprites_emoticons absmiddle" id="emo_wink"></span><br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__599">
                                                        <div class="mdl-card__title"><strong>a0r10n</strong> posted on 
		
			
				
				Jun 18, 2015 at 10:50:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the links and such!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__600">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 18, 2015 at 10:53:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>a0r10n</b></i><br>
	<br>
	Thanks for the links and such!</div>
You&apos;re welcome! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
One more:<br>
<br>
&quot;&quot;&quot; While indexed indirect addressing will only generate a zero-page address, this mode&#x2019;s target address is not wrapped - it can be anywhere in the 16-bit address space. &quot;&quot;&quot;<br>
<br>
&#xA0;<a href="http://emulator101.com/6502-addressing-modes/" target="_blank" original-href="http://emulator101.com/6502-addressing-modes/">http://emulator101.com/6502-addre...</a><br>
<br>
There is also something on NES-Dev. But I did not read it all this one.<br>
<br>
&#xA0;<a href="http://forums.nesdev.com/viewtopic.php?t=6155" target="_blank" original-href="http://forums.nesdev.com/viewtopic.php?t=6155">http://forums.nesdev.com/viewtopi...</a><br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__601">
                                                        <div class="mdl-card__title"><strong>a0r10n</strong> posted on 
		
			
				
				Jun 19, 2015 at 12:02:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Cool! Another question!
<br>Does the NES have its own built-in RNG? Or could I just use reads of $4016/ $4017?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__602">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jun 19, 2015 at 2:53:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There is no built-in RNG.  But there is a little random number subroutine floating around that does some funny math stuffs and will consistently generate random numbers depending on how long you sit at the title screen.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__603">
                                                        <div class="mdl-card__title"><strong>Double Unicorn</strong> posted on 
		
			
				
				Jun 23, 2015 at 6:28:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey there,
<br>
<br>I&apos;m thinking about getting into making some games although I have little to no experience. At the moment I&apos;m just storyboarding ideas for the project I want to make down the track but for now I&apos;ll settle with some basic programming. Anyway, my question actually relates to the thing I want to make later on which is a sort of Double Dragon II proper sequel because lets be honest.. Double Dragon III just wasn&apos;t as good. In Double Dragon II are the stages pre-built with limits and boundaries in place or does the game read from a list of &apos;stage sprites&apos; to construct the stage as you play it? The same can applies for the cut-scenes between stages. Would the game be reading a picture of the whole screen or would it grab bits and pieces to assemble it? Hopefully this makes sense...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__604">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jun 23, 2015 at 11:53:02 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Double Unicorn</b></i><br>
	<br>
	Hey there,<br>
	<br>
	I&apos;m thinking about getting into making some games although I have little to no experience. At the moment I&apos;m just storyboarding ideas for the project I want to make down the track but for now I&apos;ll settle with some basic programming. Anyway, my question actually relates to the thing I want to make later on which is a sort of Double Dragon II proper sequel because lets be honest.. Double Dragon III just wasn&apos;t as good. In Double Dragon II are the stages pre-built with limits and boundaries in place or does the game read from a list of &apos;stage sprites&apos; to construct the stage as you play it? The same can applies for the cut-scenes between stages. Would the game be reading a picture of the whole screen or would it grab bits and pieces to assemble it? Hopefully this makes sense...</div>
<br>
<br>
The NES has 4 nametables (2 of which are mirrored, vertically or horizontally), or screens, so it has to load the stages as you proceed in the level.<br>
Explaining how the NES works would be too long to fit in a forum post, so I&apos;d encourage you to read the NESdev wiki and the Nerdy Nights, especially the scrolling portions.<br>
Also, there are a lot of people that had big plans at first (me included) but then struggles in their early months of programming. It took me years to put out something decent, so I&apos;d highly suggest starting with smaller projects before you tackle a full game like a beat&apos;em up
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__605">
                                                        <div class="mdl-card__title"><strong>Broke Studio</strong> posted on 
		
			
				
				Jul 1, 2015 at 9:41:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi !<br>
<br>
Can someone tell me the difference between :<br>
<br>
STA &lt;MYVAR<br>
<br>
and<br>
<br>
STA MYVAR<br>
<br>
Thanks !<br>
<br>
edit : problem with &quot;less than&quot; symbol. Silly question by the way, I guess it&apos;s the same if the var is one byte length ...<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__606">
                                                        <div class="mdl-card__title"><strong>freem</strong> posted on 
		
			
				
				Jul 1, 2015 at 2:01:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					if you&apos;re using NESASM, the &quot;&lt;&quot; means &quot;use the zero page&quot;; other assemblers tend to use this to mean the low byte of a 16-bit value.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__607">
                                                        <div class="mdl-card__title"><strong>Broke Studio</strong> posted on 
		
			
				
				Jul 1, 2015 at 2:04:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the precision !
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__608">
                                                        <div class="mdl-card__title"><strong>darksarcasm</strong> posted on 
		
			
				
				Jul 8, 2015 at 7:20:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi, I had a question about the mappers.
<br>
<br>The game I want to make uses an MMC3C mapper, but the donor cartridge I have uses a MMC3B mapper. Is this an ok donor?
<br>
<br>Thanks in advance!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__609">
                                                        <div class="mdl-card__title"><strong>MrFaust</strong> posted on 
		
			
				
				Jul 17, 2015 at 9:31:59 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So I&apos;ve decided to take the big leap and give home brewing a go. I have very limited programming knowledge. So for the past 24 years that I&apos;ve owned a computer at most I&apos;ve learned how to do simple modifications to games. I&apos;ve managed to learn enough to make my own hack of one of my favorite NES games but even then I had tools designed to aid in creating a hack for said game. So lets just say I know very little about programming. I would like to begin with the nerdy nights tutorials and go from there.&#xA0;<br>
<br>
::EDIT::<br>
I honestly dont even know where to start. I am googling infomation but many of the links for programs are dead.<br>
<br>
::ANOTHER EDIT::<br>
Alright, I wanted to use&#xA0;NESASM3 but I can&apos;t seem to open it.&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__610">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jul 17, 2015 at 10:20:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>MrFaust</b></i><br>
<br>
<br>
::EDIT::<br>
<strong>I honestly dont even know where to start.</strong></div>
<br>
My 2 cents advice:<br>
1. copy / paste nerdy nights and format the contents in a way easy to read (bigger fonts for sure);<br>
2. when concepts such accumulator, x and y registers are clear to you, read also this:<br>
<a href="http://www.obelisk.demon.co.uk/6502/reference.html" target="_blank" original-href="http://www.obelisk.demon.co.uk/6502/reference.html">http://www.obelisk.demon.co.uk/65...</a><br>
<br>
Good luck! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<strong>Edit</strong>: link did not work
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__611">
                                                        <div class="mdl-card__title"><strong>MrFaust</strong> posted on 
		
			
				
				Jul 17, 2015 at 10:57:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So.. I downloaded a number of assemblers to get started and I find that every time I try to open one it just closes quickly. Every single one does this, i assume it has something to do with my computer. I am running windows 7 Pro 64bit, has anyone else had this issue and know how i can go about fixing it so i can actually get started. lol, im dead in the water before evening having a chance to try and learn this stuff.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__612">
                                                        <div class="mdl-card__title"><strong>Broke Studio</strong> posted on 
		
			
				
				Jul 17, 2015 at 11:05:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I don&apos;t know if it&apos;ll help but :<br>
<br>
- download CC65 or NESASM<br>
- use a notepad (notepadd++ / editplus / sublimetext / windows notepad ...) to write your code<br>
- compile your code using command line<br>
<br>
You can download a zip example from a simple tutorial and see how it&apos;s done before writing your own code.<br>
<br>
I&apos;ve also use this link article (<a href="https://shiru.untergrund.net/articles/programming_nes_games_in_c.htm" target="_blank" original-href="https://shiru.untergrund.net/articles/programming_nes_games_in_c.htm">https://shiru.untergrund.net/arti...</a>). It&apos;s for C programing but there&apos;s also some NES ASM libraries which are useful ! (THANKS SHIRU !)<br>
<br>
And if you&apos;re still lost, you can have a look at NESICIDE (<a href="http://www.nesicide.com" target="_blank" original-href="http://www.nesicide.com">http://www.nesicide.com...</a>), an NES ASM IDE which is pretty nice to start with.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__613">
                                                        <div class="mdl-card__title"><strong>MrFaust</strong> posted on 
		
			
				
				Jul 17, 2015 at 12:32:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think this is all beyond me. All it does is makes my head hurt, lol. I am going to keep at it for a couple of days and see if i pick anything up. Though at this point it just appears as math and gibberish to me. I mostly did graphical editing, its my one and only computer talent.&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__614">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jul 17, 2015 at 1:31:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>MrFaust</b></i><br>
<br>
I think this is all beyond me. All it does is makes my head hurt, lol. I am going to keep at it for a couple of days and see if i pick anything up. Though at this point it just appears as math and gibberish to me. I mostly did graphical editing, its my one and only computer talent.&#xA0;</div>
Relax. There is a lot of math gibberish to digest of course, but programming a game for a NES has some advantages.<br>
<br>
First, the machine &quot;knows&quot; what you are doing: a game. Knows there are sprite, a background, a screen that must be refreshed every 1/60th of a second, and such.<br>
<br>
You just have to learn how to communicate with your code the positions of the sprites, the tiles composing the background, where to jump at each screen refresh.<br>
<br>
If you ask me, nerdy nights is an excellent starting point.<br>
<br>
If doing it in assembly is too unfriedly to you, try the <em>Shiru </em>&quot;C way&quot; proposed and linked above by <em>glutock</em>.<br>
<br>
In any case, especially since you seem to have a really little familiarity with programming in general, this process will take you some learning time, way over a couple of days. Give yourself at least three weeks of study in your free time to understand the minimal basics, and at least another month to publish your first hyper simple mini game.<br>
<br>
Also, if starting from assembly is hard, try understanding the logic behind &quot;higher level&quot; programming languages (e.g. python, or even basic): instructions such as if, else, loop, and so on. Then you will understand that in assembly you don&apos;t have an &quot;if...(something)&quot; instruction, you have a &quot;branch if...(something)&quot; instruction instead.<br>
<br>
Take it easy, step by step, and keep your first goals minimal: being able to position a specific sprite where you intended to, is already an important achievment for a beginner.<br>
<br>
It was at least for me a year and half ago, when I started learning assembly, not being a programmer in the academic way too. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<strong>Edit</strong>: a couple of misspelling.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__615">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jul 17, 2015 at 8:12:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>MrFaust</b></i><br>
<br>
So.. I downloaded a number of assemblers to get started and I find that every time I try to open one it just closes quickly. Every single one does this, i assume it has something to do with my computer. I am running windows 7 Pro 64bit, has anyone else had this issue and know how i can go about fixing it so i can actually get started. lol, im dead in the water before evening having a chance to try and learn this stuff.</div>
The apps are commandline, so double clicking won&apos;t work. &#xA0;Either need to run them from cmd or make a batch file to pass the right arguments.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__616">
                                                        <div class="mdl-card__title"><strong>MrFaust</strong> posted on 
		
			
				
				Jul 18, 2015 at 12:38:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I managed to figure out how to use the assemblers after some digging, thanks though for the heads up Bunnyboy.<br>
<br>
As for the nerdy nights tutorials they do lay it all out for you. The problem I am having is I don&apos;t know where to start. I follow along and type the example code out in the order it is given and then as I am trying to understand the reasoning behind it but it just doesn&apos;t make sense besides that first bit of code at the beginning of every game and the banks (sort of). Either way I feel that with no coding know how something like this is just too big and complex. I am going to at least give it a couple of weeks of reading the tutorials and typing the code and hoping i manage to pick up some of the logic behind it. Who knows maybe it will magically click in my head but in all honestly computer language is complex an with out schooling or understanding of the basics its going to be rough. I am going to try and devote an hour or two each day to those tutorials and see where it takes me. Anyhow wish me luck, ill post an update or something maybe after a week or so messing with this stuff.<br>
<br>
Maybe there is a book or something with step by step instruction of making a stupid simple game. I gather once I understand how it fits together and the math of the whole thing it&apos;d be easier to explore and learn more complex coding. I&apos;ll keep an eye out on the interwebs too.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__617">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jul 18, 2015 at 2:18:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>MrFaust</b></i><br>
<br>
<strong>[1] I managed to figure out how to use the assemblers after some digging</strong>, thanks though for the heads up Bunnyboy.<br>
<br>
As for the nerdy nights tutorials they do lay it all out for you. <strong>[2] The problem I am having is I don&apos;t know where to start</strong>. I follow along and type the example code out in the order it is given and then as I am trying to understand the reasoning behind it but it just doesn&apos;t make sense besides that first bit of code at the beginning of every game and the banks (sort of). Either way I feel that with no coding know how something like this is just too big and complex. I am going to at least give it a couple of weeks of reading the tutorials and typing the code and hoping i manage to pick up some of the logic behind it. Who knows maybe it will magically click in my head but in all honestly computer language is complex an with out schooling or understanding of the basics its going to be rough. I am going to try and devote an hour or two each day to those tutorials and see where it takes me. Anyhow wish me luck, ill post an update or something maybe after a week or so messing with this stuff.<br>
<br>
Maybe there is a book or something with step by step instruction of making a stupid simple game. I gather once I understand how it fits together and the math of the whole thing it&apos;d be easier to explore and learn more complex coding. I&apos;ll keep an eye out on the interwebs too.</div>
<strong>[1]</strong> you are smarter than I am, I ended up writing my own assembler... <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<strong>[2]</strong> My silly advice for your own project besides following Nerdy Nights examples:<br>
1. program a black screen doing nothing<br>
2. same as above, plus place a single sprite in the center of the screen<br>
3. same as above, plus check each NMI (V-Blank) if UP is pressed<br>
4. same as above, plus if UP is pressed move the sprite up 1px in the next NMI (V-Blank)<br>
5. same as above, but do the same for DOWN (move 1px down), RIGHT (move 1px right), LEFT (move 1px left)<br>
6. add a static background loading at startup or when RESET is pressed<br>
and so on...<br>
<br>
However, if you get to #6, you have all the needed basics to make a game. It will take a while.<br>
<br>
Also, I&apos;m not a pro, so take my advice with caution, there are likely better approaches.<br>
<br>
Again, good luck! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__618">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Jul 18, 2015 at 3:18:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					For total beginners to programming, there is a path which I think has potential to help people learn some of the ideas behind assembly language programming so that it is easier to pick up the knowledge from the Nerdy Nights tutorials. As good as those tutorials are, they&apos;re probably not good enough to get somebody started from ground 0. There&apos;s a really good book however (not NES related, but still assembly language) which I think can be a big help. When I first tried to learn assembly language I did have a bit of programming background but not much. I didn&apos;t know where to start with assembly language. I got a bunch of books read lots of online tutorials (this was the late 90&apos;s...) and couldn&apos;t figure it out. Then I found &quot;Assembly Language: Step by Step&quot; by Jeff Duntemann. It&apos;s an old book, covers DOS assembly language...does not show you how to code games. BUT, if you&apos;re willing to put in a few weeks reading it, it should help break the ice for you. The conversational, down to earth style of the author is unparalleled. Check out my thread about this book:
<br><a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=93756" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=93756">http://nintendoage.com/forum/mess...</a>  Maybe it&apos;ll help you.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__619">
                                                        <div class="mdl-card__title"><strong>sweggreg</strong> posted on 
		
			
				
				Jul 18, 2015 at 5:02:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m new to assembly, and I&apos;m having some trouble thinking in ASM. I&apos;m trying to complete the pong game left by the Nerdy Nights tutorials, but I can&apos;t figure  out how to code movement so that the game runs while waiting for input. The ball should just keep bouncing by itself but it does not move unless a paddle is moving. Can someone look at this and give me some pointers?
<br>MovePaddleUp:
<br>  LDA buttons1;;if up button pressed
<br>  AND #%00001000
<br>  BEQ MoveBallUpDone
<br>
<br>  LDA TOPWALL
<br>  CMP paddle1ytop;;  if paddle top &gt; top wall
<br>  BCS MovePaddleUpDone
<br>  DEC paddle1ytop;;    move paddle top and bottom up
<br>  DEC paddle1ybot
<br>MovePaddleUpDone:
<br>
<br>Thanks
<br>Greg
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__620">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jul 18, 2015 at 6:23:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>sweggreg</b></i><br>
<br>
I&apos;m new to assembly, and I&apos;m having some trouble thinking in ASM. I&apos;m trying to complete the pong game left by the Nerdy Nights tutorials, but I can&apos;t figure out how to code movement so that the game runs while waiting for input. The ball should just keep bouncing by itself but it does not move unless a paddle is moving. Can someone look at this and give me some pointers?<br>
MovePaddleUp:<br>
LDA buttons1;;if up button pressed<br>
AND #%00001000<br>
<strong>BEQ MoveBallUpDone&lt;-- where this brenches?</strong><br>
<br>
LDA TOPWALL<br>
CMP paddle1ytop;; if paddle top &gt; top wall<br>
<strong>BCS MovePaddleUpDone &lt;-- where this brenches?</strong><br>
DEC paddle1ytop;; move paddle top and bottom up<br>
DEC paddle1ybot<br>
MovePaddleUpDone:<br>
<br>
Thanks<br>
Greg</div>
They do not brench the same address. So:<br>
<br>
If UP is NOT pressed goto Move<strong>Ball</strong>UpDone<br>
<br>
If paddle can&apos;t go UP goto Move<strong>Paddle</strong>UpDone<br>
<br>
I am not sure this is the issue, maybe is not, I need to see more code.<br>
<br>
But is just an idea, is possible there is a mistake here?<br>
<br>
Just trying to help. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
And welcome! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__621">
                                                        <div class="mdl-card__title"><strong>sweggreg</strong> posted on 
		
			
				
				Jul 18, 2015 at 9:07:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That was it. Notepad++ probably autocompleted to ball causing the loop. Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__622">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jul 18, 2015 at 9:16:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>sweggreg</b></i><br>
<br>
That was it. Notepad++ probably autocompleted to ball causing the loop. Thanks!</div>
You are welcome! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
Yeah, I always disable all automatic functions in text editors. And use Notepad++ too.<br>
<br>
By the way: post #500 on NA for me! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__623">
                                                        <div class="mdl-card__title"><strong>MrFaust</strong> posted on 
		
			
				
				Jul 18, 2015 at 11:20:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the help guys, means alot. Definitely overwhelming but with a community like this one can accomplish alot. Now I got to find that book an keep up with the nerding.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__624">
                                                        <div class="mdl-card__title"><strong>sweggreg</strong> posted on 
		
			
				
				Jul 19, 2015 at 7:59:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have two questions that are holding me back from collisions and by extension game creation. When doing a If A &gt; B Then C thing the syntax looks like
<br>  LDA B
<br>  CMP A
<br>  BCS branch
<br>But is this true if B or A is larger as I see conflicting examples when I look for this answer.
<br>Also can someone explain how ADC and/or SEC work to do something like If A &lt; (B+5) Then C?
<br>Thanks.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__625">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jul 19, 2015 at 8:14:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>sweggreg</b></i><br>
<br>
I have two questions that are holding me back from collisions and by extension game creation. When doing a If A &gt; B Then C thing the syntax looks like<br>
LDA B<br>
CMP A<br>
BCS branch<br>
But is this true if B or A is larger as I see conflicting examples when I look for this answer.<br>
Also can someone explain how ADC and/or SEC work to do something like If A &lt; (B+5) Then C?<br>
Thanks.</div>
<br>
LDA #$02<br>
CMP #$01<br>
BCS ... ; will take the branch the value in accumulator is bigger.<br>
<br>
LDA #$01<br>
CMP #$01<br>
BCS ... ; will take the branch the value in accumulator is equal.<br>
<br>
LDA #$00<br>
CMP #$01<br>
BCS ... ; will <strong>not</strong> take the branch the value in accumulator is lower.<br>
<br>
---<br>
<br>
LDA #$02<br>
CMP #$01<br>
BCC ... ; will <strong>not</strong> take the branch the value in accumulator is bigger.<br>
<br>
LDA #$01<br>
CMP #$01<br>
BCC ... ; will <strong>not</strong> take the branch the value in accumulator is equal.<br>
<br>
LDA #$00<br>
CMP #$01<br>
BCC ... ; will take the branch the value in accumulator is lower.<br>
<br>
---<br>
<br>
Chose BCS (carry set) or BCC (carry clear) depending on your scenario.<br>
<br>
Or other branching opcodes mnemonics. There is a link I posed above with all opcodes mnemonics.<br>
<br>
---<br>
<br>
<strong><em>If A &lt; (B+5) Then C?</em></strong><br>
<br>
<s>LDA &quot;varB&quot; ; &lt;- pseudocode<br>
CLC<br>
ADC #$05 ; add 5<br>
CMP &quot;varA&quot; ; &lt;-pseudocode<br>
BCS &quot;gotoaddressC&quot; ; B+5 is &gt;= A, hence A &lt; B+5, hence C happens</s><br>
<br>
<strong>Edit</strong>:<br>
<br>
(see TheFox post here below)<br>
<br>
LDA &quot;varB&quot; ; &lt;- pseudocode<br>
CLC<br>
ADC #$04 ; add 4<br>
CMP &quot;varA&quot; ; &lt;-pseudocode<br>
BCS &quot;gotoaddressC&quot; ; B+4 is &gt;= A, hence A &lt; B+5, hence C happens<br>
<br>
Also,<br>
<br>
&#xA0;<a href="http://www.obelisk.demon.co.uk/6502/reference.html" target="_blank" original-href="http://www.obelisk.demon.co.uk/6502/reference.html">http://www.obelisk.demon.co.uk/65...</a><br>
<br>
here the opcodes list link.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__626">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jul 19, 2015 at 8:39:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Not sure where I found this, but its a good reference. &#xA0;The branch is taken when the result is true:
<pre>A &gt;  B  lda B, cmp A, bcc greaterthan
A &gt;= B  lda A, cmp B, bcs greaterequal
A &lt;  B  lda A, cmp B, bcc lessthan
A &lt;= B  lda B, cmp A, bcs lessequal</pre>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__627">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jul 20, 2015 at 3:36:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
BCS &quot;gotoaddressC&quot; ; B+5 is &gt;= A, hence A &lt; B+5, hence C happens</div>
Small mistake there. If B+5 &gt;= A, then A &lt;= B+5, but not necessarily A &lt; B+5. Consider for example B=0 and A=5. Can be fixed by adding 4 instead of 5, so it becomes: B+4 &gt;= A, thus A &lt;= B+4, thus A &lt; B+5. Another way to do it would be to calculate the B+5 result in a temporary variable and then do the comparison the other way around (as in bunnyboy&apos;s table).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__628">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jul 20, 2015 at 3:46:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
BCS &quot;gotoaddressC&quot; ; B+5 is &gt;= A, hence A &lt; B+5, hence C happens</div>
Small mistake there. <strong>If B+5 &gt;= A, then A &lt;= B+5, but not necessarily A &lt; B+5</strong>. Consider for example B=0 and A=5. <strong>Can be fixed by adding 4 instead of 5</strong>, so it becomes: B+4 &gt;= A, thus A &lt;= B+4, thus A &lt; B+5. Another way to do it would be to calculate the B+5 result in a temporary variable and then do the comparison the other way around (as in bunnyboy&apos;s table).</div>
Doh! I&apos;m a dumb, sorry. You are of course correct. A 7yo kid would do math better (this is why I always test my code routine by routine, when I add whatever, to see how it behave). The logic at least it seems to be correct. Thanks for the correction. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__629">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jul 20, 2015 at 3:55:02 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
Doh! I&apos;m a dumb, sorry. You are of course correct. A 7yo kid would do math better (this is why I always test my code routine by routine, when I add whatever, to see how it behave). The logic at least it seems to be correct. Thanks for the correction.</div>
It&apos;s really easy to make these &quot;off-by-one&quot; type errors (so much that there&apos;s a page on Wikipedia about them), and I also make them all the time, so don&apos;t beat yourself up over it. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__630">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jul 20, 2015 at 3:58:11 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
<br>
It&apos;s really easy to make these &quot;off-by-one&quot; type errors (so much that there&apos;s a page on Wikipedia about them), and I also make them all the time, so don&apos;t beat yourself up over it.</div>
...but when you make the mistake posting on a public forum trying to <strong>teach </strong>something is a bit embarassing. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__631">
                                                        <div class="mdl-card__title"><strong>sweggreg</strong> posted on 
		
			
				
				Jul 23, 2015 at 11:48:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I can not get this ball to bounce off this paddle. Can someone who knows a bit more of what they&apos;re doing look at this code, specifically the checkpaddlecollision section and tell me why this isn&apos;t bouncing back.<br>
Thanks.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__632">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 24, 2015 at 9:35:30 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Where can I see &quot;this code&quot;? <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__633">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jul 24, 2015 at 9:43:10 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
Where can I see &quot;this code&quot;?</div>
It&apos;s in the ZIP attachment right below the post. I had the exact same experience as you the first time I saw a post with an attachment in the new layout like a week ago. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__634">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 24, 2015 at 4:04:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here I am talking up how much I love the new layout and I make a noob mistake like that!  Embarrassing. <span class="sprites_emoticons absmiddle" id="emo_wink"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__635">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 24, 2015 at 7:50:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>sweggreg</b></i><br>
<br>
I can not get this ball to bounce off this paddle. Can someone who knows a bit more of what they&apos;re doing look at this code, specifically the checkpaddlecollision section and tell me why this isn&apos;t bouncing back.<br>
Thanks.</div>
Not sure if it&apos;s the reason, but you&apos;re using the wrong&#xA0;commands when you&apos;re subtracting.<br>
<br>
---------------<br>
<br>
&#xA0; LDA ballx ;;if ball x &lt; paddle1x<br>
&#xA0; CLC<br>
&#xA0; SBC #$08<br>
&#xA0; CMP #PADDLE1X<br>
&#xA0; BCC CheckPaddleCollisionDone<br>
<br>
&#xA0;&#xA0;LDA bally ;;&#xA0;&#xA0;&#xA0; if ball y &lt; paddle y bottom<br>
&#xA0; CLC<br>
&#xA0; SBC #$08<br>
&#xA0; CMP paddle1ybot<br>
&#xA0; BCC CheckPaddleCollisionDone<br>
<br>
--------------------<br>
<br>
Should be SEC/SBC if you&apos;re subtracting and CLC/ADC if you&apos;re adding.&#xA0; Let me know if this doesn&apos;t fix it and I&apos;ll dig a little deeper.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__636">
                                                        <div class="mdl-card__title"><strong>sweggreg</strong> posted on 
		
			
				
				Jul 26, 2015 at 3:11:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Unfortunately that did not fix it, thanks for the SEC/SBC tip though.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__637">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 27, 2015 at 5:45:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here you are:<br>
<br>
CheckPaddleCollision:<br>
&#xA0; LDA ballx ;;check if ball hasn&apos;t yet reached paddle on x axis<br>
&#xA0; SEC<br>
&#xA0; SBC #$08<br>
&#xA0; CMP #PADDLE1X<br>
&#xA0; BCS CheckPaddleCollisionDone<br>
<br>
&#xA0; LDA paddle1ytop ;; check if ball is above top of paddle<br>
&#xA0; CMP bally<br>
&#xA0; BCS CheckPaddleCollisionDone<br>
<br>
&#xA0; LDA paddle1ytop ;; check if ball is below bottom of paddle<br>
&#xA0; CLC<br>
&#xA0; ADC #$10<br>
&#xA0; CMP bally<br>
&#xA0; BCC CheckPaddleCollisionDone<br>
<br>
&#xA0; LDA #$01 ;; bounce, ball now moving right<br>
&#xA0; STA ballright<br>
&#xA0; LDA #$00<br>
&#xA0; STA ballleft<br>
CheckPaddleCollisionDone:
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__638">
                                                        <div class="mdl-card__title"><strong>sweggreg</strong> posted on 
		
			
				
				Jul 29, 2015 at 1:21:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Neat thanks. The ball bounces if it gets at the same height as the paddle but I think I can mess with the numbers to get it to the right x.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__639">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 5, 2015 at 6:34:33 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If using YY-CHR, is there a way to edit (and save) the size of a file? Instead of having it be a 256 tile sized file, what about just 16, or 32, or even 1? I can open MRN&apos;s question mark blocks in his CHR-RAM tutorials (week 6), but cannot figure out how to expand them to include more than the four tiles that he uses, but less than all 256. I have a lot of repetition in my CHR files, so I would like to have smaller chunks that can be loaded in and/or manipulated, instead of re-duplicating a lot of material (the alphabet, for example). I&apos;d prefer to be able to do this in YY-CHR, since it is my editor of preference, but if it is not possible let me know. Thanks for any help!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__640">
                                                        <div class="mdl-card__title"><strong>Memblers</strong> posted on 
		
			
				
				Aug 6, 2015 at 3:50:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I don&apos;t believe you can change the file size in YY-CHR.  I usually do this in a hex editor, I use one called HxD.  I set the view options to 16 bytes per row to make it a little easier.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__641">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 6, 2015 at 5:02:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yep, that worked <span class="sprites_emoticons absmiddle" id="emo_smile"></span>. Thanks. This makes it easy to do chunks of data too, since YY CHR will save the file size once it is established, even if it can&apos;t set it up itself.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__642">
                                                        <div class="mdl-card__title"><strong>sweggreg</strong> posted on 
		
			
				
				Aug 6, 2015 at 2:24:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I was reading the tutorial posted by Atelier_B&#xE9;toux on another thread here and I was wondering how/if to use the nesST to automatically create BG name tables and put them in my code as the nerdy nights tutorial on backgrounds is the best resource on creating them I can find and even that is very hard and weird to wrap my head around.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__643">
                                                        <div class="mdl-card__title"><strong>DarkKobold</strong> posted on 
		
			
				
				Aug 6, 2015 at 2:24:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Can anyone explain how banking in PRG rom works? What confuses me is that the program counter is at a certain place, and then you need code in a different bank. So you jump to that bank, but the PC doesn&apos;t know that you&apos;ve swapped banks! So you&apos;ve just jumped to some arbitrary place in the new bank, wherever you were in the old bank. Obviously, there is some work-around, but at the moment, it just doesn&apos;t make sense how that could ever work, because the second you swap a bank, the code will be read from that bank.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__644">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Aug 6, 2015 at 9:16:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>DarkKobold</b></i><br>
<br>
Can anyone explain how banking in PRG rom works? What confuses me is that the program counter is at a certain place, and then you need code in a different bank. So you jump to that bank, but the PC doesn&apos;t know that you&apos;ve swapped banks! So you&apos;ve just jumped to some arbitrary place in the new bank, wherever you were in the old bank. Obviously, there is some work-around, but at the moment, it just doesn&apos;t make sense how that could ever work, because the second you swap a bank, the code will be read from that bank.</div>
Some mappers (e.g. UxROM, MMC1, MMC3, and many others) have a &quot;fixed bank&quot;, where some part of the PRG ROM is permanently banked in. Usually it&apos;s the upper 16 KB or 8 KB of PRG. If you have all of the bankswitching code in the fixed bank, the problem you described doesn&apos;t occur.<br>
<br>
If 32 KB banking is used (e.g. AxROM, MMC1), usually you&apos;ll have to duplicate the bankswitching code in both banks to make sure that the code will still be available after the switch. It&apos;s little bit trickier than using a mapper that has a fixed bank.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__645">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 6, 2015 at 9:19:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>DarkKobold</b></i><br>
		<br>
		Can anyone explain how banking in PRG rom works? What confuses me is that the program counter is at a certain place, and then you need code in a different bank. So you jump to that bank, but the PC doesn&apos;t know that you&apos;ve swapped banks! So you&apos;ve just jumped to some arbitrary place in the new bank, wherever you were in the old bank. Obviously, there is some work-around, but at the moment, it just doesn&apos;t make sense how that could ever work, because the second you swap a bank, the code will be read from that bank.</div>
	Some mappers (e.g. UxROM, MMC1, MMC3, and many others) have a &quot;fixed bank&quot;, where some part of the PRG ROM is permanently banked in. Usually it&apos;s the upper 16 KB or 8 KB of PRG. If you have all of the bankswitching code in the fixed bank, the problem you described doesn&apos;t occur.<br>
	<br>
	If 32 KB banking is used (e.g. AxROM, MMC1), usually you&apos;ll have to duplicate the bankswitching code in both banks to make sure that the code will still be available after the switch. It&apos;s little bit trickier than using a mapper that has a fixed bank.<br>
	<br>
	&#xA0;</div>
<br>
I&apos;ve been wondering about this some too. What are the pros/cons of using a fixed bank versus not?<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__646">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Aug 6, 2015 at 9:50:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	I&apos;ve been wondering about this some too. What are the pros/cons of using a fixed bank versus not?</div>
I&apos;d say that using a fixed bank is slightly more convenient. You don&apos;t have to worry about duplicating code/vectors/etc. The downside is that part of the address space is &quot;wasted&quot; on data you cannot change. Depending on the mapper and the game this may or may not be a big deal.<br>
<br>
The upside of using 32 KB banking is that you get access to a big chunk of memory at once. The downside is that if your data (and the code that operates on the data) doesn&apos;t fit within the 32 KB, you&apos;re going to have problems. Another downside is the need to duplicate code, as mentioned.<br>
<br>
DPCM sample playback can be a problem for 32 KB banking as well. Since the DPCM sample data needs to be available at all times, it would need to be duplicated in all banks. May or may not be a problem depending on how many samples there are and how large they are. For mappers with a 16 KB fixed bank (like UxROM) the DPCM samples would have to fit within the fixed bank, so that&apos;s another restriction.<br>
<br>
Mappers that have an 8 KB fixed bank (e.g. MMC3, MMC5, FME-7, VRC6) tend to be the most flexible, since they usually have multiple switchable banks available. Unfortunately these mappers are also more expensive.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__647">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 6, 2015 at 10:29:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks Kalle. I always feel like I&apos;m wasting space by using a fixed bank, but at the same time I&apos;m not sure what I&apos;d do with all of that extra space if I had it to work with. Probably find out the hard way... as always <span class="sprites_emoticons absmiddle" id="emo_smile"></span>.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__648">
                                                        <div class="mdl-card__title"><strong>Memblers</strong> posted on 
		
			
				
				Aug 7, 2015 at 7:40:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					With 32kB banks, it&apos;s also possible to copy the bankswitching code into NES&apos;s internal RAM, and run it from there.  At minimum it&apos;s just a mapper write and a jump, doesn&apos;t take much memory.  Of course, you still need to duplicate code to handle the vectors in every bank, no way around that.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__649">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Aug 7, 2015 at 7:56:39 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Memblers</b></i><br>
<br>
With 32kB banks, it&apos;s also possible to copy the bankswitching code into NES&apos;s internal RAM, and run it from there. At minimum it&apos;s just a mapper write and a jump, doesn&apos;t take much memory. Of course, you still need to duplicate code to handle the vectors in every bank, no way around that.</div>
Good point! I had a feeling that I may not have covered all bases.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__650">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Aug 7, 2015 at 9:37:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yea, what&apos;s really a bitch is when you&apos;re swapping the entire set of PRG memory, including the fixed bank.  For example, MMC1 can handle up to 2 sets of 256KB.  When you swap 256KB banks, it&apos;s like jumping to a completely different program.  You pretty much have to do like Memblers said while making sure you jump back and forth to the right place.  
<br>
<br>However, writing a program this large is not something you&apos;ll likely run into.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__651">
                                                        <div class="mdl-card__title"><strong>lancuster</strong> posted on 
		
			
				
				Aug 24, 2015 at 1:30:30 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Tell me what to do. I cracked one game. It turned out pretty cool. But with video recording fps drops dramatically. This is especially noticeable on the first level, inhibits the way up to the middle level. What I may to do?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__652">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Aug 24, 2015 at 9:29:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Are you asking how to record footage of a game?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__653">
                                                        <div class="mdl-card__title"><strong>Broke Studio</strong> posted on 
		
			
				
				Aug 24, 2015 at 6:36:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi everyone,<br>
<br>
(sorry for the long post but I wasn&apos;t able to upload files, I get an error message)<br>
I&apos;ve got a status bar which is working fine (with sprite 0 hit) here&apos;s the code in NMI routine :<br>
<br>
&#xA0; &#xA0; LDA #$00<br>
&#xA0; &#xA0; STA $2006<br>
&#xA0; &#xA0; STA $2006<br>
<br>
&#xA0; &#xA0; STA $2005<br>
&#xA0; &#xA0; STA $2005<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; switch CHR bank<br>
&#xA0; &#xA0; LDA #$03<br>
&#xA0; &#xA0; TAX<br>
&#xA0; &#xA0; STA bankTable,X<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; switch nametable to $2400<br>
&#xA0; &#xA0; LDA ctrl_var<br>
&#xA0; &#xA0; EOR #%00000001<br>
&#xA0; &#xA0; STA $2000<br>
<br>
@WaitNotSprite0:<br>
&#xA0; &#xA0; &#xA0; &#xA0; LDA $2002<br>
&#xA0; &#xA0; &#xA0; &#xA0; AND #%01000000<br>
&#xA0; &#xA0; &#xA0; &#xA0; BNE @WaitNotSprite0 &#xA0; ; wait until sprite 0 not hit<br>
<br>
@WaitSprite0:<br>
&#xA0; &#xA0; &#xA0; &#xA0; LDA $2002<br>
&#xA0; &#xA0; &#xA0; &#xA0; AND #%01000000<br>
&#xA0; &#xA0; &#xA0; &#xA0; BEQ @WaitSprite0 &#xA0; &#xA0; &#xA0;; wait until sprite 0 is hit<br>
<br>
&#xA0; &#xA0; &#xA0; &#xA0; LDX #$10<br>
@WaitScanline:<br>
&#xA0; &#xA0; &#xA0; &#xA0; DEX<br>
&#xA0; &#xA0; &#xA0; &#xA0; BNE @WaitScanline<br>
<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; switch CHR bank<br>
&#xA0; &#xA0; LDA #$00<br>
&#xA0; &#xA0; TAX<br>
&#xA0; &#xA0; STA bankTable,X<br>
<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; switch nametable back $2000<br>
&#xA0; &#xA0; LDA ctrl_var<br>
&#xA0; &#xA0; STA $2000<br>
<br>
Everything&apos;s fine for now.<br>
<br>
What I&apos;d like to do is to swap some colors in the palette for the status bar, and put the original colors back for the rest of the screen.<br>
<br>
I manage to do this BUT instead of having the $2000 nametable starting &quot;below&quot; the status bar, it begins &quot;under&quot; the status bar. Am I clear ? (not sure ...)<br>
<br>
Here&apos;s the code I used :<br>
<br>
&#xA0; &#xA0; LDA #$00<br>
&#xA0; &#xA0; STA $2006<br>
&#xA0; &#xA0; STA $2006<br>
<br>
&#xA0; &#xA0; STA $2005<br>
&#xA0; &#xA0; STA $2005<br>
; PALETTE SWAP<br>
&#xA0; &#xA0; &#xA0; &#xA0; LDA #$3f<br>
&#xA0; &#xA0; &#xA0; &#xA0; STA $2006<br>
&#xA0; &#xA0; &#xA0; &#xA0; LDA #$01<br>
&#xA0; &#xA0; &#xA0; &#xA0; STA $2006<br>
&#xA0; &#xA0; &#xA0; &#xA0; LDA #$30<br>
&#xA0; &#xA0; &#xA0; &#xA0; STA $2007<br>
<br>
&#xA0; &#xA0; &#xA0; &#xA0; LDA #$00<br>
&#xA0; &#xA0; &#xA0; &#xA0; STA $2006<br>
&#xA0; &#xA0; &#xA0; &#xA0; STA $2006<br>
<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; switch CHR bank<br>
&#xA0; &#xA0; LDA #$03<br>
&#xA0; &#xA0; TAX<br>
&#xA0; &#xA0; STA bankTable,X<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; switch nametable to $2400<br>
&#xA0; &#xA0; LDA ctrl_var<br>
&#xA0; &#xA0; EOR #%00000001<br>
&#xA0; &#xA0; STA $2000<br>
<br>
@WaitNotSprite0:<br>
&#xA0; &#xA0; &#xA0; &#xA0; LDA $2002<br>
&#xA0; &#xA0; &#xA0; &#xA0; AND #%01000000<br>
&#xA0; &#xA0; &#xA0; &#xA0; BNE @WaitNotSprite0 &#xA0; ; wait until sprite 0 not hit<br>
<br>
@WaitSprite0:<br>
&#xA0; &#xA0; &#xA0; &#xA0; LDA $2002<br>
&#xA0; &#xA0; &#xA0; &#xA0; AND #%01000000<br>
&#xA0; &#xA0; &#xA0; &#xA0; BEQ @WaitSprite0 &#xA0; &#xA0; &#xA0;; wait until sprite 0 is hit<br>
<br>
&#xA0; &#xA0; &#xA0; &#xA0; LDX #$10<br>
@WaitScanline:<br>
&#xA0; &#xA0; &#xA0; &#xA0; DEX<br>
&#xA0; &#xA0; &#xA0; &#xA0; BNE @WaitScanline<br>
<br>
&#xA0; &#xA0; LDA #%00000001 &#xA0;; rendering disabled + grayscale<br>
&#xA0; &#xA0; STA $2001<br>
<br>
; PALETTE SWAP<br>
&#xA0; &#xA0; LDA #$3F<br>
&#xA0; &#xA0; STA $2006<br>
&#xA0; &#xA0; LDA #$01<br>
&#xA0; &#xA0; STA $2006<br>
&#xA0; &#xA0; LDA #$1A<br>
&#xA0; &#xA0; STA $2007<br>
<br>
&#xA0; &#xA0; LDA #$00<br>
&#xA0; &#xA0; STA $2006<br>
&#xA0; &#xA0; STA $2006<br>
<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; switch CHR bank<br>
&#xA0; &#xA0; LDA #$00<br>
&#xA0; &#xA0; TAX<br>
&#xA0; &#xA0; STA bankTable,X<br>
<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ; switch nametable back $2000<br>
&#xA0; &#xA0; LDA ctrl_var<br>
&#xA0; &#xA0; STA $2000<br>
<br>
I guess I&apos;m doing something wrong, writing to a wrong register, or forgetting to write to a register ...<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__654">
                                                        <div class="mdl-card__title"><strong>lancuster</strong> posted on 
		
			
				
				Aug 25, 2015 at 4:06:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br><br>Are you asking how to record footage of a game?</div><br><br><br>
No, I need to optimize the game, because it slows down. This is especially noticeable when recording video. Soon I&apos;ll create a theme, and tell all the details.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__655">
                                                        <div class="mdl-card__title"><strong>Tomsawyer34</strong> posted on 
		
			
				
				Sep 2, 2015 at 8:35:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am trying to get Mega Man X3 to run on a X2 CX4<br>
<br>
There is this SNES flash cart I have called the Super Ufo Pro 8. It lets me play chipped games by placing a game with the same chip, as the one for the game ROM, on top of the flash cart.<br>
<br>
Unfortunately, trying to play X3 with a X2 cart as the bypass does not work since the CX4 chips in the games are different. However, I read online that changing the the value of #$01 in an X2 ROM to #$00 will make an X2 ROM work on an X3 board.<br>
<br>
So inversely, to play using the X2 CX4 will you have to change #$00 in the X3 ROM to #$01?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__656">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Sep 8, 2015 at 12:41:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>glutock</b></i><br>
	<br>
	...<br>
	<br>
	What I&apos;d like to do is to swap some colors in the palette for the status bar, and put the original colors back for the rest of the screen.<br>
	<br>
	I manage to do this BUT instead of having the $2000 nametable starting &quot;below&quot; the status bar, it begins &quot;under&quot; the status bar. Am I clear ? (not sure ...)<br>
	<br>
	...<br>
	&#xA0;</div>
<br>
If you figure this out, let us know! I wasted a good many days a while back on this problem, and never did solve it.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__657">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Sep 8, 2015 at 5:11:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>glutock</b></i><br>
<br>
...<br>
<br>
What I&apos;d like to do is to swap some colors in the palette for the status bar, and put the original colors back for the rest of the screen.<br>
<br>
I manage to do this BUT instead of having the $2000 nametable starting &quot;below&quot; the status bar, it begins &quot;under&quot; the status bar. Am I clear ? (not sure ...)<br>
<br>
...<br>
&#xA0;</div>
<br>
If you figure this out, let us know! I wasted a good many days a while back on this problem, and never did solve it.<br>
&#xA0;</div>
3x. I could never find a way to change palette colors in similar scenarios. And I just gave up with the idea.<br>
I guess that better experienced NES programmers could manage it, but I also fear that the architcture of the NES was perhaps not planned for such task.<br>
I don&apos;t know. I&apos;m just talking in a deductive way from my past experience and silly experiments wth NES coding. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__658">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Sep 8, 2015 at 7:44:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There&apos;s a thread about the topic over at NESDev: <a href="http://forums.nesdev.com/viewtopic.php?f=2&amp;t=13188" target="_blank" original-href="http://forums.nesdev.com/viewtopic.php?f=2&amp;t=13188">http://forums.nesdev.com/viewtopi...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__659">
                                                        <div class="mdl-card__title"><strong>Broke Studio</strong> posted on 
		
			
				
				Sep 9, 2015 at 8:14:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks thefox for posting the link.<br>
<br>
I&apos;m attaching the example source and rom in this post so it&apos;s in both forums ?<br>
<br>
In my actual project, I managed to update 4 colors at once, having one scanline colored between the status bar and the rest of the screen.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__660">
                                                        <div class="mdl-card__title"><strong>Cockroachcharlie</strong> posted on 
		
			
				
				Sep 9, 2015 at 9:13:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m have been studying 6502 for a while now and whilst it&apos;s trickier than the more modern languages (still not sure how all this memory movement actually puts something on the screen ), I have been managing fairly well.   However I have come to a dead end on directives. Can domebody give me a brief lesson in them using as layman&apos;s terms as possible (preferably with analogies, as I find those help me learn)?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__661">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Sep 9, 2015 at 12:52:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m pretty sure the only directives I ever use are:<br>
<br>
&#xA0; .db (I use this for a series of 8-bit bytes).<br>
<br>
For example:<br>
<br>
Sample:<br>
&#xA0; LDX<br>
.Loop:<br>
&#xA0; LDA Stuff,x<br>
&#xA0; INX<br>
&#xA0; CPX #$04<br>
&#xA0; BNE .Loop<br>
&#xA0; RTS<br>
<br>
Stuff:<br>
&#xA0; .db $80,$30,$24,$38<br>
<br>
But .db is only for 8-bit values. For 16-bit values you need to use either .dw or .word.<br>
<br>
&#xA0; .dw/.word (16-bit values, pointer tables, etc... .dw and .word are interchangeable)<br>
<br>
For example:<br>
<br>
GetBackground:<br>
&#xA0; LDA BG_ptr<br>
&#xA0; ASL A<br>
&#xA0; TAY<br>
&#xA0; LDA Background_Pointer_Table,y<br>
&#xA0; STA AddrLow<br>
&#xA0; LDA Background_Pointer_Table+1,y<br>
&#xA0; STA AddrHigh<br>
;;etc<br>
&#xA0; RTS<br>
<br>
Background_Pointer_Table:<br>
&#xA0; .dw Title, Gameplay, GameOver<br>
<br>
Other than that I will use<br>
<br>
.include whatever.asm (include any non-binary file)<br>
.incbin whatever.bin (include any binary file)<br>
.org (I think the official definition of this is to set the location counter. I look at it as setting a load address)<br>
<br>
And then another useful directive to use is .ifdef/.else/.endif which basically allows you to set parameters of if/then/else. I use this when setting the mapper number or if I create a demo version of my game.<br>
<br>
For example:<br>
<br>
GTROM .EQU 1<br>
<br>
&#xA0; .ifdef GTROM (if GTROM isn&apos;t commented out, do this)<br>
&#xA0; .inesmap 2 ; mapper 2 = UNROM<br>
&#xA0; .else (if GTROM is commented out, skip to this)<br>
&#xA0; .inesmap 30 ; mapper 30 = UNROM512<br>
&#xA0; .endif (end of this .ifdef)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__662">
                                                        <div class="mdl-card__title"><strong>Cockroachcharlie</strong> posted on 
		
			
				
				Sep 9, 2015 at 4:19:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So if I am understanding this correctly, these are all preloaded?  I have been associating them more as individually defined (such as variables in modern languages i.e. int something )
<br>
<br>If thats true, it makes it a lot easier to grasp.  Is there a place i can go for a list?  My current sources never even mention them, and admittedly, the only harDcopy i have is copywrite 1980 :-/.  Also, are these NES specific, or otherwise limited in use?
<br>
<br>P.s. your answer was seriously exciting.  Every step forward is renewed vigor.  :-)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__663">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Sep 9, 2015 at 4:31:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>glutock</b></i><br>
	<br>
	Thanks thefox for posting the link.<br>
	<br>
	I&apos;m attaching the example source and rom in this post so it&apos;s in both forums ?<br>
	<br>
	In my actual project, I managed to update 4 colors at once, having one scanline colored between the status bar and the rest of the screen.</div>
<br>
Thanks a ton for posting this, very excited to see what you did! I don&apos;t get over to NESDev these days as much as I should :/. Thanks too Kalle for the link!<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__664">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Sep 9, 2015 at 4:47:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Cockroachcharlie</b></i><br>
<br>
So if I am understanding this correctly, these are all preloaded? I have been associating them more as individually defined (such as variables in modern languages i.e. int something )<br>
<br>
If thats true, it makes it a lot easier to grasp. Is there a place i can go for a list? My current sources never even mention them, and admittedly, the only harDcopy i have is copywrite 1980 :-/. Also, are these NES specific, or otherwise limited in use?<br>
<br>
P.s. your answer was seriously exciting. Every step forward is renewed vigor. :-)</div>
<br>
All of the directives are preloaded in the sense that NESASM understands them innately, just like any command like LDA/STA.&#xA0; The data they control will be different all the time, obviously, but they&apos;re used in the same sort of context every time.<br>
<br>
I unfortunately don&apos;t know of any list.&#xA0; I just stick to what I know.&#xA0; And I&apos;m sure they will work with any assembly code, although they may be called something slightly different.&#xA0; NES is the only thing I know how to code for, sadly. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__665">
                                                        <div class="mdl-card__title"><strong>Cockroachcharlie</strong> posted on 
		
			
				
				Sep 9, 2015 at 4:55:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>Cockroachcharlie</b></i><br>
<br>
So if I am understanding this correctly, these are all preloaded? I have been associating them more as individually defined (such as variables in modern languages i.e. int something )<br>
<br>
If thats true, it makes it a lot easier to grasp. Is there a place i can go for a list? My current sources never even mention them, and admittedly, the only harDcopy i have is copywrite 1980 :-/. Also, are these NES specific, or otherwise limited in use?<br>
<br>
P.s. your answer was seriously exciting. Every step forward is renewed vigor. :-)</div>
<br>
All of the directives are preloaded in the sense that NESASM understands them innately, just like any command like LDA/STA.&#xA0; The data they control will be different all the time, obviously, but they&apos;re used in the same sort of context every time.<br>
<br>
I unfortunately don&apos;t know of any list.&#xA0; I just stick to what I know.&#xA0; And I&apos;m sure they will work with any assembly code, although they may be called something slightly different.&#xA0; NES is the only thing I know how to code for, sadly.<br>
<br>
<br>
&#xA0;</div>
<br>
<br>
Either way, it&apos;s a huge help, and a confidence booster.&#xA0; Thanks a lot.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__666">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Sep 9, 2015 at 5:03:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Cockroachcharlie</b></i><br>
<br>
So if I am understanding this correctly, these are all preloaded? I have been associating them more as individually defined (such as variables in modern languages i.e. int something )<br>
<br>
If thats true, it makes it a lot easier to grasp. Is there a place i can go for a list? My current sources never even mention them, and admittedly, the only harDcopy i have is copywrite 1980 :-/. Also, are these NES specific, or otherwise limited in use?<br>
<br>
P.s. your answer was seriously exciting. Every step forward is renewed vigor. :-)</div>
<br>
Assembler directives are assembler specific(not CPU specific), tho there are usually a set of directives most assemblers have.<br>
A directive tells the <u>assembler</u> to do something like &quot;define constant value in ROM at this location&quot;(nothing done in CPU, just a value in the ROM memory somewhere that you can access) or &quot;start assembling from this address&quot;.<br>
An opcode tells the <u>CPU</u> to do something, like &quot;add value to accumulator&quot;.<br>
<br>
Edit: A variable in a modern language is stored in RAM, it&apos;s the same here. Just a value that you can read/write to.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__667">
                                                        <div class="mdl-card__title"><strong>Cockroachcharlie</strong> posted on 
		
			
				
				Sep 9, 2015 at 8:47:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks DoNotWant.  The difference between speaking to the CPU and speaking to the assembler is noteworthy, and makes it a lot easier to wrap my head around when I can say they are kinda-sorta-something like compiler instructions for more modern languages.  :-)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__668">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Sep 19, 2015 at 3:02:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m making an <strong>MMC3</strong>&#xA0;game with an IRQ-triggered status bar on the bottom. I made my routine and it works on FCEUX. However other emulators don&apos;t seem to be very keen on that routine. Anyone knows why it&apos;s wrong?<br>
Here is the IRQ triggering code in my NMI and my IRQ handler.<br>
<br>
<span style="font-family:courier new,courier,monospace;">&#xA0; LDA IRQFlag &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;This is the code that&apos;s in my NMI handler. Basically, it checks if the game needs IRQs with the IRQFlag variable<br>
&#xA0; BEQ .noirq &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;then it does IRQ stuff like it&apos;s explained here - <a href="scraper/files/mmc3irqs.txt" target="_blank" original-href="http://bobrost.com/nes/files/mmc3irqs.txt">http://bobrost.com/nes/files/mmc3...</a><br>
&#xA0; STA IRQOFF &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;IRQLATCH&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;= $C000<br>
&#xA0; LDA #$BF &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;IRQRELOAD&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;= $C001<br>
&#xA0; STA IRQLATCH &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;IRQOFF&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;= $E000<br>
&#xA0; STA IRQRELOAD &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;IRQON&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;= $E001<br>
&#xA0; STA IRQOFF<br>
&#xA0; STA IRQON<br>
.noirq<br>
<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;More code here...<br>
<br>
IRQ: &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;This is my IRQ handler. Right now, it just scrolls the status bar with the &quot;ticker&quot; variable, and bankswitches CHR<br>
&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;Works on FCEUX, doesn&apos;t work on any other emulator<br>
&#xA0; PHA &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;(Don&apos;t have a flashcart to test it on...)<br>
&#xA0; TXA<br>
&#xA0; PHA<br>
&#xA0; TYA<br>
&#xA0; PHA<br>
<br>
&#xA0; LDX #$00<br>
.loop<br>
&#xA0; INX<br>
&#xA0; CPX #$0A<br>
&#xA0; BNE .loop<br>
<br>
&#xA0; NOP<br>
<br>
&#xA0; LDA #%10000000<br>
&#xA0; STA BANKSWAP<br>
&#xA0; LDA #%00010000<br>
&#xA0; STA BANKDATA<br>
<br>
&#xA0; LDA ticker<br>
&#xA0; STA $2005<br>
&#xA0; LDA #$00<br>
&#xA0; STA $2005<br>
<br>
&#xA0; LDA #%10110000<br>
&#xA0; STA $2000<br>
<br>
&#xA0; STA IRQOFF &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;;It&apos;s supposed to acknowledge the IRQ here.<br>
<br>
&#xA0; PLA<br>
&#xA0; TAX<br>
&#xA0; PLA<br>
&#xA0; TAY<br>
&#xA0; PLA<br>
<br>
&#xA0; RTI</span><br>
<br>
Thanks for your help guys <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__669">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Sep 19, 2015 at 3:15:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					First thing I noticed was that you&apos;re pushing in order A, X, Y but pulling X, Y, A (should be Y, X, A). Not sure if that fixes the problem, but it&apos;d be the first thing to try.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__670">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Sep 19, 2015 at 3:22:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					One important thing to remember about MMC3 is to not assign the same PPU CHR page for sprites and BG tiles. I.e. one page should be used for BG tiles only, other for sprites only, either in 8x8 or 8x16 mode. Otherwise IRQs just won&apos;t work.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__671">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Sep 19, 2015 at 5:17:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
<br>
First thing I noticed was that you&apos;re pushing in order A, X, Y but pulling X, Y, A (should be Y, X, A). Not sure if that fixes the problem, but it&apos;d be the first thing to try.</div>
<br>
<br>
I asked the same question on NESdev, and I already noticed that lol <span class="sprites_emoticons absmiddle" id="emo_tongue"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__672">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Sep 19, 2015 at 5:19:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Shiru</b></i><br>
<br>
One important thing to remember about MMC3 is to not assign the same PPU CHR page for sprites and BG tiles. I.e. one page should be used for BG tiles only, other for sprites only, either in 8x8 or 8x16 mode. Otherwise IRQs just won&apos;t work.</div>
<br>
Don&apos;t think I understand what you mean by PPU CHR page... However this might be the solution.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__673">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Sep 19, 2015 at 5:56:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There is two 256-tile pattern tables accessible by PPU, one at $0000, other at $1000 in the PPU address space. Each table can be selected to be used for BG or sprites (8x16 sprites can use both tables) using bits 3 and 4 of the $2000 (PPUCTRL). To make MMC3 IRQs work, you should use one of the tables only for BG, and other only for sprites. Say, if you assign $0000 table both to BG and sprites, it won&apos;t work; if you use 8x16 sprites to use tiles from the table assigned to the BG, it won&apos;t work.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__674">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Sep 19, 2015 at 6:17:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Shiru</b></i><br>
<br>
There is two 256-tile pattern tables accessible by PPU, one at $0000, other at $1000 in the PPU address space. Each table can be selected to be used for BG or sprites (8x16 sprites can use both tables) using bits 3 and 4 of the $2000 (PPUCTRL). To make MMC3 IRQs work, you should use one of the tables only for BG, and other only for sprites. Say, if you assign $0000 table both to BG and sprites, it won&apos;t work; if you use 8x16 sprites to use tiles from the table assigned to the BG, it won&apos;t work.</div>
<br>
Turns out it didn&apos;t behave correctly because my game used 8x16 sprites. However this leaves me in a tricky situation, since I need 8x16 sprites for my game... Is there a way to fix this without having to drop the 8x16 sprites or to use a sprite zero hit?<br>
<br>
EDIT: I just put my sprites on the other pattern table, it was as easy as that <span class="sprites_emoticons absmiddle" id="emo_tongue"></span> Thanks for the help, much appreciated.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__675">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Sep 19, 2015 at 6:51:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes, all you need to use 8x16 with working MMC3 IRQs is to keep your sprites in a single pattern table.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__676">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Oct 15, 2015 at 8:25:54 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					In dealing with reserved space/.rs variables at the beginning of a program, how much of this space is there? Likewise, how much of it can be battery backed (or stored in a flash sector)? In what ways can it be increased, if at all? In contemplating a larger project, or simply a more stat driven game, it would seem that a lot of variables would be needed (items, character names, event flags, etc.). Even Family Vacation is using a lot of this space, though likely not too efficiently <span class="sprites_emoticons absmiddle" id="emo_smile"></span>. Time to learn!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__677">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Oct 15, 2015 at 10:29:16 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The usable internal RAM is from $0000-$0800, but some of that is used by sprites and some is used by the stack.<br>
<br>
So generally you can use:<br>
<br>
$0000-$00FF<br>
$0100-$01FF ;the stack uses most of this. You can see in the hex editor, but you can still use some of it.<br>
$0200-$02FF ;most people use this for sprites<br>
$0300-$07FF ;you can use all of this also<br>
<br>
As for how much can be stored in flash memory... basically all of it. Generally I always have either 8KB (an entire bank) dedicated to it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__678">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Oct 15, 2015 at 11:30:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The breakdown looks like this I guess.
<br>
<br>$0000-00FF - zero page, reserved for pointers and other special things
<br>$0100-01FF - stack
<br>$0200-02FF - sprites
<br>$0300-03FF - music
<br>$0400-04FF - 256 free
<br>$0500-05FF - 256 free
<br>$0600-06FF - 256 free
<br>$0700-07FF - 256 free
<br>
<br>So, that leaves 1024 bytes free for additional variables. If I have 256 or so items, that is reduced to 758, and character stats will take another significant chunk, unless I just use tables and do not randomize the level bonuses.
<br>
<br>So I guess the question remains, is there a way to get more spaces? Lacking the terminology here, but you folks know what I mean.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__679">
                                                        <div class="mdl-card__title"><strong>That Old Au Guy</strong> posted on 
		
			
				
				Oct 15, 2015 at 11:47:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Optimization. Optimize optimize optimize. Let&apos;s say you have 256 or so items. Are you really going to get all 255 of them in your inventory? If you&apos;re only going to get at most one, well, each byte has 8 bits; this means that your 256 unique items can be in 16B rather than eat up 256B. Or even with 99 items, you can place a limit of 128, thus each item requires 7b rather than 8b/1B, and you have an extra 16B for whatever. It&apos;s slower in run-time, yes, but if you&apos;re itching for RAM, you&apos;re going to need to do this and get those few extra bytes free.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__680">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Oct 15, 2015 at 11:58:10 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br>
<br>
... <strong>and character stats will take another significant chunk</strong>, ...</div>
<br>
How big is the span (min to max) in such stats values?<br>
<br>
Maybe a possible solution, to fit everything in the RAM space, is to fit more than one info in a single Byte.<br>
Let say stats go 00 to FF: in a byte you can store only one.<br>
Let say stats go 00 to 0F: in a byte you can store two of them.<br>
Let say stats go 00 to 03: in a byte you can store four of them.<br>
Let say stats are boolean 00 or 01: in a byte you can store eight of them.<br>
<br>
In any case, you then need to use LSRs instructions (or maybe in some cases ROLs instructions, if you care about saving few cycles), followed by ANDs instrutions, in order to get the specific values, and then again AND, ORA, and such instruction to &quot;build&quot; the Byte again and store the info back in RAM.<br>
<br>
It is likely not the most programmer friendly approach, is way more complex than use a byte for each single info, but if your priority goal is to store a lot of info in a little RAM space, from experience I can say that, if planned and coded correctly, it works perfectly and it is not so inefficient.<br>
<br>
Just trying to help, probably there are better solutions out there. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__681">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Oct 15, 2015 at 12:01:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					^___ Cross posting with N the Bit Gamer.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__682">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Oct 19, 2015 at 5:25:46 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I had an idea for a map system for a 256-room level, with 4 &quot;floors&quot; of 64 rooms. Rather than using 256 bytes of RAM for that map, you can just use 32 bytes by setting bits on and off. Let&apos;s say you are in the room below at X=5 Y=6
<br>
<br>00000000
<br>00000000
<br>00001000
<br>00000000
<br>00000000
<br>00000000
<br>00000000
<br>00000000
<br>
<br>Then let&apos;s say you go to X=6 Y=6. You only have to set one bit to mark the spot on the map. It&apos;s simple, convenient stuff like that that saves RAM. That&apos;s also part of the fun of programming, you have so many ways to make stuff work but the goal is to find the best way to make your stuff work.
<br>
<br>00000000
<br>00000000
<br>00001100  ;Set the bit here
<br>00000000
<br>00000000
<br>00000000
<br>00000000
<br>00000000
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__683">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Oct 19, 2015 at 5:57:59 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Usually there is enough unused room in the stack page to put all sound/music player variables there.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__684">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Oct 19, 2015 at 6:54:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Vectrex280996</b></i><br>
<br>
I had an idea for a map system for a 256-room level, with 4 &quot;floors&quot; of 64 rooms. Rather than using 256 bytes of RAM for that map, you can just use 32 bytes by setting bits on and off. (cut...) you have so many ways to make stuff work but the goal is to find the best way to make your stuff work.</div>
<br>
Extending the concept to other types of savings, it is also possible to check back a working routine to see if it is possible to reduce the number of instructions or cycles.<br>
And even if there are cycles to waste, often it is easier to read the code later, if it is shorter.<br>
<br>
For instance, the most banal thing:<br>
<br>
LDA #$00<br>
LDX #$00 ; by the way, here TAX would already save something<br>
LOOP:<br>
STA ADDRESS_IN_RAM,x<br>
INX<br>
CPX #$40<br>
BNE LOOP<br>
<br>
can also be coded like this:<br>
<br>
LDA #$00<br>
LDX #$3F<br>
LOOP:<br>
STA ADDRESS_IN_RAM,x<br>
DEX<br>
BPL LOOP<br>
<br>
the two loops do exactely the same thing, but the second one saves 64 (decimal) CPX instructions.<br>
Moreover, with the second loop it is visually more clear that it is Address+Hex00 to Address+Hex3f being influenced, while Address+Hex40 it is not.<br>
<br>
There are of course way better examples than this one for number of instructions or cycles saved, I just picked the more obvious to understand.<br>
<br>
<strong>Edit</strong>: mistake.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__685">
                                                        <div class="mdl-card__title"><strong>sempressimo</strong> posted on 
		
			
				
				Oct 29, 2015 at 4:50:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi, this is my code for determining the tile (8x8 pixels) the player is on. Basically what I am trying to do is (x + y * 32), so that later I can look it up in the tiles array (.db)<br>
<br>
I am not sure if ASL (five times would be the same as * 32).<br>
<br>
CalcTargetTileNumber:<br>
<br>
&#xA0; ; Update the player positional variables<br>
&#xA0; ; Divide by the tile size (8)<br>
&#xA0; LDA playerx<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; STA player_tile_x<br>
<br>
&#xA0; LDA playery<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; STA player_tile_y<br>
&#xA0;<br>
&#xA0; LDA player_tile_y<br>
&#xA0; ASL A ; multiple by 32?<br>
&#xA0; ASL A<br>
&#xA0; ASL A<br>
&#xA0; ASL A<br>
&#xA0; ASL A<br>
&#xA0; CLC<br>
&#xA0; ADC player_tile_x<br>
&#xA0; STA target_tile_number<br>
<br>
&#xA0; RTS
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__686">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Oct 29, 2015 at 11:17:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					ASL five times is *32 indeed. However, you need 16-bit math there, as you easily get out of 8-bit number limits. I.e. 10*32=320, too much to hold in a byte.
<br>
<br>Also, it is not necessary to divide playery by 8 then multiply by 32, you can just cut off the lower three bits with and #$f8, then multiply by 4, i.e. do two 16-bit ASLs. Alternatively, do two 16-bit ASLs on playery, then cut the bottom five bits with and #$c0.
<br>
<br>To understand it better think about the numbers as binary. All the math here is just about shifting and omiting some bits.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__687">
                                                        <div class="mdl-card__title"><strong>sempressimo</strong> posted on 
		
			
				
				Nov 1, 2015 at 10:37:31 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am wondering. I read that the NES always renders all loaded sprites, so if I need one not to render (e.g. killed an enemy), what is the proper approach not to render it? I know there is a flag where I can put it behind the background, but not sure if this is best.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__688">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Nov 1, 2015 at 10:40:34 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Set the Y coordinate of any sprite you wish to hide to $ff.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__689">
                                                        <div class="mdl-card__title"><strong>sempressimo</strong> posted on 
		
			
				
				Nov 1, 2015 at 10:44:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>GradualGames</b></i><br>
<br>
Set the Y coordinate of any sprite you wish to hide to $ff.</div>
Thanks!<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__690">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Nov 1, 2015 at 12:55:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>sempressimo</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>GradualGames</b></i><br>
<br>
Set the Y coordinate of any sprite you wish to hide to $ff.</div>
Thanks!<br>
<br>
&#xA0;</div>
<br>
<br>
Any value from #$EF to #$FF is fine actually
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__691">
                                                        <div class="mdl-card__title"><strong>sempressimo</strong> posted on 
		
			
				
				Nov 2, 2015 at 10:56:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I want to compare the player &quot;box&quot; to the enemies &quot;box&quot; to test for collision. Is the proper way to do it is to compare wheter each of the box corners (x,y) lies inside the enemy box? I know this will work, but I am not sure is the optimal way, plus there may be a trick on ASM I might be missing as I am not proficient at binary tricks.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__692">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Nov 2, 2015 at 11:46:11 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That&apos;s pretty much how it&apos;s done.  The sprite boxes are easy.  When you get to comparing player boxes with background, it gets a bit tricky.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__693">
                                                        <div class="mdl-card__title"><strong>sempressimo</strong> posted on 
		
			
				
				Nov 2, 2015 at 1:19:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am having a bit of trouble with collision against background I can&apos;t figure out. Attached is the .nes so that you can see it in the emulator. Logical tiles and logical player box are all 16x16 pixels.<br>
<br>
Collisions againts left and right seem about right. But I am having an offset of about 3 pixels against up and down. Also it is weird I had to add 15 instead 16 to the player width to get the right wall collision right (i.e. no gaps).<br>
<br>
I am testing againts a collision map of #$00 for walk or #$01 for wall created as .db(s). The player box position is updated each frame. Some relevant code is:<br>
<br>
;--------------------------------------<br>
<br>
NMI:<br>
<br>
&#xA0;&#xA0;...<br>
<br>
&#xA0; JSR StoreLastPlayerPos<br>
<br>
&#xA0; JSR ReadController1&#xA0; ; get the current button data for player 1<br>
<br>
&#xA0; JSR ProcessUserInput<br>
<br>
&#xA0; JSR UpdatePlayerBox<br>
&#xA0;<br>
&#xA0; JSR CheckPlayerBackgroundCollision<br>
<br>
&#xA0; LDA player_collided<br>
&#xA0; CMP #$01<br>
&#xA0; BEQ DontUpdatePosition<br>
&#xA0;<br>
&#xA0; JSR UpdatePlayerSpritePosition<br>
&#xA0;<br>
&#xA0; RTI<br>
<br>
;------------------------<br>
; Subroutines<br>
;------------------------<br>
UpdatePlayerBox:<br>
<br>
&#xA0; ; Player position + width (or) height&#xA0;<br>
&#xA0; LDA player_x<br>
&#xA0; CLC<br>
&#xA0; ADC player_sprite_dimension<br>
&#xA0; STA player_x_w<br>
&#xA0;<br>
&#xA0; LDA player_y<br>
&#xA0; CLC<br>
&#xA0; ADC player_sprite_dimension<br>
&#xA0; STA player_y_h<br>
<br>
&#xA0; RTS<br>
<br>
;------------------------<br>
; Collision subroutines<br>
;------------------------<br>
CheckPlayerBackgroundCollision:<br>
<br>
&#xA0; ; Reset flag to no collition<br>
&#xA0; LDA #$00<br>
&#xA0; STA player_collided<br>
&#xA0;<br>
&#xA0; ; Moving Right?<br>
&#xA0; LDA player_dir<br>
&#xA0; CMP #$01<br>
&#xA0; BNE NotMovingRight<br>
&#xA0; JMP CheckBackgroundCollitionRight<br>
<br>
NotMovingRight:<br>
<br>
&#xA0; ; Moving Left?<br>
&#xA0; LDA player_dir<br>
&#xA0; CMP #$03<br>
&#xA0; BNE NotMovingLeft<br>
&#xA0; JMP CheckBackgroundCollitionLeft<br>
<br>
NotMovingLeft:<br>
<br>
&#xA0; ; Moving Down?<br>
&#xA0; LDA player_dir<br>
&#xA0; CMP #$02<br>
&#xA0; BNE NotMovingDown<br>
&#xA0; JMP CheckBackgroundCollitionDown<br>
<br>
NotMovingDown:<br>
<br>
&#xA0; ; Moving Up?<br>
&#xA0; LDA player_dir<br>
&#xA0; CMP #$00<br>
&#xA0; BNE NotMovingUp<br>
&#xA0; JMP CheckBackgroundCollitionUp<br>
&#xA0;<br>
NotMovingUp:<br>
&#xA0;<br>
&#xA0; RTS ; Player is idle, skip background collision<br>
&#xA0;<br>
CheckBackgroundCollitionUp:<br>
<br>
&#xA0; LDA player_x<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A ; / 16<br>
&#xA0; STA object_tile_x ; Contains top right X point tile position<br>
&#xA0;<br>
&#xA0; LDA player_y<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; STA object_tile_y ; Contains top right X point tile position<br>
&#xA0; ASL A<br>
&#xA0; ASL A<br>
&#xA0; ASL A<br>
&#xA0; ASL A ; * 16<br>
&#xA0; CLC<br>
&#xA0; ADC object_tile_x ; + x tile pos<br>
&#xA0;<br>
&#xA0; TAX ; store the calc in X register<br>
&#xA0;<br>
&#xA0; LDA background_0_Collision, x<br>
&#xA0; CMP #$01<br>
&#xA0; BNE NoBackgroundCollisionUp<br>
&#xA0;<br>
&#xA0; LDA #$01<br>
&#xA0; STA player_collided<br>
<br>
NoBackgroundCollisionUp:<br>
&#xA0;<br>
&#xA0; RTS<br>
&#xA0;<br>
CheckBackgroundCollitionDown:<br>
<br>
&#xA0; LDA player_x<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; STA object_tile_x ; Contains top right X point tile position<br>
&#xA0;<br>
&#xA0; LDA player_y_h<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; STA object_tile_y ; Contains top right X point tile position<br>
&#xA0; ASL A<br>
&#xA0; ASL A<br>
&#xA0; ASL A<br>
&#xA0; ASL A ; * 16<br>
&#xA0; CLC<br>
&#xA0; ADC object_tile_x ; + x tile pos<br>
&#xA0;<br>
&#xA0; TAX ; store the calc in X register<br>
&#xA0;<br>
&#xA0; LDA background_0_Collision, x<br>
&#xA0; CMP #$01<br>
&#xA0; BNE NoBackgroundCollisionDown<br>
&#xA0;<br>
&#xA0; LDA #$01<br>
&#xA0; STA player_collided<br>
<br>
NoBackgroundCollisionDown:<br>
&#xA0;<br>
&#xA0; RTS<br>
&#xA0;<br>
CheckBackgroundCollitionLeft:<br>
&#xA0;<br>
&#xA0; LDA player_x<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; STA object_tile_x ; Contains top right X point tile position<br>
&#xA0;<br>
&#xA0; LDA player_y<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; LSR A<br>
&#xA0; STA object_tile_y ; Contains top right X point tile position<br>
&#xA0; ASL A<br>
&#xA0; ASL A<br>
&#xA0; ASL A<br>
&#xA0; ASL A ; * 16<br>
&#xA0; CLC<br>
&#xA0; ADC object_tile_x<br>
&#xA0;<br>
&#xA0; TAX ; store the calc in X register<br>
&#xA0;<br>
&#xA0; LDA background_0_Collision, x<br>
&#xA0; CMP #$01<br>
&#xA0; BNE NoBackgroundCollisionLeft<br>
&#xA0;<br>
&#xA0; LDA #$01<br>
&#xA0; STA player_collided<br>
<br>
NoBackgroundCollisionLeft:<br>
<br>
&#xA0; RTS<br>
<br>
background_0_Collision:<br>
<br>
&#xA0; .db $01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01<br>
&#xA0; .db $01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01<br>
&#xA0; .db $01,$00,$01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01<br>
&#xA0; .db $01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01<br>
&#xA0; .db $01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01<br>
&#xA0; .db $01,$00,$01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01<br>
&#xA0; .db $01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01<br>
&#xA0; .db $01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01<br>
&#xA0; .db $01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01<br>
&#xA0; .db $01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01<br>
&#xA0; .db $01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01<br>
&#xA0; .db $01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01<br>
&#xA0; .db $01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01<br>
&#xA0; .db $01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01<br>
&#xA0; .db $01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01<br>
<br>
<br>
<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__694">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Nov 3, 2015 at 4:33:43 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Questions like this does not really work, as not too many people interested to dig into a large chunk of someone&apos;s else code, neither in text, nor in debugger (and you haven&apos;t actually attached the file).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__695">
                                                        <div class="mdl-card__title"><strong>sempressimo</strong> posted on 
		
			
				
				Nov 3, 2015 at 8:18:18 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Shiru</b></i><br>
<br>
Questions like this does not really work, as not too many people interested to dig into a large chunk of someone&apos;s else code, neither in text, nor in debugger (and you haven&apos;t actually attached the file).</div>
<br>
Yes, that makes sense. I am currently trying to optimize the code to less lines and possibly pin point where the error might be.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__696">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 3, 2015 at 3:38:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>sempressimo</b></i><br>
<br>
I am having a bit of trouble with collision against background I can&apos;t figure out. Attached is the .nes so that you can see it in the emulator. Logical tiles and logical player box are all 16x16 pixels.<br>
<br>
Collisions againts left and right seem about right. But I am having an offset of about 3 pixels against up and down. Also it is weird I had to add 15 instead 16 to the player width to get the right wall collision right (i.e. no gaps).<br>
<br>
I am testing againts a collision map of #$00 for walk or #$01 for wall created as .db(s). The player box position is updated each frame. Some relevant code is:<br>
<br>
;--------------------------------------<br>
<br>
NMI:<br>
<br>
&#xA0;&#xA0;...<br>
<br>
&#xA0; JSR StoreLastPlayerPos<br>
<br>
&#xA0; JSR ReadController1&#xA0; ; get the current button data for player 1<br>
<br>
&#xA0; JSR ProcessUserInput<br>
<br>
&#xA0; JSR UpdatePlayerBox<br>
&#xA0;<br>
&#xA0; JSR CheckPlayerBackgroundCollision<br>
<br>
&#xA0; LDA player_collided<br>
&#xA0; CMP #$01<br>
&#xA0; BEQ DontUpdatePosition<br>
&#xA0;<br>
&#xA0; JSR UpdatePlayerSpritePosition<br>
&#xA0;<br>
&#xA0; RTI</div>
Not really answering your question, but a huge tip that may clear up a lot of issues you are having now or in the future.<br>
<br>
So, this may not be the correct way to word this, and I may get flamed for it, but this is how I finally made sense of it in my head.<br>
<br>
There are 2 types of code, main game code and NMI code. The NMI portion of the code is very short and it is very crucial to only be doing what is needed during this time. The NMI will interupt the code every frame to do what it needs. The best anaolgy I have read is that imagine that a frame is 1 hour. The first 5 minutes is the NMI, after that, your main code continues where it was interrupted. The NMI doesn&apos;t care what your main code is doing, when it is time for the NMI to run, it will interrupt the main code and do its thing. If you tryt o do too much during the NMI, the screen will output garbage or your code may not do what you what you intended because the NMI ended before your code completed.<br>
<br>
So, the point of that was, don&apos;t busy the NMI with main code stuff, like Reading the controller. I try to reserve my NMI for only code that needs to run at this time, such as:<br>
Updating Palette Color, Updating any background tiles (such as writing a score or text to the screen), and enabling PPU details (Like enabling the PPU or turn scrolling on and off).<br>
<br>
To activate these to run, I set a flag in the Main Code that activates them to run. So, if something happened that caused my score to increase, I would INC a ScoreFlag to #$01. When the NMI interrupts, it will check to see if this score flag is#$01. If true, then it will enable the subroutine that writes the new score to the screen. The only thing that I am doing here is taking the value out of RAM and putting it on the screen. Anything that needs to happed to update that value must happen in the main code and then copied into RAM for use in the NMI.<br>
<br>
For a better understanding of the NMI and vblanks, read this: <a href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs">http://wiki.nesdev.com/w/index.ph...</a><br>
That is one of the most helpful links I have ever read on NMI and it turned on the lightbulb for me.<br>
<br>
I hope this makes sense. At times, its tough for me to interpret how I understand things and then regurgitate that into useful knowledge for others.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__697">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Nov 3, 2015 at 4:37:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>sempressimo</b></i><br>
<br>
I am having a bit of trouble with collision against background I can&apos;t figure out. Attached is the .nes so that you can see it in the emulator. Logical tiles and logical player box are all 16x16 pixels.<br>
<br>
Collisions againts left and right seem about right. But I am having an offset of about 3 pixels against up and down. Also it is weird I had to add 15 instead 16 to the player width to get the right wall collision right (i.e. no gaps).<br>
<br>
I am testing againts a collision map of #$00 for walk or #$01 for wall created as .db(s). The player box position is updated each frame. Some relevant code is:<br>
<br>
;--------------------------------------<br>
<br>
NMI:<br>
<br>
&#xA0;&#xA0;...<br>
<br>
&#xA0; JSR StoreLastPlayerPos<br>
<br>
&#xA0; JSR ReadController1&#xA0; ; get the current button data for player 1<br>
<br>
&#xA0; JSR ProcessUserInput<br>
<br>
&#xA0; JSR UpdatePlayerBox<br>
&#xA0;<br>
&#xA0; JSR CheckPlayerBackgroundCollision<br>
<br>
&#xA0; LDA player_collided<br>
&#xA0; CMP #$01<br>
&#xA0; BEQ DontUpdatePosition<br>
&#xA0;<br>
&#xA0; JSR UpdatePlayerSpritePosition<br>
&#xA0;<br>
&#xA0; RTI</div>
Not really answering your question, but a huge tip that may clear up a lot of issues you are having now or in the future.<br>
<br>
So, this may not be the correct way to word this, and I may get flamed for it, but this is how I finally made sense of it in my head.<br>
<br>
There are 2 types of code, main game code and NMI code. The NMI portion of the code is very short and it is very crucial to only be doing what is needed during this time. The NMI will interupt the code every frame to do what it needs. The best anaolgy I have read is that imagine that a frame is 1 hour. The first 5 minutes is the NMI, after that, your main code continues where it was interrupted. The NMI doesn&apos;t care what your main code is doing, when it is time for the NMI to run, it will interrupt the main code and do its thing. If you tryt o do too much during the NMI, the screen will output garbage or your code may not do what you what you intended because the NMI ended before your code completed.<br>
<br>
So, the point of that was, don&apos;t busy the NMI with main code stuff, like Reading the controller. I try to reserve my NMI for only code that needs to run at this time, such as:<br>
Updating Palette Color, Updating any background tiles (such as writing a score or text to the screen), and enabling PPU details (Like enabling the PPU or turn scrolling on and off).<br>
<br>
To activate these to run, I set a flag in the Main Code that activates them to run. So, if something happened that caused my score to increase, I would INC a ScoreFlag to #$01. When the NMI interrupts, it will check to see if this score flag is#$01. If true, then it will enable the subroutine that writes the new score to the screen. The only thing that I am doing here is taking the value out of RAM and putting it on the screen. Anything that needs to happed to update that value must happen in the main code and then copied into RAM for use in the NMI.<br>
<br>
For a better understanding of the NMI and vblanks, read this: <a href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs">http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs</a><br>
That is one of the most helpful links I have ever read on NMI and it turned on the lightbulb for me.<br>
<br>
I hope this makes sense. At times, its tough for me to interpret how I understand things and then regurgitate that into useful knowledge for others.</div>
Expanding the concept.<br>
<br>
Each 1/60th of seconds there is a NMI, which is about 30000 cycles of span from one to the next<br>
The NMI is triggered when VBLANK starts<br>
VBlank is the short interval of time when the PPU is NOT drawing on screen, the rest of the time it is busy drawing stuff<br>
<br>
So:<br>
<br>
when you trigger the NMI, the FIRST things to do are the ones about updating the PPU data (e.g. SPRITE transfer).<br>
Then you do music update, input check, logic stuff, collision and all the rest.<br>
<br>
Having two separate codes (NMI and LOGIC) is a more PRO solution, having an unique script of less than 30000 cycles (in any case) for both is another solution.<br>
<br>
In any case, unless you really know what you are doing, think like:<br>
NMI<br>
- UPDATE PPU<br>
- DO ALL THE REST<br>
RTI<br>
<br>
So, example:<br>
- draw sprite in position x,y (&lt;&lt; PPU stuff, to be done in VBlank)<br>
- music engine (must tick once every 1/60th of second)<br>
- then check for inputs and detect L is pressed, (else you are done here)<br>
- then move the sprite left,<br>
- then check for collision,<br>
- if so put back the sprite where it was,<br>
- then RTI<br>
You can also check for collision and then decide if move the sprite or not. It depends on what is shorter. Or put the music engine at the end (however, I have been adviced to do it right after PPU stuff since that way the span between one tick and the next will always be the same time-wise, and not depending on the time elapsed in the previous logic).<br>
<br>
In any case, the sprite will be draw in the new position in the NEXT NMI VBLANK.<br>
<br>
If you do logic first and then PPU update later, the risk is to transfer the PPU stuff after the VBLANK time is over, and screw everything.<br>
The issue is that emulation sometimes works (at least in FcEux), while on real hardware is badly glitchy if going over VBlank with PPU stuff.<br>
And it is enough to put the PPU update stuff in the beginning of the NMI code to solve the issue.<br>
So, quick background updates and sprites updates, unless turning rendering off, must be done ASAP after the NMI is triggered.<br>
<br>
This at least is what I understood so far on the matter.<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__698">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Nov 3, 2015 at 7:20:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
<br>
Having two separate codes (NMI and LOGIC) is a more PRO solution, having an unique script of less than 30000 cycles (in any case) for both is another solution.</div>
<br>
Having a unique script is better for smaller games that don&apos;t have overly complicated logic like Commie Killer, but the first one is VITAL for bigger games like Brony Blaster due to convenience and better handling of slowdown and turning rendering off. For example, only the first solution lets you update the music even when there is slowdown or when you turn rendering off.<br>
<br>
Also, as both User and MMM explained, you should definitely update sprites in the beginning of the NMI regardless of the solution used, and the background should be updated using a buffer, i.e. you have a specific area in the RAM reserved for what you&apos;re going to draw on the screen, store the data to update in this area and simply wait for the next NMI to happen. I&apos;m just telling this to avoid you doing noob mistakes like I used to do - having a lot of drawing routines in your NMI for drawing anything on the background, which consumes space and CPU cycles for nothing. Everything is explained in MMM&apos;s nesdev link, one of my favourite NES related articles.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__699">
                                                        <div class="mdl-card__title"><strong>sempressimo</strong> posted on 
		
			
				
				Nov 4, 2015 at 7:39:24 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I will read that article today, thanks all for your help!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__700">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Nov 8, 2015 at 10:47:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Not really a programming question, however, is related to. Which material are the original NES labels made of?
<br>I have the template from here <a href="http://wiki.nesdev.com/w/images/d/dc/NES_Game_Pak_label_template.png" target="_blank" original-href="http://wiki.nesdev.com/w/images/d/dc/NES_Game_Pak_label_template.png">http://wiki.nesdev.com/w/images/d...</a> and I wish to know pricesily on which material print it after designing a label, to make it look like original NES games material.
<br>Thanks to anyone can help.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__701">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Nov 19, 2015 at 9:00:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve had this problem for a while, though it may be normal? All of my sprites are one pixel down vertically, in comparison to the background. Is this normal? They&apos;ve been this way for a couple years, so I don&apos;t know at this point. Finally moving to a grid based system, and it&apos;s bugging me more than it did in the past. And yes, I know that I can just adjust the starting positions of the Y positions (5F instead of 60, for instance), but if it is not normal I&apos;d like to know. Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__702">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Nov 19, 2015 at 9:34:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, your Y coordinate is interpreted by the PPU as +1 from what you actually store there. Kinda weird, I don&apos;t know Y it works that way. It&apos;s just a quirk of the hardware as I understand it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__703">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Nov 19, 2015 at 9:37:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Excellent pun sir! Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__704">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Nov 19, 2015 at 10:34:01 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					While scanline 1 is drawing the PPU looks for all sprites with Y=1 and figures out where to put them.  Then on the next scanline they are actually drawn, so they appear on screen one line lower.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__705">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Nov 19, 2015 at 10:34:01 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This double post was trying to appear one line lower.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__706">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 19, 2015 at 10:52:18 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, glad I&apos;m not the only one that has been bothered by this. Mostly just makes math a pain to do in my head. Instead of Adding #$18 to #$20, I have to add #$18 to #$1F.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__707">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Nov 19, 2015 at 11:02:06 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br>
<br>
This double post was trying to appear one line lower.</div>
Lol I thought of that before you edited it to this.<br>
<br>
If you set up your game to have some kind of object/entity/actor system, and you have a routine that just iterates over all of those and draws their meta sprites to the screen, you can embed logic in there so it&apos;s easier to think about...it&apos;ll take care of the Y+1 thing for you and then you can just say &quot;draw this at Y = 10&quot; and it actually will be at 10, but your underlying routines will put it at 9 in the actual oam.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__708">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Nov 19, 2015 at 11:12:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, I figured that in the loading loop I&apos;d just minus one off of the Y value of the master sprite of each metasprite, and then everything will behave normally from there due to the grid. I just didn&apos;t want to create a workaround like this if I was the cause of the problem in the first place, though, since before you know it I&apos;d be creating workarounds for my workarounds <span class="sprites_emoticons absmiddle" id="emo_smile"></span>. Thanks for clearing things up guys!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__709">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 19, 2015 at 12:29:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>GradualGames</b></i><br>
<br>
Set the Y coordinate of any sprite you wish to hide to $ff.</div>
<br>
<br>
Thanks for this. Been going to $00. Changed everything in my code $ff recently because I was tired of seeing sprites at the top in PAL mode.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__710">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Nov 19, 2015 at 12:38:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	Thanks for this. Been going to $00. Changed everything in my code $ff recently because I was tired of seeing sprites at the top in PAL mode.</div>
<br>
I hope that these comments mean you&apos;re back to programming!<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__711">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 19, 2015 at 5:43:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is not working for me.&#xA0; Basiscally, I&apos;m trying to load TextPointer with the name of the person I want to write to the screen based on the choice made by the player on what character they want to play as. The choice is supposed to be taken from the word table and populated itn TextPointer.<br>
It either writes the wrong name or garbage tiles to the screen. This is all written while the PPU is off. What you see here is the Last Name for the Character of Player 2. I am also trying to run this for First and Last Name of Player 1 and First Name of Player 2. So I basically do this 4 times with different variables and values. CharChoiceP2 is loaded with $00-$09 (that part is working and varified with the Hex Editor on the Emulator, so that is not the issue. Assume this part is working correctly.<br>
<br>
;;;;;;;;;;;;;;Variables;;;;;;;;;;;;;;;;;<br>
TextPointer &#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;.rs 2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;001B Points to the database that has the text we want to write to the screen<br>
&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;001C<br>
CharChoiceP2&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;.rs 1&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;006E Keeps track of what character picked as P2<br>
NamePointer&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;.rs 2<br>
<br>
<br>
;;;;;;;;;;;;;;;;;;Load Variables;;;;;;;;;;;;;;;;;;;;;<br>
&#xA0; LDA CharChoiceP2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Lets Say this is $05 for ShortText (Short is used in assembly so I had to add Text to the name)<br>
&#xA0; TAX<br>
&#xA0;<br>
&#xA0; LDA LastName,x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;This (by my logic) should load TextPointer with &apos;ShortText&apos;<br>
&#xA0; STA TextPointer<br>
&#xA0; LDA LastName+1,x<br>
&#xA0; STA TextPointer+1<br>
<br>
&#xA0; LDA #$07&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Just a counter so the loop goes 7 times<br>
&#xA0; STA TEXTLENGTH&#xA0;<br>
<br>
&#xA0; LDA #$F7&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Screen Location where the tiles are to be placed<br>
&#xA0; STA TEXTLOWBYTE &#xA0;<br>
&#xA0; LDA #$20<br>
&#xA0; STA TEXTHIGHBYTE<br>
<br>
&#xA0; JSR LoadText&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Start loading the tiles to the Screen<br>
<br>
&#xA0; LastName:<br>
&#xA0; .word Jones,Mays,Schott,Wallis,Baggs,ShortText<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&#xA0; 00&#xA0;&#xA0; ,&#xA0; 01&#xA0; ,&#xA0; 02&#xA0; ,&#xA0; 03&#xA0;&#xA0; ,&#xA0;&#xA0; 04&#xA0; ,&#xA0;&#xA0; 05<br>
<br>
<br>
;;;;;;;;;;;;;;;;;;;Load Text to Screeb Loop;;;;;;;;;;;;<br>
LoadText:<br>
&#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; read PPU status to reset the high/low latch<br>
&#xA0; LDA TEXTHIGHBYTE<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $2000 address<br>
&#xA0; LDA TEXTLOWBYTE<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $2000 address<br>
&#xA0; LDY #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start out at 0<br>
<br>
LoadTextLoop:<br>
&#xA0; LDA [TextPointer], y&#xA0;&#xA0;&#xA0;&#xA0; ; load data from address (background + the value in x)<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write to PPU<br>
&#xA0; INY&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0; CPY TEXTLENGTH&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare Y to TEXTLENGTH (Set $07 because all my .dbs are 7 tiles long)<br>
&#xA0; BNE LoadTextLoop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0; RTS<br>
<br>
Jones:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;00<br>
&#xA0; .db $13,$18,$17,$0e,$1c,$24,$24<br>
Mays:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;01<br>
&#xA0; .db $16,$0a,$22,$1c,$24,$24,$24<br>
Schott:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;02<br>
&#xA0; .db $1C,$0C,$11,$18,$1D,$1D,$24<br>
Wallis:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;03<br>
&#xA0; .db $20,$0a,$15,$15,$12,$1c,$24<br>
Baggs:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;04<br>
&#xA0; .db $0B,$0A,$10,$10,$1C,$24,$24<br>
ShortText:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;05<br>
&#xA0; .db $1c,$11,$18,$1b,$1d,$24,$24<br>
<br>
<br>
OUTPUT = WALLIS&#xA0;&#xA0;&#xA0; &lt;------WHY????
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__712">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Nov 19, 2015 at 7:03:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Replace your upper part with this and remember, you always need to ASL A when you&apos;re going into a pointer table.<br>
<br>
&#xA0; LDA CharChoiceP2<br>
&#xA0; ASL A<br>
&#xA0; TAY<br>
&#xA0; LDA LastName,y<br>
&#xA0; STA TextPointer<br>
&#xA0; LDA LastName+1,y<br>
&#xA0; STA TextPointer+1<br>
<br>
&#xA0; LDA #$07 ;Just a counter so the loop goes 7 times<br>
&#xA0; STA TEXTLENGTH<br>
<br>
&#xA0; LDA #$F7 ;Screen Location where the tiles are to be placed<br>
&#xA0; STA TEXTLOWBYTE<br>
&#xA0; LDA #$20<br>
&#xA0; STA TEXTHIGHBYTE<br>
<br>
&#xA0; JSR LoadText ;Start loading the tiles to the Screen
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__713">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 19, 2015 at 7:29:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					BAM! Works. I guess that &apos;ASL A&apos; is pretty important. Thanks KHAN Games!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__714">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Nov 19, 2015 at 7:43:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>KHAN Games</b></i><br>
	<br>
	Replace your upper part with this and remember, you <u><em><strong>always</strong></em></u> need to ASL A when you&apos;re going into a pointer table.<br>
	&#xA0;</div>
<br>
I&apos;ve wasted so many days on bad pointer tables. Strangely, this usually isn&apos;y my problem. Pointer tables...<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__715">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 5, 2015 at 1:25:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I was thinking if this is always faster (<em>Bunnyboy </em>code):<br>
<br>
***
<pre>ReadController:
  LDA #$01
  STA $4016
  LDA #$00
  STA $4016
  LDX #$08<br><br>ReadControllerLoop:
  LDA $4016
  LSR A           ; bit0 -&gt; Carry
  ROL buttons     ; bit0 &lt;- Carry
  DEX
  BNE ReadControllerLoop
  RTS</pre>
***<br>
<br>
than this (something I was thinking about):<br>
<br>
***
<pre>Joypad:       ; joypad latch buttons
  LDX #$01    ; X == 01
  STX AUX     ; (variable) AUX = 01
  STX $4016   ; THIS IS 01
  DEX         ; X == 00
  STX $4016   ; THIS IS 00
  STX OUTPUT  ; (variable) OUTPUT == 00
Read:         ; check inputs A,B,Se,St,U,D,L,R
  LDA $4016
  AND 01
  BEQ NoInput
  LDA OUTPUT
  ORA AUX     ; Hex 01, 02, 04, 08, 10, 20, 40, 80
  STA OUTPUT  ; store if: A,B,Se,St,U,D,L,R is pressed in OUTPUT
NoInput:
  ASL AUX     ; AUX shifts left for the next input
  BNE Read    ; when AUX is empty the loop ends
  RTS</pre>
Example: OUTPUT == 11110001 means ABSeStR are pressed.<br>
If you want the opposite way, start with AUX == 80 (10000000) and use:<br>
LSR AUX<br>
instead of:<br>
ASL AUX<br>
in the end of the loop (after the NoInput label).<br>
<br>
***<br>
<br>
I think the answer would be yes, <em>Bunnyboy </em>code is faster.<br>
<br>
And I guess that inverting this:
<pre>  LSR A           ; bit0 -&gt; Carry
  ROL buttons     ; bit0 &lt;- Carry</pre>
&#xA0; to this:<br><br><pre>  LSR A           ; bit0 -&gt; Carry
  ROR buttons     ; Carry -&gt; bit_7_</pre>
would work too, to have the &quot;bit order&quot; starting from AB... rather than RL... , I mean have A in bit 0 rather than bit 7. So my example above is a weaker solution.<br>
<br>
I post this example because it happens sometimes that I spend time to write (following my logic) a routine to do something, which works perfectly, but months later I find out (this is not the case, of course) on some writeups 6502 ASM coding related, or I figure out myself, that there is a &quot;conventional way&quot; to do it, which is cleaner and faster. Or I see something, and then forget where it was published when I need it. Or is buried somewhere in a long discussion thread, or in the comments of a tutorial lesson.<br>
<br>
So, I was wondering, if besides the few generic 6502 coding archieves around the internet, these NA tutorials, the articles and tricks published on NesDev, and <em>Shiru </em>site material, is there somewhere an archive of conventional basic routines for the mostly common tasks to be performed programming a NES game, and just limited to these quick common needs? Like this &quot;read inputs&quot; routine above by <em>Bunnyboy</em>? If there are none, does anyone else think that if one existed (or if one of the previous sources was expanded with an archive of such conventional contents), it would be convenient to refactor the code at its best, without wasting too much time?<br>
<br>
<strong>Edit</strong>: misspelling.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__716">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Dec 5, 2015 at 5:18:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
<br>
<br>
So, I was wondering, if besides the few generic 6502 coding archieves around the internet, these NA tutorials, the articles and tricks published on NesDev, and <em>Shiru </em>site material, is there somewhere an archive of conventional basic routines for the mostly common tasks to be performed programming a NES game, and just limited to these quick common needs? Like this &quot;read inputs&quot; routine above by <em>Bunnyboy</em>? If there are none, does anyone else think that if one existed (or if one of the previous sources was expanded with an archive of such conventional contents), it would be convenient to refactor the code at its best, without wasting too much time?<br>
&#xA0;</div>
<br>
I asked this when I first started coding.<br>
<a href="http://vintage.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=124538" target="_blank" original-href="http://vintage.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=124538">http://vintage.nintendoage.com/fo...</a><br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__717">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 5, 2015 at 7:29:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
I asked this when I first started coding.<br>
<a href="http://vintage.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=124538" target="_blank" original-href="http://vintage.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=124538">http://vintage.nintendoage.com/forum/messageview.cfm?catid=2...</a> <br>
&#xA0;</div>
Thanks. Interesting link. Links in there are worth reading, even if I knew many of them, of course.<br>
However, interesting opinions and points of view, some agreeing, some not.<br>
Glad to see that the matter was already being discussed.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__718">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Dec 11, 2015 at 12:17:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So, trying to get my game to work on a 128k Self-Flashable INL UNROM board. Here is the bank switching routine. The first Title Screen loads fine. When I switch to the next screen (when on real hardware), the graphics fail to load.<br>
<br>
Basically, when it does the bank switch on real hardware, it bombs all my graphics and all I get are colored squares, as if it can&apos;t find the data to load the screen. This routine works perfect on an Emulator.<br>
<br>
Anyone see anything wrong with the code? Been banging my head for 3 days now. Only thing I can really find online for UNROM is for a different compiler. I translated the code the best I could for NESASM3.<br>
<br>
<br>
;-----------------Header----------------------------<br>
&#xA0; .inesprg 8&#xA0;&#xA0; ; 8x 16KB PRG code = 128KB<br>
&#xA0; .ineschr 0&#xA0;&#xA0; ; 0x&#xA0; 8KB CHR data = CHR RAM<br>
&#xA0; .inesmap 2&#xA0;&#xA0; ; mapper 2 UNROM<br>
&#xA0; .inesmir 2&#xA0;&#xA0; ; Horz mirroring and Enable Battery<br>
<br>
.bank 0&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;bankSource=00<br>
&#xA0; .org $8000 &#xA0;<br>
TitleGraphics:<br>
&#xA0; .incbin &quot;titlegraphics.chr&quot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;8kb<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0; .bank 1<br>
&#xA0; .org $A000<br>
&#xA0; .include &quot;Music/sound_engine.asm&quot;<br>
&#xA0;<br>
&#xA0; .bank 2&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;bankSource=01<br>
&#xA0; .org $8000<br>
GameGraphics:<br>
&#xA0; .incbin &quot;gamegraphics.chr&quot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;8kb<br>
&#xA0; &#xA0;<br>
&#xA0; .bank 3<br>
&#xA0; .org $A000<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0; .bank 4&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;bankSource=02<br>
&#xA0; .org $8000<br>
<br>
&#xA0; .bank 5<br>
&#xA0; .org $A000<br>
<br>
&#xA0; .bank 6&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;bankSource=03<br>
&#xA0; .org $8000<br>
<br>
&#xA0; .bank 7<br>
&#xA0; .org $A000<br>
<br>
&#xA0; .bank 8&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;bankSource=04<br>
&#xA0; .org $8000<br>
<br>
&#xA0; .bank 9<br>
&#xA0; .org $A000<br>
<br>
&#xA0; .bank 10&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;bankSource=05<br>
&#xA0; .org $8000<br>
<br>
&#xA0; .bank 11<br>
&#xA0; .org $A000<br>
<br>
&#xA0; .bank 12&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;bankSource=06<br>
&#xA0; .org $8000<br>
<br>
&#xA0; .bank 13<br>
&#xA0; .org $A000<br>
<br>
&#xA0; .bank 14<br>
&#xA0; .org $C000 &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;fixed banks<br>
&#xA0; .;;;SOME GAME CODE HERE;;;;<br>
<br>
&#xA0; .bank 15&#xA0;&#xA0;&#xA0;<br>
&#xA0; .org $E000<br>
;;;;;;;;;;;;MAIN GAME CODE HERE;;;;;;;;;;;;;;;;;;;;;;;;<br>
<br>
;--------------------------BANK SWITCH AND CHRRAM LOADING ROUTINES in .bank 15----------------------------------------<br>
JSR DisablePPU&#xA0;&#xA0;&#xA0; ;Routine that turns the PPU off immeidately<br>
&#xA0; ;;;;;Switch bank to load Graphics&#xA0;&#xA0; &#xA0;<br>
<br>
&#xA0; LDA #$01 &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;;Load sourceBank with BANK #$01<br>
&#xA0; sta sourceBank&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;;Store in sourceBank. sourceBank used to pick the correct GraphicsPointer<br>
&#xA0; JSR Bankswitch &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;;jump to bank switching code<br>
&#xA0;<br>
&#xA0; LDA sourceBank<br>
&#xA0; ASL A<br>
&#xA0; TAY<br>
&#xA0; lda GraphicsPointer,y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;;Point to Graphics file to load into RAM in the new bank<br>
&#xA0; sta sourceLo<br>
&#xA0; lda GraphicsPointer+1,y&#xA0; ;get the address of the graphics data<br>
&#xA0; sta sourceHi&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;put into our source pointer<br>
<br>
&#xA0; jsr LoadCHRRAM&#xA0; ;Load CHRRAM<br>
<br>
&#xA0; LDA #$00 ;;Return to Bank 0 as my music code is there.<br>
&#xA0; JSR Bankswitch ;;jump to bank switching code<br>
<br>
&#xA0; ;;;;;;;;;;;;;<br>
&#xA0; &#xA0;&#xA0; &#xA0;<br>
&#xA0;;CODE FOR LOOP TO LOAD BACKGROUND TILES FOR NEW BACKGROUND<br>
;CODE FOR LOOP TO LOAD NEW PALETTES<br>
<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0; INC EnablePPUFlag&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;FLAG TO TURN PPU BACK ON IN NMI<br>
<br>
;---------------------------------------LOAD CHRAM in .bank 15------------------------------------------------------<br>
LoadCHRRAM:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;;copies 8KB of graphics from PRG to CHR RAM<br>
&#xA0; lda $2002<br>
&#xA0; lda #$00<br>
&#xA0; sta $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;set PPU to the CHR RAM area $0000-1FFF<br>
&#xA0; sta $2006<br>
&#xA0; ldy #$00<br>
&#xA0; ldx #$20&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;32 x 256 bytes = 8 KB<br>
<br>
LoadCHRRamLoop:<br>
&#xA0; lda [sourceLo], y&#xA0;&#xA0;&#xA0; ;copy from source pointer<br>
&#xA0; sta $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;to PPU CHR RAM area<br>
&#xA0; iny<br>
&#xA0; bne LoadCHRRamLoop&#xA0;&#xA0; ;;loop 256 times<br>
&#xA0; inc sourceHi&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;;then increment the high address byte<br>
&#xA0; dex&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;;do that 32 times<br>
&#xA0; bne LoadCHRRamLoop&#xA0;&#xA0; ;;32 x 256 = 8KB<br>
LoadCHRRamDone:<br>
&#xA0; rts&#xA0;&#xA0; &#xA0;<br>
<br>
GraphicsPointer:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Points to the graphics files in the banks above<br>
&#xA0;&#xA0; &#xA0;.word TitleGraphics,GameGraphics<br>
<br>
;--------------------------------------BANK SWITCH in .bank 15------------------------------------------------------<br>
Bankswitch:<br>
&#xA0; TAY ;;copy A into X<br>
&#xA0; STA Bankvalues,Y ;;new bank to use<br>
&#xA0; RTS<br>
<br>
Bankvalues:<br>
&#xA0; .db $00,$01,$02,$03,$04,$05,$06<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__719">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Dec 11, 2015 at 1:00:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Without seeing everything in the code and what&apos;s happening on real hardware, my first thoughts are that either your graphics pointer data is incorrect, you have something else in an interrupt that&apos;s messing with your $2006/$2007 stuff, or something like that.
<br>
<br>If it loads the initial graphics bank okay, your loading routine is probably fine.  If you load the initial graphics bank before you enable NMI, you probably have something in the interrupt re-setting where you are sending the graphics data during the CHR RAM loading when you load the second bank.  If you enable NMI before the first graphics bank loads and it gets input okay, you&apos;re problem is probably in your graphics addresses somewhere (graphicspointer, SourceLo, or something).
<br>
<br>My 0.02 from the code snip.  Hope it helps.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__720">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Dec 11, 2015 at 2:04:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
	<br>
	Without seeing everything in the code and what&apos;s happening on real hardware, my first thoughts are that either your graphics pointer data is incorrect, you have something else in an interrupt that&apos;s messing with your $2006/$2007 stuff, or something like that.<br>
	<br>
	If it loads the initial graphics bank okay, your loading routine is probably fine. If you load the initial graphics bank before you enable NMI, you probably have something in the interrupt re-setting where you are sending the graphics data during the CHR RAM loading when you load the second bank. If you enable NMI before the first graphics bank loads and it gets input okay, you&apos;re problem is probably in your graphics addresses somewhere (graphicspointer, SourceLo, or something).<br>
	<br>
	My 0.02 from the code snip. Hope it helps.</div>
I offer you some of the code I cut out in between because I thought it wasn&apos;t apart of the issue. After what you said, it may be the issue. I may be trying to do too much at once (LoadSprites,LoadCHRRAM, LoadBackGround, LoadPalettes)? Here is the entire subroutine. Below that is all subroutines that apply to it.&#xA0; If you want MRN, hit me up in a pm. I just tossed a good chunk of code here. <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
;----------------------------------------------------------- &#xA0;<br>
;-------------------START 2 PLAYER MENU---------------------<br>
;-----------------------------------------------------------<br>
Start2PMenu:&#xA0;&#xA0; &#xA0;<br>
&#xA0; LDA GameState<br>
&#xA0; STA GameState+1<br>
&#xA0;<br>
&#xA0; LDA #STATEP2MENU<br>
&#xA0; STA GameState<br>
<br>
&#xA0; ;Load Sprites on Screen&#xA0;&#xA0;&#xA0;<br>
&#xA0; LDA #$27&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;<br>
&#xA0; STA P1spriteRAM<br>
&#xA0; LDA #$00<br>
&#xA0; STA P1spriteRAM+2<br>
&#xA0; LDA #$20<br>
&#xA0; STA P1spriteRAM+3<br>
&#xA0;<br>
&#xA0; LDA #$2F<br>
&#xA0; STA P2spriteRAM<br>
&#xA0; LDA #$01<br>
&#xA0; STA P2spriteRAM+2<br>
&#xA0; LDA #$20 &#xA0;<br>
&#xA0; STA P2spriteRAM+3<br>
&#xA0;<br>
&#xA0; LDA #$B7<br>
&#xA0; STA spriteRAM<br>
&#xA0; LDA #$01<br>
&#xA0; STA spriteRAM+2<br>
&#xA0; LDA #$20<br>
&#xA0; STA spriteRAM+3<br>
&#xA0; &#xA0;<br>
;Reset Some Variables<br>
&#xA0; LDA #$00<br>
&#xA0; STA MenuSelectFlag<br>
&#xA0; STA BustFlag<br>
&#xA0; LDA #$05&#xA0;&#xA0;<br>
&#xA0; STA TEXTROWS<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0; JSR DisablePPU<br>
&#xA0; ;;;;;Switch bank to load Graphics&#xA0;&#xA0; &#xA0;<br>
&#xA0;<br>
&#xA0; LDA #$01 ;;put new bank to use into A<br>
&#xA0; sta sourceBank<br>
&#xA0; JSR Bankswitch ;;jump to bank switching code<br>
&#xA0;<br>
&#xA0; LDA sourceBank<br>
&#xA0; ASL A<br>
&#xA0; TAY<br>
&#xA0; lda GraphicsPointer,y<br>
&#xA0; sta sourceLo<br>
&#xA0; lda GraphicsPointer+1,y&#xA0; ;get the address of the graphics data ($8000)<br>
&#xA0; sta sourceHi&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;put into our source pointer<br>
<br>
&#xA0; jsr LoadCHRRAM &#xA0;<br>
&#xA0;<br>
&#xA0; LDA #$00 ;;put new bank to use into A<br>
&#xA0; JSR Bankswitch ;;jump to bank switching code<br>
&#xA0; ;;;;;;;;;;;;;<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0; LDA #LOW(TwoPlayerMenuBackground)<br>
&#xA0; STA BackgroundAddr<br>
&#xA0; LDA #HIGH(TwoPlayerMenuBackground)<br>
&#xA0; STA BackgroundAddr+1<br>
&#xA0; JSR LoadBackground<br>
&#xA0;<br>
&#xA0; LDA #LOW(TwoPlayerMenuPalette)<br>
&#xA0; STA PalettePointer<br>
&#xA0; LDA #HIGH(TwoPlayerMenuPalette)<br>
&#xA0; STA PalettePointer+1 &#xA0;<br>
&#xA0; LDA #$00<br>
&#xA0; STA PALLOWBYTE<br>
&#xA0; LDA #$20<br>
&#xA0; STA PALLENGTH<br>
&#xA0; JSR LoadPalettes &#xA0;<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0; INC EnablePPUFlag<br>
&#xA0;<br>
Start2PMenuDone:<br>
&#xA0; RTS<br>
<br>
<br>
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br>
;;;;;;;MORE SUBROUTINES THAT APPLY;;;;;<br>
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br>
<br>
;-----------------------------------------------------------<br>
;---------------------LOAD BACKGROUND-----------------------<br>
;-----------------------------------------------------------<br>
LoadBackground:<br>
&#xA0; LDA $2002<br>
&#xA0; LDA #$20<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $2000 address<br>
&#xA0; LDA #$00<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $2000 address<br>
&#xA0;<br>
&#xA0; LDX #$04&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Loop X 4 times<br>
&#xA0; LDY #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Loop Y 256 times<br>
LoadBackgroundsLoop:<br>
&#xA0; LDA [BackgroundAddr],y<br>
&#xA0; STA $2007<br>
&#xA0; INY<br>
&#xA0; BNE LoadBackgroundsLoop<br>
; Outer loop<br>
&#xA0; INC BackgroundAddr+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; increment high byte of address backg to next 256 byte chunk<br>
&#xA0; DEX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; one chunk done so X = X - 1.<br>
&#xA0; BNE LoadBackgroundsLoop&#xA0;&#xA0; ; if X isn&apos;t zero, do again<br>
&#xA0; LoadBackGroundDone: &#xA0;<br>
&#xA0; RTS &#xA0;<br>
&#xA0;<br>
;-----------------------------------------------------------<br>
;-----------------------LOAD PALETTE------------------------<br>
;-----------------------------------------------------------<br>
LoadPalettes:<br>
&#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; read PPU status to reset the high/low latch<br>
&#xA0; LDA #$3F<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $3F00 address<br>
&#xA0; LDA PALLOWBYTE<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $3FXX address<br>
&#xA0; LDY #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start out at 0<br>
LoadPalettesLoop:<br>
&#xA0; LDA [PalettePointer], y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; load data from address (palette + the value in y)<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write to PPU<br>
&#xA0; INY&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Y = Y + 1<br>
&#xA0; CPY PALLENGTH&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare Y to hex PALLENGTH<br>
&#xA0; BNE LoadPalettesLoop&#xA0; ; Branch to LoadPalettesLoop if compare was Not Equal to zero<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; if compare was equal to PALLENGTH, keep going down<br>
&#xA0; RTS&#xA0;&#xA0; &#xA0;<br>
<br>
<br>
;--------------------------------------------------------------<br>
;-----------------------NMI ROUTINE----------------------------<br>
;--------------------------------------------------------------<br>
NMI:<br>
&#xA0; PHA&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;protect the registers by moving values to the stack<br>
&#xA0; TXA<br>
&#xA0; PHA<br>
&#xA0; TYA<br>
&#xA0; PHA<br>
<br>
nmi_start: &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;write Sprite RAM<br>
&#xA0; LDA #$00<br>
&#xA0; STA $2003&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; set the low byte (00) of the RAM address<br>
&#xA0; LDA #$02<br>
&#xA0; STA $4014<br>
&#xA0;<br>
&#xA0; LDA updating_background&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;check to be sure that the main program isn&apos;t busy<br>
&#xA0; BNE skip_graphics_updates<br>
<br>
&#xA0; JSR GameStateNMIIndirect<br>
&#xA0;<br>
&#xA0; LDA #$00&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;tell the ppu there is no background scrolling<br>
&#xA0; STA $2005<br>
&#xA0; STA $2005<br>
&#xA0;<br>
&#xA0; LDA #%10010000&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1<br>
&#xA0; STA $2000<br>
&#xA0;<br>
&#xA0; LDA EnablePPUFlag<br>
&#xA0; BEQ .SKIP<br>
&#xA0;&#xA0;&#xA0; LDA #%00011110&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;enable sprites, enable background, no clipping on left side<br>
&#xA0;&#xA0;&#xA0; STA $2001<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0;&#xA0; &#xA0;DEC EnablePPUFlag<br>
&#xA0; .SKIP:<br>
<br>
&#xA0; JSR sound_play_frame&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;run our sound engine after all drawing code is done.<br>
&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;this ensures our sound engine gets run once per frame.<br>
&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; LDA #$00<br>
&#xA0; STA sleeping&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;wake up the main program &#xA0;<br>
&#xA0;<br>
skip_graphics_updates:<br>
<br>
&#xA0; PLA&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;restore the registers<br>
&#xA0; TAY<br>
&#xA0; PLA<br>
&#xA0; TAX<br>
&#xA0; PLA<br>
<br>
&#xA0; RTI&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;return from interrupt&#xA0;<br>
<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__721">
                                                        <div class="mdl-card__title"><strong>insomniakc</strong> posted on 
		
			
				
				Jan 19, 2016 at 3:17:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey everyone!. Mega Mario Man and I have been chatting about 6502, and I just thought I would put a question out there about the status flag.<br>
<br>
In 6502: Assembly Language Programming by Lance A. Levanthal he recommends a trick to bypass RTI by pulling the flag register from the stack, toggling bit two, and pushing it back.<br>
<br>
The code is simple:<br>
<br>
PLA ;01FF (flag register) pulled from stack<br>
ORA #%00000010 ; toggle bit 2<br>
PHA ;push<br>
<br>
<br>
I started thinking, is there any practical application for this 6502 programming trick on the NES? Basically what it does is prevent an RTI from being called, from what I understand.<br>
<br>
I got to thinking about this because my NMI routine in the program I&apos;m working on got too bloated, and never reached the RTI, so I simply had to cram into my brain everything I could find about the flag register, the stack, and the NMI to try to figure out a strategy to debug this similar problem in the future.<br>
<br>
P.S.: Thanks MRN for all the great tutorials, I&apos;ve been lurking them for a long time now.<br>
<br>
Edit: When I say bypass RTI it&apos;s a bit of an oversimplification. It causes the RTI to return to the main program with interrupts disabled, whereas RTI normally re-enables that flag. So it bypasses all future Interrupts, only bypassing the flag modification that RTI does.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__722">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Jan 19, 2016 at 3:36:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That sounds like a recipe for fragile code to me! Better to make your nmi routine robust and carefully use flags for notifying your main loop when the nmi has finished and flags for locking access to the PPU. Actually, what this really sounds like to me is you&apos;re doing too much in nmi---try breaking out some of that logic to your main loop, filling a few small buffers, then blasting those buffers to the PPU within nmi.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__723">
                                                        <div class="mdl-card__title"><strong>dougeff</strong> posted on 
		
			
				
				Jan 19, 2016 at 7:10:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think you mean the 4 bit ...0000 0100, the interrupt flag.
<br>
<br>Which turns off IRQ interrupts, but not NMI interrupts. To turn off NMIs you have to reset the high bit of the $2000 Register to zero, which can be done during NMI, if your NMI routine runs too long, to prevent a second NMI to trigger while still in NMI.<br><br>(Note, the preferred method of turning on/off IRQ interrupts is with CLI and SEI commands.)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__724">
                                                        <div class="mdl-card__title"><strong>insomniakc</strong> posted on 
		
			
				
				Jan 19, 2016 at 8:43:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oh, I was aware of the CLI and SEI commands, I was just curious if Levanthal&apos;s method had any practical use on the NES, and the answer seems to be: probably not.<br>
<br>
And as far as GG&apos;s comment, yes, I am doing too much in NMI, that&apos;s sort of what I just today isolated as the cause of all my woes for the entire week (with MMM&apos;s help) ^_^<br>
<br>
Just looking for shortcuts, when I really just need to bury my head in my own program and sort out what NEEDS to be in the NMI and what can be stripped away and placed elsewhere.<br>
<br>
Anyway, thank you for the responses<br>
<br>
Edit: Oh, and that high bit of 2000 thing, that IS the shortcut I&apos;m looking for. Unfortunately, I think for my purposes it&apos;s just inviting new problems into my code lol
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__725">
                                                        <div class="mdl-card__title"><strong>insomniakc</strong> posted on 
		
			
				
				Jan 24, 2016 at 9:51:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi again. Now I have a new problem. I&apos;m almost done my animated title screen and it&apos;s looking great. The heartbeat animation I made I converted from a sprite animation into a changing background animation, but it was breaking on NTSC so I changed it to a static set of tiles with MMC1 bank swapping doing the animating of the background layer. That part is working fine, but my attributes code isn&apos;t loading anything. I&apos;ve tried enabling and disabling the PPU, and moving the code for initializing MMC1 to before the attributes code, then after. I just get the basic #%00000000 palette no matter what I try. My loop breaks the screen into 4 sections and writes #%00000000 to the first 2 sections, then #%01010101 to the 3rd section, and #%00000000 to the last. The code seems fine to me, which is why I&apos;m asking if anyone knows of anything I might be doing wrong.<br>
<br>
<br>
LoadAttributes:<br>
LDA $2002<br>
LDA #$23<br>
STA $2006 ;nametable 1<br>
LDA #$C0<br>
STA $2006<br>
LDX #$00<br>
LDA #%00000000<br>
LoadQ1Q2AttributeLoop:<br>
STA $2007<br>
INX<br>
CPX #$20<br>
BNE LoadQ1Q2AttributeLoop<br>
LDA #%01010101<br>
LoadQ3AttributeLoop:<br>
STA $2007<br>
INX<br>
CPX #$30<br>
BNE LoadQ3AttributeLoop<br>
LDA #%00000000<br>
LoadQ4AttributeLoop:<br>
STA $2007<br>
INX<br>
CPX #$40<br>
BNE LoadQ4AttributeLoop<br>
<br>
<br>
So in theory this code increments X and then writes a #%00000000 byte to PPU and and so forth 32 times, then 16 times of #%01010101, then 16 times of #%00000000. Seems straightforward, but nothing changes, and this is confirmed by checking the Hex editor in the emulator. Please if anyone is currently online and has any idea of what might be going on, let me know <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<br>
<br>
EDIT: I have solved the problem. To anybody who might be interested: attributes seem to be reset by MMC1 CHR-ROM bank swapping. The solution: have your attribute code in the Infin loop immediately after Vblank.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__726">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jan 26, 2016 at 9:56:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>insomniakc</b></i><br>
<br>
<br>
EDIT: I have solved the problem. To anybody who might be interested: attributes seem to be reset by MMC1 CHR-ROM bank swapping. The solution: have your attribute code in the Infin loop immediately after Vblank.</div>
<br>
<br>
I feel we&apos;ve had this discussion before. <span class="sprites_emoticons absmiddle" id="emo_wink"></span><br>
<br>
Glad you figured it out. I just now saw this post for some reason. I&apos;m slacking.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__727">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Jan 26, 2016 at 10:04:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Are attribute tables really reset by chr-rom bankswitching? That sounds suspect to me. That should not affect nametables or attribute tables at all. My guess is if you use chr-rom bankswitching at the wrong time, you might be swapping in tiles that select different colors---perhaps all the same color (blank tiles?) and it&apos;d make it look like the attribute table got reset. That&apos;s just my guess. I haven&apos;t used MMC1 much though, perhaps it&apos;s wonkier than I remember!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__728">
                                                        <div class="mdl-card__title"><strong>insomniakc</strong> posted on 
		
			
				
				Jan 26, 2016 at 10:20:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Actually, yeah. I think I made an incorrect assumption that bank switching was the culprit. Still, my code doesn&apos;t seem to work if I do the attribute loading before Infin, for example, which is why I thought the updating was what was wreaking havoc. I&apos;ve had such a headache with attributes over the past 24 hours that I don&apos;t think I&apos;ll ever forget to put that bit of code in the right spot! right now it&apos;s resting comfortable in a subroutine which is called during a game state subroutine, loaded by the engine-start subroutine... which is called during infin. I have it set up so that it happens before everything else, and that seems to do the trick. It jumps back to infin and re-writes the attributes, which fixes any glitches which would otherwise happen. I&apos;m still learning. And yes MMM, we did have this discussion before, but I have a thick skull that is like an old car that won&apos;t start sometimes when learning new info hahaha.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__729">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jan 26, 2016 at 11:10:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>insomniakc</b></i><br>
<br>
Actually, yeah. I think I made an incorrect assumption that bank switching was the culprit. Still, my code doesn&apos;t seem to work if I do the attribute loading before Infin, for example, which is why I thought the updating was what was wreaking havoc. I&apos;ve had such a headache with attributes over the past 24 hours that I don&apos;t think I&apos;ll ever forget to put that bit of code in the right spot! right now it&apos;s resting comfortable in a subroutine which is called during a game state subroutine, loaded by the engine-start subroutine... which is called during infin. I have it set up so that it happens before everything else, and that seems to do the trick. It jumps back to infin and re-writes the attributes, which fixes any glitches which would otherwise happen. I&apos;m still learning. And yes MMM, we did have this discussion before, but I have a thick skull that is like an old car that won&apos;t start sometimes when learning new info hahaha.</div>
<br>
<br>
Check the order of turning things on before the infin loop. Here&apos;s what I do:<br>
<br>
&#xA0; JSR StartTitle&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&lt;--That enables my first game state (title), start&apos;s music, loads Sprites, loads backgrounds, load attributes, load palettes<br>
&#xA0;<br>
&#xA0; LDA #$00<br>
&#xA0; JSR GameStateUpdate&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&lt;--Just some clean up before starting<br>
&#xA0;<br>
&#xA0; LDA #%10010000&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1<br>
&#xA0; STA $2000<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0; LDA #%00011110&#xA0;&#xA0; ; enable sprites, enable background, no clipping on left side<br>
&#xA0; STA $2001<br>
<br>
&#xA0;<br>
;----------------------------------------------------------------------<br>
;-----------------------START MAIN PROGRAM---------------------<br>
;---------------------------------------------------------------------- &#xA0;<br>
Forever:<br>
<br>
--------------------<br>
If I would load background, palette, and attributes after enabling the NMI, sprites, and background, then it would probably kill my script.<br>
<br>
Just a thought, may not be your issue though.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__730">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Feb 8, 2016 at 3:11:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Is this the right place to ask about how to make a dmc file?  I&apos;ve found various code and tutorials on their use, but not their creation! I know famitracker can convert instruments, but those are all fti, right?... I found a huge repository of dmc files, but I&apos;d still like to be able to produce my own.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__731">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 8, 2016 at 3:40:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>RockyHardwood</b></i><br>
<br>
Is this the right place to ask about how to make a dmc file? I&apos;ve found various code and tutorials on their use, but not their creation! I know famitracker can convert instruments, but those are all fti, right?... I found a huge repository of dmc files, but I&apos;d still like to be able to produce my own.</div>
<br>
I definitely don&apos;t know the answer to this question, as I never use the DMC channel. Hopefully someone smarter than me (ie: most people) can help you.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__732">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Feb 8, 2016 at 3:52:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					huzzah! just needed to word my google search right. there&apos;s a really nice selection of codes and programs here, in case anyone is interested, including a DMC converter: <a href="http://www.pineight.com/nes/#18" target="_blank" original-href="http://www.pineight.com/nes/#18">http://www.pineight.com/nes/#18...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__733">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Feb 8, 2016 at 3:53:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes, you can create .dmc files with FamiTracker.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__734">
                                                        <div class="mdl-card__title"><strong>dougeff</strong> posted on 
		
			
				
				Feb 8, 2016 at 6:59:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					(Cough)...link...
<br><a href="http://nesdoug.com/2016/01/13/23-using-dmc-sounds/" target="_blank" original-href="http://nesdoug.com/2016/01/13/23-using-dmc-sounds/">http://nesdoug.com/2016/01/13/23-...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__735">
                                                        <div class="mdl-card__title"><strong>QuickThumbs</strong> posted on 
		
			
				
				Feb 9, 2016 at 4:02:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am not, and probably will not, do any NES programming for some time, but I do have lots of questions. Here&apos;s one: What are all you guys using to code your programs on? Modern-day assemblers ones that emulate what the original NES programmers used?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__736">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 9, 2016 at 4:08:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think nesasm3 and asm6 were written well after the NES&apos;s hey day, but CC65 (I use CA65 from it) as I understand it was based on an old compiler/assembler suite for Atari...I imagine it has been fully rewritten since then, though.<br>
<br>
From CC65&apos;s original website: &quot;<span style="color: rgb(0, 0, 0); font-family: arial, helvetica, sans-serif; font-size: 16px; line-height: normal; text-align: justify;">It is based on a C compiler that was originally adapted for the Atari 8bit computers by John R. Dunning.&quot;&#xA0;</span>For all I know this, too, was well after the 8 bit era. So I don&apos;t really know.&#xA0;<br>
<br>
I believe most of the tools in use were written by people active in the nes reverse engineering scene which appeared sometime in the 90&apos;s. So I&apos;m guessing all of them are &quot;modern&quot; insofar as none of them were actually used by nes programmers in the 80&apos;s, early 90&apos;s.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__737">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Feb 9, 2016 at 11:21:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Is there a way to just change the 2 bits in the attribute table with you disturbing the out 6 bits?<br>
<br>
For example. At $23EB, the current attribute is 11111111. Lets say, I want to change the second set to 00, so 11<strong>00</strong>1111 (so now the top right quadrant is using Palette 00). On the next players turn, I want to change the 4th set to 01, so 110011<strong>01. </strong>At any time, I want to be able to change any of those 4 sets of 2 bits.<br>
<br>
Attributes are such a pain. This seems like this should be pretty simple, I&apos;m finding that it is not.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__738">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Feb 9, 2016 at 11:46:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
Is there a way to just change the 2 bits in the attribute table with you disturbing the out 6 bits?<br>
<br>
For example. At $23EB, the current attribute is 11111111. Lets say, I want to change the second set to 00, so 11<strong>00</strong>1111 (so now the top right quadrant is using Palette 00). On the next players turn, I want to change the 4th set to 01, so 110011<strong>01. </strong>At any time, I want to be able to change any of those 4 sets of 2 bits.<br>
<br>
Attributes are such a pain. This seems like this should be pretty simple, I&apos;m finding that it is not.</div>
<br>
Sorry to do this. I&apos;m going to answer my own question with a question! <span class="sprites_emoticons absmiddle" id="emo_happy"></span><br>
<br>
This is what I assume I must do. I must start by getting the current value of %11111111 out of $23EB.<br>
<br>
LDA $2002<br>
LDA #$23<br>
STA $2006<br>
LDA #$EB<br>
STA $2006<br>
LDA $2007<br>
STA attribute_RAM<br>
<br>
So, if I am correct, attribute_RAM = %11111111????<br>
<br>
I&apos;m assuming, I would now have to manipulate attribute_RAM and then write that back to $23EB?<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__739">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Feb 10, 2016 at 2:37:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There are basically two ways you can do this:
<br>
<br>1) You can do what you said: read the byte from attribute table, modify it, then write it back. Note that your current code won&apos;t work as is, because you need to do one dummy read from $2007 after setting the PPU address to fill PPU&apos;s internal data buffer.
<br>
<br>OR:
<br>
<br>2) You can keep a copy of the attribute table (64 bytes) in CPU RAM. Then you just need to make sure to update both copies every time you make changes to the attributes.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__740">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Feb 10, 2016 at 6:37:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve found routines for converting hex numbers into decimal numbers, but how would one go about the opposite process? Let us say that I had a five digit number that I needed to convert back into a 16-bit hex value (it does not exceed 65k, so a 16-bit value will work). Kind of a strange, backwards one, I know, since usually we&apos;re trying to go the other way, but...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__741">
                                                        <div class="mdl-card__title"><strong>dougeff</strong> posted on 
		
			
				
				Feb 10, 2016 at 8:59:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The only thing I found was this, 3 digit decimal to hex routine...<br>
<br>
<a href="http://codebase64.org/doku.php?id=base&lt;span class=" target="_blank" original-href="http://codebase64.org/doku.php?id=base&lt;span class="></a><a href="http://codebase64.org/doku.php?id=base" target="_blank" original-href="http://codebase64.org/doku.php?id=base">http://codebase64.org/doku.php?id...</a><span class="sprites_emoticons absmiddle" id="emo_happy"></span>ecimal_to_hexadecimal_conversion<br>
<br>
Which uses loops to muliply the tens and hundreds digits. You could do similar for the thousand and ten-thousand digits, or you could construct a Table of answers for each decimals hex equivalent.<br>
<br>
(edit, this forum is replacing the colon D with a smileyface, breaking the link, hmm, well it looks like this, just delete the space between the colon and the d)<br>
codebase64.org/doku.php?id=base: decimal_to_hexadecimal_conversion
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__742">
                                                        <div class="mdl-card__title"><strong>dougeff</strong> posted on 
		
			
				
				Feb 10, 2016 at 9:56:36 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
Is there a way to just change the 2 bits in the attribute table with you disturbing the out 6 bits?<br>
<br>
For example. At $23EB, the current attribute is 11111111. Lets say, I want to change the second set to 00, so 11<strong>00</strong>1111 (so now the top right quadrant is using Palette 00). On the next players turn, I want to change the 4th set to 01, so 110011<strong>01. </strong>At any time, I want to be able to change any of those 4 sets of 2 bits.<br>
<br>
Attributes are such a pain. This seems like this should be pretty simple, I&apos;m finding that it is not.</div>
<br>
<br>
Also, you would need to determine which 2 bits you want to change with a series of if/then branches...bit shift those two bits into the correct position, and AND #, ORA # to put it in...<br>
<br>
In your example the xx00xxxx bits would be...<br>
new 2 bits loaded to A<br>
asl a<br>
asl a<br>
asl a<br>
asl a<br>
sta temp<br>
lda AttributeTableRAM_copy<br>
and #$cf ;mask out those 2 bits<br>
ora temp ;put in the new 2 bits<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__743">
                                                        <div class="mdl-card__title"><strong>QuickThumbs</strong> posted on 
		
			
				
				Feb 11, 2016 at 11:03:06 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here&apos;s another thing that&apos;s been bothering me:
<br>
<br>A lot of computers in the 1980s used the 6502 microprocessor, yet they had different graphics and sound capabilities. The NES I remember reading has a Picture Processing Unit, for example. I&apos;m not sure quite what my question is, but what nags me is how does the microprocessor access different graphic/sound hardware on different machines? The hexadecimal addresses for one graphics location might be totally different than another. Are they all using the same 6502 or a variant chip that runs on that machine? For that matter, how does the chip also access extra hardware that might be packed into a game cartridge?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__744">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 11, 2016 at 11:18:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Basically it all has to do with memory mapping. All 6502 processors can access a 64k address space. Different types of machines have different hardware mapped to different locations in that address space, and all communicate over that. So when you write a value somewhere, it might get stored in RAM, or it might trigger a piece of hardware to do something. Think of like a big telephone switchboard. The cpu sends messages to the switchboard, and whomever is hooked up to certain telephone numbers will repsond. Some people pick up the phone and go: &quot;Ah, ok you want me to remember the number 10. You got it.&quot; Others might go: &quot;Oh, you want to know the current state of the controller? Button A was pressed.&quot; Each machine will have a different switchboard all hooked up to different sorts of &quot;people&quot; at the other end (ram, graphics hardware, sound hardware, and the rest). The CPU itself remains relatively unchanged in most machines that use it. Some may have small modifications, though. For instance the NES cpu has some audio hardware that sits on the same die as the cpu itself. But it&apos;s still a separate set of logic though, not really the core cpu itself.<br>
<br>
Additional cartridge hardware plugs into that same 64k switchboard. So mappers, expansion audio chips and such also will plug in to certain locations accessible by the cpu when the cartridge is inserted.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__745">
                                                        <div class="mdl-card__title"><strong>QuickThumbs</strong> posted on 
		
			
				
				Feb 11, 2016 at 12:17:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think I see. It&apos;s not just a computer program that will take up space, but also the different hardware?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__746">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Feb 11, 2016 at 12:23:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It doesn&apos;t really take up space per se. Space implies RAM or ROM. RAM and ROM each can map to certain ranges of the 64k address space...and only space can be &quot;taken up&quot; within that. the address space itself isn&apos;t really taken up, so to speak. In other words, you might have a ROM chip that maps to a range of addresses starting at $8000 and spanning 16kb. If you read anything in that range you get data or code that might be on the ROM. However, you might have hardware that&apos;s mapped to the same locations. Two people pick up the phone. One of those people always talks (gives you the data in ROM), the other one of those people might always perform a hardware function switch as a bankswap. Mappers sometimes allow you to write anywhere in alarge address range, triggering the same function. But because that address range overlaps ROM, nothing happens to your code or data, the write is just picked up by the mapper. I can imagine this getting confusing...<br>
<br>
Basically you imagine this 64k switchboard, or &quot;bus&quot; as it is called, between the CPU and hardware. the CPU can read or write anywhere on that switchboard, from 0 through 65535. Some pieces of hardware pick up only reads, some pick up only writes. Some pieces of hardware are mapped to the same locations as others, but usually this is because one piece of hardware is only picking up reads the other is only picking up writes. Think of people picking up the phone who only listen or only talk, and you might have more than one person on a given telephone line, hahah.<br>
<br>
There are actually a few cases where some pieces of hardware cannot agree on who is reading or writing what. In other words some hardware quirks. Like when you play a DMC sound sample, it can actually mess up controller reads. Or the UnROM mapper, also, will have a conflict with ROM when written to, unless the ROM has the same value at the location to which you wrote. Most of the time it isn&apos;t an issue because most pieces of hardware wired up to this switchboard only listen to a specific location, and then only for writes or reads (or both I suppose in the case of RAM). Not sure if any of that made sense.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__747">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Feb 11, 2016 at 4:36:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
<br>
There are basically two ways you can do this:<br>
<br>
1) You can do what you said: read the byte from attribute table, modify it, then write it back. Note that your current code won&apos;t work as is, because you need to do one dummy read from $2007 after setting the PPU address to fill PPU&apos;s internal data buffer.<br>
<br>
OR:<br>
<br>
2) You can keep a copy of the attribute table (64 bytes) in CPU RAM. Then you just need to make sure to update both copies every time you make changes to the attributes.</div>
<br>
Thanks for the tips. Got this working by keeping a working copy of Attributes in RAM at $0400. Then, I just pull out the 1 byte I need manipulate it, copy back to the proper spot in RAM and finally update the Attribute table.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__748">
                                                        <div class="mdl-card__title"><strong>Nesplay</strong> posted on 
		
			
				
				Feb 18, 2016 at 3:24:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					WAY off topic but is there a rom of the game centipede for the nes? I love the Atari version and was curious to know if anyone ever ported it to nes or made their own version, thanks! Also stoked for The legends of Owlia!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__749">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Feb 25, 2016 at 4:08:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Nesplay</b></i><br>
<br>
WAY off topic but is there a rom of the game centipede for the nes? I love the Atari version and was curious to know if anyone ever ported it to nes or made their own version, thanks! Also stoked for The legends of Owlia!</div>
<br>
Well, there&apos;s Millipede by HAL, which is just like Centipede but better<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__750">
                                                        <div class="mdl-card__title"><strong>compile_6502</strong> posted on 
		
			
				
				Mar 28, 2016 at 12:33:20 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve been studying the MOS 6500 Programming Manual as a first step into getting into the NES and programming in general.
<br>
<br>There is some issue involving how numbers are interpreted that I need clearing up.  The manual delves into working with 8 bit numbers and how bit 7 can be used to toggle between a positive number and a negative number at the expense of using only 7 bits for the numbers themselves.  
<br>
<br>The question I have is, how does the processor know when you want to work with 8-bit unsigned numbers rather than 7-bit signed numbers?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__751">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Mar 28, 2016 at 2:41:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>compile_6502</b></i><br>
<br>
I&apos;ve been studying the MOS 6500 Programming Manual as a first step into getting into the NES and programming in general.<br>
<br>
There is some issue involving how numbers are interpreted that I need clearing up. The manual delves into working with 8 bit numbers and how bit 7 can be used to toggle between a positive number and a negative number at the expense of using only 7 bits for the numbers themselves.<br>
<br>
The question I have is, how does the processor know when you want to work with 8-bit unsigned numbers rather than 7-bit signed numbers?</div>
<br>
<br>
From what I know, the NES uses this bit to set/clear the negative flag, letting you use BPL (Branch if PLus) if bit 7 is clear and BMI (Branch if MInus) if the bit is set. I use this to clear my buffer for example.<br>
<br>
<span style="font-family:courier new,courier,monospace;">&#xA0; LDA #$00<br>
&#xA0; LDX #$7F<br>
CleanBuffer:<br>
&#xA0; STA Buffer_Shit,x<br>
&#xA0; DEX<br>
&#xA0; BPL CleanBuffer</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__752">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Mar 28, 2016 at 6:34:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>compile_6502</b></i><br>
<br>
There is some issue involving how numbers are interpreted that I need clearing up. The manual delves into working with 8 bit numbers and how bit 7 can be used to toggle between a positive number and a negative number at the expense of using only 7 bits for the numbers themselves.<br>
<br>
The question I have is, how does the processor know when you want to work with 8-bit unsigned numbers rather than 7-bit signed numbers?</div>
It&apos;s called the&#xA0;<em>two&apos;s complement</em> representation (you can wikipedia it). It turns out that the arithmetic operations for unsigned numbers and for two&apos;s complement signed numbers are exactly the same at bit level, so the processor doesn&apos;t need to know whether you want signed or unsigned numbers. It comes down to how you as a programmer interpret the results.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__753">
                                                        <div class="mdl-card__title"><strong>compile_6502</strong> posted on 
		
			
				
				Mar 28, 2016 at 9:58:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>compile_6502</b></i><br>
<br>
There is some issue involving how numbers are interpreted that I need clearing up. The manual delves into working with 8 bit numbers and how bit 7 can be used to toggle between a positive number and a negative number at the expense of using only 7 bits for the numbers themselves.<br>
<br>
The question I have is, how does the processor know when you want to work with 8-bit unsigned numbers rather than 7-bit signed numbers?</div>
It&apos;s called the&#xA0;<em>two&apos;s complement</em> representation (you can wikipedia it). It turns out that the arithmetic operations for unsigned numbers and for two&apos;s complement signed numbers are exactly the same at bit level, so the processor doesn&apos;t need to know whether you want signed or unsigned numbers. It comes down to how you as a programmer interpret the results.<br>
<br>
&#xA0;</div>
<br>
<br>
OK, I had read about two&apos;s complement, but I haven&apos;t fully understood it yet. &#xA0;Appreciate the response!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__754">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Mar 29, 2016 at 5:18:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>compile_6502</b></i><br>
<br>
OK, I had read about two&apos;s complement, but I haven&apos;t fully understood it yet. &#xA0;Appreciate the response!</div>
<br>
Hope this help digging into the concept.<br>
<br>
Put any value &quot;x&quot; into the accumulator. Subtract 01.<br>
Again, same value &quot;x&quot; into the accumulator, add FF.<br>
Same result. Hence you can use FF like if it was -01.<br>
<br>
Add FE or subtract 02: again, same result. And so on going up in positive, or down in negative.<br>
<br>
Add 80 (Hex, dec 128) or subtract 80: same result, in this case is consedered -128 in dec rather than +128.<br>
I&apos;m not too sure why, but I think there are few reasons:<br>
00 is positive programming wise, so the opposite, 80, must be negative;<br>
00 is positive programming wise, and that makes 128 positive values, to make 128 negative ones you need 80 to be negative;<br>
80 (bin 10000000) has the bit7 set, hence makes it logic to be a negative value like all the others with bit7 set;<br>
<br>
Values 00 (positive) and 80 (negative) are a bit tricky to handle, for the rest once you get the concept it makes a lot of sense.<br>
<br>
And like TheFox says, you decide the range of your values: 00 to FF can be 0 to 255 if always positive; or 0 to 127 and -1 to -128 if you decide so.<br>
<br>
Hope this makes sense to you and helps a bit!<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__755">
                                                        <div class="mdl-card__title"><strong>compile_6502</strong> posted on 
		
			
				
				Mar 31, 2016 at 9:49:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the detailed thoughts!<br>
<br>
I see addition and subtraction are similar because the numbers increase to FF and then wrap back around to 00 and continue<br>
<br>
I have a lot of little pieces that I understand--it&apos;s just putting them all together to form a really solid view of what&apos;s happening that takes some time to absorb.<br>
<br>
I&apos;m spending quite a bit of time reading the MOS hardware and software manuals and a Commodore 64 programming manual.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__756">
                                                        <div class="mdl-card__title"><strong>freeman.pixelz</strong> posted on 
		
			
				
				Apr 10, 2016 at 7:40:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hello, I&apos;m trying to compose my own music in .asm file. For information, I use nesasm compiler on Mac OS.
<br>
<br>What&apos;s the bytes range value for Do Re Mi Fa Sol La Si on the Square and Triangle Channels?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__757">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Apr 10, 2016 at 4:49:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>freeman.pixelz</b></i><br>
<br>
Hello, I&apos;m trying to compose my own music in .asm file. For information, I use nesasm compiler on Mac OS.<br>
<br>
What&apos;s the bytes range value for Do Re Mi Fa Sol La Si on the Square and Triangle Channels?</div>
In the second part of Nerdy Neghts, written by MetalSlime, it is explained how to code a sound engine.<br>
<br>
Just check on the sticky of all Nerdy Nights threads to find all the info.<br>
<br>
Else, I&apos;ve been told you can use FamiTracker, which should make it easier, but I&apos;m too lazy and never really learned to use such tool.<br>
<br>
Maybe give a look to both, ad pick what it suits you better.<br>
<br>
Also, probably better programmers/composers than I am will give you a better advice.<br>
<br>
By the way, welcome!<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__758">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Apr 10, 2016 at 5:40:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There is a point (o) in the center of the screen: y 77 / x 7C (considering that the sprite in such point is 8x8px and must be centered, and it is rendered 1px lower).<br>
<br>
There is a second point (z) &quot;in front&quot; of (o): y 47 / x 7C, so the point (z) is 30px &quot;above&quot; (o) on the y axis.<br>
<br>
To rotate point (z) by 90&#xB0; (1/4 of a circle) on the circle centered on point (o), it is enough to bring (z) to the point x = x(o)+30 or x(o)-30, and y = y(o). So y 77 / x AC (rotating clock-wise) or x 4C (rotating counter-clock). This if my math is correct. So, if the difference on the Y axis (0px) is transfered on the X axis, and the difference on the X axis (Hex 30px) is transfered on the Y axis, point (z) rotates by 90&#xB0; (1/4 of a circle) around point (o).<br>
<br>
Rotate by 45&#xB0; (1/8 of a circle) is more tricky, but is possible to do it as well, somehow. For instance in the above case point (z) destination can be approximated at y 57 / x 9C (cw) or x 5C (cc), &quot;converting&quot; the 30px of difference on the y axis to 20px (2/3 of 30px) of difference on both axis x and y. This again if my math is correct. However, already at 45&#xB0; it starts to get complex to calculate in cases where there is a difference (in pixel position) on both the axis. And reduce the probem to a huge lookup table of all possible starting points for (z) (giving for each of these points a destination position of +/- 45&#xB0; ) is unthinkable to do I guess.<br>
<br>
Moreover, what if there is need of rotate by 22.5&#xB0; (1/16th of a circle)?<br>
<br>
I know something similar about targeting has been asked not too long ago, but that solution I fear does not solve this specific need. I know what I wish to do, but I&apos;m not too sure on what is the best way to apply simple trigonometry on 8 bit math. I&apos;m confident there is a simple way (I just can&apos;t think of) to do it. Please help if you can.<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
<strong>Edit</strong>: the symbol &quot;&#xB0;&quot; followed by &quot;)&quot; was changed to a smiley &quot; &#xB0;<span class="sprites_emoticons absmiddle" id="emo_wink"></span> &quot;, corrected.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__759">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 12, 2016 at 11:18:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>freeman.pixelz</b></i><br>
<br>
Hello, I&apos;m trying to compose my own music in .asm file. For information, I use nesasm compiler on Mac OS.<br>
<br>
What&apos;s the bytes range value for Do Re Mi Fa Sol La Si on the Square and Triangle Channels?</div>
Not really sure what you&apos;re asking, since &quot;Do&quot; is the root of any pentatonic scale and doesn&apos;t necessarily represent a specific note value.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__760">
                                                        <div class="mdl-card__title"><strong>freeman.pixelz</strong> posted on 
		
			
				
				Apr 13, 2016 at 3:25:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I found the answer in Nerdy Nights page <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__761">
                                                        <div class="mdl-card__title"><strong>Alder</strong> posted on 
		
			
				
				Apr 14, 2016 at 9:00:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have a question about directives.  Is it correct to say that things like .db, .org, .incbin, etc. are all specific to the assembler?  Are these specific only to NESASM?  And where could I find a list of these directives?
<br>
<br>What I was also wondering is, I&apos;ve seen words prefixed with a dot used as loop in some NES code.  Things like .loop to construct a local loop.. does this work only because of horizontal placement, and do they work like any other label?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__762">
                                                        <div class="mdl-card__title"><strong>freem</strong> posted on 
		
			
				
				Apr 15, 2016 at 4:30:10 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					&gt; Is it correct to say that things like .db, .org, .incbin, etc. are all specific to the assembler?<br>
yes<br>
<br>
&gt; Are these specific only to NESASM?<br>
Some are specific to NESASM, while others seem to be &quot;standardized&quot; between assemblers. (e.g. a few of the ones you mentioned)<br>
<br>
&gt; And where could I find a list of these directives?<br>
In the documentation: <a href="downloads/missing/nesasm_usage.txt" target="_blank" original-href="https://dl.dropboxusercontent.com/u/6447287/nesasm_usage.txt">https://dl.dropboxusercontent.com...</a><br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__763">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 15, 2016 at 5:08:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Alder</b></i><br>
What I was also wondering is, I&apos;ve seen words prefixed with a dot used as loop in some NES code. Things like .loop to construct a local loop.. does this work only because of horizontal placement, and do they work like any other label?</div>
<br>
I&apos;m no super programmer, so I really don&apos;t know what &apos;horizontal placement&apos; is, but in NESASM, the dot before a label means that you can reuse that label in another subroutine. Example:<br>
<br>
Label1:<br>
&#xA0;&#xA0;&#xA0; code code code<br>
&#xA0;&#xA0; .loop:<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; loopy code<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; BEQ .loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (Branch if Equal to .loop)<br>
EndLabel1:<br>
&#xA0;&#xA0; RTS<br>
<br>
Label2:<br>
&#xA0;&#xA0;&#xA0; code code code<br>
&#xA0;&#xA0; .loop:<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; loopy code<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; BEQ .loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (Branch if Equal to .loop)<br>
EndLabel2:<br>
&#xA0;&#xA0;&#xA0; RTS<br>
<br>
Label1 and Label2 are unique labels, so you can&apos;t reuse them. the .loop labels only look inside it&apos;s specific subroutine, so you can reuse that same label in another subroutine.<br>
<br>
Hope that made sense.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__764">
                                                        <div class="mdl-card__title"><strong>Alder</strong> posted on 
		
			
				
				Apr 15, 2016 at 5:29:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>freem</b></i><br>
<br>
&gt; And where could I find a list of these directives?<br>
In the documentation: <a href="downloads/missing/nesasm_usage.txt" target="_blank" original-href="https://dl.dropboxusercontent.com/u/6447287/nesasm_usage.txt">https://dl.dropboxusercontent.com/u/6447287/nesasm_usage.txt</a><br>
&#xA0;</div><br><br><div class="FTQUOTE" style="width: 1131.19px; line-height: 20.8px;"><i>Originally posted by:&#xA0;<b>Mega Mario Man</b></i><br>
<br>
Label1 and Label2 are unique labels, so you can reuse them. the .loop labels only look inside it&apos;s specific subroutine, so you can reuse that same label in another subroutine.<br>
<br>
Hope that made sense.</div>
Thanks! &#xA0;That helps a lot <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br style="line-height: 20.8px;">
<br style="line-height: 20.8px;">
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__765">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 15, 2016 at 9:04:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Alder</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>freem</b></i><br>
<br>
&gt; And where could I find a list of these directives?<br>
In the documentation: <a href="downloads/missing/nesasm_usage.txt" target="_blank" original-href="https://dl.dropboxusercontent.com/u/6447287/nesasm_usage.txt">https://dl.dropboxusercontent.com/u/6447287/nesasm_usage.txt</a><br>
&#xA0;</div><br><br><div class="FTQUOTE" style="width: 1131.19px; line-height: 20.8px;"><i>Originally posted by:&#xA0;<b>Mega Mario Man</b></i><br>
<br>
Label1 and Label2 are unique labels, so you <strong>can&apos;t</strong> reuse them. the .loop labels only look inside it&apos;s specific subroutine, so you can reuse that same label in another subroutine.<br>
<br>
Hope that made sense.</div>
Thanks! &#xA0;That helps a lot<br style="line-height: 20.8px;">
<br style="line-height: 20.8px;">
&#xA0;</div>
I typoed that bolded part....hope you caught that... <span class="sprites_emoticons absmiddle" id="emo_sad"></span><br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__766">
                                                        <div class="mdl-card__title"><strong>Alder</strong> posted on 
		
			
				
				Apr 15, 2016 at 11:13:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
<span style="line-height: 1.6;">I typoed that bolded part....hope you caught that...</span></div>
I interpreted it another way, but I think I understand. &#xA0;You can reference a &quot;normal&quot; label from anywhere in your code, but you can&apos;t make another label with the same name. &#xA0;Is the only difference with labels starting with a dot that you can reuse the name? &#xA0;When you branch/jump, does it just look for the most recent one? &#xA0;By horizontal placement I meant, two spaces before &quot;.org&quot; means the assembler considers it a directive, but no spaces before &quot;.org&quot; means it&apos;s a label? (Even though you&apos;d never want to do that, it seems to work)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__767">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 16, 2016 at 12:46:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Alder</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
<span style="line-height: 1.6;">I typoed that bolded part....hope you caught that...</span></div>
I interpreted it another way, but I think I understand. &#xA0;You can reference a &quot;normal&quot; label from anywhere in your code, but you can&apos;t make another label with the same name. &#xA0;Is the only difference with labels starting with a dot that you can reuse the name? &#xA0;When you branch/jump, does it just look for the most recent one? &#xA0;By horizontal placement I meant, two spaces before &quot;.org&quot; means the assembler considers it a directive, but no spaces before &quot;.org&quot; means it&apos;s a label? (Even though you&apos;d never want to do that, it seems to work)</div>
<br>
Yup, a dot in front of a label means you can reuse that name. This way you don&apos;t have to have a label named &apos;loop1000&apos; later on in your code. Just keep using .loop. Now, you cannot have 2 of the same dot labels in the same subroutine. Sorry, I don&apos;t know the exact term. I&apos;m guessing a more professional programmer will. So you cannot do this:<br>
<br>
Label1:<br>
&#xA0;&#xA0; NORMAL CODE<br>
<br>
&#xA0; .loop:<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; loopy1code<br>
&#xA0; BNE .loop<br>
<br>
&#xA0; .loop:<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; loopy2code<br>
&#xA0; BNE .loop<br>
<br>
Label1End:<br>
&#xA0; RTS<br>
<br>
#####<br>
In this case, you would have to use .loop2 since .loop 1 is in the same subroutine.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__768">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Apr 16, 2016 at 7:51:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Basically you can&apos;t jump or branch to a local subroutine if there&apos;s a non-local subroutine in between.<br>
<br>
LoadNametable:<br>
&#xA0; LDA Blah<br>
&#xA0; CMP #$00<br>
&#xA0; BEQ .Local<br>
&#xA0; RTS<br>
LoadAttribute:<br>
&#xA0; Stuff<br>
&#xA0; RTS<br>
.Local:<br>
&#xA0; More Stuff<br>
&#xA0; RTS<br>
<br>
It wouldn&apos;t see .Local because it&apos;s on the other side of a non-local subroutine. Even though it&apos;s well within the range of normal branching.<br>
<br>
Apologize for bad terminology.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__769">
                                                        <div class="mdl-card__title"><strong>Greenman</strong> posted on 
		
			
				
				Apr 18, 2016 at 9:27:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I recently bought a super pro 610p.  Could anyone explain to me how to program 29f016b or 29f032b, I&apos;m not sure which adapter to use so far. I have the Tsop to dip version 3 adapters and the additional adapter set offered with the super pro.   Thanks in advance.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__770">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Apr 22, 2016 at 10:51:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Greenman</b></i><br>
<br>
I recently bought a super pro 610p. Could anyone explain to me how to program 29f016b or 29f032b, I&apos;m not sure which adapter to use so far. I have the Tsop to dip version 3 adapters and the additional adapter set offered with the super pro. Thanks in advance.</div>
I think you may have misunderstood the word &quot;Progamming&quot; for this thread. This is for asking questions regarding coding new NES games, not flashing chips. May want to make this a Brewery Topic and maybe search the net for some answers. This seems like it should be pretty straight forward, I bet someone out there already has an answer posted.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__771">
                                                        <div class="mdl-card__title"><strong>kamakazi</strong> posted on 
		
			
				
				May 2, 2016 at 3:32:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					can a retron 2 be used in place of a real NES for homebrew learning and testing asm via a powerpak flash cart ?, I have some ASM programming in 6502 for the atari 800xl home computer and would like to try my hand at making a game for the nes.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__772">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 2, 2016 at 6:08:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Probably depends on the mapper. If you&apos;re using an INL flash board for UNROM mapper 2, it will probably work fine.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__773">
                                                        <div class="mdl-card__title"><strong>kamakazi</strong> posted on 
		
			
				
				May 3, 2016 at 2:19:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank you for the info, I am trying to find a used nintendo on craigslist for less than $100.00 that way i can have guarenteed compatibility.<br>
<br>
Kamakazi
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__774">
                                                        <div class="mdl-card__title"><strong>Alder</strong> posted on 
		
			
				
				May 4, 2016 at 12:36:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So I have a question about redrawing backgrounds. &#xA0;For my pong game, I have two scores drawn on the screen. &#xA0;When I update the score, I set a flag that says the background needs to be redrawn. &#xA0;Then in NMI, after I transfer the sprite data I check the flag and conditionally jump to a subroutine to redraw the background. &#xA0;I had code in that subroutine that was redrawing Player 1&apos;s score and it was working fine, but when I try to make it also redraw Player 2&apos;s score, I get some weird flickering and the scores get messed up. &#xA0;Here&apos;s the code I had for redrawing Player 1&apos;s score:<br>
<br>
DrawP1Score:<br>
&#xA0; ;Draw player1Score<br>
&#xA0; LDA $2002<br>
&#xA0; LDA #high(GRAPHICS_LOCATION + (player1ScoreSprite - backgrounds))<br>
&#xA0; STA $2006<br>
&#xA0; LDA #low(GRAPHICS_LOCATION + (player1ScoreSprite - backgrounds))<br>
&#xA0; STA $2006<br>
<br>
&#xA0; LDA player1Score<br>
&#xA0; STA myWord<br>
&#xA0; LDA player1Score+1<br>
&#xA0; STA myWord+1<br>
&#xA0; JSR HexWordToUnsignedDecimal ;converting 2 byte hex value to 5 byte (5 digits) decimal value<br>
&#xA0; LDA myDec+1 ;ignore ten thousands digit<br>
&#xA0; STA $2007<br>
&#xA0; LDA myDec+2<br>
&#xA0; STA $2007<br>
&#xA0; LDA myDec+3<br>
&#xA0; STA $2007<br>
&#xA0; LDA myDec+4<br>
&#xA0; STA $2007<br>
<br>
&#xA0; RTS<br>
<br>
<br>
I don&apos;t know if I&apos;m doing something wrong, but it seemed to work so I thought it was correct. &#xA0;But I made a similar subroutine for P2 and invoked it after DrawP1Score, and it updated the scores a few times before problems appear. &#xA0;Basically the screen sort of scrolls down and snaps back every few seconds.<br>
<br>
I think I figured it out though - maybe that hex conversion subroutine is just too expensive to call inside my redraw. &#xA0;Perhaps it wasn&apos;t too expensive to do once, but doing it twice made it noticeable? &#xA0;I commented it out and didn&apos;t get the flicker anymore. &#xA0;I&apos;m guessing I have to do all my intensive calculations outside of the redraw. &#xA0;Can anyone confirm that&apos;s the problem, or am I doing something else wrong?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__775">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				May 4, 2016 at 3:51:23 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, the problem is very likely to be due to overrunning the vblank time.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__776">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				May 4, 2016 at 3:54:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
<br>
Yeah, the problem is very likely to be due to overrunning the vblank time.</div>
<br>
This. I&apos;d suggest buffering the scores during rendering time and then copy the buffer to the BG during vblank<br>
This article is the best regarding vblank stuff:&#xA0;<a href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs">http://wiki.nesdev.com/w/index.ph...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__777">
                                                        <div class="mdl-card__title"><strong>Alder</strong> posted on 
		
			
				
				May 4, 2016 at 4:40:59 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Alright, cool <span class="sprites_emoticons absmiddle" id="emo_smile"></span> I thought that was probably it, but wanted to make sure.  Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__778">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 4, 2016 at 9:13:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Buffering is a bit tricky to figure out, but once you do, you&apos;ll wonder why you ever did anything different.  In addition to that article, MetalSlime uses some examples in his music tutorials.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__779">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 4, 2016 at 10:32:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Like the others stated, that hex conversion is killing you. I buffer all that and do nothing but write tiles during vblank. In Tailgate Party, there are times where I&apos;m writing 35 background tiles in 1 vblank with no issue to update the score and throw results.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__780">
                                                        <div class="mdl-card__title"><strong>Alder</strong> posted on 
		
			
				
				May 4, 2016 at 12:45:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					By &quot;buffering&quot; do you mean calculating as much of your redraw data as possible outside of vblank?  
<br>
<br>My hex conversion routine always reads from the same two-byte variable (myWord) and stores the result in the global temporary myDec variable.
<br>Is that considered bad practice?  Every time I convert I have to store my input in the myWord variable, then copy the output from myDec to another 5-byte variable.
<br>Previously I was using myDec in-place when drawing the score.  But to save vblank time, I added two variables (player1ScoreDec and player2ScoreDec) and change those when the score changes, then later redraw using them.  That seems to work okay.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__781">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 4, 2016 at 4:17:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The link that Vectrex posted on the previous page details exactly what buffering is and how it can be implemented using the $0100 area the stack doesn&apos;t use.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__782">
                                                        <div class="mdl-card__title"><strong>Alder</strong> posted on 
		
			
				
				May 4, 2016 at 10:29:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
The link that Vectrex posted on the previous page details exactly what buffering is and how it can be implemented using the $0100 area the stack doesn&apos;t use.</div>
Oh shoot, somehow I completely missed that link. &#xA0;Thanks <span class="sprites_emoticons absmiddle" id="emo_smile"></span><br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__783">
                                                        <div class="mdl-card__title"><strong>Alder</strong> posted on 
		
			
				
				May 11, 2016 at 4:18:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So I&apos;ve read from a couple places that doing &quot;everything in NMI&quot; is a bad idea.  What&apos;s the alternative?  Currently, my code looks like this:
<br>
<br>RESET:
<br>  ;some initialization
<br>  ;infinite loop
<br>NMI:
<br>  ;transfer sprite data
<br>  ;redraw background tiles if necessary
<br>  ;PPU cleanup
<br>  ;Read controller state
<br>  ;Run 1 game engine cycle
<br>  ;Update sprite data at $0200 RAM (or wherever I put them)
<br>  ;RTI 
<br>-actual subroutines/data-
<br>
<br>Is this structure &quot;doing everything in NMI&quot;?  Should I put my game logic somewhere else (in the infinite loop?)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__784">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				May 12, 2016 at 12:25:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes, thats everything in NMI. You are on the right track with logic in the main loop.<br>
You want to use the NMI for PPU updates. Run AI, poll controller(s), buffer gfx updates e.t.c.<br>
outside the NMI, or outside VBlank to be more specific.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__785">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 12, 2016 at 8:32:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Alder</b></i><br>
<br>
So I&apos;ve read from a couple places that doing &quot;everything in NMI&quot; is a bad idea. What&apos;s the alternative? Currently, my code looks like this:<br>
<br>
RESET:<br>
;some initialization<br>
;infinite loop<br>
NMI:<br>
;transfer sprite data<br>
;redraw background tiles if necessary<br>
;PPU cleanup<br>
;Read controller state<br>
;Run 1 game engine cycle<br>
;Update sprite data at $0200 RAM (or wherever I put them)<br>
;RTI<br>
-actual subroutines/data-<br>
<br>
Is this structure &quot;doing everything in NMI&quot;? Should I put my game logic somewhere else (in the infinite loop?)</div>
This is my entire NMI. I&apos;m not sure why, but I don&apos;t even poll controllers during NMI, it works fine for me.<br>
<br>
<br>
;--------------------------------------------------------------<br>
;-----------------------NMI ROUTINE----------------------------<br>
;--------------------------------------------------------------<br>
NMI:<br>
&#xA0; PHA&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;protect the registers by moving values to the stack<br>
&#xA0; TXA<br>
&#xA0; PHA<br>
&#xA0; TYA<br>
&#xA0; PHA<br>
<br>
nmi_start: &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;write Sprite RAM<br>
&#xA0; LDA #$00<br>
&#xA0; STA $2003&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; set the low byte (00) of the RAM address<br>
&#xA0; LDA #$02<br>
&#xA0; STA $4014<br>
&#xA0;<br>
&#xA0; LDA updating_background&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;check to be sure that the main program isn&apos;t busy<br>
&#xA0; BNE skip_graphics_updates<br>
<br>
&#xA0; JSR GameStateNMIIndirect&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;jump to NMI code for current state. Mostly Background tile updates.<br>
&#xA0;<br>
&#xA0; LDA #$00&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;tell the ppu there is no background scrolling<br>
&#xA0; STA $2005<br>
&#xA0; STA $2005<br>
&#xA0;<br>
&#xA0; LDA #%10010000&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1<br>
&#xA0; ORA NameTableFlag&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0; ;switch nametables<br>
&#xA0; STA $2000<br>
<br>
&#xA0; ;;;;;;;;;;;;;;;;;;;;<br>
&#xA0;<br>
&#xA0; LDA EnablePPUFlag&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;check to see if the PPU needs turned on<br>
&#xA0; BEQ .SKIP<br>
&#xA0;&#xA0;&#xA0; LDA #%00011110&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;enable sprites, enable background, no clipping on left side<br>
&#xA0;&#xA0;&#xA0; STA $2001<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0;&#xA0; &#xA0;DEC EnablePPUFlag<br>
&#xA0; .SKIP:<br>
<br>
&#xA0; jsr FamiToneUpdate&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;*MUSIC<br>
&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ;run our sound engine after all drawing code is done.<br>
&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;this ensures our sound engine gets run once per frame.<br>
&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; LDA #$00<br>
&#xA0; STA sleeping&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;wake up the main program &#xA0;<br>
&#xA0;<br>
skip_graphics_updates:<br>
<br>
&#xA0; PLA&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;restore the registers<br>
&#xA0; TAY<br>
&#xA0; PLA<br>
&#xA0; TAX<br>
&#xA0; PLA<br>
<br>
&#xA0; RTI&#xA0;&#xA0;&#xA0;<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__786">
                                                        <div class="mdl-card__title"><strong>Alder</strong> posted on 
		
			
				
				May 12, 2016 at 11:03:10 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ah, okay.  The only thing I&apos;m wondering is how to keep my Game Engine running at the right speed.  Looking at your code, I&apos;m guessing that&apos;s what the sleeping variable is for.. are we just setting that to true at the end of the game engine, and checking it at the beginning of the infinite loop to know whether or not to run the game engine?  Then setting it to false during NMI to make the game engine run one cycle after NMI returns?
<br>
<br>I noticed you put your sound engine/sleeping code before the skip_graphics_updates label.  Can you explain what the updating_background variable is for?  It seems it&apos;s doing more than just signalling that background tiles need redrawn?
<br>
<br>Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__787">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 12, 2016 at 2:36:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Alder</b></i><br>
<br>
Ah, okay. The only thing I&apos;m wondering is how to keep my Game Engine running at the right speed. Looking at your code, I&apos;m guessing that&apos;s what the sleeping variable is for.. are we just setting that to true at the end of the game engine, and checking it at the beginning of the infinite loop to know whether or not to run the game engine? Then setting it to false during NMI to make the game engine run one cycle after NMI returns?<br>
<br>
I noticed you put your sound engine/sleeping code before the skip_graphics_updates label. Can you explain what the updating_background variable is for? It seems it&apos;s doing more than just signalling that background tiles need redrawn?<br>
<br>
Thanks!</div>
Please take a look at this. it explains NMIs\Vblanks\Interrupts much better than I ever could. <a href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/The_frame_and_NMIs">http://wiki.nesdev.com/w/index.ph...</a><br>
<br>
I pretty much stole this right from Mario&apos;s Right Nut&apos;s tutorial on game engines: <a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=37054" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=37054">http://nintendoage.com/forum/mess...</a><br>
<br>
Here is the finished Forever: Loop. It&apos;s all explained in that Mario&apos;s Right Nut Tutorial. It&apos;s a really great Game State Engine.<br>
<br>
;----------------------------------------------------------------------<br>
;-----------------------START MAIN PROGRAM-----------------------------<br>
;---------------------------------------------------------------------- &#xA0;<br>
Forever:<br>
&#xA0; INC sleeping&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;wait for NMI<br>
<br>
.loop<br>
&#xA0; LDA sleeping<br>
&#xA0; BNE .loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;wait for NMI to clear out the sleeping flag<br>
<br>
&#xA0; LDA #$01<br>
&#xA0; STA updating_background&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;;it will skip the NMI updates so as not to mess with your room loading routines<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0;&#xA0; JSR ReadController1&#xA0; ;;get the current button data<br>
&#xA0;&#xA0; JSR ReadController2<br>
&#xA0;<br>
&#xA0; JSR GameStateIndirect&#xA0;&#xA0;&#xA0; ;THIS RUNS THE GAME CODE DEPENDING ON WHAT GAME STATE I AM IN<br>
<br>
&#xA0; LDA GameState&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;If the game state is the same, do not update.<br>
&#xA0; CMP GameStateOld<br>
&#xA0; BEQ .next<br>
<br>
&#xA0; JSR GameStateUpdate&#xA0;&#xA0;&#xA0; ;IF THE GAME STATE HAS CHANGED IN THE MAIN CODE, THIS WILL UPDATE THE GameStateIndirect<br>
<br>
.next<br>
<br>
&#xA0; LDA #$00<br>
&#xA0; STA updating_background<br>
&#xA0; JMP Forever&#xA0;&#xA0;&#xA0;&#xA0; ;jump back to Forever, and go back to sleep
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__788">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 14, 2016 at 1:35:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Using Famitone as my sound engine (Thanks Shiru!) and having some issues with disabling and enabling channels. What I want to do is mute a couple of channels when I pause the game, so I put this in my main code:
<br>LDA  #$05     ; turn off square 2 and triangle
<br>STA APU_SND_CHN   ;$4015
<br>
<br>That part works perfect. However, when I try to re-enable all of the channels, there is sometimes a delay. It seems almost like it is waiting for the address to stop being busy before turning those bits back on. The delay varies in time. Sometimes there is no delay, sometimes a few seconds, sometimes less than a second. I use this in my main code to enable it:
<br>
<br>LDA  #$0F  ;turn on square 1, 2, triangle, and noise
<br>STA APU_SND_CHN
<br>
<br>Any thoughts! Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__789">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 16, 2016 at 12:25:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m also hoping for an answer regarding the post above. I&apos;ve run into the same problems.
<br>
<br>Hopefully someone more knowledgeable can chime in!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__790">
                                                        <div class="mdl-card__title"><strong>hybrid</strong> posted on 
		
			
				
				May 16, 2016 at 10:49:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
Using Famitone as my sound engine (Thanks Shiru!) and having some issues with disabling and enabling channels. What I want to do is mute a couple of channels when I pause the game, so I put this in my main code:<br>
LDA #$05 ; turn off square 2 and triangle<br>
STA APU_SND_CHN ;$4015<br>
<br>
That part works perfect. However, when I try to re-enable all of the channels, there is sometimes a delay. It seems almost like it is waiting for the address to stop being busy before turning those bits back on. The delay varies in time. Sometimes there is no delay, sometimes a few seconds, sometimes less than a second. I use this in my main code to enable it:<br>
<br>
LDA #$0F ;turn on square 1, 2, triangle, and noise<br>
STA APU_SND_CHN<br>
<br>
Any thoughts! Thanks!</div>
<br>
<br>
what about adding #$0A to&#xA0;<span style="line-height: 20.8px;">APU_SND_CHN<br>
instead of loading a whole new value&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__791">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 17, 2016 at 10:28:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>hybrid</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
Using Famitone as my sound engine (Thanks Shiru!) and having some issues with disabling and enabling channels. What I want to do is mute a couple of channels when I pause the game, so I put this in my main code:<br>
LDA #$05 ; turn off square 2 and triangle<br>
STA APU_SND_CHN ;$4015<br>
<br>
That part works perfect. However, when I try to re-enable all of the channels, there is sometimes a delay. It seems almost like it is waiting for the address to stop being busy before turning those bits back on. The delay varies in time. Sometimes there is no delay, sometimes a few seconds, sometimes less than a second. I use this in my main code to enable it:<br>
<br>
LDA #$0F ;turn on square 1, 2, triangle, and noise<br>
STA APU_SND_CHN<br>
<br>
Any thoughts! Thanks!</div>
<br>
<br>
what about adding #$0A to&#xA0;<span style="line-height: 20.8px;">APU_SND_CHN<br>
instead of loading a whole new value&#xA0;</span></div>
Great idea, hadn&apos;t tried that yet. But, it didn&apos;t work, same result.<br>
<br>
KHAN and I have also tried ORA %00001111 with the same result.<br>
<br>
I also tried skipping &apos;jsr FamiToneUpdate&apos; in the NMI for 1 frame to see if it routine just needed a quick break but that didn&apos;t work either.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__792">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				May 19, 2016 at 11:57:02 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There is FamiToneMusicPause routine. You can either just use it, or take a look how to do this properly.<br>
<br>
If you want to mute music channels but not stop music, it is not supported in the engine as is. It shouldn&apos;t be done via $4015, but with preventing writing the volume output into corresponding registers in the FamiToneUpdate, sending zero volume instead. I.e. the parts of the code like this:<br>
<br>
@ch1prev:<br>
lda FT_CH1_VOLUME<br>
@ch1cut:<br>
ora FT_CH1_DUTY<br>
sta FT_MR_PULSE1_V<br>
<br>
need to get additional condition to do lda #0 instead of lda FT_CH1_VOLUME when a channel is muted.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__793">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 19, 2016 at 12:17:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Shiru</b></i><br>
<br>
There is FamiToneMusicPause routine. You can either just use it, or take a look how to do this properly.<br>
<br>
If you want to mute music channels but not stop music, it is not supported in the engine as is. It shouldn&apos;t be done via $4015, but with preventing writing the volume output into corresponding registers in the FamiToneUpdate, sending zero volume instead. I.e. the parts of the code like this:<br>
<br>
@ch1prev:<br>
lda FT_CH1_VOLUME<br>
@ch1cut:<br>
ora FT_CH1_DUTY<br>
sta FT_MR_PULSE1_V<br>
<br>
need to get additional condition to do lda #0 instead of lda FT_CH1_VOLUME when a channel is muted.</div>
<br>
Thanks for the response!<br>
<br>
I will take a look at this and see what I can do.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__794">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 19, 2016 at 12:34:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks a bunch, Shiru!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__795">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				May 20, 2016 at 10:07:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Heyo! I&apos;ve been going through the tutorials and wanted to read up on mappers and swapping to try and understand what it actually does... 
<br>
<br>for instance, I&apos;m trying to create a text engine for later down the line, and because text tiles take up a lot of space, I figure it&apos;s be best to use mapping when a text box appears. What I don&apos;t understand from the tutorial, however, is what all actually changes in a swap. Will all tiles on the screen change to fit the swap, or only the ones I&apos;m changing? Like if I used a separate bank for the text and text boxes, would simple mapping work to bring it up without messing with the rest if the background?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__796">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 20, 2016 at 10:52:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>RockyHardwood</b></i><br>
<br>
Heyo! I&apos;ve been going through the tutorials and wanted to read up on mappers and swapping to try and understand what it actually does...<br>
<br>
for instance, I&apos;m trying to create a text engine for later down the line, and because text tiles take up a lot of space, I figure it&apos;s be best to use mapping when a text box appears. What I don&apos;t understand from the tutorial, however, is what all actually changes in a swap. Will all tiles on the screen change to fit the swap, or only the ones I&apos;m changing? Like if I used a separate bank for the text and text boxes, would simple mapping work to bring it up without messing with the rest if the background?</div>
Bank swapping is swapping all code in that bank, it&apos;s not necessarily just tiles, it can be regular game code as well. I usually it use it to swap large amounts of data, such as music, backgrounds, chr files.&#xA0; What you are swapping is ROM data in the memory and making inactive ROM active. So, your ROM data is stored in 4 8KB banks or 2 16kb banks:<br>
---------16kb Swappable---------------<br>
BANK 0 = $8000-$9FFF = 8KB<br>
BANK 1 = $A000-$BFFF = 8KB<br>
---------16kb Swappable---------------<br>
BANK 2 = $8000-$9FFF = 8KB<br>
BANK 3 = $A000-$BFFF = 8KB<br>
---------16kb Swappable---------------<br>
BANK 4 = $8000-$9FFF = 8KB<br>
BANK 5 = $A000-$BFFF = 8KB<br>
---------16kb Swappable---------------<br>
BANK 6 = $8000-$9FFF = 8KB<br>
BANK 7 = $A000-$BFFF = 8KB<br>
---------16kb Swappable---------------<br>
BANK 8 = $8000-$9FFF = 8KB<br>
BANK 9 = $A000-$BFFF = 8KB<br>
---------16kb Swappable---------------<br>
BANK 10 = $8000-$9FFF = 8KB<br>
BANK 11 = $A000-$BFFF = 8KB<br>
---------16kb Swappable---------------<br>
BANK 12 = $8000-$9FFF = 8KB<br>
BANK 13 = $A000-$BFFF = 8KB<br>
----------16kb Not-Swappable--------- &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
BANK 14 = $C000-$DFFF = 8KB<br>
BANK 15 = $E000-$FFFF = 8KB<br>
<br>
In my code (using Mapper 2, Unrom), I can swap 1 16kb bank (each mapper has its own swapping rules, this is for UNROM. Even this can be defined further when setting up the mapper). Banks that contain address $8000-$BFFF are swappable. Thus, you need to put your main code in banks 14 and 15 as that cannot be swapped out.&#xA0; When your game starts, it will boot up with Banks 0, 1, 14 and 15 as the active banks. At any time, you can swap out the code in Banks 0 and 1 (16kb) with any other pair of 16kb banks, such as Banks 2 and 3. The data in banks 0 and 1 are now not usable and only the data in Banks 2 and 3 are. Essentially, you are reading ROM data from registers $8000-$FFFF and the front half can be swapped out so you can store more data. As stated before, each mapper handles swapping differently and can allow for different amount of ROM storage.&#xA0; In the example above, I&apos;m using UNROM with 128KB of space. I can only access 32kb at a time, but I can swap in and out 16kb of data at anytime during the code. I also use CHRAM, which means that when I switch to a bank storing graphic tiles, I have to reload the PPU with new graphics while the PPU is turned off. In this case, I disable the CPU, swap banks to banks 2 and 3 where I store more graphic tiles, load the new tiles into CHRAM in the PPU, and then swap banks back to my game code in banks 0 and 1. With CHRAM, you can swap freely swap banks without messing with your background tiles. The only way you can manipulate background tiles is to reload the CHRAM with new tiles. You can even just swap out small parts of CHRAM background tile and not the entire 8kb if you like. I do this in my game with character profile pictures by swapping out only 16 tiles instead of the entire 256 tiles, but I do this with the PPU turned off.<br>
<br>
On the other hand, if you are wanting to animate the background tiles with 2 different sets of background tiles (I think Mario 3 does this on the level 1 map with the dancing bushes), you must move to a mapper that can do CHROM, such as MM3 (mapper 3). I think bunnyboy&apos;s tutorial covers this in Advance Nerdy Nights. I haven&apos;t really tried it, but you would store your graphics files in seperate swappable banks and then swap back and forth between the banks. Again, I&apos;m not as well versed on this as I have never messed with CHROM. I do believe that this is a full 256 tiles swap, but don&apos;t quote me. Maybe there are tricks that other&apos;s more knowledgeable than myself can tell you.<br>
<br>
Hope that was all clear as mud. I may not be the best at explaining bank swapping across different mappers as I really don&apos;t venture much out of UNROM at this point.<br>
<br>
IMPORTANT NOTE: NESASM3 banks are 8kb. BUT when you swap banks, it looks at 16kb at a time, $8000-$BFFF. So, when you tell the code to swap out Bank 0 for Bank 1, you are actaully swapping NESASM Banks 0 and 1 for NESASM Banks 2 and 3.<br>
---------16kb Swappable BANK 0---------------<br>
NESASM3 BANK 0 = $8000-$9FFF = 8KB<br>
NESASM3 BANK 1 = $A000-$BFFF = 8KB<br>
---------16kb Swappable BANK 1---------------<br>
NESASM3 BANK 2 = $8000-$9FFF = 8KB<br>
NESASM3 BANK 3 = $A000-$BFFF = 8KB<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__797">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				May 20, 2016 at 11:18:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					hmm, okay- the CHRAM is the part I&apos;m trying to understand, mostly. When you say &quot;reload the PPU with new graphics while the PPU is turned off&quot;, does that translate to NMI? and what do you mean by disabling the CPU? And how can you only swap a few tiles if your swapping whole banks? That&apos;s my main question.<br>
<br>
or, would this flow work in the NMI:<br>
<br>
draw black box at bottom of screen<br>
swap to bank with text CHR data<br>
draw text after swap<br>
swap back<br>
other updates, repeat on next NMI<br>
<br>
my question is, would swapping, drawing, and swapping back give me the effect I&apos;m looking for?<br>
<br>
EDIT: well, that didn&apos;t work. Found a thing on the programming resources page, I think... gonna check that out and figure out the CHR RAM nonsense
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__798">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				May 20, 2016 at 1:42:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So If I understand this correctly, to do this sort of swapping, I need to make the CHR data part of the code instead of the CHR banks?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__799">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 20, 2016 at 2:32:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>RockyHardwood</b></i><br>
<br>
hmm, okay- the CHRAM is the part I&apos;m trying to understand, mostly. When you say &quot;reload the PPU with new graphics while the PPU is turned off&quot;, does that translate to NMI? and what do you mean by disabling the CPU? And how can you only swap a few tiles if your swapping whole banks? That&apos;s my main question.<br>
<br>
or, would this flow work in the NMI:<br>
<br>
draw black box at bottom of screen<br>
swap to bank with text CHR data<br>
draw text after swap<br>
swap back<br>
other updates, repeat on next NMI<br>
<br>
my question is, would swapping, drawing, and swapping back give me the effect I&apos;m looking for?<br>
<br>
EDIT: well, that didn&apos;t work. Found a thing on the programming resources page, I think... gonna check that out and figure out the CHR RAM nonsense</div>
<strong>what do you mean by disabling the CPU?</strong><br>
--oops...PPU, not CPU<br>
<br>
Also, sorry for all my spelling errors. CHR-RAM and CHR-ROM.<br>
View this as it will explain CHRRAM and CHRROM much better than I can.<br>
<a href="http://wiki.nesdev.com/w/index.php/CHR_ROM_vs._CHR_RAM" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/CHR_ROM_vs._CHR_RAM">http://wiki.nesdev.com/w/index.ph...</a><br>
<br>
What is sound like you are trying to accomplish is not bank swap related. Bank Swapping is for getting more ROM space in your game.<br>
What you are trying to do is manipulate tiles on the screen. For this, you must have all the tiles in RAM at PPU Address $1000-$1FFF, Pattern Table 1. That is where the background tiles are stored in RAM, think of it as a your Tile Holder in Scrabble. Your Name Table refers to addresses in the Pattern Table to display your background, think of this as the Game Board in Scrabble. You can use any tiles on your Tile Holder to write words on the Game Board. Only difference is, that your Tile Holder never actaully loses its tiles. (this is sort of a poor example, but kind of paints a picture). Now, lets say you have tiles ASDFPIG in your Tile Holder (Pattern Table). You can use those tiles to spell PIG on the game board (Name Table). However, if you would swap out the PIG tiles in your Tile Holder (Pattern Table) with CAT (ASDFCAT), now the game board (Name Table) would display CAT.<br>
<img src original-src="http://www.nesmuseum.com/images/ppumemmap.png" show-src="scraper/images/ppumemmap.png"><br>
So, using CHRRAM,<br>
1. you would bank swap,<br>
2. turn off the PPU,<br>
3. write the new tiles to the Pattern Table,<br>
4. and then turn the PPU back on.<br>
At this point, those new tiles are now in the Pattern Table and can be used in the Name Table. You are free to bank swap away at this point. Steps 1 and 2 are interchangable.<br>
<br>
<br>
To accomplish what you want to do, your black box is probably going to be composed of 1 repeating black tile, lets say tile $00 is a plain black tile in the Pattern Table. So your box looks like this in the Name Table.<br>
$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 1<br>
$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 2<br>
$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 3<br>
$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 4<br>
$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 5<br>
$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 6<br>
$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 7<br>
<br>
Now you want to add text, lets say PIG, right in the beginning of line 4. In your Pattern Table, you need to have the tiles P, I, and G. Let&apos;s just say they stored as follows in the Pattern Table:<br>
$00 = Blank Tile<br>
$01 = P<br>
$02 = I<br>
$03 = G<br>
<br>
So, now what you need to do is your Background Updating Routine to write these tiles to the Name Table in the PPU. You can only write to the PPU during an interrupt, in our case, the NMI. So, what you would do is store tiles P, I, G ($01, $02, $03) in a buffer. Then, during the NMI, activate the Background Updating Routine Code (that you must write) and write those three tiles to the address in the Name Table that you want them. So, now, your Name Table looks like this.<br>
$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 1<br>
$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 2<br>
$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 3<br>
$01,$02,$03,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 4<br>
$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 5<br>
$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 6<br>
$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00&#xA0; ;Line 7<br>
<br>
Well, that was much longer than I expected it to be I will leave you with the code I use to draw text to the Name Table with a few examples of text I write in my game.<br>
<br>
;Loading Code into Buffer Variables during main code (not during NMI)<br>
&#xA0;&#xA0;&#xA0; LDA #LOW(Hit1Text)&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;Load &apos;HIT 1&apos; into TextPointer<br>
&#xA0;&#xA0; &#xA0;STA TextPointer<br>
&#xA0;&#xA0; &#xA0;LDA #HIGH(Hit1Text)<br>
&#xA0;&#xA0; &#xA0;STA TextPointer+1<br>
<br>
&#xA0;&#xA0; &#xA0;LDA #$05&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&apos;HIT 1&apos; is 5 characters long<br>
&#xA0;&#xA0; &#xA0;STA TEXTLENGTH&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;The length of the text being written to the screen (number of characters being written)<br>
<br>
&#xA0;&#xA0; &#xA0;LDA #$6F&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Write to PPU Address $206F (On the Name Table)<br>
&#xA0;&#xA0; &#xA0;STA TEXTLOWBYTE &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0;&#xA0; &#xA0;LDA #$20<br>
&#xA0;&#xA0; &#xA0;STA TEXTHIGHBYTE<br>
<br>
&#xA0; INC LoadTextFlag&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Enable the Load Text Routine<br>
<br>
;Call this during NMI<br>
&#xA0;&#xA0; &#xA0;JSR LoadText&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Jump to Subroutine LoadText<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br>
LoadText:<br>
&#xA0; LDA LoadTextFlag<br>
&#xA0; BEQ LoadTextDone<br>
<br>
&#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; read PPU status to reset the high/low latch<br>
&#xA0; LDA TEXTHIGHBYTE<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $2000 address (Name Table)<br>
&#xA0; LDA TEXTLOWBYTE<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $2000 address (Name Table)<br>
&#xA0; LDY #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start out at 0<br>
<br>
LoadTextLoop:<br>
&#xA0; LDA [TextPointer], y&#xA0;&#xA0;&#xA0;&#xA0; ; load data from address (background + the value in y)<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write to PPU<br>
&#xA0; INY&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Y = Y + 1<br>
&#xA0; CPY TEXTLENGTH&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare Y to value in TEXTLENGTH<br>
&#xA0; BNE LoadTextLoop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Branch to LoadTextLoop if compare was Not Equal to TEXTLENGTH<br>
LoadTextDone:<br>
&#xA0; RTS<br>
&#xA0;<br>
;;;;;<br>
BlankTiles:<br>
&#xA0; .db $24,$24,$24,$24,$24,$24,$24,$24&#xA0; &#xA0;<br>
MissText:<br>
&#xA0; .db $16,$12,$1C,$1C&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;MISS<br>
Hit1Text:<br>
&#xA0; .db $11,$12,$1D,$24,$01&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;HIT 1<br>
Hit2Text:<br>
&#xA0; .db $11,$12,$1D,$24,$02&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;HIT 2<br>
Hit3Text:<br>
&#xA0; .db $11,$12,$1D,$24,$03&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;HIT 3<br>
Owned:<br>
&#xA0; .db $18,$20,$17,$0e,$0d&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;OWNED<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__800">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				May 20, 2016 at 2:55:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					ahh okay! 
<br>
<br>This helped close the gap for sure- so I&apos;d only really use the bank swapping if I Was getting into an egregious amount of information? I see in MRN&apos;s examples he uses NROM with CHR RAM to animate blocks- The reason it confused me mostly was because I was trying to think about how in EB zero, the text boxes pop up but the background never changes- using FCEUXD I saw that it just tends tend to switch out partial data quite a bit!
<br>
<br>Thank you very much for the help!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__801">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 20, 2016 at 3:31:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>RockyHardwood</b></i><br>
<br>
ahh okay!<br>
<br>
This helped close the gap for sure- so I&apos;d only really use the bank swapping if I Was getting into an egregious amount of information? I see in MRN&apos;s examples he uses NROM with CHR RAM to animate blocks- The reason it confused me mostly was because I was trying to think about how in EB zero, the text boxes pop up but the background never changes- using FCEUXD I saw that it just tends tend to switch out partial data quite a bit!<br>
<br>
Thank you very much for the help!</div>
Duck Tales 2 does this as well. They actually do it in small chunks so they don&apos;t have to turn the screen off.<br>
<br>
Not sure how others do it, but with text boxes, as far as not changing the background, set aside some space in RAM and keep a live copy of the current background. Then pull the data from RAM and write it back to the PPU in small chunks of tiles (1 line at a time).<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__802">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 20, 2016 at 3:38:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>RockyHardwood</b></i><br>
<br>
ahh okay!<br>
<br>
This helped close the gap for sure- so I&apos;d only really use the bank swapping if I Was getting into an egregious amount of information? I see in MRN&apos;s examples he uses NROM with CHR RAM to animate blocks- The reason it confused me mostly was because I was trying to think about how in EB zero, the text boxes pop up but the background never changes- using FCEUXD I saw that it just tends tend to switch out partial data quite a bit!<br>
<br>
Thank you very much for the help!</div>
Duck Tales 2 does this as well. They actually do it in small chunks so they don&apos;t have to turn the screen off.<br>
<br>
Not sure how others do it, but with text boxes, as far as not changing the background, set aside some space in RAM and keep a live copy of the current background. Then pull the data from RAM and write it back to the PPU in small chunks of tiles (1 line at a time).<br>
<br>
&#xA0;</div>
<br>
<br>
When I say RAM, I mean CPU RAM. This is a good way to organize it.<br>
<br>
&#xA0; .rsset $0000<br>
;All zero page variables<br>
<br>
.rsset $0100<br>
;RAM reserved for the stack<br>
<br>
.rsset $0200<br>
;RAM reserved for Character Sprites<br>
<br>
.rsset $0300<br>
;RAM reseved for Music Variables<br>
<br>
.rsset $0400-$07FF<br>
;Available RAM to use to store data that doesn&apos;t need to be in the Zero Page. Good place to store copies of Name Tables and Attribute Tables<br>
<br>
<img src original-src="http://www.nesmuseum.com/images/cpumemmap.png" show-src="scraper/images/cpumemmap.png"><br>
If you are in a pinch and your game doesn&apos;t use saves, it is my understanding you can borrow the WRAM area as well, $6000.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__803">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				May 20, 2016 at 4:19:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					From what I saw in EBZ, half of the background is reserved for text while the top half is reserved for the background information- which explains why the game is pretty minimal visual wise. the space between populated areas gives the game enough time to swap out any info. It also explains the simple tiling of old RPG&apos;s as well.
<br>
<br>and because it&apos;s the one with the most coverage and tutorials on the forum, is using MMC1 much different than using UNROM? I&apos;ve seen UNROM mentioned but I don&apos;t see much about coding it, at least for NESASM.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__804">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 20, 2016 at 4:27:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>RockyHardwood</b></i><br>
<br>
From what I saw in EBZ, half of the background is reserved for text while the top half is reserved for the background information- which explains why the game is pretty minimal visual wise. the space between populated areas gives the game enough time to swap out any info. It also explains the simple tiling of old RPG&apos;s as well.<br>
<br>
and because it&apos;s the one with the most coverage and tutorials on the forum, is using MMC1 much different than using UNROM? I&apos;ve seen UNROM mentioned but I don&apos;t see much about coding it, at least for NESASM.</div>
The main difference is how you call a bank switch. I don&apos;t remember all the details of MMC1 (I think I stated MMC3 earlier, but you are right, the tutorial is MMC1).&#xA0; I think the layout is pretty similar.<br>
<br>
This is where I learned about UNROM. It&apos;s not in NESASM format, but the general idea is there.<br>
<a href="http://wiki.nesdev.com/w/index.php/Programming_UNROM" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/Programming_UNROM">http://wiki.nesdev.com/w/index.ph...</a><br>
<br>
<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__805">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Jun 12, 2016 at 6:03:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
The main difference is how you call a bank switch. I don&apos;t remember all the details of MMC1 (I think I stated MMC3 earlier, but you are right, the tutorial is MMC1).&#xA0; I think the layout is pretty similar.<br>
<br>
This is where I learned about UNROM. It&apos;s not in NESASM format, but the general idea is there.<br>
<a href="http://wiki.nesdev.com/w/index.php/Programming_UNROM" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/Programming_UNROM">http://wiki.nesdev.com/w/index.php/Programming_UNROM</a><br>
&#xA0;</div>
So I&apos;m looking into this now, the bank swapping with CHR RAM with UNROM... and I had a couple questions!<br>
<br>
For The versitility I&apos;m looking for, I know I&apos;m going to want UNROM for certain projects. when I first learned how to do the CHR RAM and partial bank swapping, I leaned that when you up the inesprg value in the header, you have to rearrange your banks or it won&apos;t work. I&apos;m a little fuzzy on how banks are supposed to be &quot;ordered&quot;, especially in a situaltion such as this when most of the banks have the same addresses, and I&apos;m dealing with 8 instead of 2. even with only 2 I&apos;m really lost! what&apos;s a good way to remember how to set up my banks in code, and what would the proper ines header be (since the nesdev site is in NES 2.0)?<br>
<br>
speaking of the header, in a game where I&#xA0;<em>didn&apos;t&#xA0;</em>use a mapper, how many banks can I use in the header? I suppose, as you can have 4 8kb banks, or 2 16kb banks, you can only have up to that with no mapper.<br>
<br>
I know with CHR ROM mappers such it CNROM, it can switch current chr data used by the PPU immediately. is UNROM capable of the same thing? I assume not with how the data is written. I also see in the NES dev page that you can swap to something with music engines and back. would swapping to the sound engine, playing the sound, and swapping back , keep the sound playing, or would the swapping back of code change things? again, I assume since the APU is a separate entity much like the PPU, it would keep playing regardless.<br>
<br>
you mentioned in the post about variables the ones in the $0400-$07FF range. I&apos;d like to store things there, but I&apos;m still not exactly sure what needs to be on the zero page or not. I know pointers do, anything else?<br>
<br>
slightly unrelated, I know that for scrolling you can use one large nametable, but most name table editors are only one screen big. Is it common to save name tables separately, or buffer and scroll off of one, seamed together nametable? if so, what&apos;s the easiest way to do that?<br>
<br>
thanks!<br>
<br>
EDIT: and what&apos;s the difference between having 256KB of PRG ROM an d128KB of CHR RAM if they&apos;re all in the same code, for something like MMC1? bank differences?<br>
EDIT EDIT: looking a littlf further in the nerdy nights for MMC1, I assume &quot;seaming&quot; the names tables together is done by including some sort of indicator of the name tables in either diection from the one you&apos;re in, and switching between which tables you&apos;re writing from in tandem with the changes in mirroring? can UNROM do that too?<br>
<br>
&#xA0;<br>
<br>
<br>
<br>
<br>
<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__806">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jun 12, 2016 at 9:38:38 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>RockyHardwood</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
The main difference is how you call a bank switch. I don&apos;t remember all the details of MMC1 (I think I stated MMC3 earlier, but you are right, the tutorial is MMC1).&#xA0; I think the layout is pretty similar.<br>
<br>
This is where I learned about UNROM. It&apos;s not in NESASM format, but the general idea is there.<br>
<a href="http://wiki.nesdev.com/w/index.php/Programming_UNROM" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/Programming_UNROM">http://wiki.nesdev.com/w/index.php/Programming_UNROM</a><br>
&#xA0;</div>
So I&apos;m looking into this now, the bank swapping with CHR RAM with UNROM... and I had a couple questions!<br>
<br>
For The versitility I&apos;m looking for, I know I&apos;m going to want UNROM for certain projects. when I first learned how to do the CHR RAM and partial bank swapping, I leaned that when you up the inesprg value in the header, you have to rearrange your banks or it won&apos;t work. I&apos;m a little fuzzy on how banks are supposed to be &quot;ordered&quot;, especially in a situaltion such as this when most of the banks have the same addresses, and I&apos;m dealing with 8 instead of 2. even with only 2 I&apos;m really lost! what&apos;s a good way to remember how to set up my banks in code, and what would the proper ines header be (since the nesdev site is in NES 2.0)?<br>
<br>
speaking of the header, in a game where I&#xA0;<em>didn&apos;t&#xA0;</em>use a mapper, how many banks can I use in the header? I suppose, as you can have 4 8kb banks, or 2 16kb banks, you can only have up to that with no mapper.<br>
<br>
I know with CHR ROM mappers such it CNROM, it can switch current chr data used by the PPU immediately. is UNROM capable of the same thing? I assume not with how the data is written. I also see in the NES dev page that you can swap to something with music engines and back. would swapping to the sound engine, playing the sound, and swapping back , keep the sound playing, or would the swapping back of code change things? again, I assume since the APU is a separate entity much like the PPU, it would keep playing regardless.<br>
<br>
you mentioned in the post about variables the ones in the $0400-$07FF range. I&apos;d like to store things there, but I&apos;m still not exactly sure what needs to be on the zero page or not. I know pointers do, anything else?<br>
<br>
slightly unrelated, I know that for scrolling you can use one large nametable, but most name table editors are only one screen big. Is it common to save name tables separately, or buffer and scroll off of one, seamed together nametable? if so, what&apos;s the easiest way to do that?<br>
<br>
thanks!<br>
<br>
EDIT: and what&apos;s the difference between having 256KB of PRG ROM an d128KB of CHR RAM if they&apos;re all in the same code, for something like MMC1? bank differences?<br>
EDIT EDIT: looking a littlf further in the nerdy nights for MMC1, I assume &quot;seaming&quot; the names tables together is done by including some sort of indicator of the name tables in either diection from the one you&apos;re in, and switching between which tables you&apos;re writing from in tandem with the changes in mirroring? can UNROM do that too?<br>
&#xA0;</div>
This is a very long document, but there is a great section about headers and mappers.<br>
<a href="downloads/missing/neshdr20.txt" target="_blank" original-href="https://github.com/thentenaar/nesasm/blob/master/documentation/neshdr20.txt">https://github.com/thentenaar/nes...</a><br>
<br>
I&apos;m going to try to answer some of this with sleep depervation. Seems to be a lot of thinking out loud questions in this post. Hopefully I hit them all.<br>
<strong>what&apos;s a good way to remember how to set up my banks in code, and what would the proper ines header be</strong><br>
I use that link I posted above. A lot of this is still fuzzy to me as well. I don&apos;t know if I will ever fully understand mappers as each one handles banks and bankswitches differently.<strong> </strong><br>
speaking of the header, in a game where I&#xA0;<em>didn&apos;t&#xA0;</em>use a mapper, how many banks can I use in the header? I suppose, as you can have 4 8kb banks, or 2 16kb banks, you can only have up to that with no mapper.<br>
<br>
<strong>I&apos;m a little fuzzy on how banks are supposed to be &quot;ordered&quot;, especially in a situaltion such as this when most of the banks have the same addresses, and I&apos;m dealing with 8 instead of 2.</strong><br>
Let&apos;s say that you have 8 16kb banks (like what I use with UNROM). I have mine set up to have $8000-$BFFF to be the part of memory that I can swap, $C000-$FFFF is fixed (can&apos;t be swapped). So, any important code like IRQ&apos;s and NMI and my game engine stay in the fixed bank.<br>
With that in mind, that means you can setup multiple 8kb banks with .org $8000 and .org $A000. Like this:<br>
;----------------------------------------------------------<br>
;-----------------------BANKS------------------------------<br>
;----------------------------------------------------------<br>
;;;;;;;;;;;;;;;;;bankSource=00;;;;;;;;;;;;;;;;;;;;&#xA0;&#xA0; 16KB Swappable<br>
&#xA0; .bank 0&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; ;8KB &#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0; .org $8000 &#xA0;<br>
&#xA0;<br>
&#xA0; .bank 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;8KB<br>
&#xA0; .org $A000<br>
;;;;;;;;;;;;;;;;;bankSource=01;;;;;;;;;;;;;;;;;;;;<br>
&#xA0; .bank 2&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; .org $8000<br>
&#xA0;&#xA0;&#xA0;<br>
&#xA0; .bank 3<br>
&#xA0; .org $A000<br>
;;;;;;;;;;;;;;;;;bankSource=02;;;;;;;;;;;;;;;;;;;; &#xA0;<br>
&#xA0; .bank 4&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; .org $8000<br>
<br>
&#xA0; .bank 5<br>
&#xA0; .org $A000<br>
;;;;;;;;;;;;;;;;;bankSource=03;;;;;;;;;;;;;;;;;;;;<br>
&#xA0; .bank 6&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; .org $8000<br>
&#xA0;<br>
&#xA0; .bank 7<br>
&#xA0; .org $A000<br>
&#xA0; ;;;;;;;;;;;;;;;;;bankSource=04;;;;;;;;;;;;;;;;;;;;<br>
&#xA0; .bank 8&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; .org $8000<br>
<br>
&#xA0; .bank 9<br>
&#xA0; .org $A000<br>
<br>
;;;;;;;;;;;;;;;;;bankSource=05;;;;;;;;;;;;;;;;;;;;<br>
&#xA0; .bank 10&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; .org $8000<br>
<br>
&#xA0; .bank 11<br>
&#xA0; .org $A000<br>
&#xA0;<br>
;;;;;;;;;;;;;;;;;bankSource=06;;;;;;;;;;;;;;;;;;;;<br>
&#xA0; .bank 12&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; .org $8000<br>
<br>
&#xA0; .bank 13<br>
&#xA0; .org $A000<br>
<br>
;;;;;;;;;;;;;;;;;bankSource=07;;;;;;;;;;;;;;;;;;;;<strong>&#xA0; FIXED</strong><br>
&#xA0; .bank 14 &#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0; .org $C000<br>
<br>
&#xA0; .bank 15<br>
&#xA0; .org $E000<br>
<br>
So, the when I start my program, I tell it to bankswap to bank 0. This mean that my current setup looks like this:<br>
;;;;;;;;;;;;;;;;;bankSource=00;;;;;;;;;;;;;;;;;;;;&#xA0;&#xA0; 16KB Swappable<br>
&#xA0; .bank 0&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; ;8KB &#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0; .org $8000 &#xA0;<br>
&#xA0;<br>
&#xA0; .bank 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;8KB<br>
&#xA0; .org $A000<br>
;;;;;;;;;;;;;;;;;bankSource=07;;;;;;;;;;;;;;;;;;;;<strong>&#xA0; FIXED</strong><br>
&#xA0; .bank 14 &#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0; .org $C000<br>
<br>
&#xA0; .bank 15<br>
&#xA0; .org $E000<br>
<br>
Now, let&apos;s say I need to get some code in .bank 8. I would then bankswap to the 16kb bank 4 (designated as bankSource 4 in my code). When that happens, my memory now looks like this:<br>
;;;;;;;;;;;;;;;;;bankSource=04;;;;;;;;;;;;;;;;;;;;<br>
&#xA0; .bank 8&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; .org $8000<br>
<br>
&#xA0; .bank 9<br>
&#xA0; .org $A000<br>
;;;;;;;;;;;;;;;;;bankSource=07;;;;;;;;;;;;;;;;;;;;<strong>&#xA0; FIXED</strong><br>
&#xA0; .bank 14 &#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0; .org $C000<br>
<br>
&#xA0; .bank 15<br>
&#xA0; .org $E000<br>
<br>
All you are doing on a bank swap is pointing to different areas in memory. Since I have 8 banks that are 16KB, I have 128KB of PRG storage. All bankswapping is doing is telling the program to point to a different point in storage to get the data for $8000-$BFFF. Think of it like shelves. You have 8 shelves but you can only use 2 at a time. The bottom shelf you must always use (fixed banl). So, you can now freely use 1 of the other 7 shelves (swappable). If the stuff you need is on another shelf, you simply stop using the one shelf and start focusing on the other shelf. Lame example, but I hope the visual helps.<br>
<br>
<strong>speaking of the header, in a game where I&#xA0;<em>didn&apos;t&#xA0;</em>use a mapper, how many banks can I use in the header? I suppose, as you can have 4 8kb banks, or 2 16kb banks, you can only have up to that with no mapper.</strong><br>
You answered your own question here. No Mapper = No Bank Swapping. So, you only have 32kb on ROM space to work with. Bank swapping removes this limitation and allows you swap data in and out of the the CPU registers $8000-$FFFA (PRG). Some mappers allow you to swap CHR data on the PPU during an interrupt<strong> </strong>(CHR-ROM).<br>
<br>
<strong>I know with CHR ROM mappers such it CNROM, it can switch current chr data used by the PPU immediately. is UNROM capable of the same thing?</strong><br>
No. UNROM uses CHR-RAM, so you store the tiles in PRG-RAM and then you have to copy that tiles to CHR-ROM during a vblank. If you are swapping out a large amount of tile (more than ~32), then you need to disable the PPU (turn the screen off).<br>
<br>
<strong>I also see in the NES dev page that you can swap to something with music engines and back. would swapping to the sound engine, playing the sound, and swapping back , keep the sound playing, or would the swapping back of code change things?</strong><br>
Correct. You can store all of you music data in 1 bank. Your music engine only calls for 1 note to be played per frame, so you can call for that data by swapping in that bank, run your music note updating code (in the nmi), and then swap away from that bank with the music code. I know exactly what nesdev page you are talking about, its a great resource.<br>
<br>
<strong>you mentioned in the post about variables the ones in the $0400-$07FF range. I&apos;d like to store things there, but I&apos;m still not exactly sure what needs to be on the zero page or not. I know pointers do, anything else?</strong><br>
This still confuses me a bit, but usually I use the Zero Page for variables that I need to call quickly (with PPU on) and for pointers. Honestly, most of my variables are in Zero Page. I use $0400-$07FF to store large amounts of data that I can call when the PPU is off, such as a copy of my current attribute table, copy of my current palette table, name table code (great for storing data that was on the screen before a popup window so you know what data was in that area for when you want the window to go away), history code (something happened 3 turns ago but i want to remember it just in case, etc.<br>
<br>
<br>
<strong>slightly unrelated, I know that for scrolling you can use one large nametable, but most name table editors are only one screen big. Is it common to save name tables separately, or buffer and scroll off of one, seamed together nametable? if so, what&apos;s the easiest way to do that?</strong><br>
No idea, I have never attempted scolling. Hopefully someone else can help you with this.<br>
<br>
<strong>and what&apos;s the difference between having 256KB of PRG ROM an d128KB of CHR RAM if they&apos;re all in the same code, for something like MMC1? bank differences?</strong><br>
In MMC1, those are not in the same code. I could be way off on this, but if I understand MMC1 correctly, Its PRG ROM and CHR ROM. This is the example of if you are swapping CHR data, you can animate backgrounds. You can&apos;t do that with UNROM.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__807">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 19, 2016 at 11:57:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi all,<br>
<br>
I have a <em>generic</em> (not specifically related nor limited only to these examples below) question for people with more experience than I have coding in assembly. I often find myself in a scenario where, wasting some ROM space in lookup tables, I can make the code way faster, clear to read (avoiding jumps to subroutines), and more unlikely to have logic flaws (assuming that the data in the lookup tables is correct, it can&apos;t be buggy). So, when a routine is often needed within a program, I pretty often reduce it to a lookup table, if this is easily possible. Also because more complex code wastes some space in more instructions anyways. In few words, I do the math myself, instead of relying on the processor to do it. It is this choice common in assembly, or it is basically a wrong way to code?<br>
<br>
Thanks to anyone can give an answer. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
<br>
Example 1 (!pseudocode: for clearity no #$ on HEX numbers, .byte, ...):
<pre>;   00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f value in hex
 x4 00 04 08 0c 10 14 18 1c 20 24 28 2c 30 34 38 3c ; 00 to 0f
    40 44 48 4c 50 54 58 5c 60 64 68 6c 70 74 78 7c ; 10 to 1f
    80 84 88 8c 90 94 98 9c a0 a4 a8 ac b0 b4 b8 bc ; 20 to 2f
    c0 c4 c8 cc d0 d4 d8 dc e0 e4 e8 ec f0 f4 f8 fc ; 30 to 3f<br><br>; y = x * 4<br><br>ldy x4,x<br><br>; no need for txa asl a asl a tay, so the value in a is unchanged
; it takes only 4 or 5 cycles, the lookup table wastes 64Bytes</pre>
Example 2 (!pseudocode: for clearity no #$ on HEX numbers, .byte, ...):<br><br><pre>;   00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f value in hex
sqr 00 01 01 01 02 02 02 02 02 03 03 03 03 03 03 03 ; 00 to 0f
    04 04 04 04 04 04 04 04 04 05 05 05 05 05 05 05 ; 10 to 1f
    05 05 05 05 06 06 06 06 06 06 06 06 06 06 06 06 ; 20 to 2f
    06 07 07 07 07 07 07 07 07 07 07 07 07 07 07 07 ; 30 to 3f
    08 08 08 08 08 08 08 08 08 08 08 08 08 08 08 08 ; 40 to 4f
    08 09 09 09 09 09 09 09 09 09 09 09 09 09 09 09 ; 50 to 5f
    09 09 09 09 0a 0a 0a 0a 0a 0a 0a 0a 0a 0a 0a 0a ; 60 to 6f
    0a 0a 0a 0a 0a 0a 0a 0a 0a 0b 0b 0b 0b 0b 0b 0b ; 70 to 7f
    0b 0b 0b 0b 0b 0b 0b 0b 0b 0b 0b 0b 0b 0b 0b 0b ; 80 to 8f
    0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c ; 90 to 9f
    0c 0c 0c 0c 0c 0c 0c 0c 0c 0d 0d 0d 0d 0d 0d 0d ; a0 to af
    0d 0d 0d 0d 0d 0d 0d 0d 0d 0d 0d 0d 0d 0d 0d 0d ; b0 to bf
    0d 0d 0d 0d 0e 0e 0e 0e 0e 0e 0e 0e 0e 0e 0e 0e ; c0 to cf
    0e 0e 0e 0e 0e 0e 0e 0e 0e 0e 0e 0e 0e 0e 0e 0e ; d0 to df
    0e 0f 0f 0f 0f 0f 0f 0f 0f 0f 0f 0f 0f 0f 0f 0f ; e0 to ef
    0f 0f 0f 0f 0f 0f 0f 0f 0f 0f 0f 0f 0f 0f 0f 0f ; f0 to ff<br><br>; a = square root of a<br><br>tax
lda sqr,x<br><br>; it takes only 6 or 7 cycles, the lookup table wastes 256Bytes
; routines for square roots are pretty long anyways</pre>
Then of course, if the square root of 16 bits numbers was needed, then it would be necessary to use something like this:<br><br><pre>           ; Example 5-14.  Simple 16-bit square root.
           ;
           ; Returns the 8-bit square root in $20 of the
           ; 16-bit number in $20 (low) and $21 (high). The
           ; remainder is in location $21.
           
           sqrt16  LDY #$01     ; lsby of first odd number = 1
                   STY $22
                   DEY
                   STY $23      ; msby of first odd number (sqrt = 0)
           again   SEC
                   LDA $20      ; save remainder in X register
                   TAX          ; subtract odd lo from integer lo
                   SBC $22
                   STA $20
                   LDA $21      ; subtract odd hi from integer hi
                   SBC $23
                   STA $21      ; is subtract result negative?
                   BCC nomore   ; no. increment square root
                   INY
                   LDA $22      ; calculate next odd number
                   ADC #$01
                   STA $22
                   BCC again
                   INC $23
                   JMP again
            nomore STY $20      ; all done, store square root
                   STX $21      ; and remainder
                   RTS</pre>
Source (with <em>really nice</em> explanation, reading advised!): <a href="http://www.dwheeler.com/6502/oneelkruns/asm1step.html" target="_blank" original-href="http://www.dwheeler.com/6502/oneelkruns/asm1step.html">http://www.dwheeler.com/6502/onee...</a><br>
<br>
***<br>
<br>
Post #777! <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__808">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Jun 20, 2016 at 12:05:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					LUTs likely the most common speed optimization, widely used everywhere from oldest to modern platforms, especially when memory/storage is cheap. Obviosuly, if you don&apos;t need speed, there is no need to optimize for it.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__809">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jun 20, 2016 at 12:13:05 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I usually choose what to do based on how much rom spacei have in my main code bank and what else i have going on. If i have plenty of cpu, then i use jumps and let the cpu do the math. I also sometimes just use lookup tables if i plan on adding many more options to the routine down the line. Easier to add a number to a lookup table rather than added a bunch more code and trying to rremember what i did to make it work weeks ago.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__810">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jun 20, 2016 at 9:08:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					These guys have it.  It&apos;s not a clear cut answer.  It depends on the situation and whether you&apos;re going to be doing a lot of editing/debugging.  
<br>
<br>If you have ROM limits, use the CPU intensive deal.  And vice versa.  I usually run into ROM before CPU, but you never know.  
<br>
<br>Although sometimes I like to code things just to see if I can do it!!  Keeps it fun.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__811">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 20, 2016 at 10:40:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Shiru</b></i><br>
<br>
LUTs likely the most common speed optimization, widely used everywhere from oldest to modern platforms, especially when memory/storage is cheap. Obviosuly, if you don&apos;t need speed, there is no need to optimize for it.</div><br><br><div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
I usually choose what to do based on how much rom spacei have in my main code bank and what else i have going on. If i have plenty of cpu, then i use jumps and let the cpu do the math. I also sometimes just use lookup tables if i plan on adding many more options to the routine down the line. Easier to add a number to a lookup table rather than added a bunch more code and trying to rremember what i did to make it work weeks ago.</div><br><br><div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br>
These guys have it. It&apos;s not a clear cut answer. It depends on the situation and whether you&apos;re going to be doing a lot of editing/debugging.<br>
If you have ROM limits, use the CPU intensive deal. And vice versa. I usually run into ROM before CPU, but you never know.<br>
Although sometimes I like to code things just to see if I can do it!! Keeps it fun.</div>
<br>
Thank you all. Appreciated.<br>
The answer seems like in many things in coding: <em>it depends</em>.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__812">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jun 20, 2016 at 11:03:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you know how to use mappers then ROM space is almost never the limit.  512KB holds TONS of tables!  I have used Excel to generate movement tables in many of my games.  See pinball title screen videos  <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__813">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jun 21, 2016 at 12:14:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br>
<br>
If you know how to use mappers then ROM space is almost never the limit. 512KB holds TONS of tables! I have used Excel to generate movement tables in many of my games. See pinball title screen videos <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span></div>
<br>
My issue is, I get picky about keeping certain code in certain banks instead of just moving it. Sort of an oraganizational thing. But, that&apos;s just personal preference.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__814">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jun 21, 2016 at 12:20:32 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I burn rom like it&apos;s going out of style (since small rom sizes have and all, you know).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__815">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jun 21, 2016 at 12:22:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					My goal is to constantly code as inefficiently as possible. And I usually succeed!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__816">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Jun 21, 2016 at 1:17:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I use lots of luts and burn plenty of rom space. If your game works and plays well you did it right. Whether or not you made things easy for yourself is an entirely different matter, but as long as you are enjoying what you&apos;re doing, how you&apos;re doing it and achieving your goals, it&apos;s right. If not, learn some new tricks.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__817">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jun 21, 2016 at 1:20:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I used to do everything as efficiently as possible in terms of rom, until I tried doing things as efficiently as possible in terms of speed. One of those can be expanded, and not the other, so you can guess which wins these days. It all depends on the project though, and what is needed.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__818">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Jun 21, 2016 at 1:51:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
My goal is to constantly code as inefficiently as possible. And I usually succeed!</div>
This is just to keep those reverse engineering dickholes off your <span class="sprites_emoticons absmiddle" id="emo_teabag">&#xA0;</span>. &#xA0;<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__819">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jun 21, 2016 at 8:48:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I agree on the fact that speed (and an easy to follow logic into the code) is often the priority above ROM space.
<br>Also, since the game data LOTs will usually fill up most of the ROM space anyways, wasting few hundreads of bytes in few code auxiliary LOT, won&apos;t make a big difference.
<br>I was just wondering if, in some cases, even other more experienced programmers use lookup tables as well for such purposes.
<br>Thanks everyone for the answers.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__820">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jun 30, 2016 at 11:15:30 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So, I&apos;ve done the research, I know the issue, I have fixed the problem but I would like to know if there is a better way. Basically, I&apos;m running into wrap-around when accessing pointer tables when the loading variable reaches $80. When I &apos;ASL A&apos; the value, it wraps-around to $00 and starts my dialog back over from the beginning of the game. Here is the problem code when CutSceneCounter = $80<br>
<br>
&#xA0;&#xA0;&#xA0; LDA CutSceneCounter &#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;Load A with $80<br>
&#xA0;&#xA0; &#xA0;ASL A&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply $80 by two = $00<br>
&#xA0;&#xA0; &#xA0;TAX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;write $00 to X<br>
&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;<br>
&#xA0;&#xA0; &#xA0;LDA CutSceneDialog,x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Load the CutSceneDialog,$00<br>
&#xA0;&#xA0; &#xA0;STA CutScenePointer&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Store in Pointer Low<br>
&#xA0;&#xA0; &#xA0;LDA CutSceneDialog+1,x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Load the CutSceneDialog+1,$00<br>
&#xA0;&#xA0; &#xA0;STA CutScenePointer+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Store in Pointer High<br>
&#xA0;&#xA0; ;Rest of code until RTS<br>
<br>
<br>
CutSceneDialog:<br>
&#xA0;&#xA0; &#xA0;;cutscene 1<br>
&#xA0;&#xA0; &#xA0;.word dialog00,dialog01,dialog02,dialog03,dialog04,dialog05,dialog06,dialog07,dialog08,dialog09<br>
&#xA0;&#xA0; &#xA0;;cutscene 2<br>
&#xA0;&#xA0; &#xA0;.word dialog0A,dialog0B,dialog0C,dialog0D,dialog0E,dialog0F,dialog10,dialog11<br>
&#xA0;&#xA0; &#xA0;;cutscene 3<br>
&#xA0;&#xA0; &#xA0;.word dialog12,dialog13,dialog14,dialog15,dialog16,dialog17,dialog18,dialog19<br>
&#xA0;&#xA0; &#xA0;;cutscene 4<br>
&#xA0;&#xA0; &#xA0;.word dialog1A,dialog1B,dialog1C,dialog1D,dialog1E,dialog1F,dialog20,dialog21,dialog22,dialog23&#xA0;&#xA0; &#xA0;<br>
&#xA0;&#xA0; &#xA0;;cutscene 5<br>
&#xA0;&#xA0; &#xA0;.word dialog24,dialog25,dialog26,dialog27,dialog28,dialog29,dialog2A,dialog2B,dialog2C,dialog2D,dialog2E,dialog2F<br>
&#xA0;&#xA0; &#xA0;;cutscene 6<br>
&#xA0;&#xA0; &#xA0;.word dialog30,dialog31,dialog32,dialog33,dialog34,dialog35,dialog36,dialog37,dialog38,dialog39,dialog3A,dialog3B,dialog3C,dialog3D,dialog3E,dialog3F<br>
&#xA0;&#xA0; &#xA0;.word dialog40,dialog41,dialog42,dialog43,dialog44,dialog45,dialog46,dialog47<br>
&#xA0;&#xA0; &#xA0;;cutscene 7<br>
&#xA0;&#xA0; &#xA0;.word dialog48,dialog49,dialog4A,dialog4B,dialog4C,dialog4D,dialog4E,dialog4F,dialog50,dialog51<br>
&#xA0;&#xA0; &#xA0;;cutscene 8<br>
&#xA0;&#xA0; &#xA0;.word dialog52,dialog53,dialog54,dialog55,dialog56,dialog57,dialog58,dialog59,dialog5A,dialog5B,dialog5C,dialog5D,dialog5E,dialog5F<br>
&#xA0;&#xA0; &#xA0;.word dialog60,dialog61,dialog62,dialog63,dialog64,dialog65,dialog66,dialog67,dialog68,dialog69,dialog6A,dialog6B,dialog6C,dialog6D,dialog6E,dialog6F<br>
&#xA0;&#xA0; &#xA0;.word dialog70,dialog71,dialog72,dialog73,dialog74,dialog75,dialog76,dialog77<br>
&#xA0;&#xA0; &#xA0;;cutscene end<br>
&#xA0;&#xA0; &#xA0;.word dialog78,dialog79,dialog7A,dialog7B,dialog7C,dialog7D,dialog7E,dialog7F<br>
&#xA0;&#xA0;&#xA0; ;Start of Issue<br>
&#xA0;&#xA0; &#xA0;.word dialog80,dialog81,dialog82,dialog83,dialog84,dialog85,dialog86,dialog87,dialog88,dialog89<br>
<br>
As you can see, this results in the pointer looking at dialog00 in the table instead of dialog80.<br>
******<br>
This was my quick and easy solution:<br>
&#xA0;&#xA0;&#xA0; LDA CutSceneCounter &#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;Load A with $80<br>
&#xA0;&#xA0; &#xA0;ASL A&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;multiply $80 by two = $00<br>
&#xA0;&#xA0; &#xA0;TAX&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;write $00 to X<br>
&#xA0;&#xA0;&#xA0; BCS&#xA0;&#xA0; .table2&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;If carry flag was set, branch to table 2 (Carry flag is set when CutSceneCounter is $80-$FF)<br>
&#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;<br>
&#xA0;&#xA0; &#xA0;LDA CutSceneDialog,x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Load the CutSceneDialog,$00<br>
&#xA0;&#xA0; &#xA0;STA CutScenePointer&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Store in Pointer Low<br>
&#xA0;&#xA0; &#xA0;LDA CutSceneDialog+1,x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Load the CutSceneDialog+1,$00<br>
&#xA0;&#xA0; &#xA0;STA CutScenePointer+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Store in Pointer High<br>
&#xA0; &#xA0; JMP .tabledone&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;skip over loading from table2<br>
<br>
&#xA0;&#xA0;&#xA0; .table2:<br>
&#xA0;&#xA0; &#xA0; &#xA0;&#xA0; LDA CutSceneDialog2,x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Load the CutSceneDialog2,$00<br>
&#xA0; &#xA0; &#xA0; &#xA0; STA CutScenePointer&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Store in Pointer Low<br>
&#xA0; &#xA0; &#xA0; &#xA0; LDA CutSceneDialog2+1,x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Load the CutSceneDialog2+1,$00<br>
&#xA0; &#xA0; &#xA0; &#xA0; STA CutScenePointer+1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Store in Pointer High&apos;<br>
&#xA0;&#xA0;&#xA0; .tabledone:<br>
&#xA0;&#xA0; ;Rest of code until RTS<br>
<br>
CutSceneDialog:<br>
&#xA0;&#xA0; .word dialog00-dialog7F ;(like in the table in the first coding example, just shortened to avoid Wall O&apos; Text)<br>
CutSceneDialog2:<br>
&#xA0;&#xA0; .word dialog80,dialog81,dialog82,dialog83,dialog84,dialog85,dialog86,dialog87,dialog88,dialog89<br>
<br>
Now I am looking at the 0 spot of CutSceneDialog2 table when the carry flag is set. Is this the best way to handle this or did I pretty much do all that I can do. I read a lot about Absolutes, but couldn&apos;t figure out how to apply that to this situation.<br>
<br>
Side Question, how can I put my code in those fancy code copy\paste friendly boxes in a post like bunnyboy does in Nerdy Nights? Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__821">
                                                        <div class="mdl-card__title"><strong>Broke Studio</strong> posted on 
		
			
				
				Jun 30, 2016 at 11:57:32 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Why not use two tables ? one for LSBs and one for MSBs.<br>
&#xA0;
<div style="background:#eee;border:1px solid #ccc;padding:5px 10px;">CutSceneDialogLo:<br>
;cutscene 1<br>
.byte&#xA0;<span style="line-height: 20.8px; background-color: rgb(238, 238, 238);">&lt;dialog00,&lt;dialog01,&lt;dialog02,&lt;dialog03,&lt;dialog04,&lt;dialog05,&lt;dialog06,&lt;dialog07,&lt;dialog08,&lt;dialog09</span><dialog00,<dialog01,<dialog02,<dialog03,<dialog04,<dialog05,<dialog06,<dialog07,<dialog08,<dialog09<br><br>
CutSceneDialogHi:<br>
;cutscene 1<br>
.byte &gt;dialog00,&gt;dialog01,&gt;dialog02,&gt;dialog03,&gt;dialog04,&gt;dialog05,&gt;dialog06,&gt;dialog07,&gt;dialog08,&gt;dialog09<br>
<br>
LDX CutSceneCounter ;Load X with $80<br>
LDA CutSceneDialogLo,x ;Load the CutSceneDialogLo,$80<br>
STA CutScenePointer+0 ;Store in Pointer Low<br>
LDA CutSceneDialogHi,x ;Load the CutSceneDialog+1,$80<br>
STA CutScenePointer+1 ;Store in Pointer High<br>
;Rest of code until RTS</dialog00,<dialog01,<dialog02,<dialog03,<dialog04,<dialog05,<dialog06,<dialog07,<dialog08,<dialog09<br></div>
<br>
edit : formatting
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__822">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jun 30, 2016 at 12:07:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I use tables within tables <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>. It requires a bunch of other variables and is probably slower, but for room indexing or dialog it works just fine.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__823">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jun 30, 2016 at 1:03:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>glutock</b></i><br>
<br>
Why not use two tables ? one for LSBs and one for MSBs.<br>
&#xA0;
<div style="background:#eee;border:1px solid #ccc;padding:5px 10px;">CutSceneDialogLo:<br>
;cutscene 1<br>
.byte&#xA0;<span style="line-height: 20.8px; background-color: rgb(238, 238, 238);"><dialog00,<dialog01,<dialog02,<dialog03,<dialog04,<dialog05,<dialog06,<dialog07,<dialog08,<dialog09< span><dialog00,<dialog01,<dialog02,<dialog03,<dialog04,<dialog05,<dialog06,<dialog07,<dialog08,<dialog09<br><br>
CutSceneDialogHi:<br>
;cutscene 1<br>
.byte &gt;dialog00,&gt;dialog01,&gt;dialog02,&gt;dialog03,&gt;dialog04,&gt;dialog05,&gt;dialog06,&gt;dialog07,&gt;dialog08,&gt;dialog09<br>
<br>
LDX CutSceneCounter ;Load X with $80<br>
LDA CutSceneDialogLo,x ;Load the CutSceneDialogLo,$80<br>
STA CutScenePointer+0 ;Store in Pointer Low<br>
LDA CutSceneDialogHi,x ;Load the CutSceneDialog+1,$80<br>
STA CutScenePointer+1 ;Store in Pointer High<br>
;Rest of code until RTS</dialog00,<dialog01,<dialog02,<dialog03,<dialog04,<dialog05,<dialog06,<dialog07,<dialog08,<dialog09<br></dialog00,<dialog01,<dialog02,<dialog03,<dialog04,<dialog05,<dialog06,<dialog07,<dialog08,<dialog09<></span></div>
<br>
edit : formatting</div>
<br>
Can you explain this a bit more. Will the &lt; &gt; signs work in NESASM or is there something else I have to do? Can&apos;t say I have ever used those before. That&apos;s going to be a good chunk of rom with 2 tables.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__824">
                                                        <div class="mdl-card__title"><strong>Broke Studio</strong> posted on 
		
			
				
				Jun 30, 2016 at 1:40:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					With NESASM, it seems that you have to use LOW(dialog00) and HIGH(dialog00) (maybe with a # before low/high, I never used NESASM).<br>
<br><br>
So you&apos;ll have one table for the low byte address of your label (here dialog00 for example) and on table for the high byte address.<br>
Using this method you can address 256 labels instead of 128 with &apos;word&apos;.<br>
<br><br>
Of course it will eat more rom space.<br>
<br><br>
As SoleGooseProductions said, you can also use sub-tables depending on your level / chapter or whatever you call this.<br>
<br><br>
Example :<br>
<blockquote>
level1Dialogs:<br>
    .word cutSceneDialog00,cutSceneDialog01<br>
<br><br>
level2Dialogs:<br>
    .word cutSceneDialog00,cutSceneDialog01<br>
<br><br>
etc ...
</blockquote>
You can have up to 128 dialogs per level with this method.<br><br>But you can also add the low/high method and have 256 dialogs per level (or whatever)<br><br>Example :<br><br><blockquote>
level1DialogsLo:<br>
    .byte LOW(level1Dialog00),LOW(level1Dialog01)<br>
<br>
level1DialogsHi:<br>
    .byte HIGH(level1Dialog00),HIGH(level1Dialog01)<br>
<br>
etc ...
</blockquote><br><br><br>
If it&apos;s not clear, tell me and I&apos;ll try to be clearer <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__825">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jun 30, 2016 at 1:43:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If my memory serves me right, NESASM uses LOW() and HIGH() instead of &lt; and &gt;. ROM usage is not any worse than in your own example (with the additional benefit of simplified code). This will get you to 256 entries. If you need more than that, you&apos;ll have to use indirect addressing.<br>
<br>
EDIT: got ninjaed.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__826">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jun 30, 2016 at 1:49:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Makes perfect sense. I will definitely consider this for the future, I also think I will have a better cut scene routine in the future than I do now, so that should help.
<br>
<br>I think for now, I&apos;m going to run with what I&apos;m doing as it is working. I think I am taking advantage of code a bit  with the way I am doing it (is what I&apos;m doing called two&apos;s complement), and I save a ton of ROM space this and I can still get 256 dialogs (even though I only need like 140).  I was mainly curious to see how others worked with this limitation. Thanks for the input, very informative.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__827">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jun 30, 2016 at 1:53:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
<br>
If my memory serves me right, NESASM uses LOW() and HIGH() instead of &lt; and &gt;. ROM usage is not any worse than in your own example (with the additional benefit of simplified code). This will get you to 256 entries. If you need more than that, you&apos;ll have to use indirect addressing.<br>
<br>
EDIT: got ninjaed.</div>
<br>
So, am I assuming this correctly?<br>
<br>
TableLo:<br>
&#xA0;&#xA0;&#xA0;&#xA0; .word LOW(dialog00),LOW(dialog01),LOW(dialog02),LOW(dialog03)<br>
TableHi:<br>
&#xA0;&#xA0;&#xA0; .word HIGH(dialog00),HIGH(dialog01),HIGH(dialog02),HIGH(dialog03)<br>
<br>
uses the same about of ROM as<br>
<br>
Table:<br>
&#xA0;&#xA0;&#xA0; .word dialog00,dialog01,dialog02,dialog03<br>
<br>
Because the example is only storing 1 byte per entry and the 2nd example is using 2 bytes per entry?<br>
<br>
Do I still use .word or do I use .db now?<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__828">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Jun 30, 2016 at 1:57:25 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
<br>
If my memory serves me right, NESASM uses LOW() and HIGH() instead of &lt; and &gt;. ROM usage is not any worse than in your own example (with the additional benefit of simplified code). This will get you to 256 entries. If you need more than that, you&apos;ll have to use indirect addressing.<br>
<br>
EDIT: got ninjaed.</div>
<br>
So, am I assuming this correctly?<br>
...<br>
uses the same about of ROM as<br>
...<br>
Because the example is only storing 1 byte per entry and the 2nd example is using 2 bytes per entry?<br>
<br>
Do I still use .word or do I use .db now?</div>
Apart from the mistake of using .word for TableLo/TableHi (should be .byte, or was it .db in NESASM?), yeah, those would use the same amount of ROM space.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__829">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jun 30, 2016 at 2:05:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
<br>
If my memory serves me right, NESASM uses LOW() and HIGH() instead of &lt; and &gt;. ROM usage is not any worse than in your own example (with the additional benefit of simplified code). This will get you to 256 entries. If you need more than that, you&apos;ll have to use indirect addressing.<br>
<br>
EDIT: got ninjaed.</div>
<br>
So, am I assuming this correctly?<br>
...<br>
uses the same about of ROM as<br>
...<br>
Because the example is only storing 1 byte per entry and the 2nd example is using 2 bytes per entry?<br>
<br>
Do I still use .word or do I use .db now?</div>
Apart from the mistake of using .word for TableLo/TableHi (should be .byte, or was it .db in NESASM?), yeah, those would use the same amount of ROM space.<br>
&#xA0;</div>
Yeah, .db in NESASM. This makes complete sense then on why that uses the same ROM space. Thanks everyone!<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__830">
                                                        <div class="mdl-card__title"><strong>Broke Studio</strong> posted on 
		
			
				
				Jun 30, 2016 at 5:20:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
<br>
Apart from the mistake of using .word for TableLo/TableHi (should be .byte, or was it .db in NESASM?), yeah, those would use the same amount of ROM space.<br>
&#xA0;</div>
<br>
Sorry, my mistake ... indeed it&apos;ll use the same amount of ROM space.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__831">
                                                        <div class="mdl-card__title"><strong>Kareemofwheet</strong> posted on 
		
			
				
				Aug 2, 2016 at 12:56:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi Everyone, new here!
<br>
<br>I recently bought a GQ-4X V4 programmer and the ADP-054 16bit add-on. I am attempting to make &quot;The Firemen&quot; for my first repro. I have installed and updated the drivers and software for the GQ. When I start it and nothing is inserted into the Eprom reader, the program says acts like there is already a chip inserted. Is this normal or is my device faulty? I am using m27c801 and have already erased them. Please help!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__832">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Aug 2, 2016 at 2:08:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Kareemofwheet</b></i><br>
<br>
Hi Everyone, new here!<br>
<br>
I recently bought a GQ-4X V4 programmer and the ADP-054 16bit add-on. I am attempting to make &quot;The Firemen&quot; for my first repro. I have installed and updated the drivers and software for the GQ. When I start it and nothing is inserted into the Eprom reader, the program says acts like there is already a chip inserted. Is this normal or is my device faulty? I am using m27c801 and have already erased them. Please help!</div>
I think that this thread is more about programming (i.e. coding, writing code) in 6502 assembly, rather than how to program a board writing data on it. Someone else could have the answer you are looking for, but I surely don&apos;t.<br>
<br>
However, since this is your first post: welcome! <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__833">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Aug 2, 2016 at 5:43:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If it programs the chip correctly, does it matter?  <span class="sprites_emoticons absmiddle" id="emo_tongue">&#xA0;</span>  
<br>
<br>I have one similar and I guess I never paid attention to that part.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__834">
                                                        <div class="mdl-card__title"><strong>neodolphino</strong> posted on 
		
			
				
				Aug 2, 2016 at 6:17:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Kareemofwheet</b></i><br>
<br>
Hi Everyone, new here!<br>
<br>
I recently bought a GQ-4X V4 programmer and the ADP-054 16bit add-on. I am attempting to make &quot;The Firemen&quot; for my first repro. I have installed and updated the drivers and software for the GQ. When I start it and nothing is inserted into the Eprom reader, the program says acts like there is already a chip inserted. Is this normal or is my device faulty? I am using m27c801 and have already erased them. Please help!</div>
As in, it shows the chip type off to the side and the way it&apos;s supposed to be inserted?<br>
<br>
If so, it isn&apos;t acting like a chip is in it, it is just showing you how the selected chip type that you are trying to write is supposed to be oriented.<br>
<br>
You need to select the type of chip from the menu, if you haven&apos;t already... also, maybe a screen shot of your issue might help, if I&apos;m wrong.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__835">
                                                        <div class="mdl-card__title"><strong>Kareemofwheet</strong> posted on 
		
			
				
				Aug 2, 2016 at 6:23:30 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes! Thank you Neodolphino. That is good to know. I&apos;m really enjoying learning this stuff. Sounds like its working correctly.<br>
<br>
Another question... Am I able to use a PAL version of a ROM and burn it to a chip, then soder it to a NTSC board and run it on a NTSC system? The reason I&apos;m asking is because I tried doing this last night and it did not work on my snes. Could have been my terrible sodering though, lol.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__836">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Sep 27, 2016 at 9:38:56 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
<img src original-src="http://www.nesmuseum.com/images/cpumemmap.png" show-src="scraper/images/cpumemmap.png"><br>
If you are in a pinch and your game doesn&apos;t use saves, it is my understanding you can borrow the WRAM area as well, $6000.<br>
&#xA0;</div>
<br>
I take advantage of this to ask a question.<br>
<br>
NROM is (up to) 32kB of PRG ROM ($8000-$FFFF), plus 8kB of CHR ROM (stored on another chip). Correct?<br>
Now, addresses in range $6000 to $7FFF are WRAM, unused. What if you wish to use them?<br>
<br>
I explain my doubts:<br>
<br>
1. when you put the game on cart, if a NROM game uses WRAM, there is need for a further chip?<br>
<br>
2. WRAM space must forcefully be battery backed up? Cannot be flash memory?<br>
<br>
3. Let&apos;s say I start the game, and save data in WRAM space (a saving feature); how can the machine tell next time that such data was saved?<br>
Sure, I can make a code string, like #$AA #$BB #$CC, to be stored at addresses $6000 $6001 $6002 telling the machine: there is stored data in the WRAM.<br>
So, if that string AABBCC is there it means there is data; if it is not there, it means that there is not data (i.e. there is not a saved game in WRAM). But how can I be sure, that the ABSOLUTE first time running the game, that string isn&apos;t there at addressees $6000/1/2 by case? It is there a way, in manufacturing process, to reset up the WRAM to all #$00 or all #$FF?<br>
<br>
4. How do you write/read to/from WRAM? Same as from RAM?<br>
<br>
5. Costs? Availability? I mean, make a NROM game on cart is (relatively to other mappers) cheaper, so would the use of WRAM deny such economical advantage?<br>
I have no idea what kind of chip is needed, and if battery is required what are the costs.<br>
<br>
Any other info or comment related to WRAM use is of course welcome.<br>
<br>
Thank you all! <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
<br>
<strong>Edit</strong>: 6. is it there anything that changes, in the .NES file header, between a NROM that does not use WRAM, and a NROM that does use WRAM?<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__837">
                                                        <div class="mdl-card__title"><strong>erac</strong> posted on 
		
			
				
				Sep 27, 2016 at 1:19:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					1. Yes.
<br>2. If you don&apos;t want it to save, you can skip the battery. If you want eternal saves, there are other types of chips that don&apos;t need batteries.
<br>3. A signature like you thought, or a checksum. The memory is random from factory, so the chance of 24 bits being exactly your signature is 1 in 16 million.
<br>4. Yes. It&apos;s just RAM to the NES.
<br>
<br>6. Yes, one bit indicates there&apos;s 8kb of save RAM.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__838">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Sep 27, 2016 at 1:23:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>erac</b></i><br>
<br>
1. Yes.<br>
2. If you don&apos;t want it to save, you can skip the battery. If you want eternal saves, there are other types of chips that don&apos;t need batteries.<br>
3. A signature like you thought, or a checksum. The memory is random from factory, so the chance of 24 bits being exactly your signature is 1 in 16 million.<br>
4. Yes. It&apos;s just RAM to the NES.<br>
<br>
6. Yes, one bit indicates there&apos;s 8kb of save RAM.</div>
<br>
Thanks! Really appreciated! <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__839">
                                                        <div class="mdl-card__title"><strong>emerson</strong> posted on 
		
			
				
				Sep 27, 2016 at 4:49:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Does anyone know how to get the Nerdy Nights background example code to work on real hardware? Based on my research, I have added &quot;BIT $2002&quot; before the first vblankwait and have written zeros twice to $2006 at the end of the NMI (directly before writing to $2005), but still nothing seems to work. Any suggestions?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__840">
                                                        <div class="mdl-card__title"><strong>emerson</strong> posted on 
		
			
				
				Sep 27, 2016 at 10:02:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m sorry everyone... It turns out the problem was with flux residue on my dev cart. Everything is in working order now.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__841">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Sep 28, 2016 at 2:58:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					@MegaMarioMan
<br>
<br>Thanks for the PM about my question, appreciated. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
<br>(I am answering you here since for some reason the text editor for answering PMs does not work on this device I am using atm, likely the browser is obsolete).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__842">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Sep 28, 2016 at 2:00:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br><br>@MegaMarioMan
<br>
<br>Thanks for the PM about my question, appreciated. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
<br>(I am answering you here since for some reason the text editor for answering PMs does not work on this device I am using atm, likely the browser is obsolete).</div><br><br><br><br><br>I pm&apos;d you bc its a nightmare trying to quote people on the mobile site and trying to edit quote to delete what is not necessary.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__843">
                                                        <div class="mdl-card__title"><strong>cartman</strong> posted on 
		
			
				
				Oct 8, 2016 at 4:55:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					-Is it possible in theory to have those HDMI NES consoles support the Zapper flawlessly but just too complicated/expensive or  does the technology not exist at all?
<br>
<br>-Is there any way to build in some kind of recording device in GB/GBC/GBA consoles enabling it to capture gameplay footage?
<br>
<br>-Could an Original GB console be modified to run on it&apos;s yellowish graphics but without the ghosting effect taking place when things move &quot;fast&quot;?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__844">
                                                        <div class="mdl-card__title"><strong>erac</strong> posted on 
		
			
				
				Oct 9, 2016 at 4:07:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					[quote]-Is it possible in theory to have those HDMI NES consoles support the Zapper flawlessly but just too complicated/expensive or does the technology not exist at all? [/quote]
<br>
<br>No, the issue is the TV, not the console.
<br>
<br>[quote]-Is there any way to build in some kind of recording device in GB/GBC/GBA consoles enabling it to capture gameplay footage? [/quote]
<br>
<br>Several exist already.
<br>
<br>[quote]-Could an Original GB console be modified to run on it&apos;s yellowish graphics but without the ghosting effect taking place when things move &quot;fast&quot;?[/quote]
<br>
<br>Yes, it&apos;s an artifact of the screen. If you can get a faster screen with the same hue, just a replacement away.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__845">
                                                        <div class="mdl-card__title"><strong>cartman</strong> posted on 
		
			
				
				Oct 10, 2016 at 2:44:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>erac</b></i><br><br>[quote]-Is it possible in theory to have those HDMI NES consoles support the Zapper flawlessly but just too complicated/expensive or does the technology not exist at all? [/quote]
<br>
<br>No, the issue is the TV, not the console.
<br>
<br>[quote]-Is there any way to build in some kind of recording device in GB/GBC/GBA consoles enabling it to capture gameplay footage? [/quote]
<br>
<br>Several exist already.
<br>
<br>[quote]-Could an Original GB console be modified to run on it&apos;s yellowish graphics but without the ghosting effect taking place when things move &quot;fast&quot;?[/quote]
<br>
<br>Yes, it&apos;s an artifact of the screen. If you can get a faster screen with the same hue, just a replacement away.</div><br><br><br><br><br>Yes i meant the TV&apos;s. So most likely it&apos;s never gonna be possible?<br><br>Wich recording devices exist? All i&apos;ve ever seen is gameplay on either SGB or GBP.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__846">
                                                        <div class="mdl-card__title"><strong>ubuntuyou</strong> posted on 
		
			
				
				Nov 2, 2016 at 2:34:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m working through some of the tutorials here and, while it&apos;s very slow, I&apos;m starting to understand the basics. Spent all day today working on getting a game state/screen loading routine worked out for a pong game. Something strange happens that has me scratching my head. I&apos;ll be removing the jump code in the end but keeping it in for now. It works as written unless the player2 (right) paddle is at it&apos;s lowest point. Then the jump rises as intended but falls slowly and continues to fall ad infinitum. I can&apos;t see any reason for this strange behavior. Code (not well commented) and rom are attached. Can someone help me figure out what the hell is going on?  <a href="https://www.dropbox.com/s/ordfbm6mrejem6p/robo-pong.zip?dl=0" target="_blank" original-href="https://www.dropbox.com/s/ordfbm6mrejem6p/robo-pong.zip?dl=0">https://www.dropbox.com/s/ordfbm6...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__847">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Nov 2, 2016 at 4:06:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					first problem I see is that in your .fall subroutine, right after the call to updateLoc you call BEQ:
<br>
<br>...
<br>.fall
<br>  LDA spriteRAM
<br>  CLC
<br>  ADC jump
<br>  STA spriteRAM
<br>  JSR updateLoc  
<br>  CMP #BOTTOMWALL
<br>  BEQ .out
<br>...
<br>
<br>if I&apos;ve got my facs straight here, the last thing loaded into the accumulator is spriteRAM+32, but with #$08 added to it. I don&apos;t see why it would be working regardless, but since that last sprite is what I assume to be the player 2 paddle, that might be a good place to start. load up the correct ram there and you should be good to go. 
<br>
<br>additionally, I&apos;d probably split your updateLoc routine into paddles and character- would save a lot of NMI time to not call to change those paddles again
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__848">
                                                        <div class="mdl-card__title"><strong>ubuntuyou</strong> posted on 
		
			
				
				Nov 2, 2016 at 2:36:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well I&apos;ll be. That fixed it alright. I guess I didn&apos;t take into account that LDA spriteRAM in .fall would be overwritten by the last one in updateLoc. Thank you Rocky.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__849">
                                                        <div class="mdl-card__title"><strong>ubuntuyou</strong> posted on 
		
			
				
				Nov 9, 2016 at 7:25:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
I will leave you with the code I use to draw text to the Name Table with a few examples of text I write in my game.<br>
<br>
;Loading Code into Buffer Variables during main code (not during NMI)<br>
&#xA0;&#xA0;&#xA0; LDA #LOW(Hit1Text)&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;Load &apos;HIT 1&apos; into TextPointer<br>
&#xA0;&#xA0; &#xA0;STA TextPointer<br>
&#xA0;&#xA0; &#xA0;LDA #HIGH(Hit1Text)<br>
&#xA0;&#xA0; &#xA0;STA TextPointer+1<br>
<br>
&#xA0;&#xA0; &#xA0;LDA #$05&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&apos;HIT 1&apos; is 5 characters long<br>
&#xA0;&#xA0; &#xA0;STA TEXTLENGTH&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;The length of the text being written to the screen (number of characters being written)<br>
<br>
&#xA0;&#xA0; &#xA0;LDA #$6F&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Write to PPU Address $206F (On the Name Table)<br>
&#xA0;&#xA0; &#xA0;STA TEXTLOWBYTE &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0;&#xA0; &#xA0;LDA #$20<br>
&#xA0;&#xA0; &#xA0;STA TEXTHIGHBYTE<br>
<br>
&#xA0; INC LoadTextFlag&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Enable the Load Text Routine<br>
<br>
;Call this during NMI<br>
&#xA0;&#xA0; &#xA0;JSR LoadText&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Jump to Subroutine LoadText<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br>
LoadText:<br>
&#xA0; LDA LoadTextFlag<br>
&#xA0; BEQ LoadTextDone<br>
<br>
&#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; read PPU status to reset the high/low latch<br>
&#xA0; LDA TEXTHIGHBYTE<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $2000 address (Name Table)<br>
&#xA0; LDA TEXTLOWBYTE<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $2000 address (Name Table)<br>
&#xA0; LDY #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start out at 0<br>
<br>
LoadTextLoop:<br>
&#xA0; LDA [TextPointer], y&#xA0;&#xA0;&#xA0;&#xA0; ; load data from address (background + the value in y)<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write to PPU<br>
&#xA0; INY&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Y = Y + 1<br>
&#xA0; CPY TEXTLENGTH&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare Y to value in TEXTLENGTH<br>
&#xA0; BNE LoadTextLoop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Branch to LoadTextLoop if compare was Not Equal to TEXTLENGTH<br>
LoadTextDone:<br>
&#xA0; RTS<br>
&#xA0;<br>
;;;;;<br>
BlankTiles:<br>
&#xA0; .db $24,$24,$24,$24,$24,$24,$24,$24&#xA0; &#xA0;<br>
MissText:<br>
&#xA0; .db $16,$12,$1C,$1C&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;MISS<br>
Hit1Text:<br>
&#xA0; .db $11,$12,$1D,$24,$01&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;HIT 1<br>
Hit2Text:<br>
&#xA0; .db $11,$12,$1D,$24,$02&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;HIT 2<br>
Hit3Text:<br>
&#xA0; .db $11,$12,$1D,$24,$03&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;HIT 3<br>
Owned:<br>
&#xA0; .db $18,$20,$17,$0e,$0d&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;OWNED<br>
&#xA0;</div>
<br>
I&apos;m trying to implement something like this for flashing &quot;PRESS START&quot; text. I get a brief flash of graphical garbage every time it writes new bytes to the nametable though. I&apos;ve written my buffers in &quot;forever&quot; and am calling the &quot;writeText&quot; subroutine in my NMI. The only other things going on are handling the frame counter and checking the start button. Any idea what the issue could be? Something to do with writing to $2006 or $2007 perhaps. I&apos;ve been bashing my head against the keyboard over this for several hours now but it&apos;s after 6AM and I need sleep. Any help is appreciated. Offending code is in &quot;forever&quot; and just below and in &quot;engineTitle&quot; in the NMI.<br>
<br>
I figured it out. My end of NMI sequence was in the wrong place.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__850">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 10, 2016 at 4:33:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>ubuntuyou</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
I will leave you with the code I use to draw text to the Name Table with a few examples of text I write in my game.<br>
<br>
;Loading Code into Buffer Variables during main code (not during NMI)<br>
&#xA0;&#xA0;&#xA0; LDA #LOW(Hit1Text)&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;;Load &apos;HIT 1&apos; into TextPointer<br>
&#xA0;&#xA0; &#xA0;STA TextPointer<br>
&#xA0;&#xA0; &#xA0;LDA #HIGH(Hit1Text)<br>
&#xA0;&#xA0; &#xA0;STA TextPointer+1<br>
<br>
&#xA0;&#xA0; &#xA0;LDA #$05&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;&apos;HIT 1&apos; is 5 characters long<br>
&#xA0;&#xA0; &#xA0;STA TEXTLENGTH&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;The length of the text being written to the screen (number of characters being written)<br>
<br>
&#xA0;&#xA0; &#xA0;LDA #$6F&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Write to PPU Address $206F (On the Name Table)<br>
&#xA0;&#xA0; &#xA0;STA TEXTLOWBYTE &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
&#xA0;&#xA0; &#xA0;LDA #$20<br>
&#xA0;&#xA0; &#xA0;STA TEXTHIGHBYTE<br>
<br>
&#xA0; INC LoadTextFlag&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Enable the Load Text Routine<br>
<br>
;Call this during NMI<br>
&#xA0;&#xA0; &#xA0;JSR LoadText&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;Jump to Subroutine LoadText<br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<br>
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br>
LoadText:<br>
&#xA0; LDA LoadTextFlag<br>
&#xA0; BEQ LoadTextDone<br>
<br>
&#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; read PPU status to reset the high/low latch<br>
&#xA0; LDA TEXTHIGHBYTE<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the high byte of $2000 address (Name Table)<br>
&#xA0; LDA TEXTLOWBYTE<br>
&#xA0; STA $2006&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write the low byte of $2000 address (Name Table)<br>
&#xA0; LDY #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; start out at 0<br>
<br>
LoadTextLoop:<br>
&#xA0; LDA [TextPointer], y&#xA0;&#xA0;&#xA0;&#xA0; ; load data from address (background + the value in y)<br>
&#xA0; STA $2007&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; write to PPU<br>
&#xA0; INY&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Y = Y + 1<br>
&#xA0; CPY TEXTLENGTH&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Compare Y to value in TEXTLENGTH<br>
&#xA0; BNE LoadTextLoop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Branch to LoadTextLoop if compare was Not Equal to TEXTLENGTH<br>
LoadTextDone:<br>
&#xA0; RTS<br>
&#xA0;<br>
;;;;;<br>
BlankTiles:<br>
&#xA0; .db $24,$24,$24,$24,$24,$24,$24,$24&#xA0; &#xA0;<br>
MissText:<br>
&#xA0; .db $16,$12,$1C,$1C&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;MISS<br>
Hit1Text:<br>
&#xA0; .db $11,$12,$1D,$24,$01&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;HIT 1<br>
Hit2Text:<br>
&#xA0; .db $11,$12,$1D,$24,$02&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;HIT 2<br>
Hit3Text:<br>
&#xA0; .db $11,$12,$1D,$24,$03&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;HIT 3<br>
Owned:<br>
&#xA0; .db $18,$20,$17,$0e,$0d&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ;OWNED<br>
&#xA0;</div>
<br>
I&apos;m trying to implement something like this for flashing &quot;PRESS START&quot; text. I get a brief flash of graphical garbage every time it writes new bytes to the nametable though. I&apos;ve written my buffers in &quot;forever&quot; and am calling the &quot;writeText&quot; subroutine in my NMI. The only other things going on are handling the frame counter and checking the start button. Any idea what the issue could be? Something to do with writing to $2006 or $2007 perhaps. I&apos;ve been bashing my head against the keyboard over this for several hours now but it&apos;s after 6AM and I need sleep. Any help is appreciated. Offending code is in &quot;forever&quot; and just below and in &quot;engineTitle&quot; in the NMI.<br>
<br>
I figured it out. My end of NMI sequence was in the wrong place.<br>
&#xA0;</div>
<br>
I&apos;ll try to take a look at this tonight. I may be a bit rough around the edges as its been awhile since I have looked at some code. Honestly, if it was me, I would just use the word START (drop the word PRESS) as Sprite Tiles and hide them every so many frames. You could run a timed loop that performs this action. I do that process during other parts of my games, specifically parts I want animate. I only use background tiles when it is a permanet write to the background.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__851">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Nov 10, 2016 at 7:25:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If there&apos;s not much you got on the screen for a title, you could probably use a palette especially for the press start text and just change the color- that way you get the blink without having to put letters in your Sprite sheet.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__852">
                                                        <div class="mdl-card__title"><strong>ubuntuyou</strong> posted on 
		
			
				
				Nov 11, 2016 at 3:13:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think my graphical issue was caused by writing to $2006 and $2007 at the wrong time. Both of your suggestions sound a lot simpler than changing a chunk of background data. I&apos;ll play around with them later on tonight. I think the background tile change might work better for my health bars. Thanks for the help guys.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__853">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Dec 5, 2016 at 6:31:34 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I seem to be having some trouble with palette swapping...<br>
<br>
I&apos;m trying to set up a reliable scene switching system, but I&apos;ve run into an issue that appears to be a conflict between my palette flash (FlashStart) routine and my load palette (LoadPalettes) routine when switching from the title screen to the game screen.<br>
<br>
when you press start on the title screen, there appear to be certain times where the current color of the flashing text is preserved over the scene change. it assume it may have something to do with the frame count for the flash (PressStartFlashFrame) if nothing else, as it&apos;s never a consistent bug. you can usually get it at white if you press start as soon as the title comes up, and consistently green if you do it before.<br>
<br>
here&apos;s a link to the zip, if anyone wouldn&apos;t mind giving it a fresh set of eyes!<br>
<br>
EDIT: Nope, I&apos;m just an idiot. I was right about the frame count though, but only because I forgot to RTS the routine before the flash. &#xA0;nevermind!<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__854">
                                                        <div class="mdl-card__title"><strong>ubuntuyou</strong> posted on 
		
			
				
				Dec 7, 2016 at 2:59:10 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Been tinkering with KHAN&apos;s tutorial on collision detection for about a week now. I have the first &quot;metatile&quot; version working with scrolling to an extent. It will scroll the background collision data for an entire nametable then switch to the second nametable&apos;s data only when the nametable switches. My character also walks through solid walls at the scroll point though I&apos;ve tried to negate my scroll flag. The second example using a collision table does not elicit free movement of my character. I&apos;ve found little to no information on background collision while scrolling and very little on 6502 background collision in general. Any help is, as always, greatly appreciated. <a href="https://www.dropbox.com/s/8091xj7w2a9jt37/metatiles.zip?dl=0" target="_blank" original-href="https://www.dropbox.com/s/8091xj7w2a9jt37/metatiles.zip?dl=0">https://www.dropbox.com/s/8091xj7...</a><br>
<br>
Edit 0: I&apos;ve figured out not being able to move in the second example. Noob mistake. I didn&apos;t reserve my spriteYpos and spriteYposHi variables together. I still can&apos;t figure out the scrolling part though.<br>
<br>
Edit 1: I really buckled down tonight and worked out a two-direction, two-nametable, scrolling collision detection routine. Took me 4 or 5 hours but I got it. Metatile background data has to be aligned to a block and is updated one column at a time in a block of RAM ($0600 - $06FF in this case). To align it I needed to add a &quot;buffer&quot; of 16 bytes at the end of the background data to have a full block. If doing a platformer, make this a &quot;free movement&quot; metatile so your character can fall into pits. Here&apos;s the subroutine. Shouldn&apos;t be too difficult to allow for more screens. I&apos;m still having issues with walking through walls when scrolling.<br>
<br>
<code>updateColTbl:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Call in Main Loop<br>
&#xA0;&#xA0; &#xA0;LDA scroll&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ; Load scroll value and divide by 16<br>
&#xA0;&#xA0; &#xA0;LSR A<br>
&#xA0;&#xA0; &#xA0;LSR A<br>
&#xA0;&#xA0; &#xA0;LSR A<br>
&#xA0;&#xA0; &#xA0;LSR A<br>
&#xA0;&#xA0; &#xA0;BCS updateColTblDone&#xA0;&#xA0;&#xA0; ; If carry is set then scroll is not divisible by 16 so skip update<br>
&#xA0;&#xA0; &#xA0;TAY &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Else, carry is clear and scroll is divisible by 16 so update column<br>
<br>
&#xA0;&#xA0; &#xA0;LDX nametable&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ; Load X with nametable (Load with background number and forget everything up to .skip if using more than two screens)<br>
&#xA0;&#xA0; &#xA0;LDA screenScrolled&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Load A with screenScrolled variable<br>
&#xA0;&#xA0; &#xA0;CMP #$FF&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; If screen has scrolled left,<br>
&#xA0;&#xA0; &#xA0;BEQ .skip&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; then skip to load bkgPtr<br>
&#xA0;&#xA0; &#xA0;TXA&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Else screen has scrolled right so transfer X to A<br>
&#xA0;&#xA0; &#xA0;EOR #$01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Flip the bit<br>
&#xA0;&#xA0; &#xA0;TAX &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;&#xA0; ; and transfer back to X<br>
.skip<br>
&#xA0;&#xA0; &#xA0;LDA backgroundsLo,x<br>
&#xA0;&#xA0; &#xA0;STA bkgPtr<br>
&#xA0;&#xA0; &#xA0;LDA backgroundsHi,x<br>
&#xA0;&#xA0; &#xA0;STA bkgPtr+1<br>
<br>
&#xA0;&#xA0; &#xA0;LDA #$00<br>
&#xA0;&#xA0; &#xA0;STA colPtr<br>
&#xA0;&#xA0; &#xA0;LDA #$06<br>
&#xA0;&#xA0; &#xA0;STA colPtr+1<br>
<br>
&#xA0;&#xA0; &#xA0;LDX #$00&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Initialize X<br>
.loop<br>
&#xA0;&#xA0; &#xA0;LDA [bkgPtr],y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Load a byte from the background (Y holds column offset)<br>
&#xA0;&#xA0; &#xA0;STA [colPtr],y&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; and store in the corresponding spot in collision table<br>
&#xA0;&#xA0; &#xA0;LDA bkgPtr&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Add 10 to bkgPtr to point to next byte in column<br>
&#xA0;&#xA0;&#xA0; CLC<br>
&#xA0;&#xA0;&#xA0; ADC #$10<br>
&#xA0;&#xA0; &#xA0;STA bkgPtr<br>
&#xA0;&#xA0; &#xA0;STA colPtr&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Also update colPtr<br>
&#xA0;&#xA0; &#xA0;INX<br>
&#xA0;&#xA0; &#xA0;CPX #$0F &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; Check if 15 columns have been updated<br>
&#xA0;&#xA0; &#xA0;BNE .loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; If not then repeat until it does<br>
updateColTblDone:<br>
&#xA0;&#xA0; &#xA0;RTS</code><br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__855">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Dec 16, 2016 at 6:24:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	To aim a bullet you just need atan2 function. You determine the angle that way, then take deltas for required speed using a table. atan2 may sound scary, but it fast it isn&apos;t too slow, check this implementation: <a href="http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle" target="_blank" original-href="http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle">http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle</a><br>
	<br>
	If you need range more than 8 bit, you can just divide the source vector by 2, 4, etc. This will be precise enough.<br>
	<br>
	And of course, never use 360 degree circle on 8 bit CPU. It should be 256 degree instead.</div>
<br>
Well, I&apos;ve clearly been putting off figuring out angles for a while! Time to clear out an old bookmark and make sense of it all.<br>
<br>
I followed your link Shiru, and got the routines plugged in and working (I think anyways). I have new A, Y, and X values coming out of the routine, but I have no clue what to do with them <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>. Real programming sites don&apos;t really specify&#xA0;<em>how</em> to use the results, hahaha. I can make some things fly around the screen at what I am guessing is the correct angle, but they whiz by way too fast and are out of control. Any help would be greatly appreciated, thanks!<br>
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__856">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 16, 2016 at 8:16:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	<div class="FTQUOTE">
		<i>Originally posted by: <b>Shiru</b></i><br>
		<br>
		To aim a bullet you just need atan2 function. You determine the angle that way, then take deltas for required speed using a table. atan2 may sound scary, but it fast it isn&apos;t too slow, check this implementation: <a href="http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle" target="_blank" original-href="http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle">http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle</a><br>
		<br>
		If you need range more than 8 bit, you can just divide the source vector by 2, 4, etc. This will be precise enough.<br>
		<br>
		And of course, never use 360 degree circle on 8 bit CPU. It should be 256 degree instead.</div>
	<br>
	Well, I&apos;ve clearly been putting off figuring out angles for a while! Time to clear out an old bookmark and make sense of it all.<br>
	<br>
	I followed your link Shiru, and got the routines plugged in and working (I think anyways). I have new A, Y, and X values coming out of the routine, but I have no clue what to do with them <span class="sprites_emoticons absmiddle" id="emo_smile"> </span>. Real programming sites don&apos;t really specify <em>how</em> to use the results, hahaha. I can make some things fly around the screen at what I am guessing is the correct angle, but they whiz by way too fast and are out of control. Any help would be greatly appreciated, thanks!</div>
<br>
<br>
<br>
Yes, I never understood the output of that routine too.<br>
<br>
Also, thinking about it, I was wondering, assuming someone has no problem wasting 1kB with 4 lookup tables (one for each quadrant), would this be an acceptable solution?<br>
<pre>; Variables
; MainX MainY TargX TargY
; OffsX OffsY DirX DirY<br><br>YAXIS:
  LDA MainY
  SEC
  SBC TargY
  ROL DirY       ; IF 1 TARGET IS ABOVE, IF 0 TARGET IS BELOW
  BNE XAXIS      ; TARGET IS ABOVE
DOWN:            ; TARGET IS BELOW
  LDA TargY
  SEC
  SBC MainY
XAXIS:
  STA OffsY      ; Y OFFSET IS HERE
  LDA MainX
  SEC
  SBC TargX
  ROL DirX       ; IF 1 TARGET IS LEFT, IF 0 TARGET IS RIGHT
  BNE SHIFT      ; TARGET IS LEFT
RIGHT:           ; TARGET IS RIGHT
  LDA TargX
  SEC
  SBC MainX
SHIFT:
  STA OffsX      ; X OFFSET IS HERE
  CMP 10
  BCS REDUCE
  LDA OffsY
  CMP 10
  BCC DONE
REDUCE:
  LDA OffsY
  LSR A
  STA OffsY
  LDA OffsX
  LSR A
  STA OffsX
  CMP 10
  BCS REDUCE
  LDA OffsY
  CMP 10
  BCS REDUCE
DONE:             ; OffsY is in A
  ASL A
  ASL A
  ASL A
  ASL A
  ADC OffsX       ; CARRY SHOULD BE CLEAR
  TAX             ; HERE THE INDEX = 16*Y+X
  LDA DirY
  BEQ TARGET_DOWN
  LDA DirX
  BEQ UPRIGHT
UPLEFT:                  ; TARGET IS UPLEFT
  LDA ANGLE_UPLEFT,x     ; LookUp Table
  RTS
UPRIGHT:                 ; TARGET IS UPRIGHT
  LDA ANGLE_UPRIGHT,x    ; LookUp Table
  RTS
TARGET_DOWN:
  LDA DirX
  BEQ DOWNRIGHT
DOWNLEFT:                ; TARGET IS DOWNLEFT
  LDA ANGLE_DOWNLEFT,x   ; LookUp Table
  RTS
DOWNRIGHT:               ; TARGET IS DOWNRIGHT
  LDA ANGLE_DOWNRIGHT,x  ; LookUp Table
  RTS</pre>
<br>
<br>
Disclaimer: I did not test this code, it might likely be inaccurate or contain syntax errors, and it surely could be optimized. Or probably it is maybe just silly. I wrote it now while thinking about what that other routine is supposed to do, and I was just wondering out of curiosity if this could be an acceptable alternative solution good coding wise, that&apos;s all.<br>
<br>
Thanks in advance to anyone who can explain more about the SGP link above, and/or about this subject (get a relative angle direction between two point) in general.<br>
<br>
Edit: corrected a comment in the code posted above.<br>
<br>
Edit II: optimized and corrected a branching blunder in the first lines of code posted here above.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__857">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				Dec 17, 2016 at 12:08:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>Shiru</b></i><br>
<br>
To aim a bullet you just need atan2 function. You determine the angle that way, then take deltas for required speed using a table. atan2 may sound scary, but it fast it isn&apos;t too slow, check this implementation: <a href="http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle" target="_blank" original-href="http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle">http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle</a><br>
<br>
If you need range more than 8 bit, you can just divide the source vector by 2, 4, etc. This will be precise enough.<br>
<br>
And of course, never use 360 degree circle on 8 bit CPU. It should be 256 degree instead.</div>
<br>
Well, I&apos;ve clearly been putting off figuring out angles for a while! Time to clear out an old bookmark and make sense of it all.<br>
<br>
I followed your link Shiru, and got the routines plugged in and working (I think anyways). I have new A, Y, and X values coming out of the routine, but I have no clue what to do with them <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>. Real programming sites don&apos;t really specify&#xA0;<em>how</em> to use the results, hahaha. I can make some things fly around the screen at what I am guessing is the correct angle, but they whiz by way too fast and are out of control. Any help would be greatly appreciated, thanks!</div>
Never used the code myself, but looks like it outputs an angle (0..255) in A and nothing else. x1, y1, x2, y2 are the input point coordinates. You can use the angle to look up a direction vector for movement from a sine/cosine table.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__858">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 17, 2016 at 9:21:02 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>thefox</b></i><br>
	<br>
	Never used the code myself, but looks like it outputs an angle (0..255) in A and nothing else.<br>
	&#xA0;</div>
<br>
If this is the case, from my past testing experience, I remember that the output was not very accurate. Unless I misinterpreted something, which is possible.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__859">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 17, 2016 at 9:44:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes, it gets two coords as input, calculate the vector (x2-x1, y2-y1; this part can be omited if you have vector already) and returns the angle 0..255 in A. The output is as accurate as it gets with the 8 bit math.
<br>
<br>For better understanding, try to read something like that: <a href="https://www.raywenderlich.com/35866/trigonometry-for-game-programming-part-1" target="_blank" original-href="https://www.raywenderlich.com/35866/trigonometry-for-game-programming-part-1">https://www.raywenderlich.com/358...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__860">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Dec 17, 2016 at 10:17:06 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					But what do you DO with the result. Do you use it in a table to look up what to add to the projectile Y and X (Kalle seems to be indicating that, I think?)? That&apos;s the part that I&apos;m unclear on. That link is going to take some digesting, but I&apos;m kind of stuck at the conceptual level for the moment. Any help is appreciated, for those of us who never went past algebra (not even geometry!), or took a programming class.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__861">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 17, 2016 at 10:24:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	Yes, it gets two coords as input, calculate the vector (x2-x1, y2-y1; this part can be omited if you have vector already) and returns the angle 0..255 in A. The output is as accurate as it gets with the 8 bit math.<br>
	<br>
	For better understanding, try to read something like that: <a href="https://www.raywenderlich.com/35866/trigonometry-for-game-programming-part-1" target="_blank" original-href="https://www.raywenderlich.com/35866/trigonometry-for-game-programming-part-1">https://www.raywenderlich.com/35866/trigonometry-for-game-pr...</a> </div>
<br>
<br>
<br>
Written on top of the link:<br>
&quot;&quot;&quot; might be more precise to add a clc adc #$01 after each eor #$ff, you have to modify all the preceding bcs *+4/ bcc *+4 to *+7 to get the branches correct. also you can omit the clc where bcs is used. adding a SEC before all sbc&apos;s might increase the accuracy even further. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span> /Oswald &quot;&quot;&quot;<br>
<br>
I assumed these modification were needed, were they?<br>
<br>
Also, bcs *+4, means:<br>
a) branch 4 bytes below (which is what I think)<br>
or<br>
b) branch 4 instructions below?<br>
<br>
It is a while since I toyed around with that routine, but I clearly remember it wasn&apos;t doing what I expected for it to do. The output was incorrect, at least in some scenarios. Cases are two:<br>
a) I misunderstood/misinterpreted it<br>
or<br>
b) it is not always accurate<br>
<br>
Since you are so positive about its accuracy, I guess 99.99% of chances are that I did some mistake somewhere,<br>
<br>
I&apos;m not a math genius, neither a programmer academically wise, but I think to know what an angle and its relative vectors on the X/Y axis are.<br>
<br>
Thanks a lot for any further detail. Appreciated.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__862">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 17, 2016 at 10:28:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, you do with it whatever you want to do, who knows that better than you?
<br>
<br>You need to aim a shot to player? You need a system that allows projectiles to move at some angle rather than straight lines. Like, you need fixed point coords, with some bits for fraction part of the axis speed, and two deltas, also in fixed point. Now, to aim you need to use atan2 function to find angle between player coords and enemy coords. Using this angle, you can find deltas to move towards the target using a sin/cos table and optional multiplication (if you need different speeds for shots).
<br>
<br>You may also want to implement homing missile. In this case you use the angle not directly, but as desired value. In this case the projectile needs to use angle instead of the deltas, and adjust it gradually trying to &apos;rotate&apos; it to the desired one in fastest way (i.e. you need to determine which direction of rotation will reach the desired angle faster).
<br>
<br>For your information, I have no slightest clue about trigonometry, or algebra, or math more complex than add/sub/mul/div. These things dont&apos; really require understanding of the underlying math, just use cases for functions. It happens at intuitive level. Like, try to start from learning how to draw a circle using sin/cos and angle (basically boils down to x=size*sin(angle); y=size*cos(angle); with angle changing from 0 to 360), and you&apos;ll get better understanding of the thing.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__863">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 17, 2016 at 10:36:32 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					*+4 means skip four bytes. That&apos;s a cheap alternative to the local or unnamed labels in assemblers that don&apos;t have these.
<br>
<br>The routine worked all fine for me in a few games, without the suggested changes. They&apos;re mathematically correct, though (eor $ff is a cheap version of negation), but all they affect to is shifting the target point by a pixel. So it only will get issues when the target is really close, like just few pixels away.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__864">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 17, 2016 at 10:41:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	*+4 means skip four bytes. That&apos;s a cheap alternative to the local or unnamed labels in assemblers that don&apos;t have these.<br>
	<br>
	The routine worked all fine for me in a few games, without the suggested changes. They&apos;re mathematically correct, though (eor $ff is a cheap version of negation), but all they affect to is shifting the target point by a pixel. So it only will get issues when the target is really close, like just few pixels away.</div>
<br>
<br>
<br>
Thanks, clear. It was probably me overlooking something then.<br>
I might give it a second try. So far, I never needed 256 directions, so since this routine seemed inaccurate anyways, I used simple alternatives dividing the circle in like 16 dir (N N NNE NE ENE E ...) and stick to that.<br>Thanks again for your time and your answers.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__865">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Dec 17, 2016 at 11:14:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	Well, you do with it whatever you want to do, who knows that better than you?<br>
	&#xA0;</div>
<br>
Hahaha, well played sir <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>. I don&apos;t tend to use a lot of code from around the internet, so I am not always great at integrating it succesfully. I can usually make it work with enough patience, but in this case I didn&apos;t want to set about re-inventing the wheel if there was a standard way of doing things for aiming a shot, for instance. Thanks for the suggestions about how to do things; I think that that might be what I am after. More tables it seems, in order to get the Y and X rates of movement.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__866">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 17, 2016 at 11:18:44 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes, if you just need to make an aimed shot, all you need is two more tables, sin/cos scaled to the projectile speed. Normally that would be two 256-byte tables generated with a script that is basically the simplest circle drawing code I reffered above, and you just use the output A as index in these tables to get dx,dy from them.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__867">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 18, 2016 at 9:48:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	More tables it seems, in order to get the Y and X rates of movement.<br>
	&#xA0;</div>
<br>
<br>
<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	Yes, if you just need to make an aimed shot, all you need is two more tables, sin/cos scaled to the projectile speed.<br>
	&#xA0;</div>
<br>
If this can help. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
<pre><br><br>Assiming Vectorial Speed == 100**
Angles in binary (0-255)
Assuming Angle 00 == South (Down)*
Assuming Angle 64 == East (Right)*
*[of course, you can build a lookup
  table adapting the +/- signs on
  the list to the direction of the
  angle 00 on the ATAN routine you
  are using, and the rotation clock
  or counter clock wise of it].
**[of course, you can scale it down
   to the speed  needed, e.g. speed
   of 50, divide all values by 2].<br><br>List0064, from 0 to 64:<br><br>  A   X   Y  ; A = angle, X/Y = vectors on X/Y axis
  0   0 100  ; this is a 0&#xB0; Angle in range 0-360&#xB0;
  1   2  99
  2   4  99
  3   7  99
  4   9  99
  5  12  99
  6  14  98
  7  17  98
  8  19  98
  9  21  97
 10  24  97
 11  26  96
 12  29  95
 13  31  94
 14  33  94
 15  35  93
 16  38  92
 17  40  91
 18  42  90
 19  44  89
 20  47  88
 21  49  87
 22  51  85
 23  53  84
 24  55  83
 25  57  81
 26  59  80
 27  61  78
 28  63  77
 29  65  75
 30  67  74
 31  68  72
 32  70  70  ; this is a 45&#xB0; Angle in range 0-360&#xB0;
 33  72  68
 34  74  67
 35  75  65
 36  77  63
 37  78  61
 38  80  59
 39  81  57
 40  83  55
 41  84  53
 42  85  51
 43  87  49
 44  88  47
 45  89  44
 46  90  42
 47  91  40
 48  92  38
 49  93  35
 50  94  33
 51  94  31
 52  95  29
 53  96  26
 54  97  24
 55  97  21
 56  98  19
 57  98  17
 58  98  14
 59  99  12
 60  99   9
 61  99   7
 62  99   4
 63  99   2
 64 100   0  ; this is a 90&#xB0; Angle in range 0-360&#xB0;<br><br>From 64 to 128:<br><br> - revert the list0064
 - make the Y negative<br><br>  A   X   Y  ; A = angle, X/Y = vectors on X/Y axis
 64 100   0  ; this is a 90&#xB0; Angle in range 0-360&#xB0;
 65  99  -2
 66  99  -4
 67  99  -7
...
125   7 -99
126   4 -99
127   2 -99
128   0 -100 ; this is a 180&#xB0; Angle in range 0-360&#xB0;<br><br>From 128 to 192:
 - copy the list0064
 - make both X and Y negative<br><br>  A   X   Y  ; A = angle, X/Y = vectors on X/Y axis
128   0 -100 ; this is a 180&#xB0; Angle in range 0-360&#xB0;
129  -2 -99
130  -4 -99
131  -7 -99
 ...
189 -99  -7
190 -99  -4
191 -99  -2
192 -100  0  ; this is a 270&#xB0; Angle in range 0-360&#xB0;<br><br>From 192 to 0:
 - revert the list0064
 - make the X negative<br><br>  A   X   Y  ; A = angle, X/Y = vectors on X/Y axis
192 -100  0  ; this is a 270&#xB0; Angle in range 0-360&#xB0;
193 -99   2
194 -99   4
195 -99   7
...
253  -7  99
254  -4  99
255  -2  99
  0   0 100  ; this is a 360&#xB0; Angle in range 0-360&#xB0;
</pre>
Please report any inaccuracy.<br>
<br>
Thanks.<br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__868">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 18, 2016 at 10:13:52 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Just in case this could helps anyone.<br>
<br>
<br>This the List0064 here above in HEX values:<br>
<br>
<pre> A     X     Y
00    00    64
01    02    63
02    04    63
03    07    63
04    09    63
05    0C    63
06    0E    62
07    11    62
08    13    62
09    15    61
0A    18    61
0B    1A    60
0C    1D    5F
0D    1F    5E
0E    21    5E
0F    23    5D
10    26    5C
11    28    5B
12    2A    5A
13    2C    59
14    2F    58
15    31    57
16    33    55
17    35    54
18    37    53
19    39    51
1A    3B    50
1B    3D    4E
1C    3F    4D
1D    41    4B
1E    43    4A
1F    44    48
20    46    46
21    48    44
22    4A    43
23    4B    41
24    4D    3F
25    4E    3D
26    50    3B
27    51    39
28    53    37
29    54    35
2A    55    33
2B    57    31
2C    58    2F
2D    59    2C
2E    5A    2A
2F    5B    28
30    5C    26
31    5D    23
32    5E    21
33    5E    1F
34    5F    1D
35    60    1A
36    61    18
37    61    15
38    62    13
39    62    11
3A    62    0E
3B    63    0C
3C    63    09
3D    63    07
3E    63    04
3F    63    02
40    64    00
</pre><br>
<br>
For the rest of the table (and the rest of the circle) involving negative values of the X/Y vectors, assuming that the speed is &lt;= 127, you can use two&apos;s complement math to store negative values, so that you can always add the value in the lookup tables to the previous value (e.g. initial position 42, you need to sub 01, and you sum FF instead: 42 + FF = 41).<br>
I assume everyone in here knows about it, but for the sake of complete info I post a link to it: <a href="https://en.wikipedia.org/wiki/Two" target="_blank" original-href="https://en.wikipedia.org/wiki/Two">https://en.wikipedia.org/wiki/Two...</a>&apos;s_complement<br>
<br>
<br>Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__869">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 18, 2016 at 10:27:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here is a very simple Python script to generate sin/cos tables, just in case:
<br>
<br>
<br>
<br>import math
<br>
<br>
<br>table_length=256
<br>circle_size=127
<br>
<br>
<br>
<br>print &quot;;cos table&quot;
<br>
<br>for angle in range(0,table_length):
<br>
<br>    print &quot;\t .byte %i&quot; % math.floor(circle_size*math.cos(math.radians(360.0/table_length*angle)))
<br>
<br>print &quot;;sin table&quot;
<br>
<br>for angle in range(0,table_length):
<br>
<br>    print &quot;\t .byte %i&quot; % math.floor(circle_size*math.sin(math.radians(360.0/table_length*angle)))
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__870">
                                                        <div class="mdl-card__title"><strong>guiltl3ss</strong> posted on 
		
			
				
				Dec 18, 2016 at 11:20:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi there, I&apos;m learning how to program and code games in by spare time while I work on my graduate degree.  My goal is to use my research to make more realistic settings and stuff, my major being archaeology.  I&apos;m working with Gameboy right now using a C+ compiler so I can avoid assembly or whatever it might normally require.  I guess at this point I have a few &quot;best practices&quot; questions.  More than anything, do you know any good resources for GB dev?  I have been working with GbdevWiki and Retro Isle, but anything would be good at the moment.  Also, what do you suggest for sprite sizes?  I know that is a little subjective, but lets say for terrain tiles and enemies...would you have any suggestions?  Thanks in advance and sorry for the noobish questions.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__871">
                                                        <div class="mdl-card__title"><strong>cacciatc</strong> posted on 
		
			
				
				Dec 18, 2016 at 11:39:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					There&apos;s the awesome gbdev list: <a href="https://github.com/avivace/awesome-gbdev" target="_blank" original-href="https://github.com/avivace/awesome-gbdev">https://github.com/avivace/awesom...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__872">
                                                        <div class="mdl-card__title"><strong>guiltl3ss</strong> posted on 
		
			
				
				Dec 18, 2016 at 11:43:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Right on, thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__873">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 19, 2016 at 11:31:56 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	*+4 means skip four bytes. That&apos;s a cheap alternative to the local or unnamed labels in assemblers that don&apos;t have these.<br>
	<br>
	The routine worked all fine for me in a few games, without the suggested changes. <b>They&apos;re mathematically correct</b>, though (eor $ff is a cheap version of negation), but all they affect to is shifting the target point by a pixel. So it only will get issues when the target is really close, like just few pixels away.</div>
<br>
But unfortunately, I think that they cause a problem implemented in such way.
<pre><br><br><a href="http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle" target="_blank" original-href="http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle">http://codebase64.org/doku.php?id=base:8bit_atan2_8-bit_angle</a><br><br>&quot;&quot;&quot; might be more precise to add a clc adc #$01 after each eor #$ff,
    you have to modify all the preceding bcs *+4/ bcc *+4 to *+7 to
    get the branches correct. also you can omit the clc where bcs is
    used. adding a SEC before all sbc&apos;s might increase the accuracy
    even further. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span> /Oswald &quot;&quot;&quot;<br><br>octant  = $fb  	;; temporary zeropage variable<br><br>atan2   lda x1
        sbc x2
        bcs *+4
        eor #$ff
        tax
        rol octant<br><br>Modifying the code as suggested, the problem is, I think, that:
        CLC
        ADC #$01
will change the status of the carry, BEFORE the following ROL.<br><br>So the code cannot be modified in the way suggested in that note, I think.<br><br>Maybe...<br><br>        LDA 00
        STA octant
atan2   lda x1
        SEC
        sbc x2
        rol octant ; MOVED BEFORE THE BRANCHING
        BNE *+4    ; this will become a +6 instead of a +7 I guess ???
        eor #$ff
      ; CLC        ; NOT NEEDED: THE ROL ABOVE LEAVES THE CARRY CLEAR
        ADC #$01
        tax<br><br>would work?<br><br>I mean, first do the ROL, and then use a BNE rather than a BCS, can do the trick?<br><br>Or, just keep the routine in the (slightly inaccurate) way it was written
by the original author, of course. <span class="sprites_emoticons absmiddle" id="emo_wink">&#xA0;</span><br><br></pre>
<br>
Edit: added a note.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__874">
                                                        <div class="mdl-card__title"><strong>Shiru</strong> posted on 
		
			
				
				Dec 20, 2016 at 5:21:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That&apos;s implementation question. I mean that there is negation required, which is replaced with eor #$ff, but that&apos;s not really negation (similar, just off by one). So, for matematically correct results a proper negation should be used, but the code of course will be less efficient, that&apos;s why that replacement took place.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__875">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Dec 20, 2016 at 5:47:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Shiru</b></i><br>
	<br>
	That&apos;s implementation question. I mean that there is negation required, which is replaced with eor #$ff, but that&apos;s not really negation (similar, just off by one). So, for matematically correct results a proper negation should be used, but the code of course will be less efficient, that&apos;s why that replacement took place.</div>
<br>
Thanks, really appreciated.<br>
I opened a specific thread in the brewery about this topic, proposing an alternative approach, in case you have some time and would like to continue the conversation, I&apos;d be glad to know opinions about it.<br>
Again, thanks for all your answers, it really helps to get opinions and explanations by more experienced programmers. It also helps the process of bringing your own ideas together. <span class="sprites_emoticons absmiddle" id="emo_happy">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__876">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Jan 12, 2017 at 7:15:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ve been racking my brain all night and I can&apos;t seem to figure out how to draw text boxes while keeping the background information available to put back later.
<br>
<br>I tried debugging games like Earthbound Zero and Dragon Warrior to look at what happens when a menu is opened or closed, but I can&apos;t find where tiles that are replaced are stored to be put back where they belong. 
<br>
<br>However, looking at the hex values in Dragon warrior I noticed a repeating pattern of on screen tile info, as well as the location that the tiles to put back are eventually drawn from. In EB0 I noticed that certain ranges in the $0400 section are written to and read from multiple times for tile replacement, but still couldn&apos;t find the one glory area where everything gets stored. 
<br>
<br>Is it possible that the replaced tile data is stored in separate banks swappable banks with a mapper? any insight into this would be much appreciated. I haven&apos;t even started to wrap my head around mappers yet, and this will help me know it if&apos;s time to start!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__877">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jan 12, 2017 at 7:18:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Depending on the game, this can be done a couple of ways I can think of, others may have better ideas.
<br>
<br>1. Keep a working copy of the current background in memory. Change memory to reflect the background on any update. It will take a lot of memory, but it works. The just write a routine that tracks where in memory it needs to read from. This is probably most useful in scrolling games as the box may popup in different spots.
<br>
<br>2. Know exactly where your text boxes come up and just hard code copy of the background data in PRG and just call that data when you want close the text box. Best on screens that don&apos;t scroll or update the background.
<br>
<br>3. Last idea, similar to number 2, but you don&apos;t have to duplicate data.  Just create a label in the middle of your current background data table in PRG at the start of where the text box was. Again, has to be in a place where the background doesn&apos;t change and you know exactly what data needs replaced.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__878">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jan 13, 2017 at 2:59:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Text boxes are one of my favorite things <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>.<br>
<br>
For single screen games I just have it reload what needs to be on the screen from ROM, more or less the same way that I would load a room to begin with. I just limit it to what needs to be rewritten. The data is still the same, unless it has been updated in some way (treasure chest is opened instead of closed, etc.). Scrolling presents other issues, but the biggest is aligning the box with the attributes and storing/reloading things correctly. In this scheme nothing is &quot;stored&quot; since nothing is changed. *Writes have to get buffered, though, so that is what you might be seeing in the hex editor. Just a guess.<br>
<br>
I have done it the other way, where the metatile data gets stored to RAM, but I think that the above way is what I was using last. Work on Spookotron halted my other projects... for now!<br>
<br>
Kevin has another way of doing text boxes, swapping between nametables and such, but that is black magic to me.<br>
<br>
The demo version of lizard has a pretty neat way of doing them too, but it was abandoned once scrolling was implemented. It uses sprite zero hits to scroll up or down the bottom portion of the screen.<br>
<br>
So many cool ways to do them, and even more poorly implemented examples from licensed games. When you slow a lot of them down in an emulator you&apos;ll find that they did not update the order of things correctly, or make small refinements that would have resulted in some great text boxes. Check out Uforia for instance; the ordering is terrible.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__879">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jan 13, 2017 at 3:39:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br>
<br>
<strong>Kevin has another way of doing text boxes, swapping between nametables and such, but that is black magic to me.</strong><br>
&#xA0;</div>
<br>
Good call. I do this in Tailgate Party when I pause because i don&apos;t want to mess up the game screen in Nametable 0. It&apos;s actaully pretty easy. When you load Nametable 0, also load another unused table (if you are mirroring, there are only 2 usable nametables anyways) but have the second nametable have the background with the text box. When the time comes, just change the value in the Nametable High Byte variable you are using to keep track on what name table you are on and let the NMI change the nametable. You have 4 NametableHigh variable options will be:<br>
NAMETABLE0&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; = $00 ;$2000<br>
NAMETABLE1&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; = $01 ;$2400<br>
NAMETABLE2 &#xA0; &#xA0;&#xA0;&#xA0; = $02 ;$2800<br>
NAMETABLE3 &#xA0; &#xA0;&#xA0;&#xA0; = $03 ;$2C00<br>
<br>
In My Main Code:<br>
LDA #NAMETABLE1<br>
STA NametableHigh<br>
<br>
Then this is my NMI code:<br>
LDA #%10010000&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1<br>
ORA NametableHigh &#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0;&#xA0;<br>
STA $2000<br>
<br>
That is just one example. There are probably a bunch of different ways you can use this with a text box.<br>
---------------------------<br>
Another way I thought of is check out Duck Tales 2 in an emulator. I think that game manipulates the background Pattern Table if I remember correctly.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__880">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jan 13, 2017 at 3:47:13 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div>
	I&apos;m a filthy liar <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>. I looked back at my textbox code and I DO store everything in RAM. 258 bytes worth of data no less! I&apos;m going to have to change that, but look how smooth they are (even if the reloading data needs to be done in reverse in order to look better)!<br>
	<br>
	The logic was (I think, unless I changed it and did not note it):
	<div>
		&#xA0;</div>
	<div>
		Routines in this file:</div>
	<div>
		-TextBoxTable: The tiles that make up the Text Box<br>
		&#xA0;</div>
	<div>
		-SaveCurrentBGData: Saves the current BG data</div>
	<div>
		-SaveCurrentAttrData: Saves the Current Attr data for those BG tiles</div>
	<div>
		<div>
			-FindAttrValues: This is run AFTER SaveCurrentBGData/SaveCurrentAttrData, and it ORAs the results to find each set of two lines</div>
		<div>
			<span class="Apple-tab-span" white-space:>&#xA0;</span>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; (as opposed to four). These are saved in two separate variables.</div>
		<div>
			&#xA0;</div>
		-BuildTextBox: Build TB based off the of the tiles in the table</div>
	<div>
		-LoadTBAttrData: Writes new attributes to the TB area (two lines at a time)</div>
	<div>
		<br>
		-RestoreBackground: Restores the BG tiles</div>
	<div>
		-RestoreTBAttrData: Restores the correct Attributes (two lines at a time)<br>
		<br>
		The sprite moving code is missing from that, but it runs at the appropriate places. The only issue is that movement must be grid-based or you end up with sprites half in, half out. Crystalis and Final Fantasy were really bad with this, whereas games like Mother prevented the player from accessing anything textbox related until NPC movement was finished.</div>
</div>
<div>
	&#xA0;</div>
<div>
	<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/FFA98FB0-E58C-6573-938FD5361A199E4A.png" show-src="scraper/images/FFA98FB0-E58C-6573-938FD5361A199E4A.png"><br>
	<br>
	And here is what I am talking about with Uforia&apos;s being lazy. The backgrounds, attributes, and sprites all get updated separately. That initial shift is how the game is aligning the tiles. I think that Derek did that with the first screen in Owlia too, but it has been a while.<br>
	<br>
	<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/FFB416DE-99B8-1B1D-824C7DFF95F4830E.png" show-src="scraper/images/FFB416DE-99B8-1B1D-824C7DFF95F4830E.png"><br>
	<br>
	&#xA0;</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__881">
                                                        <div class="mdl-card__title"><strong>arnpoly</strong> posted on 
		
			
				
				Jan 13, 2017 at 3:58:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br>
&#xA0;
<div>I&apos;m a filthy liar <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>. I looked back at my textbox code and I DO store everything in RAM. 258 bytes worth of data no less! I&apos;m going to have to change that, but look how smooth they are (even if the reloading data needs to be done in reverse in order to look better)!</div><br><br><div>&#xA0;</div><br><br><div><img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/FFA98FB0-E58C-6573-938FD5361A199E4A.png" show-src="scraper/images/FFA98FB0-E58C-6573-938FD5361A199E4A.png"><br>
<br>
And here is what I am talking about with Uforia&apos;s being lazy. The backgrounds, attributes, and sprites all get updated separately. That initial shift is how the game is aligning the tiles. I think that Derek did that with the first screen in Owlia too, but it has been a while.<br>
<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/FFB416DE-99B8-1B1D-824C7DFF95F4830E.png" show-src="scraper/images/FFB416DE-99B8-1B1D-824C7DFF95F4830E.png"><br>
<br>
&#xA0;</div>
</div>
It looks like they wanted to load one row of tiles per frame to draw the box a bit smoother even though there would be attribute glitches.&#xA0; Perhaps they could have updated the attributes every other row so the glitches aren&apos;t as obvious.&#xA0; I don&apos;t know if I&apos;d call it lazy but certainly it could be done better.<br>
<br>
Yours loads two rows at a time so it won&apos;t have coloring glitches, however the drawing isn&apos;t quite as smooth.&#xA0; A good tradeoff though!&#xA0; <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__882">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jan 13, 2017 at 4:06:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>arnpoly</b></i><br>
	<br>
	It looks like they wanted to load one row of tiles per frame to draw the box a bit smoother even though there would be attribute glitches.&#xA0; Perhaps they could have updated the attributes every other row so the glitches aren&apos;t as obvious.&#xA0; I don&apos;t know if I&apos;d call it lazy but certainly it could be done better.<br>
	<br>
	Yours loads two rows at a time so it won&apos;t have coloring glitches, however the drawing isn&apos;t quite as smooth.&#xA0; A good tradeoff though!&#xA0; <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
	&#xA0;</div>
<br>
Yeah, it&apos;s a way of working with the system as opposed to trying to make it do things that it cannot do well. My goal is always to try to understand the true limitations and work creatively within them for the best result (in this case meaning not an MMC5 mapper with its 8x8 attributes). Between cheap memory and no deadlines, there is not much of a reason (for me personally) to have attribute glitches or things like that when creative approaches to design can solve most of them. When I think out a project it begins with solving the technical aspects, how to load a text box, how to move a bunch of NPCs around the screen, etc., and the constraints shape the creativity that follows from decisions concerning those things. Uforia&apos;s are great, don&apos;t get me wrong (the best on the system in my option), but they feel like they are forcing a square peg through a round hole when it comes to some of the decisions that they made about the ordering of things.<br>
<br>
For rocky&apos;s question, also check out Faxanadu and Super Bat Puncher. Now&#xA0;<em>their&#xA0;</em>is a creative approach!<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__883">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Jan 13, 2017 at 11:59:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					thanks for the tips! when putting it in ram, is there a specific way to do that? one time I tried changing a byte in a name table that I .incbin&apos;ed before loading it, but that didn&apos;t seem to have any affect. granted, it was one of the nametables that has the attributes included so maybe that messed it up?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__884">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 14, 2017 at 3:39:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SoleGooseProductions</b></i><br>
	<br>
	Yeah, it&apos;s a way of working with the system as opposed to trying to make it do things that it cannot do well. My goal is always to try to understand the true limitations and work creatively within them for the best result (in this case meaning not an MMC5 mapper with its 8x8 attributes). Between cheap memory and no deadlines, there is not much of a reason (for me personally) to have attribute glitches or things like that when creative approaches to design can solve most of them. </div>
<br>
<br>Very nice approach, and (judging form the animation that you posted) very interesting results: a very elegant solution to the issue! I don&apos;t think that drawing two lines at once will make the transition way less fluid than drawing just one (of course, this can be judged better testing the ROM on real hardware, rather than just looking at an animated screen shot), so I think that it is a worthy solution to implement.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__885">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Jan 15, 2017 at 8:25:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>RockyHardwood</b></i><br>
	<br>
	thanks for the tips! when putting it in ram, is there a specific way to do that? one time I tried changing a byte in a name table that I .incbin&apos;ed before loading it, but that didn&apos;t seem to have any affect. granted, it was one of the nametables that has the attributes included so maybe that messed it up?</div>
<br>
For the one that I posted above, they were just stored in order. Some tricks had to be employed in order to update them as they loaded (i.e. only loading the top two, and preserving the bottom two when not wanting to update them). When I go to rewrite them very little ram will be used, I am guessing, since it simply is not needed. I am still not sure why I did it that way <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>. That was genuinely surprising to discover that. Then again, I had not looked at it for over a year. One learns a lot in that amount of time.<br>
<br>
Are you asking for programming purposes, or for hacking an existing game? I keep everything in asm, hex files so it is easy to change or store since I know how it is loaded and arrange my data neatly. I can imagine that it would be much more difficult if hacking in a hex editor, which is well beyond my realm of expertise. The biggest thing would be to understand&#xA0;<em>how</em> they did things if so, and then investigate from there. If things are stored at the metatile level, in separate attribute pages, or whatnot.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__886">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Jan 15, 2017 at 4:45:00 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br>
<br>
Are you asking for programming purposes, or for hacking an existing game?&#xA0;</div>
<br>
programming purposes! I keep on and off working on this text engine but I&apos;ve run into the big obstacle of having the box and and off, no matter where you are. It&apos;s the storing in ram part I&apos;m having trouble understanding, I think, since I tried that once (I think) and it didn&apos;t work. Like:<br>
<br>
;;assuming some background like<br>
;;<br>
;;emptyBG:<br>
;; &#xA0; .incbin &quot;emptybg.bin&quot;<br>
;;<br>
;;where each tile is $00<br>
;;<br>
<br>
LDA #HIGH(emptyBG)<br>
STA pointer+1<br>
LDA #LOW(emptyBG)<br>
STA pointer<br>
<br>
LDY #$00<br>
LDA #$50<br>
STA [pointer], Y<br>
<br>
LDA #$20<br>
LDX #$65<br>
JSR setPPU<br>
<br>
LDA [pointer], Y<br>
STA $2007<br>
<br>
<br>
this doesn&apos;t change anything. do you mean RAM as in the first $07FF pages? or is there some sort of indexing thing I&apos;m missing?<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__887">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 15, 2017 at 7:15:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>RockyHardwood</b></i><br>
	JSR setPPU</div>
<br>
<br>
can you show me what that sub routine does?<br>
<br>
<br>
&quot; do you mean RAM as in the first $07FF pages? &quot;<br>
<br>
on the NES, yes. And page $0100 to $01ff is used for the stack, so avoid using that (at least a part of that memory page is going to be used to jump to subroutines, and push and pull data to accumulator).<br>
<br>
<br>
&quot;or is there some sort of indexing thing I&apos;m missing?&quot;<br>
<br>
In such cases, I check out myself.<br>
<br>
First run a test, from a screen homogeneous (all same tiles, all same attributes), try to change the first tile, or the first attribute, to some other value hard coded in such test code.<br>
Now, if this does work, it is a step forwards.<br>
<br>
Next try to have some place which is not the first tile or first attribute to be edited.<br>
<br>
Now, if this does work, it is a step forwards.<br>
<br>
Finally try to have indexed the source data you want to put in that place on screen, and see if it works.<br>
<br>
I am not claiming that this is a good method to solve issues, I am not a programmer academically wise, this is just the way I discover and understand things, and solve these kind of issues when programming on assembly for the NES.<br>
<br>
Better programmers than I am will probably give better advice.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__888">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Jan 16, 2017 at 3:44:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
<br>
can you show me what that sub routine does?</div>
<br>
SetPPU:<br>
<br>
&#xA0;&#xA0; &#xA0;PHA<br>
&#xA0;&#xA0; &#xA0;LDA $2002<br>
&#xA0;&#xA0; &#xA0;PLA<br>
&#xA0;&#xA0; &#xA0;STA $2006 ;input A = high byte of draw location<br>
&#xA0;&#xA0; &#xA0;STX $2006 ;input X = low byte of draw location<br>
<br>
&#xA0;&#xA0; &#xA0;RTS<br>
<br>
Yeah, that kind of approach is what I&apos;ve tried to do before... doesn&apos;t seem to do anything though. but, now that I have the clarification on what RAM we&apos;re referring to, I can get something going! thanks for that.&#xA0;<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__889">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Jan 16, 2017 at 4:07:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>RockyHardwood</b></i><br>
	[1] LDA $2002<br>
	<br>
	[2] now that I have the clarification on what RAM we&apos;re referring to, I can get something going! thanks for that.</div>
<br>
<br>[1] ok, this was what I wanted to make sure that you have in your subroutine, good.
<br>
<br>[2] you&apos;re welcome! <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
<br>Background on the NES are not impossible to understand at all, it is just that their logic is quite little intuitive and unfriendly to use. But once you enter in the mechanism, you&apos;ll do just fine.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__890">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jan 17, 2017 at 8:45:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You can safely use quite a bit of page one for RAM stuff. The stack uses the end of page one to store values/where to return from RTS, etc, so if you need more RAM space, you can very easily use $0100-$0180 and even further than that. It will of course vary project to project, but you can always watch in FCEUX&apos;s hex editor to see how much your game is typically using.
<br>
<br>Of course this is only useful if you&apos;re out of all the other RAM pages.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__891">
                                                        <div class="mdl-card__title"><strong>Beep Boop!</strong> posted on 
		
			
				
				Jan 25, 2017 at 8:44:05 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yep, some people throw music engine there. I have a software stack and a queue on the lower 128 bytes of the stack.
<br>
<br>It&apos;s OK to use but you need to be sure your code is 100% solid, without any stray push/pop (ie PHA in every frame but no PLA) because it will be impossible to recover if important data is rewritten to garbage. Most of the time the stack barely used 32 bytes, much less the full 256.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__892">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 1, 2017 at 11:32:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Alright, I have a question it is a while that I&apos;m thinking about.<br>
<br>
We assume that sprites are transfered each NMI, and stored in $0200, like described here:<br>
<br>
<a href="http://vintage.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=6082" target="_blank" original-href="http://vintage.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=6082">http://vintage.nintendoage.com/fo...</a><br>
<br>
Sprites are hidden behind higher priority sprites.<br>
E.g. sprite in $0200 $0201 $0202 $0203 is displayed on top of anyone else.<br>
<br>
Sprites are hidden behind the background if you set a specific bit into the $020x+2 byte.<br>
E.g. sprite in $0200 $0201 $0202 $0203 is displayed behind the background if the byte in $0202 is, for instance, #$20.<br>
<br>
Now, let&apos;s imagine this scenario:<br>
<pre>x = filled color pixel
o = transparent color pixel<br><br>Background pattern (let&apos;s assume all screen the same):
xxxxxxxx
xxxxxxxx
xxxxxxxx
xxxxxxxx
xxxxxxxx
xxxxxxxx
xxxxxxxx
xxxxxxxx<br><br>Pattern Sprite $0201:
xxxxxxxx
xxxxxxxx
xxxxxxxx
xxxxxxxx
xxxxxxxx
xxxxxxxx
xxxxxxxx
xxxxxxxx<br><br>Attribute $0202: #$20<br><br>Pattern Sprite $0205:
oooxxooo
oooxxooo 
oooxxooo
xxxxxxxx
xxxxxxxx
oooxxooo 
oooxxooo
oooxxooo
 
Attribute $0206: #$00</pre>
X and Y position are exactly the same, for both sprites $0200 (... 1, 2, 3) and $0204 (... 5, 6, 7); i.e. the sprites overlap each other.<br>
<br>
So, can you see what I am wondering about?<br>
If both sprites were displayed above the background (i.e. attribute in $0202 was for instance #$00 instead of #$20), you would NOT see the cross from sprite $0204 $0205 $0206 $0207, and you would just see the square 8x8 px from the sprite $0200 $0201 $0202 $0203.<br>
<br>
In this case instead, with such attribute being #$20, what happens?<br>
<br>
a. you will see nothing, just teh background, since sprite $0200 (..1,2,3) covers sprite $0204 (..5,6,7), and is in turn covered by the background; or<br>
<br>
b. you will see the cross in sprite $0204 (..5,6,7), since sprite $0200 (..1,2,3) would NOT covers $0204 being itself covered by the background; while sprite $0204 (..5,6,7), not covered by the background, will be fully displayed.<br>
<br>
??<br>
I can of course run some test in emulator, but I&apos;d like to know for sure on real hardware.<br>
<br>
I hope this makes sense in English, sorry about that, not my first language. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
if my doubt is not really clear from what I wrote here above, please say so, I&apos;ll try to explain it again.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__893">
                                                        <div class="mdl-card__title"><strong>Broke Studio</strong> posted on 
		
			
				
				Feb 2, 2017 at 1:07:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Humm, that&apos;s a tricky question.
<br>
<br>I guess (b) would be a logical answer but who knows ...
<br>I can test on hardware if you want and have a test ROM.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__894">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 2, 2017 at 6:03:39 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>glutock</b></i><br>
	<br>
	Humm, that&apos;s a tricky question.<br>
	<br>
	I guess (b) would be a logical answer but who knows ...<br>
	I can test on hardware if you want and have a test ROM.</div>
<br>
<br>Alright!
<br>
<br>Give me an half hour or so (make it an hour to be sure in case other business pops up) and I&apos;ll provide you a test ROM. Of course, no hurries, if and when you have time.
<br>
<br>However, besides a real hardware test, which is of course extremely welcome, I&apos;d like to know in theory how should the NES hardware handle the scenario. If anyone knows.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__895">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 2, 2017 at 6:57:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>glutock</b></i><br>
	<br>
	Humm, that&apos;s a tricky question.<br>
	<br>
	I guess (b) would be a logical answer but who knows ...<br>
	I can test on hardware if you want and have a test ROM.</div>
<br>
<br>
Here it is!<br>
(see attachments, test.chr.txt is the CHR ROM, you must remove the last .txt).<br>
<br>
And, well, in FcEux 2.1.4a the answer is A!<br>
<br>
Sorry, I cannot test in FcEux 2.2.3 under Win at the moment, and 2.1.4a it is not very recent and reliable, so it is likely that in real hardware (or on a better version of FcEux) it could be different.<br>
<br>
If you do run a test in real hardware, let me know, it would be very appreciated!<br>
<br>
<br>
<br>
Reason for editing: I had hard time uploading .chr and .txt files.<br>
Also, I messed the test output, it was A, and NOT B!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__896">
                                                        <div class="mdl-card__title"><strong>Broke Studio</strong> posted on 
		
			
				
				Feb 2, 2017 at 7:38:34 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Same result (A) on the AVS, PAL NES, NTSC NES.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__897">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 2, 2017 at 7:43:45 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>glutock</b></i><br>
	<br>
	Same result (A) on the AVS, PAL NES, NTSC NES.</div>
<br>
<br>Very interesting results!
<br>Thanks a lot!
<br>So, I guess that the NES first decide which pixels of the sprites potentially draw based on the sprites priority, and then decides if such pixels are above or hidden below the (not transparent) background pixels.
<br>Nice to know! <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__898">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Feb 2, 2017 at 7:59:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I would have guessed A, but that&apos;s tough to prove knowing that I already read the answer before posting. <span class="sprites_emoticons absmiddle" id="emo_tongue">&#xA0;</span>
<br>
<br>Logically it makes sense. Take the background completely out of the question, what happens? Sprite $0200 with attr $20 will cover sprite $0205 with attr $00 with a transparent background. Populating the the background with non-transparent tiles after the fact doesn&apos;t change the sprite priority. 2 completely different routines.
<br>
<br>1 potential place to check this is in Mario 3 where Mario can go behind the background but the enemies stay in the foreground assuming Mario is the Higher priority (world 1-3 i think has the best chance of this). However, the programmers may have taken this into account and mitigated the issue before hand.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__899">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 2, 2017 at 8:24:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	Logically it makes sense. Take the background completely out of the question, what happens? Sprite $0200 with attr $20 will cover sprite $0205 with attr $00 with a transparent background. Populating the the background with non-transparent tiles after the fact doesn&apos;t change the sprite priority. 2 completely different routines.</div>
<br>
Yep, this is pretty much what our tests seem to prove. Thanks for wording it out in proper English. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
<br>
I, honestly, before testing, had no clue if this was the logical sequence, or the opposite one (i.e. first determine which sprite pixels are covered by not transparent background pixels, and then afterwards put sprite priority into play).<br>
<br>
Also, I assume that the test ROM I attached above is quite reliable to test this out, and the source (well, in my weird alien asm dialect, sorry about that) is available to check out what it does. However, if someone think that a better test should be made, be my guest! <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
<br>
However, this is really good to know for me, since I like to use sprites a lot, and I use a lot the feature of covering them by background, and the fact that an high priority sprite &quot;under background&quot; with the attribute bit 5 set can work as a mobile immediate &quot;cast shadows filter&quot; over other sprites, no matter if &quot;above background&quot;, it is a nice little trick to know about! <span class="sprites_emoticons absmiddle" id="emo_wink">&#xA0;</span><br>
<br>
Edit: misspelling, minor correction to a couple of sentences.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__900">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Feb 14, 2017 at 10:31:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Looking for a good tutorial for doing collision detection for something similar to pool. All the tutorials I can find show you how to to collision detection if Object A hit Object B. But, I&apos;m looking at what if Object A and Object B have 4 parts a piece that different things happen. So, like in pool, if the cue ball sticks the 8 Ball at a certain angle and speed, the collision could happen on different points of each ball. This would cause each ball to travel at certain angles at different speed based on the original speed of the cue ball. Let&apos;s say you hit the 8 ball dead on, the 8 ball absorbs nearly all of the blow and travels straight at the same rate of speed that cue ball was. The cue ball would nearly come to a complete stop. However, let&apos;s say you clip the side of the 8 ball, it would travel at a much lower rate of speed at a 90 degree angle in comparison to the cue ball. The cue ball would lose a bi of speed and glance off the 8-ball at a small angle. I would imagine pinball and bowling have the same challenges. Thanks for any input you have!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__901">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 14, 2017 at 3:08:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Mega Mario Man</b></i><br>
	<br>
	Looking for a good tutorial for doing collision detection for something similar to pool. All the tutorials I can find show you how to to collision detection if Object A hit Object B. But, I&apos;m looking at what if Object A and Object B have 4 parts a piece that different things happen. So, like in pool, if the cue ball sticks the 8 Ball at a certain angle and speed, the collision could happen on different points of each ball. This would cause each ball to travel at certain angles at different speed based on the original speed of the cue ball. Let&apos;s say you hit the 8 ball dead on, the 8 ball absorbs nearly all of the blow and travels straight at the same rate of speed that cue ball was. The cue ball would nearly come to a complete stop. However, let&apos;s say you clip the side of the 8 ball, it would travel at a much lower rate of speed at a 90 degree angle in comparison to the cue ball. The cue ball would lose a bi of speed and glance off the 8-ball at a small angle. I would imagine pinball and bowling have the same challenges. Thanks for any input you have!</div>
<br>
<br>
So, you have a point, following a line, with a given vectorial speed.<br>
<br>
I have never done that, but I think that you will need 2 variables: speed, angle; plus likely another 2 variables to do the math: x offset, y offset. About angle few posts above there is a link provided by Shiru.<br>
<br>
I prefer to think in terms of points on a surface rather than sprites.<br>
<br>
Bunnyboy made a pinball game, probably he can help more.<br>
<br>
If you need a demo, let me know, I can try to do something working.<br>
<br>
<br>
How much ROM you can waste with lookup tables?<br>
How many possible directions? 8, 16, 256?<br>
<br>
Disclaimer: not a programmer academically wise, so my solution maybe are not the best.<br>
<br>
Edit: added questions, correction.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__902">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Feb 14, 2017 at 3:23:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If the seconds ball does not move before collision, it shouldn&apos;t be too hard, given ROM space enough for lookup tables.<br>
I am rather busy, else it would be a nice exercise to do in assembly.<br>
Really I think is all about speed, angle, x offset, y offset; generating a new couple of speed and angle values for the second ball.<br>
With lookup tables and a spread sheet (or script) to generate them, it should be reasonably easy.<br>
<br>
Edit: correction.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__903">
                                                        <div class="mdl-card__title"><strong>CanadianRyGuy</strong> posted on 
		
			
				
				May 10, 2017 at 2:31:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					OK, here is kind of a tough question to which there is probably no simple answer to...but I&apos;ve always thought it would be cool to see some of my favourite arcade side-scrollers, like X-men or The Simpsons be ported to SNES, much in the same way that Turtles in Time or Sunset Riders did. How difficult would this task be? I would assume that you could take the source code from the arcade games, work a little magic, and have it playing on an SNES in no time, right?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__904">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				May 10, 2017 at 2:41:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>CanadianRyGuy</b></i><br>
<br>
OK, here is kind of a tough question to which there is probably no simple answer to...but I&apos;ve always thought it would be cool to see some of my favourite arcade side-scrollers, like X-men or The Simpsons be ported to SNES, much in the same way that Turtles in Time or Sunset Riders did. How difficult would this task be? I would assume that you could take the source code from the arcade games, work a little magic, and have it playing on an SNES in no time, right?</div>
That&apos;d be about 5 years of magic if my experience with just NES games is any indication. I gave myself 5 years to finish my first homebrew, and it took 3.5 years just for NES. So 5 years is probably a reasonable timeline for a large SNES port (<strong>not to conflate homebrew with port, these are different things</strong>, but going from one system to a totally different system would be a similar effort, minus original asset creation, unless it turns out the target system requires significant asset modification, in which case you&apos;ve got something similar in scope to a homebrew, only perhaps worse because you have to study somebody else&apos;s code/game behavior). That&apos;s working 3 evenings a week balanced with the rest of life, smarter/harder working folks could probably pull it off in 2 or 3 years.<br>
<br>
*edit* I of course forgot to mention, depending on the arcade game and how complex its hardware was with layering and sprite load etc. it may actually be impossible to do a perfect port to SNES.<br>
<br>
Unless of course you&apos;re lucky and the arcade hardware is really really similar to SNES or provides enough similar functions you could write some kind of translator...I guess somebody did that with SMB1 to the Genesis, but I imagine that wouldn&apos;t be trivial either...just from knowing the SNES is kinda difficult to program, particularly the sound chip from what I&apos;m told.<br>
<br>
*edit* Just looked up that SMB1 to Genesis port. According to this article:&#xA0;<a href="http://kotaku.com/5578821/super-mario-bros-finally-faithfully-ported-to-sega-genesis" target="_blank" original-href="http://kotaku.com/5578821/super-mario-bros-finally-faithfully-ported-to-sega-genesis">http://kotaku.com/5578821/super-m...</a> &#xA0;It wasn&apos;t just the translator, a lot of manual adjustment had to be made.<br>
<br>
Still an ambitious project if somebody took it on. Programming is hard. (not to scare anyone off; it&apos;s a GOOD hard. You feel as though you&apos;ve reached the summit of Mt. Everest when you finish a project on a retro system.)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__905">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				May 10, 2017 at 6:39:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>CanadianRyGuy</b></i><br>
<br>
OK, here is kind of a tough question to which there is probably no simple answer to...but I&apos;ve always thought it would be cool to see some of my favourite arcade side-scrollers, like X-men or The Simpsons be ported to SNES, much in the same way that Turtles in Time or Sunset Riders did. How difficult would this task be? I would assume that you could take the source code from the arcade games, work a little magic, and have it playing on an SNES in no time, right?</div>
<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=64049" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=64049">http://nintendoage.com/forum/mess...</a><br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__906">
                                                        <div class="mdl-card__title"><strong>CanadianRyGuy</strong> posted on 
		
			
				
				May 11, 2017 at 1:22:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Perfect, answered my question quite succinctly lol<br>
<br>
Best follow up question lol...<br>
<span style="box-sizing: border-box; font-weight: 700; font-size: 11px;">But I don&apos;t want to waste my time.&#xA0; Can&apos;t anyone else do it?</span><br style="box-sizing: border-box; font-size: 11px;">
<br>
No need to answer that one hahaha
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__907">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				May 11, 2017 at 2:05:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>CanadianRyGuy</b></i><br>
	<br>
	Perfect, answered my question quite succinctly lol<br>
	<br>
	Best follow up question lol...<br>
	<span box-sizing: font-size: font-weight:>But I don&apos;t want to waste my time. Can&apos;t anyone else do it?</span><br box-sizing: font-size:>
	<br>
	No need to answer that one hahaha</div>
<br>
<br>
<i>&quot;Impossible is nothing&quot;</i><br>
- Adidas commercial<br>
<br>
That being said, you need to acquire the rights, from the legitimate owners, to port such games to the SNES, and then hire a competent developing team knowing about SNES architecture to port the game (engine, music, graphics, ...) adapting it to such specifics. This is quite an important budget.<br>
<br>
If you ask instead for a game that plays similarly, but does not require buying the rights over such franchises, then the budget will be less, but still quite important anyways.<br>
<br>
There are few experts in SNES programming in this brewery I believe, who could probably be more precise about it, I really do not know how much time and effort would cost what you ask, but my guess is that, like GradualGames already stated, there is a ton of work, way more than what you imagine, judging from your light-hearted post.<br>
<br>
I hope this helps, I am not sure it does. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
<br>
Also, all this is as far as I know, I could be wrong, so please take this answer for what it is worth. More competent people in copyright matters and SNES programming would likely give you a better answer,
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__908">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				May 19, 2017 at 3:02:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Could anyone here help me understand a little more about the DMC channel?
<br>I&apos;m trying to figure out how to rip samples from other games which have instruments that I like.
<br>
<br>for instance, I&apos;ve been looking through the code of Earthbound 0. I&apos;ve set the debugger of FCEUX 2.2.2 to pause whenever the snare drum plays (break at $8E54). I see some code that looks like:
<br>
<br>LDA #$0F
<br>LDY #$02
<br>STA $4013 
<br>STY $4012
<br>
<br>if I pause it when the bass drum plays (break at $8E4E), it uses this code:
<br>
<br>LDA #$07
<br>LDY #$00
<br>...
<br>STA $4013 
<br>STY $4012
<br>
<br>from what I understand, $4013 is the length of the sample- 15 bytes. $4012 is part of the address, which is something like $C000 + value of $4012*64, right? 
<br>Additionally, I gathered from NESDEV that $4011 is where the played bits end up, but is handled internally by the APU, as it&apos;s never set in the game outside of resetting it to #$00.
<br>
<br>so that should mean at $C000 and $C080 I should find some bytes in the memory that look pretty random to fit all those bits in. but when I look at the first 7 bytes of $C000 in NES memory, all I see is
<br>
<br>$C000: FF FF FF FF FF FF FF
<br>
<br>and for $C080 I see
<br>
<br>$C080: FF B7 20 0B 00 00 00 00 C0 FF FF FF FF FF FF 
<br>
<br>neither of which look random enough to be an audio sample... Does anyone know what&apos;s going on here and can help me find the data I&apos;m looking for, or understand the data I do have? 
<br>
<br>thank you!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__909">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				May 20, 2017 at 1:06:18 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>RockyHardwood</b></i><br>
<br>
neither of which look random enough to be an audio sample... Does anyone know what&apos;s going on here and can help me find the data I&apos;m looking for, or understand the data I do have?</div>
Your analysis seems correct. However, are you sure that the correct bank was mapped in when you were looking at the memory?<br>
<br>
In any case, you can quickly verify whether any given chunk is a DMC sample by copy-pasting the data into a hex editor, saving the file as <strong>sample.dmc</strong>, and opening it in FamiTracker for playback. (Note that you should not put more than 4 KB into the .dmc file, as that is the maximum amount that NES can play at once.)<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__910">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				May 20, 2017 at 3:17:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
<br>
are you sure that the correct bank was mapped in when you were looking at the memory?<br>
&#xA0;</div>
<br>
Hadn&apos;t thought of that... But since it&apos;s loading from the NES memory and not straight from the ROM, wouldn&apos;t whatever is in C000 at the time be the right data...? I&apos;ll put it through famitracker and see what happens, and try all the C000&apos;s from the ROM hex as well. Thanks!<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__911">
                                                        <div class="mdl-card__title"><strong>thefox</strong> posted on 
		
			
				
				May 20, 2017 at 6:27:56 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>RockyHardwood</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
<br>
are you sure that the correct bank was mapped in when you were looking at the memory?<br>
&#xA0;</div>
<br>
Hadn&apos;t thought of that... But since it&apos;s loading from the NES memory and not straight from the ROM, wouldn&apos;t whatever is in C000 at the time be the right data...? I&apos;ll put it through famitracker and see what happens, and try all the C000&apos;s from the ROM hex as well. Thanks!</div>
If you looked at the memory while you were stepping through the code which had those $4012/$4013 writes, then yeah, the correct bank probably was already mapped in.<br>
<br>
(P.S. If you want to find out which ROM address corresponds to an address in the CPU address space, you can right click in the FCEUX Hex Editor (with View -&gt; NES Memory checked), and select &quot;Go Here in ROM File&quot;.)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__912">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				May 20, 2017 at 10:12:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>thefox</b></i><br>
<br>
If you looked at the memory while you were stepping through the code which had those $4012/$4013 writes, then yeah, the correct bank probably was already mapped in.<br>
&#xA0;</div>
<br>
Well, I tried it and it didn&apos;t work... is the address that the DMC channel looks at mapper specific? I guess I could try every thing after C000, like D0000, E000, F000... I know that&apos;s not how it works but it&apos;s worth a try. might explain why the DMC ripper I found online earlier doesn&apos;t work on it.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__913">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 20, 2017 at 10:47:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>RockyHardwood</b></i><br>
<br>
from what I understand, $4013 is the length of the sample- 15 bytes.&#xA0;</div>
Writing $0F to $4013 means it will play 241 bytes, not 15. &#xA0;The length of the sample in bytes is set by register $4013 (length = %LLLL.LLLL0001) -&#xA0;&#xA0;<a href="http://wiki.nesdev.com/w/index.php/APU#DMC_.28.244010-4013.29" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/APU#DMC_.28.244010-4013.29">http://wiki.nesdev.com/w/index.ph...</a> &#xA0;So you got the start address correct but not enough data.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__914">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				May 20, 2017 at 11:06:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					OOOOOOO okay<br>
<br>
I figured it out<br>
<br>
the value in 4013 does not mean the literal byte size. it refers to how many ROWS of 16 bytes. I didn&apos;t read the NES dev page too well I guess, cause it&apos;s right here:<br>
<br>
Sample length = %LLLL.LLLL0001 = (L * 16) + 1<br>
<br>
whoops. looks much more like a real sound wave now that I see it in famitracker, though<br>
<br>
EDIT: like bunny boy just said. Thank you!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__915">
                                                        <div class="mdl-card__title"><strong>S. P. Sour</strong> posted on 
		
			
				
				Aug 13, 2017 at 6:02:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I hope this is the right thread for this but if not please correct me.<br>
<br>
I have been getting started with NES homebrew recently (and with what else but Nerdy Nights) so that I could make a game for my friend&apos;s birthday. The tutorials there were pretty helpful for getting things started, and I have tried to learn 6502 ASM before so the actual commands made enough sense. I had a lot of trouble with backgrounds though, the PPU (or whatever) was acting really strange with the data I was giving it. I initially fixed it and figured it wouldn&apos;t be a problem.<br>
<br>
Unfortunately, I later realized I wanted dialogue boxes in the game, and there does not seem to be a tutorial for that. I figured it&apos;s just uncommon; the closest thing in a NES game I can remember would be in Zelda II where you can talk to the village people and a little box comes up with &quot;I AM ERROR&quot; or whatever rubbish the NPC has to say. Anyways, I figured I would have a go at figuring it out myself, and this is where this ramble becomes relevant to this topic.<br>
I figured the most logical thing to do would be to design the dialogue box(es) and have the program render it as a section of background in the middle of the screen. (And if I added enough dialogue, I could have a subroutine that draws the same box every time so you can just specify the text or whatever.) I knew that you could draw background starting at a certain point - I used that to draw the lower 3 rows of tiles in the game, as beyond the floor and some text I didn&apos;t bother with a full background.<br>
I tried this and ran into a problem, the same one I&apos;d faced before.<br>
<strong>The problem:</strong> What happens is, the game loads a certain number of tiles (in this case I think it&apos;s $57 or DEC-87), and then loads all the rest of the tiles into the latter 4 spaces of the first 5 or so, constantly overwriting that 4-tile space when it reaches the last spot. This is confusing the heck out of me, and worst of all, no one seems to have run into this problem before. (If they have, then I just used the wrong keywords in Google <span class="sprites_emoticons absmiddle" id="emo_tongue">&#xA0;</span>) Here&apos;s a link to a screenshot of the error in action: <a href="http://imgur.com/3zACpFm" target="_blank" original-href="http://imgur.com/3zACpFm">http://imgur.com/3zACpFm...</a> (The &quot; TH! &quot; space is usually something random, but I changed the number of tiles the procedure loads so that you can clearly see that it&apos;s continuing from the same set of text\tiles to load.)<br>
<br>
<strong>If additional info helps:</strong><br>
-It appears the same way in the nametable, so the problem is clearly (to me anyways) in how the PPU is assigning each new tile to the VRAM or whatever it is.<br>
-All game logic is currently inside the NMI loop, as there isn&apos;t really a whole lot going on in the game.<br>
-I use the given method of loading from $2002, putting the address into $2006, and then feeding everything into $2007.<br>
-I have a separate procedure where the game does a similar loop, but just constantly STA&apos;ing 0 into the slot, to &apos;erase&apos; the dialogue box. This works perfectly, or at least, much more successfully.<br>
--Whenever the above &apos;erase&apos; procedure is performed, the floor+floortext (the only piece of background other than the dialogue) temporarily jumps up to the space where dialogue is intended to be drawn. This happens in like a split-second, although it&apos;s still noticeable. The nametable does not change, despite the obvious visual hiccup.<br>
<br>
<strong>TL;DR:</strong> <strong>Trying to make a game for my friend. Tried to render dialogue boxes as a mid-screen section of background and the PPU had a hissy fit.</strong><br>
<br>
If needed, I wouldn&apos;t mind providing snippets of code from what I have.<br>
<br>
Thanks, please help if you can!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__916">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Aug 13, 2017 at 6:22:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you could show us the code where the text is drawn to the screen, that&apos;d be great. I&apos;ve been working on creating a text engine myself, so I know the struggle that comes with it and would love to see what I can do to help!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__917">
                                                        <div class="mdl-card__title"><strong>S. P. Sour</strong> posted on 
		
			
				
				Aug 13, 2017 at 6:52:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oh thank you for the quick reply! Here is the relevant section.
<br>
<br>Drawlspeech:
<br>  LDA $2002
<br>  LDA #$21
<br>  STA $2006             ;This beginning part mostly C+P&apos;d from the NN tutorial
<br>  LDX #$A0              ;Note I load in address $21A0 as the start point, if that&apos;s important. Earlier in the code, I load in the floor background starting at $23F0.
<br>  STX $2006
<br>  LDX #$00
<br>dlload:
<br>  LDA Ldialogue,x
<br>  STA $2007
<br>  INX
<br>  CPX #$5B     ;The error can be seen when this value is increased beyond #$57. #$5B is what I used in the screenshot, but it&apos;s usually set to #$60.
<br>  BNE dlload
<br>  LDA #$01
<br>  STA State     ;A variable I use to keep track of whether or not a dialogue box is being displayed (mostly to disable movement and stuff)
<br>  
<br> ;LDA #%10010000   ;&quot;enable NMI, sprites from Pattern Table 0, background from Pattern Table 1&quot;
<br> ;STA $2000           ;This was something in the NN tutorial that followed the background loading tutorial. I tried putting it here to see if it would fix the problem. It didn&apos;t, so the code is disabled.
<br>
<br> ;LDA #%00011110   ;&quot;enable sprites, enable background, no clipping on left side&quot;
<br> ;STA $2001         ;See above.
<br>  
<br> ;LDA #$00        ;&quot;tell the ppu there is no background scrolling&quot;
<br> ;STA $2005       ;See above.
<br> ;STA $2005
<br>  JMP notalk      ;A label a little bit after Drawlspeech is called. I would use JSR, but whenever I tried to use RTS, the assembler gave me strange, nonsensical errors. (I later realized this was caused by spacing mistakes, but never bothered to go back and change everything to subroutines)
<br>
<br>&apos;Ldialogue&apos; goes to a set of .db bytes that basically spell out the dialogue box tile by tile. (I still want to optimize this later, but I&apos;m currently tackling the bigger issue.)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__918">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Aug 13, 2017 at 7:47:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>S. P. Sour</b></i><br>
<br>
<br>
dlload:<br>
LDA Ldialogue,x<br>
STA $2007<br>
INX<br>
CPX #$5B ;The error can be seen when this value is increased beyond #$57. #$5B is what I used in the screenshot, but it&apos;s usually set to #$60.<br>
BNE dlload</div>
I&#xA0;<em>think&#xA0;</em>I see the issue here, at least initially- drawing upwards of 96 tiles in one frame is a little more than the NMI can handle. Here&apos;s a couple things you can do:<br>
<br>
First, you&apos;ll want to create some variables. You can use a 2-byte variable to keep track of the address of the PPU the &quot;printhead&quot; will print at next- load it to 2006 and increment it each print. then, keep a 1 byte variable to store into x that you can use to index into Ldialouge, which you can also increment.<br>
<br>
you can use these to easily either print one tile per frame or multiple tiles in a couple frames.&#xA0;<br>
<br>
an example of printing one tile per frame would look like this:<br>
<br>
LDA $2002<br>
LDA ppuPrintHead+1 ; HI of printhead location<br>
STA $2006<br>
LDA ppuPrintHead; LO of printhead location<br>
STA $2006<br>
...<br>
...<br>
dlload:<br>
LDX printIndex ;index of current character in string<br>
LDA Ldialouge, x&#xA0;<br>
STA $2007<br>
<br>
INC printIndex<br>
INC ppuPrintHead<br>
<br>
LDA ppuPrintHead ;check to see if we flipped the LO byte<br>
CMP #$00<br>
BNE .done<br>
INC ppuPrintHead+1 ;increment the HI byte<br>
...<br>
...<br>
<br>
Hope this helps. For your screen jumping problem, I think I&apos;d have to play around with the actual code. I remember something like that happening to me before, but I forgot how to fix it...<br>
<br>
EIDT: fixed a HI/LO mixup
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__919">
                                                        <div class="mdl-card__title"><strong>S. P. Sour</strong> posted on 
		
			
				
				Aug 13, 2017 at 8:48:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That sounds right, especially if that includes updating whatever&apos;s already on screen(?). I&apos;ll try your solution as soon as I can and get back to you if it doesn&apos;t work (or to thank you if it does!)<br>
<br>
Just out of curiosity, would it work to take the code outside of NMI and into the main loop, or is that completely illogical\contradictory?<br>
<br>
<strong>EDIT:</strong> I have tried your solution. While loading one tile at a time isn&apos;t very fast, and working with the variable address will get a little weird for me, it&apos;s nothing I can&apos;t improve\help on my own. Thanks so much! This will help me immensely.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__920">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Aug 13, 2017 at 11:40:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, if you&apos;re updating other stuff with it there&apos;s a higher possibility of the NMI ending too early.<br>
<br>
When it comes to partitioning between the main loop and the NMI, the general idea is to have all the logic taken care of in the main loop while the NMI handles the draws. for instance, the main loop would calculate&#xA0;<em>where&#xA0;</em>a sprite would be, and the NMI would just plug those values into the sprites. If you had, say, lots of different BG tile data to draw from, you could have the main loop figure out what tiles are needed where,fill up a draw buffer with the tiles to draw, and then the NMI could just spit out the buffer on its turn. that gives you a lot of time to put more tiles in where putting all the logic in the NMI would cut you short.&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__921">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Aug 25, 2017 at 11:36:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Im new to 6502 using NESASM.  I have a question about 6502.  If I have a buffer and two bytes represent the high and low byte of something.  How do I turn those into one address to load the value into the accumulator?  I think its called indirect addressing but not sure of the syntax.  Any help/example code would be much appreciated.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__922">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Aug 26, 2017 at 1:51:10 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					so I&apos;m assuming you mean you have a variable two bytes big to hold an address like a pointer? then all you need to do is<br>
<br>
<br>
LDY #$00<br>
LDA [pointer], y<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__923">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Aug 26, 2017 at 10:09:52 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That makes sense. &#xA0;So is pointer the high byte and y is adding the low byte? So:<br>
<br>
(psudeocode)<br>
$2000 = #$0F<br>
pointer = $20 (highbyte)<br>
LDA [pointer], y = LDA #$0F<br>
<br>
Is this correct? &#xA0;That way you could keep incrementing y to get the next address?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__924">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Aug 26, 2017 at 11:30:15 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					not exactly. Pointer would be declared as
<br>
<br>Pointer .rs 2
<br>
<br>Then you would load an address into it like
<br>
<br>LDA #$00         ;low byte of address
<br>STA Pointer     ;into low byte of pointer
<br>LDA #$20         ;high byte of address
<br>STA Pointer+1 ;into high byte of pointer
<br>
<br>
<br>Where Pointer had both the high byte /and/ the low byte. 
<br>Then you can use y to index into the address. So then with your example
<br>
<br>
<br>LDA #$0F
<br>STA $2000
<br>LDY #$00
<br>
<br>LDA [Pointer], y
<br>
<br>Would load 0F into A, as putting Pointer in brackets indicates indirect indexing with a pointer. Notice here, we have to use y to do this.
<br>
<br>You can also replace that direct store to $2000 by doing the same thing 
<br>
<br>LDA #$0F
<br>LDY #$00
<br>STA [Pointer], y ; same as STA $2000
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__925">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Aug 26, 2017 at 12:03:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry Im full of questions today.  So I am trying to figure out the best way of holding simple player and enemy attributes.  I am wondering how everyone feels the best way of doing this is.  I know you could declare a variable for everything but am wondering if there is a better way.  I would think that a simple way would be to have a byte and assign each bit as a flag.  I want to investigate this but don&apos;t know if you can easily set/get each individual bit.  So if I had %00010000 where the &apos;1&apos; is the value I need (and all of the rest could be other flags set to 1 or 0) is there a way of just getting the value of that bit or setting that bit?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__926">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Aug 26, 2017 at 12:19:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Not too hard, I do the same thing. This is taken care of with some bit operations.<br>
<br>
To check a bit, AND the byte with a mask, like this<br>
<br>
LDA Flags ; Flags = %10010011<br>
AND #%00010000<br>
<br>
You&apos;ll either get %0001000 or %00000000 out of it.<br>
From here, you can use BEQ or BNE since you just need to know if it came out as 0 or not.<br>
<br>
You can set a bit to 1 like this:<br>
<br>
LDA Flags ;%10000011<br>
ORA #%00010000<br>
STA Flags<br>
<br>
And set it to 0 like:<br>
<br>
LDA Flags ;%10010011<br>
AND #%11101111<br>
STA Flags<br>
<br>
EDIT: fixed the #&apos;s
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__927">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Aug 26, 2017 at 7:55:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Week 5 of MetalSlime&apos;s Advanced Nerdy Nights has a really good explanation of pointer tables as well.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__928">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Aug 30, 2017 at 11:28:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Found something weird in NESASM3 today.  Building on my explanation of how to use a byte for flags and how to set bits of that byte to 1 and 0, I have been progressing nicely.  Thanks to all that helped!  But when I set bit 1 of my variable to 1 (from $%00000000 to #%00000010) it was locking up the emulator.  Now it took me a really long time to figure out what was going on.  I thought it was some stupid coding mistake but when I kept the bit at zero but flipped my logic to do what it should do when it was 1 the logic worked fine.  I moved my variable down a couple of lines to become the last variable declared because I know that when we declare variables they get put at addresses and the address increases as we go down the program.  Doing this make the program to behave correctly and no longer locked up the emulator. Does this mean that this variable was taking up an address that it shouldn&apos;t have been or something?  Just wondering for future development.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__929">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Aug 31, 2017 at 1:27:43 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>brilliancenp</b></i><br>
	<br>
	Found something weird in NESASM3 today. Building on my explanation of how to use a byte for flags and how to set bits of that byte to 1 and 0, I have been progressing nicely. Thanks to all that helped! But when I set bit 1 of my variable to 1 (from $%00000000 to #%00000010) it was locking up the emulator. Now it took me a really long time to figure out what was going on. I thought it was some stupid coding mistake but when I kept the bit at zero but flipped my logic to do what it should do when it was 1 the logic worked fine. I moved my variable down a couple of lines to become the last variable declared because I know that when we declare variables they get put at addresses and the address increases as we go down the program. Doing this make the program to behave correctly and no longer locked up the emulator. Does this mean that this variable was taking up an address that it shouldn&apos;t have been or something? Just wondering for future development.</div>
<br>
Hi,<br>
<br>
In which RAM page is your variable? The debug tools of FcEux can help you with this. From your description, the only thing I can think of is if the variable ended up in a byte of the stack page $0100, messing up the addresses for the rts instructions. To be honest, my bet is that there is a more obvious mistake crashing your code, however, without source code, I cannot help you more.<br>
For sure, $% is a wrong prefix, it should be #% like you have written below in your post; but I am sure you just mistyped it here. By the way, variable placement in memory, #%, #$, and other syntax related things were in the things pushing me towards programming my own assembler and setting up my assembly dialect syntax: I find so easier to program something, than learn the syntax and logic of another assembler made by someone else. But I digress, and this is just me maybe. If your intention is to work with NESASM3, I suggest you to find a complete document about NESASM3 syntax which I believe would help you a lot. Impressing progress so far, keep it up.<br>
<br>
Side note tip about your previous questions on updating a score on screen: in general, of course, do not waste sprites, they are small, and only 64; but also don&apos;t have unused sprites: to update background tiles when you could have the same result using unused sprites, adds complexity, bytes, cycles, and all.<br>
<br>
Consider this: you transfer all your 64 sprites each NMI anyways; so, if really all sprites are used, or there are not 10 empty places for digits in your sprite CHR, or the sprites palette cannot display digits the color you want, or your goal is to learn specifically how to update a specific background tile, or there is any good reason to not use sprites to update your score, then use backgrounds tiles updates, perfect; else, if you still have unused sprites, use these sprites also on your status/score bar: you save processor time removing a further routine in critical V-Blank, save few bytes on code, save few bytes of variables, and sprites are more flexible in any possible way compared to background tiles: you can put them in any x or y coordinate, color them more easily, flip them, and whatever else does not apply to background tiles.<br>
<br>
At least, this is my opinion: don&apos;t waste them, but use them all before deciding to use background updates instead. Just my two cents, from my experience, trying to help; I can be wrong. Better programmers will likely give you more solid advice.<br>
<br>
Kind Regards.
<br>
<br>Edit: misspelling.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__930">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Aug 31, 2017 at 8:26:43 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the reply. &#xA0;I used the nerdy nights tutorials for most of my learning thus far. &#xA0;Here is the code as it is after the change:<br>
&#xA0;
<div>.inesprg 1 &#xA0; ; 1x 16KB PRG code</div><br><br><div>.ineschr 1 &#xA0; ; 1x &#xA0;8KB CHR data</div><br><br><div>.inesmap 0 &#xA0; ; mapper 0 = NROM, no bank swapping</div><br><br><div>.inesmir 1 &#xA0; ; background mirroring</div><br><br><div>&#xA0;</div><br><br><div>;;;;;;;;;;;;;;;</div><br><br><div>;;;VARIABLES</div><br><br><div>.rsset $0000 &#xA0; &#xA0;;put variables starting at 0</div><br><br><div>buttons1 <span style="white-space&lt;span class=" sprites_emoticons absmiddle" id="emo_tongue">&#xA0;</span>re&quot;&gt;  &#xA0; .rs 1</div><br><br><div>gamestate<span style="white-space&lt;span class=" sprites_emoticons absmiddle" id="emo_tongue">&#xA0;</span>re&quot;&gt;  &#xA0; .rs 1</div><br><br><div>playerSpriteCount &#xA0;.rs 1</div><br><br><div>playerSpeed<span style="white-space&lt;span class=" sprites_emoticons absmiddle" id="emo_tongue">&#xA0;</span>re&quot;&gt;  &#xA0; .rs 1</div><br><br><div><span style="color:#FF0000;">playerDisplayFlags .rs 1</span></div><br><br><div>playerAnimationFrameNumber .rs 1<br>
<br>
The red line is the one that was moved. &#xA0;Prior to that, it was below the gamestate variable. &#xA0;I will do some more research tonight but it seems to have fixed the problem for now.<br>
<br>
Also, im new here is there a specific tag we are supposed to use for code examples?<br>
<br>
Edited: question about code</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__931">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Aug 31, 2017 at 8:44:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>brilliancenp</b></i><br>
	<br>
	Also, im new here is there a specific tag we are supposed to use for code examples?</div>
<br>
<br>
I use the HTML tag PRE /PRE<br>
<a href="https://www.w3schools.com/tags/tag_pre.asp" target="_blank" original-href="https://www.w3schools.com/tags/tag_pre.asp">https://www.w3schools.com/tags/ta...</a><br>
<br>
to make the code monospace font. But I believe to be the only one in here to do so.<br>
There is a built in code tag too, but then the font output is quite small.<br>
<br>
Also, I see not red lines (maybe this is because I use the vintage version of the forum) and your code is influenced by smilies. So, sorry, I have hard time telling you anything relevant about it.<br>
<br>
You are definitely welcome, vacation time with lot of free time for me, and I like to chat about NES programming with people, Ask whatever you please.<br>
<br>
Kind Regards.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__932">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Aug 31, 2017 at 9:16:48 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
<div class="FTQUOTE"><i>Originally posted by:&#xA0;<b>user</b></i><br>
<br>
Also, I see not red lines</div>
<br>
The line I pointed to was &apos;playerDisplayFlags .rs 1&apos;<br>
&#xA0;</div>
<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__933">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Aug 31, 2017 at 9:43:06 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>brilliancenp</b></i><br>
	<br>
	The line I pointed to was &apos;playerDisplayFlags .rs 1&apos;</div>
<br>
&#xA0;<br>
Ok, so, you inverted two lines in your code and now it works?<br>
Try now to make the longest variable name shorter, and make sure to use only ASCII letters (a-z) chars defining such name, and see what happens if you bring it back where it was, or other stuff like that.<br>
<br>
I sincerely doubt that the issue is truly here, but since you say so, I will believe it. However, like I said, I do not use NESASM, so sorry about that, I am not the best subject to help you out here, since it seems a question NESASM related. If you have any question about assembly coding for the NES more in general, it is a bit more likely that I can have a more useful answer to provide you.<br>
<br>
Cheers.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__934">
                                                        <div class="mdl-card__title"><strong>RockyHardwood</strong> posted on 
		
			
				
				Aug 31, 2017 at 10:02:24 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					so you hard coded the 1 instead of setting and reading the variable, right? Can we see the code that sets the bit as well as the code that you wrote to make it work?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__935">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Aug 31, 2017 at 1:42:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So the code where I initilize it(bit 1: 0 = right, 1= left)
<pre>InitPlayer:
	LDA #%000000000; This is what I will switch to change left/right when program begins.  #%00000010 for left #%00000000 for right
	STA pDispFlags
	LDA #$04
	STA pSpriteCnt
	LDA #$01
	STA pSpeed
	RTS
</pre><br><br>Then when I check for a press (this will change the graphics tiles the character uses) 
<pre>        ReadA:
		LDA buttons1
		AND #APRESSED
		BNE MakeTransparent
		LDA pDispFlags
		AND #%11011111
		STA pDispFlags
		JMP ReadADone
		MakeTransparent:
			LDA pDispFlags
			ORA #%00100000
			STA pDispFlags
			LDA pDispFlags
			ORA #%00000100
			STA pDispFlags
			LDA pDispFlags
			AND #%11111110
			STA pDispFlags		
	ReadADone:
</pre>
Basically if the user presses A the sprites &apos;disappears&apos; except for the eyes.  When the player releases A the sprites reappear.  Code for this:
<pre>TurnPlayerInvisible:
	LDA pDispFlags
	AND #%00000010
	BEQ TurnPlayerInvisibleRight
	TurnPlayerInvisibleLeft:
		LDA #$0A
		STA $0201
		LDA #$09
		STA $0205
		LDA #$0C
		STA $0209
		LDA #$0B
		STA $020D
		JMP UpdatePlayerDone
	TurnPlayerInvisibleRight:
		LDA #$09
		STA $0201
		LDA #$0A
		STA $0205
		LDA #$0B
		STA $0209
		LDA #$0C
		STA $020D
	TurnPlayerInvisibleDone:
	RTS 
</pre>
Prior to any graphics logic is set the player to its still sprite mapping facing the direction it is supposed to.  This will get overriden if the player is moving but it does set the sprites in the correct position depending on the attribute flipping horizontally.  I have included this because it happens before we turn the player invisible.
<pre>PlayerStill:
	LDA pDispFlags
	AND #%00000010
	BEQ PlayerRightStill
	PlayerLeftStill:
		LDA #$03
		STA $0201
		LDA $0202
		ORA #%01000000
		STA $0202
		LDA #$01
		STA $0205
		LDA $0206
		ORA #%01000000	
		STA $0206
		LDA #$07
		STA $0209
		LDA $020A
		ORA #%01000000
		STA $020A
		LDA #$05
		STA $020D
		LDA $020E
		ORA #%01000000
		STA $020E
		JMP PlayerStillDone
	PlayerRightStill:
		LDA #$01
		STA $0201
		LDA $0202
		AND #%10111111
		STA $0202
		LDA #$03
		STA $0205
		LDA $0206
		AND #%10111111
		STA $0206
		LDA #$05
		STA $0209
		LDA $020A
		AND #%10111111
		STA $020A
		LDA #$07
		STA $020D
		LDA $020E
		AND #%10111111
		STA $020E
	PlayerStillDone:
	RTS
</pre><br><br>Literally the only thing I changed when it started working was moving the variable declaration down for pDispFlags about 2 lines.  In the post earlier this was called playerDisplayFlags.  Now keep in mind I am new so im sure this isn&apos;t optimized code.  If you do see anything horrible let me know lol.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__936">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Aug 31, 2017 at 5:15:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>brilliancenp</b></i><br>
	<br>
	Now keep in mind I am new so im sure this isn&apos;t optimized code. If you do see anything horrible let me know lol.</div>
<br>
<br>
Nothing horrible IMHO, of course, however, if this does NOT confuse you (if it does, forget about this post):<br>
<pre>; THIS BELOW IS A LOOKUP TABLE
; (this data is in ROM, probably .byte directive in NESASM, but not sure)
; MUTIPLY X4
XFOUR #$00 #$04 #$08 #$0C #$10 #$14 #$18 #$1C
      #$20 #$24 #$28 #$2C #$30 #$34 #$38 #$3C
; continue if you wish to, 64 bytes wasted maybe, but I found it useful.
; LOOKUP TABLE IMAGE LEFT
LFT #$03 #$01 #$07 #$05
; LOOKUP TABLE IMAGE RIGHT
RGT #$01 #$03 #$05 #$07<br><br>PlayerStill:
    ldx #$03
    LDA pDispFlags
    AND #%00000010
    BEQ PlayerRightStill<br><br>    PlayerLeftStill:
    lda LFT,x
    ldy XFOUR,x
    sta $0201,y
    LDA $0202,y
    ORA #%01000000
    sta $0202,y
    dex
    bpl PlayerLeftStill ; loops x = 03 02 01 00, when FF exit
    JMP PlayerStillDone<br><br>    PlayerRightStill:
    lda RGT,x
    ldy XFOUR,x
    sta $0201,y
    LDA $0202,y
    AND #%10111111
    sta $0202,y
    dex
    bpl PlayerRightStill ; loops x = 03 02 01 00, when FF exit<br><br>    PlayerStillDone:
    RTS
</pre>
<br>
<br>
Did not test it. Tell me if this works in NESASM.<br>
<br>
Kind Regards.<br>
<br>
<br>
Edit: Formatted better the code, removed a wrong comment.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__937">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Aug 31, 2017 at 5:17:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>brilliancenp</b></i><br>
&#xA0;
<pre>InitPlayer:
	LDA #%000000000; This is what I will switch to change left/right when program begins.  #%00000010 for left #%00000000 for right</pre>
</div>
You have an extra 0, but it probably doesnt matter unless your 00000010 is also too long.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__938">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Sep 1, 2017 at 3:49:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank you for all the help guys! &#xA0;I have been trying for a couple of days and I am frustrated. &#xA0;If anyone has any time can you check out my program and tell me if I am crazy? &#xA0;If im not if anyone can tell me what is wrong I am at a loss. &#xA0;The &apos;a&apos; button is working. &#xA0;It makes the character sprite dissapear (except for his eyes). &#xA0;Hold the button down and it remains hidden, let up on it and it reappears. &#xA0;This works perfectly for me. &#xA0;The problem is that any other button that is pressed seems to lock up the program. &#xA0;I check the hex editor and everything is haulted and the character doesn&apos;t dissapear any longer. &#xA0;I read all of the buttons with a read controller loop, but the only other button I am trying to do anything with is &apos;left&apos;. &#xA0;There is logic there but even when I comment it out it still locks up. &#xA0;Im very new to this so I am sure there is something that Im not seeing but I have stared at it so long I may not be able to see it even if it is there. &#xA0;I am super frustrated lol. &#xA0;If anyone has time to look, I have attached everything needed in a zip file except for an emulator. &#xA0;This is simply a test file to try out what I have learned from nerdy nights. &#xA0;I haven&apos;t gotten very far due to this. This is a nerdy nights setup, so hopefully you are familiar. &#xA0;<br>
<br>
*Oh and my flag variable, pDispFlags, only uses the first 3 bits so far. 00000321<br>
3. 1 = player invisible<br>
2. 1 = player left 0 = right<br>
1. 1 = player moving 0 = player not moving<br>
<br>
Any help is so appreciated. &#xA0;Hopefully I can get good enough at this at some point where I can provide the help instead of always needing it.<br>
<br>
P.S. The char file is original from me, I am no artist lol<br>
<br>
Edit: player flag info
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__939">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Sep 1, 2017 at 3:54:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>brilliancenp</b></i><br>
	<br>
	Thank you for all the help guys! I have been trying for a couple of days and I am frustrated. If anyone has any time can you check out my program and tell me if I am crazy? If im not if anyone can tell me what is wrong I am at a loss. The &apos;a&apos; button is working. It makes the character sprite dissapear (except for his eyes). Hold the button down and it remains hidden, let up on it and it reappears. This works perfectly for me. The problem is that any other button that is pressed seems to lock up the program. I check the hex editor and everything is haulted and the character doesn&apos;t dissapear any longer. I read all of the buttons with a read controller loop, but the only other button I am trying to do anything with is &apos;left&apos;. There is logic there but even when I comment it out it still locks up. Im very new to this so I am sure there is something that Im not seeing but I have stared at it so long I may not be able to see it even if it is there. I am super frustrated lol. If anyone has time to look, I have attached everything needed in a zip file except for an emulator. This is simply a test file to try out what I have learned from nerdy nights. I haven&apos;t gotten very far due to this. This is a nerdy nights setup, so hopefully you are familiar.<br>
	<br>
	Any help is so appreciated. Hopefully I can get good enough at this at some point where I can provide the help instead of always needing it.<br>
	<br>
	P.S. The char file is original from me, I am no artist lol</div>
<br>
<br>From what you say, maybe you have misspelled a JSR with JMP or something like that?
<br>I will give a look to your code later, tell you if I see anything.
<br>Kind Regards.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__940">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Sep 1, 2017 at 4:23:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>brilliancenp</b></i><br>
<br>
I have attached everything needed in a zip file&#xA0;</div>
<br>
You are using JSR to get to TurnPlayerInvisible, but return using JMP instead of RTS. &#xA0;Also need white space in front of RTI or it will use as a label instead of instruction.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__941">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Sep 1, 2017 at 4:25:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>brilliancenp</b></i><br>
	&#xA0;</div>
<br>
<br>
I use Linux now, and FcEux under Linux has no debug tools. If you have a win machine, try to open the tool that shows the bytes in RAM. Look at page $0100 after pressing any button except A. It it start filling up it is likely what I already told you. There is some chance that it is that I think, but not sure at all, I just looked at your code like 5 minutes, and tried the ROM quickly to see what it does.<br>
<pre>    MakeTransparent:
        LDA pDispFlags
        ORA #%00100000;transparent
        STA pDispFlags ; why?
        LDA pDispFlags ; why?
        AND #%11111110;set still
        STA pDispFlags
</pre>
By the way, if the logic in this snippet of code is correct (i.e. what you want is to ORA, then AND, such value, and then save it), then the two marked instructions (with &quot;why?&quot;) are completely useless I think: you are saving to load up again the same value right after. It seems pretty ambitious to me for a first project, my humble advice is to make sure to isolate your routines somehow and test them, and make sure that everything is correct, before adding more code. Step by step. Just my two cents, not a great programmer myself, and speaking from my experience only, this is why I say so.<br>
<br>
Cheers.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__942">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Sep 1, 2017 at 4:55:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>brilliancenp</b></i><br>
&#xA0;</div>
<br>
<br>
I use Linux now, and FcEux under Linux has no debug tools. If you have a win machine, try to open the tool that shows the bytes in RAM. Look at page $0100 after pressing any button except A. It it start filling up it is likely what I already told you. There is some chance that it is that I think, but not sure at all, I just looked at your code like 5 minutes, and tried the ROM quickly to see what it does.
<pre>    MakeTransparent:
        LDA pDispFlags
        ORA #%00100000;transparent
        STA pDispFlags ; why?
        LDA pDispFlags ; why?
        AND #%11111110;set still
        STA pDispFlags
</pre>
By the way, if the logic in this snippet of code is correct (i.e. what you want is to ORA, then AND, such value, and then save it), then the two marked instructions (with &quot;why?&quot;) are completely useless I think: you are saving to load up again the same value right after. It seems pretty ambitious to me for a first project, my humble advice is to make sure to isolate your routines somehow and test them, and make sure that everything is correct, before adding more code. Step by step. Just my two cents, not a great programmer myself, and speaking from my experience only, this is why I say so.<br>
<br>
Cheers.</div>
Thank you for looking. &#xA0;I agree it was ambitious. &#xA0;I actually started doing what you say, little by little, after I got in too deep. &#xA0;I started commenting everything out and adding it back after I found out something worked. &#xA0;little by little I am getting there. &#xA0;This is how I learn. &#xA0;Thanks again!<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__943">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Sep 1, 2017 at 5:00:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>brilliancenp</b></i><br>
<br>
I have attached everything needed in a zip file&#xA0;</div>
<br>
You are using JSR to get to TurnPlayerInvisible, but return using JMP instead of RTS. &#xA0;Also need white space in front of RTI or it will use as a label instead of instruction.</div>
Thanks man! &#xA0;I KNOW you are busy, as is everyone here im sure. &#xA0;My AVS is on that boat <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span> &#xA0;It is actually that which brought me here and got me interested in NES programming again, so thanks for everything! &#xA0;And you were correct, it works now! &#xA0;Now I have something to do all night<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__944">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Sep 2, 2017 at 11:34:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks to everyone here and their help I have my character animating left and right, ducking and using a special skill.  My next question is more of an opinion.  On the subject of jumping I have a question.  I know when programming more modern games usually when a player jumps it is the physics engine that brings it back down, mostly the gravity.  For nes do you guys implement a &apos;gravity&apos; to keep all characters grounded or do you just use the character attributes for bringing it back down?  I&apos;m sure everyone has their own opinion and I guess I am just looking for that.  What is your opinion on tackling this for a newbie like myself?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__945">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Sep 2, 2017 at 3:56:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have not done a side scroller yet, but I had been planning on going with the gravity way of doing things when the time comes. That should account for changes in terrain, and also make it easier for dealing with more than just the hero. Press everything down, and then build in resistance to that. Haven&apos;t tested it out, though, so who knows <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__946">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Sep 2, 2017 at 4:47:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The common options are:
<br>
<br>1 - make a table of x/y coordinates for a parabola.  When you jump, just follow each step along that table until you hit ground again.
<br>
<br>2 - physics with separate speed and acceleration in x/y.  When you jump, add lots to x acceleration.  Each step subtract a fixed amount from x acceleration.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__947">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				Sep 3, 2017 at 10:00:54 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Greetings all,
<pre>I am putting together a quick reference page to program a simple NROM game.
It will need English proof reading of course, but before all, to be accurate.
So, I need confirms (or corrections) about logic and math to be correct here.
Each scanline is 341 PPU cycles, and each 3 PPU cycles is 1 CPU cycle.
The &quot;span&quot; between the start of two consecutive V-Blanks is 262 scanlines.
The &quot;span&quot; between the start of two consecutive V-Blanks is 29780.7 CPU cycles.
The &quot;span&quot; of each V-Blank period itself is 20 scanlines on NTSC machines.
The &quot;span&quot; between start and end of a single V-Blank period is 2273.3 CPU cycles.
DMA transfer takes 514 CPU cycles, reducing this &quot;span&quot; to 1759.3 CPU cycles.
Assuming that a simple routine setting up the PPU ports $2000 and $2001 and the
scrolling $2005 will take &quot;x&quot; further cycles, there are left 1759 - x CPU cycles.
That is the amount of cycles left to update palette, background tiles, attributes,
and whatever else must be done during V-Blank, before writing to $2000 and $2001.
Please consider this a generic reference page helping the development of a simple
NROM game on the NES, not an expert programmer reference guide. From experience
about what fits into V-Blank and what not, I *think* that my math should be, more
or less, close to correct, but it would be cool it this was confirmed or refined.
Thanks in advance to anyone can provide expert feedback on this subject.</pre>
Cheers.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__948">
                                                        <div class="mdl-card__title"><strong>Gauauu</strong> posted on 
		
			
				
				Sep 8, 2017 at 11:37:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>brilliancenp</b></i><br>
&#xA0;know when programming more modern games usually when a player jumps it is the physics engine that brings it back down, mostly the gravity. For nes do you guys implement a &apos;gravity&apos; to keep all characters grounded or do you just use the character attributes for bringing it back down?</div>
<br>
I tend to do gravity, but either works. &#xA0;<br>
<br>
For this sort of thing, I find <a href="http://higherorderfun.com/blog/2012/05/20/the-guide-to-implementing-2d-platformers/" target="_blank" original-href="http://higherorderfun.com/blog/2012/05/20/the-guide-to-implementing-2d-platformers/">this page</a> to be an amazing guide to getting you thinking about good ways of dealing that sort of thing in platformers.<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__949">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Sep 9, 2017 at 12:19:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Gauauu</b></i><br><br><div class="FTQUOTE"><i>Originally posted by: <b>brilliancenp</b></i><br>
&#xA0;know when programming more modern games usually when a player jumps it is the physics engine that brings it back down, mostly the gravity. For nes do you guys implement a &apos;gravity&apos; to keep all characters grounded or do you just use the character attributes for bringing it back down?</div>
<br>
I tend to do gravity, but either works. &#xA0;<br>
<br>
For this sort of thing, I find <a href="http://higherorderfun.com/blog/2012/05/20/the-guide-to-implementing-2d-platformers/" target="_blank" original-href="http://higherorderfun.com/blog/2012/05/20/the-guide-to-implementing-2d-platformers/">this page</a> to be an amazing guide to getting you thinking about good ways of dealing that sort of thing in platformers.<br>
&#xA0;</div><br><br><br><br><br>Never programmed jumping, but I never thought of writing a &quot;gravity&quot; routine. Interesting.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__950">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Sep 14, 2017 at 10:18:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the opinions guys.  For my learning I went with gravity but that may change.  I have my character doing what I want for now.  The next thing I want to learn is character interaction with obstacles.  In my demo I am using to learn the type is a platformer but I guess it doesn&apos;t really matter.  I am trying to learn how to make the player land on platforms and be impeded by obstacles.  Im going to start with random platforms that the character can jump to.  My first thought is that we put some sprites on the screen to create the platforms.  Now when this is finished how do I check to see if the player is standing on them?  I mean my first thought would be when the player is moving down, to chek to see if the players Y value is greater than or equal to the &apos;platforms&apos;.  I currently do this in my demo but the y value is uniform forming an invisible floor that the player could move along while I tested everything else.  With many sprites at different heights it seems like that would be a lot of tests each frame.  Is there an easier way?  Like a general sprite collision routine and then figure out what it is interacting with (enemy, wall, floor etc.)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__951">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Sep 15, 2017 at 8:13:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You could set up a routine to check the player sprite against every other sprite, or a certain range of them, and then go to a routine that determines what has been contacted, and what to do about it. That is kind of what I did with Spook-o&apos;-tron since it is all sprite based, in an earlier build (in the end they all became the same points-wise and in terms of contact).<br>
<br>
The issue is that it eats up a lot of CPU due to all of the checks, and you can only have 64 sprites total. The other problem with sprite-based platforms is the 8 sprites per scan line limit. Since backgrounds and sprites work different enough, if you want to expand your idea down the road it might be a good idea to start looking into doing platforms with backgrounds sooner than later (that would also allow your gravity engine to carry over), otherwise you could end up doing the work twice, and in two different ways (very little of my sprite based collision code seems to carry over to background use). MRN has a great tutorial on this, his Week 7 lesson (probably need to begin at week 5 for it to make sense; I skipped his ones deling with sprites when I started out). That is set up for treating all BG tiles the same, but with a small modification you can give the background tiles a &quot;type&quot; like structure and then pass through some one way, destroy others, fall through some, etc. His way also ties all of that to the metatile data so you do not have to have separate tables for any of that info. What you see on screen is what you get.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__952">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Sep 15, 2017 at 9:34:02 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br>
<br>
...MRN has a great tutorial on this, his Week 7 lesson (probably need to begin at week 5 for it to make sense; I skipped his ones deling with sprites when I started out)...</div>
<br>
Awesome. &#xA0;I will check that out. &#xA0;That helps alot and thats exactly why I asked lol. &#xA0;Much appreciated. &#xA0;Its early so maybe this is a stupid question, what is MRN?<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__953">
                                                        <div class="mdl-card__title"><strong>Gauauu</strong> posted on 
		
			
				
				Sep 15, 2017 at 10:33:57 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>brilliancenp</b></i><br>
Its early so maybe this is a stupid question, what is MRN?</div>
<br>
A forum user named &quot;Mario&apos;s Right Nut&quot; -- he has <ins><a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33287" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33287">this tutorial</a>.</ins><br>
<br>
&#xA0;
<div class="FTQUOTE" i>Originally posted by: <b>SoleGooseProductions</b><br>
You could set up a routine to check the player sprite against every other sprite, or a certain range of them</div>
The other thing I would recommend is, as much as possible, do your collision logic based on your logical game actors and not based on sprites or tiles themselves. (ie have a logical bounding box for your main character, and do collision tests based on that bounding box, and not based on the sprites that make up the character. ) This gives you more flexibility if you change how the character is represented in terms of sprites. Similarly with backgrounds -- check against whatever level of background element/metatile your game would find appropriate (ie often 16x16 pixel blocks like Mario), and don&apos;t actually check against each individual hardware-level tile.<br>
<br>
On that <ins><a href="http://higherorderfun.com/blog/2012/05/20/the-guide-to-implementing-2d-platformers/" target="_blank" original-href="http://higherorderfun.com/blog/2012/05/20/the-guide-to-implementing-2d-platformers/">guide to platformers</a></ins> page I linked to previously, there&apos;s a section about collisions with platforms that&apos;s worth reading.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__954">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Sep 15, 2017 at 11:00:54 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>Gauauu</b></i><br>
	&#xA0;
	<div class="FTQUOTE" i>
		Originally posted by: <b>SoleGooseProductions</b><br>
		You could set up a routine to check the player sprite against every other sprite, or a certain range of them</div>
	The other thing I would recommend is, as much as possible, do your collision logic based on your logical game actors and not based on sprites or tiles themselves. (ie have a logical bounding box for your main character, and do collision tests based on that bounding box, and not based on the sprites that make up the character. ) This gives you more flexibility if you change how the character is represented in terms of sprites...</div>
<br>
This was a very valuable lesson that I leanred during Spook-o&apos;-tron. Bunnyboy kept saying, years ago, not to directly check against sprite things, but rather to create variables for them. I chalked it up to a waste of variables in Pong and went my own way. Why have an EnemyStatus variable, or 32 of them for that matter, when a &quot;dead&quot; enemy could just have a Y value of 01 for instance. Out of sight, out of mind. Well, let&apos;s just say that it led to a world of problems and that I ended up having to redo all of the sprite handling code at some point <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>. Off-screen enemy collision code started interferring with off-screen projectile and civilian code and I suddenly realized that variables would have solved everything.<br>
<br>
MRN&apos;s background collision system checks against metatiles. It seems to work rather well, at least for 16x16 worlds.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__955">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Sep 15, 2017 at 5:32:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>SoleGooseProductions</b></i><br>
<br>
...stuff<br>
&#xA0;</div>
<br>
Beau and his abbreviations...<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__956">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Oct 13, 2017 at 10:58:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Gauauu</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>brilliancenp</b></i><br>
Its early so maybe this is a stupid question, what is MRN?</div>
<br>
A forum user named &quot;Mario&apos;s Right Nut&quot; -- he has <ins><a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33287" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33287">this tutorial</a>.</ins><br>
<br>
&#xA0;
<div class="FTQUOTE" i>Originally posted by: <b>SoleGooseProductions</b><br>
You could set up a routine to check the player sprite against every other sprite, or a certain range of them</div>
The other thing I would recommend is, as much as possible, do your collision logic based on your logical game actors and not based on sprites or tiles themselves. (ie have a logical bounding box for your main character, and do collision tests based on that bounding box, and not based on the sprites that make up the character. ) This gives you more flexibility if you change how the character is represented in terms of sprites. Similarly with backgrounds -- check against whatever level of background element/metatile your game would find appropriate (ie often 16x16 pixel blocks like Mario), and don&apos;t actually check against each individual hardware-level tile.<br>
<br>
On that <ins><a href="http://higherorderfun.com/blog/2012/05/20/the-guide-to-implementing-2d-platformers/" target="_blank" original-href="http://higherorderfun.com/blog/2012/05/20/the-guide-to-implementing-2d-platformers/">guide to platformers</a></ins> page I linked to previously, there&apos;s a section about collisions with platforms that&apos;s worth reading.</div>
Well it has taken about a month but I finally have my code working in line with MRN&apos;s tutorials. &#xA0;I cant believe how much easier my code is to read and go through. &#xA0;Much appreciated to everyone for the help. &#xA0;I have made my way up to bounding boxes which is going to take some time. &#xA0;The concept seems easy enough but putting it into action and actually understanding what it is doing is taking some time. &#xA0;I am really trying to understand everything rather than just copy and paste and hope it works lol. &#xA0;Debugging is getting easier for me as well. &#xA0;I am so used to being able to step through the code with all my other development stuff. Had to think back to how I used to do things before that. &#xA0;So by using the hex editor and some debug hex variables I am getting the hang of it. &#xA0;Thanks again!<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__957">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Oct 14, 2017 at 9:39:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Awesome to hear man. I don&apos;t know if you realize quite how fast you&apos;re moving in comparison to some of us <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__958">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Oct 16, 2017 at 12:27:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I live and die by the Hex Editor. I even catch bugs that I don&apos;t know about by watching the Hex Editor.
<br>
<br>I&apos;m glad to hear that it is all working out!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__959">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Oct 19, 2017 at 9:37:39 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am not THAT accomplished with the hex editor lol. &#xA0;But I can atleast check variables from it and see where maybe a bug is appearing by looking for changes or non changes where they should be.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__960">
                                                        <div class="mdl-card__title"><strong>ubuntuyou</strong> posted on 
		
			
				
				Oct 26, 2017 at 4:01:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Could someone explain how to structure PRG banks for MMC1 using asm6? I can switch CHR banks fine but PRG is a no go. I&apos;m getting a lot of gray screens. Thanks.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__961">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Oct 26, 2017 at 11:05:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>ubuntuyou</b></i><br>
<br>
Could someone explain how to structure PRG banks for MMC1 using asm6? I can switch CHR banks fine but PRG is a no go. I&apos;m getting a lot of gray screens. Thanks.</div>
<br>
Are you swapping $8000-BFFF or $C000-FFFF? What I am posting below is assuming $8000-BFFF is swappable and $C000-$FFFF are fixed.<br>
<br>
I&apos;m not familiar with MMC1 or ASM6, but maybe my UNROM code using NESASM3 can help point you in the right direction.&#xA0; NESASM3 breaks banks out in the code in 8KB chunks (the .bank 0, .bank 1, etc), however, when you bankswitch, the entire 16KBs is swapped (so for bankSource=00, .bank 0 and .bank 1 are called). I have to note this because I think ASM6 does this differently. I think that banks are stored and called in 16kb chunks. Anyways, as you can see, all my swappable banks start at $8000. When I need to swap, I just call which 16kb bank I need with my bankswitching code. With UNROM, its as simple as writing the bank value to the bankswitching register. With MMC1, I do believe you have to use a shift register as per bunnyboy&apos;s Nerdy Nights tutorials. Take a look at the code below. As I said, I&apos;m sort of combining my UNROM code with the MMC1 code provided by bunnyboy. It&apos;s also all in NESASM3, so there are probably some differences in the code. This is more for a basis to check your code to see if you can see any simple errors. Take all of it with a grain of salt. Here is also the NESdev page on MMC1 banking. <a href="http://wiki.nesdev.com/w/index.php/MMC1" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/MMC1">http://wiki.nesdev.com/w/index.ph...</a><br>
<br>
<br>
<strong>My Bank Code</strong><br>
;;;;;;;;;;;;;;;;;bankSource=00;;;;;;;;;;;;;;;;;;;;SWAPPABLE BANK<br>
&#xA0; .bank 0&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; .org $8000 &#xA0;<br>
&#xA0; ;CODE HERE<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0; .bank 1<br>
&#xA0; .org $A000<br>
&#xA0; ;CODE HERE &#xA0;&#xA0;<br>
<br>
;;;;;;;;;;;;;;;;;bankSource=01;;;;;;;;;;;;;;;;;;;;SWAPPABLE BANK<br>
&#xA0; .bank 2&#xA0;<br>
&#xA0; .org $8000<br>
&#xA0; ;CODE HERE<br>
&#xA0;&#xA0; &#xA0;<br>
&#xA0; .bank 3<br>
&#xA0; .org $A000<br>
&#xA0; ;CODE HERE<br>
;;;;;;;;;;;;;;;;;bankSource=02;;;;;;;;;;;;;;;;;;;; &#xA0;SWAPPABLE BANK<br>
&#xA0; .bank 4&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;&#xA0;&#xA0; &#xA0;<br>
&#xA0; .org $8000<br>
&#xA0; ;CODE HERE<br>
<br>
&#xA0; .bank 5<br>
&#xA0; .org $A000<br>
&#xA0; ;CODE HERE<br>
<br>
.&#xA0; MORE SWAPPABLE BANKS UNTIL MY FIXED BANK<br>
.<br>
.<br>
.<br>
.<br>
.<br>
<br>
;;;;;;;;;;;;;;;;;bankSource=0F;;;;;;;;;;;;;;;;;;;;FIXED BANK<br>
&#xA0; .bank 30<br>
&#xA0; .org $C000<br>
&#xA0; ;CODE HERE<br>
<br>
&#xA0;&#xA0; .bank 31<br>
&#xA0; .org $E000<br>
&#xA0; ;CODE HERE<br>
<br>
<br>
<strong>bunnyboy&apos;s MMC1 PRG Banking Routine</strong><br>
<a href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33260" target="_blank" original-href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33260">http://nintendoage.com/forum/mess...</a>
<p>PRGBankWrite:&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; make sure this is in a fixed bank so it doesnt get swapped away<br>
&#xA0; LDA bankSource&#xA0;&#xA0;&#xA0; ; get bank number into A<br>
&#xA0; STA $E000&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; first data bit<br>
&#xA0; LSR A&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; shift to next bit<br>
&#xA0; STA $E000<br>
&#xA0; LSR A<br>
&#xA0; STA $E000<br>
&#xA0; LSR A<br>
&#xA0; STA $E000<br>
&#xA0; LSR A<br>
&#xA0; STA $E000&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; bank switch happens immediately here<br>
&#xA0; RTS<br>
<br>
<br>
<strong>Routine to call Banking routine</strong><br>
LDA #$03<br>
STA bankSource&#xA0;&#xA0; ;Call bank 3<br>
JSR PRGBankWrite ;Jump to banking code<br>
<br>
<br>
I hope this helps.</p><br><br><p>&#xA0;</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__962">
                                                        <div class="mdl-card__title"><strong>ubuntuyou</strong> posted on 
		
			
				
				Oct 26, 2017 at 1:04:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That did help. I didn&apos;t make the connection that MMC1 is similar to UNROM and asm6 doesn&apos;t have a .bank directive. Those two and PRG_COUNT in the iNES header were throwing me off.  Thanks for the help Mega Mario Man.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__963">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Oct 26, 2017 at 2:08:48 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, I did some digging. It seems that ASM6 uses .base to start the bank and .pad to end the bank. I&apos;m glad that helped you out, I was shooting from the hip just a bit on that one.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__964">
                                                        <div class="mdl-card__title"><strong>pk space jam</strong> posted on 
		
			
				
				Nov 7, 2017 at 8:52:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So I could use a little help, I was told that my code was doing most of it&apos;s logic in the NMI which is generally frowned upon, I&apos;m trying to rearrange the code as so that is not so, I managed to get the file to compile, but now lost my ability to move sprites, if anyone would be willing to help me grokk this out I would really appreciate it, Assembly is hard lol <a href="https://hastebin.com/wahulohivi.pl" target="_blank" original-href="https://hastebin.com/wahulohivi.pl">https://hastebin.com/wahulohivi.p...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__965">
                                                        <div class="mdl-card__title"><strong>ubuntuyou</strong> posted on 
		
			
				
				Nov 7, 2017 at 10:01:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>pk space jam</b></i><br>
<br>
So I could use a little help, I was told that my code was doing most of it&apos;s logic in the NMI which is generally frowned upon, I&apos;m trying to rearrange the code as so that is not so, I managed to get the file to compile, but now lost my ability to move sprites, if anyone would be willing to help me grokk this out I would really appreciate it, Assembly is hard lol <a href="https://hastebin.com/wahulohivi.pl" target="_blank" original-href="https://hastebin.com/wahulohivi.pl">https://hastebin.com/wahulohivi.pl</a></div>
<br>
<br>
<br>
Doesn&apos;t look like you&apos;re calling your subroutines to check for button presses in your forever loop. Anything you want done outside of NMI has to be called between FOREVER and JMP FOREVER.<br>
<br>
Also, in your NMI you&apos;ll want to push your A, X, and Y registers to the stack before doing anything else, then restore them all just before your RTI.<br>
<br>
<br>
<code>NMI:<br>
<br>
&#xA0;&#xA0;&#xA0; PHA<br>
&#xA0;&#xA0;&#xA0; TXA<br>
&#xA0;&#xA0;&#xA0; PHA<br>
&#xA0;&#xA0;&#xA0; TYA<br>
&#xA0;&#xA0;&#xA0; PHA<br>
<br>
&#xA0;&#xA0;&#xA0; ; do NMI stuff<br>
<br>
&#xA0;&#xA0;&#xA0; DEC sleeping ; set sleeping variable to #$00 so your main loop will run once<br>
<br>
&#xA0;&#xA0;&#xA0; PLA<br>
&#xA0;&#xA0;&#xA0; TAY<br>
&#xA0;&#xA0;&#xA0; PLA<br>
&#xA0;&#xA0;&#xA0; TAX<br>
&#xA0;&#xA0;&#xA0; PLA<br>
<br>
&#xA0;&#xA0;&#xA0; RTI</code><br>
<br>
<br>
Then in your FOREVER loop do:<br>
<br>
<br>
<code>FOREVER:<br>
<br>
&#xA0;&#xA0;&#xA0; INC sleeping<br>
.loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; NMI will return in the loop with sleeping set to #$00<br>
&#xA0;&#xA0;&#xA0; LDA sleeping<br>
&#xA0;&#xA0;&#xA0; BNE .loop<br>
<br>
&#xA0;&#xA0;&#xA0; ; Call game logic subroutines here<br>
<br>
&#xA0;&#xA0;&#xA0; JMP FOREVER</code><br>
<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__966">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 8, 2017 at 1:03:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>pk space jam</b></i><br>
<br>
So I could use a little help, I was told that my code was doing most of it&apos;s logic in the NMI which is generally frowned upon, I&apos;m trying to rearrange the code as so that is not so, I managed to get the file to compile, but now lost my ability to move sprites, if anyone would be willing to help me grokk this out I would really appreciate it, Assembly is hard lol <a href="https://hastebin.com/wahulohivi.pl" target="_blank" original-href="https://hastebin.com/wahulohivi.pl">https://hastebin.com/wahulohivi.pl</a></div>
<br>
<br>
Ok, so there are some issues in that code.<br>
<br>
First off, you need your RTI to go right after your NMI is complete. It is how the system know that you are finished with the NMI. Right now you have it after GameEngineDone:. It needs to be after &apos;;;;all graphics updates done by here, run game engine&apos;.<br>
<br>
Second, you really should Push and Pull your registers as ubuntuyou shows above. This preserves any values that are in them before your forever loop runs.<br>
<br>
Third, you have this twice, you only need it once:
<pre class="hljs" id="box" style tabindex="0"><code>  .org $FFFA     ;first of the three vectors starts here
  .dw NMI        ;<span class="hljs-keyword">when</span> an NMI happens (once per frame <span class="hljs-keyword">if</span> enabled) the 
                   ;processor will jump to the label NMI:
  .dw RESET      ;<span class="hljs-keyword">when</span> the processor first turns on <span class="hljs-keyword">or</span> is <span class="hljs-keyword">reset</span>, it will jump
                   ;to the label RESET:
  .dw <span class="hljs-number">0</span>          ;external interrupt IRQ is <span class="hljs-keyword">not</span> used in this tutorial
</code></pre>
It&apos;s best to keep this code in the bank with $E000 (in your case, bank 3).<br>
<br>
Forth, All of your game engine code needs to happen between Forever: and JMP Forever. Here is my exact Forever Loop and NMI. This is the backbone that runs the entire game. All my setup code happens before the Forever loop, such as the RESET:, clrmem, turn on the NMI and PPU, etc.
<pre>;Game Setup Code Goes Here.
;----------------------------------------------------------------------
;-----------------------START MAIN PROGRAM-----------------------------
;---------------------------------------------------------------------- 
Forever:
  INC sleeping                     ;wait for NMI<br><br>.loop
  LDA sleeping
  BNE .loop                        ;wait for NMI to clear out the sleeping flag<br><br>  LDA #$01
  STA updating_background          ;this is for when you are changing rooms or something, not really needed here
                                   ;it will skip the NMI updates so as not to mess with your room loading routines<br><br>  JSR ReadController1  ;;get the current button data
  JSR ReadController2  ;I like to read my controllers right after the NMI so save PPU time.<br><br>  JSR GameStateIndirect     ;THIS IS MY GAME ENGINE. Everything happens here, sprite movement, enemy movement, etc.<br><br>  LDA GameState
  CMP GameStateOld
  BEQ .next
     JSR GameStateUpdate        ;These last 4 lines update my game states. This code is from Mario&apos; Right Nut&apos;s Tutorials.
.next<br><br>  LDA #$00
  STA updating_background<br><br>  JMP Forever     ;jump back to Forever, and go back to sleep<br><br>
;--------------------------------------------------------------
;-----------------------NMI ROUTINE----------------------------
;--------------------------------------------------------------
NMI:
  PHA                              ;protect the registers by moving values to the stack
  TXA
  PHA
  TYA
  PHA<br><br>nmi_start:                          ;write Sprite RAM
  LDA #$00
  STA $2003                        ; set the low byte (00) of the RAM address
  LDA #$02
  STA $4014                            ;Set High byte of sprite RAM<br><br>  LDA updating_background          ;check to be sure that the main program isn&apos;t busy
  BNE skip_graphics_updates<br><br>  JSR GameStateNMIIndirect       ;This runs NMI Specific code based on what game state I am in, Title, Playing, Credits, etc<br><br>  LDA #$00                            ;tell the ppu there is no background scrolling
  STA $2005
  STA $2005<br><br>  LDA #%10010000                    ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1
  ORA NameTableFlag                   
  STA $2000<br><br>  LDA EnablePPUFlag
  BEQ .SKIP
    LDA #%00011110                   ;enable sprites, enable background, no clipping on left side
    STA $2001   
    DEC EnablePPUFlag
  .SKIP:<br><br>  LDA MusicBank
  JSR Bankswitch
    jsr FamiToneUpdate                ;*MUSIC
  LDA #$00            ;start in bank 0
  JSR Bankswitch<br><br>  LDA #$00
  STA sleeping                     ;wake up the main program  (start forever loop)<br><br>skip_graphics_updates:<br><br>  PLA                              ;restore the registers
  TAY
  PLA
  TAX
  PLA<br><br>  RTI                              ;return from interrupt</pre><br><br><p><br>
<br>
You have it all there, you just need to reorder some of it. Hopefully, this points you in the right direction. This was a pretty big hurdle for me to clear when I was learning. I still remember the day it all clicked.<br>
&#xA0;</p>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__967">
                                                        <div class="mdl-card__title"><strong>pk space jam</strong> posted on 
		
			
				
				Nov 8, 2017 at 5:15:12 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank you guys for the help, before I put the engine into the forever loop, just want to double check I&apos;ve done everything else correctly, also trying to single out what of my engine I need to put inside the forever loop, basically everything from 182 to 293? or would I include all the sub routines? It&apos;s just I suppose still hard for me to contextualize how the hardware is working. <a href="https://hastebin.com/anonolavoc.pl" target="_blank" original-href="https://hastebin.com/anonolavoc.pl">https://hastebin.com/anonolavoc.p...</a><br>
<br>
Also, here&apos;s what I got when I tried the above code w/ sleeping, did I need to define this somewhere else? feel like im missing something obvious lol, attached is my error log&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__968">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 8, 2017 at 8:25:20 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>pk space jam</b></i><br>
<br>
Thank you guys for the help, before I put the engine into the forever loop, just want to double check I&apos;ve done everything else correctly, also trying to single out what of my engine I need to put inside the forever loop, basically everything from 182 to 293? or would I include all the sub routines? It&apos;s just I suppose still hard for me to contextualize how the hardware is working. <a href="https://hastebin.com/anonolavoc.pl" target="_blank" original-href="https://hastebin.com/anonolavoc.pl">https://hastebin.com/anonolavoc.pl</a><br>
<br>
Also, here&apos;s what I got when I tried the above code w/ sleeping, did I need to define this somewhere else? feel like im missing something obvious lol, attached is my error log&#xA0;</div>
Everything except variables, constants, and game startup code.<br>
<br>
Here is my layout.<br>
<br>
Header<br>
Variables<br>
Constants<br>
Startup Code (Rest, clrmem, music init, sfx init, save data load, game state init, Enable PPU and NMI)<br>
Forever Loop (with it waiting for the NMI right at the start)<br>
&#xA0;&#xA0;&#xA0;&#xA0; - Wait for NMI to start and finish<br>
&#xA0;&#xA0;&#xA0;&#xA0; - Read Controllers<br>
&#xA0;&#xA0;&#xA0;&#xA0; - Game Engine<br>
&#xA0;&#xA0;&#xA0;&#xA0; - Check if game state changed during engine<br>
&#xA0;&#xA0;&#xA0;&#xA0; - Loop back to forever and wait for NMI<br>
<br>
<br>
The forever loop is exactly what it sounds like, one big loop that runs all of your data from 1 frame. You update everything in this loop and when you are finished, you put in a wait for the NMI to hit. As long as it is enabled, the NMI interrupts once a frame. This code ensures that we wait for the NMI to run before proceeding with the rest of our code.
<pre>Forever:
  INC sleeping                     ;wait for NMI<br><br>.loop
  LDA sleeping
  BNE .loop</pre><br><br><p><br>
This code at the end of NMI tells the Forever loop that is done and you can update the game code for the next frame:</p><br><br><pre><br><br>&#xA0; LDA #$00
&#xA0; STA sleeping&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;wake up the main program &#xA0;
&#xA0;
&#xA0; PLA&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;restore the registers
&#xA0; TAY
&#xA0; PLA
&#xA0; TAX
&#xA0; PLA<br><br>&#xA0; RTI           ;Return from the Interrupt back to the Forever loop
</pre>
<br>
This is how we &quot;time&quot; hitting the NMI. Otherwise, we could be running our game code and the NMI would Interrupt and mess up everthing. The only think that should happen during the NMI is writing to the PPU and APU. All other code goes in your game engine. So, if you have a background tile that needs to change (think Score or Time), you could update that data in your game code and then write it during the NMI. You will advance your sprites once per frame in your game code (updating the $0200 page in RAM), then the first part of the NMI writes the $0200 page to the PPU every frame. Even if you don&apos;t understand why at this point, that is what is happening here.
<pre>  LDA #$00
  STA $2003                        ; set the low byte (00) of the RAM address
  LDA #$02
  STA $4014                            ;Set High byte of sprite RAM</pre>
<br>
Does that clear it up some more?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__969">
                                                        <div class="mdl-card__title"><strong>pk space jam</strong> posted on 
		
			
				
				Nov 8, 2017 at 8:51:26 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I think I understand? Though what I&apos;m still confused about is why I would be getting the same error about sleeping being an unkown operand, here&apos;s my current code where I attempt to place the engine inside the loop&#xA0; (wait sent the wrong one)&#xA0;<br>
<br>
<a href="https://hastebin.com/goqexagoyo.pl" target="_blank" original-href="https://hastebin.com/goqexagoyo.pl">https://hastebin.com/goqexagoyo.p...</a><br>
<br>
update: yeah no matter what I try, I keep gettin an error saying that sleeping is an undefined symbol in operand field <span class="sprites_emoticons absmiddle" id="emo_sad">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__970">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 8, 2017 at 10:30:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>pk space jam</b></i><br>
<br>
I think I understand? Though what I&apos;m still confused about is why I would be getting the same error about sleeping being an unkown operand, here&apos;s my current code where I attempt to place the engine inside the loop&#xA0; (wait sent the wrong one)&#xA0;<br>
<br>
<a href="https://hastebin.com/goqexagoyo.pl" target="_blank" original-href="https://hastebin.com/goqexagoyo.pl">https://hastebin.com/goqexagoyo.pl</a><br>
<br>
update: yeah no matter what I try, I keep gettin an error saying that sleeping is an undefined symbol in operand field <span class="sprites_emoticons absmiddle" id="emo_sad">&#xA0;</span></div>
<br>
put sleeping in your variables.<br>
<br>
sleeping&#xA0;&#xA0;&#xA0; .rs 1<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__971">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 8, 2017 at 10:37:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>pk space jam</b></i><br>
<br>
I think I understand? Though what I&apos;m still confused about is why I would be getting the same error about sleeping being an unkown operand, here&apos;s my current code where I attempt to place the engine inside the loop&#xA0; (wait sent the wrong one)&#xA0;<br>
<br>
<a href="https://hastebin.com/goqexagoyo.pl" target="_blank" original-href="https://hastebin.com/goqexagoyo.pl">https://hastebin.com/goqexagoyo.pl</a><br>
<br>
update: yeah no matter what I try, I keep gettin an error saying that sleeping is an undefined symbol in operand field <span class="sprites_emoticons absmiddle" id="emo_sad">&#xA0;</span></div>
<br>
put sleeping in your variables.<br>
<br>
sleeping&#xA0;&#xA0;&#xA0; .rs 1<br>
&#xA0;</div>
Also, move lines 198 - 539 to after RTI or you can put that in bank 0 or bank 1. Where it is at now, all of that will try to run before the forever loop. These are your subroutines that are called from within your Game Engine inside of your Forever loop.<br>
&#xA0;<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__972">
                                                        <div class="mdl-card__title"><strong>pk space jam</strong> posted on 
		
			
				
				Nov 8, 2017 at 10:44:16 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					like so? (thank you for bearing with me) This got the sprite up on the screen again but i lost controller input it seems <a href="https://hastebin.com/okukuzelok.pl" target="_blank" original-href="https://hastebin.com/okukuzelok.pl">https://hastebin.com/okukuzelok.p...</a>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__973">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 8, 2017 at 11:47:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					We got this running through pms for those that were following along.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__974">
                                                        <div class="mdl-card__title"><strong>pk space jam</strong> posted on 
		
			
				
				Nov 10, 2017 at 1:11:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Another question, trying to follow Nerdy Nights 7 and implement collision with the paddles, I got the walls working, but what am I doing wrong here? If someone could breakdown the logic bunny boy is using for this I would really appreciate it, 
<br>
<br>CheckPaddleCollision:
<br>  LDA $0300
<br>  STA paddle1ytop
<br>  LDA $031C
<br>  STA paddle2ybot
<br>
<br>  LDA ballx
<br>  CMP #PADDLE1X
<br>  BCS .End
<br>  LDA bally
<br>  CMP #paddle1ytop
<br>  BCC .End
<br>  LDA bally
<br>  CMP #paddle2ybot
<br>  BCS .End
<br>
<br>  LDA ballx
<br>  CMP #RIGHTWALL
<br>  BCC .End
<br>  LDA #$00
<br>  STA ballright
<br>  LDA #$01
<br>  STA ballleft    ;bounce, ball moving left, below here give point to p1, reset ball
<br>  .End:
<br>    RTS
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__975">
                                                        <div class="mdl-card__title"><strong>ubuntuyou</strong> posted on 
		
			
				
				Nov 10, 2017 at 4:24:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is more than i can reasonably type out and demonstrate on a phone. If someone hasn&apos;t helped by the time i get off work in about 7 hours i can help with the basics. In the mean time look up how bounding boxes work with collision. Basically you&apos;ll want to update the x0, x1, y0, and y1 coordinates for both the ball and each paddle separately. Then check for the actual collision. Sorry i can&apos;t help more at the moment.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__976">
                                                        <div class="mdl-card__title"><strong>pk space jam</strong> posted on 
		
			
				
				Nov 10, 2017 at 8:52:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>ubuntuyou</b></i><br>
<br>
This is more than i can reasonably type out and demonstrate on a phone. If someone hasn&apos;t helped by the time i get off work in about 7 hours i can help with the basics. In the mean time look up how bounding boxes work with collision. Basically you&apos;ll want to update the x0, x1, y0, and y1 coordinates for both the ball and each paddle separately. Then check for the actual collision. Sorry i can&apos;t help more at the moment.</div>
<br>
no need to apologize at all, i tried updating what I thought was the sprite before but then it just held onto a chunk of another sprite, ill try again and post<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__977">
                                                        <div class="mdl-card__title"><strong>pk space jam</strong> posted on 
		
			
				
				Nov 10, 2017 at 9:03:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					heres what I have now, still getting no result <span class="sprites_emoticons absmiddle" id="emo_sad">&#xA0;</span><br>
<br>
CheckPaddleCollision:<br>
&#xA0;&#xA0;<br>
&#xA0; LDA ballx<br>
&#xA0; CMP PADDLE1X<br>
&#xA0; BCC .End<br>
&#xA0; LDA bally<br>
&#xA0; CMP paddle1ytop<br>
&#xA0; BCC .End<br>
&#xA0; LDA bally<br>
&#xA0; CMP paddle2ybot<br>
&#xA0; BCS .End<br>
&#xA0; LDA #$00<br>
&#xA0; STA ballright<br>
&#xA0; LDA #$01<br>
&#xA0; STA ballleft&#xA0; &#xA0; ;bounce, ball moving left<br>
&#xA0; .End:<br>
&#xA0; &#xA0; RTS<br>
<br>
UpdateSprites:<br>
LDA bally ;;update all ball sprite info<br>
STA $0320<br>
LDA #$12<br>
STA $0321<br>
LDA #$00<br>
STA $0322<br>
LDA ballx<br>
STA $0323 ;end of ball sprite info<br>
<br>
STA paddle1ytop<br>
LDA $0300<br>
LDA #$00<br>
STA $0301<br>
LDA #$00<br>
STA $0302<br>
LDA #PADDLE1X<br>
STA $0303<br>
<br>
STA paddle2ybot<br>
LDA $0324<br>
LDA #$31<br>
STA $0325<br>
LDA #$00<br>
STA $0326<br>
LDA #PADDLE2X<br>
STA $0327<br>
<br>
RTS
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__978">
                                                        <div class="mdl-card__title"><strong>ubuntuyou</strong> posted on 
		
			
				
				Nov 11, 2017 at 2:46:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here&apos;s a quick bounding box collision tutorial I worked up for PK in case anyone else needs it.<br>
<br>
<a href="https://www.dropbox.com/s/en88bzmpsbb1wqt/collisiontut.asm?dl=0" target="_blank" original-href="https://www.dropbox.com/s/en88bzmpsbb1wqt/collisiontut.asm?dl=0">https://www.dropbox.com/s/en88bzm...</a><br>
<br>
If anyone sees any issues let me know and I&apos;ll make the appropriate changes.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__979">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 13, 2017 at 11:28:39 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>ubuntuyou</b></i><br>
<br>
Here&apos;s a quick bounding box collision tutorial I worked up for PK in case anyone else needs it.<br>
<br>
<a href="https://www.dropbox.com/s/en88bzmpsbb1wqt/collisiontut.asm?dl=0" target="_blank" original-href="https://www.dropbox.com/s/en88bzmpsbb1wqt/collisiontut.asm?dl=0">https://www.dropbox.com/s/en88bzmpsbb1wqt/collisiontut.asm?d...</a> <br>
<br>
If anyone sees any issues let me know and I&apos;ll make the appropriate changes.</div>
<br>
<br>
Thanks! I&apos;ll be refering to this for some tips.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__980">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 15, 2017 at 10:07:59 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Has anyone here attempted sprite movement in isometric view? I&apos;m having an issues with sprites jumping across the screen with the Y coordinate. Basically, the equation to convert from Cartesian coordinates (2d top-down map) to Isometric (on screen coordinates) is IsoY = (CartX + CartY)/2. Whenever (CartX + CartY) sets the carry flag going up (CartY rolls over from $00 to $FF), you must use LSR to divide by 2 to drop the carry flag so your sprite doesn&apos;t jump to the bottom of the screen. Whenever (CartX + CartY) sets the carry flag going down, I have to do ROR to divide by 2 so that the IsoY coord is $80 and not $00 and jumps the sprite back to the top of the screen. 
<br>
<br>Anyone have any experience in the best way to tackle this problem?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__981">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Nov 15, 2017 at 10:50:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I figured out my Isometric issue. Ignore.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__982">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Dec 12, 2017 at 7:02:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					So I am trying to condense my enemy parameters. Right now I have set aside space to have 4 enemies on screen at a time so I have varaibles for each enemy set aside and I control them by using an enemy_number:
<pre>enemy_number .rs 1
enemy_frame .rs 4
enemy_animation .rs 4
enemy_hp .rs 4
enemy_speed .rs 4
</pre>
I <s>need to set some of</s>&#xA0;would like to hold these according to enemy type and would like some structure to hold values that would initialize by type. In one of MRN tutorials I saw him use .word to make a sort of data table for the background meta sprites. Can this be used for enemy types like:<br><br><pre>enemyTypes:
    .word demon,flying_eye<br><br>demon:
    .db $02,$05,$06...<br><br>flying_eye:
    .db $04,$02,$05...
</pre>
Where each value for the type is something I need. I think this would work but then how do I get these values? I am thinking I would have to have another variable like:<br><br><pre>enemyType .rs 4
enemyType_ptr .rs 2
</pre>
but how would you set this? If each .word is an address (IE demon = $0010 or something) would I have to do:<br><br><pre>;set enemy type to flying_eye
LDX enemy_number
LDA $01
STA enemyType,x
;get to the enemy type values
LDA enemyType,x
TAX
LDA enemyTypes,x
STA enemyType_ptr
LDA enemyTypes+1,x
STA enemyType_ptr+1
</pre>
It would seems that this routine would get me the address of the correct starting values (maybe) but now I am lost on how to get what I need. I am not sure if I am even doing this correct. Any advise would be greatly appreciated.<br>
<br>
EDIT - reworded&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__983">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Dec 12, 2017 at 8:27:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Use EnemyNumber to find the EnemyType and then get the data you need from the table. Then store it to useful variables or temporary ones to execute what you need. In my loading routines I have tables for Types, and then load those up before hand. These Types are used for movement, tile data, and other things.<br>
<br>
LoadingTypeData:<br>
&#xA0; .db $00,$00,$01,$03<br>
<br>
LoadTypeData:<br>
&#xA0; LDX #$00 ; X is going to be EnemyNumber<br>
.LoadingLoop<br>
&#xA0; LDA EnemyNumber, X<br>
&#xA0; ASL A<br>
&#xA0; TAY<br>
&#xA0; LDA LoadingTypeData, Y<br>
&#xA0; STA PTR1<br>
&#xA0; INY<br>
&#xA0; LDA LoadingTypeData, Y<br>
&#xA0; STA PTR1+1<br>
<br>
&#xA0; LDY #$00<br>
&#xA0; LDA [PTR1], Y<br>
&#xA0; STA EnemyType, X&#xA0; &#xA0; &#xA0; ; Store at one of your EnemyType variables that will be used for other things<br>
<br>
&#xA0; INX<br>
&#xA0; CPX #$04 ; Load your four enemies<br>
&#xA0; BNE .LoadingLoop<br>
&#xA0; RTS<br>
<br>
Then in your main program you&apos;d run what you need based on the Type variable. Hopefully that helps? I have gotten tripped up on it all before, having to store things at different places and all. I think what confused me was the step of pre-loading the data. You have to have the Type, but you need to load it before you need it. And, you only need to load it once if you do it with your room loading routines. I suppose you could find it every frame, but... <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>.<br>
<br>
Again, hopefully that helps. It has been a while since I have gotten to write any code so it might be a bit off.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__984">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Dec 12, 2017 at 8:50:22 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank you.  I understand everything except for (as always) ASL and what it does.  I&apos;m still a bit new to this so I believe it stands for arithmetic shift left, and I believe it shifts each bit in the byte to the left.  I just don&apos;t understand why we would do this here in your code.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__985">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Dec 12, 2017 at 9:32:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Someone smarter than me can give the real reason, but ASL is what allows you access .dw tables. It multiplies your starting entry by two, and aligns things. That is also why .dw tables are capped out at 128 entries instead of 256 (i.e. half). MRN mysteriously mentions that in one of the tutorials, but it is something to keep in mind since if you need more than that you&apos;ll need tables of tables.
<br>
<br>Thanks be to Metal Slime for understanding pointers, 16-bit addressing, and word tables in general, but I&apos;ll be darned if I can explain the technical stuff at the moment.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__986">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Dec 12, 2017 at 9:46:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Haha fair enough.  Thank you!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__987">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Dec 12, 2017 at 9:49:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					ASL is essentially like multiplying by 2. .dw tables are 2 bytes per entry instead of 1 byte because they are addresses, $8540. So, if you are going after entry 3, its actually the 6th byte, so you must multiply by 2.<br><br>.dw entry1, entry2, entry3 ; in label format<br><br>.dw $853E, $853F, $8540 ; what it looks like to the cpu
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__988">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Dec 12, 2017 at 10:02:39 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Be careful when mixing .dw and .db tables in the same routine, like it looks like you&apos;ll be doing. Only ASL the .dw ones, otherwise you&apos;ll end up skipping over the data you want. Many mistakes over the years!
<br>
<br>Things like finding: MovementType (.dw) --&gt; MovementDirection (.dw) --&gt; MovementValue (.db). Tables within tables within tables...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__989">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Dec 12, 2017 at 10:03:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					When you&apos;re going into a pointer table you always have to do an ASL A because ASL is the same as multiplying by 2. Pointer tables are all 16-bit, since it&apos;s in essence a full address that you&apos;re basically skipping to. So multiplying the variable you load by 2 is preparing it to go to the correct 16-bit address.<br>
<br>
edit: This is redundant after reading the previous posts. Sorry about that. I started posting and got sidetracked for a long time!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__990">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Dec 12, 2017 at 10:46:23 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Just as a quick tip/alternative, if you want 256 addresses store two tables, one for the lo byte of each address, and one for the hi byte of each address. Then you don&apos;t need to asl, just ldx the index of the address (or other 16 bit value) that you want.<br>
<br>
address1:<br>
;whatever data you need<br>
address2:<br>
;whatever data you need<br>
address3:<br>
;whatever data you need<br>
<br>
;Apologies if I got the nesasm syntax wrong. its either LO and HI or LOW and HIGH, I forget which<br>
addresses_lo:<br>
.db LOW(address1), LOW(address2), LOW(address3)<br>
<br>
addresses_hi:<br>
.db HIGH(address1), HIGH(address2), HIGH(address3)<br>
<br>
;Variable is a 16 bit value in zp or ram<br>
ldx #the_address_number_you_want<br>
lda addresses_lo,x<br>
sta variable<br>
lda addresses_hi,x<br>
sta variable+1<br>
<br>
ldy #whatever_offset_you_need_From_that_address<br>
lda [variable],y&#xA0;&#xA0; ;I seem to recall nesasm using []
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__991">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Dec 14, 2017 at 5:46:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Now that is something I wouldn&apos;t have thought of.  Im sure when I learn more about what I am doing and need 256 addresses (or even more than 128) I will definitely use this.  Thanks for all of the responses guys!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__992">
                                                        <div class="mdl-card__title"><strong>ewelinka</strong> posted on 
		
			
				
				Jan 7, 2018 at 12:38:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi there !<br>
<br>
I&apos;m new to NES programming (and asm language), I followed the nerdy nights tutorials. To all the people involved into this forum and the tutorials, thank you very much !<br>
Apart from that, I&apos;m a developer and I did several games in C and JavaScript/HTML5, so I know general principles.<br>
<br>
So, I use NESASM, and I was wondering : what is the correct way to display text on screen ? Should I use letters as sprites with all the alphabet ?<br>
Otherwise I saw this trick and it confused me since I&apos;m not used to asm : <a href="https://github.com/PeterLemon/NES/blob/master/HelloWorld/Font8x8.asm" target="_blank" original-href="https://github.com/PeterLemon/NES/blob/master/HelloWorld/Font8x8.asm">https://github.com/PeterLemon/NES...</a><br>
<br>
Thank you !
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__993">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jan 7, 2018 at 12:59:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ypu can do them as bg tiles or sprites. Usually, if they are sprites its because there is special animation or just numbers for a score, like in Jackal. I normally use background tiles. When you get further along and look up using ram buffers to save on nmi time, this way you can write a good number of tiles to the bg.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__994">
                                                        <div class="mdl-card__title"><strong>ewelinka</strong> posted on 
		
			
				
				Jan 7, 2018 at 2:24:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank you for your quick response, it helps me, I&apos;m gonna dig into bg tiles !<br>
<br>
It&apos;s amazing how active is the NES dev community in 2018&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__995">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jan 7, 2018 at 4:27:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No problem! It is a nice little helpful community.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__996">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Jan 7, 2018 at 8:01:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You only get 8 sprites per scanline, so sprites are rarely used for text except things like status bars in scrolling games.  Some games will put the text on a diagonal to avoid the 8/line limit <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__997">
                                                        <div class="mdl-card__title"><strong>Vectrex28</strong> posted on 
		
			
				
				Jan 8, 2018 at 4:34:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>ewelinka</b></i><br>
<br>
Thank you for your quick response, it helps me, I&apos;m gonna dig into bg tiles !<br>
<br>
It&apos;s amazing how active is the NES dev community in 2018&#xA0;</div>
<br>
You&apos;re gonna love making your own fonts <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__998">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Jan 8, 2018 at 10:26:16 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Vectrex28</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>ewelinka</b></i><br>
<br>
Thank you for your quick response, it helps me, I&apos;m gonna dig into bg tiles !<br>
<br>
It&apos;s amazing how active is the NES dev community in 2018&#xA0;</div>
<br>
You&apos;re gonna love making your own fonts <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span></div>
<br>
People make their own fonts? <span class="sprites_emoticons absmiddle" id="emo_wink">&#xA0;</span><br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__999">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Jan 17, 2018 at 11:48:03 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have run into an issue and have an idea of how to deal with it but want to find out how other devs have tackled it.  I have the need to capture an input string to perform a special player move.  Think of it like throwing a fireball in street fighter 2 with ryu or ken.  It isn&apos;t that many commands, I just want to do a double direction button push left or right.  
<br>I had the idea to record the previous button presses and then have a timer that the double push needs to be pressed within that time.  Is this on the correct track?  How would you guys go about accomplishing this?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1000">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Jan 17, 2018 at 12:08:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>brilliancenp</b></i><br>
<br>
I have run into an issue and have an idea of how to deal with it but want to find out how other devs have tackled it. I have the need to capture an input string to perform a special player move. Think of it like throwing a fireball in street fighter 2 with ryu or ken. It isn&apos;t that many commands, I just want to do a double direction button push left or right.<br>
I had the idea to record the previous button presses and then have a timer that the double push needs to be pressed within that time. Is this on the correct track? How would you guys go about accomplishing this?</div>
I&apos;d probably use my current button history routine in a certain way. Here&apos;s the routine:<br>
<br>
;****************************************************************<br>
;Deserializes the controller into a buffer.<br>
;output: controller_buffer<br>
;****************************************************************<br>
.proc read_controller<br>
<br>
&#xA0; &#xA0; lda #$01<br>
&#xA0; &#xA0; sta CONTROLLER<br>
&#xA0; &#xA0; lda #$00<br>
&#xA0; &#xA0; sta CONTROLLER<br>
<br>
&#xA0; &#xA0; lda CONTROLLER<br>
&#xA0; &#xA0; ror<br>
&#xA0; &#xA0; rol controller_buffer+buttons::_a<br>
<br>
&#xA0; &#xA0; lda CONTROLLER<br>
&#xA0; &#xA0; ror<br>
&#xA0; &#xA0; rol controller_buffer+buttons::_b<br>
<br>
&#xA0; &#xA0; lda CONTROLLER<br>
&#xA0; &#xA0; ror<br>
&#xA0; &#xA0; rol controller_buffer+buttons::_select<br>
<br>
&#xA0; &#xA0; lda CONTROLLER<br>
&#xA0; &#xA0; ror<br>
&#xA0; &#xA0; rol controller_buffer+buttons::_start<br>
<br>
&#xA0; &#xA0; lda CONTROLLER<br>
&#xA0; &#xA0; ror<br>
&#xA0; &#xA0; rol controller_buffer+buttons::_up<br>
<br>
&#xA0; &#xA0; lda CONTROLLER<br>
&#xA0; &#xA0; ror<br>
&#xA0; &#xA0; rol controller_buffer+buttons::_down<br>
<br>
&#xA0; &#xA0; lda CONTROLLER<br>
&#xA0; &#xA0; ror<br>
&#xA0; &#xA0; rol controller_buffer+buttons::_left<br>
<br>
&#xA0; &#xA0; lda CONTROLLER<br>
&#xA0; &#xA0; ror<br>
&#xA0; &#xA0; rol controller_buffer+buttons::_right<br>
<br>
&#xA0; &#xA0; rts<br>
<br>
.endproc<br>
<br>
What it does is record the last 8 states of every button in each byte of controller_buffer (which has reserved 8 bytes, one byte for each button). So, if someone JUST pressed a button, you can do this:<br>
<br>
lda controller_buffer+buttons::_a<br>
and #%00000011&#xA0; ;only care about the current and previous state<br>
cmp #%00000001 ;since we&apos;re now only looking at the most recent two bits, if the last bit was 0, and the current bit was 1, we now know the user JUST pressed the button.<br>
<br>
If I wanted to detect a double press, I might double up the technique and record a history of actual detected presses, with another buffer like this:<br>
<br>
.proc record_a_presses<br>
<br>
;TODO: Add code to make recorded presses expire after a certain amount of time by<br>
;rotating a 0 into button_a_pressed_buffer every few frames. this timer would get<br>
;reset any time an actual press has been recorded, too.<br>
<br>
lda controller_buffer+buttons::_a<br>
and #%00000011&#xA0; ;only care about the current and previous state<br>
cmp #%00000001 ;since we&apos;re now only looking at the most recent two bits, if the last bit was 0, and the current bit was 1, we now know the user JUST pressed the button.<br>
beq button_not_just_pressed<br>
<br>
&#xA0; &#xA0; ;Store that button a was actually pressed into button_a_pressed_buffer<br>
&#xA0; &#xA0; lda #1<br>
&#xA0; &#xA0; ror<br>
&#xA0; &#xA0; rol button_a_pressed_buffer<br>
<br>
button_not_just_pressed:<br>
<br>
&#xA0; &#xA0; rts<br>
<br>
.endproc<br>
<br>
....I&apos;d call that&#xA0;record_a_presses routine over and over again on each frame (as well as the controller read routine above), and to detect a double tap I would do this:<br>
<br>
lda button_a_pressed_buffer<br>
and&#xA0; #%00000111&#xA0; ;examine last three states of whether button a was pressed<br>
cmp #%00000011&#xA0; ;this would mean two presses in a row (ONLY) were recorded<br>
bne double_tap_not_detected<br>
<br>
;Do your double tap action here<br>
<br>
double_tap_not_detected:<br>
<br>
<br>
...This might not be quite what you want either, as it may not take timing into consideration. There are other ways you could do it, but I&apos;m fond of the bit history method, as it comes in handy for handling other types of transitions, not just button presses.<br>
<br>
*edit* I&apos;m thinking about timing, and you could make the button_a_pressed_buffer expire by rotating an unpressed state into it every few frames or something. Currently it&apos;ll detect the last two button presses no matter how much time passes.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1001">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Jan 18, 2018 at 6:40:38 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>GradualGames</b></i><br>
<br>
&#xA0; lda controller_buffer+buttons::_a<br>
&#xA0;</div>
Thank you for your reply!&#xA0; I imagined something like this.&#xA0; I really appreciate the help.&#xA0; One thing that is escaping me is the syntax from above, &apos;lda controller_buffer+buttons::_a&apos;&#xA0; I have never seen the &apos;::&apos; is that syntax or just part of the variable name?&#xA0; Sorry still a bit new to this.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1002">
                                                        <div class="mdl-card__title"><strong>GradualGames</strong> posted on 
		
			
				
				Jan 18, 2018 at 7:29:05 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>brilliancenp</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>GradualGames</b></i><br>
<br>
&#xA0; lda controller_buffer+buttons::_a<br>
&#xA0;</div>
Thank you for your reply!&#xA0; I imagined something like this.&#xA0; I really appreciate the help.&#xA0; One thing that is escaping me is the syntax from above, &apos;lda controller_buffer+buttons::_a&apos;&#xA0; I have never seen the &apos;::&apos; is that syntax or just part of the variable name?&#xA0; Sorry still a bit new to this.<br>
<br>
&#xA0;</div>
Assuming you have a variable in ram somewhere called controller_buffer which reserves 8 bytes,<br>
<br>
Sorry about that, that&apos;s ca65 (an alternative to nesasm) getting a member of a struct out. It&apos;s the same thing as if you did something like this in nesasm:<br>
A_OFFSET = 0<br>
B_OFFSET = 1<br>
SELECT_OFFSET = 2<br>
START_OFFSET = 3<br>
UP_OFFSET = 4<br>
DOWN_OFFSET = 5<br>
LEFT_OFFSET = 6<br>
RIGHT_OFFSET = 7<br>
<br>
and then to look at the A button it&apos;d just be lda controller_buffer+A_OFFSET.&#xA0; ca65 has structs which enable you to do the exact same thing but without having to enumerate the equates manually like in nesasm. in ca65, you can do:<br>
<br>
.struct buttons<br>
&#xA0;&#xA0;&#xA0; _a&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; .byte<br>
&#xA0;&#xA0;&#xA0; _b&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; .byte<br>
&#xA0;&#xA0;&#xA0; _select&#xA0; .byte<br>
&#xA0;&#xA0;&#xA0; _start&#xA0;&#xA0; .byte<br>
&#xA0;&#xA0;&#xA0; _up&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; .byte<br>
&#xA0;&#xA0;&#xA0; _down&#xA0;&#xA0;&#xA0; .byte<br>
&#xA0;&#xA0;&#xA0; _left&#xA0;&#xA0;&#xA0; .byte<br>
&#xA0;&#xA0;&#xA0; _right&#xA0;&#xA0; .byte<br>
.endstruct<br>
<br>
and then it figures out the offsets for you by their sizes. and then you can pluck out those numbers by going buttons::_a&#xA0; or buttons::_select&#xA0; etc. etc.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1003">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Jan 18, 2018 at 9:05:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Perfect!  It looked like a struct or an enum but I had never seen it in nesasm.  Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1004">
                                                        <div class="mdl-card__title"><strong>nes_fan</strong> posted on 
		
			
				
				Jan 30, 2018 at 8:34:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m interested in understanding the game mechanics behind the appearance of the &quot;Lizard King&quot; in the NES-game Dragon&apos;s Lair. Basically, he appears at &quot;random&quot; in certain spots, but I&apos;d like to know if it&apos;s in any way possible to predict/manipulate his appearance.
<br>What I know is that RAM-address $0718 changes to 100 before the LK turns up and starts counting down. Otherwise it&apos;s always 0. In the fceux debugger, I&apos;ve located the line of code that&apos;s executed when $0718 changes to 100. This is where I&apos;m stuck. The last lines of executed code copied from the trace logger look like this:
<br>
<br>$D769:AD 03 03  LDA $0303 = #$00           A:00 X:00 Y:0C S:FF P:nvUbdIZc
<br>$D76C:4A        LSR                        A:00 X:00 Y:0C S:FF P:nvUbdIZc
<br>$D76D:90 FA     BCC $D769                  A:00 X:00 Y:0C S:FF P:nvUbdIZc
<br>...
<br>...
<br>...
<br>$D769:AD 03 03  LDA $0303 = #$00           A:00 X:00 Y:0C S:FF P:nvUbdIZc
<br>$D76C:4A        LSR                        A:00 X:00 Y:0C S:FF P:nvUbdIZc
<br>$D76D:90 FA     BCC $D769                  A:00 X:00 Y:0C S:FF P:nvUbdIZc
<br>$D769:AD 03 03  LDA $0303 = #$00           A:00 X:00 Y:0C S:FF P:nvUbdIZc
<br>&apos;Here the frame advances by one and $0718 gets the value 100.
<br>&apos;The same loop of 3 lines of code are repeated 10 more times before the loop is broken after an execution of $D769 and other lines of code are executed
<br>
<br>1. Maybe not related to the appearance of the LK, but is there a plausible explanation for why the game executes the same code over and over in what appears to be an infinite loop? Except for when the LK counter changes, none of the RAM-addresses change during the loop (easily verified with the &quot;RAM search&quot; feature in the emulator) nor do X, Y, A or the flags.
<br>2. What does LSR act on when there are no arguments? The accumulator?
<br>3. Where does $0718 come into the picture here? There is no reference to it and still it changes value all of a sudden?
<br>4. What could be the explanation for breaking the loop? &quot;RAM search&quot; still doesn&apos;t indicate any changes to any RAM address and none of X, Y, A or any of the flags change (according to the trace logger).
<br>5. Why is the loop broken after an execution of $D769 (LDA) and not the BCC in $D76D?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1005">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Feb 22, 2018 at 7:37:52 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt;"><span id="docs-internal-guid-1fe70724-c017-98a4-6932-c0f007eecb25"><span style="font-size: 10pt; font-family: Verdana; font-variant-numeric: normal; font-variant-east-asian: normal; vertical-align: baseline; white-space: pre-wrap;">Yes, it&apos;s me again! &#xA0;I have been working hard trying to mix MRN&apos;s background compression with horizontal screen scrolling, and after 2 weeks I have gotten pretty close. &#xA0;I am now spinning my wheels as I have stepped through the code, reviewed what I have done and I don&apos;t even know what would be causing the glitch that I am getting. &#xA0;The columns are all drawing prior to getting on screen but there is a bad glitch which I can&apos;t explain. &#xA0;It almost seems like I am writing somewhere I shouldn&apos;t in the PPU, but from what I have seen so far I have not. &#xA0;Now I know that without looking through the code there won&apos;t be an answer, but I am hoping by looking at the attached video maybe someone has seen it before and might point me in the correct direction. &#xA0;I know it&apos;s a long shot so if not, no big deal. &#xA0;</span></span></p>
&#xA0;<br><br><p dir="ltr" style="line-height:1.38;margin-top:0pt;margin-bottom:0pt;"><span id="docs-internal-guid-1fe70724-c017-98a4-6932-c0f007eecb25"><span style="font-size: 10pt; font-family: Verdana; font-variant-numeric: normal; font-variant-east-asian: normal; vertical-align: baseline; white-space: pre-wrap;">The video is below and I have yet to modify the background hit detection to the scrolling so that&apos;s why it is not working (that&apos;s my next goal after scrolling is fixed). &#xA0;</span></span></p><br><br><div>&#xA0;</div>
<a href="https://www.useloom.com/embed/877bde7a0c6c4341969d72d2d878a8cf" target="_blank" original-href="https://www.useloom.com/embed/877bde7a0c6c4341969d72d2d878a8cf">https://www.useloom.com/embed/877...</a><br>
<br>
Edit: embedding the video didn&apos;t work so just linked
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1006">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Feb 23, 2018 at 12:05:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It seems so random. My first thought was are you trying to do too much during your NMI? Without seeing the code, I can&apos;t really tell what&apos;s all happening during NMI.
<br>
<br>Hopefully someone will have a better answer, but I think that may a good first check. I haven&apos;t really dealt much with scrolling with BG Compression.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1007">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Feb 23, 2018 at 7:28:41 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
It seems so random. My first thought was are you trying to do too much during your NMI? Without seeing the code, I can&apos;t really tell what&apos;s all happening during NMI.<br>
<br>
Hopefully someone will have a better answer, but I think that may a good first check. I haven&apos;t really dealt much with scrolling with BG Compression.</div>
Thank you.&#xA0; I guess my question then since this is the first time I&apos;m really having to understand NMI, is The act of writing to the PPU what takes a long time or is it just too much going on?&#xA0; When I go to decompress the meta-tiles in a column, I set the rightmost tiles of the meta-tile (1 &amp; 3) to the PPU and put the other 2 in a buffer for the next time I need a new column to be drawn.&#xA0; This continues&#xA0;30 times to get the entire meta-tile column (essentially&#xA0;2 screen columns) So would the act of writing the tile numbers to a buffer, adding an extra 30 writes, but not to the PPU, be extending this process too long?&#xA0; You can tell from the previous video, that there isn&apos;t a whole lot going on, and I believe I have separated&#xA0;my game logic outside of the NMI routine.&#xA0; I don&apos;t&#xA0;recall how much one can do inside of NMI, but I feel as though this isn&apos;t too much, then again I don&apos;t&#xA0;really know what I&apos;m&#xA0;talking about when it comes to NMI lol.<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1008">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Feb 23, 2018 at 8:35:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					If you are decompressing outside of the nmi to buffer ram amd just writing the buffer ram to the ppu, then that probably isn&apos;t the issue.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1009">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Feb 24, 2018 at 12:13:53 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mega Mario Man</b></i><br>
<br>
If you are decompressing outside of the nmi to buffer ram amd just writing the buffer ram to the ppu, then that probably isn&apos;t the issue.</div>
<br>
That was it, I was loading and writing the new columns in the NMI.&#xA0; I haven&apos;t fixed all of the bugs but the glitch is gone, now that I load outside and write inside.&#xA0; Now to see what else is wrong now.&#xA0; Thanks so much!&#xA0;&#xA0;<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1010">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Mar 7, 2018 at 7:57:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I have been trying to find a way to get my scrolling engine that I made from MRN background compression tutorials and take it and make it work with his background collision detection tutorials.&#xA0; In his tutorials he finds the meta tile as it is compared to the location of the player sprite.&#xA0; It will find the index of the metatile&#xA0;inside the rooms meta tiles.&#xA0; The first index in the room, index zero is for bank switching so the first meta tile is at index 1 in the room.&#xA0; So from what I can tell the meta tile at index 45 should be in column 4 row 5.&#xA0; This all still works unless the player moves and scrolls the screen.&#xA0; So prior to scrolling the room addresses look and work as they are in the top part of the below picture.&#xA0; The balloon is pointing at the first index.<br>
<br>
My problem is when the screen scrolls to the next meta row and it throws the pointer off, shown by the second example with the balloon marked &apos;2&apos;.&#xA0; I have not figured out how to solve this problem.&#xA0; I was thinking that I could still use the index found by his routine and move the index to the next meta tile column (02).&#xA0; This way the index could be the same just starting from the new pointer.&#xA0; And if the column part of the index found is greater than the difference of the column at&#xA0;the index given, then I would need to increase the pointer to the next room and add the rows.&#xA0; I think this would work except the screen scrolls by 8 and the meta tiles are 16 wide, so how do&#xA0;we account for this?&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/33780/photobucket/1E7D16B6-DC52-35F2-65B7C78EA57C14CD.png" show-src="scraper/images/1E7D16B6-DC52-35F2-65B7C78EA57C14CD.png"><br>
Has anyone figured out how to keep track of background collision when scrolling using background compression?&#xA0; Im&#xA0;not looking for a full solution but maybe a different way of thinking that might lead to the answer.&#xA0; I have been staring at this for a week now and am losing hope lol.&#xA0; Any help is greatly appreciated.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1011">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Mar 7, 2018 at 8:26:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is a fun one! I&apos;m sure someone with a better answer will pipe in before I figure out a solution, but thanks for raising the question.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1012">
                                                        <div class="mdl-card__title"><strong>Mega Mario Man</strong> posted on 
		
			
				
				Mar 7, 2018 at 11:03:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I am watching this as well. Sorry that I don&apos;t have an answer for this one. I know that some will.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1013">
                                                        <div class="mdl-card__title"><strong>Sumez</strong> posted on 
		
			
				
				Mar 8, 2018 at 4:46:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>brilliancenp</b></i><br>
<br>
I think this would work except the screen scrolls by 8 and the meta tiles are 16 wide, so how do&#xA0;we account for this?&#xA0;</div>
Shift your bits right until you get the correct index. Say you have the scroll index based on 8px blocks, shift your bits right once (which is the same as dividing by 2), you&apos;ll discard the least significant bit (which you don&apos;t need since two 8px blocks fit into one 16px block) and get a 16px index.<br>
Usually your scroll offset will be defined to the pixel though, since that&apos;s how the PPU uses it, so in that case you&apos;d shift that number right four times (1-&gt;2-&gt;4-&gt;8-&gt;16) to get a 16px index. This kind of operation is very common in 8bit assembly programming.<br>
Sorry if I misunderstood your question.<br>
<br>
&#xA0;
<div class="FTQUOTE" style="width: 932.797px;"><i>Originally posted by:&#xA0;<b>brilliancenp</b></i><br>
<br>
Has anyone figured out how to keep track of background collision when scrolling using background compression?&#xA0; Im&#xA0;not looking for a full solution but maybe a different way of thinking that might lead to the answer.&#xA0; I have been staring at this for a week now and am losing hope lol.&#xA0; Any help is greatly appreciated.</div>
There&apos;s no single correct way to do that, as it completely depends on the way you compress your stages. For crazy compression like SMB, where every part of the stage is generated by algorithms and prefabricated structures, you&apos;d have to decompress your stages data and copy the result into RAM, and read from that instead of ROM data. The problem is of course that the NES doesn&apos;t have a whole lot of RAM (unless you use extra RAM on the cartridge), so usually what you&apos;d do is only decompress the area right around the characters that need to check for background collisions.<br>
<br>
The simplest, most effective compression method I&apos;ve been using is simply using metatiles of metatiles. So similar to your 16px metatiles, you&apos;d have 32px metatiles of four 16px ones, and 64px metatiles of four 32px ones, making sure to reuse the same ones as much as possible and limiting yourself to 256 different metatiles of each type at most. That kind of compression allows me to decompress on the fly whenever I need a metatile index by using bit shifting similar to what I described above (shift your 16px index right once to get the 32px index, etc)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1014">
                                                        <div class="mdl-card__title"><strong>brilliancenp</strong> posted on 
		
			
				
				Mar 8, 2018 at 10:49:18 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Sumez</b></i><br>
&#xA0; Shift your bits right until you get the correct index. Say you have the scroll index based on 8px blocks, shift your bits right once (which is the same as dividing by 2), you&apos;ll discard the least significant bit (which you don&apos;t need since two 8px blocks fit into one 16px block) and get a 16px index.<br>
Usually your scroll offset will be defined to the pixel though, since that&apos;s how the PPU uses it, so in that case you&apos;d shift that number right four times (1-&gt;2-&gt;4-&gt;8-&gt;16) to get a 16px index. This kind of operation is very common in 8bit assembly programming.<br>
Sorry if I misunderstood your question.</div><br><br><div>Thank you for your responses!&#xA0; What I meant is that since I am using 16px meta tiles and the screen scrolls by 8, if we scroll 1 line then we have 1/2 of one meta tile on the left and 1/2 of one on the right, essentially needing to have 17 meta tile columns that we are needing to look at.&#xA0; So the indexes, it seems to me, would be thrown off.</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1015">
                                                        <div class="mdl-card__title"><strong>Sumez</strong> posted on 
		
			
				
				Mar 8, 2018 at 2:01:19 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes, if you have 16px metatiles for collision checking, there are most often 17 visible column offsets your character could be positioned in. Fortunately there are only 15 vertical rows, so technically you should still be able to do with an 8-bit index from your starting offset.
<br>
<br>However, if you&apos;re doing horizontal scrolling anyway, there are essentially many more columns your character could be in. So instead of basing your offset on the scroll amount maybe start out using your characters X position (in world coordinates, not the sprite&apos;s screen coordinates) to determine which column it is in out of the entire stage, and use that as offset?
<br>
<br>What I did for my own multi-purpose scrolling engine, was storing the stage into &quot;room&quot; sized metatiles, each representing a full visible 256x240 NES background, so whenever I check collisions of a single pixel, I start out using the high byte of its X position to find out which &quot;room&quot; it is in, and use that for offset.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1016">
                                                        <div class="mdl-card__title"><strong>Dark_human</strong> posted on 
		
			
				
				Aug 14, 2018 at 4:13:47 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hello All: Dark_human here. I&apos;ve been wading into the 6502 pool here for my new project, and I&apos;ve been making a little progress. I am running into just a few small bugs while programming in NESASM3 and I would love a few pointers. I have read through all of the Nerdy nights tutorials, and I was able to follow them as I have learned quite a bit of older programming from years past.<br>
My first question would be about moving sprites. I can get multiple sprites to move together with button presses, but how would I go about making the sprite move and then stop without releasing the button. (like pressing select to change game modes in Kung Fu). It just keeps cycling through the options endlessly until the button is released.<br>
Secondly, I can turn the screen on and off to draw different option menus, but pressing a button to do so draws the screen incorrectly until the button is released, Unless I turn the screen of and wait for the next time my &quot;Drawscreen&quot; subroutine runs (then the sprites from the previous screen I did not want are rendered)<br>
i.e.<br>
LDA #%10010000 ; enable NMI, Sprites = Pattern table 0 / BG = Pattern table 1<br>
STA $2000<br>
LDA #%00011110<br>
STA $2001<br>
LDA #$00<br>
STA $2005<br>
STA $2005<br>
<br>
(also if I don&apos;t do LDA #%00011010 there I get unwanted artifacts too). Thanks for your wisdom and help in advance!! -DH
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1017">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Sep 3, 2018 at 2:24:24 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey Dark, sorry that no one has gotten back to you here yet. Are you still needing help with this?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1018">
                                                        <div class="mdl-card__title"><strong>Kiro</strong> posted on 
		
			
				
				Jan 24 at 7:47:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hi All,<br>
I&apos;m having trouble getting my head around indexing into a table, it&apos;s been a little while since I&apos;ve had to try and do this but I&apos;ll try and explain what I&apos;m attempting as best I can.<br>
<br>
I have a table of collision data that I want to check against my current sprite location. I can get the sprite locations easy enough and then use the X,Y registers to obtain the index I&apos;m after. (spite is in location 3, 4 for example). So my Y index (3) would be the row in the table and the X index number (4) would be the column.<br>
I grab these and store them in my temp vars<strong> room_pos_x</strong> and <strong>room_pos_y</strong>.<br>
<br>
Example of my table for reference:<br>
BG_COLL_DATA:<br>
.byte $01,$01,$00,$01,$01,$01,$00,$01,$01,$01,$01,$01,$01,$01,$01,$01<br>
.byte $01,$01,$00,$01,$01,$01,$00,$01,$01,$01,$01,$01,$01,$01,$01,$01<br>
and so on...<br>
<br>
I&apos;m then grabbing pointers to my collision table:<br>
LDA #&lt;(BG_COLL_DATA)<br>
STA collisionLo<br>
LDA #&gt;(BG_COLL_DATA)<br>
STA collisionHi<br>
<br>
How can i then index into this table using Y as the row (16byte increments) and x as the column (1 byte increments)?<br>
<br>
I feel like i need to check what the value of room_pos_y is, if it is 3 i need to index in by 32bytes for the row. But I feel this would be inefficient as i would have a massive CMP/Branch block for each of the 16 possibilities.<br>
I think its the 16byte increment bit that&apos;s doing my head in.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1019">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jan 27 at 2:33:13 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					(Warning. No idea if this will actually work.) <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
<br>
tempx .rs 1<br>
tempyLo .rs 1<br>
tempyHi .rs 1<br>
<br>
GetTableOffset:<br>
&#xA0; LDA #&lt;(BG_COLL_DATA)<br>
&#xA0; STA collisionLo<br>
&#xA0; LDA #&gt;(BG_COLL_DATA)<br>
&#xA0; STA collisionHi<br>
<br>
&#xA0; LDA #$00<br>
&#xA0; STA tempx<br>
&#xA0; STA tempyLo<br>
&#xA0; STA tempyHi<br>
&#xA0; LDX room_pos_x<br>
&#xA0; LDY room_pos_y<br>
.LoopY:<br>
&#xA0; CPY #$00 ;decreases Y until it&apos;s 0, to find out the Y table offset<br>
&#xA0; BEQ .LoopX<br>
&#xA0; LDA tempyLo<br>
&#xA0; CLC<br>
&#xA0; ADC #$10<br>
&#xA0; STA tempyLo<br>
&#xA0; BNE .NoWrap<br>
&#xA0; INC tempyHi<br>
.NoWrap:<br>
&#xA0; DEY<br>
&#xA0; JMP .LoopY<br>
.LoopX:<br>
&#xA0; CPX #$00 ;decreases X until it&apos;s 0, to find out the X table offset<br>
&#xA0; BEQ .ExitLoop<br>
&#xA0; INC tempx<br>
&#xA0; DEX<br>
&#xA0; JMP .LoopX<br>
.ExitLoop:<br>
&#xA0; LDA tempx<br>
&#xA0; CLC<br>
&#xA0; ADC tempyLo<br>
&#xA0; CLC<br>
&#xA0; ADC collisionLo<br>
&#xA0; STA collisionLo<br>
&#xA0; LDA tempyHi<br>
&#xA0; CLC<br>
&#xA0; ADC collisionHi<br>
&#xA0; STA collisionHi<br>
<br>
&#xA0; LDY #$00<br>
&#xA0; LDA (collisionLo),y<br>
;;current value from table is now in A
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1020">
                                                        <div class="mdl-card__title"><strong>Kiro</strong> posted on 
		
			
				
				Jan 28 at 7:50:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks, i&apos;ll have a look at this today and see how I go. It already looks a lot better than the horrible CMP/Branch code that I wrote to test my theory <span class="sprites_emoticons absmiddle" id="emo_happy">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1021">
                                                        <div class="mdl-card__title"><strong>Kiro</strong> posted on 
		
			
				
				Apr 03 at 12:22:11 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ended up figuring out the table indexing thing, sorry it took me a while to get back.<br>
<br>
New thing I&apos;m trying to work out, how to find the position of my sprite relative to the background byte in the nametable <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span> oh joy<br>
<br>
EDIT: So i&apos;ve been doing some research over a few days now but can&apos;t find much related to determining what nametable byte my sprite is overlapping. I found this but I&apos;m struggling to translate it to my use case - <a href="https://forums.nesdev.com/viewtopic.php?f=10&amp;t=14788" target="_blank" original-href="https://forums.nesdev.com/viewtopic.php?f=10&amp;t=14788">https://forums.nesdev.com/viewtop...</a><br>
<br>
I have a single screen level, no scolling. Using 16x16 metatiles for my background. My sprite (also 16x16) moves 16px at a time so will always start/stop within a matching 16x16 background metatile boundary. I can work out my sprites top left (8x8) tile top(x) and left(y) positions easily enough using the OAM values. But I&apos;m finding it hard to figure out how to translate that to a nametable address. I want to do this because when my sprite moves to a certain tile I want to swap out the background tile in the nametable. Which i can do manually with some testing code, buut obviously I need to do this programatically.<br>
<br>
e.g. 8x8 sprite tile top = 48px down from top of screen, left = 128px across the screen should = $2110 in the namtable for example.<br>
<br>
EDIT: Figured it out  - feels so satisfying when it comes together. For those curious, I had already created a collision table and was indexing into that for collision detection. I just re-used the collision coords and did a bit of math to calculate the number of bytes to index into the nametable address space.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1022">
                                                        <div class="mdl-card__title"><strong>Roc Studios</strong> posted on 
		
			
				
				Apr 09 at 6:52:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hello there,
<br>
<br>I recently started reading up on nes development (I&apos;m new to it) and I&apos;m currently going through the Nerdy Nights tutorials. I&apos;m moving through the tutorial at an ok clip, so I started thinking about what kind of game I&apos;d want to make.
<br>
<br>I&apos;m interested in making a puzzle game of some sort, but I&apos;m wrestling with the fact that there&apos;s a limit of 8 sprites per scanline (mainly because I was considering making a competitive two player game, similar to Tetris or Puyo Puyo). I&apos;ve been looking at some other nes games for ideas, and came across Palamedes.
<br>
<br>Now I&apos;m not overly familiar with Palamedes, but in its two player mode, it seems to be able to use more than 8 sprites per scanline (the well has a width of 6 sprites for each player). My question is this: does anyone know how Palamedes is able to accomplish this?
<br>
<br>Thanks in advance to anyone who has any insight into this.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1023">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Apr 09 at 7:05:35 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Throw it into FCEUX, pop open the nametable viewer, and see if those are really sprites <span class="sprites_emoticons absmiddle" id="emo_wink">&#xA0;</span>. Just guessing, I&apos;ll have to look later. And welcome back!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1024">
                                                        <div class="mdl-card__title"><strong>Roc Studios</strong> posted on 
		
			
				
				Apr 09 at 7:38:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ah, good idea, thanks Beau <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span> My nose has been to the grindstone recently looking for work, so I spaced on my NES studies lol. It&apos;s kinda neat looking at assembly again. Most of the time I work with higher level languages like Lua or JS.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1025">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Apr 09 at 8:00:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You can also toggle on/off sprites or BG objects. That is probably more handy, but since it is not natively mapped to any buttons I have not ever used it much (finally re-mapped buttons a few months back, only six years late). If the well is that bottom portion, I think you&apos;ll see what is going on pretty quick.
<br>
<br>Hadn&apos;t played Palamedes until now, I had only seen pictures. Interesting...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1026">
                                                        <div class="mdl-card__title"><strong>Roc Studios</strong> posted on 
		
			
				
				Apr 09 at 11:01:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the tip <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span> I guess the dice blocks Palamedes uses are part of the background, so that&apos;s how it avoids the 8 sprite per scanline limit. It&apos;s an interesting workaround, so hopefully I can make use of it. I hadn&apos;t heard of Palamedes myself until I saw James Rolfe and Mike Matei play it on their show.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1027">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Apr 10 at 12:10:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, Tetris confounded me for the longest time when starting out. I just couldn&apos;t figure out how it was being done, and then I couldn&apos;t figure out how to do it programming-wise. The whole idea of sprites becoming background objects for a while, or vice versa, baffled me. Now I enjoy it and use it a lot. A nice clean way of cheating those scan line restrictions, palette restrictions, and some other stuff probably too.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1028">
                                                        <div class="mdl-card__title"><strong>Roc Studios</strong> posted on 
		
			
				
				Apr 10 at 6:15:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sounds like it was tough but worth the effort. I may end up asking how you converted the sprites into background objects when I get to that point if I can&apos;t figure it out myself <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1029">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 11 at 5:12:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					New Question: Backgrounds
<br>
<br>I tried week 6 Nerdy Nights example and I kinda understand it. But translating it to my first test game isn&apos;t going well. 
<br>In the NN example, its only loading in 5 rows of a screen, I obviously want all 32 rows loaded.
<br>So I did this for a loop and a hard coded background of 32 rows: 
<br>
<br>...
<br>LoadBackground:
<br>  LDA $2002             ; read PPU status to reset the high/low latch
<br>  LDA #$20
<br>  STA $2006             ; write the high byte of $2000 address
<br>  LDA #$00
<br>  STA $2006             ; write the low byte of $2000 address
<br>  LDX #$00              ; start out at 0
<br>LoadBackgroundLoop:
<br>  LDA background, x     ; load data from address (background + the value in x)
<br>  STA $2007             ; write to PPU
<br>  INX                   ; X = X + 1
<br>  CPX #$FF              ; Compare X to hex $FF, decimal 256 - copying 256 bytes
<br>  BNE LoadBackgroundLoop  ; Branch to LoadBackgroundLoop if compare was Not Equal to zero
<br>
<br>...;further down in bottom of code, bg / screen hard coded:
<br>background: ;specify the tiles (32 per row)
<br>    .db $26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26 ;row 1
<br>    .db $26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26 ;row 2
<br>    .db $26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26 ;row 3
<br>    .db $26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26 ;row 4
<br>    .db $25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25 ;row 5
<br>    .db $25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25 ;row 6
<br>    .db $25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25 ;row 7
<br>    .db $25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25 ;row 8
<br>    .db $27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27 ;row 9
<br>    .db $27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27 ;row 10
<br>    .db $27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27 ;row 11
<br>    .db $27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27 ;row 12
<br>    .db $28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28 ;row 13
<br>    .db $28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28 ;row 14
<br>    .db $28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28 ;row 15
<br>    .db $28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28 ;row 16
<br>
<br>    .db $26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26 ;row 17
<br>    .db $26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26 ;row 18
<br>    .db $26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26 ;row 19
<br>    .db $26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26,$26 ;row 21
<br>    .db $25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25 ;row 22
<br>    .db $25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25 ;row 23
<br>    .db $25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25 ;row 24
<br>    .db $25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25,$25 ;row 25
<br>    .db $27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27 ;row 26
<br>    .db $27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27 ;row 27
<br>    .db $27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27 ;row 28
<br>    .db $27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27,$27 ;row 29
<br>    .db $28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28 ;row 30
<br>    .db $28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28 ;row 31
<br>    .db $28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28,$28 ;row 32
<br>
<br>I&apos;m only getting first 8 rows, which makes sense, 8x32 = 256 = #$FF. But #$FF is the highest I can use in a 8 bit system, I can&apos;t compare X to #$400 (32 x 32 = 1024 decimal = #$400 hex).
<br>So since this is my first bg loop / test program ever, lol, I&apos;m obviously missing something very easy. 
<br>
<br>Please help, 
<br>OleSchool
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1030">
                                                        <div class="mdl-card__title"><strong>Nallebeorn</strong> posted on 
		
			
				
				Jul 11 at 7:03:35 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					It&apos;s explained in Nerdy Nights week 8, so you can take a peek at that. Basically, you do two loops, one inner than runs 256 times and one outer that runs 4 times (4*256=1024).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1031">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 12 at 2:29:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Nallebeorn</b></i><br>
<br>
It&apos;s explained in Nerdy Nights week 8, so you can take a peek at that. Basically, you do two loops, one inner than runs 256 times and one outer that runs 4 times (4*256=1024).</div>
<br>
Awesome! Hey, and I&#x2019;m honored to be your first post haha! Thanks again!<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1032">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 13 at 4:12:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I finally got the background to populate with the two loops, yay!! 
<br>
<br>But now I&apos;m chasing a random sprite.. I&apos;ve got a sprite at 0,0 of tile $00 of my 1st nametable. I&apos;ve commented out everything except the standard required stuff ( NMI/RTI, Infinite loop,.org, bank, clear memory, vblank waiting, etc.) 
<br>The only thing that makes it go away is commenting out the PPU control settings:
<br>
<br>...
<br>LDA #%10010000          ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1
<br>STA $2000          
<br>LDA #%00011110   ; enable sprites, enable background, no clipping on left side
<br>STA $2001
<br>...
<br>
<br>Is there a bug in my emulator (MESEN), or a bug in the code somehow? This only started after I changed my code around to match the week 8 nerdy nights format.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1033">
                                                        <div class="mdl-card__title"><strong>Nallebeorn</strong> posted on 
		
			
				
				Jul 14 at 11:12:16 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>oleSchool</b></i><br>
<br>
Is there a bug in my emulator (MESEN), or a bug in the code somehow? This only started after I changed my code around to match the week 8 nerdy nights format.</div>
I would be very surprised if it was a Mesen bug <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
<br>
If it started to happen only after your week 8 updates, then it&apos;s obviously a problem with one of the things you changed. Since you said you commented out almost everything, I assume you&apos;ve already verified that it&apos;s not a problem with the new background copy loop, but is there something else you changed at the same time? Could you maybe post the full code?<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1034">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 14 at 8:02:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Nallebeorn</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>oleSchool</b></i><br>
<br>
Is there a bug in my emulator (MESEN), or a bug in the code somehow? This only started after I changed my code around to match the week 8 nerdy nights format.</div>
I would be very surprised if it was a Mesen bug <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
<br>
If it started to happen only after your week 8 updates, then it&apos;s obviously a problem with one of the things you changed. Since you said you commented out almost everything, I assume you&apos;ve already verified that it&apos;s not a problem with the new background copy loop, but is there something else you changed at the same time? Could you maybe post the full code?<br>
&#xA0;</div>
<br>
Yeah, definitely been scratching my head on this one.<br>
I zipped up the asm with my chr just in case its something with the chr file... I also uncommented everything back.&#xA0;<br>
Any help is appreciated. Here is the <a href="http://www.mediafire.com/file/6wj50q642o09cu6/firstgame_backgrounds.zip/file" target="_blank" original-href="http://www.mediafire.com/file/6wj50q642o09cu6/firstgame_backgrounds.zip/file">link</a><br>
<br>
Thanks!<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1035">
                                                        <div class="mdl-card__title"><strong>Nallebeorn</strong> posted on 
		
			
				
				Jul 15 at 10:45:28 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Your clrmem routine is wrong. You use $0200 as the OAM buffer, but you&apos;re clearing $0300 with $fe and $0200 with zeroes. That means you get a bunch of sprites with $00 for all values, which of course means tile $00 at position (0; 0) with palette 0. And don&apos;t forget that the sprites data at the bottom is commented out at the moment, so your LoadSprites loop will be loading garbage data, which will probably be a bunch of zeroes again since that&apos;s what assemblers generally fill unused ROM space with.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1036">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 15 at 4:42:08 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for answering these, Nallebeorn. I was out of town for the week so I missed all these!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1037">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 16 at 3:51:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Nallebeorn</b></i><br>
<br>
Your clrmem routine is wrong. You use $0200 as the OAM buffer, but you&apos;re clearing $0300 with $fe and $0200 with zeroes. That means you get a bunch of sprites with $00 for all values, which of course means tile $00 at position (0; 0) with palette 0. And don&apos;t forget that the sprites data at the bottom is commented out at the moment, so your LoadSprites loop will be loading garbage data, which will probably be a bunch of zeroes again since that&apos;s what assemblers generally fill unused ROM space with.</div>
<br>
Thanks Nallebeorn, that worked!<br>
<br>
I changed my clrmem to this based on what you said:<br>
clrmem:<br>
&#xA0; LDA #$00<br>
&#xA0; STA $0000, x<br>
&#xA0; STA $0100, x<br>
&#xA0; STA $0300, x<br>
&#xA0; STA $0400, x<br>
&#xA0; STA $0500, x<br>
&#xA0; STA $0600, x<br>
&#xA0; STA $0700, x<br>
&#xA0; LDA #$FE<br>
&#xA0; STA $0200, x<br>
&#xA0; INX<br>
&#xA0; BNE clrmem<br>
<br>
I understand what you said, but I&apos;m a little confused on how its working.&#xA0;<br>
Here is what I understand:<br>
<br>
1st Loop<br>
&#xA0; $0000, $0100, $0300..$0700 are set to value A which is 0<br>
&#xA0; $0200 is set to $FE<br>
<br>
2nd Loop<br>
&#xA0; $0001, $0101, $0301..$0701 are set to value A which is 0<br>
&#xA0; $0201 is set to $FE<br>
<br>
...etc<br>
<br>
255th loop<br>
&#xA0; $00FF, $01FF, $03FF...$07FF are set to value A which is 0<br>
&#xA0; $02FF is set to $FE<br>
<br>
If this is correct, why is the OAM buffer $0200-$02FF being set to $FE? Wouldn&apos;t I have the same issue from my original post up top if I had my spaceship on tile $FE in my .chr file?<br>
Just trying to understand.&#xA0;<br>
<br>
Thanks!<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1038">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 16 at 7:37:06 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No, because all the sprites are being set to $FE on the vertical axis which is off the bottom of the screen. Sprites set to 0 will bleed onto the screen a little bit and won&apos;t fully be hidden. Think less about the tile number and more about the sprite positioning. It&apos;s setting all the values of each sprite to $FE: y axis, tile number, palette number, x axis.<br>
<br>
The actual sprite <em>loading</em> routine will obviously happen after this, so all the sprites you actually plan on loading will have their proper values loaded at that time. This is just clearing the memory and &quot;resetting&quot; everything since RAM can be unpredictable upon power on.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1039">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 17 at 2:08:33 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
No, because all the sprites are being set to $FE on the vertical axis which is off the bottom of the screen. Sprites set to 0 will bleed onto the screen a little bit and won&apos;t fully be hidden. Think less about the tile number and more about the sprite positioning. It&apos;s setting all the values of each sprite to $FE: y axis, tile number, palette number, x axis.<br>
<br>
The actual sprite <em>loading</em> routine will obviously happen after this, so all the sprites you actually plan on loading will have their proper values loaded at that time. This is just clearing the memory and &quot;resetting&quot; everything since RAM can be unpredictable upon power on.</div>
<br>
Ahh, makes sense.&#xA0; Couple additional questions come to mind now.&#xA0;<br>
<br>
When I do my background loops, I noticed that I only needed 31 rows (992 bytes) vice 32 rows (1024 bytes) declared in my .db rows to get it to display all rows top to bottom properly.&#xA0;<br>
So I commented out the last .db row declaration in the &quot;background:&quot; label section.&#xA0;<br>
<br>
1.) Is this an issue with the emulator, and / or do I need to code this for working on other mappers / emulators or even the NES differently?&#xA0;<br>
2.) I also thought about saving cycles if I don&apos;t need all 32 rows. Instead of processing 32 x 32 rows, I should process 32x31 (992 bytes). This would also mean my attributes start at a different address saving some memory correct?<br>
3.) I currently have it setup to do 256 bytes in the inner loop, outer loop runs 4 times&#xA0; = 256 x 4 = 1024. Since I only need 992 bytes, whats the best way to do that? I could do 128 x 7, but not really ready to rewrite this thing yet until I get a feel for what everyone else does / recommends.&#xA0;&#xA0;<br>
<br>
Second item is for more cycle saving on the clrmem. You made a great point that its more about the tile position rather than the other bytes of info which got me thinking. Would clrmem be faster if I looped through only setting the positioning and skipping the other 2 bytes, something like this?<br>
<br>
clrmem:<br>
&#xA0; LDA #$00<br>
&#xA0; STA $0000, x<br>
&#xA0; STA $0100, x<br>
&#xA0; STA $0300, x<br>
&#xA0; STA $0400, x<br>
&#xA0; STA $0500, x<br>
&#xA0; STA $0600, x<br>
&#xA0; STA $0700, x<br>
&#xA0; INX<br>
&#xA0; BNE clrmem<br>
<br>
clr_oam_mem:<br>
&#xA0; LDX #$00<br>
&#xA0; LDA #$FE<br>
&#xA0; STA $0200, x<br>
&#xA0; INX<br>
&#xA0; INX<br>
&#xA0; INX<br>
&#xA0; STA $0200, x<br>
&#xA0; BNE clr_oam_mem
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1040">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 17 at 7:29:25 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					From nerdy nights week 2:<br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br>
<br>
<strong>Background</strong><br>
This is the landscape graphics, which scrolls all at once. The sprites can either be displayed in front or behind the background. <strong>The screen is big enough for</strong> <strong>32x30 background tiles,</strong> and there is enough internal RAM to hold 2 screens. When games scroll the background graphics are updated off screen before they are scrolled on screen.</div>
As you can see, backgrounds are 32x30 tiles. Yes, you could code your background loops accordingly. It isn&apos;t an emulator issue. This is just how the NES architecture is. It saves that space for the attribute data.<br>
<br>
Attribute data already starts at $23C0 (if the backgrounds were 32x32 there would be no room for attribute data. It would have to start at $2400, but that&apos;s where the second nametable data is stored).<br>
<br>
I&apos;ve always just left the loops running a full four times. Whatever garbage gets written there will immediately be overwritten when you write your attribute loops, so long as you write it after you load your background.<br>
<br>
As for your last question, that second loop wouldn&apos;t work since you&apos;re resetting X to zero every time, but other than that, you&apos;re already not saving space by having to write a second loop in the first place. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span> It&apos;s cool that you&apos;re making sense of it though. Getting it to be &quot;faster&quot; isn&apos;t really needed, since the screen is always off upon bootup initialization.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1041">
                                                        <div class="mdl-card__title"><strong>Nallebeorn</strong> posted on 
		
			
				
				Jul 17 at 9:18:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					1) A full NES screen isn&apos;t actually square; its native resolution in 256x240 pixels. It always outputs in that resolution, on hardware and in emulators. The size of the visible area of the screen might differ depending on the TV and emulator configuration because of overscan, but the internal resolution if always the same.<br>
Anyway, 240 pixels vertically&#xA0;gives us just 30 rows of 8x8 tiles, but 32 columns. This is also the reason you want to clear OAM with $fe: as long as a sprite&apos;s Y value is larger than or equal to 240 ($f0), it will be off-screen and therefore invisible. The other sprite values (tile ID, attributes and even the X position) don&apos;t actually matter.<br>
2) &amp; 3) A full screen of tile indices takes up 960 bytes (32x30, not 32x31). Conveniently, attribute data for a full screen takes up exactly 64 bytes, so we&apos;re back at 1024 bytes in total. So if you just want to copy a full screen of uncompressed background data, you can very easily copy nametable and attribute data in the same 256x4 nested loop &#x2013; just makes sure you only have 30 rows worth of tile indices, and then put the attribute data directly after that in ROM.&#xA0;<br>
<br>
EDIT: Didn&apos;t see KHAN&apos;s post there, so sorry for duplicate information&#xA0;<span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span><br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1042">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 17 at 1:03:57 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You explained things in a different way, so I appreciate the post. &lt;3
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1043">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 18 at 2:26:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks to both of you, I appreciate different explanations as well. 
<br>
<br>I&apos;m a little concerned about the 32x30 vice 32x31 dilemma I&apos;m having in my code. When my background db rows have 32x31 rows defined, I get all visible rows filled up with tiles. When I do 32x30, the bottom row is full of other random tiles. 
<br>See my code on previous page.  Comment out line 254 so you only have 32x31 instead of 32x32 and when you compile it and open it up in the emulator you&apos;ll see all the rows have tiles. 
<br>
<br>So I am definitely getting what you&apos;re saying, that the 32x30 = 960 bytes and the attributes conveniently take 64 bytes to give us 1024 bytes (I&apos;m gonna add attributes into my Loadbackground tiles loop btw, great idea!). But I keep scratching my head because if I don&apos;t load 32x31 rows, then the bottom row (32) of my screen is filled with other tiles (probably selecting one based on hex value of the attributes binary value equivalent). 
<br>
<br>Anyway, any thoughts or do i have another bug =)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1044">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 18 at 7:14:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, if the code is exactly like it is in that zip file, you are missing row 20, so you actually only have 31 rows listed, and commenting out 1 row (which is working perfect for you) is bringing you down to 30, and commenting out 2 rows (which is giving you a blank row/garbage tiles) is bringing you down to 29.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1045">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 18 at 3:20:53 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
Well, if the code is exactly like it is in that zip file, you are missing row 20, so you actually only have 31 rows listed, and commenting out 1 row (which is working perfect for you) is bringing you down to 30, and commenting out 2 rows (which is giving you a blank row/garbage tiles) is bringing you down to 29.</div>
<span class="sprites_emoticons absmiddle" id="emo_blush">&#xA0;</span>&#xA0;Wow... I mustve looked at my code a hundred times and never saw that I was missing row 20...&#xA0;<br>
Okay, so the laws of physics are still in place haha. So yeah, 32x30 is what I got, now I&apos;m good!<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1046">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 20 at 6:04:36 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Trying to mimick Asteroids for my controller reading demo. Its a simple game, single screen, but I got stuck at turning the sprite. Here&apos;s where I&apos;m at. 
<br>
<br>My chr file has three tiles for the player ship sprite. One facing up ($00), one facing left ($01), one facing diagonally up left ($02). 
<br>I figured with a flip of the vertical or horizontal bits I can cover 8 directions: facing up, down, left, right, and all the diagonals. 
<br>
<br>Moving left and right and up and down isn&apos;t hard (I&apos;ll try diagonals tomorrow), its turning I&apos;m stuck on. I&apos;d like to do the same as in the 2600&apos;s version of asteroids, where I can turn my ship in place by pressing left or right.  I&apos;m thinking I need something like this (psuedo):
<br>
<br>
<br>;Move from facing up to diagonal up left
<br>If $0201 is set to $00, 
<br>and left is pressed, then
<br>set $0201 to $02
<br>
<br>;Move from facing diagonal up left to left
<br>If $0201 is set to $02, 
<br>and left is pressed, then
<br>set $0201 to $01
<br>
<br>;Move from facing left to diagonal down left (flip $02 horizontally)
<br>If $0201 is set to $01 
<br>and left is pressed, then
<br>set $0201 to $02
<br>set $0202 to #%01000000
<br>
<br>...etc.
<br>
<br>
<br>Even if this is the way (seems this could be looped or easier somehow), I would only have 8 directions, I&apos;d like to get as close to 360 as possible, 16 minimum I suppose. 
<br>Do I need more tiles for my sprites to get more directions (16 - 360)? Also, is my psuedo example the best way to code &quot;turning in place&quot;? 
<br>
<br>Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1047">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 20 at 10:11:20 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Correct, you would need more tiles in order to make it seem &quot;more fluid.&quot;<br>
<br>
Your pseudo code won&apos;t really work without multiple compares, since your tile could be the same value in different orientations and you&apos;re just modifying the attribute byte to flip it.<br>
<br>
I&apos;d probably do something like.<br>
<br>
;if left or right button is pressed, increment timer<br>
;if timer &gt;=value, turn ship ;you can adjust this value to change the speed the ship turns<br>
;reset timer<br>
;look to see which of the two directions is pressed<br>
;if left, decrement lookup table value by 2<br>
;if right, increment lookup table value by 2<br>
;check to see if value wrapped off the table, and reset accordingly<br>
;store lookup table value<br>
;set lookup table value to sprite<br>
;increment lookup table value<br>
;set lookup table value to attribute<br>
;end<br>
<br>
Then you would have a lookup table for turning, including direction and attribute data for each position (obviously adjusted for more directions if you wanted it to be smoother).<br>
.db $00,$00;up<br>
.db $02,%01000000;up/right<br>
.db $01,%01000000;right<br>
.db $02,%11000000;down/right<br>
.db $00,%10000000;down<br>
.db $02;%01000000;down/left<br>
.db $01,$00;left<br>
.db $02,$00;up/left<br>
<br>
This is probably slightly more advanced than the Nerdy Nights week you&apos;re on, so just do your best and let me know if/where you get stuck. Lookup tables like this are going to be your main way of storing values for various things, so you should definitely learn how to do it. It&apos;s very similar to how your background loading code works. You&apos;re just additioanlly keeping a variable that stores where in the lookup table you are at all times, even when the button is not pressed.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1048">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 21 at 2:27:04 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
Correct, you would need more tiles in order to make it seem &quot;more fluid.&quot;<br>
<br>
Your pseudo code won&apos;t really work without multiple compares, since your tile could be the same value in different orientations and you&apos;re just modifying the attribute byte to flip it.<br>
<br>
I&apos;d probably do something like.<br>
<br>
;if left or right button is pressed, increment timer<br>
;if timer &gt;=value, turn ship ;you can adjust this value to change the speed the ship turns<br>
;reset timer<br>
;look to see which of the two directions is pressed<br>
;if left, decrement lookup table value by 2<br>
;if right, increment lookup table value by 2<br>
;check to see if value wrapped off the table, and reset accordingly<br>
;store lookup table value<br>
;set lookup table value to sprite<br>
;increment lookup table value<br>
;set lookup table value to attribute<br>
;end<br>
<br>
Then you would have a lookup table for turning, including direction and attribute data for each position (obviously adjusted for more directions if you wanted it to be smoother).<br>
.db $00,$00;up<br>
.db $02,%01000000;up/right<br>
.db $01,%01000000;right<br>
.db $02,%11000000;down/right<br>
.db $00,%10000000;down<br>
.db $02;%01000000;down/left<br>
.db $01,$00;left<br>
.db $02,$00;up/left<br>
<br>
This is probably slightly more advanced than the Nerdy Nights week you&apos;re on, so just do your best and let me know if/where you get stuck. Lookup tables like this are going to be your main way of storing values for various things, so you should definitely learn how to do it. It&apos;s very similar to how your background loading code works. You&apos;re just additioanlly keeping a variable that stores where in the lookup table you are at all times, even when the button is not pressed.</div>
<br>
<br>
Very cool for you to reply with this info bud, much appreciated! But I must&apos;ve read this about 5 times today and I&apos;m still having a little difficulty with the lookup table piece. Storing values makes sense, but I don&apos;t know how to store them and retrieve them because they are values that have no location in memory... or do I just pick something in the 2K RAM? Even so, I&apos;d need a little push / example on initializing the constants like this for a lookup table. If I knew how to do that, then I could store / retrieve them like any other constant variable.&#xA0;<br>
<br>
I think I&apos;ll start working on what I know how to do...making more tiles, haha. I think 16 is enough, 8 won&apos;t cut it, as you only get one diagonal between each cardinal direction, and I don&apos;t want to waste a lot of tiles (I&apos;m using NROM / mapper 0 so I only have 256) for the sprites.&#xA0; I&apos;ll work on that, once its done (hopefully by tomorrow) I&apos;ll let ya know where I get stuck on the table lookup initialization stuff.&#xA0;<br>
<br>
thanks!<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1049">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 21 at 8:22:51 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You&apos;re only storing a variable that keeps track of where on the table you currently are.<br>
<br>
I&apos;m not sure how you&apos;re doing controller reads, but I&apos;ll post code here like is described in one of the later nerdy nights tutorials, week 7, as &quot;Better Controller Reading.&quot;<br>
<br>
Buttons: .rs 1 ;current button presses<br>
MovementTimer: .rs 1 ;timer that needs to be reached in order for movement to begin<br>
ShipDirection: .rs 1 ;current position on our lookup table for the ship direction<br>
<br>
MoveShip:<br>
&#xA0; LDA Buttons ;load buttons variable<br>
&#xA0; AND #%00100000 ;only keep Left bit<br>
&#xA0; BEQ .TryRight ;if Left isn&apos;t held, branch to try Right<br>
;;left is held<br>
&#xA0; INC MovementTimer ;increment movement timer<br>
&#xA0; LDA MovementTimer ;load increment timer<br>
&#xA0; CMP #$xx ;compare to whatever value you want<br>
&#xA0; BCC .End ;if it&apos;s less than this, go to end<br>
&#xA0; DEC ShipDirection ;decrement ship direction x2<br>
&#xA0; DEC ShipDirection<br>
&#xA0; LDA ShipDirection ;check to see if ShipDirection has wrapped around the table<br>
&#xA0; CMP #$FE<br>
&#xA0; BNE .Rotate ;if it hasn&apos;t jump to Rotate<br>
&#xA0; LDA #$0E<br>
&#xA0; STA ShipDirection ;reset ShipDirection to the highest starting value (you&apos;ll change this number when you add more directions to your table)<br>
&#xA0; JMP .Rotate ;jump to Rotate<br>
.TryRight:<br>
&#xA0; LDA Buttons ;load buttons variable<br>
&#xA0; AND #%00010000 ;only keep Right bit<br>
&#xA0; BEQ .Reset ;if Right isn&apos;t held, branch to Reset to reset the MovementTimer variable since button isn&apos;t pressed<br>
;;right is held<br>
&#xA0; INC MovementTimer ;increment movement timer<br>
&#xA0; LDA MovementTimer ;load increment timer<br>
&#xA0; CMP #$xx ;compare to whatever value you want<br>
&#xA0; BCC .End ;if it&apos;s less than this, go to end<br>
&#xA0; INC ShipDirection ;increment ship direction x2<br>
&#xA0; INC ShipDirection<br>
&#xA0; LDA ShipDirection ;check to see if ShipDirection has wrapped around the table<br>
&#xA0; CMP #$10<br>
&#xA0; BNE .Rotate ;if it hasn&apos;t, jump to Rotate<br>
&#xA0; LDA #$00<br>
&#xA0; STA ShipDirection ;reset ShipDirection to the lowest starting value<br>
.Rotate:<br>
&#xA0; LDY ShipDirection ;load ShipDirection in the Y register<br>
&#xA0; LDA ShipLookupTable,y ;look at the sprite for the current direction using the Y register as the offset<br>
&#xA0; STA $0201 ;store<br>
&#xA0; LDA ShipLookupTable+1,y ;look at the attribute data for this direction<br>
&#xA0; STA $0202 ;store<br>
&#xA0; JMP .Reset ;reset MovementTimer<br>
.End:<br>
&#xA0; RTS<br>
.Reset:<br>
&#xA0; LDA #$00 ;reset the timer if Left or Right isn&apos;t pressed<br>
&#xA0; STA MovementTimer<br>
&#xA0; RTS<br>
<br>
ShipLookupTable:<br>
&#xA0; .db $00,$00 ;up<br>
&#xA0; .db $02,%01000000 ;up/right<br>
&#xA0; .db $01,%01000000 ;right<br>
&#xA0; .db $02,%11000000 ;down/right<br>
&#xA0; .db $00,%10000000 ;down<br>
&#xA0; .db $02;%01000000 ;down/left<br>
&#xA0; .db $01,$00 ;left<br>
&#xA0; .db $02,$00 ;up/left<br>
<br>
A better solution would probably be to move the Rotate part of the subroutine to its own subroutine that&apos;s constantly called so that when you implement de-accelaration (making the ship slowly stop spinning when you release the button) it isn&apos;t requiring a button press to set the current direction.<br>
<br>
This should get you started though. Let me know if anything doesn&apos;t make sense.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1050">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 22 at 2:43:19 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
You&apos;re only storing a variable that keeps track of where on the table you currently are.<br>
<br>
I&apos;m not sure how you&apos;re doing controller reads, but I&apos;ll post code here like is described in one of the later nerdy nights tutorials, week 7, as &quot;Better Controller Reading.&quot;<br>
<br>
Buttons: .rs 1 ;current button presses<br>
MovementTimer: .rs 1 ;timer that needs to be reached in order for movement to begin<br>
ShipDirection: .rs 1 ;current position on our lookup table for the ship direction<br>
<br>
MoveShip:<br>
&#xA0; LDA Buttons ;load buttons variable<br>
&#xA0; AND #%00100000 ;only keep Left bit<br>
&#xA0; BEQ .TryRight ;if Left isn&apos;t held, branch to try Right<br>
;;left is held<br>
&#xA0; INC MovementTimer ;increment movement timer<br>
&#xA0; LDA MovementTimer ;load increment timer<br>
&#xA0; CMP #$xx ;compare to whatever value you want<br>
&#xA0; BCC .End ;if it&apos;s less than this, go to end<br>
&#xA0; DEC ShipDirection ;decrement ship direction x2<br>
&#xA0; DEC ShipDirection<br>
&#xA0; LDA ShipDirection ;check to see if ShipDirection has wrapped around the table<br>
&#xA0; CMP #$FE<br>
&#xA0; BNE .Rotate ;if it hasn&apos;t jump to Rotate<br>
&#xA0; LDA #$0E<br>
&#xA0; STA ShipDirection ;reset ShipDirection to the highest starting value (you&apos;ll change this number when you add more directions to your table)<br>
&#xA0; JMP .Rotate ;jump to Rotate<br>
.TryRight:<br>
&#xA0; LDA Buttons ;load buttons variable<br>
&#xA0; AND #%00010000 ;only keep Right bit<br>
&#xA0; BEQ .Reset ;if Right isn&apos;t held, branch to Reset to reset the MovementTimer variable since button isn&apos;t pressed<br>
;;right is held<br>
&#xA0; INC MovementTimer ;increment movement timer<br>
&#xA0; LDA MovementTimer ;load increment timer<br>
&#xA0; CMP #$xx ;compare to whatever value you want<br>
&#xA0; BCC .End ;if it&apos;s less than this, go to end<br>
&#xA0; INC ShipDirection ;increment ship direction x2<br>
&#xA0; INC ShipDirection<br>
&#xA0; LDA ShipDirection ;check to see if ShipDirection has wrapped around the table<br>
&#xA0; CMP #$10<br>
&#xA0; BNE .Rotate ;if it hasn&apos;t, jump to Rotate<br>
&#xA0; LDA #$00<br>
&#xA0; STA ShipDirection ;reset ShipDirection to the lowest starting value<br>
.Rotate:<br>
&#xA0; LDY ShipDirection ;load ShipDirection in the Y register<br>
&#xA0; LDA ShipLookupTable,y ;look at the sprite for the current direction using the Y register as the offset<br>
&#xA0; STA $0201 ;store<br>
&#xA0; LDA ShipLookupTable+1,y ;look at the attribute data for this direction<br>
&#xA0; STA $0202 ;store<br>
&#xA0; JMP .Reset ;reset MovementTimer<br>
.End:<br>
&#xA0; RTS<br>
.Reset:<br>
&#xA0; LDA #$00 ;reset the timer if Left or Right isn&apos;t pressed<br>
&#xA0; STA MovementTimer<br>
&#xA0; RTS<br>
<br>
ShipLookupTable:<br>
&#xA0; .db $00,$00 ;up<br>
&#xA0; .db $02,%01000000 ;up/right<br>
&#xA0; .db $01,%01000000 ;right<br>
&#xA0; .db $02,%11000000 ;down/right<br>
&#xA0; .db $00,%10000000 ;down<br>
&#xA0; .db $02;%01000000 ;down/left<br>
&#xA0; .db $01,$00 ;left<br>
&#xA0; .db $02,$00 ;up/left<br>
<br>
A better solution would probably be to move the Rotate part of the subroutine to its own subroutine that&apos;s constantly called so that when you implement de-accelaration (making the ship slowly stop spinning when you release the button) it isn&apos;t requiring a button press to set the current direction.<br>
<br>
This should get you started though. Let me know if anything doesn&apos;t make sense.</div>
<br>
Wow KHAN, thank you for your response!! You really can crank out this code quickly... I can&apos;t wait till I can do that, haha. Its a lot to take in, and its nothing like what I have so far, so I&apos;m trying to understand it.&#xA0;<br>
<br>
Little things are throwing me off though, maybe I missed them in the NN weekly tutorials (I&apos;ve been reading lots of different stuff). So for example:<br>
<br>
1.) ShipDirection. So I see you initialized &quot;ShipDirection: .rs 1 &quot;, but what is its default value... 0? From the documenation says that rs is assigning the value to a symbol, but the value is taken from the internal counter. But why not use<br>
<br>
ShipDirection: .rs 1&#xA0;<br>
vs<br>
ShipDirection = #$01<br>
<br>
I guess I&apos;m not fully understanding the documenations description of the use of .rsset and .rs vice just making variables... wait instead of deleting all that, it may have clicked now that I had to type it out. Does the purpose of the .rs symbols allow you to change the value (such as INC / DEC) while the direct assignment to the value of 1 (#$01) would not work because it can only stay that one value?&#xA0;<br>
&#xA0;<br>
2.) I really had a hard time understanding a use case for this section, additionally why you chose $#0E (14 decimal?) as well:<br>
...<br>
&#xA0;&#xA0;BNE .Rotate ;if it hasn&apos;t jump to Rotate<br>
&#xA0; LDA #$0E<br>
&#xA0; STA ShipDirection ;reset ShipDirection to the highest starting value (you&apos;ll change this number when you add more directions to your table)<br>
&#xA0; JMP .Rotate ;jump to Rotate<br>
...<br>
<br>
3.) General locations of things. I&apos;m assuming that:&#xA0;<br>
- The Buttons and other variables go at the top before bank 0 and after iNES header<br>
- The MoveShip to Reset labels can all go inside the NMI<br>
- The ShipLocation data bytes go somewhere in bank 1, but I don&apos;t know why other than all my other db declarations are there (backgrounds, palettes, attributes, sprites, etc.). The why helps so that later on when I create more advanced demo / games I can understand how to place things more efficiently.&#xA0;&#xA0;<br>
<br>
Edited:<br>
4.) Forgot one more. How does Buttons get populated? I thought after you latched the controllers, you had to read the value from $4016 into the accumulator (LDA $4016). So how does reading Buttons get a value from $4016?<br>
<br>
Buttons: .rs 1 ;current button presses<br>
...<br>
MoveShip:<br>
&#xA0; LDA Buttons ;load buttons variable<br>
...
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1051">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 22 at 5:52:27 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sorry that I wasn&apos;t more clear.<br>
<br>
1.) The .rs 1 variables are simply declaring them as variables in zero page. The default value is zero I guess, since your clearmem routine is zeroing out everything upon bootup initalization. .rs 1 is simply reserving a byte of RAM for a variable called whatever we do a .rs 1 for. Your assessment is correct. Setting it to ShipDirection = #$01 would make that variable be 1 the entire game (a constant). Reserving a byte of memory allows us to change the value to anything we want at any time.<br>
<br>
2.) When we&apos;re looking at the table I typed out (ShipLookupTable), we can see there are 16 values (two per direction. One for sprite, and one for attribute byte). If, for example, the ship is facing up, ShipDirection would be $00 since it&apos;s at the first value of the table. If we&apos;re still turning left, it would decrement that value twice. If we decrement $00 twice, it would be $FE, which has wrapped off the bottom of the table, so we want to instead set it to the highest first-byte value of our table, which is $0E (the sprite of up/left). The same thing applies in the opposite direction. If the ship is facing up/left and we continue to press the Right direction, it will increment ShipDirection twice, which would put the value at $10, which is higher (more values) than our table goes. We want to wrap it back to the lowest first-byte of the table, which is $00.<br>
<br>
ShipLookupTable: (the following numbers are just POSITIONS. Not values. The red text doesn&apos;t really exist in the table, but the increment/decrement code will get there when you&apos;re inc/dec past where there are values, hence the need to reset back onto the table)<br>
<span style="color:#FF0000;">$FE,$FF; if you&apos;ve decremented down to this point, you&apos;ve wrapped off table. reset back to $0E</span><br>
$00,$01<br>
$02,$03<br>
$04,$05<br>
$06,$07<br>
$08,$09<br>
$0A,$0B<br>
$0C,$0D<br>
$0E,$0F<br>
<span style="color:#FF0000;">$10,$11; if you&apos;ve incremented up to this point, you&apos;ve wrapped off table. reset back to $00</span><br>
<br>
3.) All of the .rs values go at the top before bank zero. This is called zero page. The MoveShip subroutine (which includes a .Reset local subroutine) can go anywhere in any bank. The ShipLocation table can also go anywhere, assuming you are using a mapper that doesn&apos;t bankswitch.<br>
<br>
4.) As mentioned in my post, Buttons gets populated through a subroutine detailed in Nerdy Nights week 7, labeled &quot;Better Controller Reading.&quot; You don&apos;t have to use it. I was just using it to more simply illustrate the button presses (but I would recommend learning to use it, as it&apos;s how I still read controllers to this day).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1052">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 22 at 7:13:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
Sorry that I wasn&apos;t more clear.<br>
<br>
1.) The .rs 1 variables are simply declaring them as variables in zero page. The default value is zero I guess, since your clearmem routine is zeroing out everything upon bootup initalization. .rs 1 is simply reserving a byte of RAM for a variable called whatever we do a .rs 1 for. Your assessment is correct. Setting it to ShipDirection = #$01 would make that variable be 1 the entire game (a constant). Reserving a byte of memory allows us to change the value to anything we want at any time.<br>
<br>
2.) When we&apos;re looking at the table I typed out (ShipLookupTable), we can see there are 16 values (two per direction. One for sprite, and one for attribute byte). If, for example, the ship is facing up, ShipDirection would be $00 since it&apos;s at the first value of the table. If we&apos;re still turning left, it would decrement that value twice. If we decrement $00 twice, it would be $FE, which has wrapped off the bottom of the table, so we want to instead set it to the highest first-byte value of our table, which is $0E (the sprite of up/left). The same thing applies in the opposite direction. If the ship is facing up/left and we continue to press the Right direction, it will increment ShipDirection twice, which would put the value at $10, which is higher (more values) than our table goes. We want to wrap it back to the lowest first-byte of the table, which is $00.<br>
<br>
ShipLookupTable: (the following numbers are just POSITIONS. Not values. The red text doesn&apos;t really exist in the table, but the increment/decrement code will get there when you&apos;re inc/dec past where there are values, hence the need to reset back onto the table)<br>
<span style="color:#FF0000;">$FE,$FF; if you&apos;ve decremented down to this point, you&apos;ve wrapped off table. reset back to $0E</span><br>
$00,$01<br>
$02,$03<br>
$04,$05<br>
$06,$07<br>
$08,$09<br>
$0A,$0B<br>
$0C,$0D<br>
$0E,$0F<br>
<span style="color:#FF0000;">$10,$11; if you&apos;ve incremented up to this point, you&apos;ve wrapped off table. reset back to $00</span><br>
<br>
3.) All of the .rs values go at the top before bank zero. This is called zero page. The MoveShip subroutine (which includes a .Reset local subroutine) can go anywhere in any bank. The ShipLocation table can also go anywhere, assuming you are using a mapper that doesn&apos;t bankswitch.<br>
<br>
4.) As mentioned in my post, Buttons gets populated through a subroutine detailed in Nerdy Nights week 7, labeled &quot;Better Controller Reading.&quot; You don&apos;t have to use it. I was just using it to more simply illustrate the button presses (but I would recommend learning to use it, as it&apos;s how I still read controllers to this day).</div>
<br>
No worries about the clarity, hopefully my questions are coming off as I hope, very geniune.<br>
I&apos;m happy to get any help I can, and even if you never responded, I&apos;d still be VERY grateful for what nudges you&apos;ve given me so far&#xA0;<span class="sprites_emoticons absmiddle" id="emo_happy">&#xA0;</span><br>
<br>
Question 1<br>
&quot;<span style="font-size: 11px;">since your clearmem routine is zeroing out everything upon bootup initalization&quot;&#xA0;</span><br>
This sentence made the first part click, for whatever reason I never realized that..&#xA0;<span class="sprites_emoticons absmiddle" id="emo_blush">&#xA0;</span><br>
<br>
Question 2<br>
The table you drew out makes lots of sense, I have to see it, and that made it click... the paragraph before it I&apos;m still on my 4th read trying to gather it in, lol.. I&apos;m a visual learner so takes me a while to get it, but thankyou!!&#xA0;<br>
<br>
Question 3<br>
So yeah, I&apos;m using nrom / mapper 0, because I don&apos;t know how to bankswitch yet. I&apos;m baby stepping, single screen game (like asteroids). So no scrolling, no bank switching, etc. just getting the basics in this asteroids demo. Crawl, walk, run kinda plan.&#xA0; It is interesting that you said the subroutine could go anywhere. I thought controller manipulation had to be in the NMI section, preferrably before you draw / update sprites.<br>
<br>
The ShipLocation table going anywhere also blew me away. <span class="sprites_emoticons absmiddle" id="emo_confused">&#xA0;</span>&#xA0;I&apos;m still learning banks and where stuff goes. I know based on my header for inesprg I have 1 16K bank for my code, ineschr I have 1 single 8KB for my bin / chr file. NN week 2 was where I based most of that information from. But for example, its not explained the purpose of $0800-$2000, which is another 6KB. So the purpose and addresses of each banks and overall total size (for mapper 0) I&apos;m still a little fuzzy on.&#xA0;<br>
<br>
Question 4&#xA0;&#xA0;<br>
Gotcha. Yeah, I saw your code and it wasn&apos;t until earlier this morning it kinda clicked that it was code, but a bit psuedo code and I needed to use this with the week 7 subroutines. I was gonna delete my question but then I was like...oh well.&#xA0;<br>
<br>
Anyway, thanks again, I&apos;ll be working on this for the next few evenings I&apos;m sure, and running into more issues I&apos;m sure. But thats my joy in doing this, learning while creating something, so cool!<br>
<br>
<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1053">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 23 at 9:18:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<span style="font-size: 11px;">ShipLookupTable: ;values</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $00,$00 ;up</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $02,%01000000 ;up/right</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $01,%01000000 ;right</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $02,%11000000 ;down/right</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $00,%10000000 ;down</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $02;%01000000 ;down/left</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $01,$00 ;left</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $02,$00 ;up/left<br>
<br>
ShipLookupTable: ;positions (not actually in the game code. just writing for clarity&apos;s sake)</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $00,$01 ;up</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $02,$03 ;up/right</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $04,$05 ;right</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $06,$07 ;down/right</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $08,$09 ;down</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $0A,$0B ;down/left</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $0C,$0D ;left</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $0E,$0F ;up/left<br>
<br>
If we load ShipLookupTable, it will be looking at the first value under ShipLookupTable. Position 0. The value just happens to also be $00. Bad example.<br>
<br>
The way I&apos;m looking up ShipLookupTable in the code I sent a few posts ago, I&apos;m offsetting that by Y.<br>
<br>
LDA ShipLookupTable,y<br>
<br>
What this means is look up ShipLookupTable+y.<br>
<br>
In this code, we are setting ShipDirection to Y and using that to tell us where in the table we want to use the values from.<br>
<br>
So let&apos;s say ShipDirection is $06 and we load that into Y and then we LDA ShipLookupTable,y. That would be looking at the 6th position in the table. If we look at our positions table (which I&apos;ve just written for clarity&apos;s sake and wouldn&apos;t actually be in the game code) we can see that is the first value of down/right, which is actually $02 if we look in the actual ShipDirection table. LDA ShipLookupTable,y would be $02.<br>
<br>
LDA ShipLookupTable+1,y will load the value AFTER ShipLookupTable,y, because Y doesn&apos;t change. That would be looking at position 7, which is the palette attribute byte of down/right, which is %11000000.<br>
<br>
So everything is basically automatic in the code I wrote. You&apos;re pressing a direction, it&apos;s running a delay timer so that it is facing a single direction for more than a single frame, then it&apos;s incrementing or decrementing ShipDirection by 2 to get to the next row of values in the table and using those values to 1) store the sprite tile and 2) store the sprite attribute byte.<br>
<br>
No idea if you already understood this stuff, but it sounded like you might need more explanation on it so I tried to break it down more. If there&apos;s anything specific you&apos;re struggling with please let me know.</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1054">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 23 at 2:36:09 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
<span style="font-size: 11px;">ShipLookupTable: ;values</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $00,$00 ;up</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $02,%01000000 ;up/right</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $01,%01000000 ;right</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $02,%11000000 ;down/right</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $00,%10000000 ;down</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $02;%01000000 ;down/left</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $01,$00 ;left</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $02,$00 ;up/left<br>
<br>
ShipLookupTable: ;positions (not actually in the game code. just writing for clarity&apos;s sake)</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $00,$01 ;up</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $02,$03 ;up/right</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $04,$05 ;right</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $06,$07 ;down/right</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $08,$09 ;down</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $0A,$0B ;down/left</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $0C,$0D ;left</span><br style="box-sizing: border-box; font-size: 11px;">
<span style="font-size: 11px;">&#xA0; .db $0E,$0F ;up/left<br>
<br>
If we load ShipLookupTable, it will be looking at the first value under ShipLookupTable. Position 0. The value just happens to also be $00. Bad example.<br>
<br>
The way I&apos;m looking up ShipLookupTable in the code I sent a few posts ago, I&apos;m offsetting that by Y.<br>
<br>
LDA ShipLookupTable,y<br>
<br>
What this means is look up ShipLookupTable+y.<br>
<br>
In this code, we are setting ShipDirection to Y and using that to tell us where in the table we want to use the values from.<br>
<br>
So let&apos;s say ShipDirection is $06 and we load that into Y and then we LDA ShipLookupTable,y. That would be looking at the 6th position in the table. If we look at our positions table (which I&apos;ve just written for clarity&apos;s sake and wouldn&apos;t actually be in the game code) we can see that is the first value of down/right, which is actually $02 if we look in the actual ShipDirection table. LDA ShipLookupTable,y would be $02.<br>
<br>
LDA ShipLookupTable+1,y will load the value AFTER ShipLookupTable,y, because Y doesn&apos;t change. That would be looking at position 7, which is the palette attribute byte of down/right, which is %11000000.<br>
<br>
So everything is basically automatic in the code I wrote. You&apos;re pressing a direction, it&apos;s running a delay timer so that it is facing a single direction for more than a single frame, then it&apos;s incrementing or decrementing ShipDirection by 2 to get to the next row of values in the table and using those values to 1) store the sprite tile and 2) store the sprite attribute byte.<br>
<br>
No idea if you already understood this stuff, but it sounded like you might need more explanation on it so I tried to break it down more. If there&apos;s anything specific you&apos;re struggling with please let me know.</span></div>
<br>
Dude, its your birthday and you&apos;re spending it on here helping me, what a guy!! That&apos;s it, I nominate KHAN Games for MOTM! (member of the month)&#xA0;<span class="sprites_emoticons absmiddle" id="emo_happy">&#xA0;</span>&#xA0;<br>
But in all seriousness, much thanks again. I understood it about 90%, but even still I was able to learn more information.<br>
<br>
The timing piece is nice, basically increment a few frames before branching off to actually rotate. That&apos;s pretty slick and could have other uses, so that&apos;s a tool I&apos;m gonna keep in the bag. I&apos;m playing around with different numbers to see what works the smoothest, 2 is still to fast, and 3 is way to slow, not sure why such a huge disparity in a single frame, but I&apos;m working on it.&#xA0;<br>
<br>
As far as the indexing with the ShipLookupTable, I was happy you said this: &quot;...then it&apos;s incrementing or decrementing ShipDirection by 2 to get to the next row of values in the table...&quot;.&#xA0; For whatever reason I wasn&apos;t sure why you were INC/DEC x2, now I get it and that made the rest of the 10% click. It got me thinking though. Just for an exercise / my understanding purposes, I flattened out the code like so:<br>
<br>
ShipLookupTable:<br>
&#xA0; .db $00,$00,&#xA0;$02,%01000000,&#xA0;$01,%01000000,&#xA0;$02,%11000000, $00,%10000000, $02,%01000000, $01,$00, $02,$00<br>
<br>
And it still works, this helped me clarify the reason for DEC/INC x2, and it was because the values are in &quot;pairs&quot;. Obviously harder to read / document / maintain so not recommended but it helped me get how it works a bit more.&#xA0;<br>
<br>
Very cool stuff! I&apos;m always appreciative and happy birthday bro!&#xA0;&#xA0;<br>
<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1055">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 23 at 6:05:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span> Sounds like you&apos;re fully understanding things now. That&apos;s awesome!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1056">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 29 at 3:02:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
Thanks. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span> Sounds like you&apos;re fully understanding things now. That&apos;s awesome!</div>
<br>
Hmm... I thought so too until I tried to add a player 2 this week. Here I am late sunday on the weekend still can&apos;t get it lol.&#xA0;<br>
I added a second MoveShip, buttons2, even rotate2, end2, etc. (just to make sure it wasn&apos;t going to another subroutine and overwriting / getting lost)<br>
<br>
No dice, so this is what I did for debugging so far (which seems to be my shortfall, so help me learn some debugging on this).<br>
So I wanted to test the controller and the 2 sprites so I did this:&#xA0;<br>
<br>
1.) Setup FCEUX and tested that 2nd controller is being detected and usable. (CHECK)<br>
2.) I swapped ReadController1&apos;s LDA $4016 for $4017 and the MoveShip to see if controller 2 could move sprite 1 (CHECK)&#xA0;<br>
3.) I swapped ReadController1&apos;s LDA $4016 for $4017 and the MoveShip to see if controller 1 could move sprite 2 (CHECK)&#xA0;<br>
3.) I changed from sprite 1&apos;s tile / attributes ($0201 / $0202) to sprite 2&apos;s tile and attributes ($0204 / $0205) to see if controller 2 could rotated sprite 2 (CHECK)<br>
<br>
So I know its not the sprite code, I know its not the controller...so its the buttons2 / ship movement2 code. Well, I opened debugger, got lost&#xA0;<span class="sprites_emoticons absmiddle" id="emo_blush">&#xA0;</span>&#xA0;<br>
I wanted to somehow setup a test to verify a few things:<br>
<br>
1.) Is buttons2 being populated with a byte of correct values?<br>
2.) View the AND results to see if it even sees left / right bits<br>
3.) etc...but to step through the rest to see where its failing or jumping off.&#xA0;<br>
<br>
So if you or anyone can, I&apos;d like to be helped a bit more on debugging rather than the answer to the problem. I really need to learn debugging and need some help with doing it.&#xA0;<br>
<br>
Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1057">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 29 at 7:18:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>oleSchool</b></i><br>
<br>
1.) Is buttons2 being populated with a byte of correct values?<br>
&#xA0;</div>
<br>
I don&apos;t know how to do the other two things you&apos;re asking, as I&apos;m pretty crappy with using the Debugger myself. But for this you just need to open the Hex editor in FCEUX (or Mesen) and look at the $0200-$02FF addresses. You can see what values all your sprites have for all their bytes. The addresses you gave for sprite 2 are wrong though (you gave the tile/attribute for sprite one, but v pos and tile for sprite two)<br>
<br>
And you can look in the $0000-00FF area for your zero page variable values (like Buttons and Buttons2), but you have to count how many reserved bytes you&apos;ve used ahead of these variables in order to narrow down exactly which byte to look at for each variable. (ie: the first zero page variable would be $0000, the second $0001, assuming they are all a single byte).<br>
<br>
I can show you how to use the Debugger to break when your Buttons variable is not zero, but other than that I don&apos;t know how to step through the AND reads.<br>
<br>
Open debugger and click on Add Breakpoint. After you&apos;ve figured out which address your Buttons variable is, you&apos;ll want to type this address in both Address fields. (If you can&apos;t deduce which zeropage variable is your Buttons variable, you can open the FCEUX Hex Editor and start pressing directions and a/b. You should see a value jumping around as you press them.)<br>
<br>
After you put the address in, you&apos;ll want to click on Write and then for condition put A != #0<br>
<br>
This is pretty much the extent of my debugging skills. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span> Good luck!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1058">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 30 at 2:34:47 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
&#xA0;
<div class="FTQUOTE"><i>Originally posted by: <b>oleSchool</b></i><br>
<br>
1.) Is buttons2 being populated with a byte of correct values?<br>
&#xA0;</div>
<br>
I don&apos;t know how to do the other two things you&apos;re asking, as I&apos;m pretty crappy with using the Debugger myself. But for this you just need to open the Hex editor in FCEUX (or Mesen) and look at the $0200-$02FF addresses. You can see what values all your sprites have for all their bytes. The addresses you gave for sprite 2 are wrong though (you gave the tile/attribute for sprite one, but v pos and tile for sprite two)<br>
<br>
And you can look in the $0000-00FF area for your zero page variable values (like Buttons and Buttons2), but you have to count how many reserved bytes you&apos;ve used ahead of these variables in order to narrow down exactly which byte to look at for each variable. (ie: the first zero page variable would be $0000, the second $0001, assuming they are all a single byte).<br>
<br>
I can show you how to use the Debugger to break when your Buttons variable is not zero, but other than that I don&apos;t know how to step through the AND reads.<br>
<br>
Open debugger and click on Add Breakpoint. After you&apos;ve figured out which address your Buttons variable is, you&apos;ll want to type this address in both Address fields. (If you can&apos;t deduce which zeropage variable is your Buttons variable, you can open the FCEUX Hex Editor and start pressing directions and a/b. You should see a value jumping around as you press them.)<br>
<br>
After you put the address in, you&apos;ll want to click on Write and then for condition put A != #0<br>
<br>
This is pretty much the extent of my debugging skills. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span> Good luck!</div>
<br>
Yeah, typo for sprite 2 addresses. I was thinking &quot;add 4&quot; when I backspaced, so I typed 4, then added 1 for $0205..lol but all good.&#xA0;<br>
<br>
Hex editor was great. I saw the 8th byte (reserved for buttons2) populate correctly with every type of button press, so thats good to go! Very cool tip to learn as well.&#xA0;<br>
<br>
I added the breakpoint, but nothing happened. Seemed pretty straight forward, but no matter which controller or direction / button pressed, nothing happened. Did I miss something?<br>
<br>
<br>
<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1059">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 30 at 3:15:21 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m assuming it has to do with how the controller is read or something because when I try to use the same kinda breakpoint on another variable that doesn&apos;t have to do with a controller it works fine.
<br>
<br>Like I said, I don&apos;t know much about using the debugger.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1060">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Jul 31 at 4:53:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
I&apos;m assuming it has to do with how the controller is read or something because when I try to use the same kinda breakpoint on another variable that doesn&apos;t have to do with a controller it works fine.<br>
<br>
Like I said, I don&apos;t know much about using the debugger.</div>
<br>
I&apos;m honestly not sure what fixed it... but I put both MoveShip and MoveShip2 (copy of MoveShip but uses buttons2) outside the NMI, and created a JSR to MoveShip and JSR to MoveShip2 and now each controller can rotate each players ship.&#xA0;<br>
Not sure why that was needed, but it works... odd.&#xA0;<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1061">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Jul 31 at 9:07:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I guess I would have had to see how things were organized prior, but glad it is working now.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1062">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Aug 01 at 3:57:14 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m very interested in the why simply so I know for later when it may bite me in the butt haha.&#xA0;Here is the current (attached).&#xA0;<br>
<br>
In its current version, both player 1 and 2 controllers can rotate their respective sprites.&#xA0;So to revert to the &quot;non working&quot; version you take lines 210 - 332&#xA0; and cut them.<br>
Then paste it over / replace the 2 &quot;JSR MoveShip[1|2]&quot; lines at the end of the NMI. I think you have to remove the last RTS as well since its no longer a subroutine being referenced, but that should be all.&#xA0;&#xA0;<br>
Player 1 controller will be able to spin the player 1 sprite, but Player 2 controller won&apos;t be able to spin player 2 sprite.&#xA0;<br>
<br>
Other than taking it out of the NMI and calling the MoveShip as a subroutine there&apos;s no changes to the code really.&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1063">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Aug 01 at 12:26:32 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well, looking at the code, in order for the code to work inside NMI after pasting it back in there, you&apos;d have to take out more than a single RTS. The NMI needs to get all the way down to RTI no matter what, so your code needs to be modified a little bit. Basically in every spot there is a RTS in MoveShip1, you&apos;ll need to delete the RTS and instead JMP to MoveShip2, so the second ship&apos;s routine is read. Then every place there is a RTS in MoveShip2, you&apos;ll need to delete the RTS and instead JMP to the end of MoveShip2 (after the RTS after .Reset2) so that it arrives at RTI.
<br>
<br>Writing it the way you have it currently written (moving the routines out of NMI and just JSR&apos;ing to them) is way cleaner/easier due to the ability to use the RTS in the individual subroutines. Jumping back to the main NMI this way allows you to not have to keep track of all the weird flow of things.
<br>
<br>Right now, if it hits an RTS inside of NMI without having to go through a JSR to get there, it is returning to god knows where and it will behave erratically. I&apos;m surprised it worked at all, honestly. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1064">
                                                        <div class="mdl-card__title"><strong>oleSchool</strong> posted on 
		
			
				
				Aug 04 at 5:40:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>KHAN Games</b></i><br>
<br>
Well, looking at the code, in order for the code to work inside NMI after pasting it back in there, you&apos;d have to take out more than a single RTS. The NMI needs to get all the way down to RTI no matter what, so your code needs to be modified a little bit. Basically in every spot there is a RTS in MoveShip1, you&apos;ll need to delete the RTS and instead JMP to MoveShip2, so the second ship&apos;s routine is read. Then every place there is a RTS in MoveShip2, you&apos;ll need to delete the RTS and instead JMP to the end of MoveShip2 (after the RTS after .Reset2) so that it arrives at RTI.<br>
<br>
Writing it the way you have it currently written (moving the routines out of NMI and just JSR&apos;ing to them) is way cleaner/easier due to the ability to use the RTS in the individual subroutines. Jumping back to the main NMI this way allows you to not have to keep track of all the weird flow of things.<br>
<br>
Right now, if it hits an RTS inside of NMI without having to go through a JSR to get there, it is returning to god knows where and it will behave erratically. I&apos;m surprised it worked at all, honestly. <span class="sprites_emoticons absmiddle" id="emo_smile">&#xA0;</span></div>
I never got to say thanks bud! Yeah, all good now.&#xA0;<br>
Anyway, I thought it&apos;d be cool if you had to hit refresh one more time&#xA0;<span class="sprites_emoticons absmiddle" id="emo_wink">&#xA0;</span><br>
<br>
But seriously, much thanks for the help, you guys rock!<br>
<br>
&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1065">
                                                        <div class="mdl-card__title"><strong>LambBrainz</strong> posted on 
		
			
				
				Oct 06 at 12:45:42 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Fellow kids, a quick question about &quot;everything in NMI&quot;, &quot;everything in main&quot;, and how to structure a game.
<br>
<br>I&apos;ve seen lots of different forums, articles on NesDev, answers here at NA, and other places talk about where to put the bulk of your code and mention something to the effect of &quot;if your game is small enough&quot; or &quot;if your game isn&apos;t very complex&quot;, etc.
<br>
<br>My question is (since no real context was provided in any of those places), what makes a game &quot;small&quot; or &quot;complex&quot; or &quot;big&quot;? Would small be something like Pong from Nerdy Nights or something smaller? Would complex be like SMB or Zelda II? I&apos;m trying to have some examples so I know how exactly I would classify the game I&apos;m working on so I don&apos;t have to do some massive overhaul later on and can do it more properly from the start. (Namely, deciding what functionality the NMI will do. Whether that&apos;s incrementing a counter like some people do, putting all the code in NMI which apparently SMB does, or making my code interrupt aware and going from there).
<br>
<br>Thanks for the help whenever someone sees this,
<br>LambBrainz
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1066">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Oct 07 at 10:57:40 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					My 0.02 would be to do it properly from the start, which, in my opinion, would be to put the NMI stuff in NMI and the rest in Main.  It&apos;ll save you headaches later on, especially if you move onto bigger or better games. 
<br>
<br>Don&apos;t worry with doing it one way or the other depending on complexity, do it right.  IIRC, NN and my tutorials all do it &quot;correctly&quot;.  It&apos;s been a while though.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1067">
                                                        <div class="mdl-card__title"><strong>LambBrainz</strong> posted on 
		
			
				
				Oct 07 at 11:48:52 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					And &quot;NMI stuff&quot; being what exactly? Cause even that has varying answers. The most common being graphics updates and what not; but I&apos;ve also seen the &quot;NMI increments a counter&quot; method as well. What is considered best practice in that regard?
<br>
<br>Also, thanks for the reply!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1068">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Oct 07 at 2:17:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Every game I&apos;ve made has been entirely in the NMI, although I have had to fight background update flickering occasionally.
<br>
<br>The &quot;proper&quot; way to do it is to create some sort of routine that writes to RAM all the background graphics/palette updates you need to do, and then when NMI hits it looks to see if there are values in that buffer and draws them. So you&apos;re always constantly putting the &quot;next frame&apos;s updates&quot; in RAM and then when NMI comes it draws them all at once in one fell swoop.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1069">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Oct 07 at 2:37:01 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					My gamestate NMI is generally empty, depending on the gamestate. When it is needed it only does absolutely what is essential, like drawing background tiles. Any normal stuff like reading the controller, incrementing a single counter like a random seed, music, etc. all runs in a separate NMI space. See MRN&apos;s tutorials for what that might look like (thanks buddy, still using your basic setup six years later!).
<br>
<br>These days I also split things like scroll writes, sprite 0 hits, and delay loops off from normal and gamestate NMI, which having NMI already in a separate area helped a lot with. Any time that you have to sit there and find a bunch of different ways to work around your own code it is probably time to start splitting things off.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-2__1070">
                                                        <div class="mdl-card__title"><strong>LambBrainz</strong> posted on 
		
			
				
				Oct 07 at 3:08:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					That makes sense, thanks for the responses everyone.
<br>
<br>I like the buffer idea, I&apos;ve seen that with drawing logic and it definitely becomes necessary when doing music (per MetalSlime&apos;s tutorials) so I&apos;mma sharpen my skills with buffers and give that a go. And I&apos;ll definitely hunt down MRN&apos;s stuff and start working thru that.
<br>
<br>Thanks again, everyone!
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="misc-3">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">MMC1 Memory Mapping: NintendoAge Programming Resources - MMC1 Memory Mapping</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <h6 class="cardSubtitle">Written by MRN</h6>

                        
					<p>INTRO</p><p>I had a request for MMC1 mapper information, so I thought everyone might like to read what I have to say.</p><p>This will help you figure out MMC1 memory mapping.&#xA0; It assumes that you have a working knowledge <br>of NES programming and can understand my messed up little mind. Most of the information on this<br>mapper can be found on:</p><p><a href="http://wiki.nesdev.com/w/index.php/MMC1" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/MMC1">http://wiki.nesdev.com/w/index.php/MMC1</a></p><p>MMC1 will allow you to use up to 256 kB of PRG ROM and 128 kB of CHR ROM.&#xA0; I think that you can use SUROM to expand up to 4 MB of PRG ROM, but this is not covered here.</p><p><br>First, you have to decide on what kind of configuration you want to use.&#xA0; MMC1 will support PRG bank<br>switching in either 16kB mode or 32kB mode.&#xA0; And with the 16, you can choose whether you want <br>the memory at $C000 or the memory at $8000 to be switched.&#xA0; </p><p>Second, you have to decide on the CHR ROM switching.&#xA0; MMC1 supports switching of 4kB (background or sprite tiles separately) or 8kB (switching them together).</p><p><br>After you decide this, you are ready to start.</p><p><br>INES HEADER</p><p>Notes:</p><p>-You can only have even numbers of PRG banks.&#xA0; NESASM uses 8kB &quot;banks&quot;, I&apos;m talking about 16kB banks.&#xA0; <br>i.e. 02 (32kB),04 (64kB),06 (96kB),08 (128kB),0A (160kB),0C (192kB),0E (224kB),10 (256kB)</p><p>-CHR banks are in multiples of 8kB banks. (important if you are using 4kB swapping.)<br>i.e. 01 (8kB),02 (16kB),03 (24kB),04 (32kB),05 (40kB), 06 (48kB), etc., 10 (128kB)</p><p>-MMC1 mapper number is &quot;1&quot; ...creative!</p><p>-Mirroring should match that used below in the initiation routine.</p><p>In this exercise, we will use:</p><p>&#xA0; .inesprg $10&#xA0;&#xA0; ; 16x 16KB PRG code<br>&#xA0; .ineschr $10&#xA0;&#xA0; ; 16x&#xA0; 8KB CHR data<br>&#xA0; .inesmap $01&#xA0;&#xA0; ; mapper 1 = MMC1, 4KB CHR bank swapping<br>&#xA0; .inesmir 0&#xA0;&#xA0; ; background mirroring</p><p><br>MAPPER CONTROL HEADER</p><p>This is one bite that has all the information for the mapper.&#xA0; Observe:</p><p>76543210</p><p>Bits 7,6,5 - Not sure what these do.<br>Bit 4 - CHR ROM bank mode - (0 means switch 8kB at a time, 1 means switch the two separate 4kB banks independently)<br>Bit 3 - PRG ROM bank mode - (0 means switch all 32kB at once, ignores bit 2)<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; (1 means switch ONLY the 16kB specified in bit 2)<br>Bit 2 - PRG ROM location - (0 means switch 16kB at $C000, 1 means switch 16kB at $8000)<br>Bits 1,0 - Mirroring - (0 means one screen, lower bank; 1 means one screen, upper bank<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 2 means vertical; 3 means horizontal)</p><p>Here we will use LDX #%00011000 </p><p>BITCH WORK!&#xA0; Look above and figure out what this means.</p><p><br>INITIATE MAPPER</p><p>Here we load the information required by the system to run the mapper as well as the initial banks.<br>You have to do the 5 writes to make it work...for whatever reason.</p><p>initMMC1Mapper:<br>&#xA0; LDA #$80&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;this locks the PRG ROM at $C000-$FFFF to the last bank.<br>&#xA0; STA $8000<br>&#xA0;<br>&#xA0; TXA&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;uses our header to initiate the mapper<br>&#xA0; JSR setMMC1ControlMode<br>&#xA0;<br>&#xA0; LDA #$02&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;sets the CHR information for the sprites<br>&#xA0; JSR setCHRPage0000<br>&#xA0;<br>&#xA0; LDA #$01&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;sets the CHR information for the background<br>&#xA0; JSR setCHRPage1000<br>&#xA0;<br>&#xA0; LDA #$03&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;sets the PRG information<br>&#xA0; JSR setPRGBank<br>&#xA0;<br>&#xA0; RTS<br>&#xA0;<br>setMMC1ControlMode:<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $8000 <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $8000 <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $8000 <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $8000 <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $8000 <br>&#xA0; RTS<br>&#xA0;<br>setCHRPage0000:<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $A000<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $A000<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $A000<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $A000<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $A000&#xA0; <br>&#xA0; RTS</p><p>setCHRPage1000:<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $C000<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $C000<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $C000<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $C000<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $C000 <br>&#xA0; RTS <br>&#xA0;<br>setPRGBank:<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $E000 <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $E000 <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $E000 <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $E000 <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; LSR A <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; STA $E000 <br>&#xA0; RTS</p><p>Congrats....your program should work.</p><p>USING THE MAPPER</p><p>You can swap out banks whenever you want, even several times per NMI.&#xA0; Just load the bank number you want to<br>use into A and call the appropriate subroutine.&#xA0; Just be sure that you don&apos;t switch away information that<br>your program needs to run or it will die.</p><p>Weird bank numbering notes:</p><p>-CHR data is stored in 8kB for NESASM.&#xA0; If you want to call the first 4kB of data from the 6th 8kB chunk,<br>you would use bank #$0C.&#xA0; Observe, call number for 4kB chunk vs. 8kB bank number:</p><p>00-0<br>01-0<br>02-1<br>03-1<br>04-2<br>05-2<br>06-3<br>07-3<br>08-4<br>09-4<br>0A-5<br>0B-5<br>0C-6<br>0D-6<br>0E-7<br>0F-7<br>10-8<br>11-8<br>12-9<br>13-9<br>14-10<br>15-10<br>16-11<br>17-11<br>18-12<br>19-12<br>1A-13<br>1B-13<br>1C-14<br>1D-14<br>1E-15<br>1F-15</p><p>Clear?</p><p>-PRG info is stored in 8kB chunks in NESASM, but you call and switch 16kB banks.&#xA0; If you want to call bank 26, use call number #$0D.&#xA0; Observe, call number vs. bank number:</p><p>0-0,1<br>1-2,3<br>2-4,5<br>3-6,7<br>4-8,9<br>5-10,11<br>6-12,13<br>7-14,15<br>8-16,17<br>9-18,19<br>A-20,21<br>B-22,23<br>C-24,25<br>D-26,27<br>E-28,29<br>F-30,31</p><p>Clear?</p><p>-At the end of each 16kB bank, you have to have vectors in place or it will die.</p><p>&#xA0; .org $FFFA&#xA0;&#xA0;&#xA0;&#xA0; ;first of the three vectors starts here<br>&#xA0; .dw NMI&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0;;when an NMI happens (once per frame if enabled) the&#xA0;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;;processor will jump to the label NMI:<br>&#xA0; .dw RESET&#xA0;&#xA0;&#xA0; ;when the processor first turns on or is reset, it will jump<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;to the label RESET:<br>&#xA0; .dw 0&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;external interrupt IRQ is not used in this tutorial</p><p>-Bank numbering is successive.&#xA0; i.e. if you have PRG banks numbered 0-23, you would start numbering your CHR banks at 24.</p><p>-If you have, for example, a 16kB CHR file, you only have to include the starting place and NESASM will <br>split the banks properly. i.e. in 4kB mode:</p><p>&#xA0; .bank 32<br>&#xA0; .org $0000<br>&#xA0; .incbin &quot;MMC1.chr&quot;&#xA0;&#xA0; ;includes 16KB graphics file </p><p>This will include 4 - 4kB (or 2-8kB) banks in the assembly process.&#xA0; Be sure to account for the 2 banks <br>in your numbering.&#xA0; (see the attached ASM file.)</p><p><br>PRACTIAL APPLICATION</p><p>This is a little inefficient.&#xA0; To use all this nonsense in something real, an example would be:</p><p>LoadBackground:</p><p>;find room info</p><p>;switch to room info table bank</p><p>;load bankground pointer</p><p>;switch to bank where background information is stored</p><p>;load background</p><p>;switch back to room info table bank</p><p>;load attribute and palette pointers</p><p>;switch to attribute/palette information bank</p><p>;load attributes/palettes</p><p>;switch back to room info table bank</p><p>;load collision detection pointer</p><p>;switch to collision detection bank</p><p>&#xA0; RTS</p><p><br>WORKING EXAMPLE</p><p>Here we use the controller to switch banks for both CHR banks and the PRG bank.</p><p>A and B - swap out CHR information for the sprites<br>Select and Start - nothing<br>Up and Down - load a background located in different banks (the flashing is cause you are holding the button<br>down for more than one frame.&#xA0; Just tap it.&#xA0; I was too lazy to add stuff in to fix this.)<br>Left and Right - swap out the CHR information for the backgrounds</p><p>Download the attached file and assemble the program.&#xA0; Mess around with it and try to switch out the <br>various buttons and banks.&#xA0; Fix the flashing.&#xA0; Add new backgrounds and characters...etc.</p><p>The little DOS assembler file might not work, you may have to edit it to your drive.</p><p><br>THE END!</p><p>I&apos;m sure I totally screwed this up, but don&apos;t worry!&#xA0; Someone will help me out if there are any mistakes.<br></p>
				<br><p><strong>Attachment:</strong> <a no-mirror href="scraper/files/MMC1.zip">MMC1.zip</a></p>                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#misc-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;misc-3__comments&apos;);">
                            Toggle Responses
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=26114" target="_blank">
                                Original Thread
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="misc-3__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__1">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Nov 25, 2009 at 12:33:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks MRN. <img src border="0" style="display: none;" original-src="i/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__2">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Nov 25, 2009 at 1:38:11 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					No problem.  Feel free to PM or post if you have questions.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__3">
                                                        <div class="mdl-card__title"><strong>Memblers</strong> posted on 
		
			
				
				Nov 28, 2009 at 1:14:52 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br>-You can only have even numbers of PRG banks.&#xA0; NESASM uses 8kb &quot;banks&quot;, I&apos;m talking about 16kb banks.&#xA0; <br><p>i.e. 02 (32kb),04 (64kb),06 (96kb),08 (128kb),0A (160kb),0C (192kb),0E (224kb),10 (256kb)<br></p><br></div><br>While technically you can make your PRG in all those sizes, there&apos;s no guarantee that all emulators will load sizes other than 32kB, 64kB, 128kB, 256kB, 512kB, etc.&#xA0; Some emus will want to start in the highest numbered bank, which is problematic if the ROM is abnormally sized.<br><br>Though in my experience with an MMC1A, it started in a random 32kB bank.&#xA0; So you may need a copy of the vectors and some startup code in every 32kB bank, that&apos;s easy enough.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__4">
                                                        <div class="mdl-card__title"><strong>rizz</strong> posted on 
		
			
				
				Feb 18, 2010 at 1:02:08 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m trying to write code for the MMC3 mapper, and somewhere I&apos;m getting it wrong.  Do any of these stand out:
<br>1) I&apos;m using asm6 and inside the header I&apos;m telling it 8 PRG banks, with %01000011 as control byte 1
<br>
<br>2) My code for setting up the banks is basically:
<br>.base $8000
<br>.include &quot;firstbank8000.asm&quot;
<br>.pad $A000
<br>
<br>.base $8000
<br>.include &quot;secondbank8000.asm&quot;
<br>.pad $A000
<br>etc.
<br>
<br>at the end, I have
<br>.base $E000
<br>;code for interrupt vectors
<br>.pad $FFFA
<br>
<br>.dw NMI
<br>.dw RESET
<br>.dw 0
<br>
<br>.incbin &quot;graphics.chr&quot;
<br>
<br>3) Something I noticed - when I assemble and run the .nes file, I&apos;ll get a gray screen, and when I open up the debugger there is nothing in the $FFFA-FFFF (UNDEFINED).  Does that mean the RESET: code didn&apos;t run, or does it mean that the RESET label was never added to FFFC-FFFD in the first place?
<br>
<br>4) How do bank numbers work with MMC3?  Is there some sort of internal counter that increments every time I use a .base $8000 or .base $A000 (.base in place of .bank, since I&apos;m using asm6)?  I&apos;m trying to learn how the program understands my write to $8001 to do the bank switch, especially when I don&apos;t have statements such as &quot;.bank 2.&quot;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__5">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Feb 18, 2010 at 10:50:18 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>rizz</b></i><br><br>I&apos;m trying to write code for the MMC3 mapper, and somewhere I&apos;m getting it wrong.  Do any of these stand out:
<br>1) I&apos;m using asm6 and inside the header I&apos;m telling it 8 PRG banks, with %01000011 as control byte 1
<br>
<br>2) My code for setting up the banks is basically:
<br>.base $8000
<br>.include &quot;firstbank8000.asm&quot;
<br>.pad $A000
<br>
<br>.base $8000
<br>.include &quot;secondbank8000.asm&quot;
<br>.pad $A000
<br>etc.
<br>
<br>at the end, I have
<br>.base $E000
<br>;code for interrupt vectors
<br>.pad $FFFA
<br>
<br>.dw NMI
<br>.dw RESET
<br>.dw 0
<br>
<br>.incbin &quot;graphics.chr&quot;
<br>
<br>3) Something I noticed - when I assemble and run the .nes file, I&apos;ll get a gray screen, and when I open up the debugger there is nothing in the $FFFA-FFFF (UNDEFINED).  Does that mean the RESET: code didn&apos;t run, or does it mean that the RESET label was never added to FFFC-FFFD in the first place?
<br>
<br>4) How do bank numbers work with MMC3?  Is there some sort of internal counter that increments every time I use a .base $8000 or .base $A000 (.base in place of .bank, since I&apos;m using asm6)?  I&apos;m trying to learn how the program understands my write to $8001 to do the bank switch, especially when I don&apos;t have statements such as &quot;.bank 2.&quot;</div><br>If FFFA-FFFF is undefined, it means that the reset label was never added to FFFC-FFFD in the first place.<br><br>What exactly do you mean by &quot;control byte 1&quot;?&#xA0; MMC3 let&apos;s you choose between having $8000-9FFF swappable or $C000-DFFF swappable.&#xA0; Your code is written like $8000-9FFF is the swappable address space.&#xA0; Could it be that your value for &quot;control byte 1&quot; is selecting the other mode ($C000-DFFF swappable)?&#xA0; See the <a href="http://wiki.nesdev.com/w/index.php/MMC3" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/MMC3">nesdev wiki article on MMC3</a>.<br><br>Can you zip up your asm files and attach it?&#xA0; It would be easier to help if I could tinker with the source and see if I could get it working.<br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__6">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				Feb 18, 2010 at 11:17:38 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>rizz</b></i><br><br>1) I&apos;m using asm6 and inside the header I&apos;m telling it 8 PRG banks, &#xA0;<br>
<br>2) My code for setting up the banks is basically:&#xA0;</div><br>If your header says you have 8 PRG banks (128KB) but your code only sets up 1.5 banks (24KB) then the emulator probably can&apos;t load it correctly.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__7">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Feb 18, 2010 at 3:34:37 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					^^^ I can attest to this being a problem.  Mine worked in FCEU but not in Nestopia when I didn&apos;t have enough banks in my assmebly doc.
<br>
<br>Also, for those in the future who have the same problems I have.  Mirroring is handled in the LDX #%00011000.  Changing the header won&apos;t matter.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__8">
                                                        <div class="mdl-card__title"><strong>rizz</strong> posted on 
		
			
				
				Feb 18, 2010 at 5:45:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thank you guys.  When I mentioned control byte 1, I was referring to the 7th byte of the iNES header (where you have to tell it the low 4 bits of the mapper number).
<br>
<br>The good news is that the code is now working (I am doing a joint project with another guy, and he saw where the error was).  The spot where the bank switch was occuring needed to be set a little earlier in the code.
<br>
<br>Also, the MMC3 uses 8KB banks, but the iNES header needs to know 16KB banks?  So, if you have (6) 8KB banks of code, you have to tell the the header &quot;3&quot; banks?
<br>
<br>Did you guys have an answer to my question #4 by chance?  I&apos;d love to get an explanation on that.
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__9">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 13, 2010 at 2:13:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Why were the posts by deleteme removed?  They were finally formatted well and brought up very valid points that nobody else would.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__10">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 14, 2010 at 8:33:24 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Why don&apos;t you PM me a list of said points and we&apos;ll see what we can do to fix them.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__11">
                                                        <div class="mdl-card__title"><strong>jonebone</strong> posted on 
		
			
				
				May 14, 2010 at 12:02:46 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br>Why were the posts by deleteme removed?  They were finally formatted well and brought up very valid points that nobody else would.</div><br>Someone took the literal interpretation of his username?<br><br>Ba-dum-pshhhh<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__12">
                                                        <div class="mdl-card__title"><strong>deleteme</strong> posted on 
		
			
				
				May 14, 2010 at 3:00:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					How about you actually read posts before abusing your Mod Squad powers to delete them?  Well formed criticism just gets erased like nothing happened, yet I was the one that people attacked.  How sad is that?  I hope BunnyBoy agrees with me or even has a chance to read this before it gets deleted again.
<br>
<br>Incomplete and buggy tutorials should not have the Nerdy Nights name attached, especially without ever asking permission.  Is it that hard to come up with your own name instead of piggy backing off others?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__13">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 14, 2010 at 7:54:28 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I wouldn&apos;t necessarily say he was &quot;piggy backing.&quot;  He just wrote up a helpful guide for me that had to do with background compression.  Its focus being NES programming, it makes sense to me to just use the same name that other NES programming tutorials were using.
<br>
<br>There was no intent to do nothing but help promote the NES dev scene by doing these posts.  He started the post with a disclaimer to let people know that it wasn&apos;t promised to be 100% accurate.  I don&apos;t see anything wrong with that.
<br>
<br>If you are programming your own game and used his tutorials here and they somehow messed up what you were doing I could understand the hostility here, but I don&apos;t see any harm with his coming in here trying to write a guide for someone less informed (me) to use.
<br>
<br>He just used the Nerdy Nights name because that&apos;s what people have been calling their NES dev turorials.  Did Metal Slime ask permission to use the NN name when he did his music tutorials?  I don&apos;t know this answer, but I don&apos;t see people hounding him about stuff.
<br>
<br>Relax.  This was all done with the sole purpose to help others.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__14">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 15, 2010 at 2:42:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yes, MetalSlime did ask and was given permission.  He also sent me his first few tutorials so I could read and edit them.  Changes were made to make his stuff match the series and make them more complete.  He also really understands the entire audio system instead of still being a a self described noob.
<br>
<br>The problem is these tutorials are buggy and incomplete.  As deleteme said before it was erased, things like &quot;Not sure what these do&quot; should never be in a tutorial.  Previously I let things like that go because any tutorials are helpful.
<br>
<br>But now since there has been no notice that all the deletion even happened, no explanation for removing valid content, and no apology to deleteme I am now requesting that nobody use the Nerdy Nights name without contacting me and having complete tutorials.  This isn&apos;t to stop anything from being posted, just use your own name instead.  Of course I can&apos;t actually enforce this and likely won&apos;t bother trying.  To clear up the gaps in this specific tutorial another one will be posted.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__15">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				May 15, 2010 at 3:12:13 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					SNAP! That man needs another icon *suggestion* <img src border="0" style="display: none;" original-src="/media/_images/expressions/teabag.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__16">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 15, 2010 at 6:41:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Fixed!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__17">
                                                        <div class="mdl-card__title"><strong>deleteme</strong> posted on 
		
			
				
				May 15, 2010 at 7:49:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Wow all that to avoid an simple apology, and yet still the tutorial has problems!  
<br>A: INES header mirror info is wrong
<br>B:  nothing about batt ram
<br>C: still doesnt explain about the reset
<br>D: wrong caps on kb
<br>e: misspelled words
<br>F: doesnt explain bits7,6,5
<br>G: etc etc etc
<br>why miss the chance to make it better?  At least BunnyBoy fixes his shit when an error is found...
<br>
<br>&quot;Someone will help me out if there are any mistakes.&quot; and when help came it was deleted.  Will you take the help now?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__18">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 15, 2010 at 8:12:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><p><i>Originally posted by: <b>deleteme</b></i><br><br>Wow all that to avoid an simple apology, and yet still the tutorial has problems! </p><p>-Sorry to bunnyboy for using &quot;his&quot; name.&#xA0; I assumed it was an NA name.&#xA0; he should have said something.<br>A: INES header mirror info is wrong </p><p>-&#xA0;Not wrong.&#xA0; Using 4 screen mirroring.&#xA0; Besides, the mapper controls it anyway.<br>B: nothing about batt ram </p><p>-Not using it, so ignored it.<br>C: still doesnt explain about the reset </p><p>-This is explained enough to make it work just fine.<br>D: wrong caps on kb </p><p>-So what?<br>e: misspelled words </p><p>-So what?<br>F: doesnt explain bits7,6,5 </p><p>-tell me what they do and I&apos;ll add them.<br>G: etc etc etc </p><p>-<img src border="0" style="display: none;" original-src="/media/_images/expressions/teabag.gif" show-src="images/blank.gif"> <img src border="0" style="display: none;" original-src="/media/_images/expressions/teabag.gif" show-src="images/blank.gif"> <img src border="0" style="display: none;" original-src="/media/_images/expressions/teabag.gif" show-src="images/blank.gif"><br>why miss the chance to make it better? At least BunnyBoy fixes his shit when an error is found... <br><br>&quot;Someone will help me out if there are any mistakes.&quot; and when help came it was deleted. Will you take the help now?</p></div><br><br>My point was to give someone the code to make a working program with a working understanding.&#xA0; Not to explain exactly what everything did and why.&#xA0; That&apos;s why I referenced NesDev wiki.&#xA0; <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__19">
                                                        <div class="mdl-card__title"><strong>albailey</strong> posted on 
		
			
				
				May 15, 2010 at 8:36:36 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br><div class="FTQUOTE"><p><i>Originally posted by: <b>deleteme</b></i><br><br>Wow all that to avoid an simple apology, and yet still the tutorial has problems! </p><p>-Sorry to bunnyboy for using &quot;his&quot; name.&#xA0; I assumed it was an NA name.&#xA0; he should have said something.<br>A: INES header mirror info is wrong </p><p>-&#xA0;Not wrong.&#xA0; Using 4 screen mirroring.&#xA0; Besides, the mapper controls it anyway.<br>B: nothing about batt ram </p><p>-Not using it, so ignored it.<br>C: still doesnt explain about the reset </p><p>-This is explained enough to make it work just fine.<br>D: wrong caps on kb </p><p>-So what?<br>e: misspelled words </p><p>-So what?<br>F: doesnt explain bits7,6,5 </p><p>-tell me what they do and I&apos;ll add them.<br>G: etc etc etc </p><p>-<img src border="0" style="display: none;" original-src="/media/_images/expressions/teabag.gif" show-src="images/blank.gif"> <img src border="0" style="display: none;" original-src="/media/_images/expressions/teabag.gif" show-src="images/blank.gif"> <img src border="0" style="display: none;" original-src="/media/_images/expressions/teabag.gif" show-src="images/blank.gif"><br>why miss the chance to make it better? At least BunnyBoy fixes his shit when an error is found... <br><br>&quot;Someone will help me out if there are any mistakes.&quot; and when help came it was deleted. Will you take the help now?</p></div><br><br>My point was to give someone the code to make a working program with a working understanding.&#xA0; Not to explain exactly what everything did and why.&#xA0; That&apos;s why I referenced NesDev wiki.&#xA0; <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"><br></div><div><br></div>I like helping people too. &#xA0; &#xA0;I think the person may have just been in a bad mood.<br><br>You should change the caps on kb. &#xA0; It actually <u>is</u> important. &#xA0; The k doesn&apos;t matter. &#xA0;The b does.
<div>256 kb = 32 kB</div><div>b = bit</div><div>B = byte</div><div><br></div><div>Bit 7 is important. &#xA0;&#xA0;<a href="http://wiki.nesdev.com/w/index.php/MMC1" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/MMC1">http://wiki.nesdev.com/w/index.php/MMC1</a></div><div>From that page, a value of 1 =&#xA0;<span class="Apple-style-span" style="font-family: monospace; font-size: 13px; line-height: 14px; white-space: pre; ">locking PRG ROM at $C000-$FFFF to the last bank.</span></div><div><span class="Apple-style-span" style="font-family: monospace; font-size: 13px; line-height: 14px; white-space: pre; "><br></span></div><div>The nesdevwiki doesnt have any info about bits 6 and 5 either, so I would assume they are unimportant.</div><div><br></div><div>I also assume that battery backed ram requires no additional coding. &#xA0; I always thought the battery keeps the data from going away, the same as a battery on a motherboard keeps the BIOS settings from being wiped on a power down. &#xA0;</div><div><br></div><div>- Edited to fix a bug in my response.</div><div><br></div><div>Al</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__20">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 15, 2010 at 10:09:15 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thanks for the help Al.  I changed the kB, I think I got all of them.
<br>
<br>But on the bits, I think that our friend here meant bits 7, 6, and 5 of the &quot;Control&quot; not the &quot;Load Register&quot; (as nesdev wiki puts it).  But I will add that part about the load register that you pointed out.  Thanks!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__21">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 15, 2010 at 10:15:06 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I would expect the apology to be for deleting all his posts, as they were far more detailed and helpful to corrections than the subsequent ones.  My bad mood is because that info was erased instead of actually read to make everything better.  Corrected tutorials lead to better programmers, while bad information lasts forever (see buggy GBAGuy tutorials).  I care about the quality of the materials linked to the name, not who generates it.
<br>
<br>iNES header - mirroring is completely ignored, so saying it should match isn&apos;t quite right.  Not sure its &quot;wrong&quot;, but that could (and has) caused people problems.  Claiming you are using four screen mirroring actually is wrong.  Your .inesmir would have to be 8 for the four screen bit to be set.
<br>
<br>Misspelled words are very important for anyone who does not have english as their first language.  Bite and byte are two completely different things, just like KB and Kb.  As groups like playpower.org introduce more second and third world users to the NES through cheap clones the wordings in tutorials will become more significant.  Of course &quot;so what&quot; is a valid excuse if this is only meant for a couple people  <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
<br>
<br>Bit 7 is the reset.  This is very important, like reading $2002 to reset the hi/lo latch.  It also changes registers to default settings, which could change your PRG banking layout immediately.  If your initMMC1Mapper code is in a bank other than the last 16KB it could be swapped away, crashing your code.
<br>
<br>Bits 6 and 5 do not exist, because it is only a 5 bit shift register inside the mapper.
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__22">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				May 15, 2010 at 10:32:26 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br>I would expect the apology to be for deleting all his posts</div><br>Am I in minority for thinking he shouldn&apos;t have to apologize? Was there any need for all the negativity right from the beginning?  Since deleteme started posting in this thread, his post count has doubled.  I wouldn&apos;t call that a positive contribution to the community.  It would have been quite possible for deleteme to criticize without being an ass about it.  I can understand why you would be a little peeved, since the Nerdy Nights are &quot;your baby&quot;.<br><br>Regardless, it is still helpful, thanks MRN for this info and Bunny for all the help you guys give to us meager homebrewers.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__23">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 15, 2010 at 10:46:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Except the posts that were erased had all the errors/issues listed above and more corrections needed.  Unfortunately not everyone saw them and only the unhelpful angry and painfully formatted posts were kept, I assume to make him look bad.  The posts by MRN challenging him in the other thread were also deleted.  Where is that undelete post button to show all that?  <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__24">
                                                        <div class="mdl-card__title"><strong>Roth</strong> posted on 
		
			
				
				May 16, 2010 at 1:12:00 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, if we can split the posts off, I&apos;d like to talk about that. I think deleteme brought up good points, but was a dick about it to start with. I read his posts and thought, &quot;damn... dickish!,&quot; but bunny brings up great points about it. Either someone starting a new topic, or splitting the last couple of posts here would be great. I think discussion about how info is presented about development would benefit all of us.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__25">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				May 16, 2010 at 1:43:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br>Except the posts that were erased had all the errors/issues listed above and more corrections needed.  Unfortunately not everyone saw them and only the unhelpful angry and painfully formatted posts were kept, I assume to make him look bad.  The posts by MRN challenging him in the other thread were also deleted.  Where is that undelete post button to show all that?  <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"></div><br>Ok, I only saw the first few when he was being &quot;dickish&quot;.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__26">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 16, 2010 at 11:58:54 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					First, I appoligize to the community as a whole for &quot;deleting shit&quot;.  I have received more than one tounge lashing over it, so if it&apos;s all the same to everyone, I consider the matter closed.
<br>
<br>My problem was not with the criticizm, but with how it was presented.  It goes back to what my mommy tells me, &quot;If you are an ass to someone, expect an asshole in return.&quot;  Constructive criticism is very different than implying that someone doesn&apos;t know what they are doing.  Making posts that will quite obviously start a flame war = bad.  
<br>
<br>If someone feels like editing my little write up and PMing or emailing it back to me, I&apos;d be happy to fix it.  However, I don&apos;t want to sort through this mess to find what is actually helpful.  
<br>
<br>Bunnyboy, in the future, if you have a problem with something that I am doing, I would hope that it won&apos;t take 6 months and an epic flame war for you to let me know what&apos;s up.  I consider us friends and hope that we can get past this.  You have my email addy, my AIM info, and you could even PM me...I won&apos;t tell.  <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">  I removed my smart ass title to my threads and would be honered if you would help me to fix the problems in this one, the other one, and any future ones that I might post.  If it&apos;s okay with you, I will add a reference to your thread on MMC1 in this write up somewhere.  I feel that we both present the material from different view points that could help a potential user understand the process.  If you would like to expand/repair whatever issues you see in my compression thread, that&apos;d be cool.  Or if you&apos;d like to write your own, that would be okay as well.  
<br>
<br>I&apos;d like to remain buds so that I can bug you when I have an issue as I value you as a resource and as a friend.
<br>
<br>Peace.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__27">
                                                        <div class="mdl-card__title"><strong>typicalanimal</strong> posted on 
		
			
				
				Oct 15, 2012 at 12:27:29 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Could someone please repost the example, or post another example with MMC1 bank-switching working?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__28">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Oct 15, 2012 at 12:34:23 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					What more do you need really? The info is all there, what do you need extra to understand it?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__29">
                                                        <div class="mdl-card__title"><strong>typicalanimal</strong> posted on 
		
			
				
				Oct 15, 2012 at 12:51:01 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	What more do you need really? The info is all there, what do you need extra to understand it?</div>
<br>
I need an example of it. I can&apos;t get it to work. I&apos;d be really appreciative of any example of it even if it&apos;s from a full game. I&apos;ll work it out somehow even if I have to forcibly copy my game and build it around the bank-switching. I&apos;ve spent hours reading and trying to figure it out and yet still seeing grey screens coming up every time I try to increase the inesprg...&#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__30">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Oct 15, 2012 at 7:34:16 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Well you have to remember the last bank in the ROM is fixed somewhere, either lower or top 16KB. You need to put all the bankswitching code, NMI, etc. there. Could you post your source possibly? I&apos;ll fix it up so it works and show you what&apos;s wrong with it.<br>
<br>
ETA: More detailed programming MMC1 info:<br>
<br>
You need to have a mini boot routine (16 bytes is what you should shoot for. I have a 15 byte routine that returns the bank boot I am going to add below) that resets the mapper by writing &gt;=128 to &gt;=$8000. That will force all MMC1 chips to make the last 16KB be in the $C000 range to execute from, so you can just JMP [$FFFC] to the reset routine in the main bank to make sure it boots correctly. You CAN make the lower $8000 page be executed from, but that&apos;s not used or very very useful because when an NMI,IRQ, or RESET occur, the 6502 looks for them at locations $FFFA-$FFFF, so you NEED to have those there all the time. I hope that makes sense. But some MMC1&apos;s boot with the 16KB fixed at $C000 first, but ones like the original MMC1 are random and not reliable to assume that.&#xA0;On MMC1B2 I know the boot isn&apos;t random like the MMC1 no revision, MMC1B2 boots in the 16KB in the $C000 range. But to make sure it really works on all MMC1&apos;s and emus, make sure you have a little reset routine at the end of each 16KB bank.<br>
<br>
(Code is for NESASM3, you really should make this a macro to use it.)<br>
<br>
<div>
	<span style="font-family:courier new,courier,monospace;">&#xA0; .org $FFF0</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&#xA0; .db $00</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">MMC1GlitchBoot:</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&#xA0; SEI</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&#xA0; LDA #$80+(BANK(MMC1GlitchBoot)/2)</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">RTIBank:</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&#xA0; STA $8040</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&#xA0; JMP [$FFFC]</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&#xA0; .dw RTIBank+1 ;NMI</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&#xA0; .dw MMC1GlitchBoot ;Reset</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&#xA0; .dw RTIBank+1 ;IRQ</span><br>
	<br>
	Code Comments:<br>
	I dunno WHY an IRQ would fire, but just in case I store to $8040 to reset the MMC1, but the $40 is used to also be the instruction for an RTI, so nothing bad will happen if an IRQ happens during reset.<br>
	<br>
	On the LDA, I used that to determine what bank it booted in. It&apos;s not needed, just an extra feature.<br>
	<br>
	Any Q&apos;s and you can ask. If you use this code....just use it.</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__31">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				Oct 15, 2012 at 10:19:17 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Here you are. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__32">
                                                        <div class="mdl-card__title"><strong>typicalanimal</strong> posted on 
		
			
				
				Oct 15, 2012 at 3:04:40 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>3GenGames</b></i><br>
	<br>
	Well you have to remember the last bank in the ROM is fixed somewhere, either lower or top 16KB. You need to put all the bankswitching code, NMI, etc. there. Could you post your source possibly? I&apos;ll fix it up so it works and show you what&apos;s wrong with it.<br>
	<br>
	ETA: More detailed programming MMC1 info:<br>
	<br>
	You need to have a mini boot routine (16 bytes is what you should shoot for. I have a 15 byte routine that returns the bank boot I am going to add below) that resets the mapper by writing &gt;=128 to &gt;=$8000. That will force all MMC1 chips to make the last 16KB be in the $C000 range to execute from, so you can just JMP [$FFFC] to the reset routine in the main bank to make sure it boots correctly. You CAN make the lower $8000 page be executed from, but that&apos;s not used or very very useful because when an NMI,IRQ, or RESET occur, the 6502 looks for them at locations $FFFA-$FFFF, so you NEED to have those there all the time. I hope that makes sense. But some MMC1&apos;s boot with the 16KB fixed at $C000 first, but ones like the original MMC1 are random and not reliable to assume that.&#xA0;On MMC1B2 I know the boot isn&apos;t random like the MMC1 no revision, MMC1B2 boots in the 16KB in the $C000 range. But to make sure it really works on all MMC1&apos;s and emus, make sure you have a little reset routine at the end of each 16KB bank.<br>
	<br>
	(Code is for NESASM3, you really should make this a macro to use it.)<br>
	<br>
	<div>
		<span style="font-family:courier new,courier,monospace;">&#xA0; .org $FFF0</span></div>
	<div>
		<span style="font-family:courier new,courier,monospace;">&#xA0; .db $00</span></div>
	<div>
		<span style="font-family:courier new,courier,monospace;">MMC1GlitchBoot:</span></div>
	<div>
		<span style="font-family:courier new,courier,monospace;">&#xA0; SEI</span></div>
	<div>
		<span style="font-family:courier new,courier,monospace;">&#xA0; LDA #$80+(BANK(MMC1GlitchBoot)/2)</span></div>
	<div>
		<span style="font-family:courier new,courier,monospace;">RTIBank14:</span></div>
	<div>
		<span style="font-family:courier new,courier,monospace;">&#xA0; STA $8040</span></div>
	<div>
		<span style="font-family:courier new,courier,monospace;">&#xA0; JMP [$FFFC]</span></div>
	<div>
		<span style="font-family:courier new,courier,monospace;">&#xA0; .dw RTIBank+1 ;NMI</span></div>
	<div>
		<span style="font-family:courier new,courier,monospace;">&#xA0; .dw MMC1GlitchBoot ;Reset</span></div>
	<div>
		<span style="font-family:courier new,courier,monospace;">&#xA0; .dw RTIBank+1 ;IRQ</span><br>
		<br>
		Code Comments:<br>
		I dunno WHY an IRQ would fire, but just in case I store to $8040 to reset the MMC1, but the $40 is used to also be the instruction for an RTI, so nothing bad will happen if an IRQ happens during reset.<br>
		<br>
		On the LDA, I used that to determine what bank it booted in. It&apos;s not needed, just an extra feature.<br>
		<br>
		Any Q&apos;s and you can ask. If you use this code....just use it.</div>
</div>
<br>
<div class="FTQUOTE" style="width: 529.5833129882813px; ">
	<i>Originally posted by:&#xA0;<b>KHAN Games</b></i><br>
	<br>
	Here you are.</div>
<br>
<br>
Awesome. Thanks for the help, I finally got it working. &#xA0;<span class="sprites_emoticons absmiddle" id="emo_cool"></span> &#xA0;<span class="sprites_emoticons absmiddle" id="emo_smile"></span> &#xA0;<br>
<br>
I think where I was going wrong was that you have to put in exactly double the amount of banks that it says in the inesheader, even if the banks are blank you still have to &quot;declare&quot; them and to number them all in order. I thought that they were just &quot;declaring&quot; them in the examples for clarity. As well, for this mapper I had to specify the chr even though I&apos;m just using one. &#xA0;<br>
&#xA0;&#xA0;<br>
It&apos;s the one nerdynights tutorial that I didn&apos;t find completely clear (though I haven&apos;t looked at the sound ones). I&apos;m sure this will sound stupid now, but you know how he says you have to divide the bank numbers by two for the NESASM number? I thought he meant divide the address... so I was using half of $E000 and half of $C000 and trying tons of variations, and then I thought the mirroring might be damaging it etc.&#xA0;<br>
&#xA0; &#xA0; &#xA0;
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-3__33">
                                                        <div class="mdl-card__title"><strong>removed04092017</strong> posted on 
		
			
				
				Oct 15, 2012 at 3:52:12 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					The reason you have to divide it by 2 is that the NES header uses 16KB banks while NESASM3 assembles with 8KB banks.
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="misc-4">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">World Building with SGP: Introductions</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <h6 class="cardSubtitle">Written by Sole Goose Productions</h6>

                        
					<u>Introduction to the Series</u><br>
&#xA0;<br>
Welcome to World Building with SGP! What follows is a series of reflections that have spawned from my own experiences attempting to learn NES programming. I am not an expert when it comes to writing code, drawing graphics, composing sound, or designing levels, but hopefully these thoughts will be of use to someone. I plan to add to these reflections as I attempt new aspects of game development, and earlier lessons will be refined as my knowledge and experience grow. These are very much an extension of what I have learned here on NA and through reading various articles on NESDEV and elsewhere, and a cumulative bibliography will be added at some point. Please comment, critique (constructively one hopes), and discuss things as you see fit. This initial post will serve as a table of contents of sorts, and each chapter will have its own thread. Keep a lookout for an alternative form of presentation in the future too. Also, please note that they are written mainly with an eye toward creating overhead adventure games. As I attempt other game play perspectives, thoughts on these will be incorporated.<br>
&#xA0;<br>
These lessons, articles, what have you are intended for different types of people. On the one hand, they are for programmers setting out on the long journey that is NES development. Perhaps more importantly, though, my hope is that they reach people within our community who do not really have an interest in programming, but who would like to be involved with game development at one&#xA0;level or another. We have already witnessed what can happen when highly talented people collaborate (several <em>8-Bit Christmas</em> games, the <em>Battle Kids</em>, MRN&#x2019;s various games, <em>T-Gun</em>, <em>Nomolos </em>and<em> Owlia</em>, and many others), though most contributions have been more musically inclined. Eventually, I hope to discuss music, but the first set of lessons will primarily&#xA0;deal with art.&#xA0;For most programmers, well, many at least, graphics are a huge time sink. We can usually get decent results with enough patience, but that is valuable time lost that could be spent actually completing games. My current main character, for example, has already taken somewhere between twenty and thirty hours to draw, and there are still several poses to go. Hopefully these initial&#xA0;discussions will help a few to take up the challenge of learning how to draw within the structures of the NES.<br>
&#xA0;<br>
One last thing. About every month or so, we see someone pop into the Brewery with a suggestion for a game, or asking how to convert &#x201C;X&#x201D; game to the NES. We are familiar with the results of these, and the various arguments that are exchanged on either side. One of the most important points that is brought up, in my own opinion anyways, is that those taking the time to learn how to actually program already have plenty of ideas, and are not likely to take up someone else&#x2019;s project. There is certainly truth in it, and even with detailed write ups at the design level, few are going to actually do someone else&#x2019;s work for them. I would think, however, that if someone really took the time to create a world at the artistic level, the response would be much warmer. Mind you, it would take hundreds of hours to do so, which would also help to prove&#xA0;one&apos;s seriousness and commitment. Still, if seeking collaboration, this might be a way to go. Draw some things, show us what you can do, and then hopefully mutual collaboration can ensue. Just a thought though, and I can only speak for myself in this regard.<br>
&#xA0;<br>
&#xA0;<br>
&#xA0;
<div>
	<u>Table of Contents</u>:</div>
&#xA0;<br>
Chapter 1: Foundations <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=137055" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=137055">http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;am...</a> <br>
Chapter 2: Introduction to NES Graphics Editors <a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=137056" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=137056">http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;am...</a> <br>
&#xA0;<br>
&#xA0;<br>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#misc-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;misc-4__comments&apos;);">
                            Toggle Responses
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=137051" target="_blank">
                                Original Thread
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="misc-4__comments">
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="misc-5">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">World Building with SGP 1: Foundations of NES Graphics</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <h6 class="cardSubtitle">Written by Sole Goose Productions</h6>

                        
					<u>Introduction</u><br>
&#xA0;<br>
This first lesson briefly covers the essentials of drawing graphics for the NES. Text adventures aside, graphics are the mode through which we enter most game worlds, and are understandably our starting point when discussing their construction. This chapter touches on the core fundamentals of the system, but also lightly raises many other issues that will be discussed in future chapters. It covers a lot of ground for the simple fact that a bit of awareness now can save a tremendous amount of time and headache later.<br>
&#xA0;<br>
&#xA0;<br>
&#xA0;<br>
<u>56 Shades of NES</u><br>
&#xA0;<br>
Perhaps nothing defines the NES, and people&#x2019;s perceptions and memories of its games, as much as the color palette of the system. The NES PPU (Picture Processing Unit) is capable of displaying sixty four colors, though to be fair slightly less than ten of these are black, hence the number fifty six in our colorfully named title above. The palette is as follows, but it is extremely important to note that the colors will appear differently on different means of display (CRT versus LCD, etc.).<br>
<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/97D2D529-EEDF-E455-EA0911631DA9A9A8.png" show-src="scraper/images/97D2D529-EEDF-E455-EA0911631DA9A9A8.png"><br>
(Taken from somewhere, I forget where exactly)<br>
&#xA0;<br>
The numbers that are on the colors are the actual hexadecimal values that are used when inputting them into a program in assembly language. In order to see the visual differences between the colors, it is best to try them out, either on an emulator or actual hardware. Colors can be adjusted in terms of intensity as well, but any changes of this nature will affect all colors that appear on a screen. Fifty six colors, it does not seem like a lot but it would let us create characters and backgrounds on par with early SNES games; however, now the real limitations of the NES need to be described.<br>
&#xA0;<br>
&#xA0;<br>
&#xA0;<br>
<u>Palettes</u><br>
&#xA0;<br>
While the NES is capable of displaying fifty six more or less unique colors, only a small number of these can be simultaneously displayed on the screen at once. There are two <strong>types of palettes</strong> that the NES uses on screen at the same time: one for backgrounds and one for sprites. They both partake of the same fifty six colors, but the restrictions for the two types are different. A sample set of palettes that would be used for a screen, using the values given above, is as follows:<br>
&#xA0;<br>
Background Palettes:<br>
&#xA0; .db $22,$29,$1A,$0F,&#xA0; &#xA0;&#xA0;$22,$36,$17,$0F, &#xA0;&#xA0;&#xA0;$22,$30,$21,$0F, &#xA0;&#xA0;&#xA0;$22,$27,$17,$0F<br>
&#xA0;<br>
Sprite Palettes:<br>
&#xA0; .db $22,$1C,$15,$14,&#xA0; &#xA0;&#xA0;$22,$02,$38,$3C, &#xA0;&#xA0;&#xA0;$22,$1C,$15,$14, &#xA0;&#xA0;&#xA0;$22,$02,$38,$3C<br>
&#xA0;<br>
&#xA0;<br>
For clarity&#x2019;s sake, this could also be written as:<br>
&#xA0;<br>
&#xA0;<br>
Background Palettes:<br>
&#xA0; .db $22,$29,$1A,$0F&#xA0;&#xA0;&#xA0; ; Background Palette 1<br>
&#xA0; .db $22,$36,$17,$0F&#xA0;&#xA0;&#xA0;&#xA0; ; Background Palette 2<br>
&#xA0; .db $22,$30,$21,$0F&#xA0;&#xA0;&#xA0;&#xA0; ; Background Palette 3<br>
&#xA0; .db $22,$27,$17,$0F&#xA0;&#xA0;&#xA0;&#xA0; ; Background Palette 4<br>
&#xA0;<br>
Sprite Palettes:<br>
&#xA0; .db $22,$1C,$15,$14&#xA0;&#xA0;&#xA0;&#xA0; ; Sprite Palette 1<br>
&#xA0; .db $22,$02,$38,$3C&#xA0;&#xA0;&#xA0;&#xA0; ; Sprite Palette 2<br>
&#xA0; .db $22,$1C,$15,$14&#xA0;&#xA0;&#xA0;&#xA0; ; Sprite Palette 3<br>
&#xA0; .db $22,$02,$38,$3C&#xA0;&#xA0;&#xA0;&#xA0; ; Sprite Palette 4<br>
&#xA0;<br>
First and foremost, notice that each palette set consists not of sixteen colors, but four groups of four colors. We will come back to this in a moment, but these are the <strong>individual palettes</strong> that we will use when drawing. Also, if you look closely you will see that $22 (sky blue) appears in each group of four throughout either type of palette, though it plays a different role in each. In terms of the background, $22 functions as the <strong>universal background color</strong>, which in reality only allows for thirteen different background colors on screen at once. My own humble advice is to set the universal color to whatever color appears most frequently, which in most cases will be black (depending on one&#x2019;s style and the subject matter of course). In regards to the four sprite palettes, $22 functions as the <strong>transparent</strong> color, giving twelve choices total for the various sprites. Earlier NES games, such as <em>Super Mario Bros.</em> and <em>The Legend of Zelda</em> used all three colors for actual colors, with the result that they can often look washed-out when compared with later sprites.<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/97E033B2-F614-B252-B18FF821142A6C48.png" show-src="scraper/images/97E033B2-F614-B252-B18FF821142A6C48.png"><br>
<br>
There are a couple of solutions to this problem, one of which is to use one of the three colors as a black outline (as with Kirby), in the process reducing the amount of available colors to two. This accounts for many of the seemingly wild uses of color in NES games, some of which were continued on more technically capable machines. Does the fighter in <em>Final Fantasy</em> really have red hair? Come on. Another solution is to set game play, or at least the majority of game play, against an all black screen, thereby creating the illusion of a black outline. One homebrew project uses this to great effect:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/98F79AC0-F577-51CD-6AA753B48346DAB9.png" show-src="scraper/images/98F79AC0-F577-51CD-6AA753B48346DAB9.png"><br>
<br>
This technique was heavily used in early NES games, and while it works well for side-scrolling games, it does not work as well for overhead adventures. One of the few to attempt to do so was the unlicensed title <em>Spiritual Warfare</em>. For much of the game the player may not notice what is going on, but when walking across non-black backgrounds the absence of black in the sprite palette becomes readily apparent, particularly in regards to the hero&#x2019;s eyes:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/99148045-B37C-7C9B-753BA40FEE4FA3DA.png" show-src="scraper/images/99148045-B37C-7C9B-753BA40FEE4FA3DA.png"><br>
<br>
Perhaps it is not so much the absence of black that is noticeable, but rather trying to imitate the presence of it. Characters without black outlines can hold their own, but factors such as backgrounds and perspective need to factor into the decision whether to eschew it or not. Eyes are always a dead give away.<br>
&#xA0;<br>
Now, as you think back to every NES game that you have ever played and try to verify if all of this is true or not, you may recall that certain games did in fact use more colors per character, with Mega Man being the prime example. Well, it is probably time to talk about the size of sprites versus the size of characters, as well as how to get around some of the limitations inherent to the NES.<br>
&#xA0;<br>
&#xA0;<br>
&#xA0;<br>
<u>Screen Resolution/Pixel Depth and the Real Limits of NES Graphics</u><br>
&#xA0;<br>
Backgrounds and sprites are composed of tiles, each of which consists of 8x8 pixels. We will first deal with backgrounds, and then move on to discuss sprites.<br>
&#xA0;<br>
&#xA0;<br>
<u>Backgrounds</u>:<br>
&#xA0;<br>
Scenery and objects are generally made up of several tiles, and are often grouped in twos (i.e. 16x16 pixels, or 2x2 tiles). These groups we will refer to as <strong>metatiles</strong>, although I have also seen the word <strong>megatile</strong> be used in its place. See, for instance, the following from <em>Super Mario Bros.</em>:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/99168686-C625-B2D6-F21E5E66F1EA3264.png" show-src="scraper/images/99168686-C625-B2D6-F21E5E66F1EA3264.png"><br>
<br>
Taken together these four tiles form the famous question mark block. Generally, it is a good idea to work at the metatile level, for the unfortunate reason that further graphical limitations are imposed by what are known as <strong>attributes</strong>. Remember the four background palette groups from above? Well, each 16x16 pixel area (or 2x2 tile group) can only use one of these palettes. This is extremely important, and further complicated by the fact that the first row of tiles (eight, pixel high scan lines) that the NES outputs cannot actually be see on an NTSC television (on a European PAL television it is visible). Compare, for instance, an NTSC versus a PAL screen of <em>The Legend of Zelda</em>.<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/97F6513A-AF77-C559-E2B9D0EBBB32E7F8.png" show-src="scraper/images/97F6513A-AF77-C559-E2B9D0EBBB32E7F8.png"><br>
<br>
They are the exact same screen, only the NTSC format does not allow us to see it in its entirety. Why would this complicate matters? Basically, because for those of us not programming for a PAL system it causes the groups of tiles to be off, since all background tiles are <strong>aligned to a grid</strong>. Want to make a symmetrical room? Too bad, unless you want to waste several lines of the playing field trying to re-align everything, which is in fact what many games do. That, or they appear to cut tiles off in the middle, despite the fact that they are in reality present. <em>Zelda</em> uses good examples of both of these methods. First, here is a sample background that shows where the attribute groups are located on an NTSC screen:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/9805A744-02CC-F4E2-3E71FE2AC159155A.png" show-src="scraper/images/9805A744-02CC-F4E2-3E71FE2AC159155A.png"><br>
<br>
See how the top and bottom rows are incomplete? Since each of the squares is a metatile in size, if you wanted to make a wall that ran along the top of the screen, it would either need to be three tiles high (one and a half metatiles), or if it was only one metatile high whatever was beneath it would need to partake of the same three colors. Take a look at the following close up of a poorly drawn sample screen. The drawing is entirely determined by where the attribute tables fall:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/9811C885-E1E0-9EAF-7EEC0CBCDDCABE68.png" show-src="scraper/images/9811C885-E1E0-9EAF-7EEC0CBCDDCABE68.png"><br>
<br>
If you notice, I have taken into account some issues and neglected others. For instance, if done correctly, the curb need not be green, which it must in the example since the brick wall shares the same palette as the garage door (see the top left corner of the garage). Had the brick wall been an even number of tiles tall, instead of the five that it currently is, the curb could draw from a different palette. Additionally, if we look at the overhang of the roof it is apparent that the roof and the road will have to partake of the same palette. This is why it can be useful, especially when learning, to draw things in terms of metatiles.<br>
&#xA0;<br>
Understandably, attributes also determine the placement of objects. Let us say that I wanted to stack boxes up against the building. To do this effectively (i.e. colorfully), the objects would only be able to be drawn in places where they would not cross attribute boundaries. Attributes not only affect the look of a game, but also determine game play itself to a great extent, since they influence where exactly objects can be placed. This is not restricted to objects, either, as can be seen in the placement of the status bar in most games. In order to make the status bar independent of the game world (although it could potentially share colors with one of the game world palettes; black in this case), it is necessary to regain an evenness to the lines created by the offset of the first row. See, for example, how <em>The Legend of Zelda</em> divides the game world:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/98192B0E-E54A-0EA3-42C8F274FDE4BD1A.png" show-src="scraper/images/98192B0E-E54A-0EA3-42C8F274FDE4BD1A.png"><br>
<br>
Each square section is one metatile (or 2x2 tile section). Notice how the height of the status bar is an uneven number of tiles, but how this serves to re-align the game world.<br>
&#xA0;<br>
Not to belabor the point, but attributes will be the sticking point for most people when it comes to background graphics. Here is one last example of a room drawn by someone who did not take into account attributes. It is a nice symmetrical room, but can you guess what is wrong with it?<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/97AAD4C8-A217-9DD3-81949CD1F5AEC737.png" show-src="scraper/images/97AAD4C8-A217-9DD3-81949CD1F5AEC737.png"><br>
<br>
If we were to change the program&#x2019;s code so that every other attribute section was different, this is what we would see (pardon the garish color choices):<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/97AD579B-B949-8AEB-D1B5B2BE4AE477BE.png" show-src="scraper/images/97AD579B-B949-8AEB-D1B5B2BE4AE477BE.png"><br>
<br>
Two issues can be noticed, possibly more. One is that the walls will have to use the same palette/colors as the floor, since both the top and bottom walls share an attribute area with the floor. Notice, this does not affect the side walls, other than the top and bottom entrances, in the same fashion. The other issue is that the status bar appears in the middle of an attribute area. A further point: even though the top and bottom walls do not line up, the middle passages do (at least on the sides). Shifting everything up or down one row will cause these to be off, hence the importance of minding one&#x2019;s attributes.<br>
&#xA0;<br>
Here is the same room, but showing it in full PAL resolution. This is the &#x201C;real&#x201D; room, though unlike in <em>Zelda</em> the extra row has not been utilized. In many cases programmers simply threw in a row of black tiles at the top and at the bottom of the screen (as has been done here).<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/98257338-C61B-CAE3-150CB5ABBDAAC86C.png" show-src="scraper/images/98257338-C61B-CAE3-150CB5ABBDAAC86C.png"><br>
<br>
Attribute tables are rightly known as about the hardest things to deal with, since they must constantly be kept in mind.<br>
&#xA0;<br>
It should be mentioned that there is a way out of the whole attribute business all together. Toward the end of the NES&#x2019;s lifespan, Nintendo developed the MMC5 memory chip which allowed for each individual 8x8 background tile to use its own palette. However, the only way to obtain these at the moment is to rip apart one of the few games that used it and recycle its board. Not surprisingly, these games are not that common, and they also tend to be top games, making them both rarer and more expensive.<br>
&#xA0;<br>
Just to note, attributes can be incorporated at the programming level in a variety of ways within a game. Two of the most common methods are through the use of tables or by assigning attributes to metatiles on an individual basis. The former method can be found in <em>The Nerdy Nights</em> tutorials, and it is easier to implement. MRN uses the latter method, which has many advantages despite the ensuing complications that come with it. This second method is also why it is encouraged to think in terms of metatiles and not individual tiles when drawing background graphics.<br>
&#xA0;<br>
&#xA0;<br>
<u>Sprites</u>:<br>
&#xA0;<br>
In terms of sprites, things are a little easier to visually see than with the majority of background objects (question mark blocks aside). Link is clearly made up of four, 8x8 pixel tiles (or 2x2 sprite tiles). We will refer to these as <strong>metasprites</strong>, or <strong>megasprites</strong>.<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/991D4F07-C723-8F2B-1CB79D90BAD3B6E3.png" show-src="scraper/images/991D4F07-C723-8F2B-1CB79D90BAD3B6E3.png"><br>
<br>
Each of the individual tiles can only draw from one of the four sprite palettes, which are different than the background palettes. Unlike background tiles, however, each sprite tile can be different. If we wanted Link to have a pretty pink shield he could. On the other hand, if we wanted to give him a pink hat, we would be in a bit of trouble since the tips of his shoulders would also have to be pink due to each tile only being able to use three colors. This is extremely important when designing sprites, and must also be taken into account when considering character animations. If Link&#x2019;s shield were to move up into the tile above it, then it would automatically change colors depending on what palette that tile uses. An example of not taking this into consideration, or simply not caring, can be found in <em>Metal Mech</em>. As can be seen, when the hero runs his hands/gloves enter into a tile that uses a different palette and change color.<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/9831346E-AF9A-3573-AE2AD4F248DF167B.png" show-src="scraper/images/9831346E-AF9A-3573-AE2AD4F248DF167B.png"><br>
<br>
Due to the size of the character and the intensity of the game it is not all that noticeable, but it is there nonetheless.<br>
&#xA0;<br>
While sprites graphics are free from some of the constraints of background graphics, they do have their own issues. Ever notice how sprites flicker when there are too many things on the screen? Well, there is a reason for this. The NES can only display up to eight sprites per scanline (these are horizontal). Therefore, whenever there are more than eight sprites either one of two things will happen: A) only eight will display, or B) the sprites can be programmed to flicker. Most games will use the flickering method, though in others, such as <em>Grand Master</em>, enemies will simply disappear. The top half of one of the cubes has vanished (though it will still deal damage!):<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/99125737-EC85-1B55-4A00F6143F30B8A8.png" show-src="scraper/images/99125737-EC85-1B55-4A00F6143F30B8A8.png"><br>
<br>
This is one reason why tall characters (4x2 tiles) are often found in NES games, while wide characters are generally not. Do not forget that hero and enemy weapons also count toward the sprite limit. If the Fencer, in the above example from <em>Grand Master</em>, were to swing his sword, the top halves of an additional two enemies would no longer be visible.<br>
&#xA0;<br>
We will return to factors that influence sprite design in another lesson, but there is a key reason for raising scan line issues now. Characters with three colors, one of which is black, are not terribly exciting. As has been seen, some designers stuck with this limitation, but many of the more memorable characters side-stepped the issue by layering sprites over each other in order to achieve additional detail. Perhaps the most famous of these is Mega Man. The image below shows how the designers were able to really give life to the Blue Bomber with only a single additional sprite. Note, the face tile does not have to align with the edges of the other sprites, but it can sit anywhere in relation to them:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/992D671A-023F-DBA2-8A3ACE73D163B2AF.png" show-src="scraper/images/992D671A-023F-DBA2-8A3ACE73D163B2AF.png"><br>
<br>
As much as we can appreciate what is going on here, it can potentially cause scan line issues, since it adds another sprite to the player character. If we were to do all enemies in this way, only the hero and a single enemy would be able to be on the same horizontal line without problems arising (prior to weapons even!). Also, do not forget that the colors used in Mega Man&#x2019;s face will eat up another palette, leaving only two palettes for all other enemies, objects, status bar details, etc.<br>
&#xA0;<br>
While a great majority of games in the NES-era used sprites made up of 8x8 tiles, another option does exist. At the programming level sprites can be changed to be <strong>8x16</strong> in size, i.e. eight pixels wide and sixteen pixels tall. Functionally, this is like stacking two sprites on top of each other. The main benefit of using 8x16 sprites is that it allows one to place more objects on screen than if only using 8x8 sprites. The NES only allows up to sixty four sprites to be displayed at once. If we envision a screen in which all objects and characters are one metatile in size, using 8x16 sprites would essentially allow us to have <em>double</em> the number of entities. Pretty neat stuff, until we recall that only eight sprites can appear on a single scan line. Other disadvantages to using 8x16 sprites is that they must be stored in memory in the same pattern that they are used in the game. If &#x201C;A&#x201D; is used on top of &#x201C;B,&#x201D; neither tile can be re-used elsewhere. A practical example of this limitation occurs when animating characters. At times it is only necessary to alter a character&#x2019;s bottom or top half in a pose, yet using 8x16 sprites would prohibit us from re-using one of the halves. Instead, the same tile would have to be entered into memory twice, decreasing the total number of unique tiles that can appear on a screen at once. Here is a small example of what we are talking about:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/984A009A-FE08-590A-8266C31AA21522D7.png" show-src="scraper/images/984A009A-FE08-590A-8266C31AA21522D7.png"><br>
<br>
In the image on the left (8x8), the top half of the character could be recycled for both walking poses. The image on the right (8x16), though, necessitates that the top half be doubled in memory.<br>
&#xA0;<br>
To grasp the full implications of the above, tile usage would need to be multiplied by the number of poses for each character, the number of characters on a given screen, and other factors, such as if one has objects that are only a single tile tall. In regards to this last point, if a sword sixteen pixels long and eight pixels wide were displayed vertically it would successfully use an 8x16 sprite. However, when displayed horizontally, the other eight pixels of <em>two</em> sprites would be wasted. In this case, it is not so much that a tile would be doubled, but that it would have to be left blank (functionally equivalent to re-using the same tile twice, but the waste is more obvious).<br>
&#xA0;<br>
As usual, the use of 8x8 versus 8x16 sprites will depend on subject matter, programming preferences, and a host of other factors. If we are primarily drawing non-animated objects (space ships come to mind), or objects with fewer changes and variations, using 8x16 sprites could potentially allow more activity to exist on screen than if using 8x8 sprites.<br>
&#xA0;<br>
Another factor that plays into sprite design is <strong>mirroring</strong>. The NES allows sprites to be mirrored either horizontally, vertically, or both. Mirroring both directions at once essentially allows a sprite to be rotated. The following image is an extremely simple example of mirroring in action:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/98458C6B-0E74-8481-8320085D8FED74E8.png" show-src="scraper/images/98458C6B-0E74-8481-8320085D8FED74E8.png"><br>
<br>
Most graphics editors allow one to easily mirror and rotate sprites in order to get an idea of what a drawing will look like when finished, and let&#x2019;s be honest, it is easier to mirror something than to draw something from scratch. However, at the programming level it is a great way to save space in memory! The NES can only hold 256 unique tiles of sprite data in memory at any given time (plus another 256 tiles of background data), so mirroring becomes essential at a certain point. Mirroring is one of main strengths that sprites have going for them, as background tiles cannot be mirrored! One more key limitation that shapes one&#x2019;s drawing practices.<br>
&#xA0;<br>
&#xA0;<br>
<br>
<br>
<br>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#misc-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;misc-5__comments&apos;);">
                            Toggle Responses
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=137055" target="_blank">
                                Original Thread
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="misc-5__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-5__1">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Oct 24, 2014 at 9:55:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Some images are not displaying correctly, and have not been loaded into the post yet. Not quite sure what is going on with them...?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-5__2">
                                                        <div class="mdl-card__title"><strong>SimplyAzuma</strong> posted on 
		
			
				
				Oct 24, 2014 at 10:12:21 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Love this guide so far! Making me want to make a game, but I&apos;m at work. Time to open up paint, copy your color palette, and get started on some basic sprites! <span class="sprites_emoticons absmiddle" id="emo_happy"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-5__3">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Oct 24, 2014 at 10:21:56 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>SimplyAzuma</b></i><br>
	<br>
	Love this guide so far! Making me want to make a game, but I&apos;m at work. Time to open up paint, copy your color palette, and get started on some basic sprites!</div>
<br>
Woohoo!!! That&apos;s what I&apos;m hoping for <span class="sprites_emoticons absmiddle" id="emo_smile"></span>. Chapter 2 is also up now.<br>
<br>
<br>
Also, images should be fixed, though they are all out of proportion. Can&apos;t have everything in life.<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-5__4">
                                                        <div class="mdl-card__title"><strong>RpgCollector</strong> posted on 
		
			
				
				Oct 24, 2014 at 11:27:07 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					good stuff!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-5__5">
                                                        <div class="mdl-card__title"><strong>NESMASTER14</strong> posted on 
		
			
				
				Oct 24, 2014 at 1:04:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Nice write-up!  I learned something new.  I remember watching David Crane talk about how he made Pitfall on the 2600, and I was amazed at all the clever mirroring and other tricks he did to achieve impressive graphics with very little memory usage. I wasn&apos;t aware the Blue Bomber was brought to life thanks to sprite layering, neat!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-5__6">
                                                        <div class="mdl-card__title"><strong>BouncekDeLemos</strong> posted on 
		
			
				
				Oct 24, 2014 at 1:36:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Easy to follow without being convoluted. Nice work! Can&apos;t wait to see more! <span class="sprites_emoticons absmiddle" id="emo_happy"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-5__7">
                                                        <div class="mdl-card__title"><strong>DoNotWant</strong> posted on 
		
			
				
				Oct 24, 2014 at 3:46:51 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Awesome! Keep &apos;em coming.
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="misc-6">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">World Building with SGP 2: Introduction to NES Graphics Editors</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <h6 class="cardSubtitle">Written by Sole Goose Productions</h6>

                        
					<u>Introduction</u><br>
&#xA0;<br>
When programming, NES graphics data is stored and compiled from CHR file types. In terms of viewing CHR data without possessing the uncompiled code, it can be accessed through a program&#x2019;s ROM (.nes file type) by using a special type of program designed to display this data. These programs generally allow one to both view and edit the information that one finds, or to create wholly new information that can be compiled back into a .nes file. In other words, there are two movements that we are talking about: accessing and creating. Both are handy when drawing, since the former allows one to genuinely see what people did in the past, and of course the other allows for unique creations of your own.<br>
&#xA0;<br>
There are several graphics editors available for the NES, though most were written some time ago and are no longer updated. Still, they are extremely capable and useful. MRN gives an introduction to using Tile Molester in Week 2 of his tutorials, and it will not be gone over again here. Eventually, this section will introduce what looks to be a very powerful editor currently in development, though it is still in the testing phase at the moment. In the meantime, a brief discussion of YY-CHR will given, as it will allow one to get started in the present.<br>
&#xA0;<br>
&#xA0;<br>
&#xA0;<br>
<u>YY-CHR</u><br>
&#xA0;<br>
Find it, download it, install it; yay! Upon opening the program you can see some rather nice pictures, though outside of large cut-scenes they are of little use in actual game development. If you right click the top left corner, highlight the whole picture and then use ctrl X, you will be left with a blank canvas like what we have here:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/988082D1-924F-E3C3-112BE6397566A25B.png" show-src="scraper/images/988082D1-924F-E3C3-112BE6397566A25B.png"><br>
<br>
As can be seen, the gridded area on the left consists of 256 squares. The area on the right serves as a zoomed-in display of whatever is found within the white square on the left. Drawing and editing are done on the right, with several standard options in terms of tools. They are no more and no less complicated than those found in Paint.<br>
&#xA0;<br>
Another useful set of tools can be found along the top bar. These are the options to flip, rotate, or shift tiles on the canvas. They will affect anything that is highlighted. If using the left click, the default size of the box is a 4x4 tile area. However, if you right click, anything from a single tile all the way up to the entire canvas can be selected and altered (outlined by a blue box).<br>
&#xA0;<br>
If we examine the editor, we can see that below the area on the right there are different color and palette options. Sixteen possible palette options can be configured, though one&#x2019;s choices will not be saved for future use. Each palette choice consists of four colors, and the active palette also displays the hexadecimal values of each color. To change what colors are in the active palette, simply click on one of the four active colors and then click on your desired choice in the full NES spectrum below. As stated in the previous chapter, the colors will appear differently depending on both the display and format on which they are projected (CRT, LCD, emulator, actual hardware, etc.). Still, one blue can be seen to be darker or lighter than another blue. When drawing in YY-CHR, any of the blacks can be used, though when programming some should be avoided ($0D and another if I recall).<br>
&#xA0;<br>
A quick way to gain some familiarity with the program is to open up a few NES or Game Boy files and see what is in them. It allows us to see how programmers organized their work and also the chance to start playing around with some of the tools. If you do not have anything handy, there is a .chr file included with <em>The Nerdy Nights</em>. Please note that some files will not load correctly (<em>Zelda</em> for instance), and most will display garbled information at first. After opening a file, scroll down until you find something besides static. Here is a sample screen from a popular Game Boy game:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/9878A0DA-F87E-5B5E-428ED09362AE7865.png" show-src="scraper/images/9878A0DA-F87E-5B5E-428ED09362AE7865.png"><br>
<br>
Due to the currently selected colors, it can be difficult to tell what exactly one is looking at. Changing <em>only</em> the colors gives us the following:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/988E1760-F54C-68A5-91F4FFBAC4537715.png" show-src="scraper/images/988E1760-F54C-68A5-91F4FFBAC4537715.png"><br>
<br>
Now that we can see what we are looking at, we can also see that things are a bit out of sorts. Well, kind of anyways. Things as they are difficult to see visually, though they are arranged ideally from a (i.e. my) programming perspective. Thankfully, YY-CHR gives us the option of rearranging the tiles. Nine times out of ten, one of the options will be satisfactory. To do this, click on the Pattern option a bit below the display on the left. It will adjust in real time, as can be seen here:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/9890497C-BE76-E069-5A2DC1FA8EE68892.png" show-src="scraper/images/9890497C-BE76-E069-5A2DC1FA8EE68892.png"><br>
<br>
It is now possible to see what the artist(s) envisioned for three characters and more. The pattern that is displayed is easy enough to decipher, and it gets easier to do with practice. Pay special attention to mirrored poses. Also, sprites are generally easier to see than background data. Different pattern layouts and dominant colors may also be used when switching tile types.<br>
&#xA0;<br>
Just to note, if using CHR-RAM in one&#x2019;s program, individual tiles can be swapped out as needed, and one is not limited to a static set 256 tiles. One could arrange all of a main character&#x2019;s views and poses in one block of memory, as in the above example, and then load them into the program as needed. One of the benefits of the 256 tile grid, whether using CHR-RAM or CHR-ROM, is that it allows one to see everything that might be on a screen at once, decreasing the chance that one might conceptually plan for too much to be going on at a given time. In regards to sprites one needs to keep in mind player character and non-player character poses, weapons, items, status bar details, and a slew of other things. When dealing with background data, reserving space for an upper and lower case alphabet can eat up roughly a quarter of the available tiles. Add to this status bar elements or other stable features and the number grows to a good amount prior to drawing anything unique to a screen. Dealing with some of these concerns, however, is a topic for a different day.<br>
&#xA0;<br>
As stated above, when jumping between background and sprite tiles, color choices may be off. This is also a common occurrence when combining assets from different games. In my own drawing practices I often search for different examples to analyze and deconstruct prior to attempting anything creative on my own part. Here we can see two sprites from two different games side-by-side:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/98927682-044B-3097-1E80876296E10A3B.png" show-src="scraper/images/98927682-044B-3097-1E80876296E10A3B.png"><br>
<br>
The character on the right, while mostly accurate, needs a couple of colors swapped. YY-CHR allows us to do this relatively easily: highlight the desired group of tiles and then use control R to bring up the replace color option. The screen will look like this:<br>
&#xA0;<br>
<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/9894AD67-B6E8-1A7C-A917C2311772C3B9.png" show-src="scraper/images/9894AD67-B6E8-1A7C-A917C2311772C3B9.png"><br>
<br>
As a friendly warning let me just say that it can be a bit confusing to get the results that you want.<br>
&#xA0;<br>
YY-CHR is a powerful tool, but it is one that really needs to be used in order to be understood. Play around with it, analyze what others have done, draw some things and post them here or elsewhere. Practice makes perfect as they say. Also, if you discover other useful features please share them. I only use what I need, hence why this discussion is a bit abbreviated.<br>
&#xA0;<br>
The main limitation of using a program like YY-CHR, at least in my own experience, is that it only allows us to see four colors at once. If we are layering sprites, adding faces, or simply want to see what two background tiles might look like next to each other, we are forced to use other programs. If programming, one option is simply to load the tiles into a mock or dummy game. In the past I have kept a stripped down program that only displays a single screen just for this purpose. Another option, particularly if actively drawing with more than three or four colors, is to use Paint or a comparable program. At the moment, this is what I use for the majority of my drawing. Simply zoom in all the way to the pixel level and get to work. I generally draw a 16x16 box in order to not go outside of a metatile. One should also be sure to not let any layered sprites exceed an 8x8 area (unless you want them to of course). Another benefit of using Paint is that it allows one to stack revisions next to each other. For any given character I can have tens or hundreds of revisions on the same canvas, and can trace the evolution of my work. When it comes time to actually load tiles back into YY-CHR, each pixel must be transferred over. I have heard that there is a way to copy and paste from Paint to the graphics editor, and I used to use it, but I&#x2019;m not sure what happened. Plus, like the monks of old, there is a certain benefit to re-drawing one&#x2019;s final work. I usually tell myself that before and after the process, but forget it during the transfer. On the plus side, some mistakes are usually caught in terms of consistency. Anyways, if anyone knows how to get the copy and paste to work, please speak up!<br>
&#xA0;<br>
Now get drawing and let us see what you can do! Further chapters will deal with various smaller issues, and a great many of them are directly related to graphics. Until next time...<br>
&#xA0;<br>
&#xA0;<br>
&#xA0;<br>
<br>
<br>
<br>
<br>
<br>
<br>
				                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#misc-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;misc-6__comments&apos;);">
                            Toggle Responses
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=137056" target="_blank">
                                Original Thread
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="misc-6__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-6__1">
                                                        <div class="mdl-card__title"><strong>RpgCollector</strong> posted on 
		
			
				
				Oct 24, 2014 at 11:24:30 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Very good stuff!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-6__2">
                                                        <div class="mdl-card__title"><strong>labelwhore</strong> posted on 
		
			
				
				Oct 24, 2014 at 4:54:34 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<br>
	Due to the currently selected colors, it can be difficult to tell what exactly one is looking at. Changing <em>only</em> the colors gives us the following:<br>
	&#xA0;<br>
	<img align alt border="0" hspace="4" src vspace="4" original-src="http://nintendoagemedia.com/users/16129/photobucket/988E1760-F54C-68A5-91F4FFBAC4537715.png" show-src="scraper/images/988E1760-F54C-68A5-91F4FFBAC4537715.png"></div>
<br>
Can you give us the steps to get to this point? I&apos;ve been playing with YY-CHR but how to do this isn&apos;t clear to me. Thanks.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-6__3">
                                                        <div class="mdl-card__title"><strong>SoleGooseProductions</strong> posted on 
		
			
				
				Oct 25, 2014 at 1:18:41 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					You will have to have a ROM or CHR file to open. There are basic ones included with other tutorials, in case you do not have any accessible. Then it is just a straightforward process of opening the file. You will see a garbled mess when opening most files (PRG data I am told; thanks MRN), but if you scroll down a ways youwillmbegin to see graphics data. Try that and report back if that does not solve it. I may be misunderstanding the question <span class="sprites_emoticons absmiddle" id="emo_smile"></span>.
<br>
<br>Also PLEASE NOTE: if you make changes to a ROM, well, you&apos;ve changed it! Use copies of things when saving. Unless of course you want to change the graphics in a game, but I have not messed around with that so my experience is nil on that front.
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="misc-7">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Top Status Bar and Controller Question</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <h6 class="cardSubtitle">Written by bigjt_2</h6>

                        
					Hey Everyone,<br><br>I&apos;ve been able to figure out how to get a status bar working at the bottom of the screen using sprite 0 collision (thanks to the help of albaily and thefox, of course).&#xA0; Now I&apos;ve been experimenting with moving the status bar to the top of the screen.&#xA0; I cannot get it to work without it going all buggy.&#xA0; Here&apos;s my NMI routine:<br><br>NMI:<br>&#xA0; PHA&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;save registers in case of interrupt<br>&#xA0; TXA<br>&#xA0; PHA<br>&#xA0; TYA<br>&#xA0; PHA<br><br>&#xA0; LDA #$00<br>&#xA0; STA $2003&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; set the low byte (00) of the RAM address<br>&#xA0; LDA #$02<br>&#xA0; STA $4014&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; set the high byte (02) of the RAM address, start the transfer<br><br><br>&#xA0; LDA needdraw<br>&#xA0; AND #%00000001<br>&#xA0; BEQ .skipcolumns<br><br>&#xA0; JSR load_offscreen_tiles<br>&#xA0; JSR load_offscreen_attributes<br><br>.skipcolumns:<br>&#xA0; LDA needdraw<br>&#xA0; AND #%00000010<br>&#xA0; BEQ .skipscore<br>&#xA0; JSR DrawScore<br><br>.skipscore:<br>&#xA0; LDA soft_2000<br>&#xA0; STA $2000<br>&#xA0; LDA soft_2001<br>&#xA0; STA $2001<br><br>.Scrolling:<br>&#xA0; LDA $2002&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;reset the latch<br>&#xA0; LDA xScroll<br>&#xA0; STA $2005<br>&#xA0; LDA #$00<br>&#xA0; STA $2005<br><br>&#xA0; LDA #$00<br>&#xA0; STA sleeping<br><br>.Sprite0_testone:<br>&#xA0; BIT $2002<br>&#xA0; BVS .Sprite0_testone<br>.Sprite0_testtwo:<br>&#xA0; BIT $2002<br>&#xA0; BVC .Sprite0_testtwo<br><br>&#xA0; LDA #%10010000<br>&#xA0; STA $2000<br><br>&#xA0; LDA $2002<br>&#xA0; LDA #$00<br>&#xA0; STA $2005<br>&#xA0; STA $2005<br><br>&#xA0; PLA&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; restore registers<br>&#xA0; TAY<br>&#xA0; PLA<br>&#xA0; TAX<br>&#xA0; PLA<br><br>&#xA0; RTI&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ; return from interrupt<br><br>I&apos;ve attached the full ROM with all the asm and info files in a zip with this post.&#xA0; At first I tried placing the $2000 and $2005 changes above the sprite 0 code and had it all at the beginning of NMI.&#xA0; Also, I moved my Sprite 0 coordinates (found in init_PPU.asm) to intersect the lower edge of the status bar at the top of the screen.&#xA0; For whatever reason, I thought that would work.&#xA0; Plop.&#xA0; It didn&apos;t.<br><br>Also, I&apos;ve noticed I have a problem coding controller input.&#xA0; Pushing the &quot;A&quot; and &quot;B&quot; buttons in this demo is supposed to increment/decrement that two-digit counter at the bottom by one.&#xA0; Instead, it increment/decrements by 6-12 (it changes every time).&#xA0; I&apos;m guessing it&apos;s because each time I push a button, it picks it up over the course of many frames instead of just one, and hence reads it as though I pushed the button many times instead of just one.&#xA0; Am I right?&#xA0; If so, anyone know any smooth tricks around this?&#xA0; I ran into the same problem awhile ago when I was trying to do a pause routine.<br><br>PS - Some of my comments may be incorrect in the ASM files (wrong decimal value, for instance)&#xA0;&#xA0; Sorry if anyone runs into that.<br>
				<br><p><strong>Attachment:</strong> <a no-mirror href="scraper/files/spr0_scroll.zip">spr0_scroll.zip</a></p>                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#misc-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;misc-7__comments&apos;);">
                            Toggle Responses
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=33132" target="_blank">
                                Original Thread
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="misc-7__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-7__1">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				May 12, 2010 at 8:38:55 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Don&apos;t do too much with scrolling, but check out the controller reading routine in my Background Compression tutorial that I stole from....someone. The D-PAD buttons only &quot;work&quot; when they are pressed after being released (or, rather, they don&apos;t work more than once if you hold the button down).
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-7__2">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				May 12, 2010 at 5:49:59 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Never messed with sprite-0 stuff myself, but if I were to guess how to do it, I&apos;d try this:<br><br>1) Draw the status bar at the top of the nametable instead of the bottom.<br>2) At the end of NMI, set scroll to 0, 0<br>3) Wait for sprite 0<br>4) set scroll to scroll_x, 0<br><br>For the controller reading,?MRN has the right idea.&#xA0; You want to make a distinction between a button that is pressed and one that is newly pressed (ie, wasn&apos;t pressed last frame).&#xA0; To do that, you will need to save the button states for last frame:<br><br>read_controller:<br>&#xA0;&#xA0;&#xA0; lda buttons<br>&#xA0;&#xA0;&#xA0; sta buttons_old&#xA0;&#xA0; ;save last frame&apos;s button state before getting the new one<br>&#xA0;&#xA0; &#xA0;<br>&#xA0;&#xA0;&#xA0; ;snip.. read controller and store result in buttons<br><br>&#xA0;&#xA0;&#xA0; lda buttons_old&#xA0;&#xA0;&#xA0; ;last frame&apos;s buttons<br>&#xA0;&#xA0;&#xA0; eor #$FF&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; &#xA0; ;flip the bits, so 1=not pressed last frame, 0=pressed<br>&#xA0;&#xA0;&#xA0; and buttons&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;and with this frame&apos;s buttons.<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &#xA0; &#xA0; &#xA0; ;Only those buttons not pressed last frame and pressed this frame will return as 1.<br>&#xA0;&#xA0;&#xA0; sta buttons_newly_pressed&#xA0; ;store results.<br>&#xA0;&#xA0;&#xA0; rts <br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-7__3">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				May 12, 2010 at 6:52:58 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Awesome!  I&apos;m crazy busy with work but I&apos;ll try this when I get some free time.  Thanks MRN and Metalslime!&#xA0; I think this is what I&apos;m looking for.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-7__4">
                                                        <div class="mdl-card__title"><strong>albailey</strong> posted on 
		
			
				
				May 12, 2010 at 8:39:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Thats an awesome demo dude.
<br>
<br>The premise of putting the status bar at the top, is to remember to reset both the nametable page (register $2000) as well as both scroll registers ($2005).
<br>
<br>Then you wait for sprite zero to be reset (this happens at the end of vblank)
<br>Then you wait for sprite zero to be set (this happens when the screen draws sprite zero, and at least two of its pixels intersect the status area)
<br>Then you set the nametable correctly in register $2000 (either $2000 or $2400) and the scroll correctly.
<br>
<br>Here&apos;s example code:
<br>
<br>nmiHandler:
<br>        ; NMIs can be called anywhere at any time, so lets protect A,X,Y by putting them on the stack
<br>        PHA ; 3 cycles
<br>        TXA ; 2 cycles
<br>        PHA ; 3 cycles
<br>        TYA ; 2 cycles
<br>        PHA ; 3 cycles  so 13 CPU cycle setup cost to protect A,X,Y (and another 16 to restore things back at the end of the RTI)
<br>
<br>
<br>        LDA $2002 ; reset address latch
<br>
<br>
<br>        ; update the graphics, etc..
<br>
<br>        ; reset the status region to nametable of register PPU Control Register $2000 to be the nametable where the status region is located (usually $2000)
<br>        LDA #%10001000 
<br>        STA $2000
<br>        ; Reset the scrolling
<br>        LDA #$00
<br>        STA $2005
<br>        STA $2005
<br>
<br>        ; sprite DMA
<br>        lda #$02
<br>        sta $4014
<br>
<br>        ; Credit to DVDmth and DWEdit and Disch for helping me with sprite 0 detection
<br>        ; I do not care what is in the accumulator.  The BIT command will set overflow based on bit 6 of memory address ($2002)
<br>        ; Basically here is what happens with Sprite #0.  The hit flag is set and stays set for the entire frame and not cleared until scanline #0 starts (end of vblank)
<br>        ; Hit flag gets set when a non color 00 background instersects a non 00 color sprite pixel.  This cannot occurs at X position 255
<br>
<br>        ; Wait for Scanline #0 to reset the Sprite #0 hit flag
<br>:       BIT $2002
<br>        BVS :-
<br>
<br>        ; Wait for the first intersected pixel of sprite #0 to be rendered
<br>:       BIT $2002
<br>        BVC :-
<br>
<br>        ; Now set the screen and scroll for the game part
<br>        LDA CURRENT_SIDE_SCROLLER_DATA
<br>        STA $2000
<br>
<br>        ; FINE X scrolling updates right away, but I do not care so long as the status bar color is the same all the way through nametable $2000 and $2400.  Otherwise I will see crawling.
<br>        LDA X_SCROLL
<br>        STA $2005 ; first write is X scrolling
<br>        LDA #$00
<br>        STA $2005 ; second write is Y scrolling
<br>   
<br>etc..
<br>Al
<br>
<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-7__5">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				May 18, 2010 at 11:39:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Sweet!  Thanks Al!  Sorry it took me forever to get back to this.  Work&apos;s been NUUTS!  Anyway, I&apos;m going to start working on this and I&apos;ll let you know if I have any questions.  It looks like you&apos;ve left a very detailed good description, though, so hopefully I can get this.  Thanks again!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-7__6">
                                                        <div class="mdl-card__title"><strong>bunnyboy</strong> posted on 
		
			
				
				May 18, 2010 at 12:02:50 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>albailey</b></i><br><br>        ; FINE X scrolling updates right away, but I do not care so long as the status bar color is the same all the way through nametable $2000 and $2400.  Otherwise I will see crawling.
<br>        LDA X_SCROLL
<br>        STA $2005 ; first write is X scrolling
<br>        LDA #$00
<br>        STA $2005 ; second write is Y scrolling
<br></div><br>What I have done is timed loops starting when the sprite 0 hit happens. &#xA0;If you can get your $2005 writes to happen at the end of the scanline, when the PPU is fetching sprite data, you won&apos;t see any graphical glitches. &#xA0;Sprite fetching is long enough to account for the variable width crawl.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-7__7">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				May 19, 2010 at 1:27:02 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey Folks,<br><br>Got it working on the top.&#xA0; Thanks again, Al!&#xA0; I&apos;m posting the new demo in case any other noobs like myself are messing around with scrolling/Sprite 0 split and need a working demo to reference for their own projects.<br><br>Also, this one doesn&apos;t have the updating counter on the scrolling bar, but I did get the better controller reading working on the demo with the status bar at the bottom, as well.&#xA0; So thanks for the help with controller input, Metalslime and Mario&apos;s Right Nut.&#xA0; That also helped me finally get a pause function working on the pong game I made.&#xA0; Woo-hoo!<br><br>Lastly, I took an hour and cleaned up my comments so they ACTUALLY reflected the code.&#xA0; Novel idea, I know.&#xA0; I will warn that the comments on the demo with status bar at the bottom have not been checked over and are inaccurate.&#xA0; The comments in this demo should be fine, though.<br>
				<br><p><strong>Attachment:</strong> <a no-mirror href="scraper/files/top_status_bar.zip">top_status_bar.zip</a></p></div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-7__8">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				May 20, 2010 at 1:44:29 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;ll have to bookmark this so I can try it when I get home.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-7__9">
                                                        <div class="mdl-card__title"><strong>KHAN Games</strong> posted on 
		
			
				
				May 20, 2010 at 2:18:31 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Ohh, thanks for this.  I was wanting to learn how to load different nametables ahead of time for scrolling, so I&apos;ll definitely take a look at this!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-7__10">
                                                        <div class="mdl-card__title"><strong>albailey</strong> posted on 
		
			
				
				May 20, 2010 at 3:22:55 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bunnyboy</b></i><br><br><div class="FTQUOTE"><i>Originally posted by: <b>albailey</b></i><br><br>        ; FINE X scrolling updates right away, but I do not care so long as the status bar color is the same all the way through nametable $2000 and $2400.  Otherwise I will see crawling.
<br>        LDA X_SCROLL
<br>        STA $2005 ; first write is X scrolling
<br>        LDA #$00
<br>        STA $2005 ; second write is Y scrolling
<br></div><br>What I have done is timed loops starting when the sprite 0 hit happens. &#xA0;If you can get your $2005 writes to happen at the end of the scanline, when the PPU is fetching sprite data, you won&apos;t see any graphical glitches. &#xA0;Sprite fetching is long enough to account for the variable width crawl.</div><br><div>One other observation about crawling, but not directly pertaining to &quot;fine X&quot; scrolling.
</div><div><br></div><div>I had a bug a while back where I was using a status area at the bottom of the screen, and was placing the sprite zero on the top row of that status area (around row 22).</div><div><br></div><div>My bug was that because I placed the sprite zero in the status area, a portion of that status area would scroll as part of the game scrolling region. This was noticeable because I made the status region not run the entire width of the screen. &#xA0;This meant I had not used a solid line at the top of my status area, and I could visually see it moving across the screen.&#xA0;</div><div><br></div><div>The bug was actually more serious than just a graphical glitch, because the crawling meant that when an all transparent background &#xA0;tile scrolled to the location of the sprite zero, I did not get my sprite zero collision, and therefore my NMI routine never returned properly, etc..</div><div><br></div><div>I would not have had this problem with a status region at the top of the screen, because the only &quot;crawling&quot; that would be seen is the fine X scroll that Brian alluded to in his post.</div><div><br></div><div>A possible work around would have been to locate sprite zero above the status area, but in my opinion that can also lead to trouble, since you need to remember to make sure you do not have fully transparent background blocks in the game area for that row, otherwise you can hit the same problem.</div><div><br></div><div>So in summary, if you are going to put a status area on the bottom of your screen, make sure you load it into both $2000 and $2400 nametables, and make sure that at least the top line of the status region runs continuously the entire width.&#xA0;</div><div><br></div><div>Al</div><div><br></div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-7__11">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				May 20, 2010 at 5:34:49 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>albailey</b></i><br><br><div><br></div><div>So in summary, if you are going to put a status area on the bottom of your screen, make sure you load it into both $2000 and $2400 nametables, and make sure that at least the top line of the status region runs continuously the entire width.&#xA0;</div><div><br></div><div>Al</div><div><br></div></div><br><br>I actually noticed this, too, when I first started messing around with the Sprite 0 code a couple weeks ago.&#xA0; I was originally trying to make my status bar like SMB1s where it seems transparent and only the bottom of the coin is the sprite used for intersection.&#xA0; As soon as that sprite leaves the non-transparent pixels background, everything crashes.&#xA0; The best thing to do is what Al suggested above.&#xA0; I still have no clue how SMB1 got it to work.&#xA0; (Perhaps moved the sprite as the screen scrolled?&#xA0; I have no idea.)&#xA0; But then I guess that game is programmed a little oddly, from what I&apos;ve heard.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-7__12">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				May 20, 2010 at 5:38:20 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>mewithoutYou52</b></i><br><br>Ohh, thanks for this.  I was wanting to learn how to load different nametables ahead of time for scrolling, so I&apos;ll definitely take a look at this!</div><br><br>If anyone has any ?s, feel free to PM me or post on the thread.&#xA0; That background scroller may not be the most ideal, it&apos;s just what I&apos;ve been able to make work so far.&#xA0; Mario&apos;s Right Nut found a bug yesterday where it malfunctions if you change the amount of INC/DEC on the xScroll variable.&#xA0; I have a temporary working fix that requires changing a couple of hard-coded numbers in the main ASM file.&#xA0; If anyone else runs into it, let me know and I&apos;ll tell you which two numbers to change.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

                                            <div class="tutorialCard mdl-card mdl-shadow--2dp" id="misc-8">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Background Horizontal Scrolling Buffer</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <h6 class="cardSubtitle">Written by bigjt_2</h6>

                        
					Hey Everyone,<br><br>I just wanted to share a horizontal background scrolling engine I&apos;ve been working on.&#xA0; I&apos;ve noticed a lot of other noobs besides myself asking about how to do this, so wanted to post this to hopefully help out.&#xA0; It&apos;s probably not the most effective way to handle background scrolling and buffering, it&apos;s just simply how I got it to work.&#xA0; I&apos;m sure there are improvements that can be made, and if anyone has them to suggest it would be awesome.<br><br>One area where I know improvements can be made is incorporating metatiles and data compression.&#xA0; The backgrounds are loaded in byte by byte and it can be a bit time-consuming making them and then re-arranging them to work with the buffer.&#xA0; Also, since I don&apos;t know how to use compression and each background takes up about 1K of memory, that only gives you about 31 backgrounds you can load in using this engine.&#xA0; Eh, who needs worlds 1-2 through 8-4 of Super Mario Bros, anyway?&#xA0; :-)<br><br>So think of it as &quot;beginner&apos;s&quot; scrolling engine, one that would hopefully be easier to understand by noobs such as myself.&#xA0; I was simply focused on getting something up and running, and then figuring out the more complicated stuff later.&#xA0; I&apos;m going to start studying said complicated stuff very shortly.&#xA0; <br><br>In the mean time, if anyone needs to look at something more advanced, you might check out Cadaver&apos;s more sophisticated scrolling engine that handles vertical and horizontal scrolling.&#xA0; It&apos;s excellent and can be found at nesdev (<a href="http://parodius.com/scroll.zip).&#xA0;" target="_blank" original-href="http://parodius.com/scroll.zip).&#xA0;">http://parodius.com/scroll.zip).&amp;...</a>; I&apos;ve been looking at it a little bit but haven&apos;t delved too deeply into the code, yet.<br><br>--Edit: Forgot to mention: hit left and right to scroll.&#xA0; Sorry.&#xA0; It&apos;ll stop you from scrolling any farther when you&apos;ve hit the left edge of first background or right edge of last background.<br><br>--Further Edit 5-19-10:&#xA0; I just noticed this has been posted to the Programming Resources sticky.&#xA0; Just so I don&apos;t confuse anyone who might be looking, I&apos;ve removed all earlier versions of this demo.&#xA0; It&apos;s gone through a lot of changes and the first few versions were not at all ideal.&#xA0; I will keep the most current, updated version posted at the top of the thread here to make it easier for people to find.<br>
				<br><p><strong>Attachment:</strong> <a no-mirror href="scraper/files/top_status_bar.zip">top_status_bar.zip</a></p>                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="#misc-toc">
                            返回目录
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="javascript:doCommentToggle(&apos;misc-8__comments&apos;);">
                            Toggle Responses
                        </a>

                        <div style="float: right;">
                            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent" href="http://nintendoage.com/forum/messageview.cfm?StartRow=1&amp;catid=22&amp;threadid=31898" target="_blank">
                                Original Thread
                            </a>
                        </div>
                    </div>
                </div>
                <div class="comments" style="display: none;" id="misc-8__comments">
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__1">
                                                        <div class="mdl-card__title"><strong>NESHomebrew</strong> posted on 
		
			
				
				Apr 11, 2010 at 4:26:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Something is wrong with the scroll.zip link.  It doesn&apos;t seem to be working.  I&apos;ve been doing a bit of research in the scrolling department myself (although I only need 1 directional horizontal scrolling).  Any methods and source is always worth a good look through.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__2">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 11, 2010 at 10:31:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey WhatULive4, see if this link works at mediafire:<br><br><a href="http://www.mediafire.com/?n5mfiomknxi" target="_blank" original-href="http://www.mediafire.com/?n5mfiomknxi">http://www.mediafire.com/?n5mfiomknxi</a><br><br>Let me know if you&apos;re still having problems downloading or have any questions about the code.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__3">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 19, 2010 at 10:39:09 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey Folks,<br><br>Here&apos;s a newer version that&apos;s quite a bit better.&#xA0; It makes use of 2x2 tile metatiles (16x16 pixel) and also the RLE compression that ProgrammingAce descibes in his article <a href="http://cinematicbazaar.com/?p=80" target="_blank" original-href="http://cinematicbazaar.com/?p=80">here.</a>&#xA0;&#xA0; Again, for demo purposes this uses the SMB1 chr file since it&apos;s readily available.<br><br>By condensing everything down to metatiles and using the RLE method, backgrounds in the background.i file are roughly 80% their original size.&#xA0; Also, the backgrounds are a hell of a lot easier to load in once the initial time investment of getting the metatiles.i set up is completed.&#xA0; The RLE has three major flags in the background.i file that trigger in the dbuffersubs.asm.<br><br>$FD is used to draw a repetition of metatiles where all four tiles are the same.&#xA0; In this demo I use it to draw the sky, but you can use it for anything just as long as all four tiles making up the metatile are similar (though you&apos;d obviously need to change the code in dbuffersubs.asm to the tile you want).&#xA0; In background.i, simply code it by typing $FD, and the number of times you wish to draw the sky metatile.&#xA0; Ex. .db $FD,$05 in background.i draws the sky metatile five times on the current column.<br><br>$FE is used to draw a repetition of metatiles made up of different tiles.&#xA0; With this you have to code the flag, then the number of times you want it to load, then the metatile number.&#xA0; Ex. .db $FE,$07,$19 would draw the question block seven times on the current column.<br><br>$FF is used to terminate the load loop in dbuffersubs.asm, and must be placed at the end of each column you&apos;re coding in background.i.<br><br>If you find bugs or if I&apos;ve done a really good job making this confusing as hell, please IM me.&#xA0; Also, I didn&apos;t really take a lot of time looking over my comments so hopefully they make sense.&#xA0; If not, let me know.<br><br>Just in case the attachment doesn&apos;t work,<a href="http://www.mediafire.com/?mzzea0ntgty" target="_blank" original-href="http://www.mediafire.com/?mzzea0ntgty"> here&apos;s the link at mediafire.</a><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__4">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 19, 2010 at 10:59:36 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This is pretty cool.  I can&apos;t wait to check it out in depth.  I&apos;ve been toying with scrolling, but I think that it will interfear with my other stuff.  There&apos;s only so much time in V-Blank.  <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-sad.gif" show-src="images/blank.gif">  Maybe on a later level.  
<br>
<br>Thanks dude.  This will be most helpful.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__5">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 19, 2010 at 11:19:37 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Cool, hopefully it is of some use to somebody.  It&apos;s always good to hook up the Right Nut.  :-)  I&apos;m not even really sure what I&apos;m going to use it for, to be honest.  I&apos;m just having fun playing around with stuff like this.  Oh, and don&apos;t forget about that scrolling demo I found at nesdev, too.  I listed it above and it might be helpful.  I just haven&apos;t opened it up and studied it too deeply to see what&apos;s in it, yet.
<br>
<br>Hey, I haven&apos;t seen any updates on your game in awhile.  How&apos;s it coming along?
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__6">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 19, 2010 at 11:48:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					This link &quot; (<a href="downloads/missing/scroll.zip" target="_blank" original-href="http://parodius.com/scroll.zip">http://parodius.com/scroll.zip...</a>). &quot; isn&apos;t working.  <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-sad.gif" show-src="images/blank.gif">
<br>
<br>My game is comming along.  I haven&apos;t made too much progress recently due to the minor inconvinence of a certain test that I just got through.  But now I&apos;m getting back to it.  I have spent some substantial time reoragnizing, rewriting stuff OUT of NMI, making my own compression scheme, and implimenting CHR-RAM stuff.  <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">  After all that, I got a bug into one of my sprites somehow that is being really fucking irratating...I need to figure out what&apos;s wrong before I move on.  Then music/sfx and then onto levels!
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__7">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 19, 2010 at 12:04:44 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Oh, I see.<br><br>I wasn&apos;t paying enough attention when WhatULive4 told me about it above and thought he was talking about my link.<br><br>Here I&apos;ve just re-attached Cadaver&apos;s scroller if anyone wants to see it.&#xA0; It can also be found at the nesdev wiki.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__8">
                                                        <div class="mdl-card__title"><strong>albailey</strong> posted on 
		
			
				
				Apr 20, 2010 at 9:06:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>Mario&apos;s Right Nut</b></i><br><br>This link &quot; (<a href="downloads/missing/scroll.zip" target="_blank" original-href="http://parodius.com/scroll.zip">http://parodius.com/scroll.zip</a>). &quot; isn&apos;t working.  <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-sad.gif" show-src="images/blank.gif">
<br>
<br>My game is comming along.  I haven&apos;t made too much progress recently due to the minor inconvinence of a certain test that I just got through.  But now I&apos;m getting back to it.  I have spent some substantial time reoragnizing, rewriting stuff OUT of NMI, making my own compression scheme, and implimenting CHR-RAM stuff.  <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">  After all that, I got a bug into one of my sprites somehow that is being really fucking irratating...I need to figure out what&apos;s wrong before I move on.  Then music/sfx and then onto levels!</div><br><br>Why are you moving the code out of NMI? &#xA0; I assume because the code extends beyond the time period of a single frame?
<div><br></div><div>Al</div>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__9">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 20, 2010 at 10:14:50 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I was planning ahead. As I had it before, I had to turn NMI off to load a room as it was extending well out of v-blank, and maybe into the next frame. This would cause the music to skip...maybe. I haven&apos;t got that far, but I think that it will work better without having to make the music wait for the room to load (and theoritically an entire new bank of CHR-RAM). <br><br>I tried it before, but couldn&apos;t get the scroll not to jump around when it skipped back to NMI in the middle of loading stuff. I saw MetalSlime&apos;s &quot;sleeping&quot; code in his sound NN tutorials and thought I&apos;d try it. It made the main code run once per frame and a simple BNE and a variable (loading-background-don&apos;t-fuck-with-the-PPU) made it run nice. It actually made the black flash when the PPU is turned off almost so fast you can&apos;t see it any more. I&apos;d imagine that is because before it would run into the next frame, than have a waitforvblank, then turn the graphics on, then continue on. Now it is only off for one frame. <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif"> <br><br>So far I like it. (And it forces me to seperate my &quot;do-shit&quot; code from my &quot;write to the background&quot; code.)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__10">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 20, 2010 at 11:48:03 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Another good thing to check out (though it sounds like you already might have) is the drawing buffer in Metalslime&apos;s skeleton.asm file.  It took me awhile to get it, but it&apos;s a really good, easy-to-read implementation of what Disch discusses in his &quot;Frame and NMI&quot; document about preparing a string of data during rendering and then loading it in once NMI fires.
<br>
<br>Anymore I don&apos;t put anything in NMI unless it&apos;s strictly a drawing load/store function or something I&apos;m told is absolutely necessary to be there.  There are some healthy debates on nesdev over the whether or not you really need to strip down your NMI code like that, but from what I&apos;ve read I just don&apos;t see the need to put anything there that isn&apos;t a write to the PPU.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__11">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Apr 22, 2010 at 1:06:31 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Pretty cool!&#xA0; I saw this thread a few days ago but didn&apos;t have time to look through the code until today.&#xA0; Now that I&apos;ve looked through it I want to throw some ideas your way.&#xA0; BTW, what you wrote is just fine and you don&apos;t have to change anything.&#xA0; These are just ideas so feel free to ignore them if they don&apos;t work for you <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">.&#xA0; Just some tips that could improve performance:<br><br>1) You can save some more bytes on your background data by removing the $FF terminator on all columns.&#xA0; Usually terminators are used when you have data of variable length, where you don&apos;t have any idea when it&apos;s going to end (dialogue text, for example).&#xA0; Since all your columns are the same size, you can know when you reach the end by keeping a count of how many tiles you&apos;ve processed.&#xA0; I&apos;d load the column size into an index register (or a temp variable if X and Y are both being used) and then decrement it every time you write a tile to the buffer.&#xA0; Column is finished when your counter reaches 0.&#xA0; Cutting the terminator will save you 16 bytes per screen, which makes a significant difference if you have a bunch of screens.<br><br>2) Not quite sure why you have a special case for the sky metatile.&#xA0;&#xA0; My guess is that you were trying to save a byte by not having to declare the sky metatile id in the case of a normal RLE, ie for a run of 8 you save a byte like this: $FE, sky_metatile_id, $08 -&gt; $FD, $08.<br><br>It makes some sense since sky is used a lot, but you use a lot of bytes hardcoding the subroutine to handle the special sky case and if you change the ordering of your tiles in the pattern tables, you have to hunt down the hardcoded special cases and change the codes manually.<br><br>Another way to do RLE is to have a bit (say, bit7) signify RLE mode instead of a whole byte.&#xA0; Then you can pack the RLE indicator in with the metatile ids.&#xA0; So instead of:<br><br>.byte $01, $02&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;2 metatiles<br>.byte $FE, $10, $04,&#xA0;&#xA0; ;a run of 4 metatiles<br>.byte $FE, $07, $06&#xA0;&#xA0; ;a run of 6 metatiles<br><br>you could have:<br><br>.byte $01, $02&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;2 metatiles<br>.byte $90, $04&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;a run of 4 (metatile id $10, with the RLE bit set)<br>.byte $87, $06&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;a run of 6 (metatile id $07, with the RLE bit set)<br><br>This way every run is 2 bytes and its generic so nothing needs to be hardcoded.<br><br>3) Your drawing buffer appears to draw every frame, even if there is no movement/change.&#xA0; In other words, when the player isn&apos;t moving, you keep drawing the same offscreen columns over and over again.&#xA0; This is ok for a demo, but in a game it wastes some drawing time that you might need to do other PPU updates.&#xA0; One way to solve this is to put a cap on the drawing buffer (say a $00).&#xA0; After you draw a column, put the cap at the beginning of your buffer.&#xA0; Then in your buffer-&gt;ppu subroutine, skip to RTS if the first byte is $00.<br><br>4) Your drawing buffer could be set up to draw strings of bytes instead of just individual bytes.&#xA0; Right now, you set the target PPU address via $2006 for each byte.&#xA0; But really you only need to write an address to $2006 once per column.&#xA0; The PPU supports column drawing (bit2 of $2000 toggles row/column drawing).&#xA0; So instead of your drawing buffer looking like this:<br><br>hi_address, lo_address, tile, hi_address, lo_address, tile, hi_address, lo_address, tile, etc ;3 PPU writes per tile!<br><br>you could have:<br><br>count, hi_address, lo_address, tile, tile, tile, tile, tile, tile ;set address once, and then 1 PPU write per tile<br><br>The key is to set the PPU to increment by 32 via bit2 in $2000 so that consecutive writes draws a column instead of a row (see <a href="http://wiki.nesdev.com/w/index.php/PPU_registers#Controller_.28.242000.29_.3E_write" target="_blank" original-href="http://wiki.nesdev.com/w/index.php/PPU_registers#Controller_.28.242000.29_.3E_write">http://wiki.nesdev.com/w/index.ph...</a> ).<br><br>Oops, gotta go to class.&#xA0; No time to edit.&#xA0; Hope that made some sense <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-smile.gif" show-src="images/blank.gif">&#xA0; Good job, btw.&#xA0; Your code is starting to look slick! <br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__12">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 22, 2010 at 12:19:04 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Metalslime, as always, you sir are the man!  Thanks for the suggestions, especially number 3.  I noticed in skeleton.asm and a lot of other stuff I&apos;ve been looking at that drawing buffers are typically turned on and off in case there&apos;s other stuff that needs to be drawn.&#xA0; I was wondering how to do that.  Now I know, so thanks!
<br>
<br>I didn&apos;t even consider number one, but now I get exactly what terminators are to be used for.  Very nifty!  Number two took me a minute but I started plugging in the numbers to my programming calc and see how it works now.  I haven&apos;t played around too much yet with using flag bits instead of flag bytes, but am gradually seeing how they work.  Basically what it seems I need to do is add a BIT test in the part where it&apos;s reading from background.i and use an AND to read from bit 7.  If bit 7 is one, jump to RLE, if it&apos;s 0, write the matatile into RAM and jump to next byte.  That&apos;s pretty cool!  Obviously this means you can&apos;t have any more than 128 metatiles on any one list, because after $7F (decimal 127) the test bit for RLE would always be set and you&apos;d always jump to RLE.  How do you usually get around this?  Actually, have you ever needed to in the first place?  Upon thinking about it it seems that&apos;s a lot of metatiles, but then this demo is pretty simple and it uses 25, so I&apos;m guessing the number can add up pretty quick.  Do you simply jump to different metatile indexes if the number gets too high?
<br>
<br>And OMG, number 4!  I&apos;m slamming my head into my desk right now!  You know I actually spent time writing a block of code to increment by 32 for the addresses?  It didn&apos;t work, so I came up with that hi_address, lo_address etc scheme.  If I&apos;d just looked at Deskin&apos;s technical doc and realized what you said here earlier I would have saved myself so much time.  It&apos;s right there in Appendix B in the table for register $2000 &quot;Bit 2 - Specifies amount to increment address by, either 1 if this is 0 or 32 if this is 1.&quot;  It&apos;s undoubtedly been written in the other tuts too but I foolishly ignored it.  Raarrggghh!!!  Oh well, painful lesson learned.  :-)
<br>
<br>So anyway, yeah, I&apos;m going to work these suggestions in.&#xA0; Thanks again for the help!&#xA0; As always, it&apos;s much appreciated.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__13">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 22, 2010 at 1:08:33 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I&apos;m not sure how you have it set up, but I don&apos;t think you can have more than 128 metatiles in a tileset cause you have to multiply it by two to use a look up table.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__14">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 22, 2010 at 3:22:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Yeah, you&apos;re right.  I didn&apos;t think about that.  So moot point on my part.  You couldn&apos;t list any higher than $7F anyway because anymore would spill over into another byte when multiplying by two.  I guess I&apos;ll cross that bridge if I ever come to it where I need more than 128 entries.  For now I&apos;m guessing you&apos;d just need to use different metatile indexes for the different levels and whatnot.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__15">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 22, 2010 at 4:06:45 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					if you put your high bit on the repeat number rather than the tile number, that might help. Then you could use bit 6 for the metatile set flag and have the other bits for other info.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__16">
                                                        <div class="mdl-card__title"><strong>ProgrammingAce</strong> posted on 
		
			
				
				Apr 22, 2010 at 4:40:17 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Don&apos;t feel too bad about how you have the meta-tiles setup. My first implementation was *awful*. I would draw a tile, jump ahead 32 tiles to draw the second, jump back 31 tiles to draw the 3rd, then jump ahead another 32 to draw the 4th. The only reason it didn&apos;t bring the game to a screeching halt is because buffered the writes into ram...
<br>
<br>Your code is looking pretty good.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__17">
                                                        <div class="mdl-card__title"><strong>MetalSlime</strong> posted on 
		
			
				
				Apr 23, 2010 at 2:48:27 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bigjt_2</b></i><br><br>Number two took me a minute but I started plugging in the numbers to my programming calc and see how it works now.  I haven&apos;t played around too much yet with using flag bits instead of flag bytes, but am gradually seeing how they work.  Basically what it seems I need to do is add a BIT test in the part where it&apos;s reading from background.i and use an AND to read from bit 7.  If bit 7 is one, jump to RLE, if it&apos;s 0, write the matatile into RAM and jump to next byte.  That&apos;s pretty cool!  Obviously this means you can&apos;t have any more than 128 metatiles on any one list, because after $7F (decimal 127) the test bit for RLE would always be set and you&apos;d always jump to RLE.  How do you usually get around this?  Actually, have you ever needed to in the first place?  Upon thinking about it it seems that&apos;s a lot of metatiles, but then this demo is pretty simple and it uses 25, so I&apos;m guessing the number can add up pretty quick.  Do you simply jump to different metatile indexes if the number gets too high?
<br></div><br>It&apos;s worthwhile to learn bit testing. It can save you a lot of space.&#xA0; To do it, you use AND.&#xA0; AND works like this on a bit level:<br><br>0 AND 0 = 0<br>1 AND 0 = 0<br>0 AND 1 = 0<br>1 AND 1 = 1<br><br>To bit test, you use AND to clear all of the bits except the one you are checking.&#xA0; If the result is 0, your bit was off.&#xA0; If the result is non-zero, your bit is on.&#xA0; To check bit7 you&apos;d AND with #%10000000.&#xA0; To check bit0 you&apos;d AND with #%00000001.&#xA0; For bit4:<br><br>lda some_number<br>and #%00010000&#xA0; ;check bit4<br>bne bit_was_on&#xA0;&#xA0;&#xA0; ;if non-zero, the bit was on (1 AND 1 gives you a 1, everything else is 0&apos;ed)<br><br>so if you had an RLE flag in bit 7:<br><br>&#xA0; &#xA0; lda [ptr], y&#xA0;&#xA0; ;read a byte from buffer<br>&#xA0;&#xA0;&#xA0; and #%10000000&#xA0; ;check bit7<br>&#xA0;&#xA0;&#xA0; bne @rle&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ;if non-zero, we have rle<br>...;snip<br>@rle:<br>&#xA0;&#xA0; lda [ptr], y&#xA0; ;re-read byte<br>&#xA0;&#xA0; and #%01111111 ;cut off the rle bit to get the metatile #.<br><br>And yes, stealing a bit would limit you to 127 (128?) metatiles.&#xA0; You could have different sets for different levels to get around this though.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__18">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 23, 2010 at 7:38:49 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					I agree, bit testing rocks. For each room in my overworld there are four possibilities for the location of doors and I need 4 bit bank info for each room. So I used bits 7654 for the doors (yes/no in each direction) and then 3210 for the bank number. From 5 bytes to 1 for each room. Poweryay.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__19">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 23, 2010 at 11:35:22 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Cool, thanks guys.  I&apos;m working on this right now, actually.  Got the code re-written to jump 32 tiles by setting bit 2 of $2000 to one.  Just got that part done.  Now I&apos;ll start re-writing it by incorporating the bit tests.  Hopefully work stays nice and slow all day (knock on wood) so I can make some good progress.  You never know when my company and its clients will get annoying and actually expect me to be productive, though.  ;-)
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__20">
                                                        <div class="mdl-card__title"><strong>Mario&apos;s Right Nut</strong> posted on 
		
			
				
				Apr 23, 2010 at 12:23:16 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>bigjt_2</b></i><br><br>You never know when my company and its clients will get annoying and actually expect me to be productive, though. ;-)</div>I know how you feel.&#xA0; What a bunch of bastards.&#xA0; <img src border="0" style="display: none;" original-src="/media/_images/expressions/face-icon-small-sad.gif" show-src="images/blank.gif"><br><br><br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__21">
                                                        <div class="mdl-card__title"><strong>bigjt_2</strong> posted on 
		
			
				
				Apr 27, 2010 at 12:56:07 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Hey folks, here&apos;s the latest iteration, new and improved (as opposed to old and shitty).&#xA0; It incorporates most of Metalslime&apos;s suggestions.&#xA0; Thanks again, sir!<br><br>For whatever reason I couldn&apos;t implement the concept of capping the buffer to keep it from drawing every frame.&#xA0; At first I thought I got it, but then when I started trying to do it in code I just couldn&apos;t get it.&#xA0; What I settled on was a quick test in the main asm called drawTest that basically tests if the player moves and then sets a flag so that the code in the game loop loads up the buffer and the appropriate loading subs in the NMI section run.&#xA0; I&apos;m not sure if that&apos;s a huge improvement.&#xA0; Now it only draws if the player moves, but it&apos;s still drawing quite a bit.&#xA0; Tried working with it so it only drew if the player moved more than eight pixels right or left, but that led to some bugs.<br><br>Still, a lot of fat was trimmed thanks to everyone&apos;s input, so I appreciate it.<br>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__22">
                                                        <div class="mdl-card__title"><strong>GreenMonkey</strong> posted on 
		
			
				
				May 20, 2015 at 8:03:43 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Could someone explain the Offscreen_buffer_tables.i to me? When I try and implement my own metatiles, and leave the file alone, it causes the assembler to freak out and throw a bunch of errors.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__23">
                                                        <div class="mdl-card__title"><strong>user</strong> posted on 
		
			
				
				May 20, 2015 at 8:08:54 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE">
	<i>Originally posted by: <b>GreenMonkey</b></i><br>
	<br>
	Could someone explain the Offscreen_buffer_tables.i to me? When I try and implement my own metatiles, and leave the file alone, it causes the assembler to freak out and throw a bunch of errors.</div>
<br>
Not sure this is what you are looking for, but maybe this could help:<br>
<br>
&#xA0;<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36958" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36958">http://www.nintendoage.com/forum/...</a><br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__24">
                                                        <div class="mdl-card__title"><strong>GreenMonkey</strong> posted on 
		
			
				
				May 21, 2015 at 9:53:58 AM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					<div class="FTQUOTE"><i>Originally posted by: <b>user</b></i><br><br><div class="FTQUOTE">
	<i>Originally posted by: <b>GreenMonkey</b></i><br>
	<br>
	Could someone explain the Offscreen_buffer_tables.i to me? When I try and implement my own metatiles, and leave the file alone, it causes the assembler to freak out and throw a bunch of errors.</div>
<br>
Not sure this is what you are looking for, but maybe this could help:<br>
<br>
&#xA0;<a href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36958" target="_blank" original-href="http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;threadid=36958">http://www.nintendoage.com/forum/messageview.cfm?catid=22&amp;th...</a> <br>
<br>
Cheers! <span class="sprites_emoticons absmiddle" id="emo_smile"></span></div><br><br><br>
It may not have anything to do with the buffer file, but I&apos;ve been attempting to modify the engine to work with my graphics. I replaced the Mario chr file with my own chr file, and reprogrammed my own metatiles and levels, but when I assemble the program it says it doesn&apos;t recognize any of the variables (leftright, sleeping, soft_2000, etc. And even all the .word&apos;s and .db&apos;s, they all say something like &quot;UNDEFINED&quot;. I don&apos;t know why this is but I thought it may have something to do with the buffer file since that&apos;s the only thing I didn&apos;t change, and I don&apos;t really know how it works.
				</div><div class="mdl-card--border"></div>                        </div>
                    
                        <div class="commentCard mdl-card mdl-shadow--2dp" id="misc-8__25">
                                                        <div class="mdl-card__title"><strong>GreenMonkey</strong> posted on 
		
			
				
				May 22, 2015 at 4:25:14 PM 
			
			
			
			
		
	</div><div class="mdl-card__supporting-text">
					Alright so the errors were my own fault. I&apos;ve corrected them but the game seems to freeze upon reading
<br>
<br>     .Sprite0_testtwo
<br>	     bit $2002
<br>	     bvc .Sprite0_testtwo
<br>
<br>I can&apos;t move the screen, the level loads but the first tile in the metatile isn&apos;t displayed, and random garbage keeps going into the stack.
<br>
<br>I re-wrote the engine so that it was formatted in a way I like. I&apos;ve thoroughly compared my code to the original code several times and I didn&apos;t find any mistakes on my part so I&apos;m either doing something wrong with the sprite0hit, or the offscreen_buffer_tables.i needs to be changed. If someone could help me, I&apos;d greatly appreciate it. <span class="sprites_emoticons absmiddle" id="emo_smile"></span>
				</div><div class="mdl-card--border"></div>                        </div>
                                    </div>

                <div class="spacer"></div>

            
        </div>
    </section>
</div>
<div class="mdl-layout__tab-panel is-active" id="overview">
    <section class="section--center mdl-grid mdl-grid--no-spacing">
        <div class="mdl-cell mdl-cell--12-col">
            <h4>概览</h4>
            <p>
                Nerdy Nights 是一个 NES 编程入门教程. 多年来一直是许多人学习 NES 编程的首选解决方案. 
				<br/>
				最初由 Brian Parker
                ( <a href="http://nintendoage.com/users/?bunnyboy" target="_blank">BunnyBoy</a>) 编写, 
				音频部分由 <a href="http://nintendoage.com/users/?MetalSlime" target="_blank">MetalSlime</a> 编写.
            </p>

            <p>原始可访问教程网址 <a href="http://archive.nes.science/nintendoage-forums/nintendoage.com/forum/messageviewadfa.html?catid=22&amp;threadid=7155" target="_blank">点这里</a>.

            </p><p> <a href="https://fuzzytek.ml" target="_blank">Fuzzy</a> 整理了PDF版本(英文版)  <a href="downloads/Nerdy-Nights-NES-Tutorials-v1.pdf" target="_blank">点这里下载</a></p>

            <p>
                由于域名过期，音频系列的链接失效。幸运的是，社区成员保留了这些链接内容。
				<br/>
				这也是论坛保存数据的局限性，删库跑路。
				<br/>
				NintendoAge 网站与 gocollect 的论坛合并也导致数据丢失
				<br/>
				MetalSlime 的网站也没了，还好有一个可用镜像
                <a href="http://web.archive.org/web/20150729002634/http://www.tummaigames.com:80/blog/" target="_blank">thanks to archive.org</a>.
                etc.
            </p>

            <p>
                本站也只是作为一个存档镜像站，说不好哪天也无了
            </p>

            <p>
                音频教程中的图片丢失，配图只是相关图片，并不是原作者的配图，做个参考看看就行了
            </p>

            <p>
                还有由 Dave Dribin (ddribin) 和 JamesSheppardd 完成的 ca65 主要教程系列的移植，这对于您开始使用该汇编器很有帮助。语法有点不同，但其他方面非常相似。
            </p>
			    <ul>
                    <li><a target="_blank" href="https://github.com/JamesSheppardd/Nerdy-Nights-ca65-Translation">JamesSheppardd&apos;s</a> (Complete - <a href="downloads/nerdy-nights-ca65-js.zip">backup zip</a>)</li>
                    <li><a target="_blank" href="https://github.com/ddribin/nerdy-nights">ddribin&apos;s</a> (Missing later tutorials - <a href="downloads/nerdy-nights-ca65.zip">backup zip</a>)</li>
                </ul>
                另一个自动化编译NES的工具 JamesSheppardd <a target="_blank" href="https://cppchriscpp.github.io/create-nes-game">create-nes-game</a>
            <p></p>

            <p>
                杂项部分还有一些其他热门主题和教程，全部取自 NintendoAge 上的热门主题。这些内容由不同的作者撰写，并在各自的帖子中注明。
            </p>

            <p>
                如果想要一份本网站的镜像复制版(原版是英文的)(翻译内容在github 网页最下面有链接)
                <a href="https://nerdy-nights.nes.science/full_site.zip">下载完整版本zip压缩包</a>
            </p>

            <h4>目录</h4>

            <h5>基础教程</h5>
            <ul class="toc">

                                    <a href="#main_tutorial-0">0: 简介</a>
                                    <a href="#main_tutorial-1">1: 数字系统及核心编程思想</a>
                                    <a href="#main_tutorial-2">2: NES 架构概述</a>
                                    <a href="#main_tutorial-3">3: 6502 ASM, 第一个程序</a>
                                    <a href="#main_tutorial-4">4: 调色板，精灵，第二个程序</a>
                                    <a href="#main_tutorial-5">5: 多个精灵，手柄控制，更多介绍</a>
                                    <a href="#main_tutorial-6">6: 背景</a>
                                    <a href="#main_tutorial-7">7: 子程序，游戏布局，Pong游戏</a>
                                    <a href="#main_tutorial-8">8: 16进制，指针，循环嵌套</a>
                                    <a href="#main_tutorial-9">9: 数字转换，BIN - DEC 二进制 十进制</a>
                            </ul>

            <h5>进阶教程</h5>
            <ul class="toc">

                                    <a href="#advanced_tutorial-0">1: CHR Bank 图形Bank切换</a>
                                    <a href="#advanced_tutorial-1">2: 基于 MMC1 的 CHR 和 PRG Bank 切换, 存档芯片，电池</a>
                                    <a href="#advanced_tutorial-2">3: 水平背景滚动</a>
                                    <a href="#advanced_tutorial-3">4: 0号精灵固定在状态栏</a>
                            </ul>

            <h5>音频教程</h5>
            <ul class="toc">

                                    <a href="#audio_tutorial-0">0: 声音</a>
                                    <a href="#audio_tutorial-1">1: 制作一个 音乐/音效 引擎</a>
                                    <a href="#audio_tutorial-2">2: 方波、三角波</a>
                                    <a href="#audio_tutorial-3">3: 周期、查表</a>
                                    <a href="#audio_tutorial-4">4: 声音引擎</a>
                                    <a href="#audio_tutorial-5">5: 声音数据、指针表、标题</a>
                                    <a href="#audio_tutorial-6">6: 节奏、音符长度、缓冲和休止符</a>
                                    <a href="#audio_tutorial-7">7: 音量</a>
                                    <a href="#audio_tutorial-8">8: 操作码和循环</a>
                                    <a href="#audio_tutorial-9">9: 有限循环、调性变化、和弦</a>
                                    <a href="#audio_tutorial-10">10: 简单的鼓</a>
                            </ul>

            <h5>其他杂项</h5>

            <ul class="toc">
                                    <a href="#misc-0">HEX编程</a>
                                    <a href="#misc-1">6502 Killer hacks</a>
                                    <a href="#misc-2">编程相关文件汇总!(啥都没有...)</a>
                                    <a href="#misc-3">MMC1 Memory Mapping: MMC1控制芯片</a>
                                    <a href="#misc-4">World Building with SGP 0: 简介</a>
                                    <a href="#misc-5">World Building with SGP 1: NES图形基础</a>
                                    <a href="#misc-6">World Building with SGP 2: NES图形编辑器</a>
                                    <a href="#misc-7">顶部状态栏和手柄控制器</a>
                                    <a href="#misc-8">背景水平滚动缓冲区</a>
                            </ul>


            <p>
                网站由 cppchriscpp 整理
				<br/>
				<br/>
				以上翻译来自 <a href="https://blog.csdn.net/firseve">happysoul</a>,后续可能会逐步翻译，也可能就这样了
				<br/>
				更多资料访问 <a href="https://happysoul.github.io/nes/">NES开发相关资料</a> &nbsp;|&nbsp; <a href="https://github.com/happysoul">happysoul的github</a>
				<br/>
				<a href="http://pineight.com/nes/">其他可参考教程</a>
            </p>
        </div>
    </section>
</div>

        <footer class="mdl-mega-footer">
          <div class="mdl-mega-footer--bottom-section">
            <div class="mdl-logo">
              Adapted from the NA forums in 2019 by cppchriscpp.
            </div>
            <ul class="mdl-mega-footer--link-list">
              <li><a href="https://archive.nes.science/nintendoage-forums/nintendoage.com/forum/messageviewadfa.html">原始网站连接</a></li>
            </ul>
          </div>
        </footer>
      </main>
    </div>
    <script src="material.min.js"></script>
    <script src="index.js?1"></script>
  

</body></html>